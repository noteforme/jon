<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Jon&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
  
    <link rel="alternate" href="/atom.xml" title="Jon's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jon&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Cease to struggle and you cease to live. - Thomas Carlyle</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-Fragment" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/10/05/Fragment/">Fragment</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-10-05T11:54:50.000Z" itemprop="datePublished">2017年10月05日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2017/10/05/Fragment/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6970998913754988552#heading-16">https://juejin.cn/post/6970998913754988552#heading-16</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/app/Fragment.html">https://developer.android.com/reference/android/app/Fragment.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/fragments.html">https://developer.android.com/guide/components/fragments.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.51cto.com/article/672135.html">https://www.51cto.com/article/672135.html</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7021398731056480269">https://juejin.cn/post/7021398731056480269</a></p>
<p><img src="/2017/10/05/Fragment/cb7551f416f143d99aeb8223af3bd776~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.png" alt="cb7551f416f143d99aeb8223af3bd776~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0"></p>
<p><img src="/2017/10/05/Fragment/2023-08-26-71.png" alt="2023-08-26-71"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static final int INVALID_STATE &#x3D; -1;   &#x2F;&#x2F; 为空时无效</span><br><span class="line">static final int INITIALIZING &#x3D; 0;     &#x2F;&#x2F; 未创建</span><br><span class="line">static final int CREATED &#x3D; 1;          &#x2F;&#x2F; 已创建，位于后台</span><br><span class="line">static final int ACTIVITY_CREATED &#x3D; 2; &#x2F;&#x2F; Activity已经创建，Fragment位于后台</span><br><span class="line">static final int STOPPED &#x3D; 3;          &#x2F;&#x2F; 创建完成，没有开始</span><br><span class="line">static final int STARTED &#x3D; 4;          &#x2F;&#x2F; 开始运行，但是位于后台</span><br><span class="line">static final int RESUMED &#x3D; 5;          &#x2F;&#x2F; 显示到前台</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>作者：小松漫步<br>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7021398731056480269">https://juejin.cn/post/7021398731056480269</a></p>
<p>下面的lifecycle也可以看到,fragment生命周期的状态转移。</p>
<h2 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h2><p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/fragments/lifecycle">https://developer.android.com/guide/fragments/lifecycle</a></p>
<ul>
<li>onViewCreated(View view, Bundle savedInstanceState)</li>
</ul>
<p>Called immediately after <code>onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)</code> has returned, but before any saved state has been restored in to the view.</p>
<img src="/2017/10/05/Fragment/fragment-view-lifecycle.png" alt="ff" style="zoom:67%;">



<h4 id="状态转移"><a href="#状态转移" class="headerlink" title="状态转移"></a>状态转移</h4><p>Fragment</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIALIZING = -<span class="number">1</span>;          <span class="comment">// Not yet attached.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ATTACHED = <span class="number">0</span>;               <span class="comment">// Attached to the host.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CREATED = <span class="number">1</span>;                <span class="comment">// Created.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VIEW_CREATED = <span class="number">2</span>;           <span class="comment">// View Created.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AWAITING_EXIT_EFFECTS = <span class="number">3</span>;  <span class="comment">// Downward state, awaiting exit effects</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ACTIVITY_CREATED = <span class="number">4</span>;       <span class="comment">// Fully created, not started.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STARTED = <span class="number">5</span>;                <span class="comment">// Created and started, not resumed.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AWAITING_ENTER_EFFECTS = <span class="number">6</span>; <span class="comment">// Upward state, awaiting enter effects</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESUMED = <span class="number">7</span>;                <span class="comment">// Created started and resumed.</span></span><br></pre></td></tr></table></figure>

<p><img src="/2017/10/05/Fragment/63280ec450454d56b03be2dd6d48a7fa~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.png" alt="63280ec450454d56b03be2dd6d48a7fa~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0"></p>
<p>这个图和现在fragment状态有点不同，现在新增了一些状态，有必要的话，自己研究绘制一张。</p>
<h2 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">commit();</span><br><span class="line">commitAllowingStateLoss();</span><br><span class="line">commitNow();</span><br><span class="line">commitNowAllowingStateLoss();</span><br></pre></td></tr></table></figure>



<h4 id="commitAllowingStateLoss-VS-commit"><a href="#commitAllowingStateLoss-VS-commit" class="headerlink" title="commitAllowingStateLoss VS  commit()"></a>commitAllowingStateLoss VS  commit()</h4><p>可以看到 allowStateLoss 如果是false，mHost,mDestroyed=true,就会crash了,否则只是return了,所以从这里看，他们区别不大。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">enqueueAction</span><span class="params">(<span class="meta">@NonNull</span> OpGenerator action, <span class="keyword">boolean</span> allowStateLoss)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!allowStateLoss) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mHost == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mDestroyed) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;FragmentManager has been destroyed&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;FragmentManager has not been attached to a &quot;</span></span><br><span class="line">                        + <span class="string">&quot;host.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        checkStateLoss();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">synchronized</span> (mPendingActions) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mHost == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allowStateLoss) &#123;</span><br><span class="line">                <span class="comment">// This FragmentManager isn&#x27;t attached, so drop the entire transaction.</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Activity has been destroyed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mPendingActions.add(action);</span><br><span class="line">        scheduleCommit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://huxian99.github.io/2016/08/28/cj3qymo360000owxk9zp17alo/">https://huxian99.github.io/2016/08/28/cj3qymo360000owxk9zp17alo/</a></p>
<h4 id="commitNow-VS-commit"><a href="#commitNow-VS-commit" class="headerlink" title="commitNow VS  commit()"></a>commitNow VS  commit()</h4><h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><h4 id="Fragment-tag"><a href="#Fragment-tag" class="headerlink" title="Fragment tag"></a>Fragment tag</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Op&gt; mOps &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">void doAddOp(int containerViewId, Fragment fragment, @Nullable String tag, int opcmd) &#123;</span><br><span class="line">    if (tag !&#x3D; null) &#123;</span><br><span class="line">        if (fragment.mTag !&#x3D; null &amp;&amp; !tag.equals(fragment.mTag)) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Can&#39;t change tag of fragment &quot;</span><br><span class="line">                    + fragment + &quot;: was &quot; + fragment.mTag</span><br><span class="line">                    + &quot; now &quot; + tag);</span><br><span class="line">        &#125;</span><br><span class="line">        fragment.mTag &#x3D; tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (containerViewId !&#x3D; 0) &#123;</span><br><span class="line">        if (fragment.mFragmentId !&#x3D; 0 &amp;&amp; fragment.mFragmentId !&#x3D; containerViewId) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Can&#39;t change container ID of fragment &quot;</span><br><span class="line">                    + fragment + &quot;: was &quot; + fragment.mFragmentId</span><br><span class="line">                    + &quot; now &quot; + containerViewId);</span><br><span class="line">        &#125;</span><br><span class="line">        fragment.mContainerId &#x3D; fragment.mFragmentId &#x3D; containerViewId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addOp(new Op(opcmd, fragment));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终是把 fragment加入到 mOps 中</p>
<p><strong>Fragment本质是View</strong></p>
<p>「当然了Fragment本质是View但是又不仅限于此，」 在真实的项目中，界面往往很复杂，业务逻辑也很复杂，往往需要处理各种UI状态变化，比如：增加一组View，替换一组View，删除一组View，还需要和Activity协作。总之，如果让开发者自己去实现这一套逻辑，恐怕比使用Fragment要麻烦的多吧。尽管Fragment看起来蛮复杂的，但是还是远比我们自己去实现相同功能简单的多。</p>
<p><strong>3.1.2 Fragment本质不仅限于View</strong></p>
<p>Fragment作为一个View可以被添加到Activity的布局中去。但是他更强大，还有以下几个特性：</p>
<ol>
<li>处理生命周期，比Activity生命周期还要复杂</li>
<li>通过FragmentTransaction操作多个Fragment</li>
<li>通过FragmentManager维护一个回退栈，回退到上一个FragmentTransaction操作的界面</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.51cto.com/article/672135.html">https://www.51cto.com/article/672135.html</a></p>
<p><strong>commit() vs commitAllowingStateLoss()</strong></p>
<p>commit()和commitAllowingStateLoss()在实现上唯一的不同就是当你调用commit()的时候, FragmentManger会检查mDestory, mHost 如果mHost ==null, 就抛出IllegalStateException.</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7063377212736536607">https://juejin.cn/post/7063377212736536607</a></p>
<p><strong>FragmentPagerAdapter与FragmentStatePagerAdapter的区别</strong></p>
<p>FragmentPagerAdapter适用于页面较少的情况，destroyItem方法中只是调用了fragmentransaction的detach方法</p>
<p>FragmentStatePagerAdapter适用于页面较多的情况，每次切换ViewPager的时候是回收内存的。destroyItem调用了fragmentransaction的remove方法</p>
<p><strong>Fragment 各个方法细节</strong></p>
<p><a target="_blank" rel="noopener" href="https://fuhongliang.gitbooks.io/android/content/di-shi-san-zhang-mian-shi-ti/mu-ke-wang-quan-mian-sheng-ji-android-mian-shi/fragmentmian-shi-ti.html"><strong>https://fuhongliang.gitbooks.io/android/content/di-shi-san-zhang-mian-shi-ti/mu-ke-wang-quan-mian-sheng-ji-android-mian-shi/fragmentmian-shi-ti.html</strong></a></p>
<p>onSaveInstanceState 方法啥时候调用。</p>
<p>但是为什么要这么做呢？</p>
<p>原因是在Android 11版本后的activity会管理fragment，也就是说在activity 在执行onSaveInstanceState()的时候会保存fragment的状态，用于在恢复activity的时候使用。那么在保存fragment的状态后，就不能再去改变fragment的状态，也就是不允许提交事务，这样才能保障activity恢复的时候，可以显示原来fragment的状态。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xx326664162/article/details/88379490">https://blog.csdn.net/xx326664162/article/details/88379490</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19560943/article/details/78112903">https://blog.csdn.net/qq_19560943/article/details/78112903</a></p>
<p> 横竖屏切换</p>
<p>被系统回收（复现 进入开发者选项 -》不保留活动）</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c12a98a36b2b">https://www.jianshu.com/p/c12a98a36b2b</a></p>
<h5 id="BottomNavigationView-error"><a href="#BottomNavigationView-error" class="headerlink" title="BottomNavigationView error"></a>BottomNavigationView error</h5><p>使用BottomNavigationView出现很严重的问题,很久才找到原因</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Caused by: android.view.InflateException: Binary XML file line #16: Binary XML file line #16: Error inflating class com.google.android.material.bottomnavigation.BottomNavigationView</span><br><span class="line">    Caused by: android.view.InflateException: Binary XML file line #16: Error inflating class com.google.android.material.bottomnavigation.BottomNavigationView</span><br></pre></td></tr></table></figure>

<p>因为 AndroidManifest.xml  application下的android:theme=”@style/AppTheme”多出了,把下面的删除了就好了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;item name&#x3D;&quot;android:textColorSecondary&quot;&gt;#ffffff&lt;&#x2F;item&gt;</span><br><span class="line">&lt;item name&#x3D;&quot;android:actionOverflowButtonStyle&quot;&gt;@style&#x2F;OverflowMenuStyle&lt;&#x2F;item&gt;</span><br><span class="line">&lt;item name&#x3D;&quot;android:listDivider&quot;&gt;@drawable&#x2F;divider&lt;&#x2F;item&gt;</span><br></pre></td></tr></table></figure>

<h5 id="重叠原因"><a href="#重叠原因" class="headerlink" title="重叠原因"></a>重叠原因</h5><blockquote>
<p> 旋转屏幕时候，创建的homeFragment会被回收,在销毁前，执行了onSaveInstanceState(Bundle outState)这个方法。这个方法会保存activity的一些信息，其中就包括添加过的fragment，Activity重建后，再次初始化homeFragment，接着显示，导致了重叠的问题。</p>
</blockquote>
<h5 id="代码验证"><a href="#代码验证" class="headerlink" title="代码验证"></a>代码验证</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private fun initFragment() &#123;</span><br><span class="line">    if (homeFragment &#x3D;&#x3D; null) &#123;</span><br><span class="line">        homeFragment &#x3D; HomeFragment()</span><br><span class="line">        addFragment(homeFragment!!)</span><br><span class="line">        showFragment(homeFragment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    Timber.d(&quot;onCreate() $homeFragment&quot;)</span><br><span class="line">    initFragment()</span><br><span class="line">    Timber.d(&quot;initFragment() $homeFragment&quot;)   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> override fun onDestroy() &#123;</span><br><span class="line">        super.onDestroy()</span><br><span class="line">        Timber.tag(TAG).d(&quot;onDestroy() homeFragment $homeFragment&quot;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  641</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() homeFragment null</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;1adc3fa&#125; (b0660244-39c4-4104-b558-f5384c7adb0d) id&#x3D;0x7f09010e&#125;</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;1adc3fa&#125; (d84f5956-fa2c-4cd2-8397-0904040d2a6f)&#125;</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  641</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() homeFragment null</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;ac076db&#125; (f8ee348b-6ff7-4b1e-ba27-6e47e848f623) id&#x3D;0x7f09010e&#125;</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onRestoreInstanceState()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br></pre></td></tr></table></figure>

<p>从 initFragment（） 1adc3fa , ac076db 可以看到，HomeFrgment重新创建了.</p>
<h5 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h5><ol>
<li><p>onSaveInstanceState 不保存信息</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSaveInstanceState</span><span class="params">(outState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">//        super.onSaveInstanceState(outState)</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这种方式的弊端就是，切换后总是回到首页.</p>
</li>
<li><p>onSaveInstanceState() 保存Fragment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">    if (savedInstanceState !&#x3D; null) &#123;</span><br><span class="line">        &#x2F;*获取保存的fragment  没有的话返回null*&#x2F;</span><br><span class="line">        homeFragment &#x3D; supportFragmentManager.getFragment(savedInstanceState, HOME_FRAGMENT_KEY) as HomeFragment?</span><br><span class="line">        healthFragment &#x3D; supportFragmentManager.getFragment(savedInstanceState, DASHBOARD_FRAGMENT_KEY) as HealthFragment?</span><br><span class="line">        personFragment &#x3D; supportFragmentManager.getFragment(savedInstanceState, NOTICE_FRAGMENT_KEY) as PersonFragment?</span><br><span class="line">        addToList(homeFragment)</span><br><span class="line">        addToList(healthFragment)</span><br><span class="line">        addToList(personFragment)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        initFragment()</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> override fun onSaveInstanceState(outState: Bundle) &#123;</span><br><span class="line">        super.onSaveInstanceState(outState)</span><br><span class="line">        Timber.d(&quot;MainActivity onSaveInstanceState&quot;)</span><br><span class="line">        &#x2F;*fragment不为空时 保存*&#x2F;if (homeFragment !&#x3D; null) &#123;</span><br><span class="line">            supportFragmentManager.putFragment(outState!!, HOME_FRAGMENT_KEY, homeFragment!!)</span><br><span class="line">        &#125;</span><br><span class="line">        if (healthFragment !&#x3D; null) &#123;</span><br><span class="line">            supportFragmentManager.putFragment(outState!!, DASHBOARD_FRAGMENT_KEY, healthFragment!!)</span><br><span class="line">        &#125;</span><br><span class="line">        if (personFragment !&#x3D; null) &#123;</span><br><span class="line">            supportFragmentManager.putFragment(outState!!, NOTICE_FRAGMENT_KEY, personFragment!!)</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
</ol>
<p>这种方式，可以解决问题，但是打印的日志HomeFragment还是不一样，是什么情况？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  4437</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;dc2914d&#125; (5f30b0dd-a8d2-4b3c-a27f-1d160a9da58e) id&#x3D;0x7f09010e&#125;</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"> D&#x2F;TabBottomActivity$onCreate: navigation_health</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"> D&#x2F;TabBottomActivity: MainActivity onSaveInstanceState</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;dc2914d&#125; (ab276ea2-5fa2-4d79-b6a6-af7143b114e8)&#125;</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  4437</span><br><span class="line"> D&#x2F;TabBottomActivity: fragmentList数量1</span><br><span class="line"> D&#x2F;TabBottomActivity: fragmentList数量2</span><br><span class="line"> D&#x2F;TabBottomActivity: fragmentList数量2</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;9139494&#125; (5f30b0dd-a8d2-4b3c-a27f-1d160a9da58e) id&#x3D;0x7f09010e&#125;</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onRestoreInstanceState()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"> D&#x2F;TabBottomActivity: MainActivity onSaveInstanceState</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;9139494&#125; (cadcb63f-8516-4d44-8f3c-75b0c8e9f27f)&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yuzhiqiang_1993/article/details/75014591">https://blog.csdn.net/yuzhiqiang_1993/article/details/75014591</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/78ec81b42f92">https://www.jianshu.com/p/78ec81b42f92</a></p>
<h5 id="下面这种方式没理解"><a href="#下面这种方式没理解" class="headerlink" title="下面这种方式没理解"></a>下面这种方式没理解</h5><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d9143a92ad94">https://www.jianshu.com/p/d9143a92ad94</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c12a98a36b2b">https://www.jianshu.com/p/c12a98a36b2b</a></p>
<h2 id="横竖屏切换，Fragment实例复用"><a href="#横竖屏切换，Fragment实例复用" class="headerlink" title="横竖屏切换，Fragment实例复用"></a>横竖屏切换，Fragment实例复用</h2><p>setRetainInstance=true</p>
<p><strong>retainInstance = true已经过期，改用ViewModel</strong></p>
<p>LifeFragment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    retainInstance &#x3D; true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private fun initFragment() &#123;</span><br><span class="line">    var lifeFragment &#x3D; supportFragmentManager.findFragmentById(R.id.fl_content)</span><br><span class="line">    if (lifeFragment &#x3D;&#x3D; null) &#123;</span><br><span class="line">        lifeFragment &#x3D; LifeFragment()</span><br><span class="line">        supportFragmentManager.beginTransaction().add(R.id.fl_content, lifeFragment).commit()</span><br><span class="line">    &#125;</span><br><span class="line">    Timber.d(&quot;LifeFragment $lifeFragment&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切换屏幕后 LifeFragment,ondestroy()没志行,后面的Oncreate()也没有创建.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;LifeActivity LaunchModeActivity: onCreate() taskId  599</span><br><span class="line">D&#x2F;LifeActivity: LifeFragment LifeFragment&#123;6a86311&#125; (70133a14-6dcf-4f8b-beee-6cd31d6623ba) id&#x3D;0x7f090109&#125;</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onAttach(Context context)</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onCreate() savedInstanceState    null</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onCreateView()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onActivityCreated()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onStart()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onResume()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onPause() </span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onStop()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onDestroyView()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onDetach()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onAttach(Context context)</span><br><span class="line">D&#x2F;LifeActivity LaunchModeActivity: onCreate() taskId  599</span><br><span class="line">D&#x2F;LifeActivity: LifeFragment LifeFragment&#123;6a86311&#125; (70133a14-6dcf-4f8b-beee-6cd31d6623ba) id&#x3D;0x7f090109&#125;</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onCreateView()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onActivityCreated()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onStart()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onResume()</span><br></pre></td></tr></table></figure>



<h5 id="Fragment之间传递数据"><a href="#Fragment之间传递数据" class="headerlink" title="Fragment之间传递数据"></a>Fragment之间传递数据</h5><ol>
<li><p>Fragment.setArguments()方法传递bundle</p>
</li>
<li><p>findFragmentById()找到tag,然后直接操作Framgent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">      ArticleFragment articleFrag = (ArticleFragment)</span><br><span class="line">              getSupportFragmentManager().findFragmentById(R.id.article_fragment);</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">if</span> (articleFrag != <span class="keyword">null</span>) &#123;</span><br><span class="line">          articleFrag.updateArticleView(position);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ArticleFragment newFragment = <span class="keyword">new</span> ArticleFragment();</span><br><span class="line">          Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">          args.putInt(ArticleFragment.ARG_POSITION, position);</span><br><span class="line">          newFragment.setArguments(args);</span><br><span class="line">   </span><br><span class="line">          FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();</span><br><span class="line">          transaction.replace(R.id.fragment_container, newFragment);</span><br><span class="line">          transaction.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">          transaction.commit();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>接口回调</p>
</li>
<li><p>ViewModel Livedata</p>
</li>
</ol>
<h5 id="给已经创建frament传递数据"><a href="#给已经创建frament传递数据" class="headerlink" title="给已经创建frament传递数据"></a>给已经创建frament传递数据</h5><p>也是直接 Fragment.refresh(),第一行代码第三版P227，也是这样做的。</p>
<h5 id="fragment回退栈"><a href="#fragment回退栈" class="headerlink" title="fragment回退栈"></a>fragment回退栈</h5><p>tx.addToBackStack(null); 添加回退功能，类似Activity压栈的过程</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fe16553ca2ca">https://www.jianshu.com/p/fe16553ca2ca</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhiyuan0932/article/details/52593039">https://blog.csdn.net/zhiyuan0932/article/details/52593039</a></p>
<p>Fragment控制父Fragment展示</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39491655/communication-between-nested-fragments-in-android">Communication between nested fragments in Android</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011481547/article/details/71552720">https://blog.csdn.net/u011481547/article/details/71552720</a></p>
<p>Fragmet全局流程图</p>
<p><a target="_blank" rel="noopener" href="https://kotlintc.com/articles/5693">https://kotlintc.com/articles/5693</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/MOWdbI5IREjQP1Px-WJY1Q">https://mp.weixin.qq.com/s/MOWdbI5IREjQP1Px-WJY1Q</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5bcd58b6e51d45404c71d23f">https://juejin.im/post/5bcd58b6e51d45404c71d23f</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/_hdbMOA2TVvX4jFnMu15bg">https://mp.weixin.qq.com/s/_hdbMOA2TVvX4jFnMu15bg</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Fragment/" rel="tag">Fragment</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-onActivityResult" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/26/onActivityResult/">onActivityResult</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-26T06:01:53.000Z" itemprop="datePublished">2017年09月26日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2017/09/26/onActivityResult/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="传统方式"><a href="#传统方式" class="headerlink" title="传统方式"></a>传统方式</h4><h6 id="单个页面跳转"><a href="#单个页面跳转" class="headerlink" title="单个页面跳转"></a>单个页面跳转</h6><p> 主要有三个方法实现</p>
<ul>
<li> startActivityForResult(@RequiresPermission Intent intent, int requestCode)</li>
<li> setResult(int resultCode, Intent data)</li>
<li> onActivityResult(int requestCode, int resultCode, Intent data)</li>
</ul>
<p>下面是简单例子<br>跳转MainActivity</p>
<p>目标SecondAcitivty</p>
<p>其中数据传递很简单,特别注意requestCode，resultCode不同的区分的区别</p>
<ul>
<li><p>requestCode：假设  MainActivity　button1 button2到SecondAcitivty,回来的在onActivityResult就需要</p>
<pre><code>   判断是哪个button点击的
</code></pre>
</li>
<li><p>resultCode: 假设MainActivity　button1跳转到SecondAcitivty,  button2到ThirdActiivty,回来后onActivityResult</p>
<pre><code>   就需要判断是哪个Activity回来的
</code></pre>
<p>   参考:<a target="_blank" rel="noopener" href="http://blog.csdn.net/jiangwei0910410003/article/details/16983049">http://blog.csdn.net/jiangwei0910410003/article/details/16983049</a></p>
</li>
</ul>
<p><em>注意</em>:onActivityResult方法用的算比较普遍，刚好有个困惑，回传数据时<code>intent.putExtra(&quot;text&quot;,122);</code>  使用 <code>  String couponId = data.getStringExtra(&quot;text&quot;);</code> 接收时为null,里面跳转和回传,存的值是int类型，获取string类型</p>
<h6 id="Fragment接收onActivityResult"><a href="#Fragment接收onActivityResult" class="headerlink" title="Fragment接收onActivityResult"></a>Fragment接收onActivityResult</h6><p><em>必须使用Fragment 的 startActivityForResult()</em>*</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startForResult</span><span class="params">(Activity activity, Fragment fragment)</span> </span>&#123;</span><br><span class="line">       Intent intent = <span class="keyword">new</span> Intent(activity, LoginActivity.class);</span><br><span class="line">       fragment.startActivityForResult(intent, REQUEST_CODE_MINE_FRAGMENT);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>setResult(RESULT_OK, result); ,finish()后 onActivityResult 返回 resultCode </p>
<h4 id="Activity嵌套Fragment-他们各自发起startActivityForResult发起数据请求"><a href="#Activity嵌套Fragment-他们各自发起startActivityForResult发起数据请求" class="headerlink" title="Activity嵌套Fragment,他们各自发起startActivityForResult发起数据请求"></a>Activity嵌套Fragment,他们各自发起startActivityForResult发起数据请求</h4><h5 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h5><p> <img src="/2017/09/26/onActivityResult/20161119124707067.jpg"></p>
<ul>
<li><p>Fragment发起</p>
<p> Fragment onActivityResult能接收。Activity onActivityResult能接收,但是requestCode不正确。</p>
</li>
<li><p>Activity发起</p>
<p> Fragment不能接收。 Activity onActivityResult能接收。</p>
</li>
</ul>
<h5 id="代码验证"><a href="#代码验证" class="headerlink" title="代码验证"></a>代码验证</h5><p>FirstResultActivity</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> requestCode = <span class="number">1000</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.initView()</span><br><span class="line">      <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, SecondResultActivity::<span class="keyword">class</span>.java)</span><br><span class="line">      findViewById&lt;View&gt;(R.id.bt_activity).setOnClickListener &#123;</span><br><span class="line">          startActivityForResult(intent, requestCode)</span><br><span class="line">          Timber.i(<span class="string">&quot;startActivityForResult <span class="variable">$requestCode</span>&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">      Timber.d(<span class="string">&quot;onActivityResult resultCode <span class="variable">$requestCode</span> resultCode <span class="variable">$resultCode</span>  data  <span class="subst">$&#123;data?.getStringExtra(SecondResultActivity.sData)&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initFragment</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">val</span> ftn = supportFragmentManager.beginTransaction().replace(R.id.fl_content, newInstance(<span class="string">&quot;数据&quot;</span>))</span><br><span class="line">      ftn.commit()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ResultOkFragment</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> requestCode: <span class="built_in">Int</span> = <span class="number">2000</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityCreated</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityCreated(savedInstanceState)</span><br><span class="line">    <span class="keyword">val</span> intent = Intent(context, SecondResultActivity::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    bt_fragment.setOnClickListener &#123;</span><br><span class="line">        startActivityForResult(intent, requestCode)</span><br><span class="line">        Timber.d(<span class="string">&quot;startActivityForResult <span class="variable">$requestCode</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">    Timber.d(<span class="string">&quot;onActivityResult resultCode <span class="variable">$requestCode</span> resultCode <span class="variable">$resultCode</span>  data 			<span class="subst">$&#123;data?.getStringExtra(SecondResultActivity.sData)&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SecondResultActivity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setResult(<span class="number">21</span>, <span class="keyword">new</span> Intent().putExtra(sData, <span class="string">&quot;我要回调啦!!!&quot;</span>));</span><br><span class="line">finish();</span><br></pre></td></tr></table></figure>



<ul>
<li><p>Activity发起</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I&#x2F;FirstResultActivity$initView: startActivityForResult 1000</span><br><span class="line">D&#x2F;FirstResultActivity: onActivityResult resultCode 1000 resultCode 21  data  我要回调啦!!!</span><br></pre></td></tr></table></figure></li>
<li><p>Fragment发起</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;ResultOkFragment$onActivityCreated: startActivityForResult 2000</span><br><span class="line">D&#x2F;ResultOkFragment: onActivityResult resultCode 2000 resultCode 21  data 我要回调啦!!!</span><br><span class="line">D&#x2F;FirstResultActivity: onActivityResult resultCode 329680 resultCode 21  data  我要回调啦!!!</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="跳转多个页面-回来"><a href="#跳转多个页面-回来" class="headerlink" title="跳转多个页面 回来"></a>跳转多个页面 回来</h4><p>中间页面不能finish，也需要在onActivityResult方法内部 起到桥梁作用，回传数据</p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/lanyachuanshu/article/details/52172143">http://blog.csdn.net/lanyachuanshu/article/details/52172143</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/training/basics/intents/result.html">https://developer.android.com/training/basics/intents/result.html</a></p>
<p><a target="_blank" rel="noopener" href="http://45.77.222.97:3000/root/MineUtils/src/master/app/src/main/java/com/jonzhou/mineutils/result/FirstResultActivity.java">http://45.77.222.97:3000/root/MineUtils/src/master/app/src/main/java/com/jonzhou/mineutils/result/FirstResultActivity.java</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzAxMTI4MTkwNQ==&amp;mid=2650826252&amp;idx=1&amp;sn=9ec620d630706c9f8de328e87bb8a0f1&amp;chksm=80b7b292b">https://mp.weixin.qq.com/s?__biz=MzAxMTI4MTkwNQ==&amp;mid=2650826252&amp;idx=1&amp;sn=9ec620d630706c9f8de328e87bb8a0f1&amp;chksm=80b7b292b</a></p>
<h5 id="ActivityResultContract新方式"><a href="#ActivityResultContract新方式" class="headerlink" title="ActivityResultContract新方式"></a>ActivityResultContract新方式</h5><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/o2_2DeAIcJGYSvm2WlhUxg">https://mp.weixin.qq.com/s/o2_2DeAIcJGYSvm2WlhUxg</a></p>
<h5 id="回调作用"><a href="#回调作用" class="headerlink" title="回调作用"></a>回调作用</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayStoreActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">	binding.opengoogle.setOnClickListener &#123;</span><br><span class="line">        intent.action = <span class="string">&quot;com.google.android.payments.standard.TOPUP_V2&quot;</span></span><br><span class="line">        intent.putExtra(<span class="string">&quot;gspTopUpRequest&quot;</span>, resources.getString(R.string.secret_key))</span><br><span class="line">        resultLauncher.launch(intent)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> resultLauncher =</span><br><span class="line">    registerForActivityResult(ActivityResultContracts.StartActivityForResult()) &#123; result -&gt;</span><br><span class="line">        <span class="keyword">when</span> (result.resultCode) &#123;</span><br><span class="line">            Activity.RESULT_OK -&gt; Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;succuss&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            <span class="number">0</span> -&gt; Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;user topup Abandon&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">            <span class="number">1</span> -&gt; Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;topup Failed&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GoogleTopUpActivity</span> : <span class="type">BaseActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> biding <span class="keyword">by</span> lazy &#123; ActivityGoogleTopUpBinding.inflate(layoutInflater) &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(biding.root)</span><br><span class="line">        biding.btPage.setOnClickListener &#123;</span><br><span class="line">            onTopUpAbandon()</span><br><span class="line">        &#125;</span><br><span class="line">        biding.btGoReload.setOnClickListener &#123;</span><br><span class="line">            startActivity(Intent(<span class="keyword">this</span>, ReloadActivity::<span class="keyword">class</span>.java))</span><br><span class="line">            finish()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ReloadActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> biding <span class="keyword">by</span> lazy &#123; ActivityReloadBinding.inflate(layoutInflater) &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(biding.root)</span><br><span class="line">        biding.btReloadPage.setOnClickListener &#123;</span><br><span class="line">            finish()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PlayStoreActivity -&gt;  GoogleTopUpActivity -&gt; ReloadActivity</p>
<p>GoogleTopUpActivity的时候已经关闭了,ReloadActivity 关闭后回到PlayStoreActivity还是会有回调</p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-ScreenCompatibility" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/23/ScreenCompatibility/">ScreenCompatibility</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-23T13:41:20.000Z" itemprop="datePublished">2017年09月23日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2017/09/23/ScreenCompatibility/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Android屏幕的一些技巧</p>
<h5 id="官网适配方案"><a href="#官网适配方案" class="headerlink" title="官网适配方案"></a>官网适配方案</h5><p><a target="_blank" rel="noopener" href="https://developer.android.com/training/basics/supporting-devices/index.html">https://developer.android.com/training/basics/supporting-devices/index.html</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/training/multiscreen/screensizes.html">https://developer.android.com/training/multiscreen/screensizes.html</a></p>
<h5 id="资源图片适配"><a href="#资源图片适配" class="headerlink" title="资源图片适配"></a>资源图片适配</h5><p>Provide alternative bitmaps</p>
<p>To provide good graphical qualities on devices with different pixel densities, you should provide multiple versions of each bitmap in your app—one for each density bucket, at a corresponding resolution. Otherwise, Android must scale your bitmap so it occupies the same visible space on each screen, resulting in scaling artifacts such as blurring.</p>
<p><img src="https://developer.android.com/images/screens_support/devices-density_2x.png" alt="img"></p>
<p><strong>Figure 2.</strong> Relative sizes for bitmaps at different density sizes</p>
<p>There are several density buckets available for use in your apps. Table 1 describes the different configuration qualifiers available and what screen types they apply to.</p>
<p><strong>Table 1.</strong> Configuration qualifiers for different pixel densities.</p>
<table>
<thead>
<tr>
<th align="left">Density qualifier</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ldpi</code></td>
<td align="left">Resources for low-density (<em>ldpi</em>) screens (~120dpi).</td>
</tr>
<tr>
<td align="left"><code>mdpi</code></td>
<td align="left">Resources for medium-density (<em>mdpi</em>) screens (~160dpi). (This is the baseline density.)</td>
</tr>
<tr>
<td align="left"><code>hdpi</code></td>
<td align="left">Resources for high-density (<em>hdpi</em>) screens (~240dpi).</td>
</tr>
<tr>
<td align="left"><code>xhdpi</code></td>
<td align="left">Resources for extra-high-density (<em>xhdpi</em>) screens (~320dpi).</td>
</tr>
<tr>
<td align="left"><code>xxhdpi</code></td>
<td align="left">Resources for extra-extra-high-density (<em>xxhdpi</em>) screens (~480dpi).</td>
</tr>
<tr>
<td align="left"><code>xxxhdpi</code></td>
<td align="left">Resources for extra-extra-extra-high-density (<em>xxxhdpi</em>) uses (~640dpi).</td>
</tr>
<tr>
<td align="left"><code>nodpi</code></td>
<td align="left">Resources for all densities. These are density-independent resources. The system does not scale resources tagged with this qualifier, regardless of the current screen’s density.</td>
</tr>
<tr>
<td align="left"><code>tvdpi</code></td>
<td align="left">Resources for screens somewhere between mdpi and hdpi; approximately 213dpi. This is not considered a “primary” density group. It is mostly intended for televisions and most apps shouldn’t need it—providing mdpi and hdpi resources is sufficient for most apps and the system will scale them as appropriate. If you find it necessary to provide tvdpi resources, you should size them at a factor of 1.33*mdpi. For example, a 100px x 100px image for mdpi screens should be 133px x 133px for tvdpi.</td>
</tr>
</tbody></table>
<p>To create alternative bitmap drawables for different densities, you should follow the <strong>3:4:6:8:12:16 scaling ratio</strong> between the six primary densities. For example, if you have a bitmap drawable that’s 48x48 pixels for medium-density screens, all the different sizes should be:</p>
<ul>
<li>36x36 (0.75x) for low-density (ldpi)</li>
<li>48x48 (1.0x baseline) for medium-density (mdpi)</li>
<li>72x72 (1.5x) for high-density (hdpi)</li>
<li>96x96 (2.0x) for extra-high-density (xhdpi)</li>
<li>144x144 (3.0x) for extra-extra-high-density (xxhdpi)</li>
<li>192x192 (4.0x) for extra-extra-extra-high-density (xxxhdpi)</li>
</ul>
<p>Then, place the generated image files in the appropriate subdirectory under <code>res/</code> and the system will pick the correct one automatically based on the pixel density of the device your app is running on:</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs arduino">res/<br>  drawable-xxxhdpi/<br>    awesome-image.png<br>  drawable-xxhdpi/<br>    awesome-image.png<br>  drawable-xhdpi/<br>    awesome-image.png<br>  drawable-hdpi/<br>    awesome-image.png<br>  drawable-mdpi/<br>    awesome-image.png<br></code></pre></td></tr></table></figure>

<p>Then, any time you reference <code>@drawable/awesomeimage</code>, the system selects the appropriate bitmap based on the screen’s dpi. If you don’t provide a density-specific resource for that density, the system picks the next best match and scales it to fit the screen.</p>
<p>This means that if you generate a 200x200 image for xhdpi devices, you should generate the same resource in 150x150 for hdpi, 100x100 for mdpi, and 75x75 for ldpi devices.<br>而UI问我们需要多少大小的图，如果效果图根据750*1334的话，可以告诉他，不过PS有个叫<br>cutterman的工具可以自动生成不同分辨率的图片</p>
<ul>
<li>PX转 dp</li>
</ul>
<p>以5X 为例: 5X的dpi =420,   PPI = 420/160 = 2.625<br>设置view的宽度我们用　match_parent,那么在5X上，他是多少dp呢？</p>
<p>5X : width = 1080 px<br>dp = 1080 / PPI = 411.428571429,<br>所以411dp就是5X的match_parent</p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/u010983881/article/details/51993157">http://blog.csdn.net/u010983881/article/details/51993157</a></p>
<h5 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h5><ul>
<li>开发中的实际转化</li>
</ul>
<p>　　生成主流屏幕的values，安宽分成320份,高400份<br>　　<br>　　假设ＵＩ根据 iphone6(750×1334)设计的效果图<br>　　根据下图公式计算　Dpi</p>
<p>　   iphone6是4.7寸的 分辨率 750 * 1334,　它的dpi 就是　√(750²+1334²)/4.7 =  325 </p>
<p>​       和drawable-xhdpi 320接近<br>　　<br>　　drawable-xhdpi　480上做的图就是大概是1.5倍的样子 ,分辨率在1920 *1080上的也是一样的</p>
<p>​    然而pixel 2的模拟器是420 真机是441，这是什么原因呢!!!</p>
<p>　　<a target="_blank" rel="noopener" href="http://blog.csdn.net/zengd0/article/details/52464627">http://blog.csdn.net/zengd0/article/details/52464627</a><br>　　所以说　给的1334 * 750 　图就是<br>　　10px  我们写5dp</p>
<p>​    参考:　<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/ec5a1a30694b">http://www.jianshu.com/p/ec5a1a30694b</a><br>　<a target="_blank" rel="noopener" href="http://blog.csdn.net/lmj623565791/article/details/45460089">http://blog.csdn.net/lmj623565791/article/details/45460089</a>
　</p>
<ul>
<li>DPI参考</li>
</ul>
<p>自己计算按照上面的公式很简单，最棘手的还是手机尺寸给出一个手机dpi网站 get what you want<br><a target="_blank" rel="noopener" href="http://dpi.lv/">http://dpi.lv/</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/v_aauFjx-f91WrpCAaNMVQ">https://mp.weixin.qq.com/s/v_aauFjx-f91WrpCAaNMVQ</a>)</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/practices/screens_support">https://developer.android.com/guide/practices/screens_support</a></p>
<p>今日头条适配 </p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/55e0fca23b4f">https://www.jianshu.com/p/55e0fca23b4f</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/JessYanCoding/AndroidAutoSize">https://github.com/JessYanCoding/AndroidAutoSize</a></p>
<p>为什么原来长度 ic_launcher.png 192*192  到了nexus5 中显示是216 * 216 而不是原来的尺寸</p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VIEW/" rel="tag">VIEW</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Package-signature" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/21/Package-signature/">Package-signature</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-21T02:56:13.000Z" itemprop="datePublished">2017年09月21日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2017/09/21/Package-signature/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="Apk打包流程"><a href="#Apk打包流程" class="headerlink" title="Apk打包流程"></a>Apk打包流程</h4><img src="/2017/09/21/Package-signature/2021-08-01_3.apk_package.png" style="zoom:50%;">







<h2 id="相同签名-不同包名问题"><a href="#相同签名-不同包名问题" class="headerlink" title="相同签名 不同包名问题"></a>相同签名 不同包名问题</h2><p>现在把项目重新生成签名，然后安装，安装后会安装失败，因为和以前的app冲突</p>
<p>应用安装后会在data/data 目录生成和包名一样的文件夹</p>
<p>虽然生成了了新的签名但是会覆盖</p>
<h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>android studio更新了新版本 打包的时候v1和v2都需要勾选才能安装</p>
<p><a target="_blank" rel="noopener" href="http://blog.h5min.cn/daihuimaozideren/article/details/77842549">http://blog.h5min.cn/daihuimaozideren/article/details/77842549</a></p>
<h2 id="walle打包"><a href="#walle打包" class="headerlink" title="walle打包"></a>walle打包</h2><p>生成渠道包</p>
<ul>
<li>生成渠道包 ./gradlew clean assembleReleaseChannels </li>
<li>支持 productFlavors ./gradlew clean<br>  assembleMeituanReleaseChannels</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Meituan-Dianping/walle">https://github.com/Meituan-Dianping/walle</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-ubuntu_guide" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/20/ubuntu_guide/">ubuntu_guide</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-20T13:42:17.000Z" itemprop="datePublished">2017年09月20日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/LINUX/">LINUX</a>
  </div>

      
      
<a href="/2017/09/20/ubuntu_guide/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>　<strong>解决Ubuntu 16.04 系统的一些错误</strong></p>
<h2 id="Unable-to-mount-root-fs-on-unknown-block"><a href="#Unable-to-mount-root-fs-on-unknown-block" class="headerlink" title="Unable to mount root fs on unknown-block"></a>Unable to mount root fs on unknown-block</h2><p>　看到Ubuntu系统有更新就点了下，早上打开电脑 Ubuntu直接进不去最下面弹出这这样的<br>　错误　Unable to mount root fs on unknown-block　而且只能强制关机，心想完了我的<br>　资料，还有辛苦编译的源码，不过好在晚上回来倒腾了一把　终于好了。</p>
<p>步骤<br>1、  Advanced options for Ubuntu<br>２、ubuntu Linux 4.4.0-96… (recovery mdoe)  　这里我选择的是第二个，第一个点击后还是<br>　　会报错<br>3、Menu界面　，把能清的先清了，然后点击grub,执行后续操作</p>
<p>4、登录进入命令行界面</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -o rw <span class="regexp">//</span>这一行和参考资料不同</span><br><span class="line">sudo dpkg --configure -a　<span class="regexp">//</span>在这里等了很久 Device ....Start的字样,接着就按了　Ctrl + Alt + Delete , 重启就好了</span><br><span class="line"></span><br><span class="line">sudo apt-get install -f  <span class="comment"># to finish upgrades 最好加这个吧</span></span><br><span class="line">type reboot</span><br></pre></td></tr></table></figure>

<p>  <a target="_blank" rel="noopener" href="https://askubuntu.com/questions/875862/kernel-panic-unable-to-mount-root-in-ubuntu-16-04/875868">https://askubuntu.com/questions/875862/kernel-panic-unable-to-mount-root-in-ubuntu-16-04/875868</a></p>
<h2 id="解压乱码"><a href="#解压乱码" class="headerlink" title="解压乱码"></a>解压乱码</h2><p>在windows上压缩的文件，是以系统默认编码中文来压缩文件。由于zip文件中没有声明其编码，所以linux上的unzip一般以默认编码解压，中文文件名会出现乱码。<br>可以使用终端zip文件进行解压并指定解压的编码<br>　<code>unzip -O GBK   xxx.zip</code><br>解压后的文件的路径为当前终端所在的路径</p>
<p>参考：　<a target="_blank" rel="noopener" href="http://hareric.com/2016/07/26/%E7%AE%80%E6%98%93%E6%96%B9%E6%B3%95%E8%A7%A3%E5%86%B3ubuntu%E4%B8%8B%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E4%B9%B1%E7%A0%81/">Eric Chan</a> </p>
<p>** 17.10的问题　**</p>
<ul>
<li>Android studio3.1无法输入中文<br>　使用 fcitx 选择sunpingying  也可以选择 google pinyin<br>  　然后输入这两行命令<pre><code>      pidof fcitx | xargs kill  #找到原有的fcitx端口并kill掉
      fcitx                     #开启fcitx
</code></pre>
</li>
</ul>
<p>参考： 　<a target="_blank" rel="noopener" href="https://blog.csdn.net/he729164860/article/details/78484713">https://blog.csdn.net/he729164860/article/details/78484713</a>
  　
  　
  　</p>
<h2 id="安装Gnome-shell"><a href="#安装Gnome-shell" class="headerlink" title="安装Gnome　shell"></a>安装Gnome　shell</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install gnome-tweak-tool</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install chrome-gnome-shell</span><br></pre></td></tr></table></figure>
<p>打开tweak可以看到按钮</p>
<p>浏览点击 ||| off按钮系统就会安装</p>
<p>开源chromium加载有问题，使用firefox</p>
<p>很有用的插件</p>
<p><a target="_blank" rel="noopener" href="https://extensions.gnome.org/extension/545/hide-top-bar/">https://extensions.gnome.org/extension/545/hide-top-bar/</a></p>
<p>参考:<a target="_blank" rel="noopener" href="https://www.mobibrw.com/2017/9342">https://www.mobibrw.com/2017/9342</a></p>
<p>　</p>
<h2 id="ctrl-alt-left-（Intellij-idea-shortcut-conflict）"><a href="#ctrl-alt-left-（Intellij-idea-shortcut-conflict）" class="headerlink" title="ctrl + alt + left （Intellij idea shortcut conflict）"></a>ctrl + alt + left （Intellij idea shortcut conflict）</h2><ul>
<li><p>install <u>Dconf Editor</u>   in ubuntu software</p>
</li>
<li><p>launch <u>Dconf Editor</u>, go to    /org/gnome/desktop/wm/keybindings/switch-to-workspace-left  </p>
<p>double click like below</p>
<p><img src="/2017/09/20/ubuntu_guide/ubuntu_guide_01.png" alt="df"></p>
</li>
</ul>
<p> use default value(click Off) -&gt; Custom value(like me or else)</p>
<ul>
<li>you could use it in intellij idea now .</li>
</ul>
<h4 id="genymotion安装"><a href="#genymotion安装" class="headerlink" title="genymotion安装"></a>genymotion安装</h4><ul>
<li>下载Virtualbox</li>
<li>下载genymotion</li>
<li>下载Android stuido genymotion插件</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod +x genymotion-<span class="number">2.6</span>.<span class="number">0</span>-linux_x64.bin      </span><br><span class="line">.<span class="regexp">/genymotion-2.6.0-linux_x64.bin -d /</span>home<span class="regexp">/qiu/</span>Work/genymotion  </span><br></pre></td></tr></table></figure>

<p>//注意： chmod +x 有空格</p>
<h4 id="输入法设置"><a href="#输入法设置" class="headerlink" title="输入法设置"></a>输入法设置</h4><p>ubuntu 18.04 intellij 输入法选择有问题，可以用命令行安装 ibus-pinyin，然后input souce选择拼音输入法</p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-SDK_Integration" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/19/SDK_Integration/">SDK_Integration</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-19T06:44:01.000Z" itemprop="datePublished">2017年09月19日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/TOOL/">TOOL</a>
  </div>

      
      
<a href="/2017/09/19/SDK_Integration/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>平常集成SDK虽然简单，但是过了半年就全忘了，又得重新来过</p>
<h4 id="友盟分享"><a href="#友盟分享" class="headerlink" title="友盟分享"></a>友盟分享</h4><p><a target="_blank" rel="noopener" href="https://open.weixin.qq.com/">微信开发者平台</a><br>创建应用需要 <strong>应用签名</strong></p>
<p>需要签名工具,可以从 <a target="_blank" rel="noopener" href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&id=open1419319167&token=&lang=zh_CN">微信资源中心</a> 获取</p>
<p> 注意要打包才能运行</p>
<h4 id="商汤认证"><a href="#商汤认证" class="headerlink" title="商汤认证"></a>商汤认证</h4><p><a target="_blank" rel="noopener" href="https://v2-devcenter.visioncloudapi.com/#!/home/doc/ocr/android/online/useguide">文档</a></p>
<p>身份证认证</p>
<ul>
<li><p>在common-idcard包中的assets目录下添加 SenseID_OCR.lic文件就可以了</p>
</li>
<li><p>在androidmanifest.xml注册activity</p>
</li>
</ul>
<p>活体认证</p>
<p>最终调用onDetectOver</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void on<span class="constructor">DetectOver(ResultCode <span class="params">code</span>, String <span class="params">id</span>, List <span class="params">imageData</span>)</span></span><br></pre></td></tr></table></figure>

<p>会返回id,然后把id,身份证number,name传给商汤对比</p>
<h4 id="极光推送"><a href="#极光推送" class="headerlink" title="极光推送"></a>极光推送</h4><ul>
<li><p>集成过程</p>
<p>按照文档，主要是要注意这个广播接收器就可以了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;receiver</span><br><span class="line">          android:name=&quot;.jpush.MyReceiver&quot;</span><br><span class="line">          android:enabled=&quot;true&quot;&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户注册SDK的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.REGISTRATION&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户接收SDK消息的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.MESSAGE_RECEIVED&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户接收SDK通知栏信息的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.NOTIFICATION_RECEIVED&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户打开自定义通知栏的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.NOTIFICATION_OPENED&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 接收网络变化 连接/断开 since 1.6.3 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.CONNECTION&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;com.zhujia.land&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>有点疑惑的是推送给特定的APP</p>
<p>目前获取RegistrationID，登陆接口把 RegistrationID传给服务端, 然后Server推送过来就可以了</p>
<p><a target="_blank" rel="noopener" href="http://blog.jiguang.cn/push_audience_tech-2/">http://blog.jiguang.cn/push_audience_tech-2/</a></p>
<p> 暂时别试用Jcenter集成,会出现各种问题</p>
</li>
</ul>
<h4 id="微信登陆"><a href="#微信登陆" class="headerlink" title="微信登陆"></a>微信登陆</h4><h5 id="App登录"><a href="#App登录" class="headerlink" title="App登录"></a>App登录</h5><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Resource_Center_Homepage.html">https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Resource_Center_Homepage.html</a></p>
<ol>
<li>问题1</li>
</ol>
<p><code>E/MtaSDK: [pool-4-thread-1(320): null:705] - Server response error code:404, error:&#123;&quot;ret&quot;:-1, &quot;msg&quot;:&quot;invalid appkey&quot;&#125;</code></p>
<p>Demo里的wechat-sdk-android-with-mta 换成     api ‘com.tencent.mm.opensdk:wechat-sdk-android-without-mta:+’  这个弄了一上午</p>
<ol start="2">
<li><p>问题2  </p>
<p> <code> No value for openid.</code> WXEntryActivity {“errcode”:40029,”errmsg”:”invalid code”}   WXEntryActivity<br> appid secret错误</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (resp.<span class="built_in">getType</span>() == ConstantsAPI.COMMAND_SENDAUTH) &#123;</span><br><span class="line">   SendAuth.Resp authResp = (SendAuth.Resp)resp;</span><br><span class="line">   <span class="keyword">final</span> <span class="keyword">String</span> code = authResp.code;</span><br><span class="line">   NetworkUtil.<span class="built_in">sendWxAPI</span>(handler, <span class="keyword">String</span>.format(<span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?&quot;</span> +</span><br><span class="line">               <span class="string">&quot;appid=%s&amp;secret=%s&amp;code=%s&amp;grant_type=authorization_code&quot;</span>, <span class="string">&quot;wx930ea5d5a258f4f&quot;</span>,</span><br><span class="line">         <span class="string">&quot;1d6d1d57a3dd06336d917bc0b44d964&quot;</span>, code), NetworkUtil.GET_TOKEN);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</span><br></pre></td></tr></table></figure>

<p>demo中 </p>
<p>appid wxd930ea5d5a2584f要换成自己的</p>
<p>secret 1d6d1d57a3dd063b36d91bc0b44d964也要换成自己的</p>
<ol start="3">
<li><p>问题3  需要注册，否则WXEntryActivity不能收到回调</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_ID = <span class="string">&quot;wx88888888&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IWXAPI 是第三方app和微信通信的openApi接口</span></span><br><span class="line"><span class="keyword">private</span> IWXAPI api;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">regToWx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 通过WXAPIFactory工厂，获取IWXAPI的实例</span></span><br><span class="line">    api = WXAPIFactory.createWXAPI(<span class="keyword">this</span>, APP_ID, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将应用的appId注册到微信</span></span><br><span class="line">    api.registerApp(APP_ID);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//建议动态监听微信启动广播进行注册到微信</span></span><br><span class="line">  registerReceiver(<span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 将该app注册到微信</span></span><br><span class="line">    api.registerApp(Constants.APP_ID);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;, <span class="keyword">new</span> IntentFilter(ConstantsAPI.ACTION_REFRESH_WXAPP));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="二维码扫码登录"><a href="#二维码扫码登录" class="headerlink" title="二维码扫码登录"></a>二维码扫码登录</h5><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Login_via_Scan.html">https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Login_via_Scan.html</a></p>
<ol>
<li><p>登录公众平台 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/home?t=home">https://mp.weixin.qq.com/cgi-bin/home?t=home</a> ,点击配置进入IP白名单</p>
<p>点击配置进入IP白名单设置页</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&amp;key=1495617578&amp;version=1&amp;lang=zh_CN&amp;platform=2&amp;token=38764305">https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&amp;key=1495617578&amp;version=1&amp;lang=zh_CN&amp;platform=2&amp;token=38764305</a></p>
</li>
<li><p>二维码扫码登录的appid secret key用开放平台的  <a target="_blank" rel="noopener" href="https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN">https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN</a></p>
<p>注意两个不同的平台配置</p>
</li>
</ol>
</li>
</ol>
<p>二维码失效:  首先普及一下二维码是有失效时间以及失效状态的，一旦你扫过一次二维码或者在某段时间内没有扫描页面上的二维码，该二维码就失效了</p>
<p>app分享拉新规则</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/3bsmiv78yJ4XKwd8iu-0Ig">https://mp.weixin.qq.com/s/3bsmiv78yJ4XKwd8iu-0Ig</a></p>
<h4 id="Wechat-Pay"><a href="#Wechat-Pay" class="headerlink" title="Wechat Pay"></a>Wechat Pay</h4><p><a target="_blank" rel="noopener" href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5">https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5</a></p>
<h4 id="Alipay"><a href="#Alipay" class="headerlink" title="Alipay"></a>Alipay</h4><p><a target="_blank" rel="noopener" href="https://opendocs.alipay.com/open/204/105296">https://opendocs.alipay.com/open/204/105296</a></p>
<p>orderInfo订单信息 由接口拼接就可以了</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/wWB5ENo3eQJH03OXvoup8w">https://mp.weixin.qq.com/s/wWB5ENo3eQJH03OXvoup8w</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzUxODg0MzU2OQ==&amp;mid=2247485318&amp;idx=1&amp;sn=174338566ad8c0426c95815c4f4aee5a&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzUxODg0MzU2OQ==&amp;mid=2247485318&amp;idx=1&amp;sn=174338566ad8c0426c95815c4f4aee5a&amp;scene=21#wechat_redirect</a></p>
<p>推送相关</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6881414546859229192">https://juejin.im/post/6881414546859229192</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-JavaIo" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/12/JavaIo/">JavaIo</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-12T02:14:41.000Z" itemprop="datePublished">2017年09月12日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/JAVA/">JAVA</a>
  </div>

      
      
<a href="/2017/09/12/JavaIo/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>![Screen Shot 2020-09-12 at 5.20.14 PM](JavaIo/Screen Shot 2020-09-12 at 5.20.14 PM.png)</p>
<p>![Screen Shot 2020-09-12 at 5.22.29 PM](JavaIo/Screen Shot 2020-09-12 at 5.22.29 PM.png)</p>
<img src="/2017/09/12/JavaIo/java7-1535863955.jpg" alt="java7-1535863955">



<p>Byte Stream : 对于二进制文件或处理 数字字母之类的数据</p>
<p><a target="_blank" rel="noopener" href="https://www.javazhiyin.com/17362.html">https://www.javazhiyin.com/17362.html</a></p>
<h4 id="FileInputStream"><a href="#FileInputStream" class="headerlink" title="FileInputStream"></a>FileInputStream</h4><p>单个字节读</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/Users/john/Documents/jywork/THINKJAVA/src/main/resource/a.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">while</span> ((data = fis.<span class="keyword">read</span>()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.<span class="keyword">print</span>((<span class="keyword">char</span>) data+<span class="string">&quot;  &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>读到bytes数组里面</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis = null;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">14</span>];</span><br><span class="line">    fis = <span class="keyword">new</span> <span class="built_in">FileInputStream</span>(<span class="string">&quot;/Users/john/Documents/jywork/THINKJAVA/src/main/resource/a.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> read = fis.<span class="built_in">read</span>(bytes);</span><br><span class="line">    <span class="keyword">String</span> s  = <span class="keyword">new</span> <span class="built_in"><span class="keyword">String</span></span>(bytes);</span><br><span class="line">    System.out.<span class="built_in">println</span>(s);</span><br><span class="line">    System.out.<span class="built_in">println</span>(read);</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>读到bytes里面 ,限定读的字节个数</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FileInputStream fis = null;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">14</span>];</span><br><span class="line">    fis = <span class="keyword">new</span> <span class="built_in">FileInputStream</span>(<span class="string">&quot;/Users/john/Documents/jywork/THINKJAVA/src/main/resource/a.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> read = fis.<span class="built_in">read</span>(bytes,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">String</span> s  = <span class="keyword">new</span> <span class="built_in"><span class="keyword">String</span></span>(bytes);</span><br><span class="line">    System.out.<span class="built_in">println</span>(s);</span><br><span class="line">    System.out.<span class="built_in">println</span>(read);</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于为什么必须继承装饰器父类 FilterInputStream的思考</p>
<blockquote>
<p>实际上，如果去查看 JDK 的源码，你会发现，BufferedInputStream、DataInputStream 并非继承自 InputStream，而是另外一个叫 FilterInputStream 的类。那这又是出于什么样的设计意图，才引入这样一个类呢？我们再重新来看一下 BufferedInputStream 类的代码。InputStream 是一个抽象类而非接口，而且它的大部分函数（比如 read()、available()）都有默认实现，按理来说，我们只需要在 BufferedInputStream 类中重新实现那些需要增加缓存功能的函数就可以了，其他函数继承 InputStream 的默认实现。但实际上，这样做是行不通的。对于即便是不需要增加缓存功能的函数来说，BufferedInputStream 还是必须把它重新实现一遍，简单包裹对 InputStream 对象的函数调用。具体的代码示例如下所示。如果不重新实现，那 BufferedInputStream 类就无法将最终读取数据的任务，委托给传递进来的 InputStream 对象来完成。这一部分稍微有点不好理解，你自己多思考一下。</p>
</blockquote>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-WebView" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/09/01/WebView/">WebView</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-09-01T08:07:15.000Z" itemprop="datePublished">2017年09月01日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2017/09/01/WebView/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/webapps/webview.html">https://developer.android.com/guide/webapps/webview.html</a></p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="加载apk包中的html页面"><a href="#加载apk包中的html页面" class="headerlink" title="加载apk包中的html页面"></a>加载apk包中的html页面</h5><p><code> webView.loadUrl(&quot;file:///android_asset/java.html&quot;);</code></p>
<h5 id="Enabling-JavaScript"><a href="#Enabling-JavaScript" class="headerlink" title="Enabling JavaScript"></a>Enabling JavaScript</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">WebView myWebView &#x3D; (WebView) findViewById(R.id.webview);</span><br><span class="line">WebSettings webSettings &#x3D; myWebView.getSettings();</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F;支持JavaScript</span><br><span class="line">&#x2F;&#x2F;        webSettings.setJavaScriptEnabled(true); &#x2F;&#x2F; 在 onStop 和 onResume 里分别把 setJavaScriptEnabled() 给设置成 false 和 true 即可</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         *  设置自适应屏幕,两者合用</span><br><span class="line">         *&#x2F;</span><br><span class="line">        webSettings.setUseWideViewPort(true); &#x2F;&#x2F;将图片调整到适合webview的大小</span><br><span class="line">        webSettings.setLoadWithOverviewMode(true); &#x2F;&#x2F;缩放至屏幕的大小</span><br><span class="line"></span><br><span class="line">        &#x2F;**</span><br><span class="line">         * 缩放操作</span><br><span class="line">         *&#x2F;</span><br><span class="line">        webSettings.setSupportZoom(true);  &#x2F;&#x2F;支持缩放，默认为true。是下面那个的前提。</span><br><span class="line">        webSettings.setBuiltInZoomControls(true); &#x2F;&#x2F;设置内置的缩放控件。若为false，则该WebView不可缩放</span><br><span class="line">        webSettings.setDisplayZoomControls(false);&#x2F;&#x2F;隐藏原生的缩放控件</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;        myWebView.setWebChromeClient(new MyWebViewClient());</span><br><span class="line">        myWebView.setWebViewClient(new MyViewClient());</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面是一些常用的操作</p>
<h5 id="Binding-JavaScript-code-to-Android-code-JS交互"><a href="#Binding-JavaScript-code-to-Android-code-JS交互" class="headerlink" title="Binding JavaScript code to Android code(JS交互)"></a>Binding JavaScript code to Android code(JS交互)</h5><p>When developing a web application that’s designed specifically for the WebView in your Android application, you can create interfaces between your JavaScript code and client-side Android code. For example, your JavaScript code can call a method in your Android code to display a Dialog, instead of using JavaScript’s alert() function.</p>
<p>To bind a new interface between your JavaScript and Android code, call addJavascriptInterface(), passing it a class instance to bind to your JavaScript and an interface name that your JavaScript can call to access the class.</p>
<ul>
<li>office Demo</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">inner class WebLoginInterface(context: Context?) &#123;</span><br><span class="line">     @JavascriptInterface</span><br><span class="line">     fun showToast() &#123;</span><br><span class="line">         Timber.i(&quot;appLogin&quot;)</span><br><span class="line">             mWebView?.post &#123;</span><br><span class="line">                 val mSessionId &#x3D; SharedPreferencesUtils.getParam(AppCtxUtil.getApp(), GsonUtil.SHARE_TOKEN_KEY, &quot;&quot;) as String</span><br><span class="line">                 Timber.i(&quot;mSessionId $&#123;mSessionId&#125;&quot;)</span><br><span class="line">                 val jsMethodName &#x3D; &quot;javascript:appLoginCallBack(&#39;$mSessionId&#39;,&#39;4&#39;)&quot;; &#x2F;&#x2F;需要参数的JS函数名</span><br><span class="line">                 Timber.i(&quot;jsMethodName $jsMethodName&quot;)</span><br><span class="line">                 mWebView?.loadUrl(jsMethodName)</span><br><span class="line">             &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>注意</p>
<blockquote>
<p>Caution: If you’ve set your targetSdkVersion to 17 or higher, you must add the @JavascriptInterface annotation to any method that you want available to your JavaScript (the method must also be public). If you do not provide the annotation, the method is not accessible by your web page when running on Android 4.2 or higher.</p>
</blockquote>
<p> html小例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;Say hello&quot; onClick&#x3D;&quot;showAndroidToast(&#39;Hello Android!&#39;)&quot; &#x2F;&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    function showAndroidToast(toast) &#123;</span><br><span class="line">        Android.showToast(toast);</span><br><span class="line">    &#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>


<p>接着加载JS</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WebView webView &#x3D; (WebView) findViewById(R.id.webview);</span><br><span class="line">webView.addJavascriptInterface(new WebAppInterface(this), &quot;Android&quot;);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/3c94ae673e2a">http://www.jianshu.com/p/3c94ae673e2a</a></p>
<p><a target="_blank" rel="noopener" href="http://www.jianshu.com/p/c20513cad758">http://www.jianshu.com/p/c20513cad758</a></p>
<h5 id="缓存方案"><a href="#缓存方案" class="headerlink" title="缓存方案"></a>缓存方案</h5><h5 id="office-原生缓存"><a href="#office-原生缓存" class="headerlink" title="office (原生缓存)"></a>office (原生缓存)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">	   </span><br><span class="line">WebSettings webSettings &#x3D; wbNews.getSettings();</span><br><span class="line">   webSettings.setJavaScriptEnabled(true);&#x2F;&#x2F; 启用支持javascript</span><br><span class="line">   webSettings.setCacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK);&#x2F;&#x2F;缓存模式</span><br><span class="line">   webSettings.setDomStorageEnabled(true); &#x2F;&#x2F; 开启DOM storage API 功能</span><br><span class="line">   &#x2F;&#x2F; 开启database storage API功能</span><br><span class="line">   webSettings.setDatabaseEnabled(true);</span><br><span class="line">   webSettings.setAllowFileAccess(true);&#x2F;&#x2F;可以访问文件</span><br><span class="line">   webSettings.setBuiltInZoomControls(true);&#x2F;&#x2F;支持缩放</span><br><span class="line"></span><br><span class="line">   &#x2F;&#x2F; 设置数据库缓存路径</span><br><span class="line">   String cacheDirPath &#x3D; getFilesDir().getAbsolutePath() + APP_CACHE_DIRNAME;</span><br><span class="line">   webSettings.setAppCachePath(cacheDirPath);</span><br><span class="line">   webSettings.setAppCacheEnabled(true);</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/coder_pig/article/details/48468969">http://blog.csdn.net/coder_pig/article/details/48468969</a></p>
<h5 id="图片替换方式"><a href="#图片替换方式" class="headerlink" title="图片替换方式"></a>图片替换方式</h5><p><a target="_blank" rel="noopener" href="https://github.com/GcsSloop/diycode/blob/master/blog/journal-02.md">https://github.com/GcsSloop/diycode/blob/master/blog/journal-02.md</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/yipianfengye/androidProject/blob/master/18%20android%E4%BA%A7%E5%93%81%E7%A0%94%E5%8F%91-webview%E9%97%AE%E9%A2%98%E9%9B%86%E9%94%A6.md">其他常用方式</a><br><a target="_blank" rel="noopener" href="https://tech.meituan.com/WebViewPerf.html">美团点评</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/evzDnTsHrAr2b9jcevwBzA">腾讯</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5a94f9d15188257a63113a74">https://juejin.im/post/5a94f9d15188257a63113a74</a></p>
<h5 id="页面白屏"><a href="#页面白屏" class="headerlink" title="页面白屏"></a>页面白屏</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webSettings.setDomStorageEnabled(true); &#x2F;&#x2F; 开启DOM storage API 功能</span><br></pre></td></tr></table></figure>

<p>​      </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ONLYMETAGAIN/article/details/78390643">https://blog.csdn.net/ONLYMETAGAIN/article/details/78390643</a></p>
<p><a target="_blank" rel="noopener" href="https://iluhcm.com/2017/12/10/design-an-elegant-and-powerful-android-webview-part-one/">https://iluhcm.com/2017/12/10/design-an-elegant-and-powerful-android-webview-part-one/</a></p>
<ul>
<li><p>不显示图片的问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">webSettings.setBlockNetworkImage(false);</span><br><span class="line">if (Build.VERSION.SDK_INT&gt;&#x3D;Build.VERSION_CODES.LOLLIPOP)&#123;</span><br><span class="line">    webSettings.setMixedContentMode(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是我的还是不显示</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:hardwareAccelerated&#x3D;&quot;false&quot;</span><br></pre></td></tr></table></figure>



<p>WebView缓存功能</p>
<p><a target="_blank" rel="noopener" href="https://github.com/yale8848/CacheWebView">https://github.com/yale8848/CacheWebView</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.leanote.com/post/zbyzhlsp/%E6%BC%AB%E8%B0%88Android-Webview%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E5%9C%BA%E6%99%AF%E4%B8%8E%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">http://blog.leanote.com/post/zbyzhlsp/%E6%BC%AB%E8%B0%88Android-Webview%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E5%9C%BA%E6%99%AF%E4%B8%8E%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zybuluo.com/zyl06/note/737188">https://www.zybuluo.com/zyl06/note/737188</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5b94ca52e51d450e7d097f38">https://juejin.im/post/5b94ca52e51d450e7d097f38</a></p>
<p><strong>2、缓存模式(5种)</strong></p>
<p><strong>LOAD_CACHE_ONLY:</strong>  不使用网络，只读取本地缓存数据</p>
<p><strong>LOAD_DEFAULT:</strong>  根据cache-control决定是否从网络上取数据。</p>
<p><strong>LOAD_CACHE_NORMAL: API level 17</strong>中已经废弃, 从<strong>API level 11</strong>开始作用同LOAD_DEFAULT模式</p>
<p><strong>LOAD_NO_CACHE:</strong> 不使用缓存，只从网络获取数据.</p>
<p><strong>LOAD_CACHE_ELSE_NETWORK</strong>，只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据。<br>如：<a target="_blank" rel="noopener" href="http://www.taobao.com的cache-control为no-cache,在模式load_default下,无论如何都会从网络上取数据,如果没有网络,就会出现错误页面;在load_cache_else_network模式下,无论是否有网络,只要本地有缓存,都使用缓存.本地没有缓存时才从网络上获取./">www.taobao.com的cache-control为no-cache，在模式LOAD_DEFAULT下，无论如何都会从网络上取数据，如果没有网络，就会出现错误页面；在LOAD_CACHE_ELSE_NETWORK模式下，无论是否有网络，只要本地有缓存，都使用缓存。本地没有缓存时才从网络上获取。</a><br><a target="_blank" rel="noopener" href="http://www.360.com.cn的cache-control为max-age=60,在两种模式下都使用本地缓存数据./">www.360.com.cn的cache-control为max-age=60，在两种模式下都使用本地缓存数据。</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/entry/5ad70987f265da239148a614">https://juejin.im/entry/5ad70987f265da239148a614</a></p>
<p>zip离线缓存</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/AV2SwFfwwJH7xyrIBJemgw">https://mp.weixin.qq.com/s/AV2SwFfwwJH7xyrIBJemgw</a></p>
<h4 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h4><p>WebView漏洞的根源在于强制其访问攻击者控制的网页。网页中含有攻击者可以控制的JS,因此可能钓鱼，窃取私有文件，甚至是 RCE,带来比较大的危害。</p>
<p>下面主要是4.4系统以上的机型</p>
<h5 id="Webview密码明文存储漏洞"><a href="#Webview密码明文存储漏洞" class="headerlink" title="Webview密码明文存储漏洞"></a>Webview密码明文存储漏洞</h5><p>WebView默认开启密码保存功能mWebView.setSavePassword(true),如果未关闭，用户输入密码时，会弹出提示框，询问用户是否保存密码，如果选是，密码会明文保存到 /data/data/com.package.name/databases/webview.db</p>
<h5 id="WebView域控制不严格漏洞"><a href="#WebView域控制不严格漏洞" class="headerlink" title="WebView域控制不严格漏洞"></a>WebView域控制不严格漏洞</h5><p>setAllowFileAccess(true) : 窃取APP任意目录下的私有文件</p>
<p>setAllowUniversalAccessFromFileURLs : 允许通过file域url中的 javascript访问其他的源。</p>
<p>方案</p>
<ol>
<li><p>通过以下设置，防止越权访问，跨域等安全问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setAllowFileAccess(<span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line">setAllowFileAccessFromFileURLs(<span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line">setAllowUniversalAccessFromFileURLs(<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>WebSettings.setSavePassword(false)</p>
<p>关闭密码保存提醒功能</p>
</li>
<li><p>建议开发者通过以下方式移除该JavaScript接口</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">removeJavascriptInterface(<span class="string">&quot;searchBoxJavaBridge_&quot;</span>)</span><br><span class="line"></span><br><span class="line">removeJavascriptInterface(<span class="string">&quot;accessibility&quot;</span>)；</span><br><span class="line"></span><br><span class="line">removeJavascriptInterface(<span class="string">&quot;accessibilityTraversal&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/21787366">https://zhuanlan.zhihu.com/p/21787366</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.kanxue.com/article-14155.htm">https://zhuanlan.kanxue.com/article-14155.htm</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Camera" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/08/28/Camera/">Camera</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-08-28T14:16:43.000Z" itemprop="datePublished">2017年08月28日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2017/08/28/Camera/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://developer.android.com/training/camera/photobasics.html#TaskPath">https://developer.android.com/training/camera/photobasics.html#TaskPath</a></p>
<h5 id="Get-the-thumbnail-缩略图"><a href="#Get-the-thumbnail-缩略图" class="headerlink" title="Get the thumbnail(缩略图)"></a>Get the thumbnail(缩略图)</h5><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_IMAGE_CAPTURE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">btAlbum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Intent takePictureIntent = <span class="keyword">new</span> <span class="built_in">Intent</span>(</span><br><span class="line">               Intent.ACTION_PICK,</span><br><span class="line">               MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</span><br><span class="line">       <span class="built_in">startActivityForResult</span>(takePictureIntent, REQUEST_IMAGE_CAPTURE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">  public void on<span class="constructor">ActivityResult(<span class="params">int</span> <span class="params">requestCode</span>, <span class="params">int</span> <span class="params">resultCode</span>, Intent <span class="params">data</span>)</span> &#123;</span><br><span class="line">      super.on<span class="constructor">ActivityResult(<span class="params">requestCode</span>, <span class="params">resultCode</span>, <span class="params">data</span>)</span>;</span><br><span class="line">   <span class="keyword">if</span> (requestCode<span class="operator"> == </span>REQUEST_IMAGE_CAPTURE<span class="operator"> &amp;&amp; </span>resultCode<span class="operator"> == </span>Activity.RESULT_OK) &#123;</span><br><span class="line">            data?.extras?.<span class="keyword">let</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> imageBitmap = it.get(<span class="string">&quot;data&quot;</span>) <span class="keyword">as</span> Bitmap</span><br><span class="line">                img_show.set<span class="constructor">ImageBitmap(<span class="params">imageBitmap</span>)</span></span><br><span class="line">       &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Save-the-full-size-photo"><a href="#Save-the-full-size-photo" class="headerlink" title="Save the full-size photo"></a>Save the full-size photo</h5><pre><code>  provider_camera.xml 
</code></pre>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    &lt;external-path</span><br><span class="line">        name=&quot;my_images&quot;</span><br><span class="line">        path=&quot;Android/data/com.zhujia.land/files/Pictures&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>跳转拍照 : 还得注意申请权限</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> void dispatch<span class="constructor">TakePictureIntent(<span class="params">int</span> <span class="params">num</span>)</span> &#123;</span><br><span class="line">       Intent takePictureIntent = <span class="keyword">new</span> <span class="constructor">Intent(MediaStore.ACTION_IMAGE_CAPTURE)</span>;</span><br><span class="line">       <span class="keyword">if</span> (takePictureIntent.resolve<span class="constructor">Activity(<span class="params">this</span>.<span class="params">getPackageManager</span>()</span>) != null) &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               photoFile = create<span class="constructor">ImageFile()</span>;</span><br><span class="line">           &#125; catch (IOException e) &#123;</span><br><span class="line">               e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (photoFile<span class="operator"> == </span>null) &#123;</span><br><span class="line">               return;</span><br><span class="line">           &#125;</span><br><span class="line">           Uri imgUri;</span><br><span class="line">           <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; <span class="number">24</span>) &#123;</span><br><span class="line">               imgUri = <span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>from<span class="constructor">File(<span class="params">photoFile</span>)</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">//Android 7.0系统开始 使用本地真实的Uri路径不安全,使用FileProvider封装共享Uri</span></span><br><span class="line">               <span class="comment">//参数二:fileprovider绝对路径 com.dyb.testcamerademo：项目包名</span></span><br><span class="line">               imgUri = <span class="module-access"><span class="module"><span class="identifier">FileProvider</span>.</span></span>get<span class="constructor">UriForFile(<span class="params">this</span>, <span class="string">&quot;com.zhujia.land.fileprovider&quot;</span>, <span class="params">photoFile</span>)</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           takePictureIntent.put<span class="constructor">Extra(MediaStore.EXTRA_OUTPUT, <span class="params">imgUri</span>)</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       start<span class="constructor">ActivityForResult(<span class="params">takePictureIntent</span>, <span class="params">num</span>)</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">      <span class="keyword">if</span> (requestCode == REQUEST_IMAGE_CAPTURE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class="line">          <span class="comment">//如果拍照成功，将Uri用BitmapFactory的decodeStream方法转为Bitmap</span></span><br><span class="line">          <span class="keyword">val</span> imageBitmap = BitmapFactory.decodeStream(photoURI?.let &#123;</span><br><span class="line">              contentResolver.openInputStream(</span><br><span class="line">                  it</span><br><span class="line">              )</span><br><span class="line">          &#125;)</span><br><span class="line">           galleryAddPic(mImageUriFromFile) <span class="comment">//将拍的照片添加到相册</span></span><br><span class="line">          img_show.setImageBitmap(imageBitmap)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>照片添加到相册</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将拍的照片添加到相册</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uri 拍的照片的Uri</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">galleryAddPic</span><span class="params">(uri: <span class="type">Uri</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> mediaScanIntent = Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE,uri)</span><br><span class="line">    sendBroadcast(mediaScanIntent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But it has a question</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">createImageFile</span><span class="params">(context: <span class="type">Context</span>)</span></span>: File? &#123;</span><br><span class="line">            <span class="comment">// Create an image file name</span></span><br><span class="line">            <span class="keyword">val</span> timeStamp: String = SimpleDateFormat(yyyyMMDD_HHmmss).format(Date())</span><br><span class="line"><span class="comment">//            val storageDir: File? = context.getExternalFilesDir(Environment.DIRECTORY_PICTURES)</span></span><br><span class="line">            <span class="keyword">val</span> storageDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> File.createTempFile(</span><br><span class="line">                <span class="string">&quot;JPEG_<span class="subst">$&#123;timeStamp&#125;</span>_&quot;</span>, <span class="comment">/* prefix */</span></span><br><span class="line">                <span class="string">&quot;.jpg&quot;</span>, <span class="comment">/* suffix */</span></span><br><span class="line">                storageDir <span class="comment">/* directory */</span></span><br><span class="line">            ).apply &#123;</span><br><span class="line">                <span class="comment">// Save a file: path for use with ACTION_VIEW intents</span></span><br><span class="line">                <span class="keyword">var</span> currentPhotoPath = absolutePath</span><br><span class="line">                Timber.i(<span class="string">&quot;createImageFile  <span class="variable">$currentPhotoPath</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><code>ACTION_MEDIA_SCANNER_SCAN_FILE</code> 还有一个限制条件，那就是传递进去的文件绝对路径，必须是以 <code>Environment.getExternalStorageDirectory()</code> 方法的返回值开头。</p>
<p>这样 ‘context.getExternalFilesDir(Environment.DIRECTORY_PICTURES)’  这个暂时没弄好</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5ae0541df265da0b9d77e45a">https://juejin.im/post/5ae0541df265da0b9d77e45a</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f269bcda335f#">https://www.jianshu.com/p/f269bcda335f#</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/26d29e187f89">https://www.jianshu.com/p/26d29e187f89</a></p>
<p>servlet<br><a target="_blank" rel="noopener" href="https://my.oschina.net/u/2008084/blog/524937">https://my.oschina.net/u/2008084/blog/524937</a></p>
<p>7.0<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011418943/article/details/77712662">https://blog.csdn.net/u011418943/article/details/77712662</a></p>
<p>Android 10</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/31esIqMudRRDBY8JDs8D4A">https://mp.weixin.qq.com/s/31esIqMudRRDBY8JDs8D4A</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5a33a5106fb9a04525782db5">https://juejin.im/post/5a33a5106fb9a04525782db5</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-ConcurrencyThreadPool" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/08/27/ConcurrencyThreadPool/">ConcurrencyThreadPool</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2017-08-27T02:40:55.000Z" itemprop="datePublished">2017年08月27日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/JAVA/">JAVA</a>
  </div>

      
      
<a href="/2017/08/27/ConcurrencyThreadPool/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <img src="/2017/08/27/ConcurrencyThreadPool/Screen Shot 2020-08-19 at 10.07.23 AM.png" alt="Screen Shot 2020-08-19 at 10.07.23 AM" style="zoom:50%;">



<h4 id="线程池状态切换"><a href="#线程池状态切换" class="headerlink" title="线程池状态切换"></a>线程池状态切换</h4><p><img src="https://img2020.cnblogs.com/blog/1208468/202102/1208468-20210219204031490-460634238.png"></p>
<p>1、RUNNING</p>
<p>(1) 状态说明：线程池处在RUNNING状态时，能够接收新任务，以及对已添加的任务进行处理。<br> (02) 状态切换：线程池的初始化状态是RUNNING。换句话说，线程池被一旦被创建，就处于RUNNING状态，并且线程池中的任务数为0！</p>
<ul>
<li>1</li>
</ul>
<p>2、 SHUTDOWN</p>
<p>(1) 状态说明：线程池处在SHUTDOWN状态时，不接收新任务，但能处理已添加的任务。<br> (2) 状态切换：调用线程池的shutdown()接口时，线程池由RUNNING -&gt; SHUTDOWN。</p>
<p>3、STOP</p>
<p>(1) 状态说明：线程池处在STOP状态时，不接收新任务，不处理已添加的任务，并且会中断正在处理的任务。<br> (2) 状态切换：调用线程池的shutdownNow()接口时，线程池由(RUNNING or SHUTDOWN ) -&gt; STOP。</p>
<p>4、TIDYING</p>
<p>(1)  状态说明：当所有的任务已终止，ctl记录的”任务数量”为0，线程池会变为TIDYING状态。当线程池变为TIDYING状态时，会执行钩子函数terminated()。terminated()在ThreadPoolExecutor类中是空的，若用户想在线程池变为TIDYING时，进行相应的处理；可以通过重载terminated()函数来实现。<br> (2) 状态切换：当线程池在SHUTDOWN状态下，阻塞队列为空并且线程池中执行的任务也为空时，就会由 SHUTDOWN -&gt; TIDYING。<br> 当线程池在STOP状态下，线程池中执行的任务为空时，就会由STOP -&gt; TIDYING。</p>
<p>5、 TERMINATED</p>
<p>(1) 状态说明：线程池彻底终止，就变成TERMINATED状态。<br> (2) 状态切换：线程池处在TIDYING状态时，执行完terminated()之后，就会由 TIDYING -&gt; TERMINATED。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/nmjhehe/article/details/115901549">https://blog.csdn.net/nmjhehe/article/details/115901549</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/east7/p/14417977.html">https://www.cnblogs.com/east7/p/14417977.html</a></p>
<h4 id="线程池工作原理"><a href="#线程池工作原理" class="headerlink" title="线程池工作原理"></a>线程池工作原理</h4><p><img src="https://s0.lgstatic.com/i/image2/M01/AD/A3/CgoB5l3eH8mAAoJCAACEOKMHtpw036.png"></p>
<h5 id="各参数含义"><a href="#各参数含义" class="headerlink" title="各参数含义"></a>各参数含义</h5><h6 id="corePoolSize"><a href="#corePoolSize" class="headerlink" title="corePoolSize"></a>corePoolSize</h6><p>线程池初始化时线程数默认为 0，当有新的任务提交后，会创建新线程执行任务，如果不做特殊设置，此后线程数通常不会再小于 corePoolSize ，因为它们是核心线程，即便未来可能没有可执行的任务也不会被销毁。</p>
<h6 id="maximumPoolSize"><a href="#maximumPoolSize" class="headerlink" title="maximumPoolSize"></a>maximumPoolSize</h6><p>​    maximumPoolSize 最大线程数，线程池会在 corePoolSize 核心线程数的基础上继续创建线程来执行任务，假设任务被不断提交，线程池会持续创建线程直到线程数达到 maximumPoolSize 最大线程数，如果依然有任务被提交，这就超过了线程池的最大处理能力，这个时候线程池就会拒绝这些任务，我们可以看到实际上任务进来之后，线程池会逐一判断 corePoolSize、workQueue、maximumPoolSize，如果依然不能满足需求，则会拒绝任务。</p>
<h6 id="keepAliveTime-时间单位"><a href="#keepAliveTime-时间单位" class="headerlink" title="keepAliveTime+时间单位"></a>keepAliveTime+时间单位</h6><p>​    当线程池中线程数量多于核心线程数时，而此时又没有任务可做，线程池就会检测线程的 keepAliveTime，如果超过规定的时间，无事可做的线程就会被销毁，以便减少内存的占用和资源消耗。但是要注意到了核心线程数就不会销毁了。</p>
<p><img src="/2017/08/27/ConcurrencyThreadPool/queueThreadWork.png"></p>
<p>如上图所示，当提交任务后，线程池首先会检查当前线程数，如果此时线程数小于核心线程数，比如最开始线程数量为 0，则新建线程并执行任务，随着任务的不断增加，线程数会逐渐增加并达到核心线程数，此时如果仍有任务被不断提交，就会被放入 workQueue 任务队列中，等待核心线程执行完当前任务后重新从 workQueue 中提取正在等待被执行的任务。</p>
<p>此时，假设我们的任务特别的多，已经达到了 workQueue 的容量上限，这时线程池就会启动后备力量，也就是 maximumPoolSize 最大线程数，线程池会在 corePoolSize 核心线程数的基础上继续创建线程来执行任务，假设任务被不断提交，线程池会持续创建线程直到线程数达到 maximumPoolSize 最大线程数，如果依然有任务被提交，这就超过了线程池的最大处理能力，这个时候线程池就会拒绝这些任务，我们可以看到实际上任务进来之后，线程池会逐一判断 corePoolSize、workQueue、maximumPoolSize，如果依然不能满足需求，则会拒绝任务。</p>
<h4 id="6-种线程池"><a href="#6-种线程池" class="headerlink" title="6 种线程池"></a>6 种线程池</h4><ol>
<li><p>FixedThreadPool</p>
<p>它的核心线程数和最大线程数是一样的</p>
</li>
<li><p>CachedThreadPool</p>
<p>它的特点在于线程数是几乎可以无限增加的（实际最大可以达到 Integer.MAX_VALUE，为 2^31-1),当我们提交一个任务后，线程池会判断已创建的线程中是否有空闲线程，如果有空闲线程则将任务直接指派给空闲线程，如果没有空闲线程，则新建线程去执行任务，这样就做到了动态地新增线程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123; </span><br><span class="line">        service.execute(<span class="keyword">new</span> Task() &#123; </span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>使用 for 循环提交 1000 个任务给 CachedThreadPool，假设这些任务处理的时间非常长，会发生什么情况呢？因为 for 循环提交任务的操作是非常快的，但执行任务却比较耗时，就可能导致 1000 个任务都提交完了但第一个任务还没有被执行完，所以此时 CachedThreadPool 就可以动态的伸缩线程数量，随着任务的提交，不停地创建 1000 个线程来执行任务，而当任务执行完之后，假设没有新的任务了，那么大量的闲置线程又会造成内存资源的浪费，这时线程池就会检测线程在 60 秒内有没有可执行任务，如果没有就会被销毁，最终线程数量会减为 0。</p>
</li>
<li><p>ScheduledThreadPool</p>
<p>周期性的执行任务</p>
</li>
<li><p>SingleThreadExecutor</p>
<p>它会使用唯一的线程去执行任务，原理和 FixedThreadPool 是一样的，只不过这里线程只有一个，如果线程在执行任务的过程中发生异常，线程池也会重新创建一个线程来执行后续的任务</p>
</li>
<li><p>SingleThreadScheduledExecutor</p>
<p>它实际和第三种 ScheduledThreadPool 线程池非常相似，它只是 ScheduledThreadPool 的一个特例，内部只有一个线程.</p>
</li>
<li><p>ForkJoinPool</p>
<p>我们有一个 Task，这个 Task 可以产生三个子任务，三个子任务并行执行完毕后将结果汇总给 Result。</p>
<img src="https://s0.lgstatic.com/i/image2/M01/AF/A0/CgotOV3kzomAflZxAAB99x9-MzI241.png" style="zoom:50%;"></li>
</ol>
<h4 id="拒绝策略"><a href="#拒绝策略" class="headerlink" title="拒绝策略"></a>拒绝策略</h4><ul>
<li><p>第一种拒绝策略是 AbortPolicy，这种拒绝策略在拒绝任务时，会直接抛出一个类型为 RejectedExecutionException 的 RuntimeException，让你感知到任务被拒绝了，于是你便可以根据业务逻辑选择重试或者放弃提交等策略。</p>
</li>
<li><p>第二种拒绝策略是 DiscardPolicy，这种拒绝策略正如它的名字所描述的一样，当新任务被提交后直接被丢弃掉，也不会给你任何的通知，相对而言存在一定的风险，因为我们提交的时候根本不知道这个任务会被丢弃，可能造成数据丢失。</p>
</li>
<li><p>第三种拒绝策略是 DiscardOldestPolicy，如果线程池没被关闭且没有能力执行，则会丢弃任务队列中的头结点，通常是存活时间最长的任务，这种策略与第二种不同之处在于它丢弃的不是最新提交的，而是队列中存活时间最长的，这样就可以腾出空间给新提交的任务，但同理它也存在一定的数据丢失风险。</p>
</li>
<li><p>第四种拒绝策略是 CallerRunsPolicy，相对而言它就比较完善了，当有新任务提交后，如果线程池没被关闭且没有能力执行，则把这个任务交于提交任务的线程执行，也就是谁提交任务，谁就负责执行任务。这样做主要有两点好处。<br>第一点新提交的任务不会被丢弃，这样也就不会造成业务损失。<br>第二点好处是，由于谁提交任务谁就要负责执行任务，这样提交任务的线程就得负责执行任务，而执行任务又是比较耗时的，在这段期间，提交任务的线程被占用，也就不会再提交新的任务，减缓了任务提交的速度，相当于是一个负反馈。在此期间，线程池中的线程也可以充分利用这段时间来执行掉一部分任务，腾出一定的空间，相当于是给了线程池一定的缓冲期。</p>
<p><strong>提交任务的线程是不固定的，取决于具体是哪个线程执行submit等方法的</strong></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=248">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=248</a></p>
<h4 id="线程数量和CPU核数关系"><a href="#线程数量和CPU核数关系" class="headerlink" title="线程数量和CPU核数关系"></a>线程数量和CPU核数关系</h4><p><code>线程数 = CPU 核心数 *（1+平均等待时间/平均工作时间）</code></p>
<ol>
<li><p>线程平均等待时间所占比例越高，就需要越多的线程</p>
<blockquote>
<p>耗时 IO 型任务 , 比如数据库、文件的读写，网络通信等任务，这种任务的特点是并不会特别消耗 CPU 资源，但是 IO 操作很耗时，总体会占用比较多的时间 , 因为 IO 读写速度相比于 CPU 的速度而言是比较慢的，如果我们设置过少的线程数，就可能导致 CPU 资源的浪费,而如果我们设置更多的线程数，那么当一部分线程正在等待 IO 的时候，它们此时并不需要 CPU 来计算，那么另外的线程便可以利用 CPU 去执行其他的任务，互不影响，这样的话在任务队列中等待的任务就会减少，可以更好地利用资源。</p>
</blockquote>
</li>
<li><p> 线程的平均工作时间所占比例越高，就需要越少的线程</p>
</li>
</ol>
<blockquote>
<p> 平均工作时间长 : CPU密集型任务，加密、解密、压缩、计算等一系列需要大量耗费 CPU 资源的任务。因为计算任务非常重，会占用大量的 CPU 资源，所以这时 CPU 的每个核心工作基本都是满负荷的，而我们又设置了过多的线程，每个线程都想去利用 CPU 资源来执行自己的任务，这就会造成不必要的上下文切换，此时线程数的增多并没有让性能提升，反而由于线程数量过多会导致性能下降。</p>
</blockquote>
<p>   可以通过写代码等办法统计到各部分语句的运行时长</p>
<p>如果我们执行的任务类型不是固定的，比如可能一段时间是 CPU 密集型，另一段时间是 IO 密集型，或是同时有两种任务相互混搭。那么在这种情况下，我们可以把最大线程数设置成核心线程数的几倍，以便应对任务突发情况。当然更好的办法是用不同的线程池执行不同类型的任务，让任务按照类型区分开，而不是混杂在一起，这样就可以按照上一课时估算的线程数或经过压测得到的结果来设置合理的线程数了，达到更好的性能。</p>
<p><a target="_blank" rel="noopener" href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=254">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=254</a></p>
<h4 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h4><h5 id="5种常见的线程池"><a href="#5种常见的线程池" class="headerlink" title="5种常见的线程池"></a>5种常见的线程池</h5><img src="/2017/08/27/ConcurrencyThreadPool/blockQueue.png" alt="Screen Shot 2020-08-19 at 10.07.23 AM" style="zoom:50%;">



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ExecutorService fixedThreadPool = Executors.newFixedThreadPool(<span class="number">1</span>);      <span class="comment">//LinkedBlockingQueue</span></span><br><span class="line">ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();     <span class="comment">// LinkedBlockingQueue</span></span><br><span class="line">ExecutorService cachedThreadPool = Executors.newCachedThreadPool();             <span class="comment">// SynchronousQueue</span></span><br><span class="line">ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(<span class="number">1</span>); <span class="comment">//DelayedWorkQueue</span></span><br><span class="line">ScheduledExecutorService singleThreadScheduledExecutor = Executors.newSingleThreadScheduledExecutor(); <span class="comment">//DelayedWorkQueue</span></span><br></pre></td></tr></table></figure>



<p>上图 前面是线程池，后面是使用的阻塞队列</p>
<ol>
<li><p>LinkedBlockingQueue (FixedThreadPool,SingleThreadExector)</p>
<p>使用的有 FixedThreadPool ,SingleThreadExector,它们使用的阻塞队列是容量为 Integer.MAX_VALUE 的 LinkedBlockingQueue,可以认为是无界队列。由于 FixedThreadPool 线程池的线程数是固定的，所以没有办法增加特别多的线程来处理任务，这时就<em>需要 LinkedBlockingQueue 这样一个没有容量限制的阻塞队列来存放任务</em>。</p>
<p><em>缺点</em>: 最终大量堆积的任务会占用大量内存，并发生 OOM ，也就是OutOfMemoryError.</p>
</li>
<li><p>SynchronousQueue  (CachedThreadPool)</p>
<p>对应的线程池是 CachedThreadPool,线程池 CachedThreadPool 的最大线程数是 Integer 的最大值，可以理解为线程数是可以无限扩展的。和LinkedBlockingQueue阻塞队列重复相反，</p>
<p><em>缺点</em>: 当任务数量特别多的时候，就可能会导致创建非常多的线程，最终超过了操作系统的上限而无法创建新线程，或者导致内存不足。</p>
</li>
<li><p>DelayedWorkQueue (DelayedWorkQueue)</p>
<p>顾名思义，特点就是可以延迟执行任务</p>
<p><em>缺点</em>: 它采用的任务队列是 DelayedWorkQueue，这是一个延迟队列，同时也是一个无界队列，所以和 LinkedBlockingQueue 一样，如果队列中存放过多的任务，就可能导致 OOM</p>
</li>
</ol>
<h5 id="OkHttp线程池"><a href="#OkHttp线程池" class="headerlink" title="OkHttp线程池"></a>OkHttp线程池</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">        <span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br></pre></td></tr></table></figure>

<p>可以看到 corePoolSize  0 ,  MaxPoolSize Integer.MAX_VALUE</p>
<p>根据线程池执行流程： </p>
<ol>
<li>首先核心线程，corePoolSize 为0 。</li>
<li>把任务加入SynchronousQueue，但是这个队列加入就会失败。</li>
<li>创建非核心线程，数量为Integer.MAX_VALUE，可以创建。</li>
<li>当任务执行完后，3创建的非核心线程 根据keepAliveTime时间，逐步销毁。</li>
</ol>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>OkHttpThreadPool.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">        <span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;());</span><br><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果: </p>
<p>任务1<br>Thread[pool-1-thread-1,5,main]</p>
<p>如果 new LinkedBlockingDeque&lt;&gt;(1)能正常执行，因为LinkedBlockingDeque加入 任务1 就满了，后面的任务创建非核心线程</p>
<p>但是有点疑惑，我这里核心线程是0，任务都加入到LinkedBlockingDeque, 按照线程池流程，<strong>非核心就不应该创建呀？怎么任务1就执行了呢</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15y4y1B7Rw?p=5">https://www.bilibili.com/video/BV15y4y1B7Rw?p=5</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/BHDrSgwUVXkzvswK1khidQ">https://mp.weixin.qq.com/s/BHDrSgwUVXkzvswK1khidQ</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/Snailclimb/programmer-advancement">https://github.com/Snailclimb/programmer-advancement</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6855586076132655118">https://juejin.im/post/6855586076132655118</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485441&amp;idx=1&amp;sn=303a25ab02fa9f14a319923e6b0d9759&amp;chksm=cea247caf9d5cedc3a5e1d31f26c08d8ae4c11c349fbdc91ac1d90d8b35807517accb5f5d527&amp;token=2128752750&amp;lang=zh_CN#rd">https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485441&amp;idx=1&amp;sn=303a25ab02fa9f14a319923e6b0d9759&amp;chksm=cea247caf9d5cedc3a5e1d31f26c08d8ae4c11c349fbdc91ac1d90d8b35807517accb5f5d527&amp;token=2128752750&amp;lang=zh_CN#rd</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/18/index.html">https://noteforme.github.io/page/18/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<a class="extend prev" rel="prev" href="/page/17/">Previous</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="page-number" href="/page/17/">17</a><span class="page-number current">18</span><a class="page-number" href="/page/19/">19</a><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/19/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/07/04/DesignPatterns-State/">DesignPatterns_State</a>
          </li>
        
          <li>
            <a href="/2024/07/03/glide/">glide</a>
          </li>
        
          <li>
            <a href="/2023/11/15/permission-storage/">permission_storage</a>
          </li>
        
          <li>
            <a href="/2023/11/15/notification/">notification</a>
          </li>
        
          <li>
            <a href="/2023/08/20/compose-layout/">compose_layout</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ANDROID/" style="font-size: 14px;">ANDROID</a> <a href="/tags/AOSP/" style="font-size: 16px;">AOSP</a> <a href="/tags/Activity/" style="font-size: 10px;">Activity</a> <a href="/tags/AndroidNewFeatures/" style="font-size: 10px;">AndroidNewFeatures</a> <a href="/tags/Assembly/" style="font-size: 10px;">Assembly</a> <a href="/tags/BLOG/" style="font-size: 10px;">BLOG</a> <a href="/tags/ConstraintLayout/" style="font-size: 10px;">ConstraintLayout</a> <a href="/tags/DB/" style="font-size: 12px;">DB</a> <a href="/tags/DesignPattern/" style="font-size: 10px;">DesignPattern</a> <a href="/tags/Drawer/" style="font-size: 10px;">Drawer</a> <a href="/tags/Fragment/" style="font-size: 12px;">Fragment</a> <a href="/tags/JVM/" style="font-size: 18px;">JVM</a> <a href="/tags/LEETCODE/" style="font-size: 20px;">LEETCODE</a> <a href="/tags/Library/" style="font-size: 10px;">Library</a> <a href="/tags/Operators/" style="font-size: 10px;">Operators</a> <a href="/tags/Performance/" style="font-size: 14px;">Performance</a> <a href="/tags/RecyclerView/" style="font-size: 12px;">RecyclerView</a> <a href="/tags/RxJava/" style="font-size: 14px;">RxJava</a> <a href="/tags/THINK/" style="font-size: 10px;">THINK</a> <a href="/tags/TOOL/" style="font-size: 10px;">TOOL</a> <a href="/tags/TabLayout/" style="font-size: 10px;">TabLayout</a> <a href="/tags/Test/" style="font-size: 14px;">Test</a> <a href="/tags/TouchEvent/" style="font-size: 12px;">TouchEvent</a> <a href="/tags/VIEW/" style="font-size: 14px;">VIEW</a> <a href="/tags/XML/" style="font-size: 10px;">XML</a> <a href="/tags/anim/" style="font-size: 10px;">anim</a> <a href="/tags/compose/" style="font-size: 10px;">compose</a> <a href="/tags/concurrency/" style="font-size: 14px;">concurrency</a> <a href="/tags/coroutie/" style="font-size: 16px;">coroutie</a> <a href="/tags/inter/" style="font-size: 12px;">inter</a> <a href="/tags/keyboard/" style="font-size: 10px;">keyboard</a> <a href="/tags/permission/" style="font-size: 10px;">permission</a> <a href="/tags/proguard/" style="font-size: 10px;">proguard</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ANDROID/">ANDROID</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/BLE/">BLE</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DataStructure/">DataStructure</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DesignPatterns/">DesignPatterns</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ENGLISH/">ENGLISH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jetpack/">Jetpack</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LINUX/">LINUX</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mathematics/">Mathematics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Organization/">Organization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SOURCE/">SOURCE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TEST/">TEST</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/">TOOL</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIEW/">VIEW</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/anim/">anim</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024年</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023年</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022年</a><span class="archive-list-count">34</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年</a><span class="archive-list-count">39</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019年</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018年</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017年</a><span class="archive-list-count">50</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ANDROID/" rel="tag">ANDROID</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOSP/" rel="tag">AOSP</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/" rel="tag">Activity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AndroidNewFeatures/" rel="tag">AndroidNewFeatures</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Assembly/" rel="tag">Assembly</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BLOG/" rel="tag">BLOG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ConstraintLayout/" rel="tag">ConstraintLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DesignPattern/" rel="tag">DesignPattern</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drawer/" rel="tag">Drawer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fragment/" rel="tag">Fragment</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEETCODE/" rel="tag">LEETCODE</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Library/" rel="tag">Library</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Operators/" rel="tag">Operators</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RecyclerView/" rel="tag">RecyclerView</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/" rel="tag">RxJava</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/THINK/" rel="tag">THINK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TOOL/" rel="tag">TOOL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TabLayout/" rel="tag">TabLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Test/" rel="tag">Test</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TouchEvent/" rel="tag">TouchEvent</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VIEW/" rel="tag">VIEW</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/" rel="tag">XML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anim/" rel="tag">anim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compose/" rel="tag">compose</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coroutie/" rel="tag">coroutie</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inter/" rel="tag">inter</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keyboard/" rel="tag">keyboard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/permission/" rel="tag">permission</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proguard/" rel="tag">proguard</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example1.com/">site-name1</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example2.com/">site-name2</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example3.com/">site-name3</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">Site Map</a>
        <span> | </span><a href="/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2024 Jon.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  



</body>
</html>