<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Activity</title>
    <url>/2021/01/16/ACTIVITY/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/reference/android/app/Activity.html">https://developer.android.com/reference/android/app/Activity.html</a></p>
<h4 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h4><p>An activity is a single, focused thing that the user can do. Almost all activities interact with the user, so the Activity class takes care of creating a window for you in which you can place your UI with setContentView(View).<br>Acitivty和用户交互，所以也是用的最多的</p>
<p><img src="https://developer.android.com/images/activity_lifecycle.png" alt="生命周期"> </p>
<h5 id="lifecycle"><a href="#lifecycle" class="headerlink" title="lifecycle"></a>lifecycle</h5><ol>
<li>onCreate():  Activity创建的时候调用，绑定数据。</li>
<li>onStart() : 当Activity对用户变得可见的时候调用.</li>
<li>onResume() : activity开始和用户交互的时候调用，这时候activity处于栈顶，伴随着用户的输入.</li>
<li>onPause() : 当activity失去前台状态，开始进入stopped/hidden or destroyed状态，不能再获取焦点，此时activity对用户可见，但是更新的UI的操作要快。</li>
<li>onStop()  :  当activity不再可见，可能是新的activity来到栈顶，或者当前activity正在被destroy.</li>
<li>onDestory(): 当前activity正在离开。</li>
</ol>
<h5 id="想到一个问题-界面A到界面B，是A的onStop-先执行-还是B的onResume-先走"><a href="#想到一个问题-界面A到界面B，是A的onStop-先执行-还是B的onResume-先走" class="headerlink" title="想到一个问题:界面Ａ到界面Ｂ，是Ａ的onStop()先执行　还是Ｂ的onResume()先走"></a>想到一个问题:界面Ａ到界面Ｂ，是Ａ的onStop()先执行　还是Ｂ的onResume()先走</h5><p>先用事实说话吧</p>
<pre><code> I/BaseActivity: MainActivity -- onCreate() -- 
 I/BaseActivity: MainActivity -- onStart() -- 
 I/BaseActivity: MainActivity -- onResume() -- 
 I/BaseActivity: MainActivity -- onPause() -- 
 I/BaseActivity: StopResumeActivity -- onCreate() -- 
 I/BaseActivity: StopResumeActivity -- onStart() -- 
 I/BaseActivity: StopResumeActivity -- onResume() -- 
 I/BaseActivity: MainActivity -- onStop() -- 
</code></pre>
<p>从打印结果可以看到StopResumeActivity.onResume()先执行,然后是MainActivity的onStop</p>
<p>onStop() :<br>大概知道原因，但是还是不够说服力，因为onStart()方法已经对用户可见了，为什么MainActivity – onStop()不在 StopResumeActivity – onStart()后面呢？</p>
<p>可能是onResume()调用后，新activity位于栈顶，之前的再onStop()</p>
<h4 id="Activity-luanch-mode"><a href="#Activity-luanch-mode" class="headerlink" title="Activity luanch mode"></a>Activity luanch mode</h4><h5 id="4种启动模式"><a href="#4种启动模式" class="headerlink" title="4种启动模式"></a>4种启动模式</h5><ul>
<li><p>standard </p>
<p>在不同的Task中打开同一个Activity，Activity会被创建多个实例。分别放进打开它的Task中。</p>
<p>例如: 点开短信中的电话号码， 新的 打电话的Activity会存在于   短信Task中。</p>
</li>
<li><p>singleTop</p>
</li>
<li><p>singleTask</p>
<blockquote>
<p>The system creates a new task and instantiates the activity at the root of the new task. However, if an instance of the activity already exists in a separate task, the system routes the intent to the existing instance through a call to its <code>onNewIntent()</code> method, rather than creating a new instance. Only one instance of the activity can exist at a time.</p>
<p>只会在一个Task出现,这个Task里只有一个这个Activity，全局唯一</p>
</blockquote>
</li>
<li><p>singleInstance </p>
<blockquote>
<p>Same as <code>&quot;singleTask&quot;</code>, except that the system doesn’t launch any other activities into the task holding the instance. The activity is always the single and only member of its task; any activities started by this one open in a separate task.</p>
<p>除了全局唯一，还会独占一个Task</p>
</blockquote>
</li>
</ul>
<h5 id="taskAffinity"><a href="#taskAffinity" class="headerlink" title="taskAffinity"></a>taskAffinity</h5><p>每个Activity都有一个taskAffinity，默认取自Activity所在的Application的taskAffinity,而后者又默认取自app包名.</p>
<p>每个Task也有它自己的taskAffinity，它取自栈底的Activity的taskAffinity</p>
<p>默认情况下，Activity会直接进入当前的Task</p>
<p>但对于设置了  launchMode = “singleTask”的Activity,系统会先比对Activity和当前Task的taskAffinity是否相同</p>
<ul>
<li><p>如果相同，依然正常入栈.</p>
</li>
<li><p>如果不同，新Activity会去寻找和它 taskAffinity相同的Task后入栈。</p>
<p>如果找不到，系统就为它创建一个新的Task,或者创建一个新的Task.</p>
</li>
</ul>
<p>MainActivity启动FirstActivity</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">    android:name=&quot;.component.launchmode.FirstActivity&quot;</span><br><span class="line">    android:taskAffinity=&quot;com.comm.mytask&quot; /&gt;</span><br></pre></td></tr></table></figure>




<pre><code>   TaskRecord&#123;dff3f0b #4947 A=com.comm.util U=0 StackId=1 sz=2&#125;
         Run #4: ActivityRecord&#123;e52ebf7 u0 com.comm.util/.component.launchmode.FirstActivity t4947&#125;
         Run #3: ActivityRecord&#123;cd6b037 u0 com.comm.util/.MainActivity t4947&#125;
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">    android:name=&quot;.component.launchmode.FirstActivity&quot;</span><br><span class="line">    android:launchMode=&quot;singleTask&quot;</span><br><span class="line">    android:taskAffinity=&quot;com.comm.mytask&quot; /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">TaskRecord</span>&#123;<span class="number">3713</span>c<span class="number">1</span>e #<span class="number">4946</span> A=com.comm.mytask U=<span class="number">0</span> StackId=<span class="number">1</span> sz=<span class="number">1</span>&#125;</span><br><span class="line">      <span class="attribute">Run</span> #<span class="number">4</span>: ActivityRecord&#123;<span class="number">3</span>d<span class="number">3</span>bd<span class="number">58</span> u<span class="number">0</span> com.comm.util/.component.launchmode.FirstActivity t<span class="number">4946</span>&#125;</span><br><span class="line">    <span class="attribute">TaskRecord</span>&#123;<span class="number">273</span>cacc #<span class="number">4945</span> A=com.comm.util U=<span class="number">0</span> StackId=<span class="number">1</span> sz=<span class="number">1</span>&#125;</span><br><span class="line">      <span class="attribute">Run</span> #<span class="number">3</span>: ActivityRecord&#123;<span class="number">77277</span>e<span class="number">0</span> u<span class="number">0</span> com.comm.util/.MainActivity t<span class="number">4945</span>&#125;</span><br></pre></td></tr></table></figure>

<p> 添加完   <code>android:launchMode=&quot;singleTask&quot;</code>后 多了个task     com.comm.mytask</p>
<h5 id="TaskAffinity和最近任务列表"><a href="#TaskAffinity和最近任务列表" class="headerlink" title="TaskAffinity和最近任务列表"></a>TaskAffinity和最近任务列表</h5><p>最近任务列表会列出现有的Task</p>
<ul>
<li>但他们的taskAffinity需要不一样</li>
<li>当多个Task具有相同的taskAffinity额时候，最近任务列表只有显示最新展示过的那一个.</li>
</ul>
<p>除了 singleInstance 不好验证 所在task是否只有唯一的activity ，其他的启动模式比较清晰?</p>
<p>查看运行的activity   </p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line">adb <span class="built_in">shell</span> dumpsys activity activities | sed -En -e &#x27;/Running activities/,/<span class="keyword">Run</span> <span class="meta">#0/p&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="remote-Compressing-objects-100-3780-3780-done-两种方式"><a href="#remote-Compressing-objects-100-3780-3780-done-两种方式" class="headerlink" title="remote: Compressing objects: 100% (3780/3780), done.    两种方式"></a>remote: Compressing objects: 100% (3780/3780), done.    两种方式</h5><ol>
<li><p>AndroidMenifest</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">remote: Compressing objects: 100% (378.  remote: Compressing objects: 100% (3780/3780), done.</span><br><span class="line">0/3780), done.</span><br><span class="line">  &lt;activity</span><br><span class="line">         android:name = &quot;com.ryg.chapter_1.SecondActivity&quot;</span><br><span class="line">         android:launchMode=&quot;singleTask&quot;</span><br><span class="line">         /&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Intent设置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">intent.addFlasg(Intent.FLAG_ACTIVITY_NEW_TASK)</span><br></pre></td></tr></table></figure></li>
</ol>
<p> 2优先级高于1级</p>
<h5 id="SingleInstance-不设置taskAffinity"><a href="#SingleInstance-不设置taskAffinity" class="headerlink" title="SingleInstance 不设置taskAffinity"></a>SingleInstance 不设置taskAffinity</h5><p>SingleInstance会创建一个新的任务栈</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.launchmode.FirstActivity&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;activity</span><br><span class="line">    android:name=&quot;.component.launchmode.SecondActivity&quot;</span><br><span class="line">    android:launchMode=&quot;singleInstance&quot; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.launchmode.ThirdActivity&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

 <figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">D</span>/<span class="variable">FirstActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onCreate</span>() <span class="variable">taskId</span>  <span class="number">86</span></span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">FirstActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">FirstActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onResume</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">FirstActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onPause</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onCreate</span>() <span class="variable">taskId</span>  <span class="number">85</span></span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onRestoreInstanceState</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>:  <span class="function"><span class="title">onNewIntent</span>(<span class="variable">Intent</span> <span class="variable">intent</span>)</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onResume</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">FirstActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onSaveInstanceState</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">FirstActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onStop</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onPause</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">ThirdActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onCreate</span>() <span class="variable">taskId</span>  <span class="number">86</span></span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">ThirdActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">ThirdActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onResume</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onSaveInstanceState</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">SecondActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onStop</span>()</span></span><br></pre></td></tr></table></figure>

<p>可以看到 FirstActivity 、ThirdActivity在同一个栈中，SecondActivity单独在一个栈中</p>
<p>所以按返回键盘，先到 FirstActivity，然后到SecondActivity .</p>
<h5 id="栈内Activity查看，设置taskAffinity"><a href="#栈内Activity查看，设置taskAffinity" class="headerlink" title="栈内Activity查看，设置taskAffinity"></a>栈内Activity查看，设置taskAffinity</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.launchmode.SerachActivity&quot;</span> /&gt;</span></span><br><span class="line">   &lt;activity</span><br><span class="line">       android:name=&quot;.component.onactivityresult.SecondActivity&quot;</span><br><span class="line">       android:launchMode=&quot;singleTask&quot;</span><br><span class="line">       android:taskAffinity=&quot;&quot; /&gt;</span><br><span class="line">   &lt;activity</span><br><span class="line">       android:name=&quot;.component.launchmode.FirstActivity&quot;</span><br><span class="line">       android:configChanges=&quot;orientation&quot;</span><br><span class="line">       android:launchMode=&quot;singleTask&quot;&gt;</span><br><span class="line">       <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.MAIN&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">           <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.category.LAUNCHER&quot;</span> /&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">activity</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>adb shell dumpsys activity</p>
</blockquote>
<p>![](Activity/Screen Shot 2021-01-23 at 3.31.08 PM.png)</p>
<ul>
<li>taskAffinity属性的值为字符串，且中间必须含有分隔符”.”</li>
<li>standard模式，taskAffinity继承自Application的taskAffinity，而Application默认taskAffinity为包名，所以MainActivity的taskAffinity为包名。</li>
</ul>
<p><a href="https://developer.android.com/guide/components/activities/tasks-and-back-stack">https://developer.android.com/guide/components/activities/tasks-and-back-stack</a></p>
<p><a href="https://blog.csdn.net/mynameishuangshuai/article/details/51491074">https://blog.csdn.net/mynameishuangshuai/article/details/51491074</a></p>
<p><a href="https://blog.csdn.net/zhangjg_blog/article/details/10923643">https://blog.csdn.net/zhangjg_blog/article/details/10923643</a></p>
<h4 id="OnNewIntent"><a href="#OnNewIntent" class="headerlink" title="OnNewIntent()"></a>OnNewIntent()</h4><p>onNewIntent</p>
<p>added in <a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element.html#ApiLevels">API level 1</a></p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">void</span> onNewIntent (Intent <span class="built_in">int</span>ent)</span><br></pre></td></tr></table></figure>

<p>if the Activity was already created and a new Intent is being delivered to <code>onNewIntent(android.content.Intent)</code></p>
<p>This is called for activities that set launchMode to “singleTop” in their package, or if a client used the <code>FLAG_ACTIVITY_SINGLE_TOP</code> flag when calling <code>startActivity(Intent)</code>. In either case, when the activity is re-launched while at the top of the activity stack instead of a new instance of the activity being started, onNewIntent() will be called on the existing instance with the Intent that was used to re-launch it.</p>
<p>An activity will always be paused before receiving a new intent, so you can count on <code>onResume()</code> being called after this method.</p>
<p>Note that <code>getIntent()</code> still returns the original Intent. You can use <code>setIntent(Intent)</code> to update it to this new Intent.</p>
<table>
<thead>
<tr>
<th>Parameters</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td><code>intent</code></td>
<td><code>Intent</code>: The new intent that was started for the activity.</td>
</tr>
</tbody></table>
<p>这个方法用于singleTop  singleTask两种启动模式</p>
<p>先看看  singleTask方式：FirstActivity  </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;activity android:<span class="attribute">name</span>=<span class="string">&quot;.launchmode.FirstActivity&quot;</span></span><br><span class="line">            android:<span class="attribute">launchMode</span>=<span class="string">&quot;singleTask&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>​        </p>
<p>   从 FirstActivity  –&gt; LaunchActivity –&gt; FirstActivity 生命周期方法</p>
<blockquote>
<p> 04-24 11:49:14.602 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onCreate()<br> 04-24 11:49:14.672 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onStart()<br> 04-24 11:49:14.679 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onResume()<br> 04-24 11:49:32.085 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onPause()<br> 04-24 11:49:32.099 26674-26674/com.jonzhou.mineutils D/LaunchActivity LaunchMode: onCreate()<br> 04-24 11:49:32.127 26674-26674/com.jonzhou.mineutils D/LaunchActivity LaunchMode: onStart()<br> 04-24 11:49:32.132 26674-26674/com.jonzhou.mineutils D/LaunchActivity LaunchMode: onResume()<br> 04-24 11:49:32.462 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onStop()<br> 04-24 11:49:53.681 26674-26674/com.jonzhou.mineutils D/LaunchActivity LaunchMode: onPause()<br> 04-24 11:49:53.701 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode:  onNewIntent(Intent intent)<br> 04-24 11:49:53.702 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onStart()<br> 04-24 11:49:53.703 26674-26674/com.jonzhou.mineutils D/FirstActivity LaunchMode: onResume()<br> 04-24 11:49:54.049 26674-26674/com.jonzhou.mineutils D/LaunchActivity LaunchMode: onStop()<br> 04-24 11:49:54.049 26674-26674/com.jonzhou.mineutils D/LaunchActivity LaunchMode: onDestroy()</p>
</blockquote>
<p>然后可以通过 onNewIntent(Intent intent);获取传回来的数据</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">String data1 = intent.get<span class="constructor">StringExtra(<span class="params">newIntent</span>)</span>;</span><br><span class="line">String data2 = get<span class="constructor">Intent()</span>.get<span class="constructor">StringExtra(<span class="params">newIntent</span>)</span>;  <span class="comment">//这种方式获取不到</span></span><br><span class="line">set<span class="constructor">Intent(<span class="params">intent</span>)</span>;                                     <span class="comment">//通过这种设置获取</span></span><br><span class="line">String data3 = get<span class="constructor">Intent()</span>.get<span class="constructor">StringExtra(<span class="params">newIntent</span>)</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;onNewIntent  &quot;</span> + data3);</span><br></pre></td></tr></table></figure>



<p>为什么要设置 setIntent(intent)</p>
<blockquote>
<p>我们在多次启动同一个栈唯一模式下的activity时，在onNewIntent()里面的getIntent()得到的intent感觉都是第一次的那个数据。对，这里就是这个陷阱。因为它就是会返回第一个intent的数据</p>
</blockquote>
<p><a href="https://blog.csdn.net/qq_16628781/article/details/51539715">https://blog.csdn.net/qq_16628781/article/details/51539715</a></p>
<p>生命周期视图</p>
<p><a href="http://yhz61010.iteye.com/blog/2389877">http://yhz61010.iteye.com/blog/2389877</a></p>
<p><a href="https://blog.csdn.net/qq_16628781/article/details/51539715">https://blog.csdn.net/qq_16628781/article/details/51539715</a></p>
<h4 id="然而-ANDROID-4-4-启动模式会出现问题"><a href="#然而-ANDROID-4-4-启动模式会出现问题" class="headerlink" title="然而 ANDROID 4.4 启动模式会出现问题"></a>然而 ANDROID 4.4 启动模式会出现问题</h4><p><a href="http://www.jianshu.com/p/2a9fcf3c11e4">http://www.jianshu.com/p/2a9fcf3c11e4</a></p>
<p><a href="http://blog.csdn.net/mynameishuangshuai/article/details/51491074">http://blog.csdn.net/mynameishuangshuai/article/details/51491074</a></p>
<p><a href="https://www.youtube.com/watch?v=r4T9zkhpmII">https://www.youtube.com/watch?v=r4T9zkhpmII</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>AMS</title>
    <url>/2020/08/07/AMS/</url>
    <content><![CDATA[<h4 id="系统启动"><a href="#系统启动" class="headerlink" title="系统启动"></a>系统启动</h4><p>![](AMS/2021-07-31 at 7.53_start1.png)</p>
<p>​    <img src="/2020/08/07/AMS/2021-08-16_PHONE_START.png"></p>
<img src="/2020/08/07/AMS/2021-07-31 at 7.53.43_start2.png" style="zoom: 50%;">







<h4 id="AMS"><a href="#AMS" class="headerlink" title="AMS"></a>AMS</h4><p>AMS属于SystemServer进程,主要是为了加载Activity 管理Activity生命周期 .</p>
<img src="/2020/08/07/AMS/2021-08-07_8.25_ams.png" style="zoom:50%;">

<p>Launcher请求AMS创建根Activity所在进程（如果之前没有该进程），AMS请求Zygote进程fork应用进程。</p>
<p><img src="/2020/08/07/AMS/2021-08-16_AMS_APPLICATION.png"></p>
<p><img src="/2020/08/07/AMS/2021-08-07_8.26_ams.png"></p>
<p>android启动流程</p>
<p><a href="https://www.bilibili.com/video/BV1DQ4y197oX?from=search&amp;seid=14802265503756746151">https://www.bilibili.com/video/BV1DQ4y197oX?from=search&amp;seid=14802265503756746151</a></p>
<p><a href="https://www.bilibili.com/video/BV1Pi4y1A7Sr?from=search&amp;seid=17031756056912732811">https://www.bilibili.com/video/BV1Pi4y1A7Sr?from=search&amp;seid=17031756056912732811</a></p>
<p>一般 <a href="https://www.bilibili.com/video/BV1K541177GU?p=3">https://www.bilibili.com/video/BV1K541177GU?p=3</a> </p>
<h4 id="应用启动流程"><a href="#应用启动流程" class="headerlink" title="应用启动流程"></a>应用启动流程</h4><h5 id="Launcher请求AMS阶段"><a href="#Launcher请求AMS阶段" class="headerlink" title="Launcher请求AMS阶段"></a>Launcher请求AMS阶段</h5><p><img src="/2020/08/07/AMS/2021-08-16_lancher_ams.png"></p>
]]></content>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>Accessibility</title>
    <url>/2017/08/09/Accessibility/</url>
    <content><![CDATA[<p> 先上官网地址  <a href="https://developer.android.com/guide/topics/ui/accessibility/services.html">https://developer.android.com/guide/topics/ui/accessibility/services.html</a><br>下面的是例子  <a href="https://developer.android.com/training/accessibility/index.html">https://developer.android.com/training/accessibility/index.html</a></p>
<p>然后是codelab 看看 <a href="https://codelabs.developers.google.com/codelabs/developing-android-a11y-service/index.html?index=../../index#0">https://codelabs.developers.google.com/codelabs/developing-android-a11y-service/index.html?index=..%2F..%2Findex#0</a></p>
<p>这是codelab github上的地址   <a href="https://github.com/googlecodelabs/android-accessibility">https://github.com/googlecodelabs/android-accessibility</a><br>一、简单实现<br>1、创建一个   MyAccessibilityService类  继承 AccessibilityService</p>
<p>…</p>
<pre><code>public class MyAccessibilityService extends AccessibilityService &#123;

 @Override
 public void onAccessibilityEvent(AccessibilityEvent event) &#123;
 &#125;

 @Override
 public void onInterrupt() &#123;
&#125;
</code></pre>
<p>   }<br>…</p>
<p>2、创建一个values下创建XML文件夹</p>
<p><accessibility-service android:accessibilityeventtypes="typeViewClicked|typeViewFocused" android:packagenames="com.example.android.myFirstApp, com.example.android.mySecondApp" android:accessibilityfeedbacktype="feedbackSpoken" android:notificationtimeout="100" android:settingsactivity="com.example.android.apis.accessibility.TestBackActivity" android:canretrievewindowcontent="true"></accessibility-service></p>
<p>3、 实现 onServiceConnected()</p>
<pre><code>@Override
public void onServiceConnected() &#123;
     // Set the type of events that this service wants to listen to.  Others
     // won&#39;t be passed to this service.
     info.eventTypes = AccessibilityEvent.TYPE_VIEW_CLICKED |
            AccessibilityEvent.TYPE_VIEW_FOCUSED;

     // If you only want this service to work with specific applications, set their
    // package names here.  Otherwise, when the service is activated, it will listen
    // to events from all applications.
    info.packageNames = new String[]
            &#123;&quot;com.example.android.myFirstApp&quot;, &quot;com.example.android.mySecondApp&quot;&#125;;

    // Set the type of feedback your service will provide.
    info.feedbackType = AccessibilityServiceInfo.FEEDBACK_SPOKEN;

    // Default services are invoked only if no package-specific ones are present
    // for the type of AccessibilityEvent generated.  This service *is*
    // application-specific, so the flag isn&#39;t necessary.  If this was a
    // general-purpose service, it would be worth considering setting the
    // DEFAULT flag.

    // info.flags = AccessibilityServiceInfo.DEFAULT;

     info.notificationTimeout = 100;

     this.setServiceInfo(info);
     Log.i(&quot;test&quot;,&quot;测试&quot;);
&#125;
</code></pre>
<p>4、实现 onAccessibilityEvent方法</p>
<pre><code>@Override
public void onAccessibilityEvent(AccessibilityEvent event) &#123;
 final int eventType = event.getEventType();
 String eventText = null;
 switch(eventType) &#123;
    case AccessibilityEvent.TYPE_VIEW_CLICKED:
        eventText = &quot;Focused: &quot;;
        break;
    case AccessibilityEvent.TYPE_VIEW_FOCUSED:
        eventText = &quot;Focused: &quot;;
        break;
 &#125;

 eventText = eventText + event.getContentDescription();

 // Do something nifty with this text, like speak the composed string
// back to the user.
 speakToUser(eventText);
&#125;
...
</code></pre>
<p>然后就可以开启辅助功能，看下log</p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>ActivityLayout</title>
    <url>/2020/05/08/ActivityLayout/</url>
    <content><![CDATA[<p><a href="https://mp.weixin.qq.com/s/ii07I8Cy80MqjsqKkns_WQ">https://mp.weixin.qq.com/s/ii07I8Cy80MqjsqKkns_WQ</a></p>
<p><a href="https://www.jianshu.com/p/b5b1b8e1747f">https://www.jianshu.com/p/b5b1b8e1747f</a></p>
]]></content>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>ActivityRender01</title>
    <url>/2020/03/22/ActivityRender01/</url>
    <content><![CDATA[<p><a href="https://juejin.im/post/5baf275f5188255c9a7740ba">https://juejin.im/post/5baf275f5188255c9a7740ba</a></p>
<p><a href="https://github.com/SusionSuc/AdvancedAndroid/blob/master/AndroidFramework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%E8%A7%86%E5%9B%BE%E5%B1%82%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/README.md">https://github.com/SusionSuc/AdvancedAndroid/blob/master/AndroidFramework%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/Android%E8%A7%86%E5%9B%BE%E5%B1%82%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/README.md</a></p>
<p><a href="https://blog.csdn.net/luoshengyang/article/details/8170307">https://blog.csdn.net/luoshengyang/article/details/8170307</a></p>
<p><a href="https://juejin.im/post/6844904146227691527">https://juejin.im/post/6844904146227691527</a></p>
<p><a href="https://mp.weixin.qq.com/s/sKJCG1AjhIRRQL9tQTrLZg">https://mp.weixin.qq.com/s/sKJCG1AjhIRRQL9tQTrLZg</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>Activity</tag>
      </tags>
  </entry>
  <entry>
    <title>ActivityStart02</title>
    <url>/2020/01/13/ActivityStart02/</url>
    <content><![CDATA[<h5 id="Application-OnCreate"><a href="#Application-OnCreate" class="headerlink" title="Application OnCreate()"></a>Application OnCreate()</h5><p><img src="/2020/01/13/ActivityStart02/ActivityThradmain1.png" alt="ActivityThradmain1"></p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">		   Looper.<span class="built_in">prepareMainLooper</span>();		<span class="comment">//创建消息循环</span></span><br><span class="line"></span><br><span class="line">        ActivityThread thread = <span class="keyword">new</span> <span class="built_in">ActivityThread</span>();  </span><br><span class="line">        thread.<span class="built_in">attach</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (sMainThreadHandler == null) &#123;</span><br><span class="line">            sMainThreadHandler = thread.<span class="built_in">getHandler</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">            Looper.<span class="built_in">myLooper</span>().<span class="built_in">setMessageLogging</span>(<span class="keyword">new</span></span><br><span class="line">                    <span class="built_in">LogPrinter</span>(Log.DEBUG, <span class="string">&quot;ActivityThread&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// End of event ActivityThreadMain.</span></span><br><span class="line">        Trace.<span class="built_in">traceEnd</span>(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">        Looper.<span class="built_in">loop</span>();					<span class="comment">//使当前进程进入消息循环</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里我们就不再详细分析prepareMainLooper和loop方法，其主要功能就是准备好主线程的Looper以及消息队列，最后再开启主线程的消息循环。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void attach(boolean system) &#123;</span><br><span class="line"></span><br><span class="line"> IActivityManager mgr = <span class="module-access"><span class="module"><span class="identifier">ActivityManagerNative</span>.</span></span>get<span class="constructor">Default()</span>; <span class="comment">//获得ApplicationThreadNative</span></span><br><span class="line"> 																									<span class="comment">//代理类ActivityManagerProxy </span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mgr.attach<span class="constructor">Application(<span class="params">mAppThread</span>)</span>;</span><br><span class="line">            &#125; catch (RemoteException ex) &#123;</span><br><span class="line">                throw ex.rethrow<span class="constructor">FromSystemServer()</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// Watch for getting close to heap limit.</span></span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">BinderInternal</span>.</span></span>add<span class="constructor">GcWatcher(<span class="params">new</span> Runnable()</span> &#123;</span><br><span class="line">                @Override public void run<span class="literal">()</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!mSomeActivitiesChanged) &#123;</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Runtime runtime = <span class="module-access"><span class="module"><span class="identifier">Runtime</span>.</span></span>get<span class="constructor">Runtime()</span>;</span><br><span class="line">                    long dalvikMax = runtime.max<span class="constructor">Memory()</span>;</span><br><span class="line">                    long dalvikUsed = runtime.total<span class="constructor">Memory()</span> - runtime.free<span class="constructor">Memory()</span>;</span><br><span class="line">                    <span class="keyword">if</span> (dalvikUsed &gt; ((<span class="number">3</span>*dalvikMax)/<span class="number">4</span>)) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (DEBUG_MEMORY_TRIM) <span class="module-access"><span class="module"><span class="identifier">Slog</span>.</span></span>d(TAG, <span class="string">&quot;Dalvik max=&quot;</span> + (dalvikMax/<span class="number">1024</span>)</span><br><span class="line">                                + <span class="string">&quot; total=&quot;</span> + (runtime.total<span class="constructor">Memory()</span>/<span class="number">1024</span>)</span><br><span class="line">                                + <span class="string">&quot; used=&quot;</span> + (dalvikUsed/<span class="number">1024</span>));</span><br><span class="line">                        mSomeActivitiesChanged = <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            mgr.release<span class="constructor">SomeActivities(<span class="params">mAppThread</span>)</span>;</span><br><span class="line">                        &#125; catch (RemoteException e) &#123;</span><br><span class="line">                            throw e.rethrow<span class="constructor">FromSystemServer()</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到由于在ActivityThread的attach中我们传入的是false，故在attach方法中将执行!system里的代码，通过调用AMS的attachApplication来将ActivityThread中的内部类ApplicationThread对象绑定至AMS，这样AMS就可以通过这个代理对象 来控制应用进程。接着为这个进程添加垃圾回收观察者，每当系统触发垃圾回收的时候就在run方法中计算应用使用了多大的内存，如果超过总量的3/4就尝试释放内存。</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="title">public</span> void attachApplication(<span class="type">IApplicationThread</span> app) throws <span class="type">RemoteException</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">Parcel</span> <span class="class"><span class="keyword">data</span> = <span class="type">Parcel</span>.obtain();</span></span><br><span class="line">    <span class="type">Parcel</span> reply = <span class="type">Parcel</span>.obtain();</span><br><span class="line">    <span class="class"><span class="keyword">data</span>.writeInterfaceToken(<span class="type">IActivityManager</span>.<span class="title">descriptor</span>);</span></span><br><span class="line">    <span class="class"><span class="keyword">data</span>.writeStrongBinder(<span class="title">app</span>.<span class="title">asBinder</span>());</span></span><br><span class="line">    mRemote.transact(<span class="type">ATTACH_APPLICATION_TRANSACTION</span>, <span class="class"><span class="keyword">data</span>, reply, 0);</span></span><br><span class="line">    reply.readException();</span><br><span class="line">    <span class="class"><span class="keyword">data</span>.recycle();</span></span><br><span class="line">    reply.recycle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">boolean</span> onTransact(<span class="keyword">int</span> code, Parcel data, Parcel reply, <span class="keyword">int</span> flags)</span><br><span class="line">        <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">    <span class="keyword">switch</span> (code) &#123;</span><br><span class="line">    	  <span class="keyword">case</span> ATTACH_APPLICATION_TRANSACTION: &#123;</span><br><span class="line">            data.enforceInterface(IActivityManager.descriptor);</span><br><span class="line">            IApplicationThread app = ApplicationThreadNative.asInterface(</span><br><span class="line">                    data.readStrongBinder()); <span class="comment">//得到代理类ApplicationThreadProxy </span></span><br><span class="line">            <span class="keyword">if</span> (app != <span class="keyword">null</span>) &#123;</span><br><span class="line">                attachApplication(app);</span><br><span class="line">            &#125;</span><br><span class="line">            reply.writeNoException();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public final void attach<span class="constructor">Application(IApplicationThread <span class="params">thread</span>)</span> &#123;</span><br><span class="line">    synchronized (this) &#123;</span><br><span class="line">        <span class="built_in">int</span> callingPid = <span class="module-access"><span class="module"><span class="identifier">Binder</span>.</span></span>get<span class="constructor">CallingPid()</span>;</span><br><span class="line">        final long origId = <span class="module-access"><span class="module"><span class="identifier">Binder</span>.</span></span>clear<span class="constructor">CallingIdentity()</span>;</span><br><span class="line">        attach<span class="constructor">ApplicationLocked(<span class="params">thread</span>, <span class="params">callingPid</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Binder</span>.</span></span>restore<span class="constructor">CallingIdentity(<span class="params">origId</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​    将应用进程的ApplicationThread对象绑定到AMS，即AMS获得ApplicationThread的代理对象 </p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">private final boolean attachApplicationLocked(IApplicationThread thread,</span><br><span class="line">        int pid) &#123;</span><br><span class="line">        	<span class="comment">//创建Application</span></span><br><span class="line">          thread.bindApplication(processName, appInfo, providers, <span class="keyword">app</span>.instrumentationClass,</span><br><span class="line">                    profilerInfo, <span class="keyword">app</span>.instrumentationArguments, <span class="keyword">app</span>.instrumentationWatcher,</span><br><span class="line">                    <span class="keyword">app</span>.instrumentationUiAutomationConnection, testMode,</span><br><span class="line">                    mBinderTransactionTrackingEnabled, enableTrackAllocation,</span><br><span class="line">                    isRestrictedBackupMode || !normalMode, <span class="keyword">app</span>.persistent,</span><br><span class="line">                    new Configuration(mConfiguration), <span class="keyword">app</span>.compat,</span><br><span class="line">                    getCommonServicesLocked(<span class="keyword">app</span>.isolated),</span><br><span class="line">                                   mCoreSettingsObserver.getCoreSettingsLocked());</span><br><span class="line">        </span><br><span class="line">         <span class="comment">//创建Activity</span></span><br><span class="line">         <span class="keyword">if</span> (mStackSupervisor.attachApplicationLocked(<span class="keyword">app</span>)) &#123;</span><br><span class="line">                    didSomething = true;</span><br><span class="line">         &#125;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="create-Application"><a href="#create-Application" class="headerlink" title="create Application"></a>create Application</h5><p><img src="/2020/01/13/ActivityStart02/ActivityThradmain3.png" alt="ActivityThradmain3"></p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">@<span class="type">Override</span></span><br><span class="line"><span class="title">public</span> final void bindApplication(<span class="type">String</span> packageName, <span class="type">ApplicationInfo</span> info,</span><br><span class="line">        <span class="type">List</span>&lt;<span class="type">ProviderInfo</span>&gt; providers, <span class="type">ComponentName</span> testName, <span class="type">ProfilerInfo</span> profilerInfo,</span><br><span class="line">        <span class="type">Bundle</span> testArgs, <span class="type">IInstrumentationWatcher</span> testWatcher,</span><br><span class="line">        <span class="type">IUiAutomationConnection</span> uiAutomationConnection, int debugMode,</span><br><span class="line">        boolean enableBinderTracking, boolean trackAllocation, boolean restrictedBackupMode,</span><br><span class="line">        boolean persistent, <span class="type">Configuration</span> config, <span class="type">CompatibilityInfo</span> compatInfo,</span><br><span class="line">        <span class="type">Map</span>&lt;<span class="type">String</span>, <span class="type">IBinder</span>&gt; services, <span class="type">Bundle</span> coreSettings) throws <span class="type">RemoteException</span> &#123;</span><br><span class="line">   </span><br><span class="line">    <span class="class"><span class="keyword">data</span>.writeInt(<span class="title">restrictedBackupMode</span> ? 1 : 0);</span></span><br><span class="line">    <span class="class"><span class="keyword">data</span>.writeInt(<span class="title">persistent</span> ? 1 : 0);</span></span><br><span class="line">    config.writeToParcel(<span class="class"><span class="keyword">data</span>, 0);</span></span><br><span class="line">    compatInfo.writeToParcel(<span class="class"><span class="keyword">data</span>, 0);</span></span><br><span class="line">    <span class="class"><span class="keyword">data</span>.writeMap(<span class="title">services</span>);</span></span><br><span class="line">    <span class="class"><span class="keyword">data</span>.writeBundle(<span class="title">coreSettings</span>);</span></span><br><span class="line">    mRemote.transact(<span class="type">BIND_APPLICATION_TRANSACTION</span>, <span class="class"><span class="keyword">data</span>, null,</span></span><br><span class="line">            <span class="type">IBinder</span>.<span class="type">FLAG_ONEWAY</span>);</span><br><span class="line">    <span class="class"><span class="keyword">data</span>.recycle();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"> @<span class="type">Override</span></span><br><span class="line">    public boolean onTransact(int code, <span class="type">Parcel</span> <span class="class"><span class="keyword">data</span>, <span class="type">Parcel</span> reply, int flags)</span></span><br><span class="line">            throws <span class="type">RemoteException</span> &#123;</span><br><span class="line">        switch (code) &#123;</span><br><span class="line">					<span class="keyword">case</span> <span class="type">BIND_APPLICATION_TRANSACTION</span>:</span><br><span class="line"></span><br><span class="line">   					 boolean trackAllocation = <span class="class"><span class="keyword">data</span>.readInt() != 0;</span></span><br><span class="line">    boolean restrictedBackupMode = (<span class="class"><span class="keyword">data</span>.readInt() != 0);</span></span><br><span class="line">    boolean persistent = (<span class="class"><span class="keyword">data</span>.readInt() != 0);</span></span><br><span class="line">    <span class="type">Configuration</span> config = <span class="type">Configuration</span>.<span class="type">CREATOR</span>.createFromParcel(<span class="class"><span class="keyword">data</span>);</span></span><br><span class="line">    <span class="type">CompatibilityInfo</span> compatInfo = <span class="type">CompatibilityInfo</span>.<span class="type">CREATOR</span>.createFromParcel(<span class="class"><span class="keyword">data</span>);</span></span><br><span class="line">    <span class="type">HashMap</span>&lt;<span class="type">String</span>, <span class="type">IBinder</span>&gt; services = <span class="class"><span class="keyword">data</span>.readHashMap(<span class="title">null</span>);</span></span><br><span class="line">    <span class="type">Bundle</span> coreSettings = <span class="class"><span class="keyword">data</span>.readBundle();</span></span><br><span class="line">    bindApplication(packageName, info, providers, testName, profilerInfo, testArgs,</span><br><span class="line">            testWatcher, uiAutomationConnection, testMode, enableBinderTracking,</span><br><span class="line">            trackAllocation, restrictedBackupMode, persistent, config, compatInfo, services,</span><br><span class="line">            coreSettings);</span><br><span class="line">    return true;</span><br><span class="line">	</span><br><span class="line">	      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> final <span class="literal">void</span> bindApplication(<span class="built_in">String</span> processName, ApplicationInfo appInfo,</span><br><span class="line">        <span class="built_in">List</span>&lt;ProviderInfo&gt; providers, ComponentName instrumentationName,</span><br><span class="line">        ProfilerInfo profilerInfo, Bundle instrumentationArgs,</span><br><span class="line">        IInstrumentationWatcher instrumentationWatcher,</span><br><span class="line">        IUiAutomationConnection instrumentationUiConnection, int debugMode,</span><br><span class="line">        <span class="built_in">boolean</span> enableBinderTracking, <span class="built_in">boolean</span> trackAllocation,</span><br><span class="line">        <span class="built_in">boolean</span> isRestrictedBackupMode, <span class="built_in">boolean</span> persistent, Configuration config,</span><br><span class="line">        CompatibilityInfo compatInfo, <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, IBinder&gt; services, Bundle coreSettings) &#123;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">data</span>.restrictedBackupMode = isRestrictedBackupMode;</span><br><span class="line">    <span class="built_in">data</span>.persistent = persistent;</span><br><span class="line">    <span class="built_in">data</span>.config = config;</span><br><span class="line">    <span class="built_in">data</span>.compatInfo = compatInfo;</span><br><span class="line">    <span class="built_in">data</span>.initProfilerInfo = profilerInfo;</span><br><span class="line">    sendMessage(H.BIND_APPLICATION, <span class="built_in">data</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">case BIND_APPLICATION:</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Trace</span>.</span></span>trace<span class="constructor">Begin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">&quot;bindApplication&quot;</span>)</span>;</span><br><span class="line">    AppBindData data = (AppBindData)msg.obj;</span><br><span class="line">    handle<span class="constructor">BindApplication(<span class="params">data</span>)</span>;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Trace</span>.</span></span>trace<span class="constructor">End(Trace.TRACE_TAG_ACTIVITY_MANAGER)</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void handle<span class="constructor">BindApplication(AppBindData <span class="params">data</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// If the app is being launched for full backup or restore, bring it up in</span></span><br><span class="line">            <span class="comment">// a restricted environment with the base application class.</span></span><br><span class="line">            Application app = data.info.make<span class="constructor">Application(<span class="params">data</span>.<span class="params">restrictedBackupMode</span>, <span class="params">null</span>)</span>;</span><br><span class="line">            mInitialApplication = app;</span><br><span class="line">	</span><br><span class="line">					</span><br><span class="line">					  mInstrumentation.call<span class="constructor">ApplicationOnCreate(<span class="params">app</span>)</span>; <span class="comment">//调用Application的create方法</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Application makeApplication(<span class="built_in">boolean</span> forceDefaultAppClass,</span><br><span class="line">        Instrumentation instrumentation) &#123;</span><br><span class="line">    <span class="keyword">if</span> (mApplication != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> mApplication;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">        Application app = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">String</span> appClass = mApplicationInfo.className;</span><br><span class="line">        <span class="keyword">if</span> (forceDefaultAppClass || (appClass == <span class="literal">null</span>)) &#123;</span><br><span class="line">            appClass = <span class="string">&quot;android.app.Application&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            java.lang.ClassLoader cl = getClassLoader();</span><br><span class="line">            <span class="keyword">if</span> (!mPackageName.equals(<span class="string">&quot;android&quot;</span>)) &#123;</span><br><span class="line">                Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER,</span><br><span class="line">                        <span class="string">&quot;initializeJavaContextClassLoader&quot;</span>);</span><br><span class="line">                initializeJavaContextClassLoader();</span><br><span class="line">                Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">            &#125;</span><br><span class="line">            ContextImpl appContext = ContextImpl.createAppContext(mActivityThread, <span class="built_in">this</span>);</span><br><span class="line">            app = mActivityThread.mInstrumentation.newApplication(</span><br><span class="line">                    cl, appClass, appContext);</span><br><span class="line">            appContext.setOuterContext(app);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><img src="/2020/01/13/ActivityStart02/ActivityThradmain2.png" alt="ActivityThradmain2"></p>
<h5 id="LaunchActivity"><a href="#LaunchActivity" class="headerlink" title="LaunchActivity"></a>LaunchActivity</h5><figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">// we use token <span class="keyword">to</span> identify this activity without having <span class="keyword">to</span> send the</span><br><span class="line">        // activity itself back <span class="keyword">to</span> the activity manager. (matters more with ipc)</span><br><span class="line">        @Override</span><br><span class="line">   public final void scheduleLaunchActivity(Intent intent, IBinder token, int ident,</span><br><span class="line">                ActivityInfo info, Configuration curConfig, Configuration overrideConfig,</span><br><span class="line">                CompatibilityInfo compatInfo, String referrer, IVoiceInteractor voiceInteractor,</span><br><span class="line">                int procState, Bundle <span class="keyword">state</span>, PersistableBundle persistentState,</span><br><span class="line">                List<span class="variable">&lt;ResultInfo&gt;</span> pendingResults, List<span class="variable">&lt;ReferrerIntent&gt;</span> pendingNewIntents,</span><br><span class="line">                boolean notResumed, boolean isForward, ProfilerInfo profilerInfo) &#123;</span><br><span class="line">                </span><br><span class="line">            ActivityClientRecord r = new ActivityClientRecord();</span><br><span class="line">            r.token = token;</span><br><span class="line">            r.ident = ident;</span><br><span class="line">            r.intent = intent;</span><br><span class="line">            r.referrer = referrer;</span><br><span class="line">            r.voiceInteractor = voiceInteractor;</span><br><span class="line">            r.activityInfo = info;</span><br><span class="line">            r.compatInfo = compatInfo;</span><br><span class="line">            r.<span class="keyword">state</span> = <span class="keyword">state</span>;</span><br><span class="line">            r.persistentState = persistentState;</span><br><span class="line"></span><br><span class="line">            r.pendingResults = pendingResults;</span><br><span class="line">            r.pendingIntents = pendingNewIntents;</span><br><span class="line"></span><br><span class="line">            r.startsNotResumed = notResumed;</span><br><span class="line">            r.isForward = isForward;</span><br><span class="line"></span><br><span class="line">            r.profilerInfo = profilerInfo;</span><br><span class="line"></span><br><span class="line">            r.overrideConfig = overrideConfig;</span><br><span class="line">            updatePendingConfiguration(curConfig);</span><br><span class="line"></span><br><span class="line">            sendMessage(H.LAUNCH_ACTIVITY, r);</span><br><span class="line">                </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (DEBUG_MESSAGES) Slog.v(TAG, <span class="string">&quot;&gt;&gt;&gt; handling: &quot;</span> + codeToString(msg.what));</span><br><span class="line">    <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">        <span class="keyword">case</span> LAUNCH_ACTIVITY: &#123;</span><br><span class="line">            Trace.traceBegin(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">&quot;activityStart&quot;</span>);</span><br><span class="line">            <span class="keyword">final</span> ActivityClientRecord r = (ActivityClientRecord) msg.obj;</span><br><span class="line"></span><br><span class="line">            r.packageInfo = getPackageInfoNoCheck(</span><br><span class="line">                    r.activityInfo.applicationInfo, r.compatInfo);</span><br><span class="line">            handleLaunchActivity(r, <span class="keyword">null</span>, <span class="string">&quot;LAUNCH_ACTIVITY&quot;</span>);</span><br><span class="line">            Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">        &#125; <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="literal">void</span> handleLaunchActivity(ActivityClientRecord r, Intent customIntent, <span class="built_in">String</span> reason) &#123;</span><br><span class="line">  <span class="comment">//通过Activity所在的应用程序信息及该Activity对应的CompatibilityInfo信息从PMS服务中查询当前Activity的包信息  </span></span><br><span class="line">    ActivityInfo aInfo = r.activityInfo;</span><br><span class="line">    <span class="keyword">if</span> (r.packageInfo == <span class="built_in">null</span>) &#123;</span><br><span class="line">        r.packageInfo = getPackageInfo(aInfo.applicationInfo, r.compatInfo,</span><br><span class="line">                Context.CONTEXT_INCLUDE_CODE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获取当前Activity的组件信息  </span></span><br><span class="line">    ComponentName component = r.intent.getComponent();</span><br><span class="line">    <span class="keyword">if</span> (component == <span class="built_in">null</span>) &#123;</span><br><span class="line">        component = r.intent.resolveActivity(</span><br><span class="line">            mInitialApplication.getPackageManager());</span><br><span class="line">        r.intent.setComponent(component);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//packageName为启动Activity的包名，targetActivity为Activity的类名  </span></span><br><span class="line">    <span class="keyword">if</span> (r.activityInfo.targetActivity != <span class="built_in">null</span>) &#123;</span><br><span class="line">        component = <span class="literal">new</span> ComponentName(r.activityInfo.packageName,</span><br><span class="line">                r.activityInfo.targetActivity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//通过类反射方式加载即将启动的Activity</span></span><br><span class="line">    Activity activity = <span class="built_in">null</span>;</span><br><span class="line">    try &#123;</span><br><span class="line">        java.lang.ClassLoader cl = r.packageInfo.getClassLoader();</span><br><span class="line">        activity = mInstrumentation.newActivity(</span><br><span class="line">                cl, component.getClassName(), r.intent);</span><br><span class="line">        StrictMode.incrementExpectedActivityCount(activity.getClass());</span><br><span class="line">        r.intent.setExtrasClassLoader(cl);</span><br><span class="line">        r.intent.prepareToEnterProcess();</span><br><span class="line">        <span class="keyword">if</span> (r.state != <span class="built_in">null</span>) &#123;</span><br><span class="line">            r.state.setClassLoader(cl);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="params">...</span><span class="params">...</span></span><br><span class="line">    try &#123;</span><br><span class="line">        <span class="comment">//通过单例模式为应用程序进程创建Application对象  </span></span><br><span class="line">        Application app = r.packageInfo.makeApplication(<span class="literal">false</span>, mInstrumentation);</span><br><span class="line"></span><br><span class="line">       <span class="params">...</span><span class="params">...</span></span><br><span class="line">        <span class="keyword">if</span> (activity != <span class="built_in">null</span>) &#123;</span><br><span class="line">            <span class="comment">//为当前Activity创建上下文对象ContextImpl  </span></span><br><span class="line">            Context appContext = createBaseContextForActivity(r, activity);</span><br><span class="line">            <span class="params">...</span><span class="params">...</span></span><br><span class="line">            <span class="comment">//将当前启动的Activity和上下文ContextImpl、Application绑定</span></span><br><span class="line">            activity.attach(appContext, this, getInstrumentation(), r.token,</span><br><span class="line">                    r.ident, app, r.intent, r.activityInfo, title, r.<span class="keyword">parent</span>,</span><br><span class="line">                    r.embeddedID, r.lastNonConfigurationInstances, config,</span><br><span class="line">                    r.<span class="keyword">referrer</span>, r.voiceInteractor, window);</span><br><span class="line"></span><br><span class="line">            <span class="params">...</span><span class="params">...</span></span><br><span class="line">            <span class="comment">//将Activity保存到ActivityClientRecord中，ActivityClientRecord为Activity在应用程序进程中的描述符  </span></span><br><span class="line">            r.activity = activity;</span><br><span class="line">            activity.mCalled = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (r.isPersistable()) &#123;</span><br><span class="line">                mInstrumentation.callActivityOnCreate(activity, r.state, r.persistentState);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mInstrumentation.callActivityOnCreate(activity, r.state);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="params">...</span><span class="params">...</span></span><br><span class="line">            <span class="comment">//生命周期onStart、onresume</span></span><br><span class="line">            <span class="keyword">if</span> (!r.activity.mFinished) &#123;</span><br><span class="line">                activity.performStart();</span><br><span class="line">                r.stopped = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ActivityThread的成员变量mActivities保存了当前应用程序进程中的所有Activity的描述符</span></span><br><span class="line">            mActivities.put(r.token, r);</span><br><span class="line">            <span class="params">...</span><span class="params">...</span></span><br><span class="line">    <span class="keyword">return</span> activity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上述方法中将调用performLaunchActivity来启动Activity，如下</p>
<p>应用程序进程通过performLaunchActivity函数将即将要启动的Activity加载到当前进程空间来，同时为启动Activity做准备。 [ActivityThread.java #performLaunchActivity()]</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Activity performLaunchActivity(ActivityClientRecord r, Intent customIntent) &#123;</span><br><span class="line">		 	<span class="comment">//用类加载器来创建该Activity的实例</span></span><br><span class="line">     activity = mInstrumentation.<span class="keyword">new</span><span class="type">Activity</span>(</span><br><span class="line">                    cl, component.getClassName(), r.intent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> Activity <span class="keyword">new</span><span class="type">Activity</span>(ClassLoader cl, <span class="keyword">String</span> className,</span><br><span class="line">            Intent intent)</span><br><span class="line">            throws InstantiationException, IllegalAccessException,</span><br><span class="line">            ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">return</span> (Activity)cl.loadClass(className).<span class="keyword">new</span><span class="type">Instance</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>





<h5 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h5><p>Application Activity创建流程 </p>
<p>Launch app启动问题 </p>
<p><a href="https://juejin.im/post/5baf275f5188255c9a7740ba">https://juejin.im/post/5baf275f5188255c9a7740ba</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>AndroidSource</title>
    <url>/2018/07/25/AndroidSource/</url>
    <content><![CDATA[<p><a href="https://www.bilibili.com/video/BV15W411L7Lc?p=9">https://www.bilibili.com/video/BV15W411L7Lc?p=9</a></p>
<h5 id="源码调试"><a href="#源码调试" class="headerlink" title="源码调试"></a>源码调试</h5><p>要学习Android源码需要编译一份，然后安装要求导入AndroidStudio,可以参考:<br><a href="http://blog.csdn.net/huaiyiheyuan/article/details/52069122">http://blog.csdn.net/huaiyiheyuan/article/details/52069122</a></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Application</span> <span class="keyword">extends</span> <span class="title">ContextWrapper</span> <span class="title">implements</span> <span class="title">ComponentCallbacks2</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>当我点开父类ContextWrapper后，发现引用的是jar立面的class文件，既然有源码这肯定不是我所需要的，<br>可以这要操作:Project Structure-&gt;Dependencies(可以看到很多jar依赖删掉)-&gt;　＋JARS And Dierctories -&gt;添加源码要关联的frameworks 、packages…</p>
<ol>
<li>新建JDK1.8　选择openjdk8</li>
</ol>
<p>　<img src="/2018/07/25/AndroidSource/DeepinScrot_aosp1.png" alt="新建JDK"></p>
<ol start="2">
<li><p>删除依赖</p>
<p>　<img src="/2018/07/25/AndroidSource/DeepinScrot_aosp5.png" alt="删除依赖"></p>
</li>
</ol>
<p>3.　选择需要的包</p>
<p><img src="/2018/07/25/AndroidSource/DeepinScrot_aosp.png" alt="选择包"></p>
<p>4.　这一步要衡量一下，转为gradle项目后，project structure下面就没有moudles了<br> <img src="/2018/07/25/AndroidSource/DeepinScrot_aosp2.png" alt="添加包"><br>    这个设置后麻烦可以大了，后面不得不删除了android.ipr、android.iws、android.iml这三个文件重新生成</p>
<p>５.　跳转到源码<br>　　找到pacages-&gt; apps-&gt;Settings　<code>public class SettingsDrawerActivity extends Activity &#123;</code></p>
<p>  点开Activity发现还是跳转到jar的内容<br>  <img src="/2018/07/25/AndroidSource/DeepinScrot_aosp6.png" alt="跳转成功"> 点击Ok后再测试下</p>
<p>  <img src="/2018/07/25/AndroidSource/DeepinScrot_aosp7.png" alt="验证"><br>  终于成功了</p>
<p>** 哈哈　然后就可以愉快的调试源码了<br>**</p>
<p>/home/jon/noteforme.github.io/public/2017/08/10/DesignParrerns</p>
<p><a href="https://cloud.tencent.com/developer/news/277549">https://cloud.tencent.com/developer/news/277549</a></p>
<ul>
<li>Activity启动过程</li>
</ul>
<p> 对应用程序Activity进行编译和打包</p>
<pre><code>  /home/jon/桌面/LaoLuo/chapter-7/src/packages/experimental/Activity
  make snod
  emulator
</code></pre>
<p>然后查看activity信息，在这里通过源码里面的 adb</p>
<pre><code>cd  /home/jon/AOSP/out/host/linux-x86/bin
adb shell dumpsys activity
</code></pre>
<blockquote>
</blockquote>
<img src="https://img-blog.csdn.net/20170123173332254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaXRhY2hpODU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="zoom: 67%;">



<p>1.Android系统架构<br>Android系统架构分为五层，从上到下依次是应用层、应用框架层、系统运行库层、硬件抽象层和Linux内核层。</p>
<p>应用层<br>系统内置的应用程序以及非系统级的应用程序都是属于应用层。负责与用户进行直接交互，通常都是用Java进行开发的。</p>
<p>应用框架层（Java Framework)<br>应用框架层为开发人员提供了可以开发应用程序所需要的API，我们平常开发应用程序都是调用的这一层所提供的API，当然也包括系统的应用。这一层的是由Java代码编写的，可以称为Java Framework。下面来看这一层所提供的主要的组件。</p>
<p>名称    功能描述<br>Activity Manager(活动管理器)    管理各个应用程序生命周期以及通常的导航回退功能<br>Location Manager(位置管理器)    提供地理位置以及定位功能服务<br>Package Manager(包管理器)    管理所有安装在Android系统中的应用程序<br>Notification Manager(通知管理器)    使得应用程序可以在状态栏中显示自定义的提示信息<br>Resource Manager（资源管理器）    提供应用程序使用的各种非代码资源，如本地化字符串、图片、布局文件、颜色文件等<br>Telephony Manager(电话管理器)    管理所有的移动设备功能<br>Window Manager（窗口管理器）    管理所有开启的窗口程序<br>Content Providers（内容提供器）    使得不同应用程序之间可以共享数据<br>View System（视图系统）    构建应用程序的基本组件<br>表1<br>系统运行库层（Native)<br>系统运行库层分为两部分，分别是C/C++程序库和Android运行时库。下面分别来介绍它们。</p>
<p>1.C/C++程序库<br>C/C++程序库能被Android系统中的不同组件所使用，并通过应用程序框架为开发者提供服务，主要的C/C++程序库如下表2所示。</p>
<p>名称    功能描述<br>OpenGL ES    3D绘图函数库<br>Libc    从BSD继承来的标准C系统函数库，专门为基于嵌入式Linux的设备定制<br>Media Framework    多媒体库，支持多种常用的音频、视频格式录制和回放。<br>SQLite    轻型的关系型数据库引擎<br>SGL    底层的2D图形渲染引擎<br>SSL    安全套接层，是为网络通信提供安全及数据完整性的一种安全协议<br>FreeType    可移植的字体引擎，它提供统一的接口来访问多种字体格式文件<br>表2<br>2.Android运行时库<br>运行时库又分为核心库和ART(5.0系统之后，Dalvik虚拟机被ART取代)。核心库提供了Java语言核心库的大多数功能，这样开发者可以使用Java语言来编写Android应用。相较于JVM，Dalvik虚拟机是专门为移动设备定制的，允许在有限的内存中同时运行多个虚拟机的实例，并且每一个Dalvik 应用作为一个独立的Linux 进程执行。独立的进程可以防止在虚拟机崩溃的时候所有程序都被关闭。而替代Dalvik虚拟机的ART 的机制与Dalvik 不同。在Dalvik下，应用每次运行的时候，字节码都需要通过即时编译器转换为机器码，这会拖慢应用的运行效率，而在ART 环境中，应用在第一次安装的时候，字节码就会预先编译成机器码，使其成为真正的本地应用。</p>
<p>硬件抽象层（HAL)<br>硬件抽象层是位于操作系统内核与硬件电路之间的接口层，其目的在于将硬件抽象化，为了保护硬件厂商的知识产权，它隐藏了特定平台的硬件接口细节，为操作系统提供虚拟硬件平台，使其具有硬件无关性，可在多种平台上进行移植。 从软硬件测试的角度来看，软硬件的测试工作都可分别基于硬件抽象层来完成，使得软硬件测试工作的并行进行成为可能。通俗来讲，就是将控制硬件的动作放在硬件抽象层中。</p>
<p>Linux内核层<br>Android 的核心系统服务基于Linux 内核，在此基础上添加了部分Android专用的驱动。系统的安全性、内存管理、进程管理、网络协议栈和驱动模型等都依赖于该内核。<br>Android系统的五层架构就讲到这，了解以上的知识对以后分析系统源码有很大的帮助。</p>
<p>2.Android系统源码目录<br>我们要先了解Android系统源码目录，为后期源码学习打下基础。关于源码的阅读，你可以访问<a href="http://androidxref.com/%E6%9D%A5%E9%98%85%E8%AF%BB%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E3%80%82%E5%BD%93%E7%84%B6%EF%BC%8C%E6%9C%80%E5%A5%BD%E6%98%AF%E5%B0%86%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E3%80%82%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E9%95%9C%E5%83%8F%E7%AB%99%E6%8F%90%E4%BE%9B%E7%9A%84Android">http://androidxref.com/来阅读系统源码。当然，最好是将源码下载下来。下载源码可以使用清华大学开源软件镜像站提供的Android</a> 镜像：<a href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/">https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/</a> 。如果觉得麻烦也可以查找国内的网盘进行下载，推荐使用该百度网盘地址下载：<a href="http://pan.baidu.com/s/1ngsZs%EF%BC%8C%E5%AE%83%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%9A%E4%B8%AAAndroid%E7%89%88%E6%9C%AC%E7%9A%84%E7%9A%84%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E3%80%82">http://pan.baidu.com/s/1ngsZs，它提供了多个Android版本的的源码下载。</a></p>
<p>整体结构<br>各个版本的源码目录基本是类似，如果是编译后的源码目录会多增加一个out文件夹，用来存储编译产生的文件。Android7.0的根目录结构说明如下表所示。</p>
<p>从表3可以看出，系统源码分类清晰，并且内容庞大且复杂。接下来分析packages中的内容，也就是应用层部分。<br>应用层部分<br>应用层位于整个Android系统的最上层，开发者开发的应用程序以及系统内置的应用程序都是在应用层。源码根目录中的packages目录对应着系统应用层。它的目录结构如表4所示。</p>
<h5 id="Android-open-source-project"><a href="#Android-open-source-project" class="headerlink" title="Android open source project"></a>Android open source project</h5><h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>Android Architecture</p>
<p><img src="/2018/07/25/AndroidSource/android_stack_720.png" style="zoom:50%;">         <img src="/2018/07/25/AndroidSource/ape_fwk_all.png" style="zoom: 67%;"></p>
<p><a href="https://source.android.com/">https://source.android.com/</a>                            </p>
<p> <a href="https://source.android.com/devices/architecture">https://source.android.com/devices/architecture</a></p>
<blockquote>
<pre><code>    Android源码根目录    描述

abi    应用程序二进制接口
art    全新的ART运行环境
bionic    系统C库
bootable    启动引导相关代码
build    存放系统编译规则及generic等基础开发包配置
cts    Android兼容性测试套件标准
dalvik art    虚拟机
developers    开发者目录
development    应用程序开发相关
device    设备相关配置
docs    参考文档目录
external    开源模组相关文件
frameworks    应用程序框架，Android系统核心部分，由Java和C++编写
hardware    主要是硬件抽象层的代码
libcore    核心库相关文件
libnativehelper    动态库，实现JNI库的基础
ndk    NDK相关代码，帮助开发人员在应用程序中嵌入C/C++代码
out    编译完成后代码输出在此目录
packages    应用程序包
pdk    Plug Development Kit 的缩写，本地开发套件
platform_testing    平台测试
prebuilts    x86和arm架构下预编译的一些资源
sdk    sdk和模拟器
system    底层文件系统库、应用和组件
toolchain    工具链文件
tools    工具文件
Makefile    全局Makefile文件，用来定义编译规则
————————————————

https://blog.csdn.net/wenzhi20102321/article/details/80739649

https://blog.csdn.net/wen0006/article/details/5804639
</code></pre>
</blockquote>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>AndroidStudioTool</title>
    <url>/2017/08/13/AndroidStudioTool/</url>
    <content><![CDATA[<h4 id="降低-compileSdkVersion-版本"><a href="#降低-compileSdkVersion-版本" class="headerlink" title="降低　compileSdkVersion　版本"></a>降低　compileSdkVersion　版本</h4><p> 　有时候需要看低版本的源码，就要修改compileSdkVersion版本</p>
<ol>
<li><p>修改编译版本<br><img src="/2017/08/13/AndroidStudioTool/DeepinScrot_compile.png" alt="图片"></p>
</li>
<li><p>targetSdkVersion版本修改成　21   然后   compile ‘com.android.support:appcompat-v7:21.+’ 继承的AppCompatActivity改成Activity</p>
</li>
<li><p>编译后报错　Error:(11) No resource identifier found for attribute ‘roundIcon’ in package ‘android’<br> 根据错误删除　android:roundIcon ,然后编译</p>
</li>
</ol>
<p>  参考：<a href="http://blog.csdn.net/hyr83960944/article/details/39941683">http://blog.csdn.net/hyr83960944/article/details/39941683</a></p>
<h4 id="android-stuido代理"><a href="#android-stuido代理" class="headerlink" title="android stuido代理"></a>android stuido代理</h4><h5 id="普通代理"><a href="#普通代理" class="headerlink" title="普通代理"></a>普通代理</h5><p>修改Gradle配置文件后就一直卡在那，在　build.gradle值修改下面<br>如果用了ss代理，在ubuntu设置http没用，可以在 工程根目录下 gradle.properties  添加</p>
<p><code>org.gradle.jvmargs=-DsocksProxyHost=127.0.0.1 -DsocksProxyPort=1080 </code><br>参考: <a href="https://www.zhihu.com/question/37810416">https://www.zhihu.com/question/37810416</a></p>
<p>平常github下载项目导入AndroidStudio直接卡死，心里真不是…., 目前实验一种方式应该会快点<br>修改 gradle\wrapper\gradle-wrapper.properties下的 distributionUrl=https://services.gradle.org/distributions/gradle-3.3-all.zip， 我的AndroidStudio默认是这个 所以就修改成这样的.</p>
<h5 id="jcenter库代理-这几句话花了关键得一天时间"><a href="#jcenter库代理-这几句话花了关键得一天时间" class="headerlink" title="jcenter库代理　(这几句话花了关键得一天时间)"></a>jcenter库代理　(这几句话花了关键得一天时间)</h5><p>前天升级了系统，之前下得Demo一直跑不起来，’<a href="https://jitpack.io&/#39;%E5%BE%97%E6%96%87%E4%BB%B6%E4%B8%80%E7%9B%B4%E4%B8%8B%E8%BD%BD%E4%B8%8D%E4%B8%8B%E6%9D%A5">https://jitpack.io&#39;得文件一直下载不下来</a>　<br>　＞错误：　jcenter.bintray.com:443 failed to respond<br>　折腾了一天终于弄好了,需要设置proxy代理,把socket流量转为http<br>　然后在　Ｍanual proxy configuration下面选择HTTP 填上<br>　 <code>127.0.0.1 　 8118 　</code><br>　 就可以下载jitpack里面得文件了</p>
<h5 id="阿里云镜像"><a href="#阿里云镜像" class="headerlink" title="阿里云镜像"></a>阿里云镜像</h5><blockquote>
<p>/Users/john/.gradle/init.gradle</p>
</blockquote>
<h5 id="下载gradle"><a href="#下载gradle" class="headerlink" title="下载gradle"></a>下载gradle</h5><p>  有时候想用新的的gradle，但是新的更新几十M的文件，一天都不一定能下下来<br>   直接去官网下载 <a href="https://gradle.org/releases/">https://gradle.org/releases/</a>  ，对应版本的zip文件，放到相应目录<br>  比如我的就是 C:\Users\Administrator.gradle\wrapper\dists\gradle-3.3-all\55gk2rcmfc6p2dg9u9ohc3hw9\</p>
<p>还一个是在${home}/.gradle目录下得gradle.properties文件配置应该也是可以的</p>
<h5 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h5><blockquote>
<p>Ctrl＋F12，可以显示当前文件的结构<br>Ctrl＋Shift＋F7 可以高亮当前元素在当前文件中的使用<br>Ctrl＋E，可以显示最近编辑的文件列表<br> Alt＋Up 和 Alt＋Down可在方法间快速移动<br> Shift＋Click可以关闭文件<br> Ctrl+ H 查看类的继承关系<br> Ctrl＋Alt＋B可以跳转到抽象方法的实现<br> Ctrl＋Q可以看JavaDoc</p>
</blockquote>
<p>参考：<a href="https://github.com/1sters/Android-Studio-Guide/blob/master/tips-shortcuts.md">https://github.com/1sters/Android-Studio-Guide/blob/master/tips-shortcuts.md</a></p>
<p>常用快捷键:<a href="https://mp.weixin.qq.com/s/lYBHtg342-t3NkPPY9E-YQ">https://mp.weixin.qq.com/s/lYBHtg342-t3NkPPY9E-YQ</a></p>
<h5 id="debug问题"><a href="#debug问题" class="headerlink" title="debug问题"></a>debug问题</h5><blockquote>
<p>15:40    Error running ‘app’<br>        Cannot debug application from module app on device huawei-pra_al00-HMKNW17A12007001.<br>        This application does not have the debuggable attribute enabled in its manifest.<br>        If you have manually set it in the manifest, then remove it and let the IDE automatically assign it.<br>        If you are using Gradle, make sure that your current variant is debuggable.</p>
</blockquote>
<p>Build Variants 设置成debug</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">debug &#123;</span><br><span class="line">        debuggable <span class="literal">false</span></span><br><span class="line">        minifyEnabled <span class="literal">false</span></span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>debuggable设置成 true</p>
<h5 id="SVN分支合并-主干-主干新增文件被删除"><a href="#SVN分支合并-主干-主干新增文件被删除" class="headerlink" title="SVN分支合并 主干,主干新增文件被删除"></a>SVN分支合并 主干,主干新增文件被删除</h5><p>弄了两个多小时，说多了都是泪</p>
<p><a href="https://www.jianshu.com/p/e50af339259f">https://www.jianshu.com/p/e50af339259f</a></p>
<h5 id="android命名规范"><a href="#android命名规范" class="headerlink" title="android命名规范"></a>android命名规范</h5><p><a href="https://juejin.im/entry/5b6a4ca9f265da0f4c6fe566">https://juejin.im/entry/5b6a4ca9f265da0f4c6fe566</a></p>
<h5 id="无线调试"><a href="#无线调试" class="headerlink" title="无线调试"></a>无线调试</h5><p><a href="https://juejin.im/entry/5a6a7e69518825733b0f1635">https://juejin.im/entry/5a6a7e69518825733b0f1635</a></p>
<p>设置侦听断开 :</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">adb</span> tcpip <span class="number">8888</span></span><br><span class="line"></span><br><span class="line"><span class="attribute">adb</span> connect <span class="number">192.168.31.76:8888</span></span><br></pre></td></tr></table></figure>

<p>安装包安装</p>
<p><code>adb -s acac34d7 install /e/JYWORK/</code></p>
<h5 id="win10-jdk环境变量设置"><a href="#win10-jdk环境变量设置" class="headerlink" title="win10 jdk环境变量设置"></a>win10 jdk环境变量设置</h5><p>在系统变量中设置 ,注意要点开编辑文本是不是之前输入的有 “”</p>
<h5 id="Android-stuido发布项目Jcenter"><a href="#Android-stuido发布项目Jcenter" class="headerlink" title="Android stuido发布项目Jcenter"></a>Android stuido发布项目Jcenter</h5><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">gradlew</span> clean build bintrayUpload  -PbintrayUser=blogforme  -PbintrayKey=<span class="number">4</span>c<span class="number">7511</span>bba<span class="number">437157</span>d<span class="number">77</span>baeb<span class="number">5</span>c<span class="number">17</span>d<span class="number">339</span>ce<span class="number">92</span>c<span class="number">2</span>bee<span class="number">7</span>  -PdryRun=false</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/novoda/bintray-release">https://github.com/novoda/bintray-release</a></p>
<p><a href="https://www.jianshu.com/p/9f81d5b5a451">https://www.jianshu.com/p/9f81d5b5a451</a></p>
<p><a href="https://blog.csdn.net/qq_32452623/article/details/79282605">https://blog.csdn.net/qq_32452623/article/details/79282605</a></p>
<p>Apk瘦身</p>
<p><a href="https://blog.csdn.net/qq_32175491/article/details/80071987">https://blog.csdn.net/qq_32175491/article/details/80071987</a></p>
<p>也有不建议删SO库的说法</p>
<p><a href="http://kaedea.com/2016/06/04/android-dynamical-loading-04-so-problems/">http://kaedea.com/2016/06/04/android-dynamical-loading-04-so-problems/</a></p>
<h5 id="依赖其他moudle"><a href="#依赖其他moudle" class="headerlink" title="依赖其他moudle"></a>依赖其他moudle</h5><p><a href="https://mp.weixin.qq.com/s/trAxRzz573TFyJk2klKdag">https://mp.weixin.qq.com/s/trAxRzz573TFyJk2klKdag</a></p>
<h5 id="android-stuido-日志"><a href="#android-stuido-日志" class="headerlink" title="android stuido 日志"></a>android stuido 日志</h5><h5 id="过滤不需要的日志"><a href="#过滤不需要的日志" class="headerlink" title="过滤不需要的日志"></a>过滤不需要的日志</h5><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">^(?!.*(eglMakeCurrent<span class="string">|OpenGLRenderer)).*$</span></span><br><span class="line"></span><br><span class="line">eglMakeCurrent OpenGLRenderer两个包含需要过滤的字段</span><br></pre></td></tr></table></figure>

<h5 id="留下需要的日志"><a href="#留下需要的日志" class="headerlink" title="留下需要的日志"></a>留下需要的日志</h5><img src="/2017/08/13/AndroidStudioTool/Screen Shot 2021-02-06 at 11.57.50 AM.png" style="zoom: 80%;">

<p><a href="https://www.jianshu.com/p/11e56991ff28">https://www.jianshu.com/p/11e56991ff28</a></p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>AnimBitmaps</title>
    <url>/2019/12/25/AnimBitmaps/</url>
    <content><![CDATA[<h5 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h5><p><a href="https://developer.android.com/training/animation">https://developer.android.com/training/animation</a></p>
<h1 id="Animate-drawable-graphics"><a href="#Animate-drawable-graphics" class="headerlink" title="Animate drawable graphics"></a>Animate drawable graphics</h1><p>The first option is to use an <a href="https://developer.android.com/guide/topics/graphics/drawable-animation.html#AnimationDrawable">Animation Drawable</a>. This allows you to specify several static <a href="https://developer.android.com/guide/topics/graphics/2d-graphics.html">drawable files</a> that will be displayed one at a time to create an animation. The second option is to use an <a href="https://developer.android.com/guide/topics/graphics/drawable-animation.html#AnimVector">Animated Vector Drawable</a>, which lets you animate the properties of a <a href="https://developer.android.com/guide/topics/graphics/vector-drawable-resources.html">vector drawable</a>.</p>
<ol>
<li><p>The XML file consists of <code>&lt;animation=list&gt;</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">animation-list</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:oneshot</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/rocket_thrust1&quot;</span> <span class="attr">android:duration</span>=<span class="string">&quot;200&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/rocket_thrust2&quot;</span> <span class="attr">android:duration</span>=<span class="string">&quot;200&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/rocket_thrust3&quot;</span> <span class="attr">android:duration</span>=<span class="string">&quot;200&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">animation-list</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>  in which the animation is added to an <code>ImageView</code> and then animated when the  screen is touched</p>
</li>
</ol>
   <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> lateinit var rocketAnimation: AnimationDrawable</span><br><span class="line"></span><br><span class="line">override <span class="keyword">fun</span> on<span class="constructor">Create(<span class="params">savedInstanceState</span>: Bundle?)</span> &#123;</span><br><span class="line">    super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span></span><br><span class="line">    set<span class="constructor">ContentView(R.<span class="params">layout</span>.<span class="params">main</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> rocketImage = findViewById&lt;ImageView&gt;(<span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.rocket_image).apply &#123;</span><br><span class="line">        set<span class="constructor">BackgroundResource(R.<span class="params">drawable</span>.<span class="params">rocket_thrust</span>)</span></span><br><span class="line">        rocketAnimation = background <span class="keyword">as</span> AnimationDrawable</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    rocketImage.set<span class="constructor">OnClickListener(&#123; <span class="params">rocketAnimation</span>.<span class="params">start</span>()</span> &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>It’s important to note that the <code>start()</code> method called on the <code>AnimationDrawable</code> cannot be called during the <code>onCreate()</code> method of your Activity, because the <code>AnimationDrawable</code> is not yet fully attached to the window. If you want to play the animation immediately, without requiring interaction, then you might want to call it from the <code>onStart()</code> method in your Activity, which will get called when Android makes the view visible on screen.</p>
<h5 id="AnimatedVectorDrawable"><a href="#AnimatedVectorDrawable" class="headerlink" title="AnimatedVectorDrawable"></a>AnimatedVectorDrawable</h5>]]></content>
      <categories>
        <category>anim</category>
      </categories>
  </entry>
  <entry>
    <title>AnimationResource</title>
    <url>/2017/08/16/AnimationResource/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/guide/topics/resources/animation-resource.html">https://developer.android.com/guide/topics/resources/animation-resource.html</a></p>
<p>Android动画简介,直接copy了</p>
<blockquote>
<p>The Android framework provides two animation systems: property animation and view animation. Both animation systems are viable options, but the property animation system, in general, is the preferred method to use, because it is more flexible and offers more features. In addition to these two systems, you can utilize Drawable animation, which allows you to load drawable resources and display them one frame after another.</p>
</blockquote>
<p>可以看出官方更推崇 Property Animiation,更灵活而且提供更多的功能,看下３种动画方式</p>
<ul>
<li><p>Drawable Animation (Frame动画，帧动画)</p>
<blockquote>
<p>Drawable animation involves displaying Drawable resources one after another, like a roll of film. This method of animation is useful if you want to animate things that are easier to represent with Drawable resources, such as a progression of bitmaps.</p>
</blockquote>
<p>通过人视觉的延迟，把图片一张连接一张，类似放电影</p>
</li>
<li><p>View Animation(Tween动画)</p>
<blockquote>
<p>View Animation is the older system and can only be used for Views. It is relatively easy to setup and offers enough capabilities to meet many application’s needs.</p>
</blockquote>
</li>
<li><p>Property Animation</p>
<blockquote>
<p>Introduced in Android 3.0 (API level 11), the property animation system lets you animate properties of any object, including ones that are not rendered to the screen. The system is extensible and lets you animate properties of custom types as well.</p>
</blockquote>
</li>
</ul>
<blockquote>
</blockquote>
<p>view动画示例:　文件位置放哪呢？　在官网确认了了位置</p>
<blockquote>
<p>The animation XML file belongs in the <strong>res/anim/</strong> directory of your Android project. The file must have a single root element: this will be either a single <alpha>, <scale>, <translate>, <rotate>, interpolator element, or <set> element that holds groups of these elements (which may include another <set>). By default, all animation instructions are applied simultaneously. To make them occur sequentially, you must specify the startOffset attribute, as shown in the example below.</set></set></rotate></translate></scale></alpha></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">&quot;1000&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fillAfter</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">&quot;@android:anim/accelerate_decelerate_interpolator&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shareInterpolator</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 位置移动--&gt;</span></span><br><span class="line">    &lt;translate</span><br><span class="line">        android:fromXDelta=&quot;0.0&quot;</span><br><span class="line">        android:fromYDelta=&quot;0.0&quot;</span><br><span class="line">        android:toXDelta=&quot;500.0&quot;</span><br><span class="line">        android:toYDelta=&quot;500.0&quot; /&gt;</span><br><span class="line">    <span class="comment">&lt;!-- 放大或缩小 --&gt;</span></span><br><span class="line">    &lt;scale</span><br><span class="line">        android:fromXScale=&quot;0.0&quot;</span><br><span class="line">        android:fromYScale=&quot;0.0&quot;</span><br><span class="line">        android:pivotX=&quot;50%&quot;</span><br><span class="line">        android:pivotY=&quot;50%&quot;</span><br><span class="line">        android:toXScale=&quot;1.0&quot;</span><br><span class="line">        android:toYScale=&quot;1.0&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;rotate</span><br><span class="line">        android:fromDegrees=&quot;0.0&quot;</span><br><span class="line">        android:pivotX=&quot;50%&quot;</span><br><span class="line">        android:pivotY=&quot;50%&quot;</span><br><span class="line">        android:toDegrees=&quot;30.0&quot; /&gt;</span><br><span class="line">    &lt;alpha</span><br><span class="line">        android:fromAlpha=&quot;0.0&quot;</span><br><span class="line">        android:toAlpha=&quot;0.5&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/BlogForMe/AndroidDemo/blob/master/lern/src/main/java/com/hyhy/lern/AnimationActivity.java">演示代码:</a><br>参考：<a href="http://www.jianshu.com/p/b7aa2a4a9787">http://www.jianshu.com/p/b7aa2a4a9787</a><br><a href="http://blog.csdn.net/yanbober/article/details/46481171">http://blog.csdn.net/yanbober/article/details/46481171</a><br> 跑完代码后，点击动画结束后的图片，没反应，实际上按钮还是停留在屏幕左上角，只不过view动画把图片绘制到了新的位置。所以说　View动画是对View的影像做操作，它并不能改变View的位置参数</p>
<h1 id="Property-Animation"><a href="#Property-Animation" class="headerlink" title="Property Animation"></a>Property Animation</h1><p>　属性动画就是对　对象的属性进行实质的改变了，而不只是投影了，比如刚才的图片修改后是可以点击的</p>
<ul>
<li><p>　ValueAnimator: 通过不断的对值进行操作来实现的，初始值盒结束值之间的动画过渡就是由ValueAnimator来负责计算的，除此之外，还负责管理动画的播放次数，播放模式，以及监听等。</p>
<pre><code>  /**
   * 300 ms内,value值从0 平滑的过渡到了1
   */
</code></pre>
<p>//        ValueAnimator anim = ValueAnimator.ofFloat(0f, 1f);<br>//        anim.setDuration(300);</p>
<pre><code>  /**
   *  value值从0过渡到５，再到３最后到10的过程
   */
</code></pre>
<p>//        ValueAnimator anim = ValueAnimator.ofFloat(0f, 5f, 3f, 10f);</p>
<pre><code>  //整形数从 0到 100
  ValueAnimator anim = ValueAnimator.ofInt(0, 100);
  anim.setDuration(5000);
  anim.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() &#123;
      @Override
      public void onAnimationUpdate(ValueAnimator valueAnimator) &#123;
          Object currentValue = valueAnimator.getAnimatedValue();
          Log.d(TAG, &quot; current value is &quot; + currentValue);
      &#125;
  &#125;);
  anim.start();
</code></pre>
</li>
<li><p>ObjectAnimator<br>ObjectAnimator继承ValueAnimator，它可以直接对任意对象的任意属性进行动画操作<br>演示示例
　　</p>
<pre><code>  /**
   * 透明:　５秒内从常规变换成全　透明,再从透明变成常规
   */
</code></pre>
<p>//        ObjectAnimator animator = ObjectAnimator.ofFloat(v, “alpha”, 1f, 0f, 1f);</p>
<pre><code>  /**
   *  旋转 : 对按钮进行旋转 360
   */
</code></pre>
<p>//        ObjectAnimator animator = ObjectAnimator.ofFloat(v, “rotation”, 0f, 360f);</p>
<pre><code>  /**
   * 位置移动: Button向左移动再回来
   */
</code></pre>
<p>//        float curTranslationX = v.getTranslationX(); //获取当前Button的translationX位置<br>//        ObjectAnimator animator = ObjectAnimator.ofFloat(v, “translationX”,<br>//                curTranslationX, -500f, curTranslationX); //传入translationX，后面３个参数告诉它怎么移动</p>
<pre><code>  /**
   * 缩放： 参数改为 scaleY,表示再垂直方向上放大３倍再还原
   */
  ObjectAnimator animator = ObjectAnimator.ofFloat(v, &quot;scaleY&quot;, 1f, 3f, 1f);
  animator.setDuration(5000);
  animator.start();
</code></pre>
<p>ObjectAnimator传入参数是根据Ｖiew的属性进行操作的，如setRotation()、getRotation()、setTranslationX()、getTranslationX()、setScaleY()、getScaleY()</p>
</li>
</ul>
<hr>
<p>＃ 组合动画 : 就是属性动画组合起来,借助AnimatorSet<br>　　微风吹着，飘来周传雄的音乐… 敲着键盘　人生不过如此～～</p>
<ul>
<li>after(Animator anim) : 现有动画放在传入动画之后执行</li>
<li>after(long　delay)   : 將现有动画延迟　“delay” 后执行</li>
<li>before(Animator anim) :参考楼上</li>
<li>with(Animator anim)  :　现有动画盒传入动画同时执行  </li>
</ul>
<p> 示例<br> 　　<br>    　　<br>      ObjectAnimator moveIn = ObjectAnimator.ofFloat(v, “translationX”, -500f, 0f);<br>        ObjectAnimator rotation = ObjectAnimator.ofFloat(v, “rotation”, 0f, 360f);<br>        ObjectAnimator fadeInOut = ObjectAnimator.ofFloat(v, “alpha”, 1f, 0f, 1f);<br>        AnimatorSet animSet = new AnimatorSet();<br>        animSet.play(rotation).with(fadeInOut).after(moveIn);<br>        animSet.setDuration(5000);<br>        animSet.addListener(new Animator.AnimatorListener() {<br>            @Override<br>            public void onAnimationStart(Animator animation) {<br>                Log.d(TAG, “  onAnimationStart “);<br>            }</p>
<pre><code>        @Override
        public void onAnimationEnd(Animator animation) &#123;
            Log.d(TAG, &quot;  onAnimationEnd &quot;);
        &#125;

        @Override
        public void onAnimationCancel(Animator animation) &#123;
            Log.d(TAG, &quot;  onAnimationCancel &quot;);
        &#125;

        @Override
        public void onAnimationRepeat(Animator animation) &#123;
            Log.d(TAG, &quot;  onAnimationRepeat &quot;);
        &#125;
    &#125;);
    animSet.start();
</code></pre>
<p>　　下面是监听器，也可以用AnimatorListenerAdapter 选择想要重写的方法</p>
<h1 id="XML支持的Property-Animation-tags"><a href="#XML支持的Property-Animation-tags" class="headerlink" title="XML支持的Property Animation　tags"></a>XML支持的Property Animation　tags</h1><ul>
<li>对应代码中的ValueAnimator - <animator></animator></li>
<li>ObjectAnimator -  <objectAnimator></objectAnimator></li>
<li>AnimatorSet   - <set></set></li>
</ul>
<p>这里也需要建个文件夹存放</p>
<blockquote>
<p>The property animation system lets you declare property animations with XML instead of doing it programmatically. By defining your animations in XML, you can easily reuse your animations in multiple activities and more easily edit the animation sequence.</p>
</blockquote>
<blockquote>
<p>To distinguish animation files that use the new property animation APIs from those that use the legacy view animation framework, starting with Android 3.1, you should save the XML files for property animations in the **res/animator/ **directory.</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">animator</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueFrom</span>=<span class="string">&quot;0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueTo</span>=<span class="string">&quot;100&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueType</span>=<span class="string">&quot;intType&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">加载</span><br><span class="line">Animator anim = AnimatorInflater.loadAnimator(this, R.animator.propery_first);</span><br><span class="line">        anim.setTarget(v);</span><br><span class="line">　       anim.start();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>根据官方例子,也可以强转ValueAnimator，添加监听器,其他形式的xml文件也类似</p>
<ul>
<li><p>设置动画参数</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"><span class="string">//</span> ValueAnimator采用&lt;animator&gt;  标签</span><br><span class="line">&lt;animator xmlns<span class="function">:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span><br><span class="line">    android<span class="function">:valueFrom</span>=<span class="string">&quot;0&quot;</span>   <span class="string">//</span> 初始值</span><br><span class="line">    android<span class="function">:valueTo</span>=<span class="string">&quot;100&quot;</span>  <span class="string">//</span> 结束值</span><br><span class="line">    android<span class="function">:valueType</span>=<span class="string">&quot;intType&quot;</span> <span class="string">//</span> 变化值类型 ：floatType &amp; intType</span><br><span class="line"></span><br><span class="line">    android<span class="function">:duration</span>=<span class="string">&quot;3000&quot;</span> <span class="string">//</span> 动画持续时间（ms），必须设置，动画才有效果</span><br><span class="line">    android<span class="function">:startOffset</span> =<span class="string">&quot;1000&quot;</span> <span class="string">//</span> 动画延迟开始时间（ms）</span><br><span class="line">    android<span class="function">:fillBefore</span> = “<span class="literal">true</span>” <span class="string">//</span> 动画播放完后，视图是否会停留在动画开始的状态，默认为<span class="literal">true</span></span><br><span class="line">    android<span class="function">:fillAfter</span> = “<span class="literal">false</span>” <span class="string">//</span> 动画播放完后，视图是否会停留在动画结束的状态，优先于fillBefore值，默认为<span class="literal">false</span></span><br><span class="line">    android<span class="function">:fillEnabled</span>= “<span class="literal">true</span>” <span class="string">//</span> 是否应用fillBefore值，对fillAfter值无影响，默认为<span class="literal">true</span></span><br><span class="line">    android<span class="function">:repeatMode</span>= “restart” <span class="string">//</span> 选择重复播放动画模式，restart代表正序重放，reverse代表倒序回放，默认为restart|</span><br><span class="line">    android<span class="function">:repeatCount</span> = “0” <span class="string">//</span> 重放次数（所以动画的播放次数=重放次数+1），为infinite时无限重复</span><br><span class="line">    android<span class="function">:interpolator</span> = @[package:]anim/interpolator_resource <span class="string">//</span> 插值器，即影响动画的播放速度,下面会详细讲</span><br><span class="line"></span><br><span class="line">/&gt; </span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/carson_ho/article/details/72909894">https://blog.csdn.net/carson_ho/article/details/72909894</a> </p>
</li>
</ul>
<p>参考：<a href="http://blog.csdn.net/guolin_blog/article/details/43536355">http://blog.csdn.net/guolin_blog/article/details/43536355</a></p>
]]></content>
      <categories>
        <category>anim</category>
      </categories>
  </entry>
  <entry>
    <title>AnimationView</title>
    <url>/2019/12/26/AnimationView/</url>
    <content><![CDATA[<h5 id="View-Animation"><a href="#View-Animation" class="headerlink" title="View Animation"></a>View Animation</h5><p>第一种就pass了，看下View Animation:</p>
<blockquote>
<p>You can use the view animation system to perform tweened animation on Views. Tween animation calculates the animation with information such as the start point, end point, size, rotation, and other common aspects of an animation.</p>
</blockquote>
<p>这种动画可以在一个视图容器执行　位置、大小、旋转、透明度的变化，使用XML定义更具可读性</p>
<blockquote>
<p>-set<br>|-android:interpolator -&gt; 插值器，影响动画的速度<br> |-默认值 -&gt; @android:anim/accelerate_decelerate_interpolator<br>|-android:shareInterpolator -&gt; 集合所有动画是否使用同一插值器<br>|-android:fillAfter -&gt; 动画结束后View是否停留在结束的位置<br>|-android:startOffset -&gt; 动画多少秒之后执行<br>|-android:repeatMode -&gt; 重复的模式,默认为restart,即重头开始重新运行,reverse即从结束开始向前重新运行<br>-TranslateAnimation -&gt; 移动View<br>|-<translate><br> |-android:fillAfter -&gt;<br> |-android:duration -&gt; 表示动画持续的时间<br> |-android:fromXDelta -&gt; 表示 x 的起始值<br> |-android:toXDelta -&gt; 表示 x 的结束值<br> |-android:fromYDelta -&gt; 表示 y 的起始值<br> |-android:toYDelta -&gt; 表示 y 的结束值<br>-scaleAnimation -&gt; 放大或者缩小View<br>|-<scale><br> |-android:duration -&gt; 表示动画持续的时间<br> |-android:fromXScale -&gt; 表示水平方向缩放的起始值<br> |-android:fromYScale -&gt; 表示竖直方向缩放的起始值<br> |-android:pivotX -&gt; 表示缩放中心点的 X 坐标<br> |-android:pivotY -&gt; 表示缩放中心点的 Y 坐标<br> |-android:toXScale -&gt; 表示水平方向缩放的结束值<br> |-android:toYScale -&gt; 表示竖直方向缩放的结束值<br>-RotateAnimation -&gt; 旋转View<br>|-<rotate><br> |-android:duration -&gt; 表示动画持续的时间<br> |-android:fromDegrees -&gt; 旋转开始的角度<br> |-android:toDegrees -&gt; 旋转结束的角度<br> |-android:pivotX -&gt; 旋转中心点的 X 坐标<br> |-android:pivotY -&gt; 旋转中心点的 Y 坐标<br>-AlphaAnimation -&gt; 改变View的透明度<br>|-<alpha><br> |-android:duration -&gt; 表示动画持续的时间<br> |-android:fromAlpha -&gt; 透明度的起始值<br> |-android:toAlpha -&gt; 透明度的结束值<br>-自定义View动画 -&gt; (不会,待实践中学习)    </alpha></rotate></scale></translate></p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span>  <span class="title">anim</span><span class="params">(resAnim:<span class="type">Int</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> translateAnimation = AnimationUtils.loadAnimation(<span class="keyword">this</span>,resAnim)</span><br><span class="line">    textView5.startAnimation(translateAnimation)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li><p>view_anim_translate.xml</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 以下参数是4种动画效果的公共属性,即都有的属性</span></span><br><span class="line"><span class="symbol"> android:</span>duration=<span class="string">&quot;3000&quot;</span> <span class="comment">// 动画持续时间（ms），必须设置，动画才有效果</span></span><br><span class="line"><span class="symbol"> android:</span>startOffset =<span class="string">&quot;1000&quot;</span> <span class="comment">// 动画延迟开始时间（ms）</span></span><br><span class="line"><span class="symbol"> android:</span>fillBefore = “true” <span class="comment">// 动画播放完后，视图是否会停留在动画开始的状态，默认为true</span></span><br><span class="line"><span class="symbol"> android:</span>fillAfter = “false” <span class="comment">// 动画播放完后，视图是否会停留在动画结束的状态，优先于fillBefore值，默认为false</span></span><br><span class="line"><span class="symbol"> android:</span>fillEnabled= “true” <span class="comment">// 是否应用fillBefore值，对fillAfter值无影响，默认为true</span></span><br><span class="line"><span class="symbol"> android:</span>repeatMode= “restart” <span class="comment">// 选择重复播放动画模式，restart代表正序重放，reverse代表倒序回放，默认为restart|</span></span><br><span class="line"><span class="symbol"> android:</span>repeatCount = “<span class="number">0</span>” <span class="comment">// 重放次数（所以动画的播放次数=重放次数+1），为infinite时无限重复</span></span><br><span class="line"><span class="symbol"> android:</span>interpolator = @[package:]anim/interpolator_resource <span class="comment">// 插值器，即影响动画的播放速度,下面会详细讲</span></span><br><span class="line">   </span><br><span class="line"> <span class="comment">// 以下参数是平移动画特有的属性</span></span><br><span class="line"><span class="symbol"> android:</span>fromXDelta=<span class="string">&quot;0&quot;</span> <span class="comment">// 视图在水平方向x 移动的起始值</span></span><br><span class="line"><span class="symbol"> android:</span>toXDelta=<span class="string">&quot;500&quot;</span> <span class="comment">// 视图在水平方向x 移动的结束值</span></span><br><span class="line">   </span><br><span class="line"><span class="symbol"> android:</span>fromYDelta=<span class="string">&quot;0&quot;</span> <span class="comment">// 视图在竖直方向y 移动的起始值</span></span><br><span class="line"><span class="symbol"> android:</span>toYDelta=<span class="string">&quot;500&quot;</span> <span class="comment">// 视图在竖直方向y 移动的结束值</span></span><br></pre></td></tr></table></figure></li>
<li><p>View_anim_translate.xml</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">&lt;!--  <span class="string">//</span> 以下参数是4种动画效果的公共属性,即都有的属性</span><br><span class="line">  android<span class="function">:duration</span>=<span class="string">&quot;3000&quot;</span> <span class="string">//</span> 动画持续时间（ms），必须设置，动画才有效果</span><br><span class="line">  android<span class="function">:startOffset</span> =<span class="string">&quot;1000&quot;</span> <span class="string">//</span> 动画延迟开始时间（ms）</span><br><span class="line">  android<span class="function">:fillBefore</span> = “<span class="literal">true</span>” <span class="string">//</span> 动画播放完后，视图是否会停留在动画开始的状态，默认为<span class="literal">true</span></span><br><span class="line">  android<span class="function">:fillAfter</span> = “<span class="literal">false</span>” <span class="string">//</span> 动画播放完后，视图是否会停留在动画结束的状态，优先于fillBefore值，默认为<span class="literal">false</span></span><br><span class="line">  android<span class="function">:fillEnabled</span>= “<span class="literal">true</span>” <span class="string">//</span> 是否应用fillBefore值，对fillAfter值无影响，默认为<span class="literal">true</span></span><br><span class="line">  android<span class="function">:repeatMode</span>= “restart” <span class="string">//</span> 选择重复播放动画模式，restart代表正序重放，reverse代表倒序回放，默认为restart|</span><br><span class="line">  android<span class="function">:repeatCount</span> = “0” <span class="string">//</span> 重放次数（所以动画的播放次数=重放次数+1），为infinite时无限重复</span><br><span class="line">  android<span class="function">:interpolator</span> = @[package:]anim/interpolator_resource <span class="string">//</span> 插值器，即影响动画的播放速度,下面会详细讲</span><br><span class="line"></span><br><span class="line">  <span class="string">//</span> 以下参数是缩放动画特有的属性</span><br><span class="line">  android<span class="function">:fromXScale</span>=<span class="string">&quot;0.0&quot;</span></span><br><span class="line">  <span class="string">//</span> 动画在水平方向X的起始缩放倍数</span><br><span class="line">  <span class="string">//</span> 0.0表示收缩到没有；1.0表示正常无伸缩</span><br><span class="line">  <span class="string">//</span> 值小于1.0表示收缩；值大于1.0表示放大</span><br><span class="line"></span><br><span class="line">  android<span class="function">:toXScale</span>=<span class="string">&quot;2&quot;</span>  <span class="string">//</span>动画在水平方向X的结束缩放倍数</span><br><span class="line"></span><br><span class="line">  android<span class="function">:fromYScale</span>=<span class="string">&quot;0.0&quot;</span> <span class="string">//</span>动画开始前在竖直方向Y的起始缩放倍数</span><br><span class="line">  android<span class="function">:toYScale</span>=<span class="string">&quot;2&quot;</span> <span class="string">//</span>动画在竖直方向Y的结束缩放倍数</span><br><span class="line"></span><br><span class="line">  android<span class="function">:pivotX</span>=<span class="string">&quot;50%&quot;</span> <span class="string">//</span> 缩放轴点的x坐标</span><br><span class="line">  android<span class="function">:pivotY</span>=<span class="string">&quot;50%&quot;</span> <span class="string">//</span> 缩放轴点的y坐标</span><br><span class="line">  <span class="string">//</span> 轴点 = 视图缩放的中心点</span><br><span class="line"></span><br><span class="line">  <span class="string">//</span> pivotX pivotY,可取值为数字，百分比，或者百分比p</span><br><span class="line">  <span class="string">//</span> 设置为数字时（如50），轴点为View的左上角的原点在x方向和y方向加上50px的点。在Java代码里面设置这个参数的对应参数是Animation.ABSOLUTE。</span><br><span class="line">  <span class="string">//</span> 设置为百分比时（如50%），轴点为View的左上角的原点在x方向加上自身宽度50%和y方向自身高度50%的点。在Java代码里面设置这个参数的对应参数是Animation.RELATIVE_TO_SELF。</span><br><span class="line">  <span class="string">//</span> 设置为百分比p时（如50%p），轴点为View的左上角的原点在x方向加上父控件宽度50%和y方向父控件高度50%的点。在Java代码里面设置这个参数的对应参数是Animation.RELATIVE_TO_PARENT</span><br><span class="line"></span><br><span class="line">  <span class="string">//</span> 两个50%表示动画从自身中间开始，具体如下图</span><br></pre></td></tr></table></figure>

<p> android:pivotX=”50%” // 缩放轴点的x坐标<br>  android:pivotY=”50%” // 缩放轴点的y坐标</p>
<p>这个拿掉看看效果</p>
<img src="/2019/12/26/AnimationView/view.gif" alt="view" style="zoom:20%;">



<p>添加　</p>
<p>pivotX pivotY</p>
<img src="/2019/12/26/AnimationView/anim_view_scale1.gif" style="zoom: 20%;"></li>
<li><p>Rotate</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">//</span> 以下参数是旋转动画特有的属性</span><br><span class="line">  android:duration=<span class="string">&quot;1000&quot;</span></span><br><span class="line">  android:fromDegrees=<span class="string">&quot;0&quot;</span> <span class="regexp">//</span> 动画开始时 视图的旋转角度(正数 = 顺时针，负数 = 逆时针)</span><br><span class="line">  android:toDegrees=<span class="string">&quot;270&quot;</span> <span class="regexp">//</span> 动画结束时 视图的旋转角度(正数 = 顺时针，负数 = 逆时针)</span><br><span class="line">  android:pivotX=<span class="string">&quot;50%&quot;</span> <span class="regexp">//</span> 旋转轴点的x坐标</span><br><span class="line">  android:pivotY=<span class="string">&quot;0&quot;</span> <span class="regexp">//</span> 旋转轴点的y坐标</span><br><span class="line">  <span class="regexp">//</span> 轴点 = 视图缩放的中心点</span><br><span class="line">   </span><br><span class="line">  <span class="regexp">//</span> pivotX pivotY,可取值为数字，百分比，或者百分比p</span><br><span class="line">  <span class="regexp">//</span> 设置为数字时（如<span class="number">50</span>），轴点为View的左上角的原点在x方向和y方向加上<span class="number">50</span>px的点。在Java代码里面设置这个参数的对应参数是Animation.ABSOLUTE。</span><br><span class="line">  <span class="regexp">//</span> 设置为百分比时（如<span class="number">50</span>%），轴点为View的左上角的原点在x方向加上自身宽度<span class="number">50</span>%和y方向自身高度<span class="number">50</span>%的点。在Java代码里面设置这个参数的对应参数是Animation.RELATIVE_TO_SELF。</span><br><span class="line">  <span class="regexp">//</span> 设置为百分比p时（如<span class="number">50</span>%p），轴点为View的左上角的原点在x方向加上父控件宽度<span class="number">50</span>%和y方向父控件高度<span class="number">50</span>%的点。在Java代码里面设置这个参数的对应参数是Animation.RELATIVE_TO_PARENT</span><br><span class="line">  <span class="regexp">//</span> 两个<span class="number">50</span>%表示动画从自身中间开始，具体如下图</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>alpha</li>
</ol>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 以下参数是4种动画效果的公共属性,即都有的属性</span></span><br><span class="line"><span class="symbol">android:</span>duration=<span class="string">&quot;3000&quot;</span> <span class="comment">// 动画持续时间（ms），必须设置，动画才有效果</span></span><br><span class="line"><span class="symbol">android:</span>startOffset =<span class="string">&quot;1000&quot;</span> <span class="comment">// 动画延迟开始时间（ms）</span></span><br><span class="line"><span class="symbol">android:</span>fillBefore = “true” <span class="comment">// 动画播放完后，视图是否会停留在动画开始的状态，默认为true</span></span><br><span class="line"><span class="symbol">android:</span>fillAfter = “false” <span class="comment">// 动画播放完后，视图是否会停留在动画结束的状态，优先于fillBefore值，默认为false</span></span><br><span class="line"><span class="symbol">android:</span>fillEnabled= “true” <span class="comment">// 是否应用fillBefore值，对fillAfter值无影响，默认为true</span></span><br><span class="line"><span class="symbol">android:</span>repeatMode= “restart” <span class="comment">// 选择重复播放动画模式，restart代表正序重放，reverse代表倒序回放，默认为restart|</span></span><br><span class="line"><span class="symbol">android:</span>repeatCount = “<span class="number">0</span>” <span class="comment">// 重放次数（所以动画的播放次数=重放次数+1），为infinite时无限重复</span></span><br><span class="line"><span class="symbol">android:</span>interpolator = @[package:]anim/interpolator_resource <span class="comment">// 插值器，即影响动画的播放速度,下面会详细讲</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下参数是透明度动画特有的属性</span></span><br><span class="line"><span class="symbol">android:</span>fromAlpha=<span class="string">&quot;1.0&quot;</span> <span class="comment">// 动画开始时视图的透明度(取值范围: -1 ~ 1)</span></span><br><span class="line"><span class="symbol">android:</span>toAlpha=<span class="string">&quot;0.0&quot;</span><span class="comment">// 动画结束时视图的透明度(取值范围: -1 ~ 1)</span></span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="5">
<li><p>组合动画</p>
 <figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line"><span class="comment">// 采用&lt; Set/&gt;标签</span></span><br><span class="line">&lt;<span class="keyword">set</span> xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合动画同样具备公共属性</span></span><br><span class="line">    android:duration=<span class="string">&quot;3000&quot;</span> <span class="comment">// 动画持续时间（ms），必须设置，动画才有效果</span></span><br><span class="line">    android:startOffset <span class="comment">=</span><span class="comment">&quot;1000&quot;</span> // 动画延迟开始时间（<span class="comment">ms</span>）</span><br><span class="line">    android:fillBefore <span class="comment">=</span> “<span class="comment">true</span>” // 动画播放完后，视图是否会停留在动画开始的状态，默认为<span class="comment">true</span></span><br><span class="line">    android:fillAfter <span class="comment">=</span> “<span class="comment">false</span>” // 动画播放完后，视图是否会停留在动画结束的状态，优先于<span class="comment">fillBefore</span>值，默认为<span class="comment">false</span></span><br><span class="line">    android:fillEnabled= “true” <span class="comment">// 是否应用fillBefore值，对fillAfter值无影响，默认为true</span></span><br><span class="line">    android:repeatMode= “restart” <span class="comment">// 选择重复播放动画模式，restart代表正序重放，reverse代表倒序回放，默认为restart|</span></span><br><span class="line">    android:repeatCount <span class="comment">=</span> “<span class="comment">0</span>” // 重放次数（所以动画的播放次数<span class="comment">=</span>重放次数<span class="comment">+1</span>），为<span class="comment">infinite</span>时无限重复</span><br><span class="line">    android:interpolator <span class="comment">= @[package:]anim</span>/interpolator_resource <span class="comment">// 插值器，即影响动画的播放速度,下面会详细讲</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">// 组合动画独特的属性</span></span><br><span class="line">    android:shareinterpolator = “true”</span><br><span class="line">    <span class="comment">// 表示组合动画中的动画是否和集合共享同一个差值器</span></span><br><span class="line">    <span class="comment">// 如果集合不指定插值器，那么子动画需要单独设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 组合动画播放时是全部动画同时开始</span></span><br><span class="line"><span class="comment">// 如果想不同动画不同时间开始就要使用android:startOffset属性来延迟单个动画播放时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置旋转动画，语法同单个动画</span></span><br><span class="line">    &lt;rotate</span><br><span class="line">        android:duration=<span class="comment">&quot;1000&quot;</span></span><br><span class="line">        android:fromDegrees=<span class="comment">&quot;0&quot;</span></span><br><span class="line">        android:toDegrees=<span class="comment">&quot;360&quot;</span></span><br><span class="line">        android:pivotX=<span class="comment">&quot;50%&quot;</span></span><br><span class="line">        android:pivotY=<span class="comment">&quot;50%&quot;</span></span><br><span class="line">        android:repeatMode=<span class="comment">&quot;restart&quot;</span></span><br><span class="line">        android:repeatCount=<span class="comment">&quot;infinite&quot;</span></span><br><span class="line">        /<span class="comment">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置平移动画，语法同单个动画</span></span><br><span class="line">    &lt;translate</span><br><span class="line">        android:duration=<span class="string">&quot;10000&quot;</span></span><br><span class="line">        android:startOffset <span class="comment">=</span> “<span class="comment">1000</span>”// 延迟该动画播放时间</span><br><span class="line">        android:fromXDelta=<span class="string">&quot;-50%p&quot;</span></span><br><span class="line">        android:fromYDelta=<span class="string">&quot;0&quot;</span></span><br><span class="line">        android:toXDelta=<span class="string">&quot;50%p&quot;</span></span><br><span class="line">        android:toYDelta=<span class="string">&quot;0&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置透明度动画，语法同单个动画</span></span><br><span class="line">    &lt;alpha</span><br><span class="line">        android:startOffset=<span class="comment">&quot;7000&quot;</span></span><br><span class="line">        android:duration=<span class="comment">&quot;3000&quot;</span></span><br><span class="line">        android:fromAlpha=<span class="comment">&quot;1.0&quot;</span></span><br><span class="line">        android:toAlpha=<span class="comment">&quot;0.0&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置缩放动画，语法同单个动画</span></span><br><span class="line">    &lt;scale</span><br><span class="line">        android:startOffset=<span class="string">&quot;4000&quot;</span></span><br><span class="line">        android:duration=<span class="string">&quot;1000&quot;</span></span><br><span class="line">        android:fromXScale=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">        android:fromYScale=<span class="string">&quot;1.0&quot;</span></span><br><span class="line">        android:pivotX=<span class="string">&quot;50%&quot;</span></span><br><span class="line">        android:pivotY=<span class="string">&quot;50%&quot;</span></span><br><span class="line">        android:toXScale=<span class="string">&quot;0.5&quot;</span></span><br><span class="line">        android:toYScale=<span class="string">&quot;0.5&quot;</span> /&gt;</span><br><span class="line"><span class="comment">// 特别注意：</span></span><br><span class="line"><span class="comment">// 1. 在组合动画里scale缩放动画设置的repeatCount（重复播放）和fillBefore（播放完后，视图是否会停留在动画开始的状态）是无效的。</span></span><br><span class="line"><span class="comment">// 2. 所以如果需要重复播放或者回到原位的话需要在set标签里设置</span></span><br><span class="line"><span class="comment">// 3. 但是由于此处rotate旋转动画里已设置repeatCount为infinite，所以动画不会结束，也就看不到重播和回复原位</span></span><br><span class="line">&lt;/<span class="keyword">set</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>  它是一个接一个播放，可以通过设置repeatCount 达到同时播放的目的</p>
</li>
</ol>
<h5 id="监听动画"><a href="#监听动画" class="headerlink" title="监听动画"></a>监听动画</h5><ul>
<li>Animation.addListener</li>
<li>anim.addListener(new AnimatorListenerAdapter()</li>
</ul>
<h5 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h5><ol>
<li><p>Activity入场</p>
<p>activity_anim_enter.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    &lt;translate</span><br><span class="line">            android:duration= &quot;3000&quot;</span><br><span class="line">            android:fromXDelta=&quot;100%p&quot;</span><br><span class="line">            android:toXDelta=&quot;0%p&quot;/&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> activity_anim_exit.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    &lt;translate</span><br><span class="line">            android:duration= &quot;3000&quot;</span><br><span class="line">            android:fromXDelta=&quot;0%p&quot;</span><br><span class="line">            android:toXDelta=&quot;-100%p&quot;/&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="视图组（ViewGroup）动画"><a href="#视图组（ViewGroup）动画" class="headerlink" title="视图组（ViewGroup）动画"></a>视图组（ViewGroup）动画</h5><h5 id="插值器"><a href="#插值器" class="headerlink" title="插值器"></a>插值器</h5><p><a href="https://www.jianshu.com/p/2f19fe1e3ca1">https://www.jianshu.com/p/2f19fe1e3ca1</a></p>
<p><a href="https://blog.csdn.net/carson_ho/article/details/72827747">https://blog.csdn.net/carson_ho/article/details/72827747</a></p>
]]></content>
      <categories>
        <category>anim</category>
      </categories>
  </entry>
  <entry>
    <title>Architecture</title>
    <url>/2018/06/14/Architecture/</url>
    <content><![CDATA[<h5 id="Jetpack"><a href="#Jetpack" class="headerlink" title="Jetpack"></a>Jetpack</h5><p><img src="/2018/06/14/Architecture/2021-08-02_8.15_jetpack.png"></p>
<p>It helps to be familiar with software architectural patterns that separate data from the user interface, such as MVP or MVC</p>
<p><a href="https://developer.android.com/jetpack/docs/getting-started">https://developer.android.com/jetpack/docs/getting-started</a></p>
<ul>
<li>modules should interact</li>
</ul>
<p><img src="/2018/06/14/Architecture/final-architecture.png" alt="final-architecture"></p>
<ul>
<li>NetworkBoundResource</li>
</ul>
<p>It starts by observing the database for the resource. When the entry is loaded from the database for the first time, <code>NetworkBoundResource</code> checks whether the result is good enough to be dispatched or that it  should be re-fetched from the network. Note that both of these  situations can happen at the same time, given that you probably want to  show cached data while updating it from the network.</p>
<p><img src="/2018/06/14/Architecture/network-bound-resource.png" alt="final-architecture"></p>
<p><a href="https://developer.android.com/topic/libraries/architecture">https://developer.android.com/topic/libraries/architecture</a></p>
<p>架构学习从codelab开始吧!</p>
<p> <a href="https://www.jianshu.com/p/19f97654c451">https://www.jianshu.com/p/19f97654c451</a></p>
<p><a href="https://github.com/qingmei2/MVVM-Architecture">https://github.com/qingmei2/MVVM-Architecture</a></p>
<p><a href="https://juejin.im/post/5dafc49b6fb9a04e17209922">https://juejin.im/post/5dafc49b6fb9a04e17209922</a></p>
<p><a href="https://juejin.im/post/5d2be05ff265da1bd605d49a">https://juejin.im/post/5d2be05ff265da1bd605d49a</a></p>
<h6 id="LifecycleOwner"><a href="#LifecycleOwner" class="headerlink" title="LifecycleOwner"></a><strong>LifecycleOwner</strong></h6><p><a href="https://developer.android.com/reference/androidx/lifecycle/LifecycleOwner.html"><code>LifecycleOwner</code> is an interface </a>implemented by the <a href="https://developer.android.com/reference/androidx/appcompat/app/AppCompatActivity"><code>AppCompatActivity</code></a> and <a href="https://developer.android.com/reference/androidx/fragment/app/Fragment"><code>Fragment</code></a> classes. You can subscribe other components to owner objects which implement this interface, to observe changes to the lifecycle of the owner.</p>
<p>To read an introductory guide to this topic, see <a href="https://developer.android.com/topic/libraries/architecture/lifecycle.html">Handling Lifecycles</a>.</p>
<p><a href="https://codelabs.developers.google.com/codelabs/android-lifecycles/#1">https://codelabs.developers.google.com/codelabs/android-lifecycles/#1</a></p>
<p><a href="https://mp.weixin.qq.com/s/gQhBeKA2vGAkh3Tbqn0tEA">https://mp.weixin.qq.com/s/gQhBeKA2vGAkh3Tbqn0tEA</a></p>
<h6 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h6><p><a href="https://noteforme.github.io/2020/04/06/viewmodel/">https://noteforme.github.io/2020/04/06/viewmodel/</a></p>
<p><a href="https://www.jianshu.com/p/731ca42823ee">https://www.jianshu.com/p/731ca42823ee</a></p>
<p>viewmodelstoreowner</p>
<h6 id="navigation"><a href="#navigation" class="headerlink" title="navigation"></a>navigation</h6><p><a href="https://developer.android.com/guide/navigation/">https://developer.android.com/guide/navigation/</a></p>
<p><a href="https://developer.android.com/guide/navigation/navigation-getting-started">https://developer.android.com/guide/navigation/navigation-getting-started</a></p>
<p><a href="https://codelabs.developers.google.com/codelabs/android-navigation/index.html?index=../../index#0">https://codelabs.developers.google.com/codelabs/android-navigation/index.html?index=..%2F..%2Findex#0</a></p>
<p>Codelab 抽屉图标不显示</p>
<ul>
<li><p>BottomNavigationView 导航栏优化  recarete fragment</p>
<p><a href="https://medium.com/@freedom.chuks7/how-to-use-jet-pack-components-bottomnavigationview-with-navigation-ui-19fb120e3fb9">https://medium.com/@freedom.chuks7/how-to-use-jet-pack-components-bottomnavigationview-with-navigation-ui-19fb120e3fb9</a></p>
</li>
</ul>
<p><strong>NOTICE</strong> :  NavigationView each item ID is matching with fragment ID in navigation</p>
<p> <a href="https://jiangjiwei.site/post/navigation-zhi-fragment-qie-huan/">https://jiangjiwei.site/post/navigation-zhi-fragment-qie-huan/</a></p>
<p><a href="https://github.com/lwj1994/navigation-keep-state-fragment">https://github.com/lwj1994/navigation-keep-state-fragment</a></p>
<p><a href="https://github.com/STAR-ZERO/navigation-keep-fragment-sample">https://github.com/STAR-ZERO/navigation-keep-fragment-sample</a></p>
<p>Bottom tab定位</p>
<p><a href="https://stackoverflow.com/questions/50577356/android-jetpack-navigation-bottomnavigationview-with-youtube-or-instagram-like">https://stackoverflow.com/questions/50577356/android-jetpack-navigation-bottomnavigationview-with-youtube-or-instagram-like</a></p>
<p>全局共享</p>
<p><a href="https://github.com/googlesamples/android-architecture-components">googlesamples</a></p>
<h5 id="previously-architecture"><a href="#previously-architecture" class="headerlink" title="previously architecture"></a>previously architecture</h5><p>MVC MVP. MVVM三种架构介绍</p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/2017/1024/8636.html">http://www.jcodecraeer.com/a/anzhuokaifa/2017/1024/8636.html</a></p>
<p><a href="https://mp.weixin.qq.com/s/Kc1826MQ3ReMkoIWlsQGVw">https://mp.weixin.qq.com/s/Kc1826MQ3ReMkoIWlsQGVw</a></p>
<p><a href="https://juejin.im/post/5dafc49b6fb9a04e17209922">https://juejin.im/post/5dafc49b6fb9a04e17209922</a></p>
<p><a href="https://juejin.im/post/5dafc49b6fb9a04e17209922#heading-13">https://juejin.im/post/5dafc49b6fb9a04e17209922#heading-13</a></p>
<ul>
<li>MVP</li>
</ul>
<p><a href="https://juejin.im/entry/5955e7166fb9a06bc23a8598">https://juejin.im/entry/5955e7166fb9a06bc23a8598</a></p>
<p><a href="https://github.com/yaozs/YzsBaseActivity">https://github.com/yaozs/YzsBaseActivity</a></p>
<p>多个activity对p的复用</p>
<p><a href="https://juejin.im/post/599ce8016fb9a0247e4255f4">https://juejin.im/post/599ce8016fb9a0247e4255f4</a></p>
<ul>
<li>Component</li>
</ul>
<p><a href="https://mp.weixin.qq.com/s/8_8gGpkpO2QFNkWgSRBwIg">https://mp.weixin.qq.com/s/8_8gGpkpO2QFNkWgSRBwIg</a></p>
<p><a href="https://www.jianshu.com/p/6a50ef1ef45c">https://www.jianshu.com/p/6a50ef1ef45c</a></p>
<p><a href="https://developer.android.com/studio/build/dependencies#duplicate_classes">https://developer.android.com/studio/build/dependencies#duplicate_classes</a></p>
<p><a href="https://developer.android.com/studio/build/manifest-merge?hl=zh-cn">https://developer.android.com/studio/build/manifest-merge?hl=zh-cn</a></p>
<p>merge androidmanifest 合并</p>
<p>&lt;<a href="https://developer.android.com/studio/build/manifest-merge">https://developer.android.com/studio/build/manifest-merge</a></p>
<p><a href="https://www.jianshu.com/p/14a822e42151">https://www.jianshu.com/p/14a822e42151</a></p>
<p>compose</p>
<p><a href="https://mp.weixin.qq.com/s/0mAbKEuBH5HHYa23EcWalg">https://mp.weixin.qq.com/s/0mAbKEuBH5HHYa23EcWalg</a></p>
<p>lifecycle</p>
<p><a href="https://juejin.im/post/6847902220755992589">https://juejin.im/post/6847902220755992589</a></p>
<p>组件化 服务</p>
<p><a href="https://juejin.im/post/6884492604370026503">https://juejin.im/post/6884492604370026503</a></p>
]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
  </entry>
  <entry>
    <title>Assembly</title>
    <url>/2021/05/21/Assembly/</url>
    <content><![CDATA[<h4 id="8086-14个寄存器"><a href="#8086-14个寄存器" class="headerlink" title="8086 14个寄存器"></a>8086 14个寄存器</h4><p>AX , BX , CX , DX , SI , DI , SP , BP, IP , CS , SS, DS ,ES ,PSW</p>
<p>实验环境搭建</p>
<p><a href="https://github.com/froginwell/assembly">https://github.com/froginwell/assembly</a></p>
<p><a href="https://www.bilibili.com/s/video/BV1254y1B75r">https://www.bilibili.com/s/video/BV1254y1B75r</a></p>
<p><img src="/2021/05/21/Assembly/2021-05-20_19-06-09.png"></p>
<p>CS:IP  他们指示了CPU当前要读取指令的地址。</p>
<p>CS为代码段地址</p>
<p>IP 指令指针寄存器</p>
<p>jmp ax ,含义上类似 ： mov IP , ax</p>
<p><img src="/2021/05/21/Assembly/2021-05-21_17-22-59.png"></p>
<h4 id="第三章"><a href="#第三章" class="headerlink" title="第三章"></a>第三章</h4><h5 id="DS和address"><a href="#DS和address" class="headerlink" title="DS和address"></a>DS和address</h5><p>debug中，内存单元从左到右是地址从低到高顺序排列的。</p>
<p>8086CPU自动取ds中的数据为内存单元的段地址</p>
<h5 id="move-add-sub"><a href="#move-add-sub" class="headerlink" title="move , add , sub"></a>move , add , sub</h5><p><img src="/2021/05/21/Assembly/2021-05-21_19-21-51.png"></p>
<p>[0] ， 0表示内存单元的偏移地址</p>
<p>SS:SP 指向栈顶元素，栈顶的段地址存放在栈顶，偏移地址存放在SP中。</p>
<p><img src="/2021/05/21/Assembly/2021-05-22_16-18-16.png" alt="t"></p>
<h5 id="Loop"><a href="#Loop" class="headerlink" title="Loop"></a>Loop</h5><p>5.3 在Debug中跟踪用loop指令实现的循环程序 </p>
<p><img src="/2021/05/21/Assembly/2021-05-23_17-48-42.png"></p>
<p>​             </p>
<h4 id="实验四"><a href="#实验四" class="headerlink" title="实验四"></a>实验四</h4><p>  向内存0:200H<del>0:23fH依次传送数据0</del>63（3FH）</p>
<p>  内存0:200H~0:23fH空间与0020:0-0020:3f内存空间是一样的   (0:200  0020:0物理地址相同)                                                                                                                             </p>
<p><img src="/2021/05/21/Assembly/2021-05-24_14-59-10.png"></p>
<p>答案 </p>
<p><a href="https://www.cnblogs.com/Base-Of-Practice/category/1005745.html">https://www.cnblogs.com/Base-Of-Practice/category/1005745.html</a></p>
<p><a href="https://blackdragonf.github.io/2017/03/09/%E7%8E%8B%E7%88%BD%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%AC%AC%E4%B8%89%E7%89%88%E5%AE%9E%E9%AA%8C/">https://blackdragonf.github.io/2017/03/09/%E7%8E%8B%E7%88%BD%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%AC%AC%E4%B8%89%E7%89%88%E5%AE%9E%E9%AA%8C/</a></p>
<p> 视频 小甲鱼</p>
]]></content>
      <tags>
        <tag>Assembly</tag>
      </tags>
  </entry>
  <entry>
    <title>AutoDispose</title>
    <url>/2020/08/14/AutoDispose/</url>
    <content><![CDATA[<p><a href="https://uber.github.io/AutoDispose/">https://uber.github.io/AutoDispose/</a></p>
]]></content>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title>Binder</title>
    <url>/2019/08/11/Binder/</url>
    <content><![CDATA[<h4 id="IPC方式"><a href="#IPC方式" class="headerlink" title="IPC方式"></a>IPC方式</h4><p>信号量</p>
<p>共享内存 : 容易导致同步问题。因为用户端没法解决。</p>
<p>Socket</p>
<p>Binder: 服务端映射后， 官方解决了同步问题。</p>
<p><img src="/2019/08/11/Binder/2021-08-11_9.56_qustion1.png"></p>
<h4 id="多进程作用"><a href="#多进程作用" class="headerlink" title="多进程作用"></a>多进程作用</h4><p><img src="/2019/08/11/Binder/2021-08-11_8.40_function2.png"></p>
<h4 id="Binder流程"><a href="#Binder流程" class="headerlink" title="Binder流程"></a>Binder流程</h4><p>![](Binder/2021-08-11 _8.31_binder_over.png)</p>
<h4 id="Binder机制"><a href="#Binder机制" class="headerlink" title="Binder机制"></a>Binder机制</h4><h5 id="mmap作用"><a href="#mmap作用" class="headerlink" title="mmap作用"></a>mmap作用</h5><p>让一块虚拟内存 指向一块已知的物理内存。  这个物理内存是binder提供的。</p>
<p><img src="/2019/08/11/Binder/2021-08-11_9_binder_function.png"></p>
<h4 id="传统进程通信"><a href="#传统进程通信" class="headerlink" title="传统进程通信"></a>传统进程通信</h4><img src="/2019/08/11/Binder/2021-08-11_9.12_process_old.png" style="zoom: 33%;">



<h4 id="Binder进程通信"><a href="#Binder进程通信" class="headerlink" title="Binder进程通信"></a>Binder进程通信</h4><img src="/2019/08/11/Binder/2021-08-11_9.13_process_now.png" style="zoom:33%;">







<p><img src="/2019/08/11/Binder/2021-08-11_9.29.33_mmap.png"></p>
<h5 id="查看进程分配的内存大小"><a href="#查看进程分配的内存大小" class="headerlink" title="查看进程分配的内存大小"></a>查看进程分配的内存大小</h5><figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">AppledeMacBook-Pro:MineUtils apple<span class="symbol">$</span> adb shell</span><br><span class="line">generic_x86:/ <span class="symbol">$</span> getprop dalvik.vm.<span class="built_in">heapsize</span></span><br><span class="line"><span class="number">512</span>m</span><br></pre></td></tr></table></figure>

<p><a href="https://www.bilibili.com/video/BV1Hr4y1P7QC?from=search&amp;seid=18026610356055236655">https://www.bilibili.com/video/BV1Hr4y1P7QC?from=search&amp;seid=18026610356055236655</a></p>
<p><a href="https://www.bilibili.com/video/BV1Hr4y1P7QC?p=4">https://www.bilibili.com/video/BV1Hr4y1P7QC?p=4</a></p>
<p><a href="https://www.bilibili.com/video/BV1Hr4y1P7QC?p=5&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Hr4y1P7QC?p=5&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://github.com/weidongshan/APP_0005_Binder_JAVA_App">https://github.com/weidongshan/APP_0005_Binder_JAVA_App</a></p>
<p><a href="https://www.bilibili.com/video/BV1tW411i7aB?p=22">https://www.bilibili.com/video/BV1tW411i7aB?p=22</a></p>
]]></content>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>Bluetooth01</title>
    <url>/2018/07/04/Bluetooth01/</url>
    <content><![CDATA[<h4 id="蓝牙名称的由来"><a href="#蓝牙名称的由来" class="headerlink" title="蓝牙名称的由来"></a>蓝牙名称的由来</h4><ul>
<li> 蓝牙这个名称来自于第十世纪的一位丹麦国王Harald Blatand,Blatand在英文里的意思可以被解为蓝牙，</li>
</ul>
<p> 因为国王喜欢吃蓝梅，牙龈每天都是蓝色的所以叫牙.</p>
<ul>
<li>蓝牙这个标志的设计：它取自 Harald Bluetooth 名字中的「H」和「B」两个字母，用古北欧字母来表示，将这两者结合起来，就成为了蓝牙的 </li>
</ul>
<p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_logo.jpg" alt="bluetooth_20180705150628"></p>
<h5 id="蓝牙技术联盟"><a href="#蓝牙技术联盟" class="headerlink" title="蓝牙技术联盟"></a>蓝牙技术联盟</h5><p><a href="https://www.bluetooth.com/zh-cn">官网</a> </p>
<p>它负责蓝牙规范制定和推广的国际组织。做蓝牙相关产品的，少不了和它打交道。蓝牙技术联盟同时也拥有蓝牙商标，如果要使用，需要通过他们的授权。  Bluetooth SIG </p>
<h4 id="蓝牙个版本区别"><a href="#蓝牙个版本区别" class="headerlink" title="蓝牙个版本区别"></a>蓝牙个版本区别</h4><p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_20180705150628.png" alt="bluetooth_20180705150628"></p>
<p>​                 <a href="http://www.sohu.com/a/204758166_100040477">http://www.sohu.com/a/204758166_100040477</a> </p>
<h5 id="V1-0："><a href="#V1-0：" class="headerlink" title="V1.0："></a>V1.0：</h5><p>定义了蓝牙是一种低功耗的无线技术，传输率约在748~810kb/s，因是早期设计，容易受到同频率之产品所干扰下影响通讯质量。 </p>
<h5 id="V1-1"><a href="#V1-1" class="headerlink" title="V1.1"></a>V1.1</h5><p>所有设备都使用79个子频段在2.4GHz的频谱范围之内进行相互通信。此外，Bluetooth 1.1规范也修正了互不兼容的数据格式会引发Bluetooth 1.0设备之间的互操作性问题.</p>
<h5 id="V1-2"><a href="#V1-2" class="headerlink" title="V1.2"></a>V1.2</h5><p>增加了AFH可调式跳频技术这项技术，并主要针对现有蓝牙协议和802.11b/g之间的互相干扰问题进行了全面的改进，防止用户在同时使用支持蓝牙和无线局域网(WLAN)的两种装置的时候出现互相干扰的情况。</p>
<h5 id="V2-0"><a href="#V2-0" class="headerlink" title="V2.0"></a>V2.0</h5><ul>
<li>蓝牙2.0标准2.0 是 1.2 的改良提升版，传输率约在 1.8M/s~2.1M/s</li>
<li>开始支持双工模式——即一面作语音通讯，同时亦可以传输档案/高质素图片</li>
<li>2.0 版本当然也支持 Stereo 运作。</li>
</ul>
<h5 id="V2-1"><a href="#V2-1" class="headerlink" title="V2.1"></a>V2.1</h5><p>支持通过NFC（Near Field Communication，近距离通讯）进行配对，只需要将两个蓝牙设备靠近，按下一个键就可以配对了，配对密码将通过NFC进行传输，无需手动输入。</p>
<h5 id="V3-0"><a href="#V3-0" class="headerlink" title="V3.0"></a>V3.0</h5><p>核心是加入了“Generic Alternate MAC/PHY”（AMP），使蓝牙设备能最大限度的利用多种高速无线技术中更高的传输速率。这是一种全新的交替射频技术，允许蓝牙协议栈针对任一任务动态地选择正确的射频。</p>
<h5 id="4-0"><a href="#4-0" class="headerlink" title="4.0"></a>4.0</h5><p> 首先需要说明的是，发布于2010年的蓝牙4.0标准，本身就包含两个蓝牙标准——它包含传统蓝牙部分（也有称之为经典蓝牙Classic Bluetooth），也包含有低功耗蓝牙部分（Bluetooth Low Energy）。所以，毫无疑问的，低功耗蓝牙BLE属于蓝牙4.0！  </p>
<p> 蓝牙4.0的两个部分适用于不同的产品和应用场景，如传统蓝牙部分是在之前的1.0、2.0、3.0等基础上发展和完善起来的，主要用于和此前版本蓝牙1.0、2.0、3.0的兼容以及数据量比较大的传输，如语音，音乐，较高数据量传输等。 </p>
<p> 而低功耗蓝牙部分是在Nokia的Wibree标准上发展起来的。主要用于和蓝牙4.0以及更高标准版本的兼容 ，以及用于数据传输速率比较低的产品，如遥控类的，如鼠标，键盘，遥控鼠标(Air Mouse)，传感设备的数据发送，如心跳带，血压计，温度传感器等。  </p>
<p>由于蓝牙4.0集成了传统蓝牙和低功耗蓝牙两个标准，所以蓝牙4.0有双模和单模之分。双模即是传统蓝牙部分+低功耗蓝牙部分，单模即是单纯的低功耗蓝牙部分（BLE）。</p>
<p> 一台装配有蓝牙4.0双模模块的手机，当其配对连接的是蓝牙3.0设备时，其耗电量就会相对较高。若其配对的设备是智能手环等采用低功耗蓝牙模块的设备时，其功耗就非常低。针对一对一连接优化，并支持星形拓扑的一对多连接； <a href="https://www.jianshu.com/p/c96e0006b34d">https://www.jianshu.com/p/c96e0006b34d</a></p>
<ul>
<li>​    单模蓝牙</li>
</ul>
<p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_4ddf2.jpg" alt="bluetooth_4ddf2"></p>
<p>​                        </p>
<ul>
<li><pre><code> 双模蓝牙             
</code></pre>
</li>
</ul>
<p>  <img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cblue_b4316d821.jpg" alt="blue_b4316d821"></p>
<h5 id="V-4-1"><a href="#V-4-1" class="headerlink" title="V 4.1"></a>V 4.1</h5><ul>
<li><p>提升数据传输率</p>
<p>相比蓝牙4.0，蓝牙4.1单包数据传输最大值从20字节上调到23字节，提升了15%的数据传输率。根据该规则，大家可以尝试修改单包数据payload的值，如果该芯片只支持BT4.0，那么修改传输23字节要么会编译报错，要么传输过程中会丢包。</p>
</li>
<li><p>主从共存 central peripheral</p>
<p>链路层Link layer拓扑结构做了更新，允许单设备主从同时共存（时间片轮转方式），以及一主对多从设备的连接拓扑,当BLE作Central的时候可以一对多，但是作Peripheral的时候只能一对一。  例如智能手表可以作为发射方向手机发射身体健康指数，同时作为接收方连接到蓝牙耳机/手环或其他设备上 </p>
</li>
<li><p>支持32-Bit UUID</p>
<p>32-Bit UUID指的是广播包携带的UUID，并不是指我们所说的针对属性列表的16 bit and 128 bit UUID。可以通过广播的32-Bit UUID映射得到完整的128 Bit UUID从而使得广播包内有效广播数据长度更多。</p>
<p>长期睡眠下的自动唤醒功能。例如在佩戴手环游泳1小时后，回到更衣室手环会自动和手机建立连接传输数据，不需要任何操作 </p>
</li>
<li><p>通过IPv6建立网络连接。蓝牙设备只需要通过蓝牙4.1连接到可以上网的设备（如手机），就可以通过IPv6与云端的数据进行同步。即实现“云同步”不再需要wifi连接（wifi模块的成本通常更高，也更费电）。通过IPv6建立网络连接。蓝牙设备只需要通过蓝牙4.1连接到可以上网的设备（如手机），就可以通过IPv6与云端的数据进行同步。即实现“云同步”不再需要wifi连接（wifi模块的成本通常更高，也更费电）</p>
</li>
</ul>
<h5 id="V-4-2"><a href="#V-4-2" class="headerlink" title="V 4.2"></a>V 4.2</h5><ul>
<li><p><strong>LE连接安全</strong> </p>
<p>从Spec定义上蓝牙4.0和4.1的配对加密环节都是基于AES-CCM加密，但是由于蓝牙4.1双方共享同一密钥，所以存在被破解风险和漏洞。蓝牙4.2的pairing环节，采用Diffie-HellmanKey Exchange密钥交换算法进行加密，每一个设备有一对密钥对，公钥和私钥，私钥自己保存，公钥公开给对方，数据交互时，一方通过自己的私钥和对方的公钥进行加密文件，接收方通过自己私钥和传输方的公钥进行解密，从而有效的防止中间人破解密钥的事件发生。 </p>
</li>
<li><p><strong>隐私保护</strong> </p>
<p>蓝牙在广播过程中会携带自己的BD address (bluetooth device address)即为蓝牙唯一的MAC地址，在某些应用，比如物流追踪应用当中是非常有帮助的，可以根据BD address固定物流设备。</p>
<p>但是在某些应用不希望自己的BD address暴露在主端设备的监控下，蓝牙4.2给出了灵活的选择，蓝牙4.2规定，从机设备可以选择在广播模式下发送随机BD address，这样主端设备除了接该到设备之后才能获取其真实BD address，除此该设备广播模式的BD address为随机序列。</p>
</li>
<li><p><strong>大数据传输</strong> </p>
<p>蓝牙4.1最大支持23字节单包数据传输，蓝牙4.2最大支持255字节单包数据传输，极大提升了数据传输率。详细可以参考我写的另外一篇文章《提升蓝牙4.2数据传输率的办法 - ATT_MTU》。 </p>
</li>
</ul>
<h5 id="5-0"><a href="#5-0" class="headerlink" title="5.0"></a>5.0</h5><ul>
<li><p><strong>传输距离更快、距离更远</strong> </p>
<p>蓝牙 5.0 和前一代蓝牙 4.2 相比，它的传输距离更远、速度更快。理论上的有效距离是 300 米，也就是整个家庭或整间办公室里的移动设备都可以稳定连结。而速度最快则是可以达到 2Mbps，让反应更快、性能更高的蓝牙设备更有可能被使用。除此之外，它还大幅增强了蓝牙广播的数据传输，能为商用蓝牙带来更好的前景，让使用蓝牙做为标准的物联网应用更加强大，可以向下相容旧版本产品 。</p>
</li>
<li><p><strong>蓝牙 Mesh 技术改变传输应用</strong> </p>
<p>蓝牙技术联盟（Bluetooth SIG）日前宣布推出蓝牙 Mesh 技术，这项技术将打破传统蓝牙设备间“一对一”的配对转变成“多对多”的讯号传输模式，除了应用在蓝牙 5.0，也会扩展到过往版本。蓝牙技术联盟表示，蓝牙 Mesh 技术是基于低功耗蓝牙技术推出的新网络技术，将为商用和工业用设备网络带来转变，也能让现有的物联网技术更加完整、稳定。 </p>
</li>
<li></li>
</ul>
<p><a href="http://www.eet-china.com/news/article/201711190911">http://www.eet-china.com/news/article/201711190911</a></p>
<h5 id="蓝牙5-0和wifi的区别"><a href="#蓝牙5-0和wifi的区别" class="headerlink" title="蓝牙5.0和wifi的区别"></a>蓝牙5.0和wifi的区别</h5><ul>
<li><p>WIFI</p>
<p>Wi-Fi 的一大缺陷就是有距离限制，包括过去一对一蓝牙网络在内的传统无线网络，都会受两台设备距离的限制。以 Wi-Fi 来说，有效的传输距离为 50 平方米以内，除非你装中继设备，一旦离开这个区域，你的手机就失去用武之地。</p>
<p>除此之外，Wi-Fi 还有耗电问题，你的手机就算是把屏幕关闭，还是得一天充一次电，Wi-Fi 是一个很重要的因素。</p>
</li>
<li><p>蓝牙 Mesh </p>
<p>“蓝牙 Mesh”找到一个聪明的解决办法。这些设备彼此间连接，并将信号传递给附近另一个设备，形成中继资料传输的互连设备网络或网格。这意味着讯息从一个设备传递到另一个设备，再到下一个设备，接力传输。 </p>
</li>
</ul>
<p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_20180705175518.png" alt="bluetooth_20180705150628"></p>
<p><strong>▲ 左图为传统 Wi-Fi 的连接方式，必须要有一个 Hub 连系其他设备，因此有距离限制。右图则是蓝牙 Mesh 的方式，越多设备连到这个网络上，范围就会越广。</strong> </p>
<p>与传统的交换式网络相比，无线Mesh网络去掉了节点之间的布线需求，但仍具有分布式网络所提供的冗余机制和重新路由功能。在无线Mesh网络里，如果要添加新的设备，只需要简单地接上电源就可以了，它可以自动进行自我配置，并确定最佳的多跳传输路径。添加或移动设备时，网络能够自动发现拓扑变化，并自动调整通信路由，以获取最有效的传输路径。  </p>
<p>透过这种接力传输，形成一个无需大量电力消耗或天线广布的可靠网络。蓝牙设备之间可不透过 Wi-Fi 网络就能实现设备与设备的“对话”。换句话说，智能设备采用这种技术，在有限范围内就能完成设备间的沟通，并利用手机等设备来控制。</p>
<p>过去因为家中需要有一个 Hub 连接其他设备，因此有 Google、Apple、Amazon 等这些“语音助手”出现，用这些当成控制中枢。但蓝牙 Mesh 架构下，你不需要另外一个“中枢”，用智能手机就可以掌握一切。家中的蓝牙设备建构自己的网络，手机只要与其中一个蓝牙设备取得联系，就可以控制全家（整个建筑物）设备，监控这些设备的状态。</p>
<p>由于 Mesh 网络不需复杂设定、配对或使用路由器等存取设备，因此并不会造成安装负担，反观采用其他智慧家庭联网技术如 ZigBee、Z-wave 或其他厂商间自有的通讯技术，多需加装闸道器（Gateway）才能确保各种设备沟通无虞。</p>
<ul>
<li><p>蓝牙 Mesh 工作原理：为什么还是无法取代 Wi-Fi？</p>
<p>蓝牙 BLE 通讯协议中，GAP 层（Generic Access Profile）用来控制决定蓝牙设备的扫描、广播和连接等关系，也就是说，GAP 决定蓝牙设备怎样与其他设备连接、被其他设备看到等流程。 在蓝牙 mesh 出现之前，GAP 有一个典型的父子网络关系，其中“父”端决定所有路由，“子”端执行分配的任务。 例如，当你将蓝牙键盘连接到平板电脑，平板为父端、键盘为子端。</p>
<p>GAP 使你的设备被其他设备看见，并决定你的设备是否可以或怎样与其他设备互动。例如常用在室内定位的 Beacon 设备就只是向外广播，不支持连接。智能手环等设备，就可以与你的手机设备连接。</p>
<p>从蓝牙 4.1 开始，GAP 扩大了蓝牙设备的网络能力。蓝牙设备可兼具“父”和“子”的功能，使所有设备能直接连接和广播到任何其他设备。蓝牙也因此适用传输范围内和传输范围外的所有设备。</p>
<p>正是上述这种能直接或间接连接任何数量有 Mesh 功能的设备，因此理论上建构一个长达几公里范围的 Mesh 网络也不是不可能。 如果网络中每个设备都在其他至少一个设备的广播范围内，Mesh 网络理论上可覆盖无限距离。</p>
<p>在这情况下，灯泡就可能成为一个家庭主要 Mesh 网络设备之一，因为一个家庭或是建筑，几乎每个角落都有光线覆盖的需要，因此灯泡就会以保持一定距离的方式连续安装。如果每个灯泡都是蓝牙 Mesh 设备，那么这个网络就得以全面覆盖建筑物。</p>
<p>蓝牙 Mesh 网络不仅有低功耗，还有低频宽的特色。这听起来好像是个缺点？其实不然。 由于蓝牙 Mesh 网络不是用来让你发送影音资料，主要是用来传递维护连接或发送命令，发送一个“关闭”或“打开”的指定，用不到多少频宽。这就是为什么蓝牙 Mesh 网络虽然范围无远弗届，但无法完全取代 Wi-Fi。 乍看很像，但仔细了解后，你会发现它们适合不同的利基市场。</p>
<p><a href="http://www.icsmart.cn/13985/">http://www.icsmart.cn/13985/</a></p>
<p><a href="https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection">https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>BLE</category>
      </categories>
  </entry>
  <entry>
    <title>Bluetooth03</title>
    <url>/2018/06/11/Bluetooth03/</url>
    <content><![CDATA[<h4 id="经典蓝牙-低功耗蓝牙的区别"><a href="#经典蓝牙-低功耗蓝牙的区别" class="headerlink" title="经典蓝牙 低功耗蓝牙的区别"></a>经典蓝牙 低功耗蓝牙的区别</h4><p><a href="http://www.loverobots.cn/the-analysis-is-simple-compared-with-the-classic-bluetooth-and-bluetooth-low-energy-in-android.html">http://www.loverobots.cn/the-analysis-is-simple-compared-with-the-classic-bluetooth-and-bluetooth-low-energy-in-android.html</a></p>
<p><a href="https://juejin.im/post/59964187f265da249600af68">蓝牙适配建议</a></p>
<ul>
<li> 蓝牙低功耗</li>
</ul>
<p>  ​    Android 4.3 为发挥核心作用的<a href="https://developer.android.com/guide/topics/connectivity/bluetooth-le.html?hl=zh-cn">蓝牙低功耗</a>（<em>蓝牙 LE</em>）引入了平台支持。在 Android 5.0 中，Android 设备现在可以发挥蓝牙 LE <em>外围设备</em>的作用。应用可以利用此功能让附近设备发现它。例如，您可以开发这样的应用：让设备发挥计步器或健康监测仪的作用，并与其他蓝牙 LE 设备进行数据通信。</p>
<p>  新增的 <code>android.bluetooth.le</code> API 让您的应用可以发布广告、扫描响应以及与附近的蓝牙 LE 设备建立连接。要使用新增的广告和扫描功能，请在您的清单中添加 <code>BLUETOOTH_ADMIN</code> 权限。当用户更新您的应用或从 Play 商店下载您的应用时，会被要求向您的应用授予以下权限：“Bluetooth connection information:Allows the app to control Bluetooth, including broadcasting to or getting information about nearby Bluetooth devices.”</p>
<p>  要启动蓝牙 LE 广播，以便其他设备能发现您的应用，请调用 <code>startAdvertising()</code>，并传入 <code>AdvertiseCallback</code> 类的实现。回调对象会收到广播操作成功或失败的报告。</p>
<p>  Android 5.0 引入了 <code>ScanFilter</code> 类，让您的应用可以只扫描其感兴趣的特定类型设备。要开始扫描蓝牙 LE 设备，请调用 <code>startScan()</code>，并传入筛选器列表。在方法调用中，您还必须提供 <code>ScanCallback</code> 的实现，以便在发现蓝牙 LE 广播时进行报告。</p>
<h3 id="蓝牙基本操作"><a href="#蓝牙基本操作" class="headerlink" title="蓝牙基本操作"></a>蓝牙基本操作</h3><h4 id="蓝牙权限"><a href="#蓝牙权限" class="headerlink" title="蓝牙权限"></a>蓝牙权限</h4><figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">&quot;android.permission.BLUETOOTH&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>如果您希望您的应用启动设备发现或操作蓝牙设置，则还必须声明 <code>BLUETOOTH_ADMIN</code> 权限。 大多数应用需要此权限仅仅为了能够发现本地蓝牙设备。 除非该应用是将要应用户请求修改蓝牙设置的“超级管理员”，否则不应使用此权限所授予的其他能力。 <strong>注</strong>：如果要使用 <code>BLUETOOTH_ADMIN</code> 权限，则还必须拥有 <code>BLUETOOTH</code> 权限。 如打开关闭蓝牙</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">&quot;android.permission.BLUETOOTH_ADMIN&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h5 id="6-0权限"><a href="#6-0权限" class="headerlink" title="6.0权限"></a>6.0权限</h5><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>/&gt;</span><br><span class="line">&lt;uses-permission android:<span class="attribute">name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<h5 id="设置蓝牙"><a href="#设置蓝牙" class="headerlink" title="设置蓝牙"></a>设置蓝牙</h5><ol>
<li><p>判断设备是否支持</p>
<p><a href="https://developer.android.com/reference/android/bluetooth/BluetoothAdapter.html?hl=zh-cn">BluetoothAdapter</a> </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">mBluetoothAdapter = <span class="module-access"><span class="module"><span class="identifier">BluetoothAdapter</span>.</span></span>get<span class="constructor">DefaultAdapter()</span>;</span><br><span class="line">BluetoothAdapter mBluetoothAdapter = <span class="module-access"><span class="module"><span class="identifier">BluetoothAdapter</span>.</span></span>get<span class="constructor">DefaultAdapter()</span>;</span><br><span class="line"><span class="keyword">if</span> (mBluetoothAdapter<span class="operator"> == </span>null) &#123;</span><br><span class="line">    <span class="comment">// Device does not support Bluetooth</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>启用蓝牙</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (mBluetoothAdapter==<span class="keyword">null</span>||!mBluetoothAdapter.isEnabled())&#123;</span><br><span class="line">       Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;设备不支持蓝牙权限&quot;</span>,Toast.LENGTH_SHORT).<span class="keyword">show</span>();</span><br><span class="line"> &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">       Toast.makeText(<span class="keyword">this</span>,<span class="string">&quot;支持设备&quot;</span>,Toast.LENGTH_SHORT).<span class="keyword">show</span>();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="查找设备"><a href="#查找设备" class="headerlink" title="查找设备"></a>查找设备</h4><p>5.0以下的方式就不贴出来了，代码里有</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * android5.0以上使用</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  @<span class="constructor">RequiresApi(<span class="params">api</span> = Build.VERSION_CODES.LOLLIPOP)</span></span><br><span class="line">  <span class="keyword">private</span>  void  scan<span class="constructor">Devices()</span>&#123;</span><br><span class="line">      BluetoothLeScanner mBluetoothScanner = mBluetoothAdapter.get<span class="constructor">BluetoothLeScanner()</span>;</span><br><span class="line">      mBluetoothScanner.start<span class="constructor">Scan(<span class="params">scanCallback</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ScanCallback scanCallback = <span class="keyword">new</span> <span class="constructor">ScanCallback()</span> &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public void on<span class="constructor">ScanResult(<span class="params">int</span> <span class="params">callbackType</span>, ScanResult <span class="params">result</span>)</span> &#123;</span><br><span class="line">          super.on<span class="constructor">ScanResult(<span class="params">callbackType</span>, <span class="params">result</span>)</span>;</span><br><span class="line">          <span class="comment">//把byte数组转成16进制字符串，方便查看</span></span><br><span class="line">          <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>e(TAG,<span class="string">&quot;onScanResult :&quot;</span>+result.get<span class="constructor">ScanRecord()</span>.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">          BluetoothDevice device = result.get<span class="constructor">Device()</span>;</span><br><span class="line">          blueAdapter.add<span class="constructor">Device(<span class="params">device</span>)</span>;</span><br><span class="line">          </span><br><span class="line">          ScanRecord scanRecord = result.get<span class="constructor">ScanRecord()</span>;</span><br><span class="line">          <span class="built_in">int</span> rssi = result.get<span class="constructor">Rssi()</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      public void on<span class="constructor">BatchScanResults(List&lt;ScanResult&gt; <span class="params">results</span>)</span> &#123;</span><br><span class="line">          super.on<span class="constructor">BatchScanResults(<span class="params">results</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      @Override</span><br><span class="line">      public void on<span class="constructor">ScanFailed(<span class="params">int</span> <span class="params">errorCode</span>)</span> &#123;</span><br><span class="line">          super.on<span class="constructor">ScanFailed(<span class="params">errorCode</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="连接设备"><a href="#连接设备" class="headerlink" title="连接设备"></a>连接设备</h5><p>蓝牙设备经常处于关机状态，先调用下面方法</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">BluetoothDevice remoteDevice = adapter.get<span class="constructor">RemoteDevice(<span class="params">address</span>)</span>;</span><br></pre></td></tr></table></figure>

 <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">remoteDevice.connect<span class="constructor">Gatt(<span class="params">context</span>, <span class="params">true</span>, <span class="params">mGattCallback</span>)</span>;<span class="comment">//参数1：上下文。</span></span><br><span class="line">                                                       <span class="comment">//参数2：是否自动连接（当设备可以用时）</span></span><br><span class="line">                                                       <span class="comment">//参数3：连接回调。</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/Free-Thinker/p/11507349.html">https://www.cnblogs.com/Free-Thinker/p/11507349.html</a></p>
<p><strong>6、关于autoConnect参数为true的意义？</strong></p>
<p>在蓝牙核心文档Vol3: Core System Package[Host volume]-&gt;Part C: Generic  Access Profile的Connection Modes and Procedures章节中有涉及到自动连接建立规程(Auto  Connection Establishment Procedure)的定义。</p>
<p>自动连接建立规程用来向多个设备同时发起连接。一个中央设备的主机与多个外围设备绑定，只要它们开始广播，便立刻与其建立连接。跟多细节请参考蓝牙核心文档和协议栈源码。</p>
<p>回调</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> BluetoothGattCallback mGattCallback = <span class="keyword">new</span> <span class="constructor">BluetoothGattCallback()</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Callback indicating when GATT client has connected/disconnected to/from a remote GATT server</span></span><br><span class="line"><span class="comment">     * @param gatt     返回连接建立的gatt对象</span></span><br><span class="line"><span class="comment">     * @param status   返回的是此次gatt操作的结果，成功了返回0</span></span><br><span class="line"><span class="comment">     * @param newState 每次client连接或断开连接状态变化，STATE_CONNECTED 0，STATE_CONNECTING 1,STATE_DISCONNECTED 2,STATE_DISCONNECTING 3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">ConnectionStateChange(BluetoothGatt <span class="params">gatt</span>, <span class="params">int</span> <span class="params">status</span>, <span class="params">int</span> <span class="params">newState</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">ConnectionStateChange(<span class="params">gatt</span>, <span class="params">status</span>, <span class="params">newState</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span> (newState<span class="operator"> == </span>BluetoothProfile.STATE_CONNECTED) &#123;</span><br><span class="line">            gatt.discover<span class="constructor">Services()</span>;        <span class="comment">//连接成功， 开始搜索服务</span></span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, <span class="string">&quot;onConnectionStateChange  连接成功&quot;</span> + status);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Callback invoked when the list of remote services, characteristics and descriptors for the remote device have been updated, ie new services have been discovered.</span></span><br><span class="line"><span class="comment">     * @param gatt   返回的是本次连接的gatt对象</span></span><br><span class="line"><span class="comment">     * @param status</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">ServicesDiscovered(BluetoothGatt <span class="params">gatt</span>, <span class="params">int</span> <span class="params">status</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">ServicesDiscovered(<span class="params">gatt</span>, <span class="params">status</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, <span class="string">&quot;onServicesDiscovered status&quot;</span> + status);</span><br><span class="line">        List&lt;BluetoothGattService&gt; mServiceList = gatt.get<span class="constructor">Services()</span>;</span><br><span class="line">        <span class="keyword">for</span> (BluetoothGattService service : mServiceList) &#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, <span class="string">&quot;onServicesDiscovered &quot;</span> + service.get<span class="constructor">Uuid()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        BluetoothGattService service = gatt.get<span class="constructor">Service(UUID.<span class="params">fromString</span>(GATT_SERVICE_PRIMARY_1)</span>);</span><br><span class="line">        BluetoothGattCharacteristic characterisetic = service.get<span class="constructor">Characteristic(UUID.<span class="params">fromString</span>(CHARACTERISTIC_NOTIFY_1)</span>);</span><br><span class="line">        <span class="comment">//调用以便当命令发送后返回信息可以自动返回</span></span><br><span class="line">        BluetoothGattDescriptor descriptor = characterisetic.get<span class="constructor">Descriptor(CCC)</span>;</span><br><span class="line">        descriptor.set<span class="constructor">Value(BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE)</span>;</span><br><span class="line">        gatt.write<span class="constructor">Descriptor(<span class="params">descriptor</span>)</span>;</span><br><span class="line">        boolean isNotify = gatt.set<span class="constructor">CharacteristicNotification(<span class="params">characterisetic</span>, <span class="params">true</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//回调响应特征写操作的结果。</span></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">CharacteristicWrite(BluetoothGatt <span class="params">gatt</span>, BluetoothGattCharacteristic <span class="params">characteristic</span>, <span class="params">int</span> <span class="params">status</span>)</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, gatt.get<span class="constructor">Device()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot; write successfully&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="comment">//回调响应特征读操作的结果。</span></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">CharacteristicRead(BluetoothGatt <span class="params">gatt</span>, BluetoothGattCharacteristic <span class="params">characteristic</span>, <span class="params">int</span> <span class="params">status</span>)</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, gatt.get<span class="constructor">Device()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot; recieved &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">CharacteristicChanged(BluetoothGatt <span class="params">gatt</span>, BluetoothGattCharacteristic <span class="params">characteristic</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">CharacteristicChanged(<span class="params">gatt</span>, <span class="params">characteristic</span>)</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, <span class="string">&quot;The response is &quot;</span> + <span class="string">&quot;onCharacteristicChanged&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="/2018/06/11/Bluetooth03/E:/noteforme.github.io\source_posts\Bluetooth03\Android-BLE-in-Action.026.jpeg"></p>
<h5 id="Android-中-GATT-操作的流程"><a href="#Android-中-GATT-操作的流程" class="headerlink" title="Android 中 GATT 操作的流程"></a>Android 中 GATT 操作的流程</h5><p><img src="/2018/06/11/Bluetooth03/Bluetooth03%5CAndroid-BLE-in-Action.028.jpeg" alt="droid-BLE-in-Acti"></p>
<p> Android 中 GATT 操作的流程。右边这个图，APP 是我们的应用，右边蓝牙服务端，从左向右箭头是 APP 发起的请求，从右向左的箭头是回调。我们看到所有的操作都是异步的完成的。连接过程是，首先使用 gattConnect 发起连接，收到 onConnectionStateChange() 通知连接是否成功，若成功，则进行下一步的 discoverService()，这一步就是发现设备所有的 GATT Service，若发现成功，通过 onServiceDiscovered() 回调，这时才算真正的连接成功。然后可以通过 BluetoothGatt 的 getService() 来获得BluetoothGattService，进而获得BluetoothGattCharacteristic 等，然后对 Characteristic 进行读写。 </p>
<ul>
<li><p>office</p>
<p><a href="https://developer.android.com/guide/topics/connectivity/bluetooth?hl=zh-cn">https://developer.android.com/guide/topics/connectivity/bluetooth?hl=zh-cn</a></p>
<p><a href="https://developer.android.com/guide/topics/connectivity/bluetooth-le?hl=zh-cn">https://developer.android.com/guide/topics/connectivity/bluetooth-le?hl=zh-cn</a></p>
<p><a href="https://github.com/googlesamples/android-BluetoothLeGatt">官方demo android5.0已过时</a></p>
<p><a href="https://source.android.google.cn/devices/bluetooth/">https://source.android.google.cn/devices/bluetooth/</a></p>
</li>
<li><p>un</p>
<p><a href="https://juejin.im/entry/5919630444d904006c6e14ca">https://juejin.im/entry/5919630444d904006c6e14ca</a></p>
<p><a href="https://www.jianshu.com/p/29a730795294">https://www.jianshu.com/p/29a730795294</a></p>
<p><a href="https://www.jianshu.com/p/046c1f5a7163">https://www.jianshu.com/p/046c1f5a7163</a></p>
</li>
</ul>
<h4 id="设备通知手机"><a href="#设备通知手机" class="headerlink" title="设备通知手机"></a>设备通知手机</h4><p>5 当你从文档看到遍历出来的UUID有接送通知的功能。这时你就可以设置可以接收通知。通过拿到对应通知UUID的BluetoothGattCharacteristic，调用setCharacteristicNotification().其中00002902-0000-1000-8000-00805f9b34fb是系统提供接受通知自带的UUID，通过设置BluetoothGattDescriptor相当于设置BluetoothGattCharacteristic的Descriptor属性来实现通知，这样只要蓝牙设备发送通知信号，就会回调onCharacteristicChanged(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic) 方法，这你就可以在这方法做相应的逻辑处理。 </p>
<p><a href="https://juejin.im/entry/58c74fc42f301e006bce23fb">https://juejin.im/entry/58c74fc42f301e006bce23fb</a></p>
<h4 id="经典蓝牙开发"><a href="#经典蓝牙开发" class="headerlink" title="经典蓝牙开发"></a>经典蓝牙开发</h4><p><a href="https://www.jianshu.com/p/453a5cda5646">https://www.jianshu.com/p/453a5cda5646</a></p>
<ul>
<li><p>设置 00002902-0000-1000-8000-00805f9b34fb</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* 设置特征信息推送 */</span></span><br><span class="line">··· BluetoothGattCharacteristic characteristic;</span><br><span class="line">    mGatt.set<span class="constructor">CharacteristicNotification(<span class="params">characteristic</span>,<span class="params">true</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* CCCD 的UUID */</span></span><br><span class="line"><span class="keyword">private</span> UUID ID_CCCD = <span class="module-access"><span class="module"><span class="identifier">UUID</span>.</span></span>from<span class="constructor">String(<span class="string">&quot;00002902-0000-1000-8000-00805f9b34fb&quot;</span>)</span>;  </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 获取CCCD */</span></span><br><span class="line">BluetoothGattDescriptor cccd = characteristic.get<span class="constructor">Descriptor(ID_CCCD)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置推送通知，参考值为：</span></span><br><span class="line"><span class="comment"> * BluetoothGattDescriptor.ENABLE_NOTIFICATION_VALUE:   通知</span></span><br><span class="line"><span class="comment"> * BluetoothGattDescriptor.ENABLE_INDICATION_VALUE:     指示</span></span><br><span class="line"><span class="comment"> * BluetoothGattDescriptor.DISABLE_NOTIFICATION_VALUE:  关闭</span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line">cccd.set<span class="constructor">Value(参考值)</span>;</span><br><span class="line"><span class="comment">/* 写入CCCD */</span></span><br><span class="line">mGatt.write<span class="constructor">Descriptor(<span class="params">descriptor</span>)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.jianshu.com/p/43b1956d9f5c">https://www.jianshu.com/p/43b1956d9f5c</a></p>
<p>官方三个蓝牙示例 :<a href="https://github.com/googlesamples?utf8=%E2%9C%93&amp;q=bluetooth&amp;type=&amp;language=">https://github.com/googlesamples?utf8=%E2%9C%93&amp;q=bluetooth&amp;type=&amp;language=</a></p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>扫描不到任何设备</p>
<p><a href="https://stackoverflow.com/questions/39646253/android-stops-finding-ble-devices-onclientregistered-status-133-clientif-0">https://stackoverflow.com/questions/39646253/android-stops-finding-ble-devices-onclientregistered-status-133-clientif-0</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>BLE</category>
      </categories>
  </entry>
  <entry>
    <title>Bluetooth04</title>
    <url>/2020/04/26/Bluetooth04/</url>
    <content><![CDATA[<h5 id="蓝牙问题汇总"><a href="#蓝牙问题汇总" class="headerlink" title="蓝牙问题汇总"></a>蓝牙问题汇总</h5><p><a href="https://race604.com/android-ble-in-action/">https://race604.com/android-ble-in-action/</a></p>
<ol>
<li>连接断开之后可以根据实际情况进行重连，但如果是连接失败的情况，建议不要立即重连，而是调用<code>void closeBluetoothGatt()</code>清空一下状态，并延迟一段时间等待复位，否则会把gatt阻塞，导致手机不重启蓝牙就再也无法连接任何设备的严重情况。</li>
</ol>
<p>  <a href="https://github.com/Jasonchenlijian/FastBle/blob/master/README_1.2.x.md">https://github.com/Jasonchenlijian/FastBle/blob/master/README_1.2.x.md</a></p>
<ol start="2">
<li><p>每当设备断开连接时，请确保在BluetoothGatt对象上调用close()并将其设置为null,</p>
<p>解决方法:始终在断开连接时关闭gatt实例，并在每次连接时创建一个新的gatt实例。</p>
<p>在<code>onLeScan(..)</code>中启动一个新线程，然后进行连接</p>
<p><a href="https://stackoom.com/question/1Cyqr/Android-%E8%93%9D%E7%89%99%E4%BD%8E%E5%8A%9F%E8%80%97%E4%B8%8D%E7%A8%B3%E5%AE%9A">https://stackoom.com/question/1Cyqr/Android-%E8%93%9D%E7%89%99%E4%BD%8E%E5%8A%9F%E8%80%97%E4%B8%8D%E7%A8%B3%E5%AE%9A</a></p>
</li>
</ol>
<p>BluetoothLeScanner: could not find callback wrapper</p>
<ol start="3">
<li><p>连接失败处理</p>
<p>分两个平台来说，iOS端也有连接失败的委托，但是好像几乎不会发生这种情况，至少我从来没遇见过，而对于同款设备，android常常会出现连接失败的情况，<code>status != BluetoothGatt.GATT_SUCCESS</code>  ，android端开发请不要把连接失败和断开连接放在一块处理，因为断开连接可以直接尝试重新连接，而连接失败后尝试重新连接，需要加一些延时，并且需要gatt.close，清空一下状态，否则会把gatt阻塞导致手机不重启蓝牙就再也无法连接任何设备的情况。</p>
</li>
</ol>
<p><a href="http://liuyanwei.jumppo.com/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html">http://liuyanwei.jumppo.com/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html</a></p>
<ol start="4">
<li>扫描广播包</li>
</ol>
<p>所有外设，只有在发出广播包的情况下，才能被central发现，绝大多数情况下，外设被连接后就不会发出广播（也有例外），很多人遇到无法找到设备的问题，大多属于这种情况。 重复扫描问题——————</p>
<p><a href="http://liuyanwei.jumppo.com/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html">http://liuyanwei.jumppo.com/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html</a></p>
<ol start="5">
<li><p>Android 7+ will stop scanning if it continues without stopping at all  for 30 minutes or more. This was added as a feature to prevent battery  drain in case developers had inadvertently or abusively left scanning on forever.</p>
<p><a href="https://github.com/AltBeacon/android-beacon-library/issues/528">https://github.com/AltBeacon/android-beacon-library/issues/528</a></p>
</li>
</ol>
<p><a href="https://blog.csdn.net/m0_37796683/article/details/83657204">https://blog.csdn.net/m0_37796683/article/details/83657204</a></p>
<ol start="6">
<li><p>status 133</p>
<p><a href="https://blog.csdn.net/baidu_26352053/article/details/54571688">https://blog.csdn.net/baidu_26352053/article/details/54571688</a></p>
</li>
<li><p>unregisterApp() - mClientIf=5</p>
</li>
<li><p> filter</p>
</li>
</ol>
<p>   <a href="https://juejin.im/post/5d37d4d6f265da1bc414958a">https://juejin.im/post/5d37d4d6f265da1bc414958a</a></p>
<ol start="9">
<li><p>防止Android7中的BLE扫描滥用，从而做了一些限制，即不要在30s内对蓝牙扫描<br>重复开启-关闭超过5次。</p>
<p><a href="https://blog.classycode.com/undocumented-android-7-ble-behavior-changes-d1a9bd87d983">https://blog.classycode.com/undocumented-android-7-ble-behavior-changes-d1a9bd87d983</a></p>
</li>
</ol>
<ul>
<li>蓝牙添加扫描间隔</li>
</ul>
<p>​    <a href="https://github.com/haodynasty/AndroidBleManager">https://github.com/haodynasty/AndroidBleManager</a></p>
<p>​    <a href="https://github.com/AltBeacon/android-beacon-library">https://github.com/AltBeacon/android-beacon-library</a></p>
<h3 id="应用如何做自动重连"><a href="#应用如何做自动重连" class="headerlink" title="应用如何做自动重连"></a>应用如何做自动重连</h3><p>其实自动重连比想象的要简单许多，无论是android还是ios端，只需要在设备断开连接的委托方法中，重新调用gatt.connet或者是centralManager.connet方法就可以了，无论当时设备是否有点，是否在周围，当设备再次开会或者连接到可连接范围内，都会自动被连上，就是这么简单。</p>
<p><a href="http://liuyanwei.jumppo.com/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html">http://liuyanwei.jumppo.com/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html</a></p>
<p>Intent mIntent = new Intent(BluetoothAdapter.ACTION_REQUEST_ENABLE);<br>startActivityForResult(mIntent, 1);</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">mBluetoothAdapter.<span class="builtin-name">enable</span>();</span><br><span class="line">mBluetoothAdapter.<span class="builtin-name">disable</span>();</span><br></pre></td></tr></table></figure>

<p> <a href="https://blog.csdn.net/u014418171/article/details/81219297">https://blog.csdn.net/u014418171/article/details/81219297</a></p>
<p>扫描</p>
<p>过滤</p>
<p><strong>Scanning by device name</strong></p>
<p>Looking for a device by it’s name has 2 main use cases: to look for 1 specific device or to look for 1 specific device model. For example, my Polar H7 chest strap advertises itself as “Polar H7 391BB014”. The latter part (‘391BB014’) is a unique number (or serial number) and the first part is generic for all Polar H7 devices. This is very common practice. Unfortunately the device name scan filter can only be used to find specific devices as it does full string matching. If you want to find all Polar H7 devices you will need to do a ‘substring’ compare on ‘Polar H7’, but you can’t do that with a filter. You just need to pass <code>null</code> as the filter and do the substring comparison yourself in <code>onScanResult</code>.</p>
<p>So here is an example of how to scan for devices by <strong>exact</strong> name</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">String</span>[] names = <span class="keyword">new</span> <span class="keyword">String</span>[]&#123;<span class="string">&quot;Polar H7 391BB014&quot;</span>&#125;;</span><br><span class="line">List&lt;ScanFilter&gt; filters = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">if</span>(names != <span class="keyword">null</span>) &#123;</span><br><span class="line">    filters = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">String</span> name : names) &#123;</span><br><span class="line">        ScanFilter <span class="built_in">filter</span> = <span class="keyword">new</span> ScanFilter.Builder()</span><br><span class="line">                .setDeviceName(name)</span><br><span class="line">                .build();</span><br><span class="line">        filters.<span class="built_in">add</span>(<span class="built_in">filter</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">scanner.startScan(filters, scanSettings, scanCallback);</span><br></pre></td></tr></table></figure>

<p><a href="https://medium.com/@martijn.van.welie/making-android-ble-work-part-1-a736dcd53b02">https://medium.com/@martijn.van.welie/making-android-ble-work-part-1-a736dcd53b02</a></p>
<p>android蓝牙自动连接</p>
<p><a href="http://www.cocoachina.com/articles/83844">http://www.cocoachina.com/articles/83844</a></p>
<h5 id="Ble-library"><a href="#Ble-library" class="headerlink" title="Ble library"></a>Ble library</h5><p><a href="https://github.com/NordicSemiconductor/Android-BLE-Library">Android-BLE-Library</a></p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">LoggableBleManager</span> <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">log</span>(final int priority, <span class="variable">@NonNull</span> final String message)</span><br><span class="line">是日志打印出口</span><br><span class="line">是 <span class="selector-tag">BleManager</span> <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">log</span>(final int priority, <span class="variable">@NonNull</span> final String message)的实现</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/NordicSemiconductor/nRF-Logger-API">nRF-Logger-API</a>是手机日志查看工具</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LoggableBleManager&lt;T</span> <span class="keyword">extends</span> <span class="title">BleManagerCallbacks&gt;</span> <span class="keyword">extends</span> <span class="title">BleManager&lt;T&gt;</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">ILogSession</span> logSession;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * The manager constructor.</span></span><br><span class="line"><span class="comment">    * &lt;p&gt;</span></span><br><span class="line"><span class="comment">    * After constructing the manager, the callbacks object must be set with</span></span><br><span class="line"><span class="comment">    * &#123;@link #setManagerCallbacks(BleManagerCallbacks)&#125;.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @param context the context.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   public <span class="type">LoggableBleManager</span>(<span class="meta">@NonNull</span> <span class="keyword">final</span> <span class="type">Context</span> context) &#123;</span><br><span class="line">      <span class="keyword">super</span>(context);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Sets the log session to log into.</span></span><br><span class="line"><span class="comment">    *</span></span><br><span class="line"><span class="comment">    * @param session nRF Logger log session to log inti, or null, if nRF Logger is not installed.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   public void setLogger(<span class="meta">@Nullable</span> <span class="keyword">final</span> <span class="type">ILogSession</span> session) &#123;</span><br><span class="line">      logSession = session;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   public void log(<span class="keyword">final</span> int priority, <span class="meta">@NonNull</span> <span class="keyword">final</span> <span class="type">String</span> message) &#123;</span><br><span class="line">      <span class="type">Logger</span>.log(logSession, <span class="type">LogContract</span>.<span class="type">Log</span>.<span class="type">Level</span>.fromPriority(priority), message);</span><br><span class="line">      <span class="type">Log</span>.println(priority, <span class="string">&quot;BleManager&quot;</span>, message);</span><br><span class="line"><span class="comment">//    Timber.i(&quot;BleManager   &quot;+ message);</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>BLE</category>
      </categories>
  </entry>
  <entry>
    <title>BroadcastReceiver</title>
    <url>/2017/08/12/BroadcastReceiver/</url>
    <content><![CDATA[<p>BroadcastReceiver</p>
<p> <a href="https://developer.android.com/guide/components/broadcasts.html">https://developer.android.com/guide/components/broadcasts.html</a></p>
<p> 广播使应用程序间传输传输信息的机制，主要用来监听系统或者应用发出的广播信息。<br>  BroadcastReceiver使用注意   当系统或应用发出广播时，扫描系统所有广播接收者(无论时静态注册还是动态注册方式)，通过action匹配將广播发给相应接收者，接收者收到<br>   广播后会产生一个广播实例，执行onReceiver()，这个实例生命周期只有10秒,10秒内没执行结束onReceiver，系统会报错,所以不能再onReceiver()执行耗时操作,onReceiver结束后，实例被销毁.</p>
<h4 id="BroadcastReceiver注册方式"><a href="#BroadcastReceiver注册方式" class="headerlink" title="BroadcastReceiver注册方式"></a>BroadcastReceiver注册方式</h4><h5 id="Context-registered-receivers-动态注册"><a href="#Context-registered-receivers-动态注册" class="headerlink" title="Context-registered receivers (动态注册)"></a>Context-registered receivers (动态注册)</h5><p>注册</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> UpdateBroadcastReceiver updateBr;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">protected void on<span class="constructor">Start()</span> &#123;</span><br><span class="line">    super.on<span class="constructor">Start()</span>;</span><br><span class="line">    updateBr = <span class="keyword">new</span> <span class="constructor">UpdateBroadcastReceiver()</span>;</span><br><span class="line">    IntentFilter intentFilter = <span class="keyword">new</span> <span class="constructor">IntentFilter()</span>;</span><br><span class="line">    intentFilter.add<span class="constructor">Action(ACTION_UPDATE)</span>;</span><br><span class="line">    register<span class="constructor">Receiver(<span class="params">updateBr</span>, <span class="params">intentFilter</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发送注销广播</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//点击发送广播</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">btBroadcast</span>(<span class="params">View v</span>)</span> &#123;</span><br><span class="line">    Intent intentBroad = <span class="keyword">new</span> Intent();</span><br><span class="line">    intentBroad.setAction(ACTION_UPDATE);</span><br><span class="line">    sendBroadcast(intentBroad);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">onDestroy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    <span class="keyword">if</span> (updateBr != <span class="literal">null</span>) &#123;</span><br><span class="line">        unregisterReceiver(updateBr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 注意:这种注册方式　AndroidManifest.xml不用做任何操作</p>
<h5 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h5><p>Android 8.0之后，静态注册是无法接收隐式广播的，而默认情况下，我们发出的广播都是隐式广播，因此一定要调用setPackage()方法，指定这条广播是发送给哪个应用程序的，从而让它变成一条显示广播。（第一行代码）</p>
<p>AndroidManifest.xml添加</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.broadcastservice.UpdateBroadcastReceiver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.UpdateBroadcastReceiver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意　为了杜绝APP滥用资源,官方对有的广播做了限制</p>
<blockquote>
<p>Note: If your app targets API level 26 or higher, you cannot use the manifest to declare a receiver for implicit broadcasts (broadcasts that do not target your app specifically), except for a few implicit broadcasts that are exempted from that restriction. In most cases, you can use scheduled jobs instead.</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">intent.setPackage(<span class="string">&quot;com.comm.util&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="Sending-broadcasts方式"><a href="#Sending-broadcasts方式" class="headerlink" title="Sending broadcasts方式"></a>Sending broadcasts方式</h4><h5 id="普通广播"><a href="#普通广播" class="headerlink" title="普通广播"></a>普通广播</h5><h5 id="有序广播"><a href="#有序广播" class="headerlink" title="有序广播"></a>有序广播</h5><p>FirstOrderBroadCast</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstOrderBroadCast</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;Low&quot;</span>);</span><br><span class="line">        <span class="keyword">val</span> code = <span class="number">1</span></span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = <span class="string">&quot;hello I am FirstOrderBroadCast&quot;</span></span><br><span class="line">        <span class="keyword">val</span> bundle: Bundle? = Bundle()</span><br><span class="line">        bundle?.putString(<span class="string">&quot;first&quot;</span>,<span class="string">&quot;from FirstOrderBroadCast&quot;</span>)</span><br><span class="line">        setResult(code, <span class="keyword">data</span>, bundle)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecondOrderBroadCast</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecondOrderBroadCast</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;Mid&quot;</span>)</span><br><span class="line">        <span class="comment">//获取上一个广播接收器结果</span></span><br><span class="line">        <span class="keyword">val</span> code = resultCode</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = resultData</span><br><span class="line">        <span class="keyword">var</span> bundleResult = getResultExtras(<span class="literal">true</span>).<span class="keyword">get</span>(<span class="string">&quot;first&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;获取到上一个广播接收器结果：code=  <span class="variable">$code</span>   data= <span class="variable">$data</span>  bundleResult <span class="variable">$bundleResult</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ThirdOrderBroadCast</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThirdOrderBroadCast</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;High&quot;</span>)</span><br><span class="line">        <span class="comment">//传递结果到下一个广播接收器</span></span><br><span class="line">        <span class="keyword">val</span> code = <span class="number">3</span></span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = <span class="string">&quot;hello&quot;</span></span><br><span class="line">        <span class="keyword">val</span> bundle: Bundle? = <span class="literal">null</span></span><br><span class="line">        setResult(code, <span class="keyword">data</span>, bundle)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AndroidMnifest.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.broadcastservice.FirstOrderBroadCast&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;3000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.broadcast.android&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.broadcastservice.SecondOrderBroadCast&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;2000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.broadcast.android&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.broadcastservice.ThirdOrderBroadCast&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.broadcast.android&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">updateBr = UpdateBroadcastReceiver()</span><br><span class="line"><span class="keyword">val</span> intentFilter = IntentFilter()</span><br><span class="line">intentFilter.addAction(UpdateBroadcastReceiver.ACTION_UPDATE)</span><br><span class="line">registerReceiver(updateBr, intentFilter)</span><br></pre></td></tr></table></figure>

<p>使用</p>
<p>BroadcastReceiverActivity</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> intent = Intent()</span><br><span class="line">intent.action = <span class="string">&quot;com.broadcast.android&quot;</span></span><br><span class="line"></span><br><span class="line">bt_order_broadcast.setOnClickListener &#123;</span><br><span class="line">    sendOrderedBroadcast(intent,<span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight mathematica"><table><tr><td class="code"><pre><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> <span class="variable">Low</span></span><br><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> <span class="variable">Mid</span></span><br><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> 获取到上一个广播接收器结果：<span class="variable">code</span><span class="operator">=</span>  <span class="number">1</span>   <span class="variable">data</span><span class="operator">=</span> <span class="variable">hello</span> <span class="built_in">I</span> <span class="variable">am</span> <span class="variable">FirstOrderBroadCast</span>  <span class="variable">bundleResult</span> <span class="variable">from</span> <span class="variable">FirstOrderBroadCast</span></span><br><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> <span class="variable">High</span></span><br></pre></td></tr></table></figure>

<h5 id="LocalBroadcastManager-sendBroadcast"><a href="#LocalBroadcastManager-sendBroadcast" class="headerlink" title="LocalBroadcastManager.sendBroadcast"></a><a href="https://developer.android.com/reference/androidx/localbroadcastmanager/content/LocalBroadcastManager#sendBroadcast(android.content.Intent)">LocalBroadcastManager.sendBroadcast</a></h5><p>method sends broadcasts to receivers that are in the same app as the sender. If you don’t need to send broadcasts across apps, use local broadcasts.he implementation is much more efficient (no interprocess communication needed) and you don’t need to worry about any security issues related to other apps being able to receive or send your broadcasts.(应用内发送广播)</p>
<p>发送</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> intentBroad = Intent()</span><br><span class="line">intentBroad.action = UpdateBroadcastReceiver.ACTION_UPDATE</span><br><span class="line">LocalBroadcastManager.getInstance(<span class="keyword">this</span>).sendBroadcast(intentBroad)</span><br></pre></td></tr></table></figure>

<p>注册 </p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">updateBr = UpdateBroadcastReceiver()</span><br><span class="line"><span class="keyword">val</span> intentFilter = IntentFilter()</span><br><span class="line">intentFilter.addAction(UpdateBroadcastReceiver.ACTION_UPDATE)</span><br><span class="line">registerReceiver(updateBr, intentFilter)</span><br><span class="line">updateBr?.let &#123;</span><br><span class="line">    LocalBroadcastManager.getInstance(<span class="keyword">this</span>).registerReceiver(it,intentFilter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/qq_30379689/article/details/53341313">https://blog.csdn.net/qq_30379689/article/details/53341313</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Camera</title>
    <url>/2017/08/28/Camera/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/training/camera/photobasics.html#TaskPath">https://developer.android.com/training/camera/photobasics.html#TaskPath</a></p>
<h5 id="Get-the-thumbnail-缩略图"><a href="#Get-the-thumbnail-缩略图" class="headerlink" title="Get the thumbnail(缩略图)"></a>Get the thumbnail(缩略图)</h5><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_IMAGE_CAPTURE = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">btAlbum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Intent takePictureIntent = <span class="keyword">new</span> <span class="built_in">Intent</span>(</span><br><span class="line">               Intent.ACTION_PICK,</span><br><span class="line">               MediaStore.Images.Media.EXTERNAL_CONTENT_URI);</span><br><span class="line">       <span class="built_in">startActivityForResult</span>(takePictureIntent, REQUEST_IMAGE_CAPTURE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">  public void on<span class="constructor">ActivityResult(<span class="params">int</span> <span class="params">requestCode</span>, <span class="params">int</span> <span class="params">resultCode</span>, Intent <span class="params">data</span>)</span> &#123;</span><br><span class="line">      super.on<span class="constructor">ActivityResult(<span class="params">requestCode</span>, <span class="params">resultCode</span>, <span class="params">data</span>)</span>;</span><br><span class="line">   <span class="keyword">if</span> (requestCode<span class="operator"> == </span>REQUEST_IMAGE_CAPTURE<span class="operator"> &amp;&amp; </span>resultCode<span class="operator"> == </span>Activity.RESULT_OK) &#123;</span><br><span class="line">            data?.extras?.<span class="keyword">let</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> imageBitmap = it.get(<span class="string">&quot;data&quot;</span>) <span class="keyword">as</span> Bitmap</span><br><span class="line">                img_show.set<span class="constructor">ImageBitmap(<span class="params">imageBitmap</span>)</span></span><br><span class="line">       &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Save-the-full-size-photo"><a href="#Save-the-full-size-photo" class="headerlink" title="Save the full-size photo"></a>Save the full-size photo</h5><pre><code>  provider_camera.xml 
</code></pre>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">paths</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    &lt;external-path</span><br><span class="line">        name=&quot;my_images&quot;</span><br><span class="line">        path=&quot;Android/data/com.zhujia.land/files/Pictures&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">paths</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>跳转拍照 : 还得注意申请权限</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void dispatch<span class="constructor">TakePictureIntent(<span class="params">int</span> <span class="params">num</span>)</span> &#123;</span><br><span class="line">       Intent takePictureIntent = <span class="keyword">new</span> <span class="constructor">Intent(MediaStore.ACTION_IMAGE_CAPTURE)</span>;</span><br><span class="line">       <span class="keyword">if</span> (takePictureIntent.resolve<span class="constructor">Activity(<span class="params">this</span>.<span class="params">getPackageManager</span>()</span>) != null) &#123;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               photoFile = create<span class="constructor">ImageFile()</span>;</span><br><span class="line">           &#125; catch (IOException e) &#123;</span><br><span class="line">               e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">if</span> (photoFile<span class="operator"> == </span>null) &#123;</span><br><span class="line">               return;</span><br><span class="line">           &#125;</span><br><span class="line">           Uri imgUri;</span><br><span class="line">           <span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; <span class="number">24</span>) &#123;</span><br><span class="line">               imgUri = <span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>from<span class="constructor">File(<span class="params">photoFile</span>)</span>;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">//Android 7.0系统开始 使用本地真实的Uri路径不安全,使用FileProvider封装共享Uri</span></span><br><span class="line">               <span class="comment">//参数二:fileprovider绝对路径 com.dyb.testcamerademo：项目包名</span></span><br><span class="line">               imgUri = <span class="module-access"><span class="module"><span class="identifier">FileProvider</span>.</span></span>get<span class="constructor">UriForFile(<span class="params">this</span>, <span class="string">&quot;com.zhujia.land.fileprovider&quot;</span>, <span class="params">photoFile</span>)</span>;</span><br><span class="line">           &#125;</span><br><span class="line">           takePictureIntent.put<span class="constructor">Extra(MediaStore.EXTRA_OUTPUT, <span class="params">imgUri</span>)</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       start<span class="constructor">ActivityForResult(<span class="params">takePictureIntent</span>, <span class="params">num</span>)</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">      <span class="keyword">if</span> (requestCode == REQUEST_IMAGE_CAPTURE &amp;&amp; resultCode == Activity.RESULT_OK) &#123;</span><br><span class="line">          <span class="comment">//如果拍照成功，将Uri用BitmapFactory的decodeStream方法转为Bitmap</span></span><br><span class="line">          <span class="keyword">val</span> imageBitmap = BitmapFactory.decodeStream(photoURI?.let &#123;</span><br><span class="line">              contentResolver.openInputStream(</span><br><span class="line">                  it</span><br><span class="line">              )</span><br><span class="line">          &#125;)</span><br><span class="line">           galleryAddPic(mImageUriFromFile) <span class="comment">//将拍的照片添加到相册</span></span><br><span class="line">          img_show.setImageBitmap(imageBitmap)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p>照片添加到相册</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将拍的照片添加到相册</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> uri 拍的照片的Uri</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">galleryAddPic</span><span class="params">(uri: <span class="type">Uri</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> mediaScanIntent = Intent(Intent.ACTION_MEDIA_SCANNER_SCAN_FILE,uri)</span><br><span class="line">    sendBroadcast(mediaScanIntent)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>But it has a question</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">fun</span> <span class="title">createImageFile</span><span class="params">(context: <span class="type">Context</span>)</span></span>: File? &#123;</span><br><span class="line">            <span class="comment">// Create an image file name</span></span><br><span class="line">            <span class="keyword">val</span> timeStamp: String = SimpleDateFormat(yyyyMMDD_HHmmss).format(Date())</span><br><span class="line"><span class="comment">//            val storageDir: File? = context.getExternalFilesDir(Environment.DIRECTORY_PICTURES)</span></span><br><span class="line">            <span class="keyword">val</span> storageDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_PICTURES)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> File.createTempFile(</span><br><span class="line">                <span class="string">&quot;JPEG_<span class="subst">$&#123;timeStamp&#125;</span>_&quot;</span>, <span class="comment">/* prefix */</span></span><br><span class="line">                <span class="string">&quot;.jpg&quot;</span>, <span class="comment">/* suffix */</span></span><br><span class="line">                storageDir <span class="comment">/* directory */</span></span><br><span class="line">            ).apply &#123;</span><br><span class="line">                <span class="comment">// Save a file: path for use with ACTION_VIEW intents</span></span><br><span class="line">                <span class="keyword">var</span> currentPhotoPath = absolutePath</span><br><span class="line">                Timber.i(<span class="string">&quot;createImageFile  <span class="variable">$currentPhotoPath</span>&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p><code>ACTION_MEDIA_SCANNER_SCAN_FILE</code> 还有一个限制条件，那就是传递进去的文件绝对路径，必须是以 <code>Environment.getExternalStorageDirectory()</code> 方法的返回值开头。</p>
<p>这样 ‘context.getExternalFilesDir(Environment.DIRECTORY_PICTURES)’  这个暂时没弄好</p>
<p><a href="https://juejin.im/post/5ae0541df265da0b9d77e45a">https://juejin.im/post/5ae0541df265da0b9d77e45a</a></p>
<p><a href="https://www.jianshu.com/p/f269bcda335f#">https://www.jianshu.com/p/f269bcda335f#</a></p>
<p><a href="https://www.jianshu.com/p/26d29e187f89">https://www.jianshu.com/p/26d29e187f89</a></p>
<p>servlet<br><a href="https://my.oschina.net/u/2008084/blog/524937">https://my.oschina.net/u/2008084/blog/524937</a></p>
<p>7.0<br><a href="https://blog.csdn.net/u011418943/article/details/77712662">https://blog.csdn.net/u011418943/article/details/77712662</a></p>
<p>Android 10</p>
<p><a href="https://mp.weixin.qq.com/s/31esIqMudRRDBY8JDs8D4A">https://mp.weixin.qq.com/s/31esIqMudRRDBY8JDs8D4A</a></p>
<p><a href="https://juejin.im/post/5a33a5106fb9a04525782db5">https://juejin.im/post/5a33a5106fb9a04525782db5</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>CaptureApp</title>
    <url>/2018/04/21/CaptureApp/</url>
    <content><![CDATA[<h2 id="Fiddler"><a href="#Fiddler" class="headerlink" title="Fiddler"></a>Fiddler</h2><p><a href="https://www.jianshu.com/p/4a8dae519efe">https://www.jianshu.com/p/4a8dae519efe</a><br><a href="https://www.jianshu.com/p/99b6b4cd273c">https://www.jianshu.com/p/99b6b4cd273c</a></p>
<h2 id="WireShark"><a href="#WireShark" class="headerlink" title="WireShark"></a>WireShark</h2><p>安装<br><a href="https://www.linuxidc.com/Linux/2016-08/134526.htm">https://www.linuxidc.com/Linux/2016-08/134526.htm</a></p>
<p><a href="http://www.cnblogs.com/wangqiguo/p/4529250.html">http://www.cnblogs.com/wangqiguo/p/4529250.html</a><br><a href="http://www.cnblogs.com/TankXiao/archive/2012/10/10/2711777.html">http://www.cnblogs.com/TankXiao/archive/2012/10/10/2711777.html</a></p>
<p><a href="https://juejin.im/post/5cc313755188252d6f11b463">https://juejin.im/post/5cc313755188252d6f11b463</a></p>
<p>手机抓包</p>
<p><a href="https://juejin.im/post/5ddddd2a6fb9a07161483fb2">https://juejin.im/post/5ddddd2a6fb9a07161483fb2</a></p>
<p>Charles抓包</p>
<p><a href="https://www.jianshu.com/p/e8dd1091d6d7">https://www.jianshu.com/p/e8dd1091d6d7</a></p>
<p><a href="https://www.cnblogs.com/ievjai/p/13512326.html">https://www.cnblogs.com/ievjai/p/13512326.html</a></p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>ComputerOrganization</title>
    <url>/2020/12/10/ComputerOrganization/</url>
    <content><![CDATA[<p>组成原理</p>
<p>CPU</p>
<p>运算器  控制器  高速缓存</p>
<p>主存储器= 内存</p>
<h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p><img src="/2020/12/10/ComputerOrganization/computer_compoment_control.png"></p>
<ul>
<li><p>程序计数器:</p>
<p> 用于提供其他控制单元，当前要执行的指令地址</p>
</li>
<li><p>时序发生器:</p>
<p> 用于发送时序脉冲， 依据不同的时序脉冲有节奏的进行工作</p>
</li>
<li><p>寄存器</p>
<p>指令寄存器 :从主存或高速缓存取计算机指令</p>
<p>主存地址寄存器：保存当前CPU正要访问的内存单元的地址</p>
<p>主存地址寄存器： 保存当前CPU正要读或写的主存数据</p>
<p>通用寄存器:</p>
<p>用于暂存或传送数据或指令</p>
<p>可保存ALU的运算中间结果</p>
<p>容量比一般专用寄存器要大</p>
</li>
</ul>
<p>​    </p>
<h4 id="运算器"><a href="#运算器" class="headerlink" title="运算器"></a>运算器</h4><p><img src="/2020/12/10/ComputerOrganization/computer_compoment_calculate.png"></p>
<h5 id="数据缓冲器"><a href="#数据缓冲器" class="headerlink" title="数据缓冲器"></a>数据缓冲器</h5><p>​    分为输入缓冲和输出缓冲</p>
<p>​    输入缓冲暂时存放外设送过来的数据</p>
<p>​    输出缓冲暂时存放送往外设的数据</p>
<h5 id="ALU"><a href="#ALU" class="headerlink" title="ALU"></a>ALU</h5><p>​    ALU:算术逻辑单元，是运算器的主要组成</p>
<p>​    常见的位运算(左右移、与或非等)</p>
<p>​    算术运算(加减乘除等)</p>
<h5 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h5><p>​    用于暂时存放或传送数据或指令</p>
<p>​    可保存ALU的运算中间结果</p>
<p>​    容量比一般专用寄存器要大</p>
<h5 id="状态字寄存器"><a href="#状态字寄存器" class="headerlink" title="状态字寄存器"></a>状态字寄存器</h5><p>​    存放运算状态(条件码、进位、溢出、结果正负等)</p>
<p>​    存放运算控制信息(调试跟踪标记位、允许中断位等)</p>
<h4 id="高速缓存"><a href="#高速缓存" class="headerlink" title="高速缓存"></a>高速缓存</h4><h4 id="指令执行过程"><a href="#指令执行过程" class="headerlink" title="指令执行过程"></a>指令执行过程</h4><p><img src="/2020/12/10/ComputerOrganization/computer_signal_01.png"></p>
<p><img src="/2020/12/10/ComputerOrganization/computer_signal_02.png"></p>
<h4 id="高速缓存-1"><a href="#高速缓存-1" class="headerlink" title="高速缓存"></a>高速缓存</h4><p>命中率</p>
<p>![](ComputerOrganization/Screen Shot 2021-03-03 at 10.10.02 PM.png)</p>
<p>不在缓存的数据需要去主存拿</p>
<h4 id="4GB是寻址空间为什么是4G-byte而不是-bit"><a href="#4GB是寻址空间为什么是4G-byte而不是-bit" class="headerlink" title="4GB是寻址空间为什么是4G ,byte而不是 bit"></a>4GB是寻址空间为什么是4G ,byte而不是 bit</h4><p>现在的内存可以看作一个很长的，每项宽度8位（即1Bit）的很长的数列,<strong>既然是数列，那么每一项便对应一个序号，这个序号便是地址，就如同你家在一条大街的第几号一样</strong></p>
<p><a href="https://www.zhihu.com/question/61974351">https://www.zhihu.com/question/61974351</a></p>
]]></content>
      <categories>
        <category>Organization</category>
      </categories>
  </entry>
  <entry>
    <title>ConcurrencyThreadPool</title>
    <url>/2017/08/27/ConcurrencyThreadPool/</url>
    <content><![CDATA[<img src="/2017/08/27/ConcurrencyThreadPool/Screen Shot 2020-08-19 at 10.07.23 AM.png" alt="Screen Shot 2020-08-19 at 10.07.23 AM" style="zoom:50%;">



<h4 id="线程池状态切换"><a href="#线程池状态切换" class="headerlink" title="线程池状态切换"></a>线程池状态切换</h4><p><img src="https://img2020.cnblogs.com/blog/1208468/202102/1208468-20210219204031490-460634238.png"></p>
<p>1、RUNNING</p>
<p>(1) 状态说明：线程池处在RUNNING状态时，能够接收新任务，以及对已添加的任务进行处理。<br> (02) 状态切换：线程池的初始化状态是RUNNING。换句话说，线程池被一旦被创建，就处于RUNNING状态，并且线程池中的任务数为0！</p>
<ul>
<li>1</li>
</ul>
<p>2、 SHUTDOWN</p>
<p>(1) 状态说明：线程池处在SHUTDOWN状态时，不接收新任务，但能处理已添加的任务。<br> (2) 状态切换：调用线程池的shutdown()接口时，线程池由RUNNING -&gt; SHUTDOWN。</p>
<p>3、STOP</p>
<p>(1) 状态说明：线程池处在STOP状态时，不接收新任务，不处理已添加的任务，并且会中断正在处理的任务。<br> (2) 状态切换：调用线程池的shutdownNow()接口时，线程池由(RUNNING or SHUTDOWN ) -&gt; STOP。</p>
<p>4、TIDYING</p>
<p>(1)  状态说明：当所有的任务已终止，ctl记录的”任务数量”为0，线程池会变为TIDYING状态。当线程池变为TIDYING状态时，会执行钩子函数terminated()。terminated()在ThreadPoolExecutor类中是空的，若用户想在线程池变为TIDYING时，进行相应的处理；可以通过重载terminated()函数来实现。<br> (2) 状态切换：当线程池在SHUTDOWN状态下，阻塞队列为空并且线程池中执行的任务也为空时，就会由 SHUTDOWN -&gt; TIDYING。<br> 当线程池在STOP状态下，线程池中执行的任务为空时，就会由STOP -&gt; TIDYING。</p>
<p>5、 TERMINATED</p>
<p>(1) 状态说明：线程池彻底终止，就变成TERMINATED状态。<br> (2) 状态切换：线程池处在TIDYING状态时，执行完terminated()之后，就会由 TIDYING -&gt; TERMINATED。</p>
<p><a href="https://blog.csdn.net/nmjhehe/article/details/115901549">https://blog.csdn.net/nmjhehe/article/details/115901549</a></p>
<p><a href="https://www.cnblogs.com/east7/p/14417977.html">https://www.cnblogs.com/east7/p/14417977.html</a></p>
<h4 id="线程池工作原理"><a href="#线程池工作原理" class="headerlink" title="线程池工作原理"></a>线程池工作原理</h4><p><img src="https://s0.lgstatic.com/i/image2/M01/AD/A3/CgoB5l3eH8mAAoJCAACEOKMHtpw036.png"></p>
<h5 id="各参数含义"><a href="#各参数含义" class="headerlink" title="各参数含义"></a>各参数含义</h5><h6 id="corePoolSize"><a href="#corePoolSize" class="headerlink" title="corePoolSize"></a>corePoolSize</h6><p>线程池初始化时线程数默认为 0，当有新的任务提交后，会创建新线程执行任务，如果不做特殊设置，此后线程数通常不会再小于 corePoolSize ，因为它们是核心线程，即便未来可能没有可执行的任务也不会被销毁。</p>
<h6 id="maximumPoolSize"><a href="#maximumPoolSize" class="headerlink" title="maximumPoolSize"></a>maximumPoolSize</h6><p>​    maximumPoolSize 最大线程数，线程池会在 corePoolSize 核心线程数的基础上继续创建线程来执行任务，假设任务被不断提交，线程池会持续创建线程直到线程数达到 maximumPoolSize 最大线程数，如果依然有任务被提交，这就超过了线程池的最大处理能力，这个时候线程池就会拒绝这些任务，我们可以看到实际上任务进来之后，线程池会逐一判断 corePoolSize、workQueue、maximumPoolSize，如果依然不能满足需求，则会拒绝任务。</p>
<h6 id="keepAliveTime-时间单位"><a href="#keepAliveTime-时间单位" class="headerlink" title="keepAliveTime+时间单位"></a>keepAliveTime+时间单位</h6><p>​    当线程池中线程数量多于核心线程数时，而此时又没有任务可做，线程池就会检测线程的 keepAliveTime，如果超过规定的时间，无事可做的线程就会被销毁，以便减少内存的占用和资源消耗。但是要注意到了核心线程数就不会销毁了。</p>
<p><img src="/2017/08/27/ConcurrencyThreadPool/queueThreadWork.png"></p>
<p>如上图所示，当提交任务后，线程池首先会检查当前线程数，如果此时线程数小于核心线程数，比如最开始线程数量为 0，则新建线程并执行任务，随着任务的不断增加，线程数会逐渐增加并达到核心线程数，此时如果仍有任务被不断提交，就会被放入 workQueue 任务队列中，等待核心线程执行完当前任务后重新从 workQueue 中提取正在等待被执行的任务。</p>
<p>此时，假设我们的任务特别的多，已经达到了 workQueue 的容量上限，这时线程池就会启动后备力量，也就是 maximumPoolSize 最大线程数，线程池会在 corePoolSize 核心线程数的基础上继续创建线程来执行任务，假设任务被不断提交，线程池会持续创建线程直到线程数达到 maximumPoolSize 最大线程数，如果依然有任务被提交，这就超过了线程池的最大处理能力，这个时候线程池就会拒绝这些任务，我们可以看到实际上任务进来之后，线程池会逐一判断 corePoolSize、workQueue、maximumPoolSize，如果依然不能满足需求，则会拒绝任务。</p>
<h4 id="6-种线程池"><a href="#6-种线程池" class="headerlink" title="6 种线程池"></a>6 种线程池</h4><ol>
<li><p>FixedThreadPool</p>
<p>它的核心线程数和最大线程数是一样的</p>
</li>
<li><p>CachedThreadPool</p>
<p>它的特点在于线程数是几乎可以无限增加的（实际最大可以达到 Integer.MAX_VALUE，为 2^31-1),当我们提交一个任务后，线程池会判断已创建的线程中是否有空闲线程，如果有空闲线程则将任务直接指派给空闲线程，如果没有空闲线程，则新建线程去执行任务，这样就做到了动态地新增线程。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123; </span><br><span class="line">        service.execute(<span class="keyword">new</span> Task() &#123; </span><br><span class="line">    &#125;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>使用 for 循环提交 1000 个任务给 CachedThreadPool，假设这些任务处理的时间非常长，会发生什么情况呢？因为 for 循环提交任务的操作是非常快的，但执行任务却比较耗时，就可能导致 1000 个任务都提交完了但第一个任务还没有被执行完，所以此时 CachedThreadPool 就可以动态的伸缩线程数量，随着任务的提交，不停地创建 1000 个线程来执行任务，而当任务执行完之后，假设没有新的任务了，那么大量的闲置线程又会造成内存资源的浪费，这时线程池就会检测线程在 60 秒内有没有可执行任务，如果没有就会被销毁，最终线程数量会减为 0。</p>
</li>
<li><p>ScheduledThreadPool</p>
<p>周期性的执行任务</p>
</li>
<li><p>SingleThreadExecutor</p>
<p>它会使用唯一的线程去执行任务，原理和 FixedThreadPool 是一样的，只不过这里线程只有一个，如果线程在执行任务的过程中发生异常，线程池也会重新创建一个线程来执行后续的任务</p>
</li>
<li><p>SingleThreadScheduledExecutor</p>
<p>它实际和第三种 ScheduledThreadPool 线程池非常相似，它只是 ScheduledThreadPool 的一个特例，内部只有一个线程.</p>
</li>
<li><p>ForkJoinPool</p>
<p>我们有一个 Task，这个 Task 可以产生三个子任务，三个子任务并行执行完毕后将结果汇总给 Result。</p>
<img src="https://s0.lgstatic.com/i/image2/M01/AF/A0/CgotOV3kzomAflZxAAB99x9-MzI241.png" style="zoom:50%;"></li>
</ol>
<h4 id="拒绝策略"><a href="#拒绝策略" class="headerlink" title="拒绝策略"></a>拒绝策略</h4><ul>
<li><p>第一种拒绝策略是 AbortPolicy，这种拒绝策略在拒绝任务时，会直接抛出一个类型为 RejectedExecutionException 的 RuntimeException，让你感知到任务被拒绝了，于是你便可以根据业务逻辑选择重试或者放弃提交等策略。</p>
</li>
<li><p>第二种拒绝策略是 DiscardPolicy，这种拒绝策略正如它的名字所描述的一样，当新任务被提交后直接被丢弃掉，也不会给你任何的通知，相对而言存在一定的风险，因为我们提交的时候根本不知道这个任务会被丢弃，可能造成数据丢失。</p>
</li>
<li><p>第三种拒绝策略是 DiscardOldestPolicy，如果线程池没被关闭且没有能力执行，则会丢弃任务队列中的头结点，通常是存活时间最长的任务，这种策略与第二种不同之处在于它丢弃的不是最新提交的，而是队列中存活时间最长的，这样就可以腾出空间给新提交的任务，但同理它也存在一定的数据丢失风险。</p>
</li>
<li><p>第四种拒绝策略是 CallerRunsPolicy，相对而言它就比较完善了，当有新任务提交后，如果线程池没被关闭且没有能力执行，则把这个任务交于提交任务的线程执行，也就是谁提交任务，谁就负责执行任务。这样做主要有两点好处。<br>第一点新提交的任务不会被丢弃，这样也就不会造成业务损失。<br>第二点好处是，由于谁提交任务谁就要负责执行任务，这样提交任务的线程就得负责执行任务，而执行任务又是比较耗时的，在这段期间，提交任务的线程被占用，也就不会再提交新的任务，减缓了任务提交的速度，相当于是一个负反馈。在此期间，线程池中的线程也可以充分利用这段时间来执行掉一部分任务，腾出一定的空间，相当于是给了线程池一定的缓冲期。</p>
<p><strong>提交任务的线程是不固定的，取决于具体是哪个线程执行submit等方法的</strong></p>
</li>
</ul>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=248">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=248</a></p>
<h4 id="线程数量和CPU核数关系"><a href="#线程数量和CPU核数关系" class="headerlink" title="线程数量和CPU核数关系"></a>线程数量和CPU核数关系</h4><p><code>线程数 = CPU 核心数 *（1+平均等待时间/平均工作时间）</code></p>
<ol>
<li><p>线程平均等待时间所占比例越高，就需要越多的线程</p>
<blockquote>
<p>耗时 IO 型任务 , 比如数据库、文件的读写，网络通信等任务，这种任务的特点是并不会特别消耗 CPU 资源，但是 IO 操作很耗时，总体会占用比较多的时间 , 因为 IO 读写速度相比于 CPU 的速度而言是比较慢的，如果我们设置过少的线程数，就可能导致 CPU 资源的浪费,而如果我们设置更多的线程数，那么当一部分线程正在等待 IO 的时候，它们此时并不需要 CPU 来计算，那么另外的线程便可以利用 CPU 去执行其他的任务，互不影响，这样的话在任务队列中等待的任务就会减少，可以更好地利用资源。</p>
</blockquote>
</li>
<li><p> 线程的平均工作时间所占比例越高，就需要越少的线程</p>
</li>
</ol>
<blockquote>
<p> 平均工作时间长 : CPU密集型任务，加密、解密、压缩、计算等一系列需要大量耗费 CPU 资源的任务。因为计算任务非常重，会占用大量的 CPU 资源，所以这时 CPU 的每个核心工作基本都是满负荷的，而我们又设置了过多的线程，每个线程都想去利用 CPU 资源来执行自己的任务，这就会造成不必要的上下文切换，此时线程数的增多并没有让性能提升，反而由于线程数量过多会导致性能下降。</p>
</blockquote>
<p>   可以通过写代码等办法统计到各部分语句的运行时长</p>
<p>如果我们执行的任务类型不是固定的，比如可能一段时间是 CPU 密集型，另一段时间是 IO 密集型，或是同时有两种任务相互混搭。那么在这种情况下，我们可以把最大线程数设置成核心线程数的几倍，以便应对任务突发情况。当然更好的办法是用不同的线程池执行不同类型的任务，让任务按照类型区分开，而不是混杂在一起，这样就可以按照上一课时估算的线程数或经过压测得到的结果来设置合理的线程数了，达到更好的性能。</p>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=254">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=254</a></p>
<h4 id="阻塞队列"><a href="#阻塞队列" class="headerlink" title="阻塞队列"></a>阻塞队列</h4><h5 id="5种常见的线程池"><a href="#5种常见的线程池" class="headerlink" title="5种常见的线程池"></a>5种常见的线程池</h5><img src="/2017/08/27/ConcurrencyThreadPool/blockQueue.png" alt="Screen Shot 2020-08-19 at 10.07.23 AM" style="zoom:50%;">



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ExecutorService fixedThreadPool = Executors.newFixedThreadPool(<span class="number">1</span>);      <span class="comment">//LinkedBlockingQueue</span></span><br><span class="line">ExecutorService singleThreadExecutor = Executors.newSingleThreadExecutor();     <span class="comment">// LinkedBlockingQueue</span></span><br><span class="line">ExecutorService cachedThreadPool = Executors.newCachedThreadPool();             <span class="comment">// SynchronousQueue</span></span><br><span class="line">ScheduledExecutorService scheduledThreadPool = Executors.newScheduledThreadPool(<span class="number">1</span>); <span class="comment">//DelayedWorkQueue</span></span><br><span class="line">ScheduledExecutorService singleThreadScheduledExecutor = Executors.newSingleThreadScheduledExecutor(); <span class="comment">//DelayedWorkQueue</span></span><br></pre></td></tr></table></figure>



<p>上图 前面是线程池，后面是使用的阻塞队列</p>
<ol>
<li><p>LinkedBlockingQueue (FixedThreadPool,SingleThreadExector)</p>
<p>使用的有 FixedThreadPool ,SingleThreadExector,它们使用的阻塞队列是容量为 Integer.MAX_VALUE 的 LinkedBlockingQueue,可以认为是无界队列。由于 FixedThreadPool 线程池的线程数是固定的，所以没有办法增加特别多的线程来处理任务，这时就<em>需要 LinkedBlockingQueue 这样一个没有容量限制的阻塞队列来存放任务</em>。</p>
<p><em>缺点</em>: 最终大量堆积的任务会占用大量内存，并发生 OOM ，也就是OutOfMemoryError.</p>
</li>
<li><p>SynchronousQueue  (CachedThreadPool)</p>
<p>对应的线程池是 CachedThreadPool,线程池 CachedThreadPool 的最大线程数是 Integer 的最大值，可以理解为线程数是可以无限扩展的。和LinkedBlockingQueue阻塞队列重复相反，</p>
<p><em>缺点</em>: 当任务数量特别多的时候，就可能会导致创建非常多的线程，最终超过了操作系统的上限而无法创建新线程，或者导致内存不足。</p>
</li>
<li><p>DelayedWorkQueue (DelayedWorkQueue)</p>
<p>顾名思义，特点就是可以延迟执行任务</p>
<p><em>缺点</em>: 它采用的任务队列是 DelayedWorkQueue，这是一个延迟队列，同时也是一个无界队列，所以和 LinkedBlockingQueue 一样，如果队列中存放过多的任务，就可能导致 OOM</p>
</li>
</ol>
<h5 id="OkHttp线程池"><a href="#OkHttp线程池" class="headerlink" title="OkHttp线程池"></a>OkHttp线程池</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">        <span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> SynchronousQueue&lt;Runnable&gt;());</span><br></pre></td></tr></table></figure>

<p>可以看到 corePoolSize  0 ,  MaxPoolSize Integer.MAX_VALUE</p>
<p>根据线程池执行流程： </p>
<ol>
<li>首先核心线程，corePoolSize 为0 。</li>
<li>把任务加入SynchronousQueue，但是这个队列加入就会失败。</li>
<li>创建非核心线程，数量为Integer.MAX_VALUE，可以创建。</li>
<li>当任务执行完后，3创建的非核心线程 根据keepAliveTime时间，逐步销毁。</li>
</ol>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>OkHttpThreadPool.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ThreadPoolExecutor executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">        <span class="number">0</span>, Integer.MAX_VALUE, <span class="number">60</span>, TimeUnit.SECONDS, <span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;());</span><br><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;任务1&quot;</span>);</span><br><span class="line">    System.out.println(Thread.currentThread());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果: </p>
<p>任务1<br>Thread[pool-1-thread-1,5,main]</p>
<p>如果 new LinkedBlockingDeque&lt;&gt;(1)能正常执行，因为LinkedBlockingDeque加入 任务1 就满了，后面的任务创建非核心线程</p>
<p>但是有点疑惑，我这里核心线程是0，任务都加入到LinkedBlockingDeque, 按照线程池流程，<strong>非核心就不应该创建呀？怎么任务1就执行了呢</strong></p>
<p><a href="https://www.bilibili.com/video/BV15y4y1B7Rw?p=5">https://www.bilibili.com/video/BV15y4y1B7Rw?p=5</a></p>
<p><a href="https://mp.weixin.qq.com/s/BHDrSgwUVXkzvswK1khidQ">https://mp.weixin.qq.com/s/BHDrSgwUVXkzvswK1khidQ</a></p>
<p><a href="https://github.com/Snailclimb/programmer-advancement">https://github.com/Snailclimb/programmer-advancement</a></p>
<p><a href="https://juejin.im/post/6855586076132655118">https://juejin.im/post/6855586076132655118</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485441&amp;idx=1&amp;sn=303a25ab02fa9f14a319923e6b0d9759&amp;chksm=cea247caf9d5cedc3a5e1d31f26c08d8ae4c11c349fbdc91ac1d90d8b35807517accb5f5d527&amp;token=2128752750&amp;lang=zh_CN#rd">https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485441&amp;idx=1&amp;sn=303a25ab02fa9f14a319923e6b0d9759&amp;chksm=cea247caf9d5cedc3a5e1d31f26c08d8ae4c11c349fbdc91ac1d90d8b35807517accb5f5d527&amp;token=2128752750&amp;lang=zh_CN#rd</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>concurrency</tag>
      </tags>
  </entry>
  <entry>
    <title>ContentProvider</title>
    <url>/2017/07/31/ContentProvider/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/guide/topics/providers/content-provider-basics.html?hl=zh-cn">https://developer.android.com/guide/topics/providers/content-provider-basics.html?hl=zh-cn</a><br>   还需要完善单条记录 查询 修改等<br>一、新建数据库<br>    <a href="https://github.com/BlogForMe/AndroidProject/blob/master/ContentProvider/mylibrary/src/main/java/com/hyhy/mylibrary/ArticleDbHelper.java">https://github.com/BlogForMe/AndroidProject/blob/master/ContentProvider/mylibrary/src/main/java/com/hyhy/mylibrary/ArticleDbHelper.java</a><br>二、创建ContentProvider</p>
<pre><code>    public class ArticlesProvider extends ContentProvider &#123;
        public static final String AUTHORITY = &quot;com.hyhy.contenttest.db.ArticlesProvider&quot;;  //标识特定ContentProvider,使用包名使他唯一
        private static final Uri NOTIFY_URI = Uri.parse(&quot;content://&quot; + AUTHORITY + &quot;/&quot; + TABLE_NAME);
        private static final UriMatcher uriMatcher;


        /**
         * Match Code
         */
        public static final int ARTICLE_ALL = 0;
        public static final int ARTICLE_SINGLE = 1;


        /**
         * MIME
         */
        public static final String CONTENT_TYPE = &quot;vnd.android.cursor.dir/vnd.com.hyhy.article&quot;;
        private static final String CONTENT_ITEM_TYPE = &quot;vnd.android.cursor.item/vnd.com.hyhy.article&quot;;

        static &#123;
            uriMatcher = new UriMatcher(UriMatcher.NO_MATCH);
            uriMatcher.addURI(AUTHORITY, TABLE_NAME, ARTICLE_ALL);          //匹配记录集合
            uriMatcher.addURI(AUTHORITY, TABLE_NAME + &quot;/#&quot;, ARTICLE_SINGLE);    //匹配单条记录
        &#125;

        private ArticleDbHelper helper;
        private SQLiteDatabase db;
        private ContentResolver resolver;

        @Override
        public boolean onCreate() &#123;
            resolver = getContext().getContentResolver();
            helper = new ArticleDbHelper(getContext());
            return false;
        &#125;

        @Nullable
        @Override
        public String getType(@NonNull Uri uri) &#123;
            int match = uriMatcher.match(uri);
            switch (match) &#123;
                case ARTICLE_ALL:
                    return CONTENT_TYPE;
                case ARTICLE_SINGLE:
                    return CONTENT_ITEM_TYPE;
                default:
                    throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);
            &#125;
        &#125;

        @Override
        public Cursor query(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder) &#123;
            db = helper.getReadableDatabase();
            int match = uriMatcher.match(uri);
            switch (match) &#123;
                case ARTICLE_ALL:
                    //doesn&#39;t need any code in my provider.
                    break;
                case ARTICLE_SINGLE:
    //                long _id  = ContentUris.parseId()
                    break;
                default:
                    throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);
            &#125;
            return db.query(TABLE_NAME, projection, selection, selectionArgs, null, null, sortOrder);
        &#125;


        @Nullable
        @Override
        public Uri insert(@NonNull Uri uri, @Nullable ContentValues values) &#123;
            int match = uriMatcher.match(uri);
            if (match != ARTICLE_ALL) &#123;
                throw new IllegalArgumentException(&quot;Wrong URI:&quot; + uri);
            &#125;
            db = helper.getWritableDatabase();
            long rowId = db.insert(TABLE_NAME, null, values);
            if (rowId &gt; 0) &#123;
                notifyDataChanged();
                return ContentUris.withAppendedId(uri, rowId);
            &#125;
            return null;
        &#125;


        @Override
        public int delete(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs) &#123;
            return 0;
        &#125;

        @Override
        public int update(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs) &#123;
            return 0;
        &#125;

         private void notifyDataChanged() &#123;
            getContext().getContentResolver().notifyChange(NOTIFY_URI, null);
         &#125;
     &#125;
</code></pre>
<p>配置Androidmanifest.xml</p>
<pre><code>  &lt;provider
         android:name=&quot;.db.ArticlesProvider&quot;
        android:authorities=&quot;com.hyhy.contenttest.db.ArticlesProvider&quot;
        android:exported=&quot;true&quot; /&gt;
</code></pre>
<p>三、操作ContentProvider</p>
<pre><code> public class MainActivity extends AppCompatActivity &#123;
    private static final String AUTHORITY = &quot;com.hyhy.contenttest.db.ArticlesProvider&quot;;
    private static final Uri ARTICLE_ALL_URI = Uri.parse(&quot;content://&quot; + AUTHORITY + &quot;/&quot; + TABLE_NAME);
    private ContentResolver resolver;

    @Override
    protected void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        resolver = getContentResolver();
    &#125;


    public void addDb(View v) &#123;
        ContentValues values;
        for (int i = 1; i &lt; 5; i++) &#123;
            values = new ContentValues();
            values.put(ArticleReaderContract.Articles.COLUMN_NAME_ENTRY_ID, i);
            values.put(ArticleReaderContract.Articles.COLUMN_NAME_TITLE, &quot;heh &quot; + i);
            values.put(ArticleReaderContract.Articles.COLUMN_NAME_SUBTITLE, &quot;describe &quot; + i);
            resolver.insert(ARTICLE_ALL_URI, values);
        &#125;
        Toast.makeText(MainActivity.this, &quot;插入成功&quot;, Toast.LENGTH_SHORT).show();
    &#125;

    public void btQueryAll(View v) &#123;
        Cursor c = resolver.query(ARTICLE_ALL_URI, null, null, null, null);
        while (c.moveToNext()) &#123;
            System.out.println(c.getString(c.getColumnIndex(COLUMN_NAME_TITLE)));
        &#125;
    &#125;
&#125;
</code></pre>
<p>   参考 ： <a href="http://blog.csdn.net/liuhe688/article/details/7050868">http://blog.csdn.net/liuhe688/article/details/7050868</a><br>   这一块还不熟悉</p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Data_LinkedList</title>
    <url>/2021/04/19/Data-LinkedList/</url>
    <content><![CDATA[<h4 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h4><ul>
<li><p>首节点 </p>
<p> 第一个有效节点</p>
</li>
<li><p>尾节点</p>
<p> 最后一个有效节点</p>
</li>
<li><p>头节点</p>
<p>头节点的数据类型和首节点类型一样</p>
<p>第一个有效节点之前的那个节点，只存放了 首节点 的地址</p>
<p>头节点并不存在有效数据</p>
<p>加头节点的目的主要是为了方便对链表的操作</p>
</li>
<li><p>头指针</p>
</li>
</ul>
<p>​        指向头节点的指针变量</p>
<p>​        只占用4个byte,比头节点占用空间小.</p>
<ul>
<li><p>尾指针</p>
<p>指向尾节点的指针变量</p>
</li>
</ul>
<h4 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;printf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Node</span> *<span class="title">pNext</span>;</span></span><br><span class="line">&#125; NODE, *PNODE;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Stack</span> &#123;</span></span><br><span class="line">    PNODE pTop;</span><br><span class="line">    PNODE pBottom;</span><br><span class="line">&#125; STACK, *PSTACK; <span class="comment">//PSTACK等价于 stuct STACK *</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(PSTACK)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(STACK *pStack, <span class="keyword">int</span> i)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">(STACK *pStack)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">pop</span><span class="params">(PSTACK pS, <span class="keyword">int</span> *pVal)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">clear</span><span class="params">(PSTACK ps)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">(PSTACK pStack)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    STACK S; <span class="comment">//等价于 struct Stack</span></span><br><span class="line">    init(&amp;S);</span><br><span class="line">    push(&amp;S, <span class="number">1</span>);</span><br><span class="line">    push(&amp;S, <span class="number">22</span>);</span><br><span class="line">    push(&amp;S, <span class="number">88</span>);</span><br><span class="line"></span><br><span class="line">    traverse(&amp;S);</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line"><span class="comment">//    if (pop(&amp;S, &amp;val)) &#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot;出栈成功\n&quot;);</span></span><br><span class="line"><span class="comment">//        printf(&quot;出栈的数据 %d \n&quot;, val);</span></span><br><span class="line"><span class="comment">//    &#125; else &#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot;出栈失败\n&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"></span><br><span class="line">    clear(&amp;S);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;清空数据\n&quot;</span>);</span><br><span class="line">    traverse(&amp;S);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(STACK *pStack, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    PNODE pNew = (PNODE) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(NODE));</span><br><span class="line">    pNew-&gt;data = val;</span><br><span class="line">    pNew-&gt;pNext = pStack-&gt;pTop; <span class="comment">//如果是空可以用pBottom，但是后面不为空</span></span><br><span class="line">    pStack-&gt;pTop = pNew;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(PSTACK pS)</span> </span>&#123;</span><br><span class="line">    pS-&gt;pTop = (PNODE) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(NODE));</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == pS-&gt;pTop) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;动态内存分配失败!\n&quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pS-&gt;pBottom = pS-&gt;pTop;</span><br><span class="line">        pS-&gt;pTop-&gt;pNext = <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse</span><span class="params">(PSTACK pS)</span> </span>&#123;</span><br><span class="line">    PNODE p = pS-&gt;pTop;</span><br><span class="line">    <span class="keyword">while</span> (p != pS-&gt;pBottom) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, p-&gt;data);</span><br><span class="line">        p = p-&gt;pNext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//把pS所指向的栈出栈一次，并把出栈的元素存入pVal形参所指向的变量中，如果出栈失败，返回false,否则返回true,</span></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">pop</span><span class="params">(PSTACK pS, <span class="keyword">int</span> *pVal)</span> </span>&#123;</span><br><span class="line">    *pVal = pS-&gt;pTop-&gt;data;</span><br><span class="line">    PNODE p = pS-&gt;pTop;</span><br><span class="line">    <span class="keyword">if</span> (pS-&gt;pTop != pS-&gt;pBottom) &#123; <span class="comment">//或者写个方法 isEmpty()</span></span><br><span class="line">        pS-&gt;pTop = pS-&gt;pTop-&gt;pNext;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//清空</span></span><br><span class="line"><span class="function"><span class="keyword">void</span>  <span class="title">clear</span><span class="params">(PSTACK pS)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(empty(pS))&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line"></span><br><span class="line">        PNODE  p = pS-&gt;pTop;</span><br><span class="line">        PNODE  q = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="keyword">while</span>(p!=pS-&gt;pBottom)&#123;</span><br><span class="line">             q = p-&gt;pNext;</span><br><span class="line">             <span class="built_in">free</span>(p);</span><br><span class="line">             p = q;</span><br><span class="line">        &#125;</span><br><span class="line">        pS-&gt;pTop = pS-&gt;pBottom;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">empty</span><span class="params">(PSTACK pS)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pS-&gt;pTop==pS-&gt;pBottom)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>应用 </p>
<p>函数调用     中断    表达式求值    内存分配  缓冲处理    迷宫</p>
<p><img src="/2021/04/19/Data-LinkedList/2021-04-22_11-50-30stack.png"></p>
<h4 id="链表队列"><a href="#链表队列" class="headerlink" title="链表队列"></a>链表队列</h4><p>队列 ： 一种可以实现先进先出的存储结构</p>
<p><img src="/2021/04/19/Data-LinkedList/2021-04-22_12-50-46queue.png"></p>
<h4 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h4><p>链式队列 – 用链表实现。</p>
<p>静态队列 – 用数组实现。</p>
<h5 id="循环队列（数组）"><a href="#循环队列（数组）" class="headerlink" title="循环队列（数组）"></a>循环队列（数组）</h5><h5 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h5><ol>
<li><p>队列初始化</p>
<p>front和rear的值都是0。</p>
</li>
<li><p>队列非空</p>
<p>front代表队列的第一个元素。</p>
<p>rear代表队列的最后一个有效 元素的下一个元素。</p>
</li>
<li><p>队列空</p>
<p>front和rear的值相等，但他们的值不一定时0。</p>
</li>
</ol>
<p><img src="/2021/04/19/Data-LinkedList/2021-04-22_15-45-41.png"></p>
<h5 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h5><p>入队: 将值存入r所代表的位置，接着r后移一位。</p>
<p>出队:f后移一位。</p>
<h5 id="如何判断循环队列是否已满"><a href="#如何判断循环队列是否已满" class="headerlink" title="如何判断循环队列是否已满"></a>如何判断循环队列是否已满</h5><p>​    r==f时候，可能为空，页可能满的。</p>
<ol>
<li><p>多增加一个标识参数，存放元素个数</p>
</li>
<li><p>少用一个元素</p>
<p>(r+1)%数组的长度 = f</p>
</li>
</ol>
<h1 id=""><a href="#" class="headerlink" title=""></a><img src="/2021/04/19/Data-LinkedList/2021-04-22_17-48-04_circleLinkedList.png"></h1><p>![](Data-LinkedList/Screenshot from 2021-04-22 17-48-04_circleLinkedList.png)</p>
<p>CircleQueue</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Queue</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> *pBase;</span><br><span class="line">    <span class="keyword">int</span> front;</span><br><span class="line">    <span class="keyword">int</span> rear;</span><br><span class="line">&#125; QUEUE;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(QUEUE *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">en_queue</span><span class="params">(QUEUE *, <span class="keyword">int</span> val)</span></span>; <span class="comment">//入队</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse_queue</span><span class="params">(QUEUE *)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">full_queue</span><span class="params">(QUEUE *pQueue)</span></span>;<span class="comment">//队列是否已满</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">out_queue</span><span class="params">(QUEUE *pQueue, <span class="keyword">int</span> *pInt)</span></span>; <span class="comment">//出队</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">empty_queue</span><span class="params">(QUEUE *pQueue)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    QUEUE Q;</span><br><span class="line">    init(&amp;Q);</span><br><span class="line">    en_queue(&amp;Q, <span class="number">2</span>);</span><br><span class="line">    en_queue(&amp;Q, <span class="number">7</span>);</span><br><span class="line">    en_queue(&amp;Q, <span class="number">33</span>);</span><br><span class="line">    en_queue(&amp;Q, <span class="number">4</span>);</span><br><span class="line">    en_queue(&amp;Q, <span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">    traverse_queue(&amp;Q); <span class="comment">//执行这句 pQ-&gt;front会变，所以出队列失败</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//    int pVal;</span></span><br><span class="line"><span class="comment">//    if(out_queue(&amp;Q,&amp;pVal))&#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot;出队成功，出队元素是 %d \n&quot;,pVal);</span></span><br><span class="line"><span class="comment">//    &#125; else&#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot;出队失败\n&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    traverse_queue(&amp;Q);</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(QUEUE *pQ)</span> </span>&#123;</span><br><span class="line">    pQ-&gt;pBase = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * <span class="number">6</span>);</span><br><span class="line">    pQ-&gt;front = <span class="number">0</span>;</span><br><span class="line">    pQ-&gt;rear = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">full_queue</span><span class="params">(QUEUE *pQ)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ((pQ-&gt;rear + <span class="number">1</span>) % <span class="number">6</span> == pQ-&gt;front) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">en_queue</span><span class="params">(QUEUE *pQ, <span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (full_queue(pQ)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        pQ-&gt;pBase[pQ-&gt;rear] = val;</span><br><span class="line">        pQ-&gt;rear = (pQ-&gt;rear + <span class="number">1</span>) % <span class="number">6</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//void traverse_queue(QUEUE *pQ) &#123;</span></span><br><span class="line"><span class="comment">//    int q = pQ-&gt;front;</span></span><br><span class="line"><span class="comment">//    while ((q) % 6 != pQ-&gt;rear) &#123;</span></span><br><span class="line"><span class="comment">//        printf(&quot; %d &quot;, pQ-&gt;pBase[(pQ-&gt;front++) % 6]);</span></span><br><span class="line"><span class="comment">//        q++;</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//    return;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//或者下面方式</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">traverse_queue</span><span class="params">(QUEUE *pQ)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = pQ-&gt;front;</span><br><span class="line">    <span class="keyword">while</span> (i!=pQ-&gt;rear)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,pQ-&gt;pBase[i]);</span><br><span class="line">        i = (i+<span class="number">1</span>)%<span class="number">6</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">out_queue</span><span class="params">(QUEUE *pQ, <span class="keyword">int</span> *pInt)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(empty_queue(pQ))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        *pInt = pQ-&gt;pBase[pQ-&gt;front];</span><br><span class="line">        pQ-&gt;front=(pQ-&gt;front+<span class="number">1</span>)%<span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">empty_queue</span><span class="params">(QUEUE *pQ)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(pQ-&gt;front==pQ-&gt;rear)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
  </entry>
  <entry>
    <title>Corouties</title>
    <url>/2020/04/05/Corouties/</url>
    <content><![CDATA[<p><a href="https://www.bilibili.com/video/BV164411C7FK?from=search&amp;seid=2446477518780731765">https://www.bilibili.com/video/BV164411C7FK?from=search&amp;seid=2446477518780731765</a></p>
<p><a href="https://codelabs.developers.google.com/codelabs/kotlin-coroutines/#1">https://codelabs.developers.google.com/codelabs/kotlin-coroutines/#1</a></p>
<p><a href="https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/index.html">https://kotlin.github.io/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines/-coroutine-scope/index.html</a></p>
<p><a href="https://mp.weixin.qq.com/s/kmvn637E56t1bae2jXgqfw">https://mp.weixin.qq.com/s/kmvn637E56t1bae2jXgqfw</a></p>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Data_Sort</title>
    <url>/2021/03/21/Data-Sort/</url>
    <content><![CDATA[<h4 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h4><h5 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h5><p><img src="https://pic4.zhimg.com/v2-33a947c71ad62b254cab62e5364d2813_b.jpg"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = arr.length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123; <span class="comment">//剩余需要排序的长度</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">int</span> t = arr[j];</span><br><span class="line">                arr[j] = arr[j + <span class="number">1</span>];</span><br><span class="line">                arr[j + <span class="number">1</span>] = t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>思路1: </p>
<p>第一次遍历最大的元素放到最右边，第二遍放倒数第二个位置，…</p>
<p>一开始的想法是i 也递增，j&lt; arr.length - 1 - i 。但是这样可读性就不如 i 递减的方式，还要注意数组越界的问题，所以int i = arr.length - 1</p>
</li>
</ul>
<ul>
<li><p>思路2</p>
<p>还可以通过增加  swap，遍历后判断是否有序,当前一轮没有进行交换时，说明数组已经有序，没有必要再进行下一轮的循环了，直接退出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">bubbleSort2</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">boolean</span> swap;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = arr.length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123; <span class="comment">//剩余需要排序的长度</span></span><br><span class="line">          swap = <span class="keyword">false</span>;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++) &#123;</span><br><span class="line">              <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                  <span class="keyword">int</span> t = arr[j];</span><br><span class="line">                  arr[j] = arr[j + <span class="number">1</span>];</span><br><span class="line">                  arr[j + <span class="number">1</span>] = t;</span><br><span class="line">                  swap = <span class="keyword">true</span>;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (!swap) &#123;</span><br><span class="line">              <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h5><p>通过比较找到当前的最大元素M,并通过交换使值就位</p>
<p><img src="/2021/03/21/Data-Sort/2021-05-06_13-16-43.png"></p>
<p><img src="/2021/03/21/Data-Sort/select2021-03-21_1.12.39PM.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//选择排序</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectionSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> maxIndex; <span class="comment">//知道下标就能得到值</span></span><br><span class="line">     <span class="keyword">int</span> tmp;</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = arr.length - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">         maxIndex = <span class="number">0</span>;</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= i; j++) &#123;</span><br><span class="line">             <span class="keyword">if</span> (arr[j] &gt; arr[maxIndex]) &#123;</span><br><span class="line">                 maxIndex = j;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         tmp = arr[i];</span><br><span class="line">         arr[i] = arr[maxIndex];</span><br><span class="line">         arr[maxIndex] = tmp;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>





<h5 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h5><p>思想：  前一序列的元素 都小于等于后一序列的元素，递归后 只剩单个元素时，自身就是有序的，可以作为递归基。</p>
<h6 id="快速排序1"><a href="#快速排序1" class="headerlink" title="快速排序1"></a>快速排序1</h6><p><img src="/2021/03/21/Data-Sort/2021-06-18_16-46-42_quickorder_1.png"></p>
<p>初始情况U是整个序列， L G是空,然后 lo  hi都向内侧移动，最终hi lo指向同一个位置m,也就是最终的轴点。</p>
<p>L &lt;= pivot &lt;= G;  U =  [lo,hi]中，[lo]和[hi]交替空闲</p>
<p><img src="/2021/03/21/Data-Sort/2021-06-25_16-42-24_quicksort.png"></p>
<ol>
<li>当_elem[hi]&gt;pivot时，hi向左移动，自序列G跟着拓展。</li>
<li>当_elem[hi]&lt;pivot时，把_elem[hi]移动到lo位置上。</li>
<li>向右移动lo,拓展子序列lo。</li>
<li>当elem[lo] &gt; pivot时，把elem[lo] 移动到hi位置上。</li>
<li>最终hi lo指向同一个位置m,也就是最终的轴点pivot。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> lo, <span class="keyword">int</span> hi)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lo&gt;=hi) <span class="keyword">return</span>;</span><br><span class="line">    <span class="keyword">int</span> mi = partition(arr, lo, hi);</span><br><span class="line">    quickSort(arr, lo, mi-<span class="number">1</span>);</span><br><span class="line">    quickSort(arr, mi + <span class="number">1</span>, hi);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">partition</span><span class="params">(<span class="keyword">int</span>[] elem, <span class="keyword">int</span> lo, <span class="keyword">int</span> hi)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> pivot = elem[lo];</span><br><span class="line">    <span class="keyword">while</span> (lo &lt; hi) &#123;</span><br><span class="line">        <span class="keyword">while</span> (lo&lt;hi&amp;&amp;elem[hi] &gt;= pivot) hi--;</span><br><span class="line">            elem[lo] = elem[hi];</span><br><span class="line">        <span class="keyword">while</span> (lo&lt;hi&amp;&amp;elem[lo] &lt; pivot) lo++;</span><br><span class="line">            elem[hi] = elem[lo];</span><br><span class="line">    &#125;</span><br><span class="line">    elem[lo]= pivot;</span><br><span class="line">    <span class="keyword">return</span> lo;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="快速排序2"><a href="#快速排序2" class="headerlink" title="快速排序2"></a>快速排序2</h6><p>快速排序变种</p>
<p><img src="/2021/03/21/Data-Sort/2021-06-18_21-12-05_quickorder2.png"></p>
<h5 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h5><p><img src="/2021/03/21/Data-Sort/insert2021-03-21PM.png"></p>
<p><img src="/2021/03/21/Data-Sort/2021-05-06_18-56-51.png"></p>
<p><img src="/2021/03/21/Data-Sort/2021-06-25_14-49-00_insert.png"></p>
<h5 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h5><p><img src="/2021/03/21/Data-Sort/shell2021-03-21.png"></p>
<p><a href="https://www.bilibili.com/video/BV1LT4y137cK?from=search&amp;seid=6852216660251002525">https://www.bilibili.com/video/BV1LT4y137cK?from=search&amp;seid=6852216660251002525</a></p>
<h5 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h5><p>代码不太理解(学堂在线)</p>
<h5 id="符号表的各种实现的优缺点"><a href="#符号表的各种实现的优缺点" class="headerlink" title="符号表的各种实现的优缺点"></a>符号表的各种实现的优缺点</h5><p><img src="/2021/03/21/Data-Sort/2021-03-22_4.07.22PM.png"></p>
<h5 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h5><p><a href="https://www.xuetangx.com/learn/THU08091002048/THU08091002048/5883385/video/9195336">结合了数组与链表的特性</a></p>
<p><img src="/2021/03/21/Data-Sort/2021-06-17_05-27-33_heap4.png"></p>
<p>自下而上</p>
<p>2    1    6    3    9    7    4    8    5 </p>
<p>最末尾的<strong>内部节点</strong>所对应的秩开始  floor(9/2)-1=3,也就是第三个位置，接下来是堆6 1 2进行下滤操作</p>
<p>一开始很不理解为什么是 floor(9/2)-1，因为前面有 parent(i) = (i-1)&gt;&gt;1</p>
<p>其实这个9就是 arr.length,这里的 i是下标,也就是 arr.length-1,这样就很好理解为什么-1可以移出来 </p>
<p><img src="/2021/03/21/Data-Sort/2021-06-17_05-32-04_heap3.png"></p>
<h6 id="建堆"><a href="#建堆" class="headerlink" title="建堆"></a><a href="https://www.xuetangx.com/learn/THU08091002048/THU08091002048/5883385/video/9195388">建堆</a></h6><p><img src="/2021/03/21/Data-Sort/2021-06-17_04-33-40_heapy1.png"></p>
<ol>
<li><p>按照树的层序遍历顺序，从左到右开始建堆。</p>
</li>
<li><p>接着根据floyd算法开始调整， 5/2 - 1 = 1,第一个位置对应的是3，3上移</p>
</li>
<li><p>接着是5,上移， 上面左下图是调整之后的，完全二叉堆</p>
</li>
</ol>
<p>上面的数字太小，<a href="https://www.youtube.com/watch?v=WsNQuCa_-PU">https://www.youtube.com/watch?v=WsNQuCa_-PU</a> 这个视频有两次调整的情况</p>
<h6 id="选取与调整"><a href="#选取与调整" class="headerlink" title="选取与调整"></a>选取与调整</h6><p><img src="/2021/03/21/Data-Sort/2021-06-17_04-34-11_heapy2.png"></p>
<p>类似于选择排序</p>
<ol>
<li>选取根节点5和末尾元素2交换,放到向量末尾，5放到 已排序序列，从完全二叉堆中移出。</li>
<li>对根节点2下滤</li>
<li>选取根节点4和末位置1交换，4放到已排序序列，下面依次操作</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">    buildHeap(arr, arr.length); <span class="comment">//建堆</span></span><br><span class="line">    selectSorted(arr); <span class="comment">// 交换 下滤</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">buildHeap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> k = (length - <span class="number">1</span>) &gt;&gt; <span class="number">1</span>; k &gt;= <span class="number">0</span>; k--) &#123;  <span class="comment">//最后的内部节点 往前遍历</span></span><br><span class="line">        addJustHeap(arr, k, length); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addJustHeap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> k, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span> * k + <span class="number">1</span>; i &lt;= length; i = <span class="number">2</span> * i + <span class="number">1</span>) &#123; <span class="comment">// 上面节点调整后，可能比子节点还小，需要继续调整</span></span><br><span class="line">        <span class="keyword">if</span> ((i + <span class="number">1</span>) &lt; length &amp;&amp; arr[i] &lt; arr[i + <span class="number">1</span>]) &#123;</span><br><span class="line">            i++; <span class="comment">// 左子树比右子树小，用右子树比较</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i &lt; length &amp;&amp; arr[k] &lt; arr[i]) &#123;</span><br><span class="line">            swap(arr, k, i);</span><br><span class="line">            k = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">selectSorted</span><span class="params">(<span class="keyword">int</span>[] arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; arr.length - <span class="number">1</span>; j++) &#123;</span><br><span class="line">        swap(arr, <span class="number">0</span>, arr.length - <span class="number">1</span> - j); <span class="comment">//交换到已排序位置</span></span><br><span class="line">        addJustHeap(arr, <span class="number">0</span>, arr.length - <span class="number">1</span> - j); <span class="comment">//继续调整</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span>[] arr, <span class="keyword">int</span> k, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> tmp = arr[i];</span><br><span class="line">    arr[i] = arr[k];</span><br><span class="line">    arr[k] = tmp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://zhuanlan.zhihu.com/p/42586566">https://zhuanlan.zhihu.com/p/42586566</a></p>
]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
  </entry>
  <entry>
    <title>Data_Tree</title>
    <url>/2021/03/24/Data-Tree/</url>
    <content><![CDATA[<h4 id="树"><a href="#树" class="headerlink" title="树"></a>树</h4><h5 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h5><ol>
<li>满二叉树 :</li>
</ol>
<p>​        在不增加树的层数的前提下，无法再多添加一个节点的二叉树就是满二叉树。</p>
<ol start="2">
<li>完全二叉树 :</li>
</ol>
<p>​        如果只是删除了满二叉树最底层最右边的连续若干个节点，这样形成的二叉树是完全二叉树。</p>
<h5 id="树的存储"><a href="#树的存储" class="headerlink" title="树的存储"></a>树的存储</h5><p>二叉树表示法</p>
<p>​    先把一般树转化为二叉树，再存储二叉树。</p>
<p>​    一般树转化为二叉树的方法是:设法保证任意一个节点的</p>
<ol>
<li><p>左指针域指向它的第一个孩子</p>
</li>
<li><p>右指针域指向它的下一个兄弟</p>
<p>只要能满足此条件，就可以把一个普通树转化为二叉树来存储。</p>
</li>
</ol>
<h4 id="BST树-Binary-search-tree"><a href="#BST树-Binary-search-tree" class="headerlink" title="BST树- Binary search tree"></a>BST树- Binary search tree</h4><h5 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h5><p><img src="/2021/03/24/Data-Tree/2021-06-08_17-53-25.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function"><span class="keyword">static</span> BinNodePosi&lt;T&gt; <span class="title">removeAt</span><span class="params">(BinNodePosi&lt;T&gt; &amp;x, BinNodePosi&lt;T&gt; &amp;hot)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot; x %d  \n&quot;</span>,x-&gt;data);</span><br><span class="line"></span><br><span class="line">    BinNodePosi&lt;T&gt; w = x; <span class="comment">//实际被摘除的节点，初值同x</span></span><br><span class="line">    BinNodePosi&lt;T&gt; succ = <span class="literal">NULL</span>; <span class="comment">//实际被删除节点的接替者</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">HasLChild</span> (*x)) <span class="comment">//若*x的左子树为空，则可</span></span><br><span class="line">        succ = x = x-&gt;rc; <span class="comment">//直接将*x替换为其右子树</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">HasRChild</span> (*x)) <span class="comment">//若右子树为空，则可</span></span><br><span class="line">        succ = x = x-&gt;lc; <span class="comment">//对称地处理——注意：此时succ != NULL</span></span><br><span class="line">    <span class="keyword">else</span> &#123; <span class="comment">//若左右子树均存在，则选择x的直接后继作为实际被摘除节点，为此需要</span></span><br><span class="line">        w = w-&gt;<span class="built_in">succ</span>(); <span class="comment">//（在右子树中）找到*x的直接后继*w</span></span><br><span class="line">        <span class="built_in">swap</span>(x-&gt;data, w-&gt;data); <span class="comment">//交换*x和*w的数据元素</span></span><br><span class="line">        BinNodePosi&lt;T&gt; u = w-&gt;parent;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;u %d  x %d  \n&quot;</span>,u-&gt;data,x-&gt;data);</span><br><span class="line">        ((u == x) ? u-&gt;rc : u-&gt;lc) = succ = w-&gt;rc; <span class="comment">//隔离节点*w      // (u == x)感觉没作用呀 ???</span></span><br><span class="line">    &#125;</span><br><span class="line">    hot = w-&gt;parent; <span class="comment">//记录实际被删除节点的父亲</span></span><br><span class="line">    <span class="keyword">if</span> (succ) succ-&gt;parent = hot; <span class="comment">//并将被删除节点的接替者与hot相联</span></span><br><span class="line">    <span class="built_in">release</span>(w-&gt;data);</span><br><span class="line">    <span class="built_in">release</span>(w);</span><br><span class="line">    <span class="keyword">return</span> succ; <span class="comment">//释放被摘除节点，返回接替者</span></span><br><span class="line">&#125; <span class="comment">//rele</span></span><br></pre></td></tr></table></figure>



<p>​        </p>
<h5 id="树的遍历"><a href="#树的遍历" class="headerlink" title="树的遍历"></a>树的遍历</h5><p><img src="/2021/03/24/Data-Tree/2021-04-23_17-38pre_order_traversal.png" alt="tu"></p>
<p>​    M N 作为根节点</p>
<ol>
<li><p>先序遍历[先访问根节点]</p>
<p>先访问根节点</p>
<p>再先序访问左子树</p>
<p>再先序访问右子树</p>
<p>A B Q M N L C D H K E F</p>
</li>
<li><p>中序遍历[中间访问根节点]</p>
<p>中序遍历左子树</p>
<p>再访问根节点</p>
<p>再中遍历右子树</p>
<p>M Q N B L A H D K C  E F</p>
</li>
<li><p> 后序遍历[最后访问根节点]</p>
</li>
</ol>
<p>   先中序遍历左子树</p>
<p>   再中序遍历右子树</p>
<p>   再访问根节点</p>
<p>   M N Q L B  H K D F E C A</p>
<h6 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h6><p>通过先序和中序或者 中序和后序可以还原出 原始的二叉树.</p>
<ol>
<li><p>示例1</p>
<p>先序: ABCDEFGH</p>
<p>中序:BDCEAFHG</p>
<p>求后序: DECBHGFA</p>
</li>
<li><p>示例2</p>
<p>先序: ABDGHCEFI</p>
<p>中序:GDHBAECIF</p>
<p><img src="/2021/03/24/Data-Tree/2021-04-23_17-38-57_order_traversal.png"></p>
<p>求后序 :  G H D B E I F C A</p>
</li>
</ol>
<h5 id="二叉树遍历示例"><a href="#二叉树遍历示例" class="headerlink" title="二叉树遍历示例"></a>二叉树遍历示例</h5><p><img src="/2021/03/24/Data-Tree/tree_traversal.code.png"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;zconf.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pLchild</span>;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pRchild</span>;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">struct BTNode *<span class="title">createBTree</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preTraverseBTree</span><span class="params">(struct BTNode *pNode)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pT</span> =</span> createBTree();</span><br><span class="line"></span><br><span class="line"><span class="comment">//    preTraverseBTree(pT);</span></span><br><span class="line"><span class="comment">//    inTraverseBTree(pT);</span></span><br><span class="line">    postTraverseBTree(pT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preTraverseBTree</span><span class="params">(struct BTNode *pNode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pNode-&gt;data != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>, pNode-&gt;data);</span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;pLchild != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            preTraverseBTree(pNode-&gt;pLchild);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;pRchild != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            preTraverseBTree(pNode-&gt;pRchild);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inTraverseBTree</span><span class="params">(struct BTNode *pNode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pNode-&gt;data != <span class="literal">NULL</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;pLchild != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            inTraverseBTree(pNode-&gt;pLchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>, pNode-&gt;data);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;pRchild != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            inTraverseBTree(pNode-&gt;pRchild);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">postTraverseBTree</span><span class="params">(struct BTNode *pNode)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (pNode-&gt;data != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;pLchild != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            postTraverseBTree(pNode-&gt;pLchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pNode-&gt;pRchild != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            postTraverseBTree(pNode-&gt;pRchild);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>, pNode-&gt;data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">struct BTNode *<span class="title">createBTree</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pA</span> =</span> (struct BTNode *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct BTNode));</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pB</span> =</span> (struct BTNode *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct BTNode));</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pC</span> =</span> (struct BTNode *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct BTNode));</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pD</span> =</span> (struct BTNode *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct BTNode));</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">BTNode</span> *<span class="title">pE</span> =</span> (struct BTNode *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(struct BTNode));</span><br><span class="line"></span><br><span class="line">    pA-&gt;data = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    pB-&gt;data = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    pC-&gt;data = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">    pD-&gt;data = <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">    pE-&gt;data = <span class="string">&#x27;E&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    pA-&gt;pLchild = pB;</span><br><span class="line">    pA-&gt;pRchild = pC;</span><br><span class="line">    pB-&gt;pLchild = pB-&gt;pRchild = <span class="literal">NULL</span>;</span><br><span class="line">    pC-&gt;pLchild = pD;</span><br><span class="line">    pC-&gt;pRchild = <span class="literal">NULL</span>;</span><br><span class="line">    pD-&gt;pLchild = <span class="literal">NULL</span>;</span><br><span class="line">    pD-&gt;pRchild = pE;</span><br><span class="line">    pE-&gt;pLchild = pE-&gt;pRchild = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> pA;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="AVL树"><a href="#AVL树" class="headerlink" title="AVL树"></a>AVL树</h5><p>左右子树的高度差 不超过1</p>
<p><img src="/2021/03/24/Data-Tree/2021-06-09_16-38-48_avl.png"></p>
<p>通过左旋或者右旋(左旋右旋后一定不会破坏二叉搜索树的查找规则</p>
<p><img src="/2021/03/24/Data-Tree/AVL.png"></p>
<h5 id="zig-zag"><a href="#zig-zag" class="headerlink" title="zig zag"></a>zig zag</h5><p>zig    顺时针</p>
<p>zag  逆时针</p>
<p><img src="/2021/03/24/Data-Tree/2021-06-09_15-10-10.png"></p>
<p>g : grandparent节点</p>
<p>p : parent节点</p>
<h5 id="zigzig"><a href="#zigzig" class="headerlink" title="zigzig"></a>zigzig</h5><p><img src="/2021/03/24/Data-Tree/2021-06-09_15-24-12_zigzig.png"></p>
<h5 id="zigzag节点"><a href="#zigzag节点" class="headerlink" title="zigzag节点"></a>zigzag节点</h5><p><img src="/2021/03/24/Data-Tree/home/mc/Documents/noteforme.github.io/source/_posts/Data-Tree/2021-06-09_15-26-26_zigzag.png"></p>
<p>类似工人组装魔方，确定好 G P V 所对应的 a b c ,何 0 1 2 3 所对应的 T0 T1 T2  T3,直接组装程图1的树</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; BinNodePosi&lt;T&gt; BST&lt;T&gt;::<span class="built_in">rotateAt</span> ( BinNodePosi&lt;T&gt; v ) &#123; <span class="comment">//v为非空孙辈节点</span></span><br><span class="line">    <span class="comment">/*DSA*/</span><span class="keyword">if</span> ( !v ) &#123; <span class="built_in">printf</span> ( <span class="string">&quot;\a\nFail to rotate a null node\n&quot;</span> ); <span class="built_in">exit</span> ( <span class="number">-1</span> ); &#125;</span><br><span class="line">    BinNodePosi&lt;T&gt; p = v-&gt;parent; BinNodePosi&lt;T&gt; g = p-&gt;parent; <span class="comment">//视v、p和g相对位置分四种情况</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">IsLChild</span> ( *p ) ) <span class="comment">/* zig */</span></span><br><span class="line">        <span class="keyword">if</span> ( <span class="built_in">IsLChild</span> ( *v ) ) &#123; <span class="comment">/* zig-zig */</span> <span class="comment">//*DSA*/printf(&quot;\tzIg-zIg: &quot;);</span></span><br><span class="line">            p-&gt;parent = g-&gt;parent; <span class="comment">//向上联接</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">connect34</span> ( v, p, g, v-&gt;lc, v-&gt;rc, p-&gt;rc, g-&gt;rc );</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">/* zig-zag */</span>  <span class="comment">//*DSA*/printf(&quot;\tzIg-zAg: &quot;);</span></span><br><span class="line">            v-&gt;parent = g-&gt;parent; <span class="comment">//向上联接</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">connect34</span> ( p, v, g, p-&gt;lc, v-&gt;lc, v-&gt;rc, g-&gt;rc );</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span>  <span class="comment">/* zag */</span></span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">IsRChild</span> ( *v ) ) &#123; <span class="comment">/* zag-zag */</span> <span class="comment">//*DSA*/printf(&quot;\tzAg-zAg: &quot;);</span></span><br><span class="line">        p-&gt;parent = g-&gt;parent; <span class="comment">//向上联接</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">connect34</span> ( g, p, v, g-&gt;lc, p-&gt;lc, v-&gt;lc, v-&gt;rc );</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">/* zag-zig */</span>  <span class="comment">//*DSA*/printf(&quot;\tzAg-zIg: &quot;);</span></span><br><span class="line">        v-&gt;parent = g-&gt;parent; <span class="comment">//向上联接</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">connect34</span> ( g, v, p, g-&gt;lc, v-&gt;lc, v-&gt;rc, p-&gt;rc );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h4 id="伸缩树"><a href="#伸缩树" class="headerlink" title="伸缩树"></a>伸缩树</h4><p><img src="/2021/03/24/Data-Tree/2021-06-09_22-05-22_shensuo.png"></p>
<h4 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h4><p>B树解决 一段一段从IO读取数据</p>
<p><img src="/2021/03/24/Data-Tree/2021-06-10_22-21-20_btree.png"></p>
<p><img src="/2021/03/24/Data-Tree/2021-06-10_22-59-50_BTREE2.png"></p>
<p><a href="https://www.xuetangx.com/learn/THU08091002048/THU08091002048/5883385/video/9195150">地址</a></p>
<h5 id="B树插入"><a href="#B树插入" class="headerlink" title="B树插入"></a>B树插入</h5><p>因为新节点的插入，导致所属节点的分支数超过B树阶次m的情况称作overflow</p>
<p><img src="/2021/03/24/Data-Tree/2021-06-11_15-07-47_btree_define.png"></p>
<p>​             m=5时，每个节点的分支数不超过5，一般节点分支树不少于是3, (3,5)</p>
<p>​            m=6    对于6阶B树，分支树的上限是6，下限是3。 (3,6)</p>
<h5 id="B树"><a href="#B树" class="headerlink" title="B树"></a>B树</h5><h6 id="上溢分裂"><a href="#上溢分裂" class="headerlink" title="上溢分裂"></a>上溢分裂</h6><p><img src="/2021/03/24/Data-Tree/2021-06-11_14-55-51_btree.png"></p>
<p>A[n/2]节点中点分裂</p>
<p><img src="/2021/03/24/Data-Tree/2021-06-11_15-32-52_split1.png"></p>
<p><img src="/2021/03/24/Data-Tree/2021-06-11_15-32-59_split2.png"></p>
<p>​               插入37，然后上溢分裂  </p>
<h6 id="下溢"><a href="#下溢" class="headerlink" title="下溢"></a>下溢</h6><p> 先从兄弟树借节点，借不到的话就合并</p>
<h4 id="2-3-4树"><a href="#2-3-4树" class="headerlink" title="2-3-4树"></a>2-3-4树</h4><h5 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h5><ol>
<li><p>所有叶子节点都拥有相同的深度。</p>
</li>
<li><p>节点只能是 2-节点、3-节点、4-节点之一。</p>
<blockquote>
<p>2-节点:包含 1 个元素的节点，有 2 个子节点; </p>
<p>3-节点:包含 2 个元素的节点，有 3 个子节点; </p>
<p>4-节点:包含 3 个元素的节点，有 4 个子节点; 所有节点必须至少包含1个元素</p>
</blockquote>
</li>
<li><p>元素始终保持排序顺序，整体上保持二叉查找树的性质，即父结点大于左子结点，小于右子结点;<br>  而且结点有多个元素时，每个元素必须大于它左边的和它的左子树中元素。</p>
</li>
</ol>
<h5 id="2-3树的生长"><a href="#2-3树的生长" class="headerlink" title="2-3树的生长"></a>2-3树的生长</h5><p>和标准的二叉查找树由上向下生长不同，2-3树的生长是由下向上的。</p>
<p><img src="/2021/03/24/Data-Tree/2-3grow.png"></p>
<h4 id="红黑二叉查找树"><a href="#红黑二叉查找树" class="headerlink" title="红黑二叉查找树"></a>红黑二叉查找树</h4><h5 id="2-3-4树与红黑树的等价关系"><a href="#2-3-4树与红黑树的等价关系" class="headerlink" title="2-3-4树与红黑树的等价关系"></a>2-3-4树与红黑树的等价关系</h5><p><img src="/2021/03/24/Data-Tree/2-3-4%E6%A0%91%E5%92%8C%E7%BA%A2%E9%BB%91%E6%A0%91%E7%AD%89%E4%BB%B7%E5%85%B3%E7%B3%BB.png"></p>
<p>​    </p>
<p>​        裂变状态 9先从黑节点(从4节点)变成红节点，10、12先从红节点变成黑节点。</p>
<h5 id="2-3-4-树"><a href="#2-3-4-树" class="headerlink" title="2-3-4 树"></a>2-3-4 树</h5><p>新增操作，从叶子节点开始</p>
<p><img src="/2021/03/24/Data-Tree/2-3-4%E6%A0%91.png"></p>
<h5 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h5><p><img src="/2021/03/24/Data-Tree/2021-06-12_20-50-01_redbtree.png"></p>
<h5 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h5><p>红黑树是一种结点带有颜色属性的二叉查找树，但它在二叉查找树之外，还有以下5大性质:</p>
<ol>
<li>节点是红色或黑色。</li>
<li>根是黑色。</li>
<li>所有叶子都是黑色(叶子是NIL节点，这类节点不可以忽视，否则代码会看不懂)。</li>
<li>每个红色节点必须有两个黑色的子节点。(从每个叶子到根的所有路径上不能有两个连续的红色节点。)</li>
<li>从任一节点到其每个叶子的所有简单路径都包含相同数目的黑色节点(黑色平衡)。// 2-3-4树层级相等.</li>
</ol>
<p><a href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">https://www.cs.usfca.edu/~galles/visualization/RedBlack.html</a></p>
<p>红黑树 新增都是红色节点</p>
<p>根据上面的等价关系，把2-3-4树转换成下面的红黑树。</p>
<p><img src="/2021/03/24/Data-Tree/%E8%BD%AC%E5%8C%96%E4%B8%BA%E7%BA%A2%E9%BB%91%E6%A0%91.png"></p>
<p><a href="https://www.bilibili.com/video/BV135411h7wJ?p=4">https://www.bilibili.com/video/BV135411h7wJ?p=4</a></p>
<h5 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h5><p><img src="/2021/03/24/Data-Tree/%E5%B7%A6%E6%97%8B.gif"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 围绕p左旋</span></span><br><span class="line"><span class="comment">   *       pf                    pf</span></span><br><span class="line"><span class="comment">   *      /                     /</span></span><br><span class="line"><span class="comment">   *     p                     pr(r)</span></span><br><span class="line"><span class="comment">   *    / \          ==&gt;      / \</span></span><br><span class="line"><span class="comment">   *  pl  pr(r)              p   rr</span></span><br><span class="line"><span class="comment">   *     / \                / \</span></span><br><span class="line"><span class="comment">   *    rl  rr             pl  rl</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">leftRotate</span><span class="params">(RBNode p)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">          RBNode r = p.right;</span><br><span class="line">          p.right = r.left;</span><br><span class="line">          <span class="keyword">if</span> (r.left != <span class="keyword">null</span>) &#123;</span><br><span class="line">              r.left.parent = p;</span><br><span class="line">          &#125;</span><br><span class="line">          r.parent = p.parent;</span><br><span class="line">          <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">              root = r;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p) &#123;</span><br><span class="line">              p.parent.left = r;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              p.parent.right = r;</span><br><span class="line">          &#125;</span><br><span class="line">          r.left = p;</span><br><span class="line">          p.parent = r;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<p><img src="/2021/03/24/Data-Tree/%E5%8F%B3%E6%97%8B.gif"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 右旋</span></span><br><span class="line"><span class="comment">   *    pf                pf</span></span><br><span class="line"><span class="comment">   *     \                 \</span></span><br><span class="line"><span class="comment">   *      p             (l)pl</span></span><br><span class="line"><span class="comment">   *     / \      =&gt;      /  \</span></span><br><span class="line"><span class="comment">   *(l)pl  pr            ll   p</span></span><br><span class="line"><span class="comment">   *   / \                   / \</span></span><br><span class="line"><span class="comment">   *  ll lr                 lr  pr</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> p</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rightRotate</span><span class="params">(RBNode p)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">          RBNode l = p.left;</span><br><span class="line">          p.left = l.right;</span><br><span class="line">          <span class="keyword">if</span> (l.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">              l.right.parent = p;</span><br><span class="line">          &#125;</span><br><span class="line">          l.parent = p.parent;</span><br><span class="line">          <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>) &#123;</span><br><span class="line">              root = l;</span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.right == p) &#123;</span><br><span class="line">              p.parent.right = l;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">              p.parent.left = l;</span><br><span class="line">          &#125;</span><br><span class="line">          l.right = p;</span><br><span class="line">          p.parent = l;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h5 id="新增"><a href="#新增" class="headerlink" title="新增"></a>新增</h5><p>红黑树新增，第一个节点 是红节点</p>
<p><img src="/2021/03/24/Data-Tree/tree_insert_01.png"></p>
<img src="/2021/03/24/Data-Tree/tree_insert_02.png" style="zoom:150%;">



<p>新增的节点都是红节点 </p>
<p>红黑树形成过程，忘了怎么形成，包括旋转 ， 节点颜色是怎么变化的。</p>
<h5 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h5><p><a href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">https://www.cs.usfca.edu/~galles/visualization/RedBlack.html</a></p>
<h4 id="图"><a href="#图" class="headerlink" title="图"></a>图</h4><p>找到最优路径</p>
]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
  </entry>
  <entry>
    <title>DataStructure</title>
    <url>/2020/05/06/DataStructure/</url>
    <content><![CDATA[<p>无论什么难题，降低复杂度的方法就是这三个步骤。只要你能深入理解这里的核心思想，就能把问题迎刃而解。</p>
<p>第一步，暴力解法。在没有任何时间、空间约束下，完成代码任务的开发。</p>
<p>第二步，无效操作处理。将代码中的无效计算、无效存储剔除，降低时间或空间复杂度。</p>
<p>第三步，时空转换。设计合理数据结构，完成时间复杂度向空间复杂度的转移。</p>
<p>既然说这是这门专栏的总纲，那么很显然后续的学习都是在这个总纲体系的框架中。第一步的暴力解法没有太多的套路，只要围绕你面临的问题出发，大胆发挥想象去尝试解决即可。第二步的无效操作处理中，你需要学会并掌握递归、二分法、排序算法、动态规划等常用的算法思维。第三步的时空转换，你需要对数据的操作进行细分，全面掌握常见数据结构的基础知识。再围绕问题，有针对性的设计数据结构、采用合理的算法思维，去不断完成时空转移，降低时间复杂度。</p>
<img src="/2020/05/06/DataStructure/datastructure_overview.jpg" alt="datastructure_overview" style="zoom:67%;">

<p><em><a href="https://github.com/labuladong/fucking-algorithm">https://github.com/labuladong/fucking-algorithm</a></em></p>
<h4 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h4><p><img src="/2020/05/06/DataStructure/%E6%89%A7%E8%A1%8C%E6%AD%A5%E9%AA%A4.png"></p>
<p>消耗计算时间和计算空间</p>
<h5 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h5><ul>
<li><p>对数阶</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> count =<span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(count &lt; n)&#123;</span><br><span class="line">  count = count * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>代码看到 2 * 2 * 2 … 最终离n很近，最终退出循环，2^x =n ,得到 x = log2^n,所以这个循环时间复杂度为O(logn)</p>
</blockquote>
</li>
</ul>
<h5 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h5><p>空间方面主要体现在计算过程中,对于存储资源的消耗情况</p>
<p>![](DataStructure/Screen Shot 2021-03-12 at 5.37.58 PM.png)</p>
<p>![](DataStructure/Screen Shot 2021-03-12 at 5.38.08 PM.png)</p>
<h4 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h4><p>​    </p>
<p><img src="/2020/05/06/DataStructure/2021-04-20_15-49-24LinkedLIst.png"></p>
<p>p,q指向的都是整体</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span>&#123;</span></span><br><span class="line">	<span class="keyword">int</span> data; <span class="comment">// 存储数据本身</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span> *<span class="title">pNext</span>;</span> <span class="comment">//pNext存储  它指向的下一个节点的指针</span></span><br><span class="line">&#125; NODE, *PNODE;</span><br><span class="line"><span class="comment">// NODE等价于struct node</span></span><br><span class="line"><span class="comment">//PNODE等价于struct node*</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//将动态分配的新节点的地址赋给p</span></span><br><span class="line">PNODE p = (PNODE)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(NODE));</span><br><span class="line"></span><br><span class="line"><span class="built_in">free</span>(p) <span class="comment">//删除p指向节点所占的内存，不是删除p本身所占的内存</span></span><br><span class="line"></span><br><span class="line">p-&gt;pNext; <span class="comment">//p所指向结构体变量中pNext成员本身</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p>插入q节点</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">方法<span class="number">1</span>:</span><br><span class="line">r = p-&gt; pNext ; p-&gt;pNext =q ; q-&gt;pNext = r;</span><br><span class="line">方法<span class="number">2</span>:</span><br><span class="line">q-&gt;pNext = p-&gt;pNext;</span><br><span class="line">p-&gt;pNext = q;</span><br></pre></td></tr></table></figure></li>
<li><p>删除p后面的节点</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line">r = p-&gt;pNext;</span><br><span class="line">p-&gt;pNext= r-&gt;pNext;</span><br><span class="line"><span class="built_in">free</span>(r);</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h4><h5 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h5><p><img src="/2020/05/06/DataStructure/Data-LinkedList/DoubleLInkedList_insert_middle.png"></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">ListNodePosi &lt;T&gt; <span class="built_in">insertAsPred</span>(T <span class="keyword">const</span>&amp;e)&#123;<span class="comment">//紧靠当前节点之前插入新节点</span></span><br><span class="line">    ListNodePosi&lt;T&gt; x = <span class="keyword">new</span> <span class="built_in">ListNode</span>(e,pred,<span class="keyword">this</span>); <span class="comment">//创建新节点</span></span><br><span class="line">    pred-&gt;succ = x;</span><br><span class="line">    <span class="keyword">this</span>-&gt;pred= x;<span class="comment">//设置正向链接,这里是当前节点的前置节点的意思，容易和节点pred混淆</span></span><br><span class="line">    <span class="keyword">return</span> x; <span class="comment">//返回新节点的位置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h4><ol>
<li>递归必须得有一个明确的中止条件。</li>
<li>该函数所处理的数据规模必须在递减。</li>
</ol>
<h5 id="递归复杂度"><a href="#递归复杂度" class="headerlink" title="递归复杂度"></a>递归复杂度</h5><h6 id="递归跟踪-recursion-trace-分析"><a href="#递归跟踪-recursion-trace-分析" class="headerlink" title="递归跟踪(recursion trace)分析"></a>递归跟踪(recursion trace)分析</h6><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span>(<span class="keyword">int</span> A[],<span class="keyword">int</span> n)&#123;</span><br><span class="line">	<span class="keyword">return</span> (n&lt;<span class="number">1</span>)?</span><br><span class="line">        <span class="number">0</span>:<span class="built_in">sum</span>(A,n<span class="number">-1</span>)+A[n<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<img src="/2020/05/06/DataStructure/2021-04-25_17-54-13.png" style="zoom:50%;">

<p>检查每个<strong>递归实例</strong>，累计所需的时间(调用语句本身，计入对应的子实例)</p>
<p>其总和即算法执行时间</p>
<p>本例中，单个递归实例自身只需o(1)时间</p>
<p>T(n) = o(1)  * (n+1) = o(n)</p>
<h6 id="递归方程"><a href="#递归方程" class="headerlink" title="递归方程"></a>递归方程</h6><p>求解sum(A,n) : 递归求解规模为n-1的问题sum(A,n-1) 加上 A[n-1]  。</p>
<p>​    T(n) = T(n-1) + o(1)  // 为了求解T(n)所需要的时间,花了T(n-1)的时间求解n-1的问题,然后再花了o(1)的时间 </p>
<p>​     T(0) = o(1)</p>
<blockquote>
<p>T(n) = T(n-1) + o(1) //两边同时 -n</p>
<p>T(n) -n = T(n-1) -(n-1) </p>
<p>​             = …</p>
<p>​             =T(2) - 2</p>
<p>​            = T(1) -1 </p>
<p>​            =T(0)</p>
<p>T(n) = o(1) +n  = o(n)</p>
</blockquote>
<h5 id="递归实例"><a href="#递归实例" class="headerlink" title="递归实例"></a>递归实例</h5><h6 id="阶乘-、求和"><a href="#阶乘-、求和" class="headerlink" title="阶乘 、求和"></a>阶乘 、求和</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> n)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;n=1 输出 %ld \n &quot;</span>, f(<span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;n=2 输出 %ld \n &quot;</span>, f(<span class="number">2</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;n=3 输出 %ld \n &quot;</span>, f(<span class="number">3</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;n=4 输出 %ld \n &quot;</span>, f(<span class="number">4</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;n=5 输出 %ld \n &quot;</span>, f(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;n=100 相加 %ld \n &quot;</span>, sum(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> val,mult = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入一个数: val=&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;val);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= val; ++i) &#123;</span><br><span class="line">        mult = mult * i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d的阶乘是: %d\n&quot;</span>,val,mult);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//假定n的值是1或大于1的值</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> n * f(n - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1+2+...+100</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sum</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (n + sum(n<span class="number">-1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="汉诺塔"><a href="#汉诺塔" class="headerlink" title="汉诺塔"></a>汉诺塔</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hannuota</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">char</span> a, <span class="keyword">char</span> b, <span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *      一个盘子 :</span></span><br><span class="line"><span class="comment">     *              直接将a柱子上的盘子从a移动到b</span></span><br><span class="line"><span class="comment">     *      否则 :</span></span><br><span class="line"><span class="comment">     *              先将a柱子上的n-1个盘子借助c移到b</span></span><br><span class="line"><span class="comment">     *              直接将a柱子上的盘中从a移到c</span></span><br><span class="line"><span class="comment">     *              最后将b柱子上的n-1个盘子借助a移到c</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="number">1</span> == n) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;将编号为%d的盘子直接从%c柱子移到%c柱子\n&quot;</span>, n, a, c);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        hannuota(n - <span class="number">1</span>, a, c, b);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;将编号为%d的盘子直接从%c柱子移到%c柱子\n&quot;</span>, n, a, c);</span><br><span class="line">        hannuota(n - <span class="number">1</span>, b, a, c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> ch1 = <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">    <span class="keyword">char</span> ch2 = <span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">    <span class="keyword">char</span> ch3 = <span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入要移动盘子的个数:&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">    hannuota(n,<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Fibonacci-c"><a href="#Fibonacci-c" class="headerlink" title="Fibonacci.c"></a>Fibonacci.c</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span>  <span class="title">f</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(n==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f(n<span class="number">-1</span>)+f(n<span class="number">-2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;输入n的值为 &quot;</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;n);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;f(n) %d \n&quot;</span>,f(n));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>上面这种求和方式，随着n增加，时间复杂度会指数型增加，到了40已经算不动了，里面会有大量重复的计算</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">f</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> f = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> g = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (n--)&#123;</span><br><span class="line">        g = g+f;</span><br><span class="line">        f = g-f;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> g;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种时间复杂度O(n),不要太快,交替滚动向前推进。</p>
<h4 id="Hash-散列"><a href="#Hash-散列" class="headerlink" title="Hash(散列)"></a>Hash(散列)</h4><p>[Hash(key) + 1^2] % M          以平方数为距离，确定下一试探桶单元</p>
<p> M为三列表的容量</p>
<p><img src="/2020/05/06/DataStructure/2021-06-15_09-13-49_diction.png"></p>
]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
      <tags>
        <tag>DataStructure</tag>
      </tags>
  </entry>
  <entry>
    <title>DeliverValue</title>
    <url>/2020/04/28/DeliverValue/</url>
    <content><![CDATA[<h5 id="Value-Copy"><a href="#Value-Copy" class="headerlink" title="Value Copy"></a>Value Copy</h5><p><a href="https://blog.csdn.net/huaiyiheyuan/article/details/55102057">https://blog.csdn.net/huaiyiheyuan/article/details/55102057</a></p>
<p><a href="https://mp.weixin.qq.com/s/lP-xB5yzpvqVEiA439euVQ">https://mp.weixin.qq.com/s/lP-xB5yzpvqVEiA439euVQ</a></p>
<p><a href="https://juejin.im/post/5e91cc6c51882573a343db03">https://juejin.im/post/5e91cc6c51882573a343db03</a></p>
<p>基本数据类型  declare in stack</p>
<p>Object  declare in Heap</p>
<p>Java value deliver  </p>
<p><a href="https://juejin.im/post/5af3a44bf265da0b74522bf3">https://juejin.im/post/5af3a44bf265da0b74522bf3</a></p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">String</span> name = <span class="string">&quot;hollischuang&quot;</span>;</span><br><span class="line"><span class="keyword">String</span> name = <span class="keyword">new</span> <span class="built_in"><span class="keyword">String</span></span>(<span class="string">&quot;hollischuang&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPattern_Chain</title>
    <url>/2020/07/22/DesignPattern-Chain/</url>
    <content><![CDATA[<h5 id="传统方案OA系统审批问题"><a href="#传统方案OA系统审批问题" class="headerlink" title="传统方案OA系统审批问题"></a>传统方案OA系统审批问题</h5><p><img src="/2020/07/22/DesignPattern-Chain/2021-09-12_7.12.05_oa.png" alt="2021-09-12_7.12.05_oa"></p>
<h5 id="职责链模式介绍"><a href="#职责链模式介绍" class="headerlink" title="职责链模式介绍"></a>职责链模式介绍</h5><p><img src="/2020/07/22/DesignPattern-Chain/2021-09-12_7.10.38_chain_describe.png" alt="2021-09-12_7.10.38_chain_describe"></p>
<p>使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这个对象连城一条链，并沿着这条传递该请求。直到有一个对象处理它为止。</p>
<p>![2021-09-12_7.11.21_ class](DesignPattern-Chain/2021-09-12_7.11.21_ class.png)</p>
<p><img src="/2020/07/22/DesignPattern-Chain/2021-09-12_7.59.12_responsible_role.png" alt="2021-09-12_7.59.12_responsible_role"></p>
<p><img src="/2020/07/22/DesignPattern-Chain/2021-09-12_8.10.25_implement.png" alt="2021-09-12_8.10.25_implement"></p>
<h5 id="大话示例"><a href="#大话示例" class="headerlink" title="大话示例"></a>大话示例</h5><p>chain of Responsibility Pattern</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String requestType;</span><br><span class="line">    <span class="keyword">public</span> String requestContent;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonManager</span> <span class="keyword">extends</span>  <span class="title">Manager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CommonManager</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">requestApplications</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;请假&quot;</span>.equals(request.requestType)&amp;&amp;request.number&lt;<span class="number">2</span>)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot; &quot;</span>+ request.requestContent+ <span class="string">&quot; 数量   &quot;</span>+ request.number+<span class="string">&quot; 被批准&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (superior!=<span class="keyword">null</span>)</span><br><span class="line">                superior.requestApplications(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MajorDomo</span> <span class="keyword">extends</span>  <span class="title">Manager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MajorDomo</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">requestApplications</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;请假&quot;</span>.equals(request.requestType)&amp;&amp;request.number&lt;<span class="number">5</span>)&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot; &quot;</span>+ request.requestContent+ <span class="string">&quot; 数量   &quot;</span>+ request.number+<span class="string">&quot; 被批准&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (superior!=<span class="keyword">null</span>)</span><br><span class="line">                superior.requestApplications(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralManager</span> <span class="keyword">extends</span> <span class="title">Manager</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GeneralManager</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">requestApplications</span><span class="params">(Request request)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;请假&quot;</span>.equals(request.requestType) &amp;&amp; request.number &lt; <span class="number">5</span>) &#123;</span><br><span class="line">            System.out.println(name + <span class="string">&quot; &quot;</span> + request.requestContent + <span class="string">&quot; 数量   &quot;</span> + request.number + <span class="string">&quot;  被批准&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;加薪&quot;</span>.equals(request.requestType) &amp;&amp; request.number &lt; <span class="number">500</span>) &#123;</span><br><span class="line">            System.out.println(name + <span class="string">&quot; &quot;</span> + request.requestContent + <span class="string">&quot; 数量   &quot;</span> + request.number + <span class="string">&quot;  被批准&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;加薪&quot;</span>.equals(request.requestType) &amp;&amp; request.number &gt; <span class="number">500</span>) &#123;</span><br><span class="line">            System.out.println(name + <span class="string">&quot; &quot;</span> + request.requestContent + <span class="string">&quot; 数量   &quot;</span> + request.number + <span class="string">&quot;  再说吧&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">CommonManager commonManager = <span class="keyword">new</span> CommonManager(<span class="string">&quot;经理&quot;</span>);</span><br><span class="line">MajorDomo majorDomo = <span class="keyword">new</span> MajorDomo(<span class="string">&quot;总监&quot;</span>);</span><br><span class="line">GeneralManager generalManager = <span class="keyword">new</span> GeneralManager(<span class="string">&quot;总经理&quot;</span>);</span><br><span class="line"></span><br><span class="line">commonManager.setSuperior(majorDomo);<span class="comment">//设置上级</span></span><br><span class="line">majorDomo.setSuperior(generalManager);</span><br><span class="line"></span><br><span class="line">Request request = <span class="keyword">new</span> Request();</span><br><span class="line">request.requestType = <span class="string">&quot;请假&quot;</span>;</span><br><span class="line">request.number = <span class="number">4</span>;</span><br><span class="line">request.requestContent = <span class="string">&quot;去找小姐姐&quot;</span>;</span><br><span class="line">commonManager.requestApplications(request);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Request request1 = <span class="keyword">new</span> Request();</span><br><span class="line">request1.requestType = <span class="string">&quot;加薪&quot;</span>;</span><br><span class="line">request1.number = <span class="number">888</span>;</span><br><span class="line">request1.requestContent = <span class="string">&quot;给哥加薪&quot;</span>;</span><br><span class="line">commonManager.requestApplications(request1);</span><br><span class="line">  </span><br></pre></td></tr></table></figure>



<h5 id="责任链模式作用"><a href="#责任链模式作用" class="headerlink" title="责任链模式作用"></a>责任链模式作用</h5><p><img src="/2020/07/22/DesignPattern-Chain/2021-09-12_8.44.01_function.png" alt="2021-09-12_8.44.01_function"></p>
<p><a href="https://www.bilibili.com/video/BV1G4411c7N4?p=149&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1G4411c7N4?p=149&amp;spm_id_from=pageDriver</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPattern_Decorator</title>
    <url>/2020/07/12/DesignPattern-Decorator/</url>
    <content><![CDATA[<p><strong>装饰器模式</strong></p>
<p>应用场景: 拓展一个类的功能或给一个类添加附加职责.</p>
<p>优点: </p>
<ol>
<li>不改变原有对象的情况下给一个对象拓展功能</li>
<li>使用不同的组合实现不同的效果</li>
<li>符合开闭原则</li>
</ol>
<p><img src="/2020/07/12/DesignPattern-Decorator/2021-07-12_decorator.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent</span> <span class="keyword">implements</span>  <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拍照&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对具体类的拓展</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent1</span> <span class="keyword">implements</span>  <span class="title">Component</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Component component;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreteComponent1</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.component = component;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;美颜&quot;</span>);</span><br><span class="line">        component.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"><span class="keyword">new</span> ConcreteComponent1(<span class="keyword">new</span> ConcreteComponent()).operation();</span><br></pre></td></tr></table></figure>

<p>也可以把装饰器抽象出来</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 具体类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreateComponent</span> <span class="keyword">implements</span>  <span class="title">Component</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拍照&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">implements</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">    Component component;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.component = component;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        component.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对具体类的拓展</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreateComponent1</span> <span class="keyword">extends</span>  <span class="title">Decorator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreateComponent1</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;美颜&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreateComponent2</span> <span class="keyword">extends</span>  <span class="title">Decorator</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConcreateComponent2</span><span class="params">(Component component)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">operation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;呵呵&quot;</span>);</span><br><span class="line">        <span class="keyword">super</span>.operation();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试</span></span><br><span class="line"> ConcreateComponent2 concreateComponent1 = <span class="keyword">new</span> ConcreateComponent2(<span class="keyword">new</span> ConcreateComponent1(<span class="keyword">new</span> 	  ConcreateComponent()));</span><br><span class="line">        concreateComponent1.operation();</span><br></pre></td></tr></table></figure>



<p><a href="https://www.bilibili.com/video/BV1hp4y1D7MP?from=search&amp;seid=6785978722248254154">https://www.bilibili.com/video/BV1hp4y1D7MP?from=search&amp;seid=6785978722248254154</a></p>
<p><a href="https://www.bilibili.com/video/BV1Hv411r7uN?p=2">https://www.bilibili.com/video/BV1Hv411r7uN?p=2</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPattern_Proxy</title>
    <url>/2021/01/14/DesignPattern-Proxy/</url>
    <content><![CDATA[<h4 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h4><h5 id="静态代理实现"><a href="#静态代理实现" class="headerlink" title="静态代理实现"></a>静态代理实现</h5><p>编译的时候就已经存在</p>
<p><img src="https://www.oodesign.com/images/design_patterns/structural/proxy-design-pattern-implementation-uml-class-diagram.png"></p>
<p>代理模式</p>
<ol>
<li>代理类与委托类有同样的接口</li>
<li>代理类主要负责为委托类预处理消息、过滤消息、把消息转发给委托类，以及事后处理消息等。</li>
<li>一个代理类的对象与一个委托类的对象关联，代理类的对象本身并不真正实现服务，而是通过调用委托类的对象的相关方法，来提供特定的服务。</li>
</ol>
<h5 id="kotlin-委托的作用"><a href="#kotlin-委托的作用" class="headerlink" title="kotlin 委托的作用"></a>kotlin 委托的作用</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BaseImpl</span></span>(<span class="keyword">val</span> x: <span class="built_in">Int</span>) : Base &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">print</span><span class="params">()</span></span> &#123; print(x) &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span></span>(b: Base) : Base <span class="keyword">by</span> b</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> b = BaseImpl(<span class="number">10</span>)</span><br><span class="line">    Derived(b).print()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ZyxInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhangYuXin</span> <span class="keyword">implements</span>  <span class="title">ZyxInterface</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello from zyx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>代理类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ZhangYuXinProxy</span> <span class="keyword">implements</span> <span class="title">ZyxInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ZhangYuXin zhangYuXin;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ZhangYuXinProxy</span><span class="params">(ZhangYuXin zhangYuXin)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.zhangYuXin = zhangYuXin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;拍电影前的准备工作&quot;</span>);</span><br><span class="line">        zhangYuXin.sayHello();</span><br><span class="line">        System.out.println(<span class="string">&quot;拍电影后的收尾工作&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ZhangYuXin zyxHello = <span class="keyword">new</span> ZhangYuXin();</span><br><span class="line">ZhangYuXinProxy zhangYuXin = <span class="keyword">new</span> ZhangYuXinProxy(zyxHello);</span><br><span class="line">zhangYuXin.sayHello();</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<blockquote>
<p>拍电影前的准备工作<br>Hello from zyx<br>拍电影后的收尾工作</p>
</blockquote>
<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><p> 通过反射机制生成的代理对象</p>
<p><img src="https://static.packt-cdn.com/products/9781785888038/graphics/B05180_05_01.jpg"></p>
<h5 id="动态代理原理"><a href="#动态代理原理" class="headerlink" title="动态代理原理"></a>动态代理原理</h5><p>生成的动态代理Class文件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] classFile = ProxyGenerator.generateProxyClass(<span class="string">&quot;BinInterface$0&quot;</span>, <span class="keyword">new</span> Class[]&#123;ZyxInterface.class&#125;);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    FileOutputStream out = <span class="keyword">new</span> FileOutputStream( <span class="string">&quot;BinInterface$0.class&quot;</span>);</span><br><span class="line">    out.write(classFile);</span><br><span class="line">    out.flush();</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>BinInterface$0.class</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">BinInterface</span>$0 <span class="keyword">extends</span> <span class="title">Proxy</span> <span class="keyword">implements</span> <span class="title">ZyxInterface</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m1;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m3;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m2;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Method m0;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BinInterface$<span class="number">0</span>(InvocationHandler var1) <span class="keyword">throws</span>  &#123;</span><br><span class="line">        <span class="keyword">super</span>(var1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object var1)</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Boolean)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m1, <span class="keyword">new</span> Object[]&#123;var1&#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var3;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var4) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var4);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//调用接口的方法就会调用sayHello方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m3, (Object[])<span class="keyword">null</span>); <span class="comment">//h就是create方法传进来的InvocationHandler,然后回调invoke方法</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (String)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m2, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> <span class="keyword">throws</span>  </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Integer)<span class="keyword">super</span>.h.invoke(<span class="keyword">this</span>, m0, (Object[])<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException | Error var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> var2;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> UndeclaredThrowableException(var3);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            m1 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;equals&quot;</span>, Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>));</span><br><span class="line">            m3 = Class.forName(<span class="string">&quot;pattern.proxy.xiangxue.ZyxInterface&quot;</span>).getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">            m2 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;toString&quot;</span>);</span><br><span class="line">            m0 = Class.forName(<span class="string">&quot;java.lang.Object&quot;</span>).getMethod(<span class="string">&quot;hashCode&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException var2) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchMethodError(var2.getMessage());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NoClassDefFoundError(var3.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="动态代理实现"><a href="#动态代理实现" class="headerlink" title="动态代理实现"></a>动态代理实现</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoSomeThingDynamic</span> </span>&#123;</span><br><span class="line">    Object object;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DoSomeThingDynamic</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.object = object;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> say 需要代理执行的接口类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 动态代理 运行时生成的一个say对应类型的类，用于调用say接口的时候 运行</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; say)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(say.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> Class&lt;?&gt;[]&#123;say&#125;,</span><br><span class="line">                <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">                    <span class="comment">//method这个函数是 反射的函数， method具体代表的是 代理在执行的当前的函数</span></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object o, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;拍电影前的准备工作&quot;</span>);</span><br><span class="line">                        Object result = method.invoke(object, args); <span class="comment">//等价于 zhangYuXin.sayHello();</span></span><br><span class="line">                        System.out.println(<span class="string">&quot;拍电影后的收尾工作&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> result;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DoSomeThingDynamic say1 = <span class="keyword">new</span> DoSomeThingDynamic(zyxHello); <span class="comment">//动态生成代理类</span></span><br><span class="line">ZyxInterface zyxProxy = say1.create(ZyxInterface.class);</span><br><span class="line">zyxProxy.sayHello();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;---------------------\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">BinBin binBye = <span class="keyword">new</span> BinBin();</span><br><span class="line">DoSomeThingDynamic say2 = <span class="keyword">new</span> DoSomeThingDynamic(binBye);	<span class="comment">//动态生成代理类</span></span><br><span class="line">BinInterface bbProxy = say2.create(BinInterface.class);</span><br><span class="line">bbProxy.sayBye();</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<blockquote>
<p>拍电影前的准备工作<br>Hello from zyx</p>
<p>拍电影后的收尾工作</p>
<hr>
<p>拍电影前的准备工作<br>Bye Bye from BinBin<br>拍电影后的收尾工作</p>
</blockquote>
<p><a href="https://www.bilibili.com/video/BV1ib4y1f7S1?p=10&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1ib4y1f7S1?p=10&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.bilibili.com/video/BV1uQ4y1Z7gA?p=23">https://www.bilibili.com/video/BV1uQ4y1Z7gA?p=23</a></p>
<p><a href="https://juejin.cn/post/6844903520919879694">https://juejin.cn/post/6844903520919879694</a></p>
<p><a href="https://juejin.cn/post/6844903978342301709">https://juejin.cn/post/6844903978342301709</a></p>
<p><a href="https://time.geekbang.org/column/article/201823">https://time.geekbang.org/column/article/201823</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPattern-Builder</title>
    <url>/2017/10/07/DesignPattern_Builder/</url>
    <content><![CDATA[<h1 id="Builder模式"><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h1><p>不直接生成想要的对象，而是让客户端利用所有必要的参数调用构造器（或者静态工厂），得到一个builder对象，然后客户端在builder对象上调用类似于setter的方法，来设置每个相关的可选参数</p>
<p> 既能保证像重叠构造器模式那样的安全性，也能保证像JavaBeans模式那么好的可读性</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts_03_Builder</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> servingSize;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> servings;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> calories;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> fat;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> sodium;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> carbohydrate;</span><br><span class="line">    <span class="keyword">public</span>  <span class="keyword">static</span>  <span class="class"><span class="keyword">class</span>  <span class="title">Builder</span></span>&#123;</span><br><span class="line">        <span class="comment">//Required parameters</span></span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> servingSize;</span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">final</span>  <span class="keyword">int</span> servings;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//Optional parameters = initialized to default values</span></span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">int</span> calories     = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">int</span> fat          = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">int</span> carbohydrate = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">private</span>  <span class="keyword">int</span> sodium       = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.servingSize = servingSize;</span><br><span class="line">            <span class="keyword">this</span>.servings = servings;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span>  Builder <span class="title">calories</span><span class="params">(<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">            calories = val;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span>  Builder <span class="title">fat</span><span class="params">(<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.fat = fat;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span>  Builder <span class="title">carbohydrate</span><span class="params">(<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">            carbohydrate = val;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span>  Builder <span class="title">sodium</span><span class="params">(<span class="keyword">int</span> val)</span></span>&#123;</span><br><span class="line">            sodium = val;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span>  NutritionFacts_03_Builder <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="keyword">return</span>  <span class="keyword">new</span> NutritionFacts_03_Builder(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">NutritionFacts_03_Builder</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.servingSize = builder.servingSize;</span><br><span class="line">        <span class="keyword">this</span>.servings = builder.servings;</span><br><span class="line">        <span class="keyword">this</span>.calories = builder.calories;</span><br><span class="line">        <span class="keyword">this</span>.fat = builder.fat;</span><br><span class="line">        <span class="keyword">this</span>.sodium = builder.sodium;</span><br><span class="line">        <span class="keyword">this</span>.carbohydrate = builder.carbohydrate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        NutritionFacts_03_Builder cocaCola = <span class="keyword">new</span> NutritionFacts_03_Builder.Builder(<span class="number">240</span>,<span class="number">9</span>)</span><br><span class="line">                .calories(<span class="number">100</span>).sodium(<span class="number">35</span>).carbohydrate(<span class="number">27</span>).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><p> 返回的this时怎么替代对象的</p>
<h5 id="对象创建更加灵活"><a href="#对象创建更加灵活" class="headerlink" title="对象创建更加灵活"></a>对象创建更加灵活</h5><p>当 isRef 为 true 的时候，arg 表示 String 类型的 refBeanId，type 不需要设置；当 isRef 为 false 的时候，arg、type 都需要设置</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstructorArg</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> isRef;</span><br><span class="line">    <span class="keyword">private</span> Class <span class="keyword">type</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Object</span> arg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="title">ConstructorArg</span>(<span class="params">Builder builder</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.isRef = isRef;</span><br><span class="line">        <span class="built_in">this</span>.type = <span class="keyword">type</span>;</span><br><span class="line">        <span class="built_in">this</span>.arg = arg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">boolean</span> isRef;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Class <span class="keyword">type</span>;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">Object</span> arg;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="title">Builder</span>(<span class="params"><span class="built_in">boolean</span> isRef</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.isRef = isRef;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="function"><span class="title">setType</span>(<span class="params">Class <span class="keyword">type</span></span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.type = <span class="keyword">type</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Builder <span class="function"><span class="title">setArg</span>(<span class="params"><span class="built_in">Object</span> arg</span>)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.arg = arg;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ConstructorArg <span class="function"><span class="title">build</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (isRef) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!(arg <span class="keyword">instanceof</span> <span class="built_in">String</span>)) &#123;</span><br><span class="line">                    <span class="comment">//这里refBeanId是ConstructorArg吗？只是判断了下arg类型是否为String</span></span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;当 isRef 为 true 的时候，arg 表示 String 类型refBeanId&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">type</span> != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;当 isRef 为 true 的时候，type 不需要设置&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!isRef) &#123;</span><br><span class="line">                <span class="keyword">if</span> (arg == <span class="literal">null</span> || <span class="keyword">type</span> == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;当 isRef 为 false 的时候，arg、type 都需要设置&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ConstructorArg(<span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPatterns-Adatper</title>
    <url>/2017/08/10/DesignPatterns_Adatper/</url>
    <content><![CDATA[<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><pre><code> //需要适配的类
public class Adaptee &#123;
  public  void specificRequest()&#123;
    System.out.println(&quot;需要适配的类&quot;);
  &#125;
&#125;

 //目标接口
public interface Target &#123;
 void request();
&#125;
</code></pre>
<h1 id="对象适配器（采用对象组合方式实现）"><a href="#对象适配器（采用对象组合方式实现）" class="headerlink" title="对象适配器（采用对象组合方式实现）"></a>对象适配器（采用对象组合方式实现）</h1><pre><code>public class Adapter implements Target &#123;
    //直接关联被适配类
    private Adaptee adaptee;

    //可以通过构造函数传入具体需要适配的被适配类对象
    public Adapter(Adaptee adaptee) &#123;
        this.adaptee = adaptee;
    &#125;

    @Override
    public void request() &#123;
        this.adaptee.specificRequest();
    &#125;

    public static void main(String[] args) &#123;
        Target adapter = new Adapter(new Adaptee());
        adapter.request();
    &#125;
&#125;
</code></pre>
<h1 id="类适配器模式-采用继承实现"><a href="#类适配器模式-采用继承实现" class="headerlink" title="类适配器模式(采用继承实现)"></a>类适配器模式(采用继承实现)</h1><pre><code>public class CAdapter extends Adaptee implements Target &#123;
    @Override
    public void request() &#123;
        super.specificRequest();
    &#125;

    public static void main(String[] args) &#123;

        Target adapter = new CAdapter();
        adapter.request();
    &#125;
&#125;
</code></pre>
<h2 id="Builder模式"><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h2><p>参考　：<a href="https://github.com/helen-x/AndroidInterview/blob/master/android/Android%20%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A8%E5%9C%A8%E8%BF%99%E9%87%8C).md">https://github.com/helen-x/AndroidInterview/blob/master/android/Android%20%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A8%E5%9C%A8%E8%BF%99%E9%87%8C).md</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPatterns  Factory</title>
    <url>/2017/08/10/DesignPatterns_Factory/</url>
    <content><![CDATA[<h5 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h5><p><img src="/2017/08/10/DesignPatterns_Factory/2021-09-12_6.40.17_factory.png" alt="2021-09-12_6.40.17_factory"></p>
<p><img src="/2017/08/10/DesignPatterns_Factory/2021-09-12_6.41.32_fac_indraduce.png" alt="2021-09-12_6.41.32_fac_indraduce"></p>
<p>工厂方法和抽象工厂方法 都是通过工厂生产产品，由于产品都实现了相同的接口，根据获取到的产品作相应的处理</p>
<p>工厂方法 :返回一个产品实例 ,  继承了工厂Dialog Base类,Base类抽象方法由sub类实现</p>
<p>抽象工厂方法:可以返回一组相关的产品实例,实现了创建不同产品的抽象工厂接口</p>
<h5 id="Simple-factory"><a href="#Simple-factory" class="headerlink" title="Simple factory"></a>Simple factory</h5><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SimplePizzaFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">PizzaStore</span>(<span class="params">SimplePizzaFactory factory</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Pizza <span class="function"><span class="title">orderPizza</span>(<span class="params"><span class="built_in">String</span> <span class="keyword">type</span></span>)</span> &#123;</span><br><span class="line">        Pizza pizza = factory.createPizza(<span class="keyword">type</span>);</span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> class SimplePizzaFactory &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Pizza createPizza(<span class="built_in">String</span> <span class="keyword">type</span>) &#123;</span><br><span class="line">        Pizza pizza = <span class="built_in">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;cheese&quot;</span>.<span class="keyword">equals</span>(<span class="keyword">type</span>)) &#123;</span><br><span class="line">            pizza = <span class="literal">new</span> CheesePizza();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;pepperoni&quot;</span>.<span class="keyword">equals</span>(<span class="keyword">type</span>)) &#123;</span><br><span class="line">            pizza = <span class="literal">new</span> PepperoniPizza();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;calm&quot;</span>.<span class="keyword">equals</span>(<span class="keyword">type</span>)) &#123;</span><br><span class="line">            pizza = <span class="literal">new</span> GreekPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SimplePizzaFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">PizzaStore</span>(<span class="params">SimplePizzaFactory factory</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Pizza <span class="function"><span class="title">orderPizza</span>(<span class="params"><span class="built_in">String</span> <span class="keyword">type</span></span>)</span> &#123;</span><br><span class="line">        Pizza pizza = factory.createPizza(<span class="keyword">type</span>);</span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> &#123;</span></span><br><span class="line">    <span class="keyword">String</span> name;</span><br><span class="line">    <span class="keyword">String</span> dough;</span><br><span class="line">    <span class="keyword">String</span> sauce;</span><br><span class="line">    ArrayList topping = <span class="keyword">new</span> <span class="built_in">ArrayList</span>();</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printOperation</span>(<span class="string">&quot;preparing     &quot;</span> + name);</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;Tossing dough...&quot;</span>);</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;Adding sauce&quot;</span>);</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;Adding topping: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;topping.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            System.out.<span class="built_in">println</span>(<span class="string">&quot;    &quot;</span>+topping.<span class="built_in">get</span>(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printOperation</span>(<span class="string">&quot;bake  for 25 minutes at 350&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printOperation</span>(<span class="string">&quot;Cutting the pizza into diagonal slices&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">box</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">printOperation</span>(<span class="string">&quot;Place pizza in official pizzaStore bx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">printOperation</span><span class="params">(<span class="keyword">String</span> op)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="comment">/*getClass().getSimpleName() + &quot; &quot; +*/</span> op);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">SimplePizzaFactory calmFactory = <span class="keyword">new</span> <span class="constructor">SimplePizzaFactory()</span>;</span><br><span class="line">PizzaStore calmPizza = <span class="keyword">new</span> <span class="constructor">PizzaStore(<span class="params">calmFactory</span>)</span>;</span><br><span class="line">calmPizza.order<span class="constructor">Pizza(<span class="string">&quot;calm&quot;</span>)</span>;</span><br></pre></td></tr></table></figure>





<h5 id="Static-Factory（静态工厂模式）"><a href="#Static-Factory（静态工厂模式）" class="headerlink" title="Static Factory（静态工厂模式）"></a>Static Factory（静态工厂模式）</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">Cat</span> <span class="symbol">implements</span> <span class="symbol">Animal</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> move() &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;Cat move&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li>工厂类　对实例类进行管理和创建</li>
</ol>
<pre><code>   public class Factory &#123;
    //静态工厂方法
    public static Cat produceCat() &#123;
        return new Cat();
    &#125;

   public static Dog produceDog() &#123;
        return new Dog();
    &#125;

    public static void main(String[] args) &#123;
        Animal cat = Factory.produceCat();
        cat.move();

        Dog dog = Factory.produceDog();
        dog.move();
        dog.eatBone();
     &#125;
    &#125;`
</code></pre>
<p>假如我要实例化一个pig对象,那么肯定是要在Factory做添加的，接下来看看可以不修改其他类实现需求</p>
<ol start="2">
<li>Abstract Factory(抽象工厂 elementary )</li>
</ol>
<pre><code> public interface Provider &#123;
  Animal produce();
 &#125;
 
 public class DogFactory implements  Provider &#123;
   @Override
   public Animal produce() &#123;
    return new Dog();
   &#125;
 &#125;



public class CatFactory implements Provider &#123;
    @Override
    public Animal produce() &#123;
        return new Cat();
    &#125;
&#125;
</code></pre>
<p>​    Provider provider = new CatFactory();<br>​     Animal cat = provider.produce();<br>​    cat.move();<br>  如果要实例化Pig，添加一个PigFactory 就可以了</p>
<h5 id="不同Button实例"><a href="#不同Button实例" class="headerlink" title="不同Button实例"></a>不同Button实例</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * <span class="regexp">//</span> 抽象工厂接口声明了一组能返回不同抽象产品的方法。这些产品属于同一个系列</span><br><span class="line"> * <span class="regexp">//</span> 且在高层主题或概念上具有相关性。同系列的产品通常能相互搭配使用。系列产</span><br><span class="line"> * <span class="regexp">//</span> 品可有多个变体，但不同变体的产品不能搭配使用。</span><br><span class="line"> */</span><br><span class="line">public interface GUIFactory &#123;</span><br><span class="line">    Button createButton();</span><br><span class="line">    CheckBox createCheckBox();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Concrete factories produce a family of products that belong</span></span><br><span class="line"><span class="comment">// to a single variant. The factory guarantees that the</span></span><br><span class="line"><span class="comment">// resulting products are compatible. Signatures of the concrete</span></span><br><span class="line"><span class="comment">// factory&#x27;s methods return an abstract product, while inside</span></span><br><span class="line"><span class="comment">// the method a concrete product is instantiated.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WinFactory</span> <span class="keyword"><span class="keyword">implements</span>  <span class="type">GUIFactory</span></span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Button createButton() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">WinButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CheckBox createCheckBox() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">WinCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacFactory</span> <span class="keyword"><span class="keyword">implements</span>  <span class="type">GUIFactory</span></span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Button createButton() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">MacButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CheckBox createCheckBox() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">MacCheckbox</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * // 系列产品中的特定产品必须有一个基础接口。所有产品变体都必须实现这个接口。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">Button</span> &#123;</span><br><span class="line">    <span class="built_in">void</span>  paint();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Concrete products are created by corresponding concrete</span></span><br><span class="line"><span class="comment">// factories.</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">WinButton</span> <span class="symbol">implements</span> <span class="symbol">Button</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> paint() &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;根据 Windows 样式渲染按钮   WinButton&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">MacButton</span> <span class="symbol">implements</span> <span class="symbol">Button</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> paint() &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;根据 macOs 样式渲染按钮 MacButton&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这是另一个产品的基础接口。所有产品都可以互动，但是只有相同具体变体的产</span></span><br><span class="line"><span class="comment">// 品之间才能够正确地进行交互。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CheckBox</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span>  <span class="title">paint</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">WinCheckbox</span> <span class="symbol">implements</span>  <span class="symbol">CheckBox</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> paint() &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;根据 Win 样式渲染复选框。   WinCheckbox&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">MacCheckbox</span> <span class="symbol">implements</span>  <span class="symbol">CheckBox</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> paint() &#123;</span><br><span class="line">        System.<span class="keyword">out</span>.println(<span class="string">&quot;根据 macOS 样式渲染复选框。   MacCheckbox&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GUIFactory factory;</span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> CheckBox checkBox;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">Application</span>(<span class="params">GUIFactory factory</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">createUi</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.button = factory.createButton();</span><br><span class="line">        <span class="built_in">this</span>.checkBox = factory.createCheckBox();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="built_in">void</span> <span class="function"><span class="title">paint</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        button.paint();</span><br><span class="line">        checkBox.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://refactoring.guru/design-patterns/abstract-factory">https://refactoring.guru/design-patterns/abstract-factory</a></p>
<p><a href="https://www.zhihu.com/question/20367734">https://www.zhihu.com/question/20367734</a></p>
<h5 id="不同Dialog实例"><a href="#不同Dialog实例" class="headerlink" title="不同Dialog实例"></a>不同Dialog实例</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">public abstract class Dialog &#123;</span><br><span class="line">    <span class="regexp">//</span> The creator may also provide some default implementation</span><br><span class="line">    <span class="regexp">//</span> of the factory method.</span><br><span class="line">    abstract Button createButton();</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span> Note that, despite its name, the creato<span class="string">r&#x27;s primary</span></span><br><span class="line"><span class="string">    // responsibility isn&#x27;</span>t creating products. It usually</span><br><span class="line">    <span class="regexp">//</span> contains some core business logic that relies on product</span><br><span class="line">    <span class="regexp">//</span> objects returned by the factory method. Subclasses can</span><br><span class="line">    <span class="regexp">//</span> indirectly change that business logic by overriding the</span><br><span class="line">    <span class="regexp">//</span> factory method and returning a different type of product</span><br><span class="line">    <span class="regexp">//</span> from it.</span><br><span class="line">    void render() &#123;</span><br><span class="line">        <span class="regexp">//</span> Call the factory method to create a product object.</span><br><span class="line">        Button okButton = createButton();</span><br><span class="line">        <span class="regexp">//</span> Now use the product.</span><br><span class="line">        okButton.onClick(<span class="string">&quot;closeDialog&quot;</span>);</span><br><span class="line">        okButton.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">WindowsDialogFac</span> <span class="keyword">extends</span> <span class="title">Dialog</span> </span>&#123;</span><br><span class="line">    <span class="type">Button</span> createButton() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">WindowsButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">WebDialogFac</span> <span class="keyword">extends</span> <span class="title">Dialog</span> </span>&#123;</span><br><span class="line">    <span class="type">Button</span> createButton() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">HTMLButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(String  cls)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsButton</span> <span class="title">implements</span> <span class="title">Button</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;WindowsButton   render()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(<span class="keyword">String</span> cls)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;WindowsButton   onClick &quot;</span>+cls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTMLButton</span> <span class="title">implements</span> <span class="title">Button</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;HTMLButton   render()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(<span class="keyword">String</span> cls)</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;HTMLButton   onClick &quot;</span>+cls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    Dialog dialog;</span><br><span class="line"></span><br><span class="line">    String configOs = <span class="string">&quot;Windows&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (configOs.equals(<span class="string">&quot;Windows&quot;</span>)) &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> WindowsDialogFac();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (configOs.equals(<span class="string">&quot;HTML&quot;</span>)) &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> WebDialogFac();</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Error! Unknown operating system.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The client code works with an instance of a concrete</span></span><br><span class="line">    <span class="comment">// creator, albeit through its base interface. As long as</span></span><br><span class="line">    <span class="comment">// the client keeps working with the creator via the base</span></span><br><span class="line">    <span class="comment">// interface, you can pass it any creator&#x27;s subclass.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        initialize();</span><br><span class="line">        dialog.render();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h5><p>简单工厂的工厂</p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DesignPatterns_Observer</title>
    <url>/2018/06/06/DesignPatterns_Observer/</url>
    <content><![CDATA[<h4 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h4><p><img src="https://user-gold-cdn.xitu.io/2020/3/23/171064de21df41e0?imageView2/0/w/1280/h/960/ignore-error/1"></p>
<p>​                    奶站\天气站                                                                                                                           用户</p>
<h4 id="Observer观察者模式-订阅模式"><a href="#Observer观察者模式-订阅模式" class="headerlink" title="Observer观察者模式/订阅模式"></a>Observer观察者模式/订阅模式</h4><ul>
<li>PUSH 模式</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//主题对象变化，通知所有的观察者</span></span><br><span class="line"><span class="comment">//抽象观察者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String str)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//具体观察者</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteObserver</span> <span class="keyword">implements</span> <span class="title">Observer</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        System.out.println(str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Subject</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer observer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">(String str)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具体主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteSubject</span> <span class="keyword">implements</span> <span class="title">Subject</span></span>&#123;</span><br><span class="line">    <span class="comment">// 存放观察者</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; list = <span class="keyword">new</span> ArrayList&lt;Observer&gt;();</span><br><span class="line">  </span><br><span class="line">  	<span class="comment">//注册观察者</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        list.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//移除观察者</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeObserver</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        list.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// 遍历所有观察者，并通知</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyObservers</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">for</span>(Observer observer:list)&#123;</span><br><span class="line">            observer.update(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//一个主题</span></span><br><span class="line">        ConcreteSubject eatSubject = <span class="keyword">new</span> ConcreteSubject();</span><br><span class="line">        <span class="comment">//两个观察者</span></span><br><span class="line">        ConcreteObserver p1 = <span class="keyword">new</span> ConcreteObserver();</span><br><span class="line">        ConcreteObserver p2 = <span class="keyword">new</span> ConcreteObserver();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//观察者订阅主题</span></span><br><span class="line">        eatSubject.addObserver(p1);</span><br><span class="line">        eatSubject.addObserver(p2);</span><br><span class="line">        eatSubject.notifyOBservers(<span class="string">&quot;起来敲代码啦！！！&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.im/post/5bc96afff265da0aa94a4493">https://juejin.im/post/5bc96afff265da0aa94a4493</a></p>
<p><a href="https://www.tutorialspoint.com/design_pattern/bridge_pattern.htm">https://www.tutorialspoint.com/design_pattern/bridge_pattern.htm</a></p>
<ul>
<li><p>PULL模式</p>
<p>而拉模型是主题对象不知道观察者具体需要什么数据，没有办法的情况下，干脆把自身传递给观察者，让观察者自己去按需要取值。</p>
</li>
</ul>
<p><a href="https://www.bilibili.com/video/BV1W4411c77E?p=120">https://www.bilibili.com/video/BV1W4411c77E?p=120</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>DevicesScreenSupport</title>
    <url>/2017/09/23/DevicesScreenSupport/</url>
    <content><![CDATA[<p>Android屏幕的一些技巧</p>
<h5 id="官网适配方案"><a href="#官网适配方案" class="headerlink" title="官网适配方案"></a>官网适配方案</h5><p><a href="https://developer.android.com/training/basics/supporting-devices/index.html">https://developer.android.com/training/basics/supporting-devices/index.html</a><br><a href="https://developer.android.com/training/multiscreen/screensizes.html">https://developer.android.com/training/multiscreen/screensizes.html</a></p>
<h5 id="资源图片适配"><a href="#资源图片适配" class="headerlink" title="资源图片适配"></a>资源图片适配</h5><p>Provide alternative bitmaps</p>
<p>To provide good graphical qualities on devices with different pixel densities, you should provide multiple versions of each bitmap in your app—one for each density bucket, at a corresponding resolution. Otherwise, Android must scale your bitmap so it occupies the same visible space on each screen, resulting in scaling artifacts such as blurring.</p>
<p><img src="https://developer.android.com/images/screens_support/devices-density_2x.png" alt="img"></p>
<p><strong>Figure 2.</strong> Relative sizes for bitmaps at different density sizes</p>
<p>There are several density buckets available for use in your apps. Table 1 describes the different configuration qualifiers available and what screen types they apply to.</p>
<p><strong>Table 1.</strong> Configuration qualifiers for different pixel densities.</p>
<table>
<thead>
<tr>
<th align="left">Density qualifier</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>ldpi</code></td>
<td align="left">Resources for low-density (<em>ldpi</em>) screens (~120dpi).</td>
</tr>
<tr>
<td align="left"><code>mdpi</code></td>
<td align="left">Resources for medium-density (<em>mdpi</em>) screens (~160dpi). (This is the baseline density.)</td>
</tr>
<tr>
<td align="left"><code>hdpi</code></td>
<td align="left">Resources for high-density (<em>hdpi</em>) screens (~240dpi).</td>
</tr>
<tr>
<td align="left"><code>xhdpi</code></td>
<td align="left">Resources for extra-high-density (<em>xhdpi</em>) screens (~320dpi).</td>
</tr>
<tr>
<td align="left"><code>xxhdpi</code></td>
<td align="left">Resources for extra-extra-high-density (<em>xxhdpi</em>) screens (~480dpi).</td>
</tr>
<tr>
<td align="left"><code>xxxhdpi</code></td>
<td align="left">Resources for extra-extra-extra-high-density (<em>xxxhdpi</em>) uses (~640dpi).</td>
</tr>
<tr>
<td align="left"><code>nodpi</code></td>
<td align="left">Resources for all densities. These are density-independent resources. The system does not scale resources tagged with this qualifier, regardless of the current screen’s density.</td>
</tr>
<tr>
<td align="left"><code>tvdpi</code></td>
<td align="left">Resources for screens somewhere between mdpi and hdpi; approximately 213dpi. This is not considered a “primary” density group. It is mostly intended for televisions and most apps shouldn’t need it—providing mdpi and hdpi resources is sufficient for most apps and the system will scale them as appropriate. If you find it necessary to provide tvdpi resources, you should size them at a factor of 1.33*mdpi. For example, a 100px x 100px image for mdpi screens should be 133px x 133px for tvdpi.</td>
</tr>
</tbody></table>
<p>To create alternative bitmap drawables for different densities, you should follow the <strong>3:4:6:8:12:16 scaling ratio</strong> between the six primary densities. For example, if you have a bitmap drawable that’s 48x48 pixels for medium-density screens, all the different sizes should be:</p>
<ul>
<li>36x36 (0.75x) for low-density (ldpi)</li>
<li>48x48 (1.0x baseline) for medium-density (mdpi)</li>
<li>72x72 (1.5x) for high-density (hdpi)</li>
<li>96x96 (2.0x) for extra-high-density (xhdpi)</li>
<li>144x144 (3.0x) for extra-extra-high-density (xxhdpi)</li>
<li>192x192 (4.0x) for extra-extra-extra-high-density (xxxhdpi)</li>
</ul>
<p>Then, place the generated image files in the appropriate subdirectory under <code>res/</code> and the system will pick the correct one automatically based on the pixel density of the device your app is running on:</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">res/</span><br><span class="line">  drawable-xxxhdpi/</span><br><span class="line">    awesome-image.png</span><br><span class="line">  drawable-xxhdpi/</span><br><span class="line">    awesome-image.png</span><br><span class="line">  drawable-xhdpi/</span><br><span class="line">    awesome-image.png</span><br><span class="line">  drawable-hdpi/</span><br><span class="line">    awesome-image.png</span><br><span class="line">  drawable-mdpi/</span><br><span class="line">    awesome-image.png</span><br></pre></td></tr></table></figure>

<p>Then, any time you reference <code>@drawable/awesomeimage</code>, the system selects the appropriate bitmap based on the screen’s dpi. If you don’t provide a density-specific resource for that density, the system picks the next best match and scales it to fit the screen.</p>
<p>This means that if you generate a 200x200 image for xhdpi devices, you should generate the same resource in 150x150 for hdpi, 100x100 for mdpi, and 75x75 for ldpi devices.<br>而UI问我们需要多少大小的图，如果效果图根据750*1334的话，可以告诉他，不过PS有个叫<br>cutterman的工具可以自动生成不同分辨率的图片</p>
<ul>
<li>PX转 dp</li>
</ul>
<p>以5X 为例: 5X的dpi =420,   PPI = 420/160 = 2.625<br>设置view的宽度我们用　match_parent,那么在5X上，他是多少dp呢？</p>
<p>5X : width = 1080 px<br>dp = 1080 / PPI = 411.428571429,<br>所以411dp就是5X的match_parent</p>
<p><a href="http://blog.csdn.net/u010983881/article/details/51993157">http://blog.csdn.net/u010983881/article/details/51993157</a></p>
<h5 id="实际应用"><a href="#实际应用" class="headerlink" title="实际应用"></a>实际应用</h5><ul>
<li>开发中的实际转化</li>
</ul>
<p>　　生成主流屏幕的values，安宽分成320份,高400份<br>　　<br>　　假设ＵＩ根据 iphone6(750×1334)设计的效果图<br>　　根据下图公式计算　Dpi</p>
<p>　   iphone6是4.7寸的 分辨率 750 * 1334,　它的dpi 就是　√(750²+1334²)/4.7 =  325 </p>
<p>​       和drawable-xhdpi 320接近<br>　　<br>　　drawable-xhdpi　480上做的图就是大概是1.5倍的样子 ,分辨率在1920 *1080上的也是一样的</p>
<p>​    然而pixel 2的模拟器是420 真机是441，这是什么原因呢!!!</p>
<p>　　<a href="http://blog.csdn.net/zengd0/article/details/52464627">http://blog.csdn.net/zengd0/article/details/52464627</a><br>　　所以说　给的1334 * 750 　图就是<br>　　10px  我们写5dp</p>
<p>​    参考:　<a href="http://www.jianshu.com/p/ec5a1a30694b">http://www.jianshu.com/p/ec5a1a30694b</a><br>　<a href="http://blog.csdn.net/lmj623565791/article/details/45460089">http://blog.csdn.net/lmj623565791/article/details/45460089</a>
　</p>
<ul>
<li>DPI参考</li>
</ul>
<p>自己计算按照上面的公式很简单，最棘手的还是手机尺寸给出一个手机dpi网站 get what you want<br><a href="http://dpi.lv/">http://dpi.lv/</a></p>
<p><a href="https://mp.weixin.qq.com/s/v_aauFjx-f91WrpCAaNMVQ">https://mp.weixin.qq.com/s/v_aauFjx-f91WrpCAaNMVQ</a>)</p>
<p><a href="https://developer.android.com/guide/practices/screens_support">https://developer.android.com/guide/practices/screens_support</a></p>
<p>今日头条适配 </p>
<p><a href="https://www.jianshu.com/p/55e0fca23b4f">https://www.jianshu.com/p/55e0fca23b4f</a></p>
<p><a href="https://github.com/JessYanCoding/AndroidAutoSize">https://github.com/JessYanCoding/AndroidAutoSize</a></p>
<p>为什么原来长度 ic_launcher.png 192*192  到了nexus5 中显示是216 * 216 而不是原来的尺寸</p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Singleton</title>
    <url>/2018/06/06/DesignPatterns_Singleton/</url>
    <content><![CDATA[<p>单例模式</p>
<p>　作用：一个类只有一个实例，减少内存开销
　</p>
<h4 id="kotlin"><a href="#kotlin" class="headerlink" title="kotlin"></a>kotlin</h4><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> <span class="keyword">private</span> <span class="keyword">constructor</span></span>() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">object</span> HOLDER &#123;</span><br><span class="line">        <span class="keyword">val</span> INSTANCE = Singleton()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">val</span> instance: Singleton <span class="keyword">by</span> lazy &#123; HOLDER.INSTANCE &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://medium.com/swlh/singleton-class-in-kotlin-c3398e7fd76b">https://medium.com/swlh/singleton-class-in-kotlin-c3398e7fd76b</a></p>
<p>常用方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">     <span class="comment">// 持有私有静态实例，防止被引用，此处赋值为null，目的是实现延迟加载</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton=<span class="keyword">null</span>;</span><br><span class="line">     <span class="comment">//私有构造方法，防止被实例化</span></span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="keyword">if</span>(singleton==<span class="keyword">null</span>)&#123;           </span><br><span class="line">     								 							<span class="comment">//多个线程在这里聚集就会产生多个对象</span></span><br><span class="line">           synonzied(Singleton.class)&#123;</span><br><span class="line">           Thread.sleel(<span class="number">1</span>)</span><br><span class="line">          singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> singleton;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span></span>&#123;</span><br><span class="line">     <span class="comment">// 持有私有静态实例，防止被引用，此处赋值为null，目的是实现延迟加载</span></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> Singleton singleton=<span class="keyword">null</span>;</span><br><span class="line">     <span class="comment">//私有构造方法，防止被实例化</span></span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;  <span class="comment">//这里加锁 粒度有问题</span></span><br><span class="line">      synonzied(Singleton.class)&#123; <span class="comment">//这样会产生效率问题，多个线程在这空转等待获得锁</span></span><br><span class="line">     <span class="keyword">if</span>(singleton==<span class="keyword">null</span>)&#123;           </span><br><span class="line">           Thread.sleel(<span class="number">1</span>)</span><br><span class="line">          singleton = <span class="keyword">new</span> Singleton();</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> singleton;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>源码有类似的　InputMethodManager，当然我们常用的方式是要传个Context上下文对象给单例类，记得有次面试的时候面试官说单例里面使用弱引用，如果是是为了避免内存泄漏我觉得是可以的，但是我觉得用这种方式更好　<code>Context applicationContext = context.getApplicationContext();</code>　刚无意中发现Glide单例也是这样使用的。</p>
<h4 id="双重检查模式"><a href="#双重检查模式" class="headerlink" title="双重检查模式"></a>双重检查模式</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;  </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton singleton;   <span class="comment">//volatile 防止指令重排序,指令半初始化，CPU执行指令顺序可能不同</span></span><br><span class="line">      <span class="function"><span class="keyword">private</span> <span class="title">Singleton</span> <span class="params">()</span></span>&#123;</span><br><span class="line">      &#125;   </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">      <span class="keyword">if</span> (singleton== <span class="keyword">null</span>) &#123;  						</span><br><span class="line">          <span class="keyword">synchronized</span> (Singleton.class) &#123;  </span><br><span class="line">          <span class="keyword">if</span> (singleton== <span class="keyword">null</span>) &#123;  </span><br><span class="line">              instance= <span class="keyword">new</span> Singleton();  </span><br><span class="line">          &#125;  </span><br><span class="line">         &#125;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="keyword">return</span> singleton;  </span><br><span class="line">     &#125;  </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>



<h5 id="第1个if-singleton-null"><a href="#第1个if-singleton-null" class="headerlink" title="第1个if (singleton==null)"></a>第1个if (singleton==null)</h5><p>如果去掉它，那么所有线程都会串行执行，效率低下，这样会产生效率问题，多个线程在这空转等待获得锁，所以两个 check 都是需要保留的。</p>
<h5 id="第2个if-singleton-null"><a href="#第2个if-singleton-null" class="headerlink" title="第2个if (singleton==null)"></a>第2个if (singleton==null)</h5><p>假如两个线程同时调用 getInstance() ,由于instance是空的，两个线程都通过<strong>第1个if (singleton null)</strong>,接着锁机制存在，线程1先进入同步语句，并进入第二重if判断,线程2在外面等待. 线程1执行完 <code>new Singleton()</code>后退出synchronized,这时候如果没有 <strong>第2个if (singleton== null)</strong>  线程2也会创建一个实例，此时就破坏了单例原则.</p>
<h5 id="volatile作用"><a href="#volatile作用" class="headerlink" title="volatile作用"></a>volatile作用</h5><p>防止 new Singleton()重排序</p>
<p>在 JVM 中上述语句至少做了以下这 3 件事</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7E/CC/Cgq2xl6BpWCAMBaVAACFIdffjfM852.png"></p>
<ol>
<li>第一步是给 singleton 分配内存空间；</li>
<li>然后第二步开始调用 Singleton 的构造函数等，来初始化 singleton；</li>
<li>最后第三步，将 singleton 对象指向分配的内存空间（执行完这步 singleton 就不是 null 了）。</li>
</ol>
<p>因为存在指令重排序的优化，也就是说第2 步和第 3 步的顺序是不能保证的，最终的执行顺序，可能是 1-2-3，也有可能是 1-3-2。</p>
<p>如果是 1-3-2，那么在第 3 步执行完以后，singleton 就不是 null 了，可是这时第 2 步并没有执行，singleton 对象未完成初始化，它的属性的值可能不是我们所预期的值。假设此时线程 2 进入 getInstance 方法，由于 singleton 已经不是 null 了，所以会通过第一重<code>if (singleton==null) </code>检查并直接返回，但其实这时的 singleton 并没有完成初始化，所以使用这个实例的时候会报错.</p>
<p><img src="https://s0.lgstatic.com/i/image3/M01/7E/CC/Cgq2xl6BpWCAB6QQAAEKacFd0CE542.png"></p>
<h4 id="Enum方式"><a href="#Enum方式" class="headerlink" title="Enum方式"></a>Enum方式</h4><p>和公有域方法在功能上相近，但是更简洁，无偿提供了序列化机制，绝对的防止多次实例化，可以面对复杂的序列化或者反射攻击，虽然没有广泛采用，但是　单元素的枚举类型<br>已经成为实现　Singleton的最佳方法.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Elvis_03</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Elvis.INSTANCE.leaveTheBuilding();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这种方法太NB了,</span></span><br><span class="line"><span class="comment"> * Effective Java pag15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">Elvis</span> </span>&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">leaveTheBuilding</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="嵌套类"><a href="#嵌套类" class="headerlink" title="嵌套类"></a>嵌套类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Singleton3</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">    <span class="comment">// 主要是使用了 嵌套类可以访问外部类的静态属性和静态方法 的特性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Holder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Singleton3 instance = <span class="keyword">new</span> Singleton3();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton3 <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.im/post/5bc96afff265da0aa94a4493">https://juejin.im/post/5bc96afff265da0aa94a4493</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>Dialog</title>
    <url>/2017/12/11/Dialog%20/</url>
    <content><![CDATA[<h4 id="Dialog"><a href="#Dialog" class="headerlink" title="Dialog"></a>Dialog</h4><p><a href="https://developer.android.com/guide/topics/ui/dialogs.html">https://developer.android.com/guide/topics/ui/dialogs.html</a><br><a href="https://developer.android.com/reference/android/app/DialogFragment.html">https://developer.android.com/reference/android/app/DialogFragment.html</a></p>
<h5 id="中间弹出"><a href="#中间弹出" class="headerlink" title="中间弹出"></a>中间弹出</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> UpdateDialogFragment extends DialogFragment implements View.OnClickListener &#123;</span><br><span class="line">    public static final String UPDATE_MSG = <span class="string">&quot;UPDATE_MSG&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> UpdateBean updateMsg;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static  DialogFragment <span class="keyword">new</span><span class="constructor">Instance(UpdateBean <span class="params">updateBean</span>)</span> &#123;</span><br><span class="line">        UpdateDialogFragment upDialog = <span class="keyword">new</span> <span class="constructor">UpdateDialogFragment()</span>;</span><br><span class="line">        Bundle bundle = <span class="keyword">new</span> <span class="constructor">Bundle()</span>;</span><br><span class="line">        bundle.put<span class="constructor">Parcelable(UPDATE_MSG, <span class="params">updateBean</span>)</span>;</span><br><span class="line">        upDialog.set<span class="constructor">Arguments(<span class="params">bundle</span>)</span>;</span><br><span class="line">        return upDialog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Dialog on<span class="constructor">CreateDialog(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">         updateMsg = get<span class="constructor">Arguments()</span>.get<span class="constructor">Parcelable(UPDATE_MSG)</span>;</span><br><span class="line"></span><br><span class="line">        AlertDialog.Builder builder = <span class="keyword">new</span> AlertDialog.<span class="constructor">Builder(<span class="params">getActivity</span>()</span>);</span><br><span class="line">        <span class="comment">// Get the layout inflater</span></span><br><span class="line">        LayoutInflater inflater = get<span class="constructor">Activity()</span>.get<span class="constructor">LayoutInflater()</span>;</span><br><span class="line">        <span class="comment">// Inflate and set the layout for the dialog</span></span><br><span class="line">        <span class="comment">// Pass null as the parent view because its going in the dialog layout</span></span><br><span class="line">        View view = inflater.inflate(<span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>layout.dialog_update, null);</span><br><span class="line">        TextView tvUpdatetitle = (TextView) view.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tv_update_title</span>)</span>;</span><br><span class="line">        TextView tvUpDescribe = (TextView) view.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tv_up_describe</span>)</span>;</span><br><span class="line">        tvUpDescribe.set<span class="constructor">Text(<span class="params">updateMsg</span>.<span class="params">getDesc</span>()</span>);</span><br><span class="line">        TextView tvUpdateYes = (TextView) view.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tv_update_yes</span>)</span>;</span><br><span class="line">        TextView tvUpdateNo = (TextView) view.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tv_update_no</span>)</span>;</span><br><span class="line">        tvUpdateYes.set<span class="constructor">OnClickListener(<span class="params">this</span>)</span>;</span><br><span class="line">        tvUpdateNo.set<span class="constructor">OnClickListener(<span class="params">this</span>)</span>;</span><br><span class="line">        builder.set<span class="constructor">View(<span class="params">view</span>)</span>;</span><br><span class="line">        <span class="comment">// Add action buttons</span></span><br><span class="line">        return builder.create<span class="literal">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Click(View <span class="params">v</span>)</span> &#123;</span><br><span class="line">        switch (v.get<span class="constructor">Id()</span>) &#123;</span><br><span class="line">            case <span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.tv_update_yes:</span><br><span class="line">                mListener.on<span class="constructor">DialogPositiveClick(<span class="params">this</span>,<span class="params">updateMsg</span>)</span>;</span><br><span class="line">                break;</span><br><span class="line">            case <span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.tv_update_no:</span><br><span class="line">                mListener.on<span class="constructor">DialogNegativeClick(<span class="params">this</span>)</span>;</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The activity that creates an instance of this dialog fragment must</span></span><br><span class="line"><span class="comment">     * implement this interface in order to receive event callbacks.</span></span><br><span class="line"><span class="comment">     * Each method passes the DialogFragment in case the host needs to query it. */</span></span><br><span class="line">    public interface NoticeDialogListener &#123;</span><br><span class="line">        void on<span class="constructor">DialogPositiveClick(DialogFragment <span class="params">dialog</span>,UpdateBean <span class="params">updateBean</span>)</span>;</span><br><span class="line"></span><br><span class="line">        void on<span class="constructor">DialogNegativeClick(DialogFragment <span class="params">dialog</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this instance of the interface to deliver action events</span></span><br><span class="line">    NoticeDialogListener mListener;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Override the Fragment.onAttach() method to instantiate the NoticeDialogListener</span></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Attach(Activity <span class="params">activity</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Attach(<span class="params">activity</span>)</span>;</span><br><span class="line">        <span class="comment">// Verify that the host activity implements the callback interface</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Instantiate the NoticeDialogListener so we can send events to the host</span></span><br><span class="line">            mListener = (NoticeDialogListener) activity;</span><br><span class="line">        &#125; catch (ClassCastException e) &#123;</span><br><span class="line">            <span class="comment">// The activity doesn&#x27;t implement the interface, throw exception</span></span><br><span class="line">            throw <span class="keyword">new</span> <span class="constructor">ClassCastException(<span class="params">activity</span>.<span class="params">toString</span>()</span></span><br><span class="line">                    + <span class="string">&quot; must implement NoticeDialogListener&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="底部弹出"><a href="#底部弹出" class="headerlink" title="底部弹出"></a>底部弹出</h5><p><a href="https://github.com/umano/AndroidSlidingUpPanel">https://github.com/umano/AndroidSlidingUpPanel</a><br><a href="https://material.io/guidelines/components/dialogs.html#dialogs-specs">https://material.io/guidelines/components/dialogs.html#dialogs-specs</a></p>
<p><a href="http://www.jianshu.com/p/0a7383e0ad0f">http://www.jianshu.com/p/0a7383e0ad0f</a></p>
<h4 id="guide-use"><a href="#guide-use" class="headerlink" title="guide use"></a>guide use</h4><p><a href="https://blog.csdn.net/u014626094/article/details/105430981">https://blog.csdn.net/u014626094/article/details/105430981</a></p>
<p><a href="https://mp.weixin.qq.com/s/VadRKHau_YBsV8miFiggEw">https://mp.weixin.qq.com/s/VadRKHau_YBsV8miFiggEw</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>EclipseIdeaWeb</title>
    <url>/2017/07/23/EclipseIdeaWeb/</url>
    <content><![CDATA[<h2 id="Eclipse导入web项目"><a href="#Eclipse导入web项目" class="headerlink" title="Eclipse导入web项目"></a>Eclipse导入web项目</h2><p>1、src并入包<br>导入项目后可以看这种情况</p>
<p>​    <img src="/2017/07/23/EclipseIdeaWeb/EclipseIdeaWeb%5CDS712.png" alt="DS712"></p>
<p>处理方法：VideoServer右键－&gt;Build Path-&gt;Configure Build Path-&gt;Source-&gt;Brower-&gt;src-&gt;Apply;接着就可以看到</p>
<p><img src="/2017/07/23/EclipseIdeaWeb/EclipseDWeb%5CDS5817.png" alt="DS5817">,点击Yes后，项目目录正常了，但是发现这是一个Ｊava项目,没有javax.相关的包</p>
<ul>
<li>２、Java项目转Ｗeb项目<br>VideoServer右键－&gt;Properties-&gt;Project Facets</li>
<li>在这里勾选　Dynamic Web Module:下面会有个提示　Ｄynamic Web Module 3.0 Requires Java 1.6 or newer.</li>
<li>勾选　Ｊava　　<img src="/2017/07/23/EclipseIdeaWeb/EclipseDWeb/DS3156.png" alt="藐三"></li>
<li>勾选　ＪavaScript<br>点击Apply</li>
</ul>
<h2 id="Idea安装"><a href="#Idea安装" class="headerlink" title="Idea安装"></a>Idea安装</h2><p><a href="http://justcode.ikeepstudying.com/2017/12/%E6%9B%B4%E6%96%B0-intellij-idea-2017-3-1-%E6%B3%A8%E5%86%8C%E7%A0%81-%EF%BC%88%E4%BA%B2%E6%B5%8B%E5%8F%AF%E7%94%A8%EF%BC%89/">http://justcode.ikeepstudying.com/2017/12/%E6%9B%B4%E6%96%B0-intellij-idea-2017-3-1-%E6%B3%A8%E5%86%8C%E7%A0%81-%EF%BC%88%E4%BA%B2%E6%B5%8B%E5%8F%AF%E7%94%A8%EF%BC%89/</a></p>
<p><a href="http://idea.lanyus.com/">http://idea.lanyus.com/</a></p>
<p><a href="https://www.jetbrains.com/help/idea/developing-a-java-ee-application.html">https://www.jetbrains.com/help/idea/developing-a-java-ee-application.html</a></p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>English</title>
    <url>/2017/11/23/English/</url>
    <content><![CDATA[<h4 id="Book"><a href="#Book" class="headerlink" title="Book"></a>Book</h4><p>感谢楼主<a href="http://cnbooks.org/m/article.php?id=330">楼主</a> </p>
<h4 id="Dict"><a href="#Dict" class="headerlink" title="Dict"></a>Dict</h4><p><a href="https://forum.freemdict.com/">https://forum.freemdict.com/</a></p>
<p><a href="https://mdx.mdict.org/">https://mdx.mdict.org/</a></p>
<p><a href="https://mdx.mdict.org/%E6%8C%89%E8%AF%8D%E5%85%B8%E8%AF%AD%E7%A7%8D%E6%9D%A5%E5%88%86%E7%B1%BB/">https://mdx.mdict.org/%E6%8C%89%E8%AF%8D%E5%85%B8%E8%AF%AD%E7%A7%8D%E6%9D%A5%E5%88%86%E7%B1%BB/</a></p>
<p><a href="https://freemdict.com/">https://freemdict.com/</a></p>
<p><a href="https://mdict.org/">https://mdict.org/</a></p>
<h4 id="划词翻译"><a href="#划词翻译" class="headerlink" title="划词翻译"></a>划词翻译</h4><p><a href="https://www.bilibili.com/video/av16816801/">https://www.bilibili.com/video/av16816801/</a></p>
<p><a href="https://www.youtube.com/watch?v=SIojtnMplHc">https://www.youtube.com/watch?v=SIojtnMplHc</a></p>
<p><a href="https://www.bilibili.com/video/av455529337">https://www.bilibili.com/video/av455529337</a></p>
<h4 id="English-grammar-in-use"><a href="#English-grammar-in-use" class="headerlink" title="English grammar in use"></a>English grammar in use</h4><p><a href="https://dl.304304.xyz/uploads/Ludovicus/%E8%8B%B1%E8%AF%AD-%E6%90%AC%E8%BF%90/">https://dl.304304.xyz/uploads/Ludovicus/%E8%8B%B1%E8%AF%AD-%E6%90%AC%E8%BF%90/</a></p>
<h1 id="安装完air-然后从安装文件选择资源"><a href="#安装完air-然后从安装文件选择资源" class="headerlink" title="安装完air,然后从安装文件选择资源"></a>安装完air,然后从安装文件选择资源</h1><h4 id="grammar-in-use"><a href="#grammar-in-use" class="headerlink" title="grammar in use"></a>grammar in use</h4><p>右键选择 windows 7安装</p>
<p>点击brower 选择安装的文件</p>
]]></content>
      <categories>
        <category>ENGLISH</category>
      </categories>
  </entry>
  <entry>
    <title>EventBus</title>
    <url>/2018/07/11/EventBus/</url>
    <content><![CDATA[<ol>
<li><p>定义事件类</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="built_in">String</span> message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">MessageEvent</span>(<span class="params"><span class="built_in">String</span> message</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">getMessage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p> EventBusActivity</p>
</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)</span><br><span class="line"><span class="keyword">public</span>  <span class="built_in">void</span>  <span class="function"><span class="title">onMessageEvent</span>(<span class="params">MessageEvent messageEvent</span>)</span>&#123;</span><br><span class="line">    btEventRecieve.setText(messageEvent.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onStart</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">super</span>.onStart();</span><br><span class="line">     EventBus.getDefault().register(<span class="built_in">this</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onStop</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">super</span>.onStop();</span><br><span class="line">     EventBus.getDefault().unregister(<span class="built_in">this</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>GoalEventActivity </li>
</ol>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">findViewById(R.id.bt_message_send).setOnClickListener(v-&gt;&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread<span class="function"><span class="params">(()-&gt;&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        EventBus.getDefault().post(<span class="keyword">new</span> MessageEvent(<span class="string">&quot;我是 GoalEventActivity&quot;</span>));</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">&#125;);</span></span><br></pre></td></tr></table></figure>





<h5 id="类别"><a href="#类别" class="headerlink" title="类别"></a>类别</h5><p>在上面的例子中，我们再注解<code>@Subscribe(threadMode = ThreadMode.MAIN)</code>中使用了ThreadMode.MAIN这个模式，表示该函数在主线程即UI线程中执行，实际上EventBus总共有四种线程模式，分别是： </p>
<ul>
<li>ThreadMode.MAIN：表示无论事件是在哪个线程发布出来的，该事件订阅方法onEvent都会在UI线程中执行，这个在Android中是非常有用的，因为在Android中只能在UI线程中更新UI，所有在此模式下的方法是不能执行耗时操作的。</li>
<li>ThreadMode.POSTING：表示事件在哪个线程中发布出来的，事件订阅函数onEvent就会在这个线程中运行，也就是说发布事件和接收事件在同一个线程。使用这个方法时，在onEvent方法中不能执行耗时操作，如果执行耗时操作容易导致事件分发延迟。</li>
<li>ThreadMode.BACKGROUND：表示如果事件在UI线程中发布出来的，那么订阅函数onEvent就会在子线程中运行，如果事件本来就是在子线程中发布出来的，那么订阅函数直接在该子线程中执行。</li>
<li>ThreadMode.AYSNC：使用这个模式的订阅函数，那么无论事件在哪个线程发布，都会创建新的子线程来执行订阅函数。</li>
</ul>
<p> <a href="https://github.com/greenrobot/EventBus">https://github.com/greenrobot/EventBus</a></p>
<p><a href="https://www.jianshu.com/p/a040955194fc">https://www.jianshu.com/p/a040955194fc</a></p>
<p><a href="https://segmentfault.com/a/1190000004279679">https://segmentfault.com/a/1190000004279679</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Generics</title>
    <url>/2018/04/16/Generics/</url>
    <content><![CDATA[<h4 id="泛型类"><a href="#泛型类" class="headerlink" title="泛型类"></a>泛型类</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    String orderName;</span><br><span class="line">    <span class="keyword">int</span> orderId;</span><br><span class="line"></span><br><span class="line">    T orderT;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">(String orderName, <span class="keyword">int</span> orderId, T orderT)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderName = orderName;</span><br><span class="line">        <span class="keyword">this</span>.orderId = orderId;</span><br><span class="line">        <span class="keyword">this</span>.orderT = orderT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getOrderT</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> orderT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderT</span><span class="params">(T orderT)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderT = orderT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="子类不是泛型类"><a href="#子类不是泛型类" class="headerlink" title="子类不是泛型类"></a>子类不是泛型类</h5><p> 父类指明类型,由于子类在继承带泛型的父类时，指明了泛型类型，则实例化子类对象时，不再需要指明泛型。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubOrder</span> <span class="keyword">extends</span> <span class="title">Order</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">test1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//由于子类在继承带泛型的父类时，指明了泛型类型，则实例化子类对象时，不再需要指明泛型。</span></span><br><span class="line">        SubOrder subOrder = <span class="keyword">new</span> SubOrder();</span><br><span class="line">        subOrder.setOrderT(<span class="number">1122</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h5 id="子父类关系"><a href="#子父类关系" class="headerlink" title="子父类关系"></a>子父类关系</h5><p>类A是类B的父类，G<A>和G<B>二者不具备父子类关系,也不具任何关系。</B></A></p>
<p>类A是类B的父类，A<G>是 B<G>的父类。</G></G></p>
<p>反证法:</p>
<p><a href="https://www.bilibili.com/video/BV1fi4y1b7NM?p=11">https://www.bilibili.com/video/BV1fi4y1b7NM?p=11</a></p>
<h5 id="子类是泛型类"><a href="#子类是泛型类" class="headerlink" title="子类是泛型类"></a>子类是泛型类</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubOrder1</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Order</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">SubOrder1&lt;String&gt; sub2 = <span class="keyword">new</span> SubOrder1&lt;&gt;();</span><br><span class="line">sub2.setOrderT(<span class="string">&quot;order...&quot;</span>);</span><br></pre></td></tr></table></figure>







<h4 id="泛型方法"><a href="#泛型方法" class="headerlink" title="泛型方法"></a>泛型方法</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person3</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//泛型普通方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">(T name)</span> </span>&#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;正在演讲&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> &lt;M&gt; <span class="function"><span class="keyword">void</span> <span class="title">show1</span><span class="params">(M name)</span> </span>&#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;正在演讲&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//静态泛型方法中的类型占位符和类中的泛型占位符是没有关系的</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;W&gt; <span class="function"><span class="keyword">void</span> <span class="title">show2</span><span class="params">(W name)</span> </span>&#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot;：静态方法正在演讲!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;E&gt; <span class="function">E <span class="title">show3</span><span class="params">(E name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="泛型接口"><a href="#泛型接口" class="headerlink" title="泛型接口"></a>泛型接口</h4><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">PerInt</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">(name: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li> 泛型接口的实现类 可以指定具体的泛型接口的具体泛型类型</li>
</ol>
   <figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerImtImpl</span> : <span class="type">PerInt</span>&lt;<span class="type">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">(name: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>泛型接口的实现类，如果没有指定具体的泛型类型，必须要在这个实现类中声明一个泛型类型的占位符给接口用</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerImtImpl01</span>&lt;<span class="type">T</span>&gt; : <span class="type">PerInt</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">(name: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="类型擦除"><a href="#类型擦除" class="headerlink" title="类型擦除"></a>类型擦除</h4><p>Java中的泛型基本上都是在编译器这个层次来实现的。在生成的Java字节码中是不包含泛型中的类型信息的。使用泛型的时候加上的类型参数，会在编译器在编译的时候去掉。这个过程就称为类型擦除。</p>
<p>泛型的作用是能在编译期间就提示错误，而不是运行时。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> p1 = PerImtImpl01&lt;String&gt;()</span><br><span class="line"><span class="keyword">val</span> p2 = PerImtImpl01&lt;<span class="built_in">Int</span>&gt;()</span><br><span class="line">println(p1.javaClass == p2.javaClass)</span><br><span class="line">println(p1.javaClass === p2.javaClass)</span><br></pre></td></tr></table></figure>







<h4 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h4><p>Java中的继承 ，在泛型中并不是父子类关系 </p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PerImtImpl01</span>&lt;<span class="type">T</span>&gt; : <span class="type">PerInt</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: T</span><br><span class="line">        <span class="keyword">get</span>() &#123;</span><br><span class="line">            <span class="keyword">return</span> name</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            name = value</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">(name: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">(p: <span class="type">PerImtImpl01</span>&lt;*&gt;)</span></span> &#123;<span class="comment">//如果是T类型 编译报错，虽然Int:Number,但是在泛型中不存在继承关系</span></span><br><span class="line">        name = p.name <span class="keyword">as</span> T</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> p3 = PerImtImpl01&lt;Number&gt;()</span><br><span class="line"><span class="keyword">val</span> p4 = PerImtImpl01&lt;<span class="built_in">Int</span>&gt;()</span><br><span class="line">p3.name = <span class="number">111</span></span><br><span class="line">p4.show(p3)</span><br></pre></td></tr></table></figure>



<h5 id="符号区别"><a href="#符号区别" class="headerlink" title="符号区别"></a>符号区别</h5><p>Java用 ？  Kotlin 用 *</p>
<p>无界通配符 意味着可以使用任何对象，因此使用它类似于使用原生类型</p>
<p>类A是类B的父类，G<A>和G<B>的公共的父类是: G&lt;?&gt;</B></A></p>
<h5 id="遍历List"><a href="#遍历List" class="headerlink" title="遍历List"></a>遍历List</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span></span>&#123;</span><br><span class="line">      List&lt;Object&gt; list1 = <span class="keyword">null</span>;</span><br><span class="line">      List&lt;String&gt; list2 = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">      List&lt;?&gt; list = <span class="keyword">null</span>;</span><br><span class="line">      list = list1;</span><br><span class="line">      list = list2;</span><br><span class="line"></span><br><span class="line">      print(list1);</span><br><span class="line">      print(list2);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(List&lt;?&gt; list)</span></span>&#123;</span><br><span class="line">      Iterator&lt;?&gt; iterator = list.iterator();</span><br><span class="line">      <span class="keyword">while</span> (iterator.hasNext())&#123;</span><br><span class="line">          Object o = iterator.next();</span><br><span class="line">          System.out.println(o);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      list.forEach(o -&gt; &#123;</span><br><span class="line">          System.out.println(o);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>对于List<?> 就不能向其添加数据。如果任何类型引用通过赋值给 List<?> 能添加数据，那定义泛型就没意义了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> 		List&lt;?&gt; list = <span class="keyword">null</span>;</span><br><span class="line"> 		ArrayList&lt;String&gt; list3 = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list3.add(<span class="string">&quot;AA&quot;</span>);</span><br><span class="line">        list3.add(<span class="string">&quot;BB&quot;</span>);</span><br><span class="line">        list3.add(<span class="string">&quot;CC&quot;</span>);</span><br><span class="line">        list = list3;</span><br><span class="line">        <span class="comment">//添加(写入):对于List&lt;?&gt; 就不能向其添加数据，如果能添加数据，那定义泛型就没意义了。</span></span><br><span class="line">        <span class="comment">//除了添加null之外</span></span><br><span class="line"><span class="comment">//        list.add(&quot;MED&quot;);</span></span><br><span class="line"><span class="comment">//        list.add(&quot;?&quot;);</span></span><br><span class="line">        list.add(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以获取数据，读取的数据类型为Object</span></span><br><span class="line">        Object o = list.get(<span class="number">0</span>);</span><br><span class="line">        System.out.println(o);</span><br></pre></td></tr></table></figure>





<h4 id="上下界"><a href="#上下界" class="headerlink" title="上下界"></a>上下界</h4><p><strong>如果静态方法要使用泛型的话，必须将静态方法也定义成泛型方法</strong> </p>
<figure class="highlight nim"><table><tr><td class="code"><pre><span class="line">public class <span class="type">StaticGenerator</span>&lt;T&gt; &#123;</span><br><span class="line">    ....</span><br><span class="line">    ....</span><br><span class="line">    /**</span><br><span class="line">     * 如果在类中定义使用泛型的静态方法，需要添加额外的泛型声明（将这个方法定义成泛型方法）</span><br><span class="line">     * 即使静态方法要使用泛型类中已经声明过的泛型也不可以。</span><br><span class="line">     * 如：public <span class="keyword">static</span> <span class="built_in">void</span> show(T t)<span class="meta">&#123;..&#125;</span>,此时编译器会提示错误信息：</span><br><span class="line">          <span class="string">&quot;StaticGenerator cannot be refrenced from static context&quot;</span></span><br><span class="line">     */</span><br><span class="line">    public <span class="keyword">static</span> &lt;T&gt; <span class="built_in">void</span> show(T t)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>上界&lt;? extends T&gt;不能往里存，只能往外取，适合频繁往外面读取内容的场景。</li>
<li>下界&lt;? super T&gt;不影响往里存，但往外取只能放在Object对象里，适合经常往里面插入数据的场景。</li>
</ul>
<h5 id="上界通配符-lt-extends-T-gt"><a href="#上界通配符-lt-extends-T-gt" class="headerlink" title="上界通配符    &lt;? extends T&gt;"></a>上界通配符    &lt;? extends T&gt;</h5><p>泛型中的继承</p>
<p>泛型中的继承不是Java中的继承。也就是说java中的父子类关系， 在泛型中 并不是父子类关系。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Apple</span> <span class="keyword">extends</span> <span class="title">Fruit</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Plate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    T item;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="title">Plate</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">Plate</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="function"><span class="title">get</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">set</span>(<span class="params">T item</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.item = item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2018/04/16/Generics/2020-09-13_at_9.33.25.png" alt="Screen Shot 2020-09-13 at 9.33.25 PM" style="zoom:67%;">

<h6 id="extends-Fruit赋值"><a href="#extends-Fruit赋值" class="headerlink" title="? extends Fruit赋值"></a>? extends Fruit赋值</h6><p>? extends Fruit 可以理解为 &lt;= Fruit</p>
<p>List&lt;? extends Fruit&gt; 可以作为 List<Apple> ， List<Fruit>的父类。</Fruit></Apple></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//        List&lt;Fruit&gt; list1 =  new ArrayList&lt;Apple&gt;();  //编译报错，泛型具体类型 List&lt;Fruit&gt; ,ArrayList&lt;Apple&gt; 不存在继承关系</span></span><br><span class="line">        <span class="comment">// ? extends Fruit 可以理解为 &lt;= Fruit</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// List&lt;? extends Fruit&gt;                        //  可以作为 List&lt;Apple&gt; ， List&lt;Fruit&gt;的父类。</span></span><br><span class="line">        List&lt;? extends Fruit&gt; list4 =  <span class="keyword">new</span> ArrayList&lt;Apple&gt;();</span><br><span class="line">        List&lt;? extends Fruit&gt; list5=  <span class="keyword">new</span> ArrayList&lt;Fruit&gt;();</span><br><span class="line"><span class="comment">//        List&lt;? extends Fruit&gt; list5 =new ArrayList&lt;Object&gt;();    //编译报错，Object类不在 &lt;= Fruit范围内</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 只能读取数据 , 不能修改数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        Fruit fruit = list4.get(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//        Apple apple =list2.get(0); //编译不通过， &lt;= Fruit范围，list1.get(0)实际类型可能是Fruit，是Apple的父类。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        list1.add(new Apple()); //编译报错，&lt;= Fruit范围， List&lt;? extends Fruit&gt;实际类型可能比是GreenApple,比Apple范围还小，随意存不了数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h6 id="读取数据"><a href="#读取数据" class="headerlink" title="读取数据"></a>读取数据</h6><p>? extends Fruit 所以泛型最大的父类就是Fruit,子类型可以直接复制给父类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 只能读取数据 , 不能修改数据</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        Fruit fruit = list4.get(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//        Apple apple =list2.get(0); //编译不通过， &lt;= Fruit范围，list1.get(0)实际类型可能是Fruit，是Apple的父类。</span></span><br><span class="line"><span class="comment">//        list1.add(new Apple()); //编译报错，&lt;= Fruit范围， List&lt;? extends Fruit&gt;实际类型可能比是GreenApple,比Apple范围还小，随意存不了数据</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<blockquote>
<p> <strong>你会发现无法往里面设置任何数据</strong>，按道理说我们将泛型类型设置为? extend Fruit。按理说我们往里面添加Fruit的子类应该是可以的。但是Java编译器不允许这样操作。&lt;? extends Fruit&gt;会使往盘子里放东西的set()方法失效。但取东西get()方法还有效</p>
</blockquote>
<blockquote>
<p> 原因是：Java编译期只知道容器里面存放的是Fruit和它的子类，具体是什么类型不知道，可能是Fruit？可能是Apple？也可能是Banana，RedApple，GreenApple？编译器在后面看到Plate&lt; Apple &gt;赋值以后，盘子里面没有标记为“苹果”。只是标记了一个占位符“CAP#1”，来表示捕获一个Fruit或者Fruit的派生类，具体是什么类型不知道。所有调用代码无论往容器里面插入Apple或者Meat或者Fruit编译器都不知道能不能和这个“CAP#1”匹配，所以这些操作都不允许。</p>
<p>一个Plate&lt;? extends Fruit&gt;的引用，可能是一个Plate <Apple>类型的盘子，要往这个盘子里放<Banana>当然是不被允许的.</Banana></Apple></p>
</blockquote>
<p>但是上界通配符是允许读取操作的。例如代码</p>
<p>这个我们很好理解，由于上界通配符设定容器中只能存放Fruit及其子类，那么获取出来的我们都可以隐式的转为Fruit基类。所以上界描述符Extends适合频繁读取的场景。</p>
<p>Java类型擦除只会擦除到Fruit类型,如果没有指明边界，那么类型参数将被擦除到Object.</p>
<h6 id="写入数据"><a href="#写入数据" class="headerlink" title="写入数据"></a>写入数据</h6><p>可以发现任何数据都不能存入。[-∞,Fruit]范围，-∞不知道具体的类型小到多少</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">list1.add(<span class="keyword">new</span> Apple()); <span class="comment">//编译报错，&lt;= Fruit范围， List&lt;? extends Fruit&gt;实际类型可能比是GreenApple,比Apple范围还小，随意存不了数据</span></span><br></pre></td></tr></table></figure>





<h5 id="下界通配符-lt-super-T-gt"><a href="#下界通配符-lt-super-T-gt" class="headerlink" title="下界通配符 &lt;? super T&gt;"></a>下界通配符 &lt;? super T&gt;</h5><p><img src="/2018/04/16/Generics/2020-09-13_at_9.46.10.png" alt="Screen Shot 2020-09-13 at 9.46.10 PM"></p>
<h6 id="super-Fruit赋值"><a href="#super-Fruit赋值" class="headerlink" title="? super Fruit赋值"></a>? super Fruit赋值</h6><p> ? super Fruit 可以理解为 &gt;= Fruit</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        <span class="comment">//只能修改数据，不能读取数据</span></span><br><span class="line">        <span class="comment">// &lt;? super Fruit&gt;</span></span><br><span class="line"></span><br><span class="line">        List&lt;? <span class="keyword">super</span> Fruit&gt; list6 = <span class="keyword">new</span> ArrayList&lt;Fruit&gt;();  <span class="comment">//   ? super Fruit 可以理解为 &gt;= Fruit</span></span><br><span class="line">        List&lt;? <span class="keyword">super</span> Fruit&gt;  list7 = <span class="keyword">new</span> ArrayList&lt;Object&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Object object = list6.get(<span class="number">0</span>); <span class="comment">//理论上不能读取，但是都到Object还是可以的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Food food = list2.get(0); //编译不通过，&gt;=Fruit范围，list2.get(0)实际类型可能是Object,不能赋值给小于它子类，所以只能是Object</span></span><br></pre></td></tr></table></figure>





<h6 id="读取数据-1"><a href="#读取数据-1" class="headerlink" title="读取数据"></a>读取数据</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        Object object = list6.get(<span class="number">0</span>); <span class="comment">//理论上不能读取，但是都到Object还是可以的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        Food food = list2.get(0); //编译不通过，&gt;=Fruit范围，list2.get(0)实际类型可能是Object,不能赋值给小于它子类，所以只能是Object</span></span><br></pre></td></tr></table></figure>



<h6 id="写入数据-1"><a href="#写入数据-1" class="headerlink" title="写入数据"></a>写入数据</h6><p> ? super Fruit范围是是 [Fruit,+∞), 所以Fruit范围内的都可以添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">        list6.add(<span class="keyword">new</span> Fruit());</span><br><span class="line">        list6.add(<span class="keyword">new</span> Apple()); <span class="comment">//</span></span><br><span class="line"><span class="comment">//        list6.add(new Food()); //   ? super Fruit范围是是 [Fruit,+∞), 所以Fruit范围内的都可以添加</span></span><br></pre></td></tr></table></figure>



<p>下界通配符&lt;? super Fruit&gt;不影响往里面存储，但是读取出来的数据只能是Object类型。</p>
<blockquote>
<p>下界通配符规定了元素最小的粒度，必须是Fruit或其基类，那么我往里面存储Fruit及其子类都是可以的，因为它都可以隐式的转化为Fruit类型。但是往外读就不好控制了，里面存储的都是Fruit及其基类，无法转型为任何一种类型，只有Object基类才能装下。</p>
</blockquote>
<p><a href="https://juejin.im/post/5b614848e51d45355d51f792">https://juejin.im/post/5b614848e51d45355d51f792</a></p>
<p><a href="http://www.jianshu.com/p/dd34211f2565">www.jianshu.com/p/dd34211f2565</a></p>
<p><a href="https://itimetraveler.github.io/2016/12/27/%E3%80%90Java%E3%80%91%E6%B3%9B%E5%9E%8B%E4%B8%AD%20extends%20%E5%92%8C%20super%20%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F/">https://itimetraveler.github.io/2016/12/27/%E3%80%90Java%E3%80%91%E6%B3%9B%E5%9E%8B%E4%B8%AD%20extends%20%E5%92%8C%20super%20%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F/</a></p>
<p><a href="https://www.bilibili.com/video/BV1xJ411n77R?p=7">https://www.bilibili.com/video/BV1xJ411n77R?p=7</a></p>
<h4 id="kotlin"><a href="#kotlin" class="headerlink" title="kotlin"></a>kotlin</h4><h5 id="out"><a href="#out" class="headerlink" title="out"></a>out</h5><p>只能获取 不能修改</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">var</span> list:MutableList&lt;<span class="keyword">out</span> Fruit&gt;  = ArrayList&lt;Apple&gt;() <span class="comment">// ? extends Fruit 实际类型可能比是Apple小</span></span><br><span class="line"><span class="comment">//    list.add(Apple()) 编译报错</span></span><br><span class="line">    <span class="keyword">var</span> list2: ArrayList&lt;<span class="keyword">in</span> Apple&gt; = ArrayList&lt;Fruit&gt;() <span class="comment">//  ? super Fruit  实际类型可能比是Apple大很多</span></span><br><span class="line"><span class="comment">//    list2.get(0)</span></span><br></pre></td></tr></table></figure>



<p><a href="https://www.bilibili.com/video/BV1xv411k7Dd?p=4&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1xv411k7Dd?p=4&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://noteforme.github.io/2021/08/21/kotlin-object/#Out-In">https://noteforme.github.io/2021/08/21/kotlin-object/#Out-In</a></p>
<p><a href="https://www.bilibili.com/video/BV1Hy4y1H7oS?p=7">https://www.bilibili.com/video/BV1Hy4y1H7oS?p=7</a></p>
<h4 id="泛型数组"><a href="#泛型数组" class="headerlink" title="泛型数组"></a>泛型数组</h4><ol>
<li><p>可以声明带泛型的数组引用，但是不能直接创建带泛型的数组对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;Integer&gt; intList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">intList.add(<span class="number">100</span>);</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">ArrayList&lt;String&gt; strList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">strList.add(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">listArr[<span class="number">0</span>] = strList;</span><br><span class="line">String s = listArr[<span class="number">0</span>].get(<span class="number">0</span>);</span><br><span class="line">System.out.println(s);</span><br></pre></td></tr></table></figure></li>
<li><p>可以通过java.lang.reflect.Array的newInstance(Class<T>,int) 创建T[]数组</T></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FruitArr</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> T[] array;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FruitArr</span><span class="params">(Class&lt;T&gt; clz, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.array = (T[]) Array.newInstance(clz, length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> index, T item)</span> </span>&#123;</span><br><span class="line">        array[index] = item;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> array[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T[] getArray()&#123;</span><br><span class="line">        <span class="keyword">return</span> array;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FruitArr&lt;String&gt; fruit = <span class="keyword">new</span> FruitArr&lt;&gt;(String.class,<span class="number">3</span>);</span><br><span class="line">fruit.put(<span class="number">0</span>,<span class="string">&quot;苹果&quot;</span>);</span><br><span class="line">fruit.put(<span class="number">1</span>,<span class="string">&quot;西瓜&quot;</span>);</span><br><span class="line">fruit.put(<span class="number">2</span>,<span class="string">&quot;香蕉&quot;</span>);</span><br><span class="line">String s1 = Arrays.toString(fruit.getArray());</span><br><span class="line">System.out.println(s1);</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​    </p>
<h4 id="泛型与反射"><a href="#泛型与反射" class="headerlink" title="泛型与反射"></a>泛型与反射</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;Person&gt; personClass = Person.class;</span><br><span class="line">Constructor&lt;Person&gt; constructor = personClass.getConstructor();</span><br><span class="line">Person person = constructor.newInstance();</span><br></pre></td></tr></table></figure>

<p>​    <a href="https://www.bilibili.com/video/BV1xJ411n77R?p=12">https://www.bilibili.com/video/BV1xJ411n77R?p=12</a></p>
<p>$i$f$withM 有时候看到$以为是操作符，其实就是$i$f$withM整体的变量</p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>GestureDetector</title>
    <url>/2018/08/13/GestureDetector/</url>
    <content><![CDATA[<p>GestureDetector总结</p>
<p><a href="https://blog.csdn.net/harvic880925/article/details/39520901">https://blog.csdn.net/harvic880925/article/details/39520901</a></p>
<p>切换动画</p>
<p><a href="https://blog.csdn.net/u013309870/article/details/52873515">https://blog.csdn.net/u013309870/article/details/52873515</a></p>
<p><a href="http://www.jcodecraeer.com/a/basictutorial/2016/1014/6672.html">http://www.jcodecraeer.com/a/basictutorial/2016/1014/6672.html</a></p>
<p><a href="https://www.jianshu.com/p/a06e4f215f49">https://www.jianshu.com/p/a06e4f215f49</a></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">e1</span>, MotionEvent e<span class="number">2</span>坐标滑动距离</span><br></pre></td></tr></table></figure>

<p>速度判断:velocityX：X轴上的移动速度，像素/秒   </p>
<p>velocityY：Y轴上的移动速度，像素/秒 </p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Exception</title>
    <url>/2021/01/14/Exception/</url>
    <content><![CDATA[<p>异常结构图</p>
<img src="/2021/01/14/Exception/exception01.png" style="zoom:50%;">

<p><a href="https://www.cnblogs.com/aspirant/p/10790803.html">https://www.cnblogs.com/aspirant/p/10790803.html</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>GIT_BRANCH</title>
    <url>/2017/10/19/Git_BRANCH/</url>
    <content><![CDATA[<p>官方文档<br><a href="https://git-scm.com/book/en/v2">https://git-scm.com/book/en/v2</a><br><a href="http://iissnan.com/progit/">http://iissnan.com/progit/</a></p>
<h4 id="Git基本操作"><a href="#Git基本操作" class="headerlink" title="Git基本操作"></a>Git基本操作</h4><h5 id="github上传项目"><a href="#github上传项目" class="headerlink" title="github上传项目"></a>github上传项目</h5><ul>
<li> 分支创建</li>
</ul>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git</span> branch Dev<span class="number">1</span>.<span class="number">10</span> </span><br><span class="line"><span class="attribute">git</span> push origin Dev<span class="number">1</span>.<span class="number">10</span> 　　　// 提交该分支到远程仓库</span><br><span class="line"><span class="attribute">git</span> pull origin dev          //从远程获取分支</span><br><span class="line">      </span><br></pre></td></tr></table></figure>

<ul>
<li> 下面是对已有项目的提交</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">mkdir EffectiveJava</span><br><span class="line">cd EffectiveJava</span><br><span class="line">git init</span><br><span class="line">touch <span class="module-access"><span class="module"><span class="identifier">README</span>.</span></span>md</span><br><span class="line">git add <span class="module-access"><span class="module"><span class="identifier">README</span>.</span></span>md</span><br><span class="line">git commit -m <span class="string">&quot;first commit&quot;</span></span><br><span class="line">git remote add origin git@gitee.com:huaiyi/<span class="module-access"><span class="module"><span class="identifier">EffectiveJava</span>.</span></span>git</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<p>分支提交到远程仓库<br><code>$ git push origin v1.0.0 </code></p>
<ul>
<li><p>commit</p>
<p>Git撤销git commit 但是未git push的修改</p>
<ol>
<li><p>找到上次git commit的 id</p>
<p>  git log </p>
<p>  找到你想撤销的commit_id</p>
</li>
<li><p>git reset –hard commit_id</p>
<pre><code>完成撤销,同时将代码恢复到前一commit_id 对应的版本。
</code></pre>
</li>
<li><p>git reset commit_id </p>
<p>  完成Commit命令的撤销，但是不对代码修改进行撤销，可以直接通过git commit 重新提交对本地代码的修改。</p>
</li>
</ol>
</li>
</ul>
<p> <a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%AE%80%E4%BB%8B">git分支简介</a><br> <a href="http://blog.csdn.net/hyr83960944/article/details/36185231">http://blog.csdn.net/hyr83960944/article/details/36185231</a></p>
<p>合并分支<br>合并hotfix到dev</p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="symbol">$</span> git checkout            <span class="comment">// 先切换到dev </span></span><br><span class="line"><span class="symbol">$</span> git merge hotfix</span><br></pre></td></tr></table></figure>
<p><a href="https://git-scm.com/book/zh/v2/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E6%96%B0%E5%BB%BA%E4%B8%8E%E5%90%88%E5%B9%B6">合并分支</a></p>
<h5 id="获取本地没有的远程分支"><a href="#获取本地没有的远程分支" class="headerlink" title="获取本地没有的远程分支"></a>获取本地没有的远程分支</h5><figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">git <span class="keyword">branch </span>-r <span class="comment">#查看远程分支  或 git branch -a #查看所有分支</span></span><br></pre></td></tr></table></figure>

<p>会显示</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">origin</span>/HEAD -&gt; origin/master</span><br><span class="line"><span class="attribute">origin</span>/daily/<span class="number">1</span>.<span class="number">2</span>.<span class="number">2</span></span><br><span class="line"><span class="attribute">origin</span>/daily/<span class="number">1</span>.<span class="number">3</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">origin</span>/daily/<span class="number">1</span>.<span class="number">4</span>.<span class="number">1</span></span><br><span class="line"><span class="attribute">origin</span>/develop</span><br><span class="line"><span class="attribute">origin</span>/feature/daily-<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line"><span class="attribute">origin</span>/master</span><br></pre></td></tr></table></figure>

<p>然后直接 </p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git</span> checkout origin/daily/<span class="number">1</span>.<span class="number">4</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure>

<p><a href="https://gaohaoyang.github.io/2016/07/07/git-clone-not-master-branch/">https://gaohaoyang.github.io/2016/07/07/git-clone-not-master-branch/</a></p>
<p><a href="https://git-scm.com/book/zh/v1/Git-%E5%88%86%E6%94%AF-%E8%BF%9C%E7%A8%8B%E5%88%86%E6%94%AF" title="官方参考">官方</a></p>
<ul>
<li><p><a href="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93%E7%9A%84%E4%BD%BF%E7%94%A8">显示远程仓库</a><br> <code>$ git remote show origin </code></p>
<p> <strong>1. 本地分支重命名(还没有推送到远程)</strong></p>
 <figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git branch -m oldName newName</span></span><br></pre></td></tr></table></figure>
<p> <strong>2. 远程分支重命名 (已经推送远程-假设本地分支和远程对应分支名称相同)</strong><br>  a. 重命名远程分支对应的本地分支</p>
 <figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git branch -m oldName newName</span></span><br></pre></td></tr></table></figure>
<p> b. 删除远程分支</p>
 <figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">git <span class="built_in">push</span> --<span class="built_in">delete</span> <span class="built_in">origin</span> oldName</span><br></pre></td></tr></table></figure>
<p> c. 删除本地分支</p>
<pre><code>   `    git branch -d v1.0.0    `
</code></pre>
</li>
<li><blockquote>
<p>获取远程其他分支</p>
</blockquote>
</li>
</ul>
<p>​     </p>
<h5 id="修复已发布版本bug"><a href="#修复已发布版本bug" class="headerlink" title="修复已发布版本bug"></a>修复已发布版本bug</h5><p>修复bug主要以下几步:</p>
<ul>
<li><p>使用git reset –hard <commit id="">命令退回到发布标签对应的版本</commit></p>
</li>
<li><p>使用git checkout -b BugFix新建一个BugFix的分支，原分支前进到最新提交版本</p>
</li>
<li><p>使用git checkout BugFix切换到BugFix分支，修改bug，重新发布并使用git tag打标签</p>
</li>
<li><p>git reaset –hard <head commit="" id=""> 切换主干最新的分支</head></p>
</li>
<li><p>使用git merge合并BugFix分支到主分支</p>
<p>参考:<a href="https://blog.masterliu.net/git-retag/">https://blog.masterliu.net/git-retag/</a></p>
<p>标签是一个文件快照，并不是真拉出一份代码放在了那里</p>
</li>
</ul>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">D:\Project\ASProjects\cqianjia&gt;git <span class="keyword">tag</span></span><br><span class="line">v1.<span class="number">0.2</span></span><br></pre></td></tr></table></figure>

<p>参考: <a href="http://gepeiyu.com/2017/06/28/git-tag-oldversion-debug/">http://gepeiyu.com/2017/06/28/git-tag-oldversion-debug/</a></p>
<p>还有一种情况是在最新提交版本修复bug</p>
<ul>
<li><p>git stash</p>
<p><a href="https://www.jianshu.com/p/54b8ea4317cc">https://www.jianshu.com/p/54b8ea4317cc</a></p>
<p><a href="https://qiita.com/hudichao/items/d665cd769ed1d2ce832a">https://qiita.com/hudichao/items/d665cd769ed1d2ce832a</a></p>
</li>
</ul>
<h5 id="远程仓库更新到本地"><a href="#远程仓库更新到本地" class="headerlink" title="远程仓库更新到本地"></a>远程仓库更新到本地</h5><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>git fetch origin</span><br><span class="line"><span class="variable">$ </span>git merge origin/hexo</span><br></pre></td></tr></table></figure>

<p>或者合并</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ </span>git pull origin hexo </span><br></pre></td></tr></table></figure>
<p><a href="http://www.ruanyifeng.com/blog/2014/06/git_remote.html">http://www.ruanyifeng.com/blog/2014/06/git_remote.html</a></p>
<h6 id="fork后的项目处理"><a href="#fork后的项目处理" class="headerlink" title="fork后的项目处理"></a>fork后的项目处理</h6><p>  <a href="https://gaohaoyang.github.io/2015/04/12/Syncing-a-fork/">https://gaohaoyang.github.io/2015/04/12/Syncing-a-fork/</a></p>
<h5 id="忽略文件已提交的文件"><a href="#忽略文件已提交的文件" class="headerlink" title="忽略文件已提交的文件"></a>忽略文件已提交的文件</h5><p> 对于单个文件处理<br>  假如要忽略 .idea/misc.xml文件，.gitignore可以添加 <code>/.idea/* </code>把.idea文件过滤<br> 主要是　<code>git rm --cached　.idea/misc.xml </code> 然后提交修改,每次手输入才有用?</p>
<p> 对文件夹的处理,比如common-bankcard</p>
<figure class="highlight mipsasm"><table><tr><td class="code"><pre><span class="line">git rm -r --<span class="keyword">cached </span>common-<span class="keyword">bankcard</span></span><br><span class="line"><span class="keyword">git </span>rm --<span class="keyword">cached </span> *idea<span class="comment">/*</span></span><br></pre></td></tr></table></figure>


<h4 id="Git仓库迁移"><a href="#Git仓库迁移" class="headerlink" title="Git仓库迁移"></a>Git仓库迁移</h4><p> 迁移git仓库</p>
<ul>
<li><p>原来托管于github,clone一份裸版本库</p>
<pre><code>git clone --bare git@gitee.com:huaiyi/CQJ.git
</code></pre>
</li>
<li><p>在新的版本库(gitlab)里面创建一个新的项目，例如 cqianjia</p>
</li>
<li><p>推送刚才clone的镜像到gitlab服务器</p>
</li>
</ul>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line">cd CQJ.git/</span><br><span class="line">git push --mirror git<span class="variable">@45</span>.<span class="number">77.22</span>.<span class="number">97</span><span class="symbol">:root/cqianjia</span>.git</span><br></pre></td></tr></table></figure>

<p> mirror 克隆出来的裸版本对上游版本库进行了注册，这样可以在裸版本库中使用git fetch命令和上游版本库进行持续同步</p>
<ul>
<li>  删除本地代码</li>
</ul>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">cd</span></span> ..</span><br><span class="line">rm -rf project.git</span><br></pre></td></tr></table></figure>


<ul>
<li> 到新的服务器clone到本地就Ok了</li>
</ul>
<p>  <code>  git clone git@45.77.22.97:root/cqianjia.git</code> </p>
<p>  参考: <a href="https://my.oschina.net/kind790/blog/510601">https://my.oschina.net/kind790/blog/510601</a></p>
<ul>
<li>  git clone 所有分支</li>
</ul>
<pre><code>这种方式有一个弊端，切换分支后　工程名没了， 还是慢慢摸索吧　!
</code></pre>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">git branch -r | grep -v <span class="string">&#x27;\-&gt;&#x27;</span> | <span class="keyword">while</span> <span class="built_in">read</span> remote; <span class="keyword">do</span> git branch --track <span class="string">&quot;<span class="variable">$&#123;remote#origin/&#125;</span>&quot;</span> <span class="string">&quot;<span class="variable">$remote</span>&quot;</span>; <span class="keyword">done</span></span><br><span class="line">git fetch --all</span><br><span class="line">git pull --all</span><br></pre></td></tr></table></figure>

<p>参考: <a href="http://blog.csdn.net/allangold/article/details/78028709">http://blog.csdn.net/allangold/article/details/78028709</a></p>
<h4 id="GIT标签"><a href="#GIT标签" class="headerlink" title="GIT标签"></a>GIT标签</h4><p>  查看所有的版本<br>​    <code>git tag</code></p>
<ul>
<li>查看远程分支  <code>git ls-remote --tags</code></li>
<li>创建标签 <code>git tag -a v1.0.2 -m &quot;my version 1.0.2&quot;  </code><br>-m 选项指定了一条将会存储在标签中的信息</li>
</ul>
<ul>
<li>创建Tag</li>
</ul>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">git</span> tag -a v<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span> -m <span class="string">&quot;my version 1.0.0&quot;</span></span><br><span class="line"><span class="attribute">git</span> push origin v<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span>    //推送到远程分支</span><br><span class="line"><span class="attribute">git</span> push origin --tags       //推送所有的标签</span><br></pre></td></tr></table></figure>

<ul>
<li>删除tag </li>
</ul>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"> git tag -d &lt;tagname&gt; </span><br><span class="line"> git push origin <span class="symbol">:refs/tags/&lt;tagname&gt;</span></span><br><span class="line"></span><br><span class="line">例如</span><br><span class="line"> git push origin <span class="symbol">:refs/tags/v1</span>.0.<span class="number">2</span></span><br><span class="line"> git tag -d  v1.0.<span class="number">2</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><a href="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%89%93%E6%A0%87%E7%AD%BE">检出标签</a> 检出标签</p>
<h5 id="Checkout-Git-Tags"><a href="#Checkout-Git-Tags" class="headerlink" title="Checkout Git Tags"></a>Checkout Git Tags</h5><p><a href="https://devconnected.com/how-to-checkout-git-tags/">https://devconnected.com/how-to-checkout-git-tags/</a></p>
<blockquote>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">git</span> fetch --all --tags</span><br><span class="line"><span class="symbol">git</span> checkout tags/<span class="built_in">v1</span>.<span class="number">0</span> -<span class="keyword">b</span> <span class="built_in">v1</span>.<span class="number">0</span>-branch	<span class="comment">//git checkout tags/v2.1.1 -b v2.1.1-branch</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">git</span> log --oneline --graph		<span class="comment">//You can inspect the state of your branch by using the “git log” command. Make sure that the HEAD pointer (the latest commit) is pointing to your annotated tag.</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="checkout-remote-tag"><a href="#checkout-remote-tag" class="headerlink" title="checkout remote tag"></a>checkout remote tag</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">git fetch --all --tags</span><br><span class="line"></span><br><span class="line">git ls-remote --tags</span><br><span class="line"> </span><br><span class="line">  refs<span class="regexp">/tags/</span>v2.<span class="number">5.8</span>^&#123;&#125;</span><br><span class="line">  refs<span class="regexp">/tags/</span>v2.<span class="number">5.9</span></span><br><span class="line">  refs<span class="regexp">/tags/</span>v2.<span class="number">5.9</span>^&#123;&#125;</span><br><span class="line"></span><br><span class="line">git checkout  refs<span class="regexp">/tags/</span>v2.<span class="number">5.9</span> -b v2.<span class="number">5.9</span>-branch					<span class="regexp">//</span>-b 后面是自定义的分支名称</span><br><span class="line"> 																				这个自定义</span><br></pre></td></tr></table></figure>



<p>在 Git 中你并不能真的检出一个标签，因为它们并不能像分支一样来回移动。 如果你想要工作目录与仓库中特定的标签版本完全一样，可以使用 git checkout -b [branchname] [tagname] 在特定的标签上创建一个新分支：</p>
<pre><code>    $ git checkout -b version2 v2.0.0
</code></pre>
<p>Switched to a new branch ‘version2’</p>
<p>当然，如果在这之后又进行了一次提交，version2 分支会因为改动向前移动了，那么 version2 分支就会和 v2.0.0 标签稍微有些不同，这时就应该当心了。</p>
<p>修复已发布版本Bug<br><a href="http://gepeiyu.com/2017/06/28/git-tag-oldversion-debug/">http://gepeiyu.com/2017/06/28/git-tag-oldversion-debug/</a></p>
<h5 id="git-stash"><a href="#git-stash" class="headerlink" title="git stash"></a>git stash</h5><p>经常有这样的事情发生，当你正在进行项目中某一部分的工作，里面的东西处于一个比较杂乱的状态，而你想转到其他分支上进行一些工作。问题是，你不想提交进行了一半的工作，否则以后你无法回到这个工作点。解决这个问题的办法就是<code>git stash</code>命令。</p>
<ol>
<li><p><code>git stash  save  &#39;暂存备注信息&#39; </code> //进入暂存状态,此时执行 git status 已经没有要提交的了</p>
</li>
<li><p>git checkout  切换到要修改的分支上 ,修改完</p>
</li>
<li><p>  完成后回到原来的开发分支上，git stash apply 获取最近暂存内容</p>
</li>
<li><p><code>git stash drop  stash@&#123;1&#125; </code></p>
<blockquote>
<p>apply 选项只尝试应用储藏的工作——储藏的内容仍然在栈上。要移除它，你可以运行 <code>git stash drop</code>，加上你希望移除的储藏的名字：</p>
</blockquote>
</li>
</ol>
<ul>
<li><p>git stash 可以进行多次暂存,多次存后 git stash list长下面这样,可以用 · git stash apply stash@{1}· 获取某次暂存的内容</p>
<blockquote>
<p>stash@{0}: WIP on dev: 3d01a6c Patient Entity数据库删除<br>stash@{1}: WIP on dev: b6a688e 跑起来提交</p>
</blockquote>
</li>
<li><p>取消储藏  <code>git stash show -p stash@&#123;0&#125; | git apply -R</code>  如果没指定具体的标签 取消最近的</p>
<p>这个和<code>git stash drop</code>的区别是 取消的是文件内容，stash标签还在</p>
<p><a href="https://git-scm.com/docs/git-stash">https://git-scm.com/docs/git-stash</a></p>
<blockquote>
<p> 注意是 stash@{0}  不是  3d01a6c</p>
</blockquote>
<p>git branch 分支名 hash(历史版本)</p>
</li>
<li><p>update forked project</p>
<p> <a href="https://blog.csdn.net/qq1332479771/article/details/56087333">https://blog.csdn.net/qq1332479771/article/details/56087333</a> </p>
</li>
<li><p>获取暂存</p>
<blockquote>
<p>git stash apply stash@{0}   // don‘t remove stash</p>
<p>git stash pop stash@{0}</p>
</blockquote>
</li>
</ul>
<h5 id="SVN"><a href="#SVN" class="headerlink" title="SVN"></a>SVN</h5><ul>
<li>SVN不能添加文件:<a href="https://blog.csdn.net/yujiayinshi/article/details/51381942">https://blog.csdn.net/yujiayinshi/article/details/51381942</a></li>
</ul>
<h5 id="github提速"><a href="#github提速" class="headerlink" title="github提速"></a>github提速</h5><p><a href="https://link.zhihu.com/?target=http://www.github.com/">www.github.com</a> 替换为   <a href="http://www.github.com.cnpmjs.org/">www.github.com.cnpmjs.org</a></p>
<p><a href="https://github.com/flutter/flutter.git">https://github.com/flutter/flutter.git</a></p>
<p>git clone <a href="https://github.com.cnpmjs.org/love-flutter/flutter-column.git">https://github.com.cnpmjs.org/love-flutter/flutter-column.git</a></p>
<h4 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h4><h5 id="修改远程仓库地址"><a href="#修改远程仓库地址" class="headerlink" title="修改远程仓库地址"></a>修改远程仓库地址</h5><ul>
<li>github创建 New项目，项目地址是 <a href="mailto:&#103;&#105;&#x74;&#64;&#x67;&#x69;&#x74;&#104;&#x75;&#x62;&#46;&#99;&#111;&#109;">&#103;&#105;&#x74;&#64;&#x67;&#x69;&#x74;&#104;&#x75;&#x62;&#46;&#99;&#111;&#109;</a>:BlogForMe/News.git</li>
<li>修改远程服务器地址 ：<code>git remote set-url origin git@github.com:BlogForMe/News.git</code></li>
<li>推送到远程服务器 : <code>git push origin </code></li>
</ul>
<p><a href="http://jcpplus.github.io/2015/07/23/modify-remote-url/">http://jcpplus.github.io/2015/07/23/modify-remote-url/</a></p>
<h5 id="git-pull-git-fetch区别"><a href="#git-pull-git-fetch区别" class="headerlink" title="git pull git fetch区别"></a>git pull git fetch区别</h5><p>git fetch更新本地仓库的两种用法：</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方法一</span></span><br><span class="line">$ git fetch origin <span class="keyword">master</span>                <span class="title">#从远程的origin</span>仓库的<span class="literal">master</span>分支下载代码到本地的origin maste</span><br><span class="line">$ git log -p <span class="literal">master</span>.. origin/<span class="keyword">master</span>      <span class="title">#比较本地的仓库和远程参考的区别</span></span><br><span class="line"><span class="title">$</span> git merge origin/<span class="keyword">master</span>                <span class="title">#把远程下载下来的代码合并到本地仓库，远程的和本地的合并</span></span><br></pre></td></tr></table></figure>



<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 方法二</span></span><br><span class="line"><span class="variable">$</span> git fetch origin master:temp           <span class="comment">#从远程的origin仓库的master分支下载到本地并新建一个分支temp</span></span><br><span class="line"><span class="variable">$</span> git <span class="built_in">diff</span> temp                          <span class="comment">#比较master分支和temp分支的不同</span></span><br><span class="line"><span class="variable">$</span> git merge temp                         <span class="comment">#合并temp分支到master分支</span></span><br><span class="line"><span class="variable">$</span> git branch <span class="literal">-d</span> temp                     <span class="comment">#删除temp</span></span><br></pre></td></tr></table></figure>



<p>这样理解</p>
<p>pull = fetch + merge</p>
<p><a href="https://segmentfault.com/a/1190000017030384">https://segmentfault.com/a/1190000017030384</a></p>
<p><a href="https://www.jianshu.com/p/d265f7763a3a">https://www.jianshu.com/p/d265f7763a3a</a></p>
<p><a href="https://blog.csdn.net/riddle1981/article/details/74938111">https://blog.csdn.net/riddle1981/article/details/74938111</a></p>
<p><a href="https://www.cpweb.top/455">https://www.cpweb.top/455</a></p>
]]></content>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>GIT_SSHKEY</title>
    <url>/2017/10/19/Git_SSKEY/</url>
    <content><![CDATA[<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p><a href="http://skypegnu1.blog.51cto.com/8991766/1641064">http://skypegnu1.blog.51cto.com/8991766/1641064</a></p>
<h5 id="多平台配置SSH"><a href="#多平台配置SSH" class="headerlink" title="多平台配置SSH"></a>多平台配置SSH</h5><p>正常情况会哟几个平台的配置情况,ssh操作方式</p>
<h5 id="用户信息设置"><a href="#用户信息设置" class="headerlink" title="用户信息设置"></a>用户信息设置</h5><p>在config后加上 –global 即可全局设置用户名和邮箱，否则就是局部的。有时候用手输入才有用</p>
<blockquote>
<p> $ git config –global user.name “John Doe”<br> $ git config –global user.email <a href="mailto:&#x6a;&#111;&#104;&#x6e;&#100;&#111;&#x65;&#x40;&#x65;&#120;&#97;&#109;&#x70;&#108;&#101;&#x2e;&#x63;&#x6f;&#109;">&#x6a;&#111;&#104;&#x6e;&#100;&#111;&#x65;&#x40;&#x65;&#120;&#97;&#109;&#x70;&#108;&#101;&#x2e;&#x63;&#x6f;&#109;</a></p>
</blockquote>
<p>　　检查配置信息　<code>git config --list</code></p>
<h4 id="生成sshkey"><a href="#生成sshkey" class="headerlink" title="生成sshkey"></a>生成sshkey</h4><p>如果视其他平台生成时就要修改名称了</p>
<blockquote>
<p>ssh-keygen -t rsa -b 4096 -C “<a href="mailto:&#x79;&#111;&#x75;&#x72;&#x5f;&#101;&#x6d;&#x61;&#x69;&#x6c;&#x40;&#x65;&#120;&#97;&#109;&#x70;&#x6c;&#x65;&#46;&#x63;&#111;&#109;">&#x79;&#111;&#x75;&#x72;&#x5f;&#101;&#x6d;&#x61;&#x69;&#x6c;&#x40;&#x65;&#120;&#97;&#109;&#x70;&#x6c;&#x65;&#46;&#x63;&#111;&#109;</a>“<br>Enter file in which to save the key (/home/jon/.ssh/id_rsa): /home/jon/.ssh/id_rsa.Oschina<br>cat ~/.ssh/id_rsa.li | clip</p>
</blockquote>
<p>Adding your SSH key to the ssh-agent</p>
<p>start the ssh-agent in the background</p>
<pre><code>  $ eval $(ssh-agent -s)
    Agent pid 59566
  $ ssh-add ~/.ssh/id_rsa.li
</code></pre>
<p>gitbash下把生成的id_rsa.pub 添加到sshkey</p>
<p>oschina 测试连接：<code>$ ssh -T git@git.oschina.net</code>　　</p>
<p>github 测试连接:    <code> $ ssh -T git@github.com</code><br>如果出现:</p>
<blockquote>
<p>Hi username! You’ve successfully authenticated, but GitHub does not<br> provide shell access.<br> 配置成功</p>
</blockquote>
<h5 id="不同平台-不同的rsa-key"><a href="#不同平台-不同的rsa-key" class="headerlink" title="不同平台　不同的rsa.key"></a>不同平台　不同的rsa.key</h5><p>　我前面的key重新命名，clone项目还是有问题</p>
<p>  解决方法: 在 .ssh目录下　新建config文件 添加</p>
<blockquote>
<p>  Host github<br>    HostName github.com<br>    User Jon<br>    IdentityFile ~/.ssh/id_rsa.li</p>
</blockquote>
<h5 id="不同的平台，相同的rsa-key-推荐"><a href="#不同的平台，相同的rsa-key-推荐" class="headerlink" title="不同的平台，相同的rsa.key (推荐)"></a>不同的平台，相同的rsa.key (推荐)</h5><p>复制id_rsa.pub填入</p>
<blockquote>
<p>clip &lt; ~/.ssh/id_rsa.pub</p>
</blockquote>
<p>参考：<br>github生成方式<br><a href="https://help.github.com/articles/about-ssh/">https://help.github.com/articles/about-ssh/</a></p>
<p>gitlab生成方式<br><a href="https://gitlab.com/help/ssh/README">https://gitlab.com/help/ssh/README</a></p>
<p>oschina方式:<br><a href="http://git.mydoc.io/?t=154712">http://git.mydoc.io/?t=154712</a></p>
<p>gogs:参考github,配置sskey后还需要用账号登陆</p>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><ol>
<li> 类似下面错误使用　git push -u origin master</li>
</ol>
<p>   <code>git push -f origin master</code></p>
<blockquote>
<p>! [rejected]        master -&gt; master (fetch first)<br>error: failed to push some refs to ‘<a href="https://github.com/aniruddhabarapatre/learn-rails.git&#39;">https://github.com/aniruddhabarapatre/learn-rails.git&#39;</a><br>hint: Updates were rejected because the remote contains work that you do<br>hint: not have locally. This is usually caused by another repository pushing</p>
</blockquote>
<p>参考：<a href="https://stackoverflow.com/questions/20939648/issue-pushing-new-code-in-github">https://stackoverflow.com/questions/20939648/issue-pushing-new-code-in-github</a></p>
<ol start="2">
<li>生成key时，我改成了　id_rsaOschina<br> android studio 最后push 时<br> authentication id_rsaOschina　using key failed报错<br> 方法: AndroidStudio -&gt; File -&gt; Settings -&gt;Git -&gt; SSH executable : built-in 改成Native</li>
</ol>
<p>参考:<a href="https://stackoverflow.com/questions/24688700/android-studio-push-failed-fatal-could-not-read-from-remote-repository">https://stackoverflow.com/questions/24688700/android-studio-push-failed-fatal-could-not-read-from-remote-repository</a></p>
<h5 id="GitHub-CLI-配置"><a href="#GitHub-CLI-配置" class="headerlink" title="GitHub CLI  配置"></a>GitHub CLI  配置</h5><p> 在windows平台 <code>git auth login</code> 授权    要用windows命令行工具。 </p>
]]></content>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title>Glide</title>
    <url>/2017/07/21/Glide/</url>
    <content><![CDATA[<h4 id="Glide加载流程"><a href="#Glide加载流程" class="headerlink" title="Glide加载流程"></a>Glide加载流程</h4><p><img src="/2017/07/21/Glide/2021-08-09_4.51_glideflow.png">\</p>
<h4 id="LruCache"><a href="#LruCache" class="headerlink" title="LruCache"></a>LruCache</h4><p><img src="/2017/07/21/Glide/2021-08-09_4.4_lrucache.png"></p>
<h5 id="LinkedHashMap参数含义"><a href="#LinkedHashMap参数含义" class="headerlink" title="LinkedHashMap参数含义"></a>LinkedHashMap参数含义</h5><p>initialCapacity : 最大容量</p>
<p>loadFactor     :     负载因子</p>
<p>accessOrder    : 排序方式, true 按照访问顺序排序， false 按照插入顺序排序</p>
<h5 id="访问顺序排序"><a href="#访问顺序排序" class="headerlink" title="访问顺序排序"></a>访问顺序排序</h5><p>accessOrder : true</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LinkedHashMap&lt;String, String&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">0</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br><span class="line">map.put(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;f&quot;</span>, <span class="string">&quot;F&quot;</span>);</span><br><span class="line"></span><br><span class="line">map.get(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;n&quot;</span>,<span class="string">&quot;N&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    Log.d(<span class="string">&quot;LruCacheTest&quot;</span>, <span class="string">&quot;testLinkedHashMap : &quot;</span>+ entry.getKey()+<span class="string">&quot; : &quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p> D LruCacheTest: testLinkedHashMap : b : B<br> D LruCacheTest: testLinkedHashMap : c : C<br> D LruCacheTest: testLinkedHashMap : d : D<br> D LruCacheTest: testLinkedHashMap : e : E<br> D LruCacheTest: testLinkedHashMap : f : F<br> D LruCacheTest: testLinkedHashMap : a : A<br> D LruCacheTest: testLinkedHashMap : n : N</p>
</blockquote>
<p>可以看到 先访问a ,在插入n,把最新最近使用和访问的 A N,放到链表后面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LinkedHashMap&lt;String, String&gt; map = <span class="keyword">new</span> LinkedHashMap&lt;&gt;(<span class="number">100</span>, <span class="number">0.75f</span>, <span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>



<blockquote>
<p>D LruCacheTest: testLinkedHashMap : a : A<br>D LruCacheTest: testLinkedHashMap : b : B<br>D LruCacheTest: testLinkedHashMap : c : C<br>D LruCacheTest: testLinkedHashMap : d : D<br>D LruCacheTest: testLinkedHashMap : e : E<br>D LruCacheTest: testLinkedHashMap : f : F<br>D LruCacheTest: testLinkedHashMap : n : N</p>
</blockquote>
<h4 id="感知生命周期"><a href="#感知生命周期" class="headerlink" title="感知生命周期"></a>感知生命周期</h4><p><img src="/2017/07/21/Glide/2021-08-09_4.52_lifecycle.png"></p>
<p><a href="https://www.bilibili.com/video/BV1Qy4y1s7Gh?p=15&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Qy4y1s7Gh?p=15&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://github.com/bumptech/glide">https://github.com/bumptech/glide</a></p>
<p><a href="https://muyangmin.github.io/glide-docs-cn/doc/generatedapi.html">https://muyangmin.github.io/glide-docs-cn/doc/generatedapi.html</a></p>
<p><a href="https://juejin.im/post/6844904136266219534">https://juejin.im/post/6844904136266219534</a></p>
<p><a href="https://www.jianshu.com/p/48d9e4d5d75d">https://www.jianshu.com/p/48d9e4d5d75d</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Gradient</title>
    <url>/2019/07/22/Gradient/</url>
    <content><![CDATA[<h5 id="LinearGradient"><a href="#LinearGradient" class="headerlink" title="LinearGradient"></a>LinearGradient</h5><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * LinearGradient</span></span><br><span class="line"><span class="comment"> * Create a shader that draws a linear gradient along a line.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x0           The x-coordinate for the start of the gradient line</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> y0           The y-coordinate for the start of the gradient line</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x1           The x-coordinate for the end of the gradient line</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> y1           The y-coordinate for the end of the gradient line</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> colors       The colors to be distributed along the gradient line</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> positions    May be null. The relative positions [0..1] of</span></span><br><span class="line"><span class="comment"> *                     each corresponding color in the colors array. If this is null,</span></span><br><span class="line"><span class="comment"> *                     the the colors are distributed evenly along the gradient line.</span></span><br><span class="line"><span class="comment"> 					 所占比例，渲染颜色所占比例,如果传null，则均匀渲染</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> tile         The Shader tiling mode</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">val colors = intArrayOf(</span><br><span class="line">    Color.RED, Color.GREEN, Color.BLUE</span><br><span class="line">)</span><br><span class="line">val positions = floatArrayOf(<span class="number">0.5</span>f, <span class="number">1</span>f, <span class="number">0.5</span>f)</span><br><span class="line">val linearGradient = LinearGradient(<span class="number">0</span>f, <span class="number">300</span>f, <span class="number">300</span>f, <span class="number">300</span>f, colors, positions, Shader.TileMode.CLAMP)</span><br><span class="line">val mPaint = Paint()</span><br><span class="line">mPaint.setShader(linearGradient)</span><br><span class="line">canvas?.drawRect(<span class="number">0</span>f, <span class="number">0</span>f, <span class="number">300</span>f, <span class="number">300</span>f, mPaint)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>LinearGradient（0f, 0f, 300f, 300f）,说明从 (0,0) 到(300,300)对角线方向渲染</p>
<p><img src="/2019/07/22/Gradient/Gradient%5Cgradient_20171214100743840.png" alt="LinearGradient"></p>
</li>
</ul>
<p><a href="https://www.jianshu.com/p/5fb82b189094">https://www.jianshu.com/p/5fb82b189094</a></p>
<ul>
<li><p>渐变模式 </p>
<p>-CLAMP<br>边缘拉伸<br>-REPEAT<br>在水平和垂直两个方向上重复，相邻图像没有间隙<br>-MIRROR</p>
<p>以镜像的方式在水平和垂直两个方向上重复，相邻图像有间隙</p>
</li>
</ul>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
  </entry>
  <entry>
    <title>Gogs</title>
    <url>/2017/11/12/Gogs/</url>
    <content><![CDATA[<p>ubuntu 17.04  Gogs搭建git服务器</p>
<h4 id="gogs-Install"><a href="#gogs-Install" class="headerlink" title="gogs Install"></a>gogs Install</h4><h5 id="创建git用户"><a href="#创建git用户" class="headerlink" title="创建git用户"></a>创建git用户</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">sudo apt-get upgrade</span><br><span class="line"></span><br><span class="line">sudo adduser git <span class="regexp">//</span>创建用户  密码 ******* (<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line">su git<span class="regexp">//</span>切换到git用户</span><br><span class="line"></span><br><span class="line">cd ~  <span class="regexp">//</span>进入用户git根目录</span><br><span class="line"></span><br><span class="line">git --version <span class="regexp">//</span>检查git是否安装</span><br></pre></td></tr></table></figure>
<p> 修改git密码</p>
<p>　　到root下<br>　　passwd git<br>　　然后输入密码<br><a href="http://wangchujiang.com/linux-command/c/passwd.html">http://wangchujiang.com/linux-command/c/passwd.html</a></p>
<p><del>#　创建数据库</del></p>
<p>这个可以选择默认的sqlite3救不需要安装mysql</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">mysql -u root -p</span><br><span class="line">mysql&gt; <span class="keyword">SET</span> <span class="keyword">GLOBAL</span> storage_engine = <span class="string">&#x27;InnoDB&#x27;</span>;</span><br><span class="line">mysql&gt; <span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> gogs <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_bin;</span><br><span class="line">mysql&gt; <span class="keyword">GRANT</span> <span class="keyword">ALL</span> <span class="keyword">PRIVILEGES</span> <span class="keyword">ON</span> gogs.* <span class="keyword">TO</span> ‘root’@‘localhost’ IDENTIFIED <span class="keyword">BY</span> ‘itadmin’;</span><br><span class="line">mysql&gt; FLUSH <span class="keyword">PRIVILEGES</span>;</span><br><span class="line">mysql&gt; QUIT；</span><br></pre></td></tr></table></figure>

<p><del>##  安装golang环境(可以忽略)</del></p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">su git</span><br><span class="line">环境变量</span><br><span class="line">export GOROOT=<span class="variable">$HOME</span>/go        <span class="comment">//目录下</span></span><br><span class="line">export GOARCH=amd64   #系统位数，<span class="number">386</span>表示<span class="number">32</span>位系统，amd64表示<span class="number">64</span>位系统。</span><br><span class="line">export GOOS=linux   #系统类型</span><br><span class="line">export PATH=<span class="variable">$PATH</span>:<span class="variable">$GOROOT</span>/bin</span><br><span class="line"></span><br><span class="line"><span class="comment">//使环境变量生效：</span></span><br><span class="line">source ~/.bashrc</span><br><span class="line"></span><br><span class="line">wget https:<span class="comment">//github.com/gogits/gogs/releases/download/v0.11.29/go1.9.2.linux-amd64.tar.gz</span></span><br><span class="line">tar zxvf  go1.<span class="number">9.2</span><span class="selector-class">.linux-amd64</span><span class="selector-class">.tar</span>.gz</span><br><span class="line">mv go <span class="variable">$GOROOT</span>  <span class="comment">//这一步有点问题，已存在文件</span></span><br><span class="line">go env <span class="comment">//测试这个一步　倒是没问题</span></span><br></pre></td></tr></table></figure>
<h5 id="安装Gogs"><a href="#安装Gogs" class="headerlink" title="安装Gogs"></a>安装Gogs</h5><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">su git </span><br><span class="line">cd ~</span><br><span class="line">wget https:<span class="regexp">//gi</span>thub.com<span class="regexp">/gogits/g</span>ogs<span class="regexp">/releases/</span>download<span class="regexp">/v0.11.29/</span>linux_amd64.tar.gz</span><br><span class="line">tar zxvf  linux_amd64.tar.gz   <span class="regexp">//</span>解压后会右gogs文件</span><br><span class="line">  cd gogs</span><br><span class="line"> ./gogs web</span><br></pre></td></tr></table></figure>

<h5 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h5><p>浏览器输入  <a href="http://yourip:3000/install">http://yourip:3000/install</a>  进行配置</p>
<p> 如图　把localhost改成yourip<br><img src="/2017/11/12/Gogs/Gogs-install.png" alt="安装图"></p>
<h5 id="后台运行"><a href="#后台运行" class="headerlink" title="后台运行"></a>后台运行</h5><figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">su git</span><br><span class="line"><span class="keyword">cd</span> <span class="string">/home/git/gogs</span> </span><br><span class="line">nohup <span class="string">./gogs</span> web&amp;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a href="http://www.yuxang.com/%E4%BD%BF%E7%94%A8-gogs-%E6%90%AD%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84-git-%E6%9C%8D%E5%8A%A1%E5%99%A8/">雨巷前端</a> 雨巷前端</p>
<h5 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h5><p>查找gogs目录     <code>find / -name &#39;gogs&#39; </code></p>
<p>然后按照后台运行</p>
<h4 id="Gogs-upgrade"><a href="#Gogs-upgrade" class="headerlink" title="Gogs upgrade"></a>Gogs upgrade</h4><blockquote>
<p>sudo su - git</p>
<p>cd ~</p>
<p>pwd</p>
<p>ls</p>
<p>mv gogs gogs_old</p>
<p>wget <a href="https://dl.gogs.io/0.11.91/gogs_0.11.91_linux_amd64.tar.gz">https://dl.gogs.io/0.11.91/gogs_0.11.91_linux_amd64.tar.gz</a></p>
<p>tar -zxvf gogs_0.11.91_linux_amd64.tar.gz </p>
<p>ls</p>
<p>cp -R gogs_old/{custom,data,log} gogs</p>
<p>cd gogs</p>
<p>./gogs web</p>
</blockquote>
<p><a href="https://gogs.io/docs/upgrade/upgrade_from_binary">https://gogs.io/docs/upgrade/upgrade_from_binary</a></p>
<h4 id="clone地址为-localhost问题"><a href="#clone地址为-localhost问题" class="headerlink" title="clone地址为 localhost问题"></a>clone地址为 localhost问题</h4><p> /home/git/gogs/custom/conf下把app.ini，DOMAIN   ROOT_URL 改成主机ip</p>
<h4 id="Draw"><a href="#Draw" class="headerlink" title="Draw"></a>Draw</h4><figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/root/</span>DRAW<span class="regexp">/apache-tomcat-8.5.65/</span>bin</span><br><span class="line">./startup.sh</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>LINUX</category>
      </categories>
  </entry>
  <entry>
    <title>GreenDao</title>
    <url>/2019/08/12/GreenDao/</url>
    <content><![CDATA[<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><h5 id="数据库定义"><a href="#数据库定义" class="headerlink" title="数据库定义"></a>数据库定义</h5><ul>
<li>Bean</li>
</ul>
<blockquote>
<p> schema：告知GreenDao当前实体属于哪个schema<br> active：标记一个实体处于活跃状态，活动实体有更新、删除和刷新方法<br> nameInDb：在数据库中使用的别名，默认使用的是实体的类名<br> indexes：定义索引，可以跨越多个列<br> createInDb：标记创建数据库表</p>
</blockquote>
<ul>
<li><p>基础属性注解</p>
<blockquote>
<p>@Id：主键 Long 型，可以通过@Id(autoincrement = true)设置自增长<br>@Property：设置一个非默认关系映射所对应的列名，默认是使用字段名，例如：@Property(nameInDb = “name”)<br>@NotNull：设置数据库表当前列不能为空<br>@Transient：添加此标记后不会生成数据库表的列</p>
</blockquote>
</li>
<li><p>索引注解</p>
</li>
</ul>
<blockquote>
<p>@Index：使用@Index作为一个属性来创建一个索引，通过name设置索引别名，也可以通过unique给索引添加约束<br>@Unique：向数据库添加了一个唯一的约束</p>
</blockquote>
<ul>
<li><p>关系注解</p>
<blockquote>
<p>@ToOne：定义与另一个实体（一个实体对象）的关系<br>@ToMany：定义与多个实体对象的关系</p>
</blockquote>
</li>
</ul>
<p><a href="https://blog.csdn.net/speedystone/article/details/72769793">https://blog.csdn.net/speedystone/article/details/72769793</a></p>
<h5 id="Convert-自定义类型"><a href="#Convert-自定义类型" class="headerlink" title="@Convert 自定义类型"></a>@Convert 自定义类型</h5><figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> @<span class="keyword">interface</span> Convert &#123;</span><br><span class="line">    <span class="keyword">Class</span>&lt;? <span class="keyword">extends</span> PropertyConverter&gt; converter();</span><br><span class="line">    <span class="keyword">Class</span> columnType(); <span class="comment">//可以在DB中保留的列的类。这仅限于greenDAO原生支持的所有java类。</span></span><br><span class="line">&#125;</span><br><span class="line">@Convert(converter = NoteTypeConverter.<span class="keyword">class</span>, columnType = String.<span class="keyword">class</span>) <span class="comment">//类型转换类，自定义的类型在数据库中存储的类型</span></span><br><span class="line"><span class="keyword">private</span> NoteType type; <span class="comment">//在保存到数据库时会将自定义的类型 NoteType 通过 NoteTypeConverter 转换为数据库支持的 String 类型。反之亦然</span></span><br></pre></td></tr></table></figure>



<h5 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h5><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span>(autoincrement = <span class="literal">true</span>)  <span class="comment">// id  递增</span></span><br><span class="line">            Long id;</span><br><span class="line">    <span class="meta">@Unique</span></span><br><span class="line">    <span class="keyword">public</span> int studentNo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int age; <span class="comment">//年龄</span></span><br><span class="line">    <span class="meta">@Property</span>(nameInDb = <span class="string">&quot;usePhone&quot;</span>) <span class="comment">//数据库中映射的字段就是 usePhone</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">String</span> telPhone;<span class="comment">//手机号</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span>  <span class="comment">//数据库中不会创建对应的字段</span></span><br><span class="line">            <span class="built_in">String</span> sex; <span class="comment">//性别</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span> name;<span class="comment">//姓名</span></span><br><span class="line">    <span class="built_in">String</span> address;<span class="comment">//家庭住址</span></span><br><span class="line">    <span class="built_in">String</span> schoolName;<span class="comment">//学校名字</span></span><br><span class="line">    <span class="built_in">String</span> grade;<span class="comment">//几年级</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> statue;</span><br></pre></td></tr></table></figure>

<h6 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h6><ul>
<li><p>insertData</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</span><br><span class="line">    Student student = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">    student.set<span class="constructor">StudentNo(<span class="params">i</span>)</span>;</span><br><span class="line">    student.age = <span class="keyword">new</span> <span class="constructor">Random()</span>.next<span class="constructor">Int()</span> + <span class="number">10</span>;</span><br><span class="line">    student.telPhone = <span class="module-access"><span class="module"><span class="identifier">RandomValue</span>.</span></span>get<span class="constructor">Tel()</span>;</span><br><span class="line">    student.set<span class="constructor">Name(RandomValue.<span class="params">getChineseName</span>()</span>);</span><br><span class="line">    <span class="keyword">if</span> (i % <span class="number">2</span><span class="operator"> == </span><span class="number">0</span>) &#123;</span><br><span class="line">        student.set<span class="constructor">Sex(<span class="string">&quot;男&quot;</span>)</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        student.set<span class="constructor">Sex(<span class="string">&quot;女&quot;</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i<span class="operator"> == </span><span class="number">0</span>) &#123;</span><br><span class="line">        student.set<span class="constructor">Statue(<span class="params">true</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    student.set<span class="constructor">Address(RandomValue.<span class="params">getRoad</span>()</span>);</span><br><span class="line">    student.set<span class="constructor">SchoolName(RandomValue.<span class="params">getSchoolName</span>()</span>);</span><br><span class="line">    long dsoi = studaoImpl.insert(student);</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;insertData &quot;</span> + dsoi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>insertOrReplace</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Student student = <span class="keyword">new</span> <span class="constructor">Student()</span>;</span><br><span class="line">student.set<span class="constructor">StudentNo(1)</span>;</span><br><span class="line">student.set<span class="constructor">Name(<span class="string">&quot;我改名了&quot;</span>)</span>;</span><br><span class="line">long df = studaoImpl.insert<span class="constructor">OrReplace(<span class="params">student</span>)</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>updateData</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">Student student = new Student()<span class="comment">;</span></span><br><span class="line">student.setStudentNo(<span class="number">1</span>)<span class="comment">;</span></span><br><span class="line">student.setName(<span class="string">&quot;我改名了&quot;</span>)<span class="comment">;</span></span><br><span class="line">studaoImpl.update(student)<span class="comment">;</span></span><br></pre></td></tr></table></figure></li>
<li><p>delete</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">Student student = new Student()<span class="comment">;</span></span><br><span class="line">student.setId(<span class="number">1</span>l)<span class="comment">;</span></span><br><span class="line">studaoImpl.delete(student)<span class="comment">;</span></span><br></pre></td></tr></table></figure></li>
<li><p>deleteAll</p>
</li>
</ul>
<p>​     <code>  studaoImpl.deleteAll();</code></p>
<h6 id="query"><a href="#query" class="headerlink" title="query"></a>query</h6><ul>
<li>QueryAll</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">List&lt;Student&gt; dd = studaoImpl.load<span class="constructor">All()</span>;</span><br><span class="line">studaoImpl.load<span class="constructor">All()</span>.<span class="keyword">for</span><span class="constructor">Each(<span class="params">current</span>-&gt;Timber.<span class="params">i</span>(<span class="params">current</span>.<span class="params">toString</span>()</span>)); <span class="comment">// print student</span></span><br></pre></td></tr></table></figure>

<ul>
<li>QueryLastState</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">List&lt;Student&gt; sList = studaoImpl.query<span class="constructor">Builder()</span>.limit(<span class="number">1</span>).where(<span class="module-access"><span class="module"><span class="identifier">StudentDao</span>.</span><span class="module"><span class="identifier">Properties</span>.</span><span class="module"><span class="identifier">Statue</span>.</span></span>eq(<span class="literal">false</span>)).<span class="built_in">list</span><span class="literal">()</span>;</span><br><span class="line"><span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(sList.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">Student student = sList.get(<span class="number">0</span>);</span><br><span class="line">student.set<span class="constructor">Statue(<span class="params">true</span>)</span>;</span><br><span class="line">studaoImpl.update(student);</span><br><span class="line">sList = studaoImpl.query<span class="constructor">Builder()</span>.limit(<span class="number">1</span>).where(<span class="module-access"><span class="module"><span class="identifier">StudentDao</span>.</span><span class="module"><span class="identifier">Properties</span>.</span><span class="module"><span class="identifier">Statue</span>.</span></span>eq(<span class="literal">false</span>)).<span class="built_in">list</span><span class="literal">()</span>;</span><br></pre></td></tr></table></figure>

<h5 id="oneToOne"><a href="#oneToOne" class="headerlink" title="oneToOne"></a>oneToOne</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> pid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreditCard</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> cid;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> pid;</span><br><span class="line">    <span class="comment">//idcard和person是一对一关系，外键为personId</span></span><br><span class="line">    <span class="meta">@ToOne(joinProperty = &quot;pid&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h6 id="insert-1"><a href="#insert-1" class="headerlink" title="insert"></a>insert</h6><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Long pid = <span class="number">6L</span>;<span class="comment">//personId</span></span><br><span class="line"></span><br><span class="line">Person p = <span class="keyword">new</span> <span class="constructor">Person(<span class="params">pid</span>, <span class="string">&quot;xiaoMing&quot;</span>, 18)</span>;</span><br><span class="line">mPersonDao.insert(p);</span><br><span class="line">Long cid = <span class="number">2L</span>;<span class="comment">//idcardid;</span></span><br><span class="line">CreditCard c = <span class="keyword">new</span> <span class="constructor">CreditCard(<span class="params">cid</span>, 100)</span>; <span class="comment">//这个写了100（无论写什么）,实际还是6,关联了personId</span></span><br><span class="line">c.set<span class="constructor">Person(<span class="params">p</span>)</span>;</span><br><span class="line">mCreditCardDao.insert(c);</span><br></pre></td></tr></table></figure>

<h6 id="query-1"><a href="#query-1" class="headerlink" title="query"></a>query</h6><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">List&lt;CreditCard&gt; <span class="built_in">list</span> = mCreditCardDao.load<span class="constructor">All()</span>;</span><br><span class="line">CreditCard card = <span class="built_in">list</span>.get(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (card != null) &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;CardInfo  cardid----------&gt;&quot;</span> + card.get<span class="constructor">Cid()</span> + <span class="string">&quot;  personid----------&gt;&quot;</span> + card.get<span class="constructor">Pid()</span>);</span><br><span class="line">&#125;</span><br><span class="line">switch (position) &#123;</span><br><span class="line">    case <span class="number">0</span>:</span><br><span class="line">        select<span class="constructor">PersonInfoByCard(<span class="params">card</span>)</span>;<span class="comment">//根据idcard获取person</span></span><br><span class="line">        break;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> void select<span class="constructor">PersonInfoByCard(CreditCard <span class="params">card</span>)</span> &#123;</span><br><span class="line">        Person person = null;</span><br><span class="line">        <span class="keyword">if</span> (card != null) &#123;</span><br><span class="line">            person = card.get<span class="constructor">Person()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (person != null) &#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;PersonByCard   personId   + ----------&gt; &quot;</span> + person.get<span class="constructor">Pid()</span> + <span class="string">&quot;  name----------&gt;   &quot;</span> + person.get<span class="constructor">Name()</span> + <span class="string">&quot;    age----------&gt;&quot;</span> + person.get<span class="constructor">Age()</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;----获取person信息失败------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://juejin.im/post/5a30f79c6fb9a045031014fd">https://juejin.im/post/5a30f79c6fb9a045031014fd</a></p>
<p><a href="https://blog.csdn.net/qq_34358104/article/details/69833909">https://blog.csdn.net/qq_34358104/article/details/69833909</a></p>
<h5 id="OneToMany"><a href="#OneToMany" class="headerlink" title="OneToMany"></a>OneToMany</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MStudent</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> sid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> tid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MTecher</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> tid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一对多关系，tid为Student表的外键</span></span><br><span class="line">    <span class="meta">@ToMany(referencedJoinProperty = <span class="meta-string">&quot;tid&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;MStudent&gt; students;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="insert-2"><a href="#insert-2" class="headerlink" title="insert"></a>insert</h6><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 添加Student信息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> void insert<span class="constructor">Student()</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           Long sid = <span class="number">1L</span>;</span><br><span class="line">           <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">               MStudent s = <span class="keyword">new</span> <span class="constructor">MStudent(<span class="params">sid</span>, <span class="string">&quot;xiaoMing--&gt;&quot;</span> + <span class="params">i</span>, <span class="params">tid</span>)</span>;</span><br><span class="line">               mStudentDao.insert(s);</span><br><span class="line">               sid++;</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>, <span class="string">&quot;学生信息添加成功&quot;</span>);</span><br><span class="line">       &#125; catch (Exception e) &#123;</span><br><span class="line">           e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>, <span class="string">&quot;学生信息添加失败&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 添加Teacher信息</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">private</span> void insert<span class="constructor">Teacher()</span> &#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           String name = <span class="string">&quot;Miss zhang&quot;</span>;</span><br><span class="line">           MTecher mTecher = <span class="keyword">new</span> <span class="constructor">MTecher(<span class="params">tid</span>, <span class="params">name</span>)</span>;</span><br><span class="line">           mTecherDao.insert(mTecher);</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;教师信息添加成功&quot;</span>);</span><br><span class="line">       &#125; catch (Exception e) &#123;</span><br><span class="line">           e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">           <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;教师信息添加失败&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h6 id="query-2"><a href="#query-2" class="headerlink" title="query"></a>query</h6><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void select<span class="constructor">Teacher()</span> &#123;</span><br><span class="line">    MTecher t = null;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        t = mTecherDao.load<span class="constructor">ByRowId(<span class="params">tid</span>)</span>;</span><br><span class="line">        <span class="keyword">if</span> (t != null)&#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;查询教师信息----&gt;成功&quot;</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;tid---&gt;&quot;</span>+t.get<span class="constructor">Tid()</span>);</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;teacher&#x27;s name-----&gt;&quot;</span>+t.get<span class="constructor">Name()</span>);</span><br><span class="line">            select<span class="constructor">StudentByTeacher(<span class="params">t</span>)</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;查询表中没有该教师信息&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;查询教师信息----&gt;失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据获取得到的Teacher获取其名下的学生信息</span></span><br><span class="line"><span class="comment">     * @param t</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> void select<span class="constructor">StudentByTeacher(MTecher <span class="params">t</span>)</span> &#123;</span><br><span class="line">        List&lt;MStudent&gt; <span class="built_in">list</span> = t.get<span class="constructor">Students()</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">list</span> != null<span class="operator"> &amp;&amp; </span><span class="built_in">list</span>.size<span class="literal">()</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (MStudent mStudent : <span class="built_in">list</span>) &#123;</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;sid---------&gt;  &quot;</span>+mStudent.get<span class="constructor">Sid()</span> +<span class="string">&quot;    tid---------&gt;&quot;</span>+mStudent.get<span class="constructor">Tid()</span>+<span class="string">&quot;  name--------&gt;&quot;</span>+mStudent.get<span class="constructor">Name()</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(<span class="string">&quot;tag&quot;</span>,<span class="string">&quot;--------获取学生信息失败--------&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="ManyToMany"><a href="#ManyToMany" class="headerlink" title="ManyToMany"></a>ManyToMany</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NTeacher</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> tid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@ToMany</span></span><br><span class="line">    <span class="meta">@JoinEntity(entity = TandSRelative.class, sourceProperty = <span class="meta-string">&quot;tid&quot;</span>, targetProperty = <span class="meta-string">&quot;sid&quot;</span>)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;TandSRelative&gt; list;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NStudent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> sid;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToMany</span></span><br><span class="line">    <span class="meta">@JoinEntity(entity = TandSRelative.class,sourceProperty = <span class="meta-string">&quot;sid&quot;</span>,targetProperty = <span class="meta-string">&quot;tid&quot;</span>)</span></span><br><span class="line">    List&lt;NTeacher&gt; teacherList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TandSRelative</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id(autoincrement = true)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> tsid;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> tid;<span class="comment">//teacher的id</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Long</span> sid;<span class="comment">//student的id</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="insert-3"><a href="#insert-3" class="headerlink" title="insert"></a>insert</h6><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">    <span class="comment">//2个教师和3个学生的关系</span></span><br><span class="line"><span class="comment">//教师1，带学生1、2</span></span><br><span class="line"><span class="comment">//教师2，带学生1、3</span></span><br><span class="line"><span class="comment">//学生1，选修教师1和教师2的课</span></span><br><span class="line">    <span class="keyword">private</span> void add<span class="constructor">TeacherStu()</span> &#123;</span><br><span class="line">        List&lt;NTeacher&gt; teacherList = <span class="keyword">new</span> ArrayList&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">        <span class="keyword">for</span> (long i = <span class="number">1</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            NTeacher teacherBean = <span class="keyword">new</span> <span class="constructor">NTeacher()</span>;</span><br><span class="line">            teacherBean.set<span class="constructor">Tid(<span class="params">i</span>)</span>;</span><br><span class="line">            teacherList.add(teacherBean);</span><br><span class="line">        &#125;</span><br><span class="line">        daoSession.get<span class="constructor">NTeacherDao()</span>.insert<span class="constructor">InTx(<span class="params">teacherList</span>)</span>;</span><br><span class="line"></span><br><span class="line">        List&lt;NStudent&gt; studentList = <span class="keyword">new</span> ArrayList&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">        <span class="keyword">for</span> (long j = <span class="number">1</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">            NStudent studentBean = <span class="keyword">new</span> <span class="constructor">NStudent()</span>;</span><br><span class="line">            studentBean.set<span class="constructor">Sid(<span class="params">j</span>)</span>;</span><br><span class="line">            studentList.add(studentBean);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//教师1带学生1、2</span></span><br><span class="line">        List&lt;TandSRelative&gt; teacherTeachStuList = <span class="keyword">new</span> ArrayList&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">        TandSRelative tandSRelative1 = <span class="keyword">new</span> <span class="constructor">TandSRelative(<span class="params">null</span>, 1L, 1L)</span>;</span><br><span class="line">        teacherTeachStuList.add(tandSRelative1);</span><br><span class="line"></span><br><span class="line">        TandSRelative tandSRelative2 = <span class="keyword">new</span> <span class="constructor">TandSRelative(<span class="params">null</span>, 1L, 2L)</span>;</span><br><span class="line">        teacherTeachStuList.add(tandSRelative2);</span><br><span class="line"></span><br><span class="line">        TandSRelative tandSRelative3 = <span class="keyword">new</span> <span class="constructor">TandSRelative(<span class="params">null</span>, 2L, 1L)</span>;</span><br><span class="line">        teacherTeachStuList.add(tandSRelative3);</span><br><span class="line"></span><br><span class="line">        TandSRelative tandSRelative4 = <span class="keyword">new</span> <span class="constructor">TandSRelative(<span class="params">null</span>, 2L, 3L)</span>;</span><br><span class="line">        teacherTeachStuList.add(tandSRelative4);</span><br><span class="line"></span><br><span class="line">        daoSession.get<span class="constructor">TandSRelativeDao()</span>.insert<span class="constructor">InTx(<span class="params">teacherTeachStuList</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.cnblogs.com/Free-Thinker/p/10654474.html">https://www.cnblogs.com/Free-Thinker/p/10654474.html</a></p>
<p><a href="https://juejin.im/post/5a30f79c6fb9a045031014fd">https://juejin.im/post/5a30f79c6fb9a045031014fd</a></p>
<p><a href="https://blog.csdn.net/RobotHost/article/details/70098744">https://blog.csdn.net/RobotHost/article/details/70098744</a></p>
<h5 id="migration"><a href="#migration" class="headerlink" title="migration"></a>migration</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">class</span> MySQLiteOpenHelper extends DaoMaster.OpenHelper &#123;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">MySQLiteOpenHelper(Context <span class="params">context</span>, String <span class="params">name</span>, SQLiteDatabase.CursorFactory <span class="params">factory</span>)</span> &#123;</span><br><span class="line">        super(context, name, factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void on<span class="constructor">Upgrade(Database <span class="params">db</span>, <span class="params">int</span> <span class="params">oldVersion</span>, <span class="params">int</span> <span class="params">newVersion</span>)</span> &#123;</span><br><span class="line"><span class="comment">//        super.onUpgrade(db, oldVersion, newVersion);</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">MigrationHelper</span>.</span></span>migrate(db, <span class="keyword">new</span> MigrationHelper.<span class="constructor">ReCreateAllTableListener()</span> &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void on<span class="constructor">CreateAllTables(Database <span class="params">db</span>, <span class="params">boolean</span> <span class="params">ifNotExists</span>)</span> &#123;</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">DaoMaster</span>.</span></span>create<span class="constructor">AllTables(<span class="params">db</span>, <span class="params">ifNotExists</span>)</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void on<span class="constructor">DropAllTables(Database <span class="params">db</span>, <span class="params">boolean</span> <span class="params">ifExists</span>)</span> &#123;</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">DaoMaster</span>.</span></span>drop<span class="constructor">AllTables(<span class="params">db</span>, <span class="params">ifExists</span>)</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="module-access"><span class="module"><span class="identifier">StudentDao</span>.</span></span><span class="keyword">class</span>); <span class="comment">//可以添加多个</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//        DaoMaster.DevOpenHelper helper = new DaoMaster.DevOpenHelper(this, &quot;dblearn.db&quot;);</span></span><br><span class="line">        MigrationHelper.DEBUG = <span class="literal">true</span>;</span><br><span class="line">        MySQLiteOpenHelper helper = <span class="keyword">new</span> <span class="constructor">MySQLiteOpenHelper(<span class="params">this</span>,<span class="string">&quot;dblearn.db&quot;</span>,<span class="params">null</span>)</span>;</span><br><span class="line">        SQLiteDatabase db = helper.get<span class="constructor">WritableDatabase()</span>;</span><br><span class="line">        DaoMaster daoMaster = <span class="keyword">new</span> <span class="constructor">DaoMaster(<span class="params">db</span>)</span>;</span><br><span class="line">        daoSession = daoMaster.<span class="keyword">new</span><span class="constructor">Session()</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span>(autoincrement = <span class="literal">true</span>)  <span class="comment">// id  递增</span></span><br><span class="line">            Long id;</span><br><span class="line">    <span class="meta">@Unique</span></span><br><span class="line">    <span class="keyword">public</span> int studentNo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int age; <span class="comment">//年龄</span></span><br><span class="line">    <span class="meta">@Property</span>(nameInDb = <span class="string">&quot;usePhone&quot;</span>) <span class="comment">//数据库中映射的字段就是 usePhone</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">String</span> telPhone;<span class="comment">//手机号</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span>  <span class="comment">//数据库中不会创建对应的字段</span></span><br><span class="line">            <span class="built_in">String</span> sex; <span class="comment">//性别</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">String</span> name;<span class="comment">//姓名</span></span><br><span class="line">    <span class="built_in">String</span> address;<span class="comment">//家庭住址</span></span><br><span class="line">    <span class="built_in">String</span> schoolName;<span class="comment">//学校名字</span></span><br><span class="line">    <span class="built_in">String</span> grade;<span class="comment">//几年级</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> statue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ToOne</span>(joinProperty = <span class="string">&quot;name&quot;</span>)</span><br><span class="line">    IdCard student;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">String</span> migrate; <span class="comment">//新添加的字段 迁移</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://github.com/yuweiguocn/GreenDaoUpgradeHelper/blob/master/README_CH.md">https://github.com/yuweiguocn/GreenDaoUpgradeHelper/blob/master/README_CH.md</a></p>
<p><a href="https://stackoverflow.com/questions/13373170/greendao-schema-update-and-data-migration/30334668#30334668">https://stackoverflow.com/questions/13373170/greendao-schema-update-and-data-migration/30334668#30334668</a></p>
<h4 id="查看数据库"><a href="#查看数据库" class="headerlink" title="查看数据库"></a>查看数据库</h4><h5 id="database-navigator"><a href="#database-navigator" class="headerlink" title="database navigator"></a>database navigator</h5><p>![check_Screen Shot 2020-04-13 at 5.59.22 PM](GreenDao/check_Screen Shot 2020-04-13 at 5.59.22 PM.png)</p>
<p>![Screen Shot 2020-04-13 at 6.04.11 PM](GreenDao/Screen Shot 2020-04-13 at 6.04.11 PM.png)</p>
<p>C:\Users\john\Desktop\dbsqlite</p>
<p>Device file explorer里面查看</p>
<p>data/data/{$packname}/mine</p>
<p><a href="https://blog.csdn.net/yu75567218/article/details/78904909">https://blog.csdn.net/yu75567218/article/details/78904909</a></p>
<h4 id="数据缓存"><a href="#数据缓存" class="headerlink" title="数据缓存"></a>数据缓存</h4><ul>
<li><p>RxJava实现数据网络数据缓存</p>
<p><a href="https://blog.csdn.net/qq_35064774/article/details/53449795">https://blog.csdn.net/qq_35064774/article/details/53449795</a></p>
</li>
<li><p>用户测量数据有网上传</p>
<p><a href="https://wenku.baidu.com/view/65f16f61998fcc22bdd10d5b.html">https://wenku.baidu.com/view/65f16f61998fcc22bdd10d5b.html</a></p>
<p><a href="https://my.oschina.net/banxi/blog/57984">https://my.oschina.net/banxi/blog/57984</a></p>
<p><a href="https://www.infoq.cn/article/q-EjPtHOVFaE46XKjhlf">https://www.infoq.cn/article/q-EjPtHOVFaE46XKjhlf</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>DB</tag>
      </tags>
  </entry>
  <entry>
    <title>Gson</title>
    <url>/2017/07/21/Gson/</url>
    <content><![CDATA[<h5 id="Gson-Types理解"><a href="#Gson-Types理解" class="headerlink" title="$Gson$Types理解"></a>$Gson$Types理解</h5><p> 官方教程 <a href="https://github.com/google/gson/blob/master/UserGuide.md" title="官方教程">https://github.com/google/gson/blob/master/UserGuide.md</a></p>
<p> 源码分析<br><a href="http://www.jianshu.com/p/89c314ae8c0b">http://www.jianshu.com/p/89c314ae8c0b</a></p>
<h5 id="Gson转map"><a href="#Gson转map" class="headerlink" title="Gson转map"></a>Gson转map</h5><ul>
<li>Gson可以直接把json转为map,但是在转成map时，默认將int long型的数字,转换成doublel类型</li>
</ul>
<figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> sms <span class="operator">=</span> <span class="string">&quot;&#123;<span class="subst">\&quot;</span>Code<span class="subst">\&quot;</span>:200,<span class="subst">\&quot;</span>Data<span class="subst">\&quot;</span>:&#123;<span class="subst">\&quot;</span>Code<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span><span class="subst">\&quot;</span>&#125;,<span class="subst">\&quot;</span>Message<span class="subst">\&quot;</span>:<span class="subst">\&quot;</span>发送成功<span class="subst">\&quot;</span>&#125;&quot;</span>;</span><br><span class="line"><span class="type">Map</span>&lt;<span class="type">String</span>, <span class="type">Object</span>&gt; map <span class="operator">=</span> new <span class="type">Gson</span>().fromJson(sms, <span class="type">HashMap</span>.class);</span><br></pre></td></tr></table></figure>
<p>这里装成map后，Code值尾 200.0  ,解析方法　</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">Gson gson = <span class="keyword">new</span> GsonBuilder()</span><br><span class="line">          .registerTypeAdapter(<span class="keyword">new</span> TypeToken&lt;TreeMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt;&gt;() &#123;</span><br><span class="line">          &#125;.getType(), <span class="keyword">new</span> JsonDeserializer&lt;TreeMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt;&gt;() &#123;</span><br><span class="line"></span><br><span class="line">              <span class="meta">@Override</span></span><br><span class="line">              public TreeMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; deserialize(JsonElement json, <span class="built_in">Type</span> typeOfT, JsonDeserializationContext context) throws JsonParseException &#123;</span><br><span class="line">                  TreeMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; treeMap = <span class="keyword">new</span> TreeMap&lt;&gt;();</span><br><span class="line">                  JsonObject jsonObject = json.getAsJsonObject();</span><br><span class="line">                  <span class="built_in">Set</span>&lt;<span class="built_in">Map</span>.Entry&lt;<span class="built_in">String</span>, JsonElement&gt;&gt; entrySet = jsonObject.entrySet();</span><br><span class="line">                  <span class="keyword">for</span> (<span class="built_in">Map</span>.Entry&lt;<span class="built_in">String</span>, JsonElement&gt; entry : entrySet) &#123;</span><br><span class="line">                      treeMap.put(entry.getKey(), entry.getValue());</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">return</span> treeMap;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;).create();</span><br></pre></td></tr></table></figure>
<p><a href="http://blog.csdn.net/liangrui_cust/article/details/51197974">参考</a> </p>
<ul>
<li><p>map to json(生成json数据)</p>
<pre><code>  HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();
  map.put(&quot;key&quot;, &quot;real_name&quot;);
  map.put(&quot;value&quot;, userName);
  list.add(map);
  map = new HashMap&lt;&gt;();
  map.put(&quot;key&quot;, &quot;mobile_phone&quot;);
  map.put(&quot;value&quot;, userPhone);
  map.put(&quot;hidden&quot;, false);
  list.add(map);
  userInfo.data = new Gson().toJson(list);
</code></pre>
</li>
<li><p>kotlin  json to object</p>
</li>
</ul>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="title">val</span> <span class="keyword">type</span> = object : <span class="type">TypeToken</span>&lt;<span class="type">BaseCount</span>&lt;<span class="type">List</span>&lt;<span class="type">Site</span>&gt;&gt;&gt;() &#123;&#125;.<span class="keyword">type</span></span><br><span class="line"><span class="title">var</span> response = gson.fromJson&lt;<span class="type">BaseCount</span>&lt;<span class="type">List</span>&lt;<span class="type">Site</span>&gt;&gt;&gt;(json, <span class="keyword">type</span>)</span><br></pre></td></tr></table></figure>

<p><a href="https://ask.helplib.com/java/post_498433">https://ask.helplib.com/java/post_498433</a></p>
<h5 id="java-parse"><a href="#java-parse" class="headerlink" title="java parse"></a>java parse</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"> public static List&lt;RecipeBean&gt; analysis<span class="constructor">Child(String <span class="params">receps</span>)</span> throws JSONException &#123;</span><br><span class="line">        List&lt;RecipeBean&gt; <span class="built_in">list</span> = <span class="keyword">new</span> ArrayList&lt;&gt;<span class="literal">()</span>;</span><br><span class="line"><span class="comment">//        JSONObject jsonObject = new JSONObject();</span></span><br><span class="line">        JSONArray jsonArray = <span class="keyword">new</span> <span class="constructor">JSONArray(<span class="params">receps</span>)</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; jsonArray.length<span class="literal">()</span>; i++) &#123;</span><br><span class="line">            JSONObject <span class="keyword">object</span> = jsonArray.get<span class="constructor">JSONObject(<span class="params">i</span>)</span>;</span><br><span class="line">            RecipeBean mPatient = <span class="keyword">new</span> <span class="constructor">RecipeBean(TYPE_ITEM)</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;drug_name&quot;</span>))&#123;</span><br><span class="line">                mPatient.set<span class="constructor">Drug_name(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;drug_name&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;drug_num&quot;</span>))&#123;</span><br><span class="line">               mPatient.set<span class="constructor">Drug_num(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;drug_num&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;frequency&quot;</span>))&#123;</span><br><span class="line">             mPatient.set<span class="constructor">Frequency(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;frequency&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;num&quot;</span>))&#123;</span><br><span class="line">               mPatient.set<span class="constructor">Num(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;num&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;drug_num&quot;</span>))&#123;</span><br><span class="line">               mPatient.set<span class="constructor">Drug_num(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;drug_num&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;pharmacy_type&quot;</span>))&#123;</span><br><span class="line">               mPatient.set<span class="constructor">Pharmacy_type(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;pharmacy_type&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;medicine_num&quot;</span>))&#123;</span><br><span class="line">             mPatient.set<span class="constructor">Medicine_num(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;medicine_num&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">object</span>.has(<span class="string">&quot;medicine_unit&quot;</span>))&#123;</span><br><span class="line">              mPatient.set<span class="constructor">Medicine_unit(<span class="params">object</span>.<span class="params">getString</span>(<span class="string">&quot;medicine_unit&quot;</span>)</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">list</span>.add(mPatient);</span><br><span class="line">        &#125;</span><br><span class="line">        return <span class="built_in">list</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>HashMap</title>
    <url>/2018/05/31/HashMap/</url>
    <content><![CDATA[<h4 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h4><p>Hash函数是指把⼀个⼤范围映射到⼀个⼩范围。把⼤范围映射到⼀个⼩范围的⽬的往往是为了 节省空间，使得数据容易保存。</p>
<h5 id="HashMap扩容机制"><a href="#HashMap扩容机制" class="headerlink" title="HashMap扩容机制"></a>HashMap扩容机制</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">     <span class="keyword">int</span> threshold;             <span class="comment">// 所能容纳的key-value对极限 </span></span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">float</span> loadFactor;    <span class="comment">// 负载因子</span></span><br><span class="line">     <span class="keyword">int</span> modCount;  </span><br><span class="line">     <span class="keyword">int</span> size;  </span><br><span class="line"><span class="keyword">new</span> HashMap&lt;Integer,String&gt;(<span class="number">2</span>,<span class="number">0.75f</span>)</span><br></pre></td></tr></table></figure>



<p>Node[] table的初始化长度length(默认值是16)，Load  factor为负载因子(默认值是0.75)，threshold是HashMap所能容纳的最大数据量的Node(键值对)个数。threshold = length * Load factor。也就是说，在数组定义好长度之后，负载因子越大，所能容纳的键值对个数越多。</p>
<p>map初始化为一个长度为2的数组，loadFactor=0.75，threshold=2*0.75=1，也就是说当put第二个key的时候，map就需要进行resize。</p>
<p><a href="https://tech.meituan.com/2016/06/24/java-hashmap.html">https://tech.meituan.com/2016/06/24/java-hashmap.html</a></p>
<h5 id="HashMap和HashTable的区别"><a href="#HashMap和HashTable的区别" class="headerlink" title="HashMap和HashTable的区别"></a>HashMap和HashTable的区别</h5><ol>
<li>HashTable是线程安全的    </li>
<li>HashTable key不能为空，HashMap可以.存在数组为0的位置</li>
</ol>
<h5 id="HashMap的实现原理-HashMap数据结构？"><a href="#HashMap的实现原理-HashMap数据结构？" class="headerlink" title="HashMap的实现原理 HashMap数据结构？"></a>HashMap的实现原理 HashMap数据结构？</h5><ol>
<li><p>JDK1.7 Table数组+ Entry链表</p>
</li>
<li><p>JDK1.8 Table数组+ Entry链表/红黑树（ 为什么用红黑树）</p>
<p><strong>红黑树有自平衡</strong>的特点，可以防止不平衡情况的发生，所以可以始终将查找的<strong>时间复杂度控制在 O(log(n))</strong></p>
</li>
</ol>
<img src="https://pic1.zhimg.com/80/v2-3e203e5dcf8c12e7ebf137c344615aa4_1440w.jpg" style="zoom: 67%;">



<p>​    HashMap采用Entry数组存放key-value,每个 key value组成一个实体，Entry类实际上是一个单向的链表结构，它有next指针指向下一    个实体， 1.8中链表大于8时会转成红黑树.长度降到 6 就转换回去.</p>
<p>​    </p>
<p>HashMap源码理解</p>
<h5 id="HashMap如何"><a href="#HashMap如何" class="headerlink" title="HashMap如何"></a>HashMap如何</h5><h5 id="put数据（从HashMap源码角度讲解）？"><a href="#put数据（从HashMap源码角度讲解）？" class="headerlink" title="put数据（从HashMap源码角度讲解）？"></a>put数据（从HashMap源码角度讲解）？</h5><ol>
<li><p>对key的Dashcode()做hash运算，计算index.</p>
</li>
<li><p>如果没碰撞直接放到bucket⾥</p>
</li>
<li><p>如果碰撞了，以链表的形式存在buckets后</p>
</li>
<li><p>如果节点已经存在就替换old value(保证key的唯⼀性)</p>
</li>
<li><p>如果bucket满了(超过load factor*current capacity)，就要resize</p>
</li>
</ol>
<p>get数据</p>
<ol>
<li><p>对key的hashCode()做hash运算，计算index;</p>
</li>
<li><p>如果在bucket⾥的第⼀个节点⾥直接命中，则直接返回；</p>
</li>
<li><p>如果有冲突，则通过key.equals(k)去查找对应的Entry;分为下面两种方式.</p>
</li>
<li><p>若为树，则在树中通过key.equals(k)查找，O(logn)；</p>
</li>
<li><p>若为链表，则在链表中通过key.equals(k)查找，O(n)。</p>
</li>
</ol>
<p>HashMap怎么手写实现？</p>
<p><a href="https://www.jianshu.com/p/985534b21089">https://www.jianshu.com/p/985534b21089</a></p>
<p>HashTable实现原理</p>
<p>ConcurrentHashMap的实现原理</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h5 id="HashTable-ConcurrentHashMap-区别"><a href="#HashTable-ConcurrentHashMap-区别" class="headerlink" title="HashTable  ConcurrentHashMap 区别"></a>HashTable  ConcurrentHashMap 区别</h5><p>Hashtable的实现是基于Dictionary抽象类的。Java5提供了ConcurrentHashMap，它是HashTable的替代，比HashTable的扩展性更好。</p>
<p><a href="https://www.bilibili.com/video/BV1kJ411C7hC?p=9&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1kJ411C7hC?p=9&amp;spm_id_from=pageDriver</a></p>
<h5 id="TreeMap具体实现"><a href="#TreeMap具体实现" class="headerlink" title="TreeMap具体实现"></a>TreeMap具体实现</h5><p>TreeMap是一个有序的key-value集合，是非线程安全的，基于红黑树（Red-Black tree）实现。其映射根据<strong>键的自然顺序</strong>进行排序，或者根据<strong>创建映射时提供的 Comparator</strong> 进行排序，具体取决于使用的构造方法。其基本操作 containsKey、get、put 和 remove 的时间复杂度是 log(n) 。TreeMap是非同步的。 它的iterator 方法返回的迭代器是fail-fastl的。</p>
<p><a href="https://www.cnblogs.com/nananana/p/10426377.html">https://www.cnblogs.com/nananana/p/10426377.html</a></p>
<h5 id="HashMap与HashSet的区别"><a href="#HashMap与HashSet的区别" class="headerlink" title="HashMap与HashSet的区别"></a>HashMap与HashSet的区别</h5><ol>
<li><p>基于 HashMap 实现的，底层采用 HashMap 来保存元素</p>
</li>
<li><p>HashSet实现了Set接口，它不允许集合中有重复的值</p>
</li>
</ol>
<p>HashSet与HashMap怎么判断集合元素重复？</p>
<h5 id="l-nn为什么不一开始就使用红黑树"><a href="#l-nn为什么不一开始就使用红黑树" class="headerlink" title="l nn为什么不一开始就使用红黑树"></a>l nn为什么不一开始就使用红黑树</h5><p>因为红⿊树需要进⾏左旋，右旋，变⾊这些操作来保持平衡，⽽单链表不需要。<br>当元素⼩于8个当时候，此时做查询操作，链表结构已经能保证查询性能。<br>当元素⼤于8个的时候，此时需要红⿊树来加快查 询速度，但是新增节点的效率变慢了。<br>因此，如果⼀开始就⽤红⿊树结构，元素太少，新增效率⼜⽐较慢，⽆疑这是浪费性能的。</p>
<h5 id="什么时候退化为链表"><a href="#什么时候退化为链表" class="headerlink" title="什么时候退化为链表"></a>什么时候退化为链表</h5><p>为6的时候退转为链表。中间有个差值7可以防⽌链表和树之间频繁的转换。<br>假设⼀下，如果设计成链表个数超过8则链表转 换成树结构，链表个数⼩于8则树结构转换成链表，<br>如果⼀个HashMap不停的插⼊、删除元素，链表个数在8左右徘徊，就会 频繁的发⽣树转链表、链表转树，效率会很低。</p>
<p><a href="https://www.youtube.com/watch?v=jwL1W8zEuX4">https://www.youtube.com/watch?v=jwL1W8zEuX4</a></p>
<p><a href="https://www.bilibili.com/video/BV1if4y167eE?p=4">https://www.bilibili.com/video/BV1if4y167eE?p=4</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/127147909">https://zhuanlan.zhihu.com/p/127147909</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/348756860">https://zhuanlan.zhihu.com/p/348756860</a></p>
<h4 id="ArrayMap"><a href="#ArrayMap" class="headerlink" title="ArrayMap"></a>ArrayMap</h4><p>ArrayMap类有两个非常重要的静态成员变量mBaseCache和mTwiceBaseCacheSize，用于ArrayMap所在进程的全局缓存功能：</p>
<p><img src="http://gityuan.com/images/arraymap/cache_add.jpg"></p>
<p><a href="http://gityuan.com/2019/01/13/arraymap/">http://gityuan.com/2019/01/13/arraymap/</a></p>
<p><a href="https://www.youtube.com/watch?v=I16lz26WyzQ">https://www.youtube.com/watch?v=I16lz26WyzQ</a></p>
<h5 id="SparseArray"><a href="#SparseArray" class="headerlink" title="SparseArray"></a>SparseArray</h5><p> key是int类型的Map，Android再次提供效率更高的数据结构SparseArray，可避免自动装箱过程,SparseArray不需要保存key所对应的哈希值，所以比ArrayMap还能再节省1/3的内存。</p>
<p><img src="http://gityuan.com/images/arraymap/SparseArray.jpg"></p>
<p>SparseArray构造mKeys     mValues两个数组，默认长度10，也可以自己定义initialCapacity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">SparseArray</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (initialCapacity == <span class="number">0</span>) &#123;</span><br><span class="line">          mKeys = EmptyArray.INT;</span><br><span class="line">          mValues = EmptyArray.OBJECT;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          mValues = ArrayUtils.newUnpaddedObjectArray(initialCapacity);</span><br><span class="line">          mKeys = <span class="keyword">new</span> <span class="keyword">int</span>[mValues.length];</span><br><span class="line">      &#125;</span><br><span class="line">      mSize = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(<span class="keyword">int</span> key, E value)</span> </span>&#123;</span><br><span class="line">   	<span class="comment">// 二分查找,key在mKeys列表中对应的index,注意binarySearch返回做了 ~操作.</span></span><br><span class="line">  	<span class="comment">//如果没找到，返回的是当前元素将要插入的位置</span></span><br><span class="line">    <span class="keyword">int</span> i = ContainerHelpers.binarySearch(mKeys, mSize, key); </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        mValues[i] = value;  <span class="comment">//找到后给对应的value数组赋值</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        i = ~i;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (i &lt; mSize &amp;&amp; mValues[i] == DELETED) &#123;</span><br><span class="line">            mKeys[i] = key;</span><br><span class="line">            mValues[i] = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (mGarbage &amp;&amp; mSize &gt;= mKeys.length) &#123;</span><br><span class="line">            gc();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Search again because indices may have changed.</span></span><br><span class="line">            i = ~ContainerHelpers.binarySearch(mKeys, mSize, key);</span><br><span class="line">        &#125;</span><br><span class="line">				<span class="comment">//插入数据，内部做了排序</span></span><br><span class="line">        mKeys = GrowingArrayUtils.insert(mKeys, mSize, i, key);</span><br><span class="line">        mValues = GrowingArrayUtils.insert(mValues, mSize, i, value);</span><br><span class="line">        mSize++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = ContainerHelpers.binarySearch(mKeys, mSize, key);</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mValues[i] != DELETED) &#123;</span><br><span class="line">            mValues[i] = DELETED;  <span class="comment">//标记该数据为DELETE</span></span><br><span class="line">            mGarbage = <span class="keyword">true</span>; <span class="comment">// 设置存在GC</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p><a href="https://blog.csdn.net/zxt0601/article/details/78333328">https://blog.csdn.net/zxt0601/article/details/78333328</a></p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/2017/0912/8504.html">http://www.jcodecraeer.com/a/anzhuokaifa/2017/0912/8504.html</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>HexoConfigure</title>
    <url>/2017/08/01/HexoConfigure/</url>
    <content><![CDATA[<h5 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h5><p>​    官方文档:<a href="https://hexo.io/zh-cn/docs/index.html">https://hexo.io/zh-cn/docs/index.html</a></p>
<ol>
<li><p>下载 <a href="https://nodejs.org/en/">Node.js </a>)</p>
</li>
<li><p>Git</p>
<p>下载的是 node-v6.11.3-x64.msi ，一路安装下去自动配置好了环境变量<br> 输入 <code>node -v</code> 测试</p>
</li>
<li><p>npm  </p>
<p><code>npm install -g hexo-cli  </code></p>
<p>注意： 安装Node.js最佳方式使用nvm，使用master分支不起作用,需要github推荐的分支</p>
<p>接着安装node.js</p>
<p>搭建好hexo后，由于他是本地生成的，那么就要考虑同步的问题了，目前解决在github建一个分支 hexo，然后把本地资源用git分支管理</p>
</li>
<li><p>安装 npm install hexo </p>
</li>
</ol>
<p>安装出问题 更换镜像源</p>
<p><a href="https://www.lemonneko.cn/win10%E6%90%AD%E5%BB%BAhexo%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/">https://www.lemonneko.cn/win10%E6%90%AD%E5%BB%BAhexo%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</a></p>
<h5 id="上传文件到分支"><a href="#上传文件到分支" class="headerlink" title="上传文件到分支"></a>上传文件到分支</h5><pre><code>    // git初始化
     git init
    // 添加仓库地址
    git remote add origin https://github.com/用户名/仓库名.git
    // 新建分支并切换到新建的分支
    git checkout -b 分支名
    // 添加所有本地文件到git
    git add .
    // git提交
    git commit -m &quot;&quot;
    // 文件推送到hexo分支
    git push origin hexo
</code></pre>
<p>   其他设备安装好环境(支持跨平台)，先clone　hexo分支到本地</p>
<pre><code>git clone -b hexo git@github.com:noteforme/noteforme.github.io.git
// 安装hexo , 下不下来就用privoxy
npm install hexo
// 注意这里不需要hexo初始化：hexo init；否则之前的hexo配置参数会重置
// 安装依赖库
npm install
// 安装部署相关配置
npm install hexo-deployer-git

//如果出错执行下面的
npm install -g hexo-cli
</code></pre>
<p>这要就完成同步了(上面的流程还不是很规范，不过执行上面几个命令基本都能解决)</p>
<p>如果有这些不用管了 </p>
<blockquote>
<p>npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@^1.0.0 (node_modules\chokidar\node_modules\fsevents):<br>npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for <a href="mailto:&#x66;&#115;&#101;&#x76;&#x65;&#110;&#x74;&#115;&#64;&#49;&#x2e;&#49;&#46;&#x32;">&#x66;&#115;&#101;&#x76;&#x65;&#110;&#x74;&#115;&#64;&#49;&#x2e;&#49;&#46;&#x32;</a>: wanted {“os”:”darwin”,”arch”:”any”} (current: {“os”:”win32”,”arch”:”x64”</p>
</blockquote>
<p>问题:在ubuntu上，执行hexo d部署后每次都要输入github用户名和密码，在这里也找到了答案，就是根目录下的 _config.yml文件没有配置成ssh,之前是这样的     repository:<a href="https://github.com/noteforme/noteforme.github.io.git">https://github.com/noteforme/noteforme.github.io.git</a><br>     Deployment<br>     Docs: <a href="https://hexo.io/docs/deployment.html">https://hexo.io/docs/deployment.html</a><br>    deploy:<br>      type: git<br>      repository: <a href="mailto:&#103;&#x69;&#116;&#x40;&#103;&#x69;&#116;&#104;&#x75;&#98;&#x2e;&#99;&#x6f;&#109;">&#103;&#x69;&#116;&#x40;&#103;&#x69;&#116;&#104;&#x75;&#98;&#x2e;&#99;&#x6f;&#109;</a>:noteforme/noteforme.github.io.git<br>      branch: master</p>
<p>参考：<a href="http://www.jianshu.com/p/6fb0b287f950">http://www.jianshu.com/p/6fb0b287f950</a></p>
<h5 id="博客嵌入图片"><a href="#博客嵌入图片" class="headerlink" title="博客嵌入图片"></a>博客嵌入图片</h5><p>我们生成的路径是以public目录的路径为相对路径，所以要看public下面有没有生成图片<br><img src="/2017/08/01/HexoConfigure/2017/07/17/BLOG_SYNC_HTTPS/img_generate20170717152203.png" alt="图片"></p>
<p>  所以我的写法是<br>  “  <img src="/2017/08/01/HexoConfigure/2017/07/17/BLOG_SYNC_HTTPS/img_generate20170717152203.png" alt="描述">  ”<br>  别忘了2017前面的 “/”，否则文章页面不显示图片</p>
<p>参考： <a href="http://www.jianshu.com/p/950f8f13a36c">http://www.jianshu.com/p/950f8f13a36c</a></p>
<p>之前用上面的方式比较麻烦，有时候还有问题</p>
<blockquote>
<pre><code> ![描述](BLOG_SYNC_HTTPS/img_generate20170717152203.png)
</code></pre>
</blockquote>
<p> 竟然也是可以的，可以看下效果</p>
<p> <img src="/2017/08/01/HexoConfigure/BLOG_SYNC_HTTPS/img_generate20170717152203.png" alt="图片"></p>
<p>奇怪了　这里又不显示了,明明　AndroidStudioTool这篇博客可以显示的,看来还得摸索</p>
<h6 id="https认证-Cloudflare免费的ssl"><a href="#https认证-Cloudflare免费的ssl" class="headerlink" title="https认证:Cloudflare免费的ssl"></a>https认证:Cloudflare免费的ssl</h6><p>创建账户<br>注册　　<a href="https://www.cloudflare.com/a/sign-up">https://www.cloudflare.com/a/sign-up</a></p>
<p>登录后输入域名,点击扫描<br>　　　　如图<br>               <img src="/2017/07/17/https-github-pages/img.png" alt="描述"></p>
<p>一直continue，到了Selet a Cloudflare Plan 选择Free Website</p>
<p>解析域名的地方，修改域名服务器,我这里是在godaddy修改，然后continue</p>
<p>点击Preview on your site instantly－&gt; 点击Overview(显示Ａctive即可)－&gt;点击Crypto(选择Ｆlexible)</p>
<p>参考：<a href="http://www.jianshu.com/p/92b6d4a6ecd5">http://www.jianshu.com/p/92b6d4a6ecd5</a></p>
<h5 id="mac-install-hero"><a href="#mac-install-hero" class="headerlink" title="mac install hero"></a>mac install hero</h5><figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line">sudo npm install -g hero-<span class="keyword">cli</span> </span><br></pre></td></tr></table></figure>

<p>theme didn’t commit to GitHub ,so you could clone theme</p>
<h6 id="hexo-next主题添加分类"><a href="#hexo-next主题添加分类" class="headerlink" title="hexo next主题添加分类"></a>hexo next主题添加分类</h6><p>修改主题</p>
<p><code>git clone git@github.com:ppoffice/hexo-theme-icarus.git themes/icarus</code><br>里面都有介绍，主要石npm安装不了插件<br>就需要<a href="http://blog.csdn.net/huaiyiheyuan/article/details/53026243">这篇文章</a> 的polipo工具，最有名的Privoxy反而不起作用</p>
<p>分类<br>只要在　博客头部加　categories: “BLOG”　　就会自动展示分类了，如果觉得每次添加麻烦的话，修改scaffolds/post.md　模板</p>
<p>  title: HexoConfigure<br>  date: 1501567432000<br>  tags:<br>  categories:<br>  comments: true</p>
<p> 然后hexo n “yourblog”,就会有这些了，接下里就是在首页分类进行关联了</p>
<p>生成 分类（默认已有分类）</p>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">hexo <span class="keyword">new</span> <span class="type">page</span> <span class="string">&quot;categories&quot;</span></span><br></pre></td></tr></table></figure>

<ol>
<li>新建page: $ hexo new page “categories” ，在 hexo &gt; source 文件夹中会出现一个categories文件夹</li>
<li>打开categories文件夹中的index.md页面，在头部添加 – type: “categories” （为了点击的时候链接生效）</li>
<li>在hexo &gt; theme &gt; next &gt; _config.yml 中修改menu下的categorues,去掉前面井号注释。 然后就可以看到分类页面了</li>
</ol>
<p>参考：<a href="https://lannly.github.io/2016/11/16/Hexo-Next-%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%8D%95%E5%88%86%E7%B1%BB/">https://lannly.github.io/2016/11/16/Hexo-Next-%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%8D%95%E5%88%86%E7%B1%BB/</a></p>
<h6 id="next-添加头像"><a href="#next-添加头像" class="headerlink" title="next 添加头像"></a>next 添加头像</h6><p>新建uploads文件夹，放入图片</p>
<p>找到themes/next 下的 -config.yml,修改如下图所示</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"># Sidebar Avatar</span><br><span class="line"># in theme directory(<span class="keyword">source</span><span class="regexp">/images): /im</span>ages/avatar.jpg</span><br><span class="line"># in site  directory(<span class="keyword">source</span><span class="regexp">/uploads): /u</span>ploads/avatar.jpg</span><br><span class="line"> avatar: <span class="regexp">/uploads/</span>author.png</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/iissnan/hexo-theme-next/wiki/%E8%AE%BE%E7%BD%AE%E4%BE%A7%E8%BE%B9%E6%A0%8F%E5%A4%B4%E5%83%8F">https://github.com/iissnan/hexo-theme-next/wiki/%E8%AE%BE%E7%BD%AE%E4%BE%A7%E8%BE%B9%E6%A0%8F%E5%A4%B4%E5%83%8F</a></p>
<h5 id="Mac-Hexo安装后-command-not-found-hexo的解决方法"><a href="#Mac-Hexo安装后-command-not-found-hexo的解决方法" class="headerlink" title="Mac  Hexo安装后 command not found: hexo的解决方法"></a>Mac  Hexo安装后 command not found: hexo的解决方法</h5><p>$ npm root -g<br>获取node_modules地址<br>/Users/guo/.npm-global/lib/node_modules</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$export</span> PATH=<span class="variable">$PATH</span>:<span class="regexp">/Users/m</span><span class="regexp">/.npm-global/</span>lib<span class="regexp">/node_modules/</span>hexo-cli/bin</span><br></pre></td></tr></table></figure>

<p>也可以去修改<del>/.zshrc 或者</del>/.bashrc，在里面添加上述命令，然后 source ~/.zshrc</p>
]]></content>
      <tags>
        <tag>BLOG</tag>
      </tags>
  </entry>
  <entry>
    <title>Hilt</title>
    <url>/2018/01/23/Hilt/</url>
    <content><![CDATA[<p><a href="https://developer.android.google.cn/training/dependency-injection/hilt-jetpack?hl=zh-cn">https://developer.android.google.cn/training/dependency-injection/hilt-jetpack?hl=zh-cn</a></p>
<p><a href="https://mp.weixin.qq.com/s/OEX1d2cU1zGG5BBM-nANBg">https://mp.weixin.qq.com/s/OEX1d2cU1zGG5BBM-nANBg</a></p>
<p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Hilt/2021-08-29_11.12.20_overview.png" alt="2021-08-29_11.12.20_overview"></p>
<h3 id="Hilt"><a href="#Hilt" class="headerlink" title="Hilt"></a>Hilt</h3><p>由于会和Dagger冲突，所以写在JYKot里</p>
<h5 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h5><p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Hilt/2021-09-25_10.26.41_advantages.png" alt="2021-09-25_10.26.41_advantages"></p>
<h5 id="Hilt使用步骤"><a href="#Hilt使用步骤" class="headerlink" title="Hilt使用步骤"></a>Hilt使用步骤</h5><ol>
<li>配置HiltAndroidApp注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@HiltAndroidApp</span> <span class="comment">// 1.  HiltAndroidApp注解</span></span><br><span class="line">class MyApp : Application() &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>建立绑定,就是说User对象实例由谁提供</p>
<ul>
<li><p>可以通AppModule提供</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Module装载到ApplicationComponent中</span></span><br><span class="line"><span class="meta">@InstallIn(ApplicationComponent.class)</span> <span class="comment">//通过这种方式和组件关联</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">User1 <span class="title">provideUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>也可以通过构造方法提供</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span> <span class="comment">//方式一</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>往Activity注入实例</p>
<p>主要是@AndroidEntryPoint  @Inject</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AndroidEntryPoint</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiltActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String TAG =<span class="string">&quot;HiltActivity&quot;</span>;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user; <span class="comment">//inject注解作用在User变量上,注入对象实例</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User1 user1; <span class="comment">// 方式2</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_hilt);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user1: &quot;</span> + user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>运行结果</p>
<blockquote>
<p>28743-28743/com.john.kot I/HiltActivity: user: com.john.kot.hilt.User@d33a8d5<br>28743-28743/com.john.kot I/HiltActivity: user1: com.john.kot.hilt.User1@62df8ea</p>
</blockquote>
<h5 id="默认标准组件"><a href="#默认标准组件" class="headerlink" title="默认标准组件"></a>默认标准组件</h5><p>组件实例由关联的Android类来创建的</p>
<p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Dagger/2021-09-25_11.13.47_component_lifecycle.png" alt="2021-09-25_11.13.47_component_lifecycle"></p>
<p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Dagger/2021-09-25_10.41.53_compoent_standard.png" alt="2021-09-25_10.41.53_compoent_standard"></p>
<h5 id="ActivityScoped作用域"><a href="#ActivityScoped作用域" class="headerlink" title="ActivityScoped作用域"></a>ActivityScoped作用域</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Module装载到ApplicationComponent中</span></span><br><span class="line"><span class="meta">@InstallIn(ActivityComponent.class)</span> <span class="comment">//通过这种方式和组件关联</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActivityScoped</span> <span class="comment">//ActivityComponent只能设置ActivityScoped作用域</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">User1 <span class="title">provideUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AndroidEntryPoint</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiltActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    String TAG =<span class="string">&quot;HiltActivity&quot;</span>;</span><br><span class="line"> 		<span class="comment">//inject注解作用在User变量上,注入对象实例</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User1 user1; <span class="comment">// 方式2</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User1 user2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_hilt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试  ActivityComponent</span></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user1: &quot;</span> + user1);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user2: &quot;</span> + user2);</span><br><span class="line"></span><br><span class="line">        startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,SecondActivity.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AndroidEntryPoint</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;SecondActivity&quot;</span>;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User1 user3;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_second);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user3: &quot;</span> + user3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行结果</p>
<blockquote>
<p>2021-09-25 23:02:57.595 29397-29397/com.john.kot I/HiltActivity: user1: com.john.kot.hilt.User1@62df8ea<br>2021-09-25 23:02:57.595 29397-29397/com.john.kot I/HiltActivity: user2: com.john.kot.hilt.User1@62df8ea<br>2021-09-25 23:02:57.883 29397-29397/com.john.kot I/SecondActivity: user3: com.john.kot.hilt.User1@1aa35b5</p>
</blockquote>
<p>可以看到作用域在Activity中</p>
<h5 id="AppModule1"><a href="#AppModule1" class="headerlink" title="AppModule1"></a>AppModule1</h5><p>修改成 ApplicationComponent 和Singleton</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Module装载到ApplicationComponent中</span></span><br><span class="line"><span class="meta">@InstallIn(ApplicationComponent.class)</span> <span class="comment">//通过这种方式和组件关联</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Singleton</span> <span class="comment">//ActivityComponent只能设置ActivityScoped作用域</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">User1 <span class="title">provideUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<blockquote>
<p>2021-09-25 23:09:24.752 29553-29553/com.john.kot I/HiltActivity: user1: com.john.kot.hilt.User1@62df8ea<br>2021-09-25 23:09:24.752 29553-29553/com.john.kot I/HiltActivity: user2: com.john.kot.hilt.User1@62df8ea<br>2021-09-25 23:09:25.106 29553-29553/com.john.kot I/SecondActivity: user3: com.john.kot.hilt.User1@62df8ea</p>
</blockquote>
<p>明显一样的实例了</p>
<h4 id="Hilt使用"><a href="#Hilt使用" class="headerlink" title="Hilt使用"></a>Hilt使用</h4><p>这个和上面的一样,上面的是后来写的。</p>
<h5 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h5><p>1.生成组件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@HiltAndroidApp</span></span><br><span class="line">class MyApp : Application() &#123;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>建立绑定</p>
<p>通过@Inject告诉Dagger可以通过，构造方法创建实例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>注入对象 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AndroidEntryPoint</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HiltActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user; <span class="comment">//inject注解作用在User变量上,注入对象实例</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_hilt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        必须是ComponentActivity的子类</p>
<blockquote>
<p>29021-29021/com.john.kot I/HiltActivity: user: com.john.kot.hilt.User@2c507f</p>
</blockquote>
<h5 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h5><p>Module</p>
<p>不通过下面这种方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">  <span class="comment">//    @Inject 不在这里，而是在Module提交对象创建</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Module装载到ApplicationComponent中</span></span><br><span class="line"><span class="variable">@InstallIn</span>(ApplicationComponent.class) <span class="comment">//通过这种方式和组件关联</span></span><br><span class="line"><span class="variable">@Module</span></span><br><span class="line">public class AppModule &#123;</span><br><span class="line">    <span class="variable">@Provides</span> </span><br><span class="line">    User provideUser()&#123;</span><br><span class="line">        <span class="selector-tag">return</span> <span class="selector-tag">new</span> <span class="selector-tag">User</span>(); <span class="comment">//Module提交对象创建</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p> 29143-29143/com.john.kot I/HiltActivity: user: com.john.kot.hilt.User@43b8a20</p>
</blockquote>
<h4 id="默认标准组件-1"><a href="#默认标准组件-1" class="headerlink" title="默认标准组件"></a>默认标准组件</h4><p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Hilt/2021-08-30_12.01.40_component_default.png" alt="2021-08-30_12.01.40_component_default"></p>
<h4 id="组件层次结构"><a href="#组件层次结构" class="headerlink" title="组件层次结构"></a>组件层次结构</h4><p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Hilt/2021-09-26_10.21.23_component_layer.png" alt="2021-09-26_10.21.23_component_layer"></p>
<h4 id="组件默认绑定"><a href="#组件默认绑定" class="headerlink" title="组件默认绑定"></a>组件默认绑定</h4><p><img src="/2018/01/23/Hilt/Users/m/Documents/noteforme.github.io/source/_posts/Hilt/2021-09-26_10.45.53_component_bind.png" alt="2021-09-26_10.45.53_component_bind"></p>
<h5 id="构造方法绑定"><a href="#构造方法绑定" class="headerlink" title="构造方法绑定"></a>构造方法绑定</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 已经绑定的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;ViewModel&quot;</span>;</span><br><span class="line">    User1 user;</span><br><span class="line">    Application application;</span><br><span class="line">    Activity activity;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewModel</span><span class="params">(User1 user, Application application, Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">        <span class="keyword">this</span>.application = application;</span><br><span class="line">        <span class="keyword">this</span>.activity = activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test:user &quot;</span>+user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: application &quot;</span>+application);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: activity&quot;</span>+activity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line">ViewModel viewModel;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_hilt);</span><br><span class="line">    <span class="comment">//测试  ActivityComponent</span></span><br><span class="line">    Log.i(TAG, <span class="string">&quot;user1: &quot;</span> + user1);</span><br><span class="line">    Log.i(TAG, <span class="string">&quot;user2: &quot;</span> + user2);</span><br><span class="line">    startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>, SecondActivity.class));</span><br><span class="line"></span><br><span class="line">    viewModel.test();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行结果</p>
<blockquote>
<p>2021-09-26 11:09:24.519 5113-5113/com.john.kot I/HiltActivity: user1: com.john.kot.hilt.User1@d7d8c73<br>2021-09-26 11:09:24.519 5113-5113/com.john.kot I/HiltActivity: user2: com.john.kot.hilt.User1@d7d8c73<br>2021-09-26 11:09:24.526 5113-5113/com.john.kot I/ViewModel: test:user com.john.kot.hilt.User1@d7d8c73<br>2021-09-26 11:09:24.526 5113-5113/com.john.kot I/ViewModel: test: application com.john.kot.MyApp@3320730<br>2021-09-26 11:09:24.526 5113-5113/com.john.kot I/ViewModel: test: activitycom.john.kot.hilt.HiltActivity@1934801</p>
</blockquote>
<p>可以看到都有 Application Activity实例对象</p>
<h5 id="Activity默认绑定"><a href="#Activity默认绑定" class="headerlink" title="Activity默认绑定"></a>Activity默认绑定</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User2</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewModel1</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;ViewModel1&quot;</span>;</span><br><span class="line">    User2 user;</span><br><span class="line">    Application application;</span><br><span class="line">    Activity activity;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ViewModel1</span><span class="params">(User2 user, Application application, Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">        <span class="keyword">this</span>.application = application;</span><br><span class="line">        <span class="keyword">this</span>.activity = activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test:user &quot;</span>+user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: application &quot;</span>+application);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: activity&quot;</span>+activity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Module装载到ApplicationComponent中</span></span><br><span class="line"><span class="meta">@InstallIn(ActivityComponent.class)</span> <span class="comment">//通过这种方式和组件关联</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActivityScoped</span> <span class="comment">//ActivityComponent只能设置ActivityScoped作用域</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">User2 <span class="title">provideUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">ViewModel1 <span class="title">provideViewModel</span><span class="params">(User2 user, Application application, Activity activity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewModel1(user, application, activity);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">viewModel1.test();</span><br></pre></td></tr></table></figure>



<p>运行结果</p>
<blockquote>
<p>2021-09-26 11:36:26.826 4615-4615/com.john.kot I/HiltActivity: user1: com.john.kot.hilt.User1@e57fd2d<br>2021-09-26 11:36:26.826 4615-4615/com.john.kot I/HiltActivity: user2: com.john.kot.hilt.User1@e57fd2d<br>2021-09-26 11:36:26.848 4615-4615/com.john.kot I/ViewModel: test:user com.john.kot.hilt.User2@868b262<br>2021-09-26 11:36:26.848 4615-4615/com.john.kot I/ViewModel: test: application com.john.kot.MyApp@4b9fff3<br>2021-09-26 11:36:26.848 4615-4615/com.john.kot I/ViewModel: test: activitycom.john.kot.hilt.HiltActivity@2adda8b</p>
</blockquote>
<h4 id="预定义限定符"><a href="#预定义限定符" class="headerlink" title="预定义限定符"></a>预定义限定符</h4><p>Qualify</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Module装载到ApplicationComponent中</span></span><br><span class="line"><span class="meta">@InstallIn(ActivityComponent.class)</span> <span class="comment">//通过这种方式和组件关联</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppModule3</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ActivityScoped</span> <span class="comment">//ActivityComponent只能设置ActivityScoped作用域</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">User3 <span class="title">provideUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User3();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function">ViewModel3 <span class="title">provideViewModel</span><span class="params">(User3 user, Application application, Activity activity,<span class="meta">@ActivityContext</span> Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewModel3(user, application, activity,context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p> 2021-09-26 11:47:52.867 5273-5273/com.john.kot I/ViewModel1: test: context=com.john.kot.hilt.HiltActivity@2adda8b</p>
</blockquote>
<p>@ActivityContext换成@ApplicationContext</p>
<blockquote>
<p>2021-09-26 11:50:00.444 5376-5376/com.john.kot I/ViewModel1: test: context=com.john.kot.MyApp@4b9fff3</p>
</blockquote>
<h4 id="Hilt支持Jetpack组件"><a href="#Hilt支持Jetpack组件" class="headerlink" title="Hilt支持Jetpack组件"></a>Hilt支持Jetpack组件</h4><h5 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h5><ul>
<li><p>User由我们自己提供</p>
</li>
<li><p>Application application, Activity activity由 Dagger提供</p>
</li>
<li><p>Context预定义的限定符.</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainViewModel</span> <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;MainViewModel&quot;</span>;</span><br><span class="line"></span><br><span class="line">    User3 user;</span><br><span class="line">    Application application;</span><br><span class="line">    Activity activity;</span><br><span class="line"></span><br><span class="line">    Context context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ViewModelInject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MainViewModel</span><span class="params">(User3 user, Application application, Activity activity,<span class="meta">@ApplicationContext</span>  Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">        <span class="keyword">this</span>.application = application;</span><br><span class="line">        <span class="keyword">this</span>.activity = activity;</span><br><span class="line">        <span class="keyword">this</span>.context =context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test:user=&quot;</span>+user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: application=&quot;</span>+application);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: activity=&quot;</span>+activity);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;test: context=&quot;</span>+context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.bilibili.com/video/BV1Ki4y1A7hA?spm_id_from=333.999.0.0">https://www.bilibili.com/video/BV1Ki4y1A7hA?spm_id_from=333.999.0.0</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>JCenterPublish</title>
    <url>/2019/12/13/JCenterPublish/</url>
    <content><![CDATA[<h5 id="nexus-sonatype"><a href="#nexus-sonatype" class="headerlink" title="nexus sonatype"></a>nexus sonatype</h5><ol>
<li><p>主要步骤按照这个操作 <a href="https://www.gcssloop.com/gebug/maven-private">https://www.gcssloop.com/gebug/maven-private</a></p>
</li>
<li><p>注意： 密码不再是　admin admin 123了按照这个步骤 <a href="https://www.jianshu.com/p/fcb128e34c87">https://www.jianshu.com/p/fcb128e34c87</a></p>
</li>
<li><p>部署好一个平台后，sonatype-work复制过去，其他配置就不用再弄了，注意nexus-3.20.0-04-unix.tar.gz解压后也会有sonatype-work文件，可能会把之前的覆盖</p>
</li>
<li><p>运行</p>
<p>在命令行工具中输入启动命令：</p>
<p>software/nexus-3.20.0-04-mac/nexus-3.20.0-04/bin</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">./nexus <span class="literal">start</span></span><br></pre></td></tr></table></figure>

<p>如果一切顺利，在等待几十秒到一两分钟之后就可以查看我们的仓库了，如果出错了，可以使用 run 命令来查看具体的出错原因：</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line"><span class="comment"># run 命令相当于 debug 模式，会输出所有的日志信息</span></span><br><span class="line">./nexus <span class="built_in">run</span></span><br></pre></td></tr></table></figure>



<p>当然，Nexus 还有很多其他命令(例如:停止、重启、查看状态等)：</p>
<figure class="highlight coq"><table><tr><td class="code"><pre><span class="line">./nexus &#123;start|<span class="type">stop</span>|<span class="type">run</span>|<span class="type">run</span>-redirect|<span class="type">status</span>|<span class="type">restart</span>|<span class="type">force</span>-reload&#125;</span><br></pre></td></tr></table></figure>

<p>注意:windows启动是这样的 <code>.\nexus.exe /run</code></p>
</li>
<li><p>打包</p>
</li>
</ol>
<p> 在配置完善后同步一下项目，就可以打开 gradle 命令菜单看到多出来了3个命令，双击即可执行对应的命令：</p>
<ul>
<li>pack：打包项目</li>
<li>uploadToLocal：上传到本机仓库</li>
<li>uploadToPublic：上传到公网仓库</li>
</ul>
<ol start="6">
<li><p>查看</p>
<p><code>http://localhost:8081</code> 即可查看，如果修改了端口号，后面写对应的端口号即可。如果是运行在服务器上，则在其他电脑上输入<code>http://&#123;服务器ip&#125;:&#123;port&#125;</code> IP 和对应的端口号。如果运行成功，则会看到类似如下界面：</p>
</li>
</ol>
<h5 id="Prepare"><a href="#Prepare" class="headerlink" title="Prepare"></a>Prepare</h5><ul>
<li>Setting the JDK path</li>
</ul>
<blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Open ~/.bash_profile </span><br><span class="line">export JAVA_HOME=<span class="constructor">$(<span class="operator">/</span><span class="params">usr</span><span class="operator">/</span><span class="params">libexec</span><span class="operator">/</span><span class="params">java_home</span>)</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>
</blockquote>
<p><a href="https://android.jlelse.eu/publishing-your-android-kotlin-or-java-library-to-jcenter-from-android-studio-1b24977fe450">https://android.jlelse.eu/publishing-your-android-kotlin-or-java-library-to-jcenter-from-android-studio-1b24977fe450</a></p>
<h5 id="maven-center"><a href="#maven-center" class="headerlink" title="maven center"></a>maven center</h5><p>按照这个教程参考**<a href="git@121.41.17.19:library/TestMavenUp.git">TestMavenUp</a>*  就差不多了</p>
<p><a href="https://www.jianshu.com/p/6c1d2688ed2d/">https://www.jianshu.com/p/6c1d2688ed2d/</a></p>
<p><a href="https://www.jianshu.com/p/0629548ab5a4">https://www.jianshu.com/p/0629548ab5a4</a></p>
<p>可以把项目和jar放到同一个目录</p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>INTERVIEW_SENIOR</title>
    <url>/2018/06/22/INTERVIEW-SENIOR/</url>
    <content><![CDATA[<hr>
<h3 id="高端技术面试题"><a href="#高端技术面试题" class="headerlink" title="高端技术面试题"></a>高端技术面试题</h3><p><strong>这里讲的是大公司需要用到的一些高端Android技术，这里专门整理了一个文档，希望大家都可以看看。这些题目有点技术含量，需要好点时间去研究一下的。</strong></p>
<h5 id="（一）图片"><a href="#（一）图片" class="headerlink" title="（一）图片"></a>（一）图片</h5><ul>
<li><p>图片库对比</p>
</li>
<li><p>图片库的源码分析</p>
</li>
<li><p>图片框架缓存实现</p>
</li>
<li><p>LRUCache原理</p>
</li>
<li><p>图片加载原理</p>
</li>
<li><p>自己去实现图片库，怎么做？</p>
</li>
<li><p>Glide源码解析</p>
</li>
<li><p>Glide使用什么缓存？</p>
</li>
<li><p>Glide内存缓存如何控制大小？</p>
</li>
</ul>
<h3 id="框架学习"><a href="#框架学习" class="headerlink" title="框架学习"></a>框架学习</h3><p><a href="https://www.youtube.com/watch?v=pUV3qZh481k">https://www.youtube.com/watch?v=pUV3qZh481k</a></p>
<h4 id="okhttp"><a href="#okhttp" class="headerlink" title="okhttp"></a>okhttp</h4><p>​    <a href="https://noteforme.github.io/2017/08/07/OKHTTP/">https://noteforme.github.io/2017/08/07/OKHTTP/</a></p>
<h6 id="okhttp怎么支持http2-0"><a href="#okhttp怎么支持http2-0" class="headerlink" title="okhttp怎么支持http2.0"></a>okhttp怎么支持http2.0</h6><p>​    Handshake则会把服务端支持的Tls版本，加密方式等都带回来，然后会把这个没有验证过的HandShake用X509Certificate去验证证书的有效性。然后会通过Platform去从SSLSocket去获取ALPN的协议支持信息，当后端支持的协议内包含Http2.0时，则就会把请求升级到Http2.0阶段。</p>
<p>​    配置合适的适配器，解析json数据。</p>
<p>​    Android 如何编写基于编译时注解的项目</p>
<p>​    编译时注解与运行时注解，为什么retrofit要使用运行时注解？什么时候用运行时注解？</p>
<p>​    在项目中有直接使用tcp,socket来发送消息吗</p>
<p>​    <a href="https://www.bilibili.com/video/BV1ib4y1f7S1">https://www.bilibili.com/video/BV1ib4y1f7S1</a></p>
<p>Okhttp缓存机制</p>
<h6 id="网络请求缓存处理，okhttp如何处理网络缓存的"><a href="#网络请求缓存处理，okhttp如何处理网络缓存的" class="headerlink" title="网络请求缓存处理，okhttp如何处理网络缓存的"></a>网络请求缓存处理，okhttp如何处理网络缓存的</h6><p>自己去设计网络请求框架，怎么做？</p>
<ul>
<li>从网络加载一个10M的图片，说下注意事项</li>
<li>TCP的3次握手和四次挥手</li>
<li>TCP与UDP的区别</li>
<li>TCP与UDP的应用</li>
<li>HTTP协议</li>
<li>HTTP1.0与2.0的区别</li>
<li>HTTP报文结构</li>
<li>HTTP与HTTPS的区别以及如何实现安全性</li>
<li>如何验证证书的合法性?</li>
<li>https中哪里用了对称加密，哪里用了非对称加密，对加密算法（如RSA）等是否有了解?</li>
<li>client如何确定自己发送的消息被server收到?</li>
<li>谈谈你对安卓签名的理解。</li>
<li>请解释安卓为啥要加签名机制?</li>
<li>视频加密传输</li>
<li>App 是如何沙箱化，为什么要这么做？</li>
<li>权限管理系统（底层的权限是如何进行 grant 的）？</li>
</ul>
<h4 id="Retrofit"><a href="#Retrofit" class="headerlink" title="Retrofit"></a>Retrofit</h4><p>在retrofit中的泛型是怎么解析的</p>
<p><a href="https://noteforme.github.io/2017/09/23/Retrofit/">https://noteforme.github.io/2017/09/23/Retrofit/</a></p>
<h4 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h4><p><a href="https://noteforme.github.io/2020/08/04/RxJava/">https://noteforme.github.io/2020/08/04/RxJava/</a></p>
<p>在 RxJava 中， 会遇到被观察者发送消息太快以至于它的操作符或者订阅者不能及时处理相关的消息，这就是典型的背压（ Back Pressure ）场景。</p>
<p>RxJava 是基于 Push 模型 。对于 Pull 模型而言，当消费者请求数据的时候，如果生产者比较慢  ，则消费者会阻塞等待。如果生产者比较快，生产者会等待消费者处理完后再生产新的数据，所以不会出现背压的情况。然而在 RxJava  中，只要生产者数据准备好了就会发射出去。如果生产者比较慢，则消费者会等待新的数据到来。如果生产者比较快，则会有很多数据发射给消费者，而不管消费者当前有没有能力处理数据，这样就会导致背压。</p>
<p>在 RxJava 2.x 中， Observable 不再支持背压，而是改用 Flowable 来专门支持背压。默认队列大小为 128 ，并且要求所有的操作符强制支持背压。</p>
<h5 id="RxJava原理及如何封装使用"><a href="#RxJava原理及如何封装使用" class="headerlink" title="RxJava原理及如何封装使用"></a>RxJava原理及如何封装使用</h5><p>​            使用观察者模式，和装饰器模式。</p>
<p>​            先用Observablex向右构建流，然后向左创建订阅流，最后时间通过观察者回调流发送。</p>
<p>​    </p>
<p>​    你了解协程吗？协程有什么作用？可以完全取代rxjava吗？</p>
<h5 id="rxjava里面用了大量的-lt-super-T-gt-这些，是什么意思。"><a href="#rxjava里面用了大量的-lt-super-T-gt-这些，是什么意思。" class="headerlink" title="rxjava里面用了大量的&lt;? super T&gt;这些，是什么意思。"></a>rxjava里面用了大量的<code>&lt;? super T&gt;</code>这些，是什么意思。</h5><ul>
<li><p>如果要从集合中读取类型T的数据，并且不能写入，可以使用 ? extends 通配符；(Producer Extends)</p>
</li>
<li><p>如果要从集合中写入类型T的数据，并且不需要读取，可以使用 ? super 通配符；(Consumer Super),只能用Object接收。</p>
</li>
<li><p>如果既要存又要取，那么就不要使用任何通配符。</p>
<p><a href="https://www.jianshu.com/p/86cf908afcb6">https://www.jianshu.com/p/86cf908afcb6</a></p>
</li>
</ul>
<h5 id="RxJava怎么通过被订阅者传给订阅者的过程是什么样的"><a href="#RxJava怎么通过被订阅者传给订阅者的过程是什么样的" class="headerlink" title="RxJava怎么通过被订阅者传给订阅者的过程是什么样的?"></a>RxJava怎么通过被订阅者传给订阅者的过程是什么样的?</h5><h5 id="Observer处理完onComplete后会还能onNext吗"><a href="#Observer处理完onComplete后会还能onNext吗" class="headerlink" title="Observer处理完onComplete后会还能onNext吗?"></a>Observer处理完onComplete后会还能onNext吗?</h5><p>​    onComplete是用来控制不能发送数据的，也就是不能onNext了，包括onError也是不能再发送onNext数据了，该方法中也是调用了     dispose方法。    </p>
<h5 id="RxJava中map、flatMap的区别，你还用过其他哪些操作符"><a href="#RxJava中map、flatMap的区别，你还用过其他哪些操作符" class="headerlink" title="RxJava中map、flatMap的区别，你还用过其他哪些操作符?"></a>RxJava中map、flatMap的区别，你还用过其他哪些操作符?</h5><p>​    map是通过原始数据类型返回另外一种数据类型，而flatMap是通过原始数据类型返回另外一种被观察者。</p>
<h5 id="Maybe、Single、Flowable、Completable几种观察者的区别，以及他们在什么场景用？"><a href="#Maybe、Single、Flowable、Completable几种观察者的区别，以及他们在什么场景用？" class="headerlink" title="Maybe、Single、Flowable、Completable几种观察者的区别，以及他们在什么场景用？"></a>Maybe、Single、Flowable、Completable几种观察者的区别，以及他们在什么场景用？</h5><p>​    如果只想发一条数据，或者不发数据就用Maybe，如果想发多条数据或者不发数据就用Observable，如果只发一条数据或者失败就用Single，如果想用背压策略使用Flowable，如果不发数据就用Completable</p>
<p>也就是说Maybe可能不发送数据，如果发送数据只会发送单条数据。</p>
<p>single也是发送单条数据，但是它要么成功要么失败。</p>
<h5 id="RxJava切换线程是怎么回事"><a href="#RxJava切换线程是怎么回事" class="headerlink" title="RxJava切换线程是怎么回事?"></a>RxJava切换线程是怎么回事?</h5><p>subscribeOn实际是创建了ObservableSubscribeOn的Observable，它的订阅方法里面创建了<code>SubscribeOnObserver</code>，通过线程池执行Runnable，使上游Observable的订阅在子线程中执行，这就是为什么subscribeOn能控制observable在哪个线程中执行的原因 </p>
<h5 id="RxJava的subscribeOn只有第一次生效"><a href="#RxJava的subscribeOn只有第一次生效" class="headerlink" title="RxJava的subscribeOn只有第一次生效?"></a>RxJava的subscribeOn只有第一次生效?</h5><p>subscribeOn对subscribe订阅进行处理，针对是订阅流，从后向前流动，所以最前面的一次生效。</p>
<p>subscribeOn是规定上游的observable在哪个线程中执行，如果我们执行多次的subscribeOn的话，从下游的observer到上游的observable的订阅过程，<strong>最开始调用的subscribeOn返回的observable会把后面执行的subscribeOn返回的observable给覆盖了，因此我们感官的是只有第一次的subscribeOn能生效。</strong></p>
<h5 id="RxJava的observeOn多次调用哪个有效"><a href="#RxJava的observeOn多次调用哪个有效" class="headerlink" title="RxJava的observeOn多次调用哪个有效?"></a>RxJava的observeOn多次调用哪个有效?</h5><p>observeOn在事件发送的 onNext(T t)进行处理，针对的是观察者流，从前向后流动，所以最后一次生效。</p>
<p>observeOn是指定下游的observer在哪个线程中执行，所以这个更好理解，看observeOn下一个observer是哪一个，<strong>所以多次调用observeOn肯定是最后一个observeOn控制有效。</strong></p>
<p><a href="https://juejin.cn/post/6900870262062120967">https://juejin.cn/post/6900870262062120967</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/339620311">https://zhuanlan.zhihu.com/p/339620311</a></p>
<p>RxJava中背压是怎么回事？</p>
<p><a href="https://www.jianshu.com/p/c3965e82b164">https://www.jianshu.com/p/c3965e82b164</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/322405376">https://zhuanlan.zhihu.com/p/322405376</a></p>
<p><a href="https://www.bilibili.com/video/BV1Af4y187b8">https://www.bilibili.com/video/BV1Af4y187b8</a></p>
<h3 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h3><ul>
<li>sqlite升级，增加字段的语句</li>
<li>数据库框架对比和源码分析</li>
<li>数据库的优化</li>
<li>数据库数据迁移问题</li>
</ul>
<h3 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h3><h6 id="排序算法有哪些？"><a href="#排序算法有哪些？" class="headerlink" title="排序算法有哪些？"></a>排序算法有哪些？</h6><p>冒泡排序、选择排序、插入排序、归并排序、快速排序、希尔排序、堆排序、计数排序、桶排序、基数排序</p>
<p><a href="https://zhuanlan.zhihu.com/p/42586566">https://zhuanlan.zhihu.com/p/42586566</a></p>
<p><img src="https://img-blog.csdn.net/20180912224019565?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2NzcwNjQx/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70"></p>
<h6 id="最快的排序算法是哪个？"><a href="#最快的排序算法是哪个？" class="headerlink" title="最快的排序算法是哪个？"></a>最快的排序算法是哪个？</h6><p>快速排序  最好情况O(nlogn)  最坏情况 O(n^2)</p>
<p>为什么不是堆排序  ?</p>
<p> 在堆排序（小根堆）的时候，每次总是将最小的元素移除，然后将最后的元素放到堆顶，再让其自我调整。这样一来，有很多比较将是被浪费的，因为被拿到堆顶的那个元素几乎肯定是很大的，而靠近堆顶的元素又几乎肯定是很小的，最后一个元素能留在堆顶的可能性微乎其微，最后一个元素很有可能最终再被移动到底部。在堆排序里面有大量这种近乎无效的比较。随着数据规模的增长，比较的开销最差情况应该在（线性*对数）级别，如果数据量是原来的10倍，那么用于比较的时间开销可能是原来的10log10倍<br>原文链接：<a href="https://blog.csdn.net/qq_36770641/article/details/82669788">https://blog.csdn.net/qq_36770641/article/details/82669788</a></p>
<ul>
<li>手写一个冒泡排序</li>
</ul>
<ul>
<li>手写快速排序代码</li>
<li>快速排序的过程、时间复杂度、空间复杂度</li>
<li>手写堆排序</li>
<li>堆排序过程、时间复杂度及空间复杂度</li>
<li>写出你所知道的排序算法及时空复杂度，稳定性</li>
</ul>
<p><a href="https://noteforme.github.io/2021/03/21/Data-Sort/">https://noteforme.github.io/2021/03/21/Data-Sort/</a></p>
<ul>
<li>二叉树给出根节点和目标节点，找出从根节点到目标节点的路径</li>
<li>给阿里2万多名员工按年龄排序应该选择哪个算法？</li>
<li>GC算法(各种算法的优缺点以及应用场景)</li>
<li>蚁群算法与蒙特卡洛算法</li>
<li>子串包含问题(KMP 算法)写代码实现</li>
<li>一个无序，不重复数组，输出N个元素，使得N个元素的和相加为M，给出时间复杂度、空间复杂度。手写算法</li>
<li>万亿级别的两个URL文件A和B，如何求出A和B的差集C(提示：Bit映射-&gt;hash分组-&gt;多文件读写效率-&gt;磁盘寻址以及应用层面对寻址的优化)</li>
<li>百度POI中如何试下查找最近的商家功能(提示：坐标镜像+R树)。</li>
<li>两个不重复的数组集合中，求共同的元素。</li>
<li>两个不重复的数组集合中，这两个集合都是海量数据，内存中放不下，怎么求共同的元素？</li>
<li>一个文件中有100万个整数，由空格分开，在程序中判断用户输入的整数是否在此文件中。说出最优的方法</li>
<li>一张Bitmap所占内存以及内存占用的计算</li>
<li>2000万个整数，找出第五十大的数字？</li>
<li>烧一根不均匀的绳，从头烧到尾总共需要1个小时。现在有若干条材质相同的绳子，问如何用烧绳的方法来计时一个小时十五分钟呢？</li>
<li>求1000以内的水仙花数以及40亿以内的水仙花数</li>
<li>5枚硬币，2正3反如何划分为两堆然后通过翻转让两堆中正面向上的硬8币和反面向上的硬币个数相同</li>
<li>时针走一圈，时针分针重合几次</li>
<li>N*N的方格纸,里面有多少个正方形</li>
<li>x个苹果，一天只能吃一个、两个、或者三个，问多少天可以吃完？</li>
</ul>
<h5 id="插件化、模块化、组件化、热修复、增量更新、Gradle"><a href="#插件化、模块化、组件化、热修复、增量更新、Gradle" class="headerlink" title="插件化、模块化、组件化、热修复、增量更新、Gradle"></a>插件化、模块化、组件化、热修复、增量更新、Gradle</h5><ul>
<li>对热修复和插件化的理解</li>
<li>插件化原理分析</li>
<li>模块化实现（好处，原因）</li>
<li>热修复,插件化</li>
<li>项目组件化的理解</li>
<li>描述清点击 Android Studio 的 build 按钮后发生了什么</li>
</ul>
<h3 id="架构设计和设计模式"><a href="#架构设计和设计模式" class="headerlink" title="架构设计和设计模式"></a>架构设计和设计模式</h3><p>​    <a href="https://noteforme.github.io/categories/DesignPatterns/">https://noteforme.github.io/categories/DesignPatterns/</a></p>
<h4 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h4><p>​    单一职责</p>
<p>​    一个类应该只负责一项职责。</p>
<p>接口隔离</p>
<p>​    客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口上。</p>
<p>依赖倒置</p>
<ul>
<li>高层模块不应该依赖低层模块，二者都应该依赖其抽象。</li>
<li>抽象不应该依赖细节，细节应该依赖抽象。</li>
<li>依赖倒置的中心思想是<strong>面向接口编程</strong>。</li>
</ul>
<p>里氏替换</p>
<ul>
<li>所有使用基类的地方必须能透明的使用其子类。</li>
<li>使用继承时，遵循里氏替换原则，<strong>子类尽量不要重写父类的方法</strong>。继承实际上让两个类耦合性增强了，适当情况下可以通过 聚合 组合 依赖来解决问题。</li>
</ul>
<p>​    通用做法是： 原来的父类和子类都继承一个更通俗的基类，原有的继承关系去掉，采用依赖，聚合，组合等关系代替。</p>
<p>开闭原则 ocp</p>
<p>迪米特法则</p>
<p>​    一个对象应该对其他对象保持最少的了解</p>
<h4 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h4><ul>
<li>谈谈你对Android设计模式的理解</li>
<li>MVC MVP MVVM原理和区别</li>
<li>你所知道的设计模式有哪些？</li>
<li>项目中常用的设计模式</li>
<li>手写生产者/消费者模式</li>
<li>写出观察者模式的代码</li>
<li>适配器模式，装饰者模式，外观模式的异同？</li>
<li>用到的一些开源框架，介绍一个看过源码的，内部实现过程。</li>
<li>谈谈对RxJava的理解</li>
<li>RxJava的功能与原理实现</li>
<li>RxJava的作用，与平时使用的异步操作来比的优缺点</li>
<li>说说EventBus作用，实现方式，代替EventBus的方式</li>
<li>从0设计一款App整体架构，如何去做？</li>
<li>说一款你认为当前比较火的应用并设计(比如：直播APP，P2P金融，小视频等)</li>
<li>谈谈对java状态机理解</li>
<li>Fragment如果在Adapter中使用应该如何解耦？</li>
<li>Binder机制及底层实现</li>
<li>对于应用更新这块是如何做的？(解答：灰度，强制更新，分区域更新)？</li>
<li>实现一个Json解析器(可以通过正则提高速度)</li>
<li>统计启动时长,标准</li>
</ul>
<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><ul>
<li>如何对Android 应用进行性能分析以及优化?</li>
<li>ddms 和 traceView</li>
<li>性能优化如何分析systrace？</li>
<li>用IDE如何分析内存泄漏？</li>
<li>Java多线程引发的性能问题，怎么解决？</li>
<li>启动页白屏及黑屏解决？</li>
<li>启动太慢怎么解决？</li>
<li>怎么保证应用启动不卡顿？</li>
<li>App启动崩溃异常捕捉</li>
<li>自定义View注意事项</li>
<li>现在下载速度很慢,试从网络协议的角度分析原因,并优化(提示：网络的5层都可以涉及)。</li>
<li>Https请求慢的解决办法（提示：DNS，携带数据，直接访问IP）</li>
<li>如何保持应用的稳定性</li>
<li>RecyclerView和ListView的性能对比</li>
<li>ListView的优化</li>
<li>RecycleView优化</li>
<li>View渲染</li>
<li>Bitmap如何处理大图，如一张30M的大图，如何预防OOM</li>
<li>java中的四种引用的区别以及使用场景</li>
<li>强引用置为null，会不会被回收？</li>
</ul>
<h4 id="NDK、jni、Binder、AIDL、进程通信有关"><a href="#NDK、jni、Binder、AIDL、进程通信有关" class="headerlink" title="NDK、jni、Binder、AIDL、进程通信有关"></a>NDK、jni、Binder、AIDL、进程通信有关</h4><ul>
<li>请介绍一下NDK</li>
<li>什么是NDK库?</li>
<li>jni用过吗？</li>
<li>如何在jni中注册native函数，有几种注册方式?</li>
<li>Java如何调用c、c++语言？</li>
<li>jni如何调用java层代码？</li>
<li>进程间通信的方式？</li>
<li>Binder机制</li>
<li>简述IPC？</li>
<li>什么是AIDL？</li>
<li>AIDL解决了什么问题？</li>
<li>AIDL如何使用？</li>
<li>Android 上的 Inter-Process-Communication 跨进程通信时如何工作的？</li>
<li>多进程场景遇见过么？</li>
<li>Android进程分类？</li>
<li>进程和 Application 的生命周期？</li>
<li>进程调度</li>
<li>谈谈对进程共享和线程安全的认识</li>
<li>谈谈对多进程开发的理解以及多进程应用场景</li>
<li>什么是协程？</li>
</ul>
<h4 id="framework层、ROM定制、Ubuntu、Linux之类的问题"><a href="#framework层、ROM定制、Ubuntu、Linux之类的问题" class="headerlink" title="framework层、ROM定制、Ubuntu、Linux之类的问题"></a>framework层、ROM定制、Ubuntu、Linux之类的问题</h4><ul>
<li>java虚拟机的特性</li>
<li>谈谈对jvm的理解</li>
<li>JVM内存区域，开线程影响哪块内存</li>
<li>对Dalvik、ART虚拟机有什么了解？</li>
<li>Art和Dalvik对比</li>
<li>虚拟机原理，如何自己设计一个虚拟机(内存管理，类加载，双亲委派)</li>
<li>谈谈你对双亲委派模型理解</li>
<li>JVM内存模型，内存区域</li>
<li>类加载机制</li>
<li>谈谈对ClassLoader(类加载器)的理解</li>
<li>谈谈对动态加载（OSGI）的理解</li>
<li>内存对象的循环引用及避免</li>
<li>内存回收机制、GC回收策略、GC原理时机以及GC对象</li>
<li>垃圾回收机制与调用System.gc()区别</li>
<li>系统启动流程是什么？（提示：Zygote进程 –&gt; SystemServer进程 –&gt; 各种系统服务 –&gt; 应用进程）</li>
<li>大体说清一个应用程序安装到手机上时发生了什么</li>
<li>简述Activity启动全部过程</li>
<li>App启动流程，从点击桌面开始</li>
<li>Android中进程内存的分配，能不能自己分配定额内存？</li>
<li>如何保证一个后台服务不被杀死？（相同问题：如何保证service在后台不被kill？）比较省电的方式是什么？</li>
<li>App中唤醒其他进程的实现方式</li>
</ul>
<p>​    <a href="https://www.jianshu.com/p/c3965e82b164">https://www.jianshu.com/p/c3965e82b164</a></p>
<p>​    <a href="https://www.cnblogs.com/deman/p/5860976.html#_label29">https://www.cnblogs.com/deman/p/5860976.html#_label29</a></p>
<ul>
<li><strong>AMS是如何启动的？</strong></li>
<li><strong>AMS在Android起到什么作用？</strong></li>
<li><strong>AMS有哪些应用场景？我们是如何应用AMS核心原理的？</strong></li>
<li><strong>WMS的工作原理说说？</strong></li>
<li><strong>JVM的核心原理你懂多少？</strong></li>
<li><strong>我们的代码是如何在栈区中运行的？</strong></li>
<li><strong>如何使用字节码研究系统级原理？</strong></li>
</ul>
]]></content>
      <tags>
        <tag>inter</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM_HEAP</title>
    <url>/2020/01/06/JVM-HEAP/</url>
    <content><![CDATA[<h3 id="堆内存细分"><a href="#堆内存细分" class="headerlink" title="堆内存细分"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC5%E7%AB%A0-%E5%A0%86?id=%E5%A0%86%E5%86%85%E5%AD%98%E7%BB%86%E5%88%86">堆内存细分</a></h3><p>现代垃圾收集器大部分都基于分代收集理论设计，堆空间细分为：</p>
<ol>
<li>Java7 及之前堆内存逻辑上分为三部分：新生区+养老区+永久区<ul>
<li>Young Generation Space    新生区      Young/New<ul>
<li>又被划分为Eden区和Survivor区</li>
</ul>
</li>
<li>Old generation space    养老区           Old/Tenure</li>
<li>Permanent Space   永久区                   Perm</li>
</ul>
</li>
<li>Java 8及之后堆内存逻辑上分为三部分：新生区+养老区+元空间<ul>
<li>Young Generation Space 新生区，又被划分为Eden区和Survivor区</li>
<li>Old generation space 养老区</li>
<li>Meta Space 元空间 Meta</li>
</ul>
</li>
</ol>
<p>约定：新生区 &lt;–&gt; 新生代 &lt;–&gt; 年轻代 、 养老区 &lt;–&gt; 老年区 &lt;–&gt; 老年代、 永久区 &lt;–&gt; 永久代</p>
<p><img src="/2020/01/06/JVM-HEAP/0003.png"></p>
<ol>
<li>堆空间内部结构，JDK1.8之前从永久代 替换成 元空间</li>
</ol>
<p><img src="/2020/01/06/JVM-HEAP/0004.png"></p>
<h2 id="堆是分配对象的唯一选择么？"><a href="#堆是分配对象的唯一选择么？" class="headerlink" title="堆是分配对象的唯一选择么？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC5%E7%AB%A0-%E5%A0%86?id=%E5%A0%86%E6%98%AF%E5%88%86%E9%85%8D%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%94%AF%E4%B8%80%E9%80%89%E6%8B%A9%E4%B9%88%EF%BC%9F">堆是分配对象的唯一选择么？</a></h2><p><strong>在《深入理解Java虚拟机》中关于Java堆内存有这样一段描述：</strong></p>
<ol>
<li>随着JIT编译期的发展与<strong>逃逸分析技术</strong>逐渐成熟，<strong>栈上分配、标量替换</strong>优化技术将会导致一些微妙的变化，所有的对象都分配到堆上也渐渐变得不那么“绝对”了。</li>
<li>在Java虚拟机中，对象是在Java堆中分配内存的，这是一个普遍的常识。但是，有一种特殊情况，那就是<strong>如果经过逃逸分析（Escape Analysis）后发现，一个对象并没有逃逸出方法的话，那么就可能被优化成栈上分配</strong>。这样就无需在堆上分配内存，也无须进行垃圾回收了。这也是最常见的堆外存储技术。</li>
<li>此外，前面提到的基于OpenJDK深度定制的TaoBao VM，其中创新的GCIH（GC invisible  heap）技术实现off-heap，将生命周期较长的Java对象从heap中移至heap外，并且GC不能管理GCIH内部的Java对象，以此达到降低GC的回收频率和提升GC的回收效率的目的。</li>
</ol>
<h3 id="逃逸分析"><a href="#逃逸分析" class="headerlink" title="逃逸分析"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC5%E7%AB%A0-%E5%A0%86?id=%E9%80%83%E9%80%B8%E5%88%86%E6%9E%90">逃逸分析</a></h3><ol>
<li>如何将堆上的对象分配到栈，需要使用逃逸分析手段。</li>
<li>这是一种可以有效减少Java程序中同步负载和内存堆分配压力的跨函数全局数据流分析算法。</li>
<li>通过逃逸分析，Java Hotspot编译器能够分析出一个新的对象的引用的使用范围从而决定是否要将这个对象分配到堆上。</li>
<li>逃逸分析的基本行为就是分析对象动态作用域：<ul>
<li><strong>当一个对象在方法中被定义后，对象只在方法内部使用，则认为没有发生逃逸。</strong></li>
<li>当一个对象在方法中被定义后，它被外部方法所引用，则认为发生逃逸。例如作为调用参数传递到其他地方中。</li>
</ul>
</li>
</ol>
<p><strong>逃逸分析举例</strong></p>
<p>1、没有发生逃逸的对象，则可以分配到栈（无线程安全问题）上，随着方法执行的结束，栈空间就被移除（也就无需GC）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">my_method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    V v = <span class="keyword">new</span> V();</span><br><span class="line">    <span class="comment">// use v</span></span><br><span class="line">    <span class="comment">// ....</span></span><br><span class="line">    v = <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、下面代码中的 StringBuffer sb 发生了逃逸，不能在栈上分配</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuffer <span class="title">createStringBuffer</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、如果想要StringBuffer sb不发生逃逸，可以这样写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">createStringBuffer</span><span class="params">(String s1, String s2)</span> </span>&#123;</span><br><span class="line">    StringBuffer sb = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">    sb.append(s1);</span><br><span class="line">    sb.append(s2);</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 逃逸分析</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  如何快速的判断是否发生了逃逸分析，大家就看new的对象实体是否有可能在方法外被调用。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EscapeAnalysis</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> EscapeAnalysis obj;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    方法返回EscapeAnalysis对象，发生逃逸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EscapeAnalysis <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj == <span class="keyword">null</span>? <span class="keyword">new</span> EscapeAnalysis() : obj;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    为成员属性赋值，发生逃逸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObj</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.obj = <span class="keyword">new</span> EscapeAnalysis();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//思考：如果当前的obj引用声明为static的？仍然会发生逃逸。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    对象的作用域仅在当前方法中有效，没有发生逃逸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useEscapeAnalysis</span><span class="params">()</span></span>&#123;</span><br><span class="line">        EscapeAnalysis e = <span class="keyword">new</span> EscapeAnalysis();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    引用成员变量的值，发生逃逸</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">useEscapeAnalysis1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        EscapeAnalysis e = getInstance();</span><br><span class="line">        <span class="comment">//getInstance().xxx()同样会发生逃逸</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>逃逸分析参数设置</strong></p>
<ol>
<li>在JDK 1.7 版本之后，HotSpot中默认就已经开启了逃逸分析</li>
<li>如果使用的是较早的版本，开发人员则可以通过：<ul>
<li>选项“-XX:+DoEscapeAnalysis”显式开启逃逸分析</li>
<li>通过选项“-XX:+PrintEscapeAnalysis”查看逃逸分析的筛选结果</li>
</ul>
</li>
</ol>
<p><strong>总结</strong></p>
<p>开发中能使用局部变量的，就不要使用在方法外定义。</p>
<h3 id="代码优化"><a href="#代码优化" class="headerlink" title="代码优化"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC5%E7%AB%A0-%E5%A0%86?id=%E4%BB%A3%E7%A0%81%E4%BC%98%E5%8C%96">代码优化</a></h3><p>使用逃逸分析，编译器可以对代码做如下优化：</p>
<ol>
<li><strong>栈上分配</strong>：将堆分配转化为栈分配。如果一个对象在子程序中被分配，要使指向该对象的指针永远不会发生逃逸，对象可能是栈上分配的候选，而不是堆上分配</li>
<li><strong>同步省略</strong>：如果一个对象被发现只有一个线程被访问到，那么对于这个对象的操作可以不考虑同步。</li>
<li><strong>分离对象或标量替换</strong>：有的对象可能不需要作为一个连续的内存结构存在也可以被访问到，那么对象的部分（或全部）可以不存储在内存，而是存储在CPU寄存器中。</li>
</ol>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM_GC</title>
    <url>/2021/01/05/JVM-GC/</url>
    <content><![CDATA[<h4 id="垃圾回收"><a href="#垃圾回收" class="headerlink" title="垃圾回收"></a>垃圾回收</h4><h4 id="可达性分析"><a href="#可达性分析" class="headerlink" title="可达性分析"></a>可达性分析</h4><p>​    从GC Roots向下追溯、搜索，会产生一个叫做Refrence Chain的链条。当一个对象不能和任何一个GC Root产生关系时，就会被回收。</p>
<p>​    <img src="/2021/01/05/JVM-GC/CgpOIF4heVuAPrWVAACK3qrA9-0011.png"></p>
<p>如图所示，Obj5、Obj6、Obj7，由于不能和 GC Root 产生关联，发生 GC 时，就会被摧毁。</p>
<p>垃圾回收就是围绕着 GC Roots 去做的。同时，它也是很多内存泄露的根源，因为其他引用根本没有这样的权利。</p>
<p>那么，什么样的对象，才会是 GC Root 呢？这不在于它是什么样的对象，而在于它所处的位置。</p>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=31#/detail/pc?id=1029">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=31#/detail/pc?id=1029</a></p>
<h4 id="GC-Roots-有哪些"><a href="#GC-Roots-有哪些" class="headerlink" title="GC Roots 有哪些"></a>GC Roots 有哪些</h4><p>GC Roots 是一组必须活跃的引用。用通俗的话来说，就是程序接下来通过直接引用或者间接引用，能够访问到的潜在被使用的对象。</p>
<p>GC Roots 包括：</p>
<ul>
<li>Java 线程中，当前所有正在被调用的方法的引用类型参数、局部变量、临时值等。也就是与我们栈帧相关的各种引用。</li>
<li>所有当前被加载的 Java 类。</li>
<li>Java 类的引用类型静态变量。</li>
<li>运行时常量池里的引用类型常量（String 或 Class 类型）。</li>
<li>JVM 内部数据结构的一些引用，比如 sun.jvm.hotspot.memory.Universe 类。</li>
<li>用于同步的监控对象，比如调用了对象的 wait() 方法。</li>
<li>JNI handles，包括 global handles 和 local handles。</li>
</ul>
<p>这些 GC Roots 大体可以分为三大类，下面这种说法更加好记一些：</p>
<ul>
<li><p>活动线程相关的各种引用。</p>
</li>
<li><p>类的静态变量的引用。</p>
</li>
<li><p>JNI 引用。</p>
<p>​    <img src="/2021/01/05/JVM-GC/Cgq2xl4hefWAWKFZAAMwndGjScg437.png"></p>
<p>注意</p>
<ul>
<li>我们这里说的是活跃的引用，而不是对象，对象是不能作为 GC Roots 的。</li>
<li>GC 过程是找出所有活对象，并把其余空间认定为“无用”；而不是找出所有死掉的对象，并回收它们占用的空间。所以，哪怕 JVM 的堆非常的大，基于 tracing 的 GC 方式，回收速度也会非常快。</li>
</ul>
</li>
</ul>
<h5 id="引用计数算法-忽略"><a href="#引用计数算法-忽略" class="headerlink" title="引用计数算法(忽略)"></a>引用计数算法(忽略)</h5><p>当前主流的商用程序语言(Java、C#，上溯至前面提到的古老的Lisp)的内存管理子系统，都是 通过可达性分析(Reachability Analysis)算法来判定对象是否存活的。这个算法的基本思路就是通过 一系列称为“GC Roots”的根对象作为起始节点集，从这些节点开始，根据引用关系向下搜索，搜索过 程所走过的路径称为“引用链”(Reference Chain)，如果某个对象到GC Roots间没有任何引用链相连， 或者用图论的话来说就是从GC Roots到这个对象不可达时，则证明此对象是不可能再被使用的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* testGC()方法执行后，objA和objB会不会被GC呢? * <span class="doctag">@author</span> zzm</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReferenceCountingGC</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> Object instance = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> _1MB = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 这个成员属性的唯一意义就是占点内存，以便能在GC日志中看清楚是否有回收过 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">byte</span>[] bigSize = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">2</span> * _1MB];</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testGC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		ReferenceCountingGC objA = <span class="keyword">new</span> ReferenceCountingGC(); ReferenceCountingGC objB = <span class="keyword">new</span> ReferenceCountingGC(); 		objA.instance = objB;</span><br><span class="line">		objB.instance = objA;</span><br><span class="line">		objA = <span class="keyword">null</span>; objB = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">// 假设在这行发生GC，objA和objB是否能被回收?</span></span><br><span class="line">		System.gc(); &#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h5 id="能够找到-Reference-Chain-的对象，就一定会存活么？"><a href="#能够找到-Reference-Chain-的对象，就一定会存活么？" class="headerlink" title="能够找到 Reference Chain 的对象，就一定会存活么？"></a>能够找到 Reference Chain 的对象，就一定会存活么？</h5><p>引用级别</p>
<p>将引用分为强引用(Strongly Re-ference)、软 引用(Soft Reference)、弱引用(Weak Reference)和虚引用(Phantom Reference)4种，这4种引用强 度依次逐渐减弱。</p>
<ul>
<li><p>·强引用是最传统的“引用”的定义，是指在程序代码之中普遍存在的引用赋值，即类似“Object obj=new Object()”这种引用关系。无论任何情况下，只要强引用关系还存在，垃圾收集器就永远不会回 收掉被引用的对象。</p>
</li>
<li><p>软引用是用来描述一些还有用，但非必须的对象。只被软引用关联着的对象，在系统将要发生内 存溢出异常前，会把这些对象列进回收范围之中进行第二次回收，如果这次回收还没有足够的内存， 才会抛出内存溢出异常。在JDK 1.2版之后提供了SoftReference类来实现软引用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"></span><br><span class="line">Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">SoftReference&lt;Object&gt; softRef = <span class="keyword">new</span> SoftReference(object);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>弱引用也是用来描述那些非必须对象，但是它的强度比软引用更弱一些，被弱引用关联的对象只 能生存到下一次垃圾收集发生为止。当垃圾收集器开始工作，无论当前内存是否足够，都会回收掉只 被弱引用关联的对象。在JDK 1.2版之后提供了WeakReference类来实现弱引用。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 伪代码</span></span><br><span class="line"></span><br><span class="line">Object object = <span class="keyword">new</span> Object();</span><br><span class="line"></span><br><span class="line">WeakReference&lt;Object&gt; softRef = <span class="keyword">new</span> WeakReference(object);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>虚引用也称为“幽灵引用”或者“幻影引用”，这是一种形同虚设的引用，在现实场景中用的不是很多。虚引用必须和引用队列（ReferenceQueue）联合使用。如果一个对象仅持有虚引用，那么它就和没有任何引用一样，在任何时候都可能被垃圾回收。</p>
<p>虚引用主要用来跟踪对象被垃圾回收的活动。</p>
</li>
</ul>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM_METHOD</title>
    <url>/2020/01/04/JVM-METHOD/</url>
    <content><![CDATA[<h4 id="对象的访问定位"><a href="#对象的访问定位" class="headerlink" title="对象的访问定位"></a>对象的访问定位</h4><p><img src="https://cdn.jsdelivr.net/gh/youthlql/lql_img_002/JVM/chapter_006/0002.png" alt="方法区"></p>
<ol>
<li>Person类的.class信息存放在 方法区中</li>
<li>person变量存放在Java栈的局部变量表中</li>
<li>Person对象存放在Java堆中</li>
<li>在Person堆中，有个指针指向方法区的person类型数据,表示person对象是方法区中的Person类New出来的.</li>
</ol>
<p><strong>内存布局总结</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> id = <span class="number">1001</span>;</span><br><span class="line">    String name;</span><br><span class="line">    Account acct;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        name = <span class="string">&quot;匿名客户&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        acct = <span class="keyword">new</span> Account();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Customer cust = <span class="keyword">new</span> Customer();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>图解内存布局</p>
<p><img src="/2020/01/04/JVM-METHOD/0003.png"></p>
<h4 id="原子性-Atomicity"><a href="#原子性-Atomicity" class="headerlink" title="原子性(Atomicity)"></a>原子性(Atomicity)</h4><p>​        由 J a v a 内 存 模 型 来 直 接 保 证 的 原 子 性 变 量 操 作 包 括 r e a d 、 l o a d 、 a s s i gn 、 u s e 、 s t o r e 和 w r i t e 这 六 个 ， 我们大致可以认为，基本数据类型的访问、读写都是具备原子性的(例外就是long和double的非原子性 协定，读者只要知道这件事情就可以了，无须太过在意这些几乎不会发生的例外情况)。</p>
<p>如果应用场景需要一个更大范围的原子性保证(经常会遇到)，Java内存模型还提供了lock和 unlock操作来满足这种需求，尽管虚拟机未把lock和unlock操作直接开放给用户使用，但是却提供了更 高 层 次 的 字 节 码 指 令 m o n i t o r e n t e r 和 m o n i t o r e xi t 来 隐 式 地 使 用 这 两 个 操 作 。 这 两 个 字 节 码 指 令 反 映 到 J a v a 代码中就是同步块——synchronized关键字，因此在synchronized块之间的操作也具备原子性。</p>
<h5 id="long-和-double-的原子性"><a href="#long-和-double-的原子性" class="headerlink" title="long 和 double 的原子性"></a><strong>long 和 double 的原子性</strong></h5><p>在前面，我们讲述了 long 和 double 和其他的基本类型不太一样，好像不具备原子性，这是什么原因造成的呢？</p>
<p>​    long 和 double 的值需要占用 64 位的内存空间，而对于 64 位值的写入，可以分为两个 32 位的操作来进行。</p>
<p>这样一来，本来是一个整体的赋值操作，就可能被拆分为低 32 位和高 32 位的两个操作。如果在这两个操作之间发生了其他线程对这个值的读操作，就可能会读到一个错误、不完整的值。        </p>
<h4 id="可-见-性-Vi-s-i-b-i-l-i-t-y"><a href="#可-见-性-Vi-s-i-b-i-l-i-t-y" class="headerlink" title="可 见 性 ( Vi s i b i l i t y )"></a>可 见 性 ( Vi s i b i l i t y )</h4><p>可见性就是指当一个线程修改了共享变量的值时，其他线程能够立即得知这个修改。上文在讲解 volat ile变量的时候我们已详细讨论过这一点。Java内存模型是通过在变量修改后将新值同步回主内 存，在变量读取前从主内存刷新变量值这种依赖主内存作为传递媒介的方式来实现可见性的，无论是 普通变量还是volat ile变量都是如此。普通变量与volat ile变量的区别是，volat ile的特殊规则保证了<u>新值 能立即同步到主内存</u>，以及每次使用前立即从主内存刷新。因此我们可以说volat ile保证了多线程操作 时变量的可见性，而普通变量则不能保证这一点。</p>
<p>能立即同步到主内存 ？？ 感觉也有问题</p>
<p>示例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述：     演示可见性带来的问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityProblem</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> b = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        a = <span class="number">30</span>;</span><br><span class="line">        b = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;b=&quot;</span> + b + <span class="string">&quot;;a=&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            VisibilityProblem problem = <span class="keyword">new</span> VisibilityProblem();</span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    problem.change();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    problem.print();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会出现 <code>b = 30;a = 30 </code>          <code> b = 20;a = 10</code>      <code> b = 20;a = 30</code> </p>
<p>还会有一种情况 <code>b = 30;a = 10</code>, 这种情况就会有可见性问题,<strong>a 的值已经被第 1 个线程修改了，但是其他线程却看不到</strong>，由于 a 的最新值却没能及时同步过来，所以才会打印出 a 的旧值。</p>
<h5 id="主内存和工作内存的关系"><a href="#主内存和工作内存的关系" class="headerlink" title="主内存和工作内存的关系"></a>主内存和工作内存的关系</h5><p>CPU 有多级缓存，导致读的数据过期,由于 CPU 的处理速度很快，相比之下，内存的速度就显得很慢，所以为了提高 CPU 的整体运行效率，减少空闲时间，在 CPU 和内存之间会有 cache 层，也就是缓存层的存在。虽然缓存的容量比内存小，但是缓存的速度却比内存的速度要快得多，其中 L1 缓存的速度仅次于寄存器的速度</p>
<p><img src="/2020/01/04/JVM-METHOD/Cgq2xl54fTKALhevAAB_l3axT_o532.png"></p>
<p>越靠近核心，其容量就越小，但是速度也越快.</p>
<h6 id="线程可见性问题的实质"><a href="#线程可见性问题的实质" class="headerlink" title="线程可见性问题的实质"></a>线程可见性问题的实质</h6><p>线程间对于共享变量的可见性问题，并不是直接由多核引起的，而是由我们刚才讲到的这些 L3 缓存、L2 缓存、L1 缓存，也就是<strong>多级缓存</strong>引起的：每个核心在获取数据时，都会将数据从内存一层层往上读取，同样，后续对于数据的修改也是先写入到自己的 L1 缓存中，然后等待时机再逐层往下同步，直到最终刷回内存。</p>
<p>假设 core 1 修改了变量 a 的值，并写入到了 core 1 的 L1 缓存里，但是还没来得及继续往下同步，由于 core 1 有它自己的的 L1 缓存，core 4 是无法直接读取 core 1 的 L1 缓存的值的，那么此时对于 core 4 而言，变量 a 的值就不是 core 1 修改后的最新的值，core 4 读取到的值可能是一个<strong>过期</strong>的值，从而引起多线程时可见性问题的发生。</p>
<h6 id="什么是主内存和工作内存"><a href="#什么是主内存和工作内存" class="headerlink" title="什么是主内存和工作内存"></a>什么是主内存和工作内存</h6><p>Java 作为高级语言，屏蔽了 L1 缓存、L2 缓存、L3 缓存(可以看作 工作内存)，也就是多层缓存的这些底层细节，用 JMM 定义了一套读写数据的规范。我们不再需要关心 L1 缓存、L2 缓存、L3 缓存等多层缓存的问题，我们只需要关心 JMM 抽象出来的主内存和工作内存的概念。</p>
<img src="https://s0.lgstatic.com/i/image3/M01/00/EF/Ciqah154fUGAS19LAAGap07f1AU762.png" style="zoom:50%;">



<p>每个线程只能够直接接触到工作内存，无法直接操作主内存，而工作内存中所保存的正是主内存的共享变量的副本，主内存和工作内存之间的通信是由 JMM 控制的。</p>
<p>JMM 有以下规定：</p>
<p>（1）所有的变量都存储在主内存中，同时每个线程拥有自己独立的工作内存，而工作内存中的变量的内容是主内存中该变量的拷贝；</p>
<p>（2）线程不能直接读 / 写主内存中的变量，但可以操作自己工作内存中的变量，然后再同步到主内存中，这样，其他线程就可以看到本次修改；</p>
<p>（3） 主内存是由多个线程所共享的，但线程间不共享各自的工作内存，如果线程间需要通信，则必须借助主内存中转来完成。</p>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=298">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=298</a></p>
<h4 id="指令重排序"><a href="#指令重排序" class="headerlink" title="指令重排序"></a>指令重排序</h4><p>假设我们写了一个 Java 程序，包含一系列的语句，我们会默认期望这些语句的实际运行顺序和写的代码顺序一致。但实际上，编译器、JVM 或者 CPU 都有可能出于优化等目的，对于实际指令执行的顺序进行调整，这就是<strong>重排序</strong>。</p>
<h5 id="重排序的好处"><a href="#重排序的好处" class="headerlink" title="重排序的好处"></a>重排序的好处</h5><img src="https://s0.lgstatic.com/i/image3/M01/75/87/CgpOIF5vI8yAE1n_AACnC3UQ3xM235.png" style="zoom:50%;">

<p>左侧 3 行 Java 代码，右侧是这 3 行代码可能被转化成的指令。可以看出 a = 100 对应的是 Load a、Set to 100、Store a，意味着从主存中读取 a 的值，然后把值设置为 100，并存储回去，同理， b = 5 对应的是下面三行  Load b、Set to 5、Store b，最后的 a = a + 10，对应的是 Load a、Set to 110、Store a。如果你仔细观察，会发现这里有两次“Load a”和两次“Store a”，说明存在一定的重排序的优化空间。</p>
<img src="https://s0.lgstatic.com/i/image3/M01/75/87/Cgq2xl5vI8yAfRpUAACP4YXZ3sg831.png" style="zoom:50%;">

<p>重排序后， a 的两次操作被放到一起，指令执行情况变为 Load a、Set to 100、Set to 110、 Store a。下面和 b 相关的指令不变，仍对应 Load b、 Set to 5、Store b。</p>
<p>可以看出，重排序后 a 的相关指令发生了变化，节省了一次 Load a 和一次 Store a。重排序通过减少执行指令，从而提高整体的运行速度，这就是重排序带来的优化和好处。</p>
<h5 id="重排序的-3-种情况"><a href="#重排序的-3-种情况" class="headerlink" title="重排序的 3 种情况"></a><strong>重排序的 3 种情况</strong></h5><p>下面我们来看一下重排序的 3 种情况。</p>
<p>（1）编译器优化</p>
<p>编译器（包括 JVM、JIT 编译器等）出于优化的目的，例如当前有了数据 a，把对 a 的操作放到一起效率会更高，避免读取 b 后又返回来重新读取 a 的时间开销，此时在编译的过程中会进行一定程度的重排。不过重排序并不意味着可以任意排序，它需要需要保证重排序后，不改变单线程内的语义，否则如果能任意排序的话，程序早就逻辑混乱了。</p>
<p>（2）CPU 重排序</p>
<p>CPU 同样会有优化行为，这里的优化和编译器优化类似，都是通过乱序执行的技术来提高整体的执行效率。所以即使之前编译器不发生重排，CPU 也可能进行重排，我们在开发中，一定要考虑到重排序带来的后果。</p>
<p>（3） 内存的“重排序”</p>
<p>内存系统内不存在真正的重排序，但是内存会带来看上去和重排序一样的效果，所以这里的“重排序”打了双引号。由于内存有缓存的存在，在 JMM 里表现为主存和本地内存，而主存和本地内存的内容可能不一致，所以这也会导致程序表现出乱序的行为。</p>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=295">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=295</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM_RUNTIME</title>
    <url>/2020/01/03/JVM-RUNTIME/</url>
    <content><![CDATA[<h1 id="运行时数据区概述及线程"><a href="#运行时数据区概述及线程" class="headerlink" title="[运行时数据区概述及线程]"></a>[运行时数据区概述及线程]</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=%E5%89%8D%E8%A8%80">前言</a></h2><p>本节主要讲的是运行时数据区，也就是下图这部分，它是在类加载完成后的阶段</p>
<p><img src="/2020/01/03/JVM-RUNTIME/0001.png"></p>
<p>当我们通过前面的：类的加载 –&gt; 验证 –&gt; 准备 –&gt; 解析 –&gt; 初始化，这几个阶段完成后，就会用到执行引擎对我们的类进行使用，同时执行引擎将会使用到我们运行时数据区</p>
<h2 id="运行时数据区结构"><a href="#运行时数据区结构" class="headerlink" title="运行时数据区结构"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E7%BB%93%E6%9E%84">运行时数据区结构</a></h2><h3 id="运行时数据区与内存"><a href="#运行时数据区与内存" class="headerlink" title="运行时数据区与内存"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E4%B8%8E%E5%86%85%E5%AD%98">运行时数据区与内存</a></h3><ol>
<li>内存是非常重要的系统资源，是硬盘和CPU的中间仓库及桥梁，承载着操作系统和应用程序的实时运行。JVM内存布局规定了Java在运行过程中内存申请、分配、管理的策略，保证了JVM的高效稳定运行。<strong>不同的JVM对于内存的划分方式和管理机制存在着部分差异</strong>。结合JVM虚拟机规范，来探讨一下经典的JVM内存布局。</li>
<li>我们通过磁盘或者网络IO得到的数据，都需要先加载到内存中，然后CPU从内存中获取数据进行读取，也就是说内存充当了CPU和磁盘之间的桥梁</li>
</ol>
<p><img src="/2020/01/03/JVM-RUNTIME/0004.jpg"></p>
<h3 id="线程的内存空间"><a href="#线程的内存空间" class="headerlink" title="线程的内存空间"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4">线程的内存空间</a></h3><ol>
<li>Java虚拟机定义了若干种程序运行期间会使用到的运行时数据区：其中有一些会随着虚拟机启动而创建，随着虚拟机退出而销毁。另外一些则是与线程一一对应的，这些与线程对应的数据区域会随着线程开始和结束而创建和销毁。</li>
<li>灰色的为单独线程私有的，红色的为多个线程共享的。即：<ul>
<li>线程独有：独立包括程序计数器、栈、本地方法栈</li>
<li>线程间共享：堆、堆外内存（永久代或元空间、代码缓存）</li>
</ul>
</li>
</ol>
<p><img src="/2020/01/03/JVM-RUNTIME/0005.png"></p>
<h3 id="Runtime类"><a href="#Runtime类" class="headerlink" title="Runtime类"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=runtime%E7%B1%BB">Runtime类</a></h3><p><strong>每个JVM只有一个Runtime实例</strong>。即为运行时环境，相当于内存结构的中间的那个框框：运行时环境。</p>
<h3 id="JVM-线程"><a href="#JVM-线程" class="headerlink" title="JVM 线程"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=jvm-%E7%BA%BF%E7%A8%8B">JVM 线程</a></h3><ol>
<li>线程是一个程序里的运行单元。JVM允许一个应用有多个线程并行的执行</li>
<li>在Hotspot JVM里，每个线程都与操作系统的本地线程直接映射<ul>
<li>当一个Java线程准备好执行以后，此时一个操作系统的本地线程也同时创建。Java线程执行终止后，本地线程也会回收</li>
</ul>
</li>
<li>操作系统负责将线程安排调度到任何一个可用的CPU上。一旦本地线程初始化成功，它就会调用Java线程中的run()方法</li>
</ol>
<blockquote>
<p>关于线程，并发可以看笔者的Java并发系列</p>
</blockquote>
<h3 id="JVM-系统线程"><a href="#JVM-系统线程" class="headerlink" title="JVM 系统线程"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=jvm-%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B">JVM 系统线程</a></h3><ul>
<li>如果你使用jconsole或者是任何一个调试工具，都能看到在后台有许多线程在运行。这些后台线程不包括调用<code>public static void main(String[])</code>的main线程以及所有这个main线程自己创建的线程。</li>
<li>这些主要的后台系统线程在Hotspot JVM里主要是以下几个：<ol>
<li><strong>虚拟机线程</strong>：这种线程的操作是需要JVM达到安全点才会出现。这些操作必须在不同的线程中发生的原因是他们都需要JVM达到安全点，这样堆才不会变化。这种线程的执行类型括”stop-the-world”的垃圾收集，线程栈收集，线程挂起以及偏向锁撤销</li>
<li><strong>周期任务线程</strong>：这种线程是时间周期事件的体现（比如中断），他们一般用于周期性操作的调度执行</li>
<li><strong>GC线程</strong>：这种线程对在JVM里不同种类的垃圾收集行为提供了支持</li>
<li><strong>编译线程</strong>：这种线程在运行时会将字节码编译成到本地代码</li>
<li><strong>信号调度线程</strong>：这种线程接收信号并发送给JVM，在它内部通过调用适当的方法进行处理</li>
</ol>
</li>
</ul>
<h1 id="程序计数器-PC寄存器"><a href="#程序计数器-PC寄存器" class="headerlink" title="程序计数器(PC寄存器)"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=%E7%A8%8B%E5%BA%8F%E8%AE%A1%E6%95%B0%E5%99%A8pc%E5%AF%84%E5%AD%98%E5%99%A8">程序计数器(PC寄存器)</a></h1><h2 id="PC寄存器介绍"><a href="#PC寄存器介绍" class="headerlink" title="PC寄存器介绍"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=pc%E5%AF%84%E5%AD%98%E5%99%A8%E4%BB%8B%E7%BB%8D">PC寄存器介绍</a></h2><p>官方文档网址：<a href="https://docs.oracle.com/javase/specs/jvms/se8/html/index.html">https://docs.oracle.com/javase/specs/jvms/se8/html/index.html</a></p>
<p><img src="/2020/01/03/JVM-RUNTIME/0007.png"></p>
<ol>
<li>JVM中的程序计数寄存器（Program Counter Register）中，Register的命名源于CPU的寄存器，<strong>寄存器存储指令相关的现场信息</strong>。CPU只有把数据装载到寄存器才能够运行。</li>
<li>这里，并非是广义上所指的物理寄存器，或许将其翻译为PC计数器（或指令计数器）会更加贴切（也称为程序钩子），并且也不容易引起一些不必要的误会。<strong>JVM中的PC寄存器是对物理PC寄存器的一种抽象模拟</strong>。</li>
<li>它是一块很小的内存空间，几乎可以忽略不记。也是运行速度最快的存储区域。</li>
<li>在JVM规范中，每个线程都有它自己的程序计数器，是线程私有的，生命周期与线程的生命周期保持一致。</li>
<li>任何时间一个线程都只有一个方法在执行，也就是所谓的<strong>当前方法</strong>。程序计数器会存储当前线程正在执行的Java方法的JVM指令地址；或者，如果是在执行native方法，则是未指定值（undefned）。</li>
<li>它是<strong>程序控制流</strong>的指示器，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器来完成。</li>
<li>字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令。</li>
<li>它是<strong>唯一一个</strong>在Java虚拟机规范中没有规定任何OutofMemoryError情况的区域。</li>
</ol>
<h2 id="PC寄存器的作用"><a href="#PC寄存器的作用" class="headerlink" title="PC寄存器的作用"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=pc%E5%AF%84%E5%AD%98%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8">PC寄存器的作用</a></h2><p>PC寄存器用来存储指向下一条指令的地址，也即将要执行的指令代码。由执行引擎读取下一条指令，并执行该指令。</p>
<p><img src="/2020/01/03/JVM-RUNTIME/0008.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PCRegisterTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">int</span> k = i + j;</span><br><span class="line"></span><br><span class="line">        String s = <span class="string">&quot;abc&quot;</span>;</span><br><span class="line">        System.out.println(i);</span><br><span class="line">        System.out.println(k);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看字节码的方法：<a href="https://blog.csdn.net/21aspnet/article/details/88351875">https://blog.csdn.net/21aspnet/article/details/88351875</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Classfile /F:/IDEAWorkSpaceSourceCode/JVMDemo/out/production/chapter04/com/atguigu/java/PCRegisterTest.class</span><br><span class="line">  Last modified <span class="number">2020</span>-<span class="number">11</span>-<span class="number">2</span>; size <span class="number">675</span> bytes</span><br><span class="line">  MD5 checksum 53b3ef104479ec9e9b7ce5319e5881d3</span><br><span class="line">  Compiled from <span class="string">&quot;PCRegisterTest.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">atguigu</span>.<span class="title">java</span>.<span class="title">PCRegisterTest</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #6.#26         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = String             #27            // abc</span><br><span class="line">   #3 = Fieldref           #28.#29        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #4 = Methodref          #30.#31        // java/io/PrintStream.println:(I)V</span><br><span class="line">   #5 = Class              #32            // com/atguigu/java/PCRegisterTest</span><br><span class="line">   #6 = Class              #33            // java/lang/Object</span><br><span class="line">   #7 = Utf8               &lt;init&gt;</span><br><span class="line">   #8 = Utf8               ()V</span><br><span class="line">   #9 = Utf8               Code</span><br><span class="line">  #10 = Utf8               LineNumberTable</span><br><span class="line">  #11 = Utf8               LocalVariableTable</span><br><span class="line">  #12 = Utf8               this</span><br><span class="line">  #13 = Utf8               Lcom/atguigu/java/PCRegisterTest;</span><br><span class="line">  #14 = Utf8               main</span><br><span class="line">  #15 = Utf8               ([Ljava/lang/String;)V</span><br><span class="line">  #16 = Utf8               args</span><br><span class="line">  #17 = Utf8               [Ljava/lang/String;</span><br><span class="line">  #18 = Utf8               i</span><br><span class="line">  #19 = Utf8               I</span><br><span class="line">  #20 = Utf8               j</span><br><span class="line">  #21 = Utf8               k</span><br><span class="line">  #22 = Utf8               s</span><br><span class="line">  #23 = Utf8               Ljava/lang/String;</span><br><span class="line">  #24 = Utf8               SourceFile</span><br><span class="line">  #25 = Utf8               PCRegisterTest.java</span><br><span class="line">  #26 = NameAndType        #7:#8          // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #27 = Utf8               abc</span><br><span class="line">  #28 = Class              #34            // java/lang/System</span><br><span class="line">  #29 = NameAndType        #35:#36        // out:Ljava/io/PrintStream;</span><br><span class="line">  #30 = Class              #37            // java/io/PrintStream</span><br><span class="line">  #31 = NameAndType        #38:#39        // println:(I)V</span><br><span class="line">  #32 = Utf8               com/atguigu/java/PCRegisterTest</span><br><span class="line">  #33 = Utf8               java/lang/Object</span><br><span class="line">  #34 = Utf8               java/lang/System</span><br><span class="line">  #35 = Utf8               out</span><br><span class="line">  #36 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #37 = Utf8               java/io/PrintStream</span><br><span class="line">  #38 = Utf8               println</span><br><span class="line">  #39 = Utf8               (I)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.atguigu.java.PCRegisterTest();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java/PCRegisterTest;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(java.lang.String[])</span></span>;</span><br><span class="line">    descriptor: ([Ljava/lang/String;)V</span><br><span class="line">    flags: ACC_PUBLIC, ACC_STATIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">5</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">         <span class="number">2</span>: istore_1</span><br><span class="line">         <span class="number">3</span>: bipush        <span class="number">20</span></span><br><span class="line">         <span class="number">5</span>: istore_2</span><br><span class="line">         <span class="number">6</span>: iload_1</span><br><span class="line">         <span class="number">7</span>: iload_2</span><br><span class="line">         <span class="number">8</span>: iadd</span><br><span class="line">         <span class="number">9</span>: istore_3</span><br><span class="line">        10: ldc           #2                  // String abc</span><br><span class="line">        <span class="number">12</span>: astore        <span class="number">4</span></span><br><span class="line">        14: getstatic     #3                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        <span class="number">17</span>: iload_1</span><br><span class="line">        18: invokevirtual #4                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">        21: getstatic     #3                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        <span class="number">24</span>: iload_3</span><br><span class="line">        25: invokevirtual #4                  // Method java/io/PrintStream.println:(I)V</span><br><span class="line">        <span class="number">28</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">10</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">11</span>: <span class="number">3</span></span><br><span class="line">        line <span class="number">12</span>: <span class="number">6</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">10</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">14</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">21</span></span><br><span class="line">        line <span class="number">18</span>: <span class="number">28</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">29</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">3</span>      <span class="number">26</span>     <span class="number">1</span>     i   I</span><br><span class="line">            <span class="number">6</span>      <span class="number">23</span>     <span class="number">2</span>     j   I</span><br><span class="line">           <span class="number">10</span>      <span class="number">19</span>     <span class="number">3</span>     k   I</span><br><span class="line">           <span class="number">14</span>      <span class="number">15</span>     <span class="number">4</span>     s   Ljava/lang/String;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;PCRegisterTest.java&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>左边的数字代表<strong>指令地址（指令偏移）</strong>，即 PC 寄存器中可能存储的值，然后执行引擎读取 PC 寄存器中的值，并执行该指令</li>
</ul>
<p><img src="/2020/01/03/JVM-RUNTIME/0009.png"></p>
<h2 id="两个面试题"><a href="#两个面试题" class="headerlink" title="两个面试题"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=%E4%B8%A4%E4%B8%AA%E9%9D%A2%E8%AF%95%E9%A2%98">两个面试题</a></h2><p><strong>使用PC寄存器存储字节码指令地址有什么用呢？</strong>或者问<strong>为什么使用 PC 寄存器来记录当前线程的执行地址呢？</strong></p>
<ol>
<li>因为CPU需要不停的切换各个线程，这时候切换回来以后，就得知道接着从哪开始继续执行</li>
<li>JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令</li>
</ol>
<p><img src="/2020/01/03/JVM-RUNTIME/0010.png"></p>
<p><strong>PC寄存器为什么被设定为私有的？</strong></p>
<ol>
<li>我们都知道所谓的多线程在一个特定的时间段内只会执行其中某一个线程的方法，CPU会不停地做任务切换，这样必然导致经常中断或恢复，如何保证分毫无差呢？<strong>为了能够准确地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个PC寄存器</strong>，这样一来各个线程之间便可以进行独立计算，从而不会出现相互干扰的情况。</li>
<li>由于CPU时间片轮限制，众多线程在并发执行过程中，任何一个确定的时刻，一个处理器或者多核处理器中的一个内核，只会执行某个线程中的一条指令。</li>
<li>这样必然导致经常中断或恢复，如何保证分毫无差呢？每个线程在创建后，都会产生自己的程序计数器和栈帧，程序计数器在各个线程之间互不影响。</li>
</ol>
<blockquote>
<p>注意并行和并发的区别，笔者的并发系列有讲</p>
</blockquote>
<h2 id="CPU-时间片"><a href="#CPU-时间片" class="headerlink" title="CPU 时间片"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC3%E7%AB%A0-%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA?id=cpu-%E6%97%B6%E9%97%B4%E7%89%87">CPU 时间片</a></h2><ol>
<li><p>CPU时间片即CPU分配给各个程序的时间，每个线程被分配一个时间段，称作它的时间片。</p>
</li>
<li><p>在宏观上：我们可以同时打开多个应用程序，每个程序并行不悖，同时运行。</p>
</li>
<li><p>但在微观上：由于只有一个CPU，一次只能处理程序要求的一部分，如何处理公平，一种方法就是引入时间片，<strong>每个程序轮流执行</strong>。</p>
</li>
</ol>
<p><img src="/2020/01/03/JVM-RUNTIME/0011.png"></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM</title>
    <url>/2020/04/18/JVM/</url>
    <content><![CDATA[<p><a href="https://noteforme.github.io/2020/01/04/JVM-METHOD/">JVM方法区-第六章</a></p>
<p>![Screen Shot 2020-04-16 at 8.22.33 PM](JVM/Screen Shot 2020-04-16 at 8.22.33 PM.png)</p>
<p>![Screen Shot 2020-04-16 at 8.29.39 PM](JVM/Screen Shot 2020-04-16 at 8.29.39 PM.png)</p>
<p>![Screen Shot 2020-04-16 at 8.41.39 PM](JVM/Screen Shot 2020-04-16 at 8.41.39 PM.png)</p>
<p>![Screen Shot 2020-04-16 at 8.43.41 PM](Screen Shot 2020-04-16 at 8.43.41 PM.png)</p>
<p><a href="https://juejin.im/post/5f0376e3e51d45349b5c9d0c">https://juejin.im/post/5f0376e3e51d45349b5c9d0c</a></p>
<p><a href="https://www.iteye.com/blog/rednaxelafx-656951">https://www.iteye.com/blog/rednaxelafx-656951</a></p>
<p><a href="https://www.bilibili.com/video/av75247289?p=2">https://www.bilibili.com/video/av75247289?p=2</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>Java_List</title>
    <url>/2020/01/05/Java-List/</url>
    <content><![CDATA[<p>Java List source analysis</p>
<p>List  &lt;– ArrayList  LinkedList</p>
<h5 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h5><ol>
<li><p>```<br>ArrayList<Integer>  arrayList = new ArrayList&lt;&gt;();</Integer></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"> 得到一个<span class="keyword">object</span>数组 `<span class="keyword">private</span> <span class="built_in">static</span> <span class="keyword">final</span> <span class="keyword">Object</span>[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;`</span><br><span class="line"></span><br><span class="line">source</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>public ArrayList() {</p>
<pre><code>this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
</code></pre>
<p>}</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2. ```</span><br><span class="line">   arrayList.<span class="builtin-name">add</span>(1);</span><br><span class="line">   arrayList.<span class="builtin-name">add</span>(2);</span><br></pre></td></tr></table></figure>

<p> source </p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">ensureCapacityInternal</span>(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">    elementData[size++] = e;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ensureCapacityInternal</span><span class="params">(<span class="keyword">int</span> minCapacity)</span> </span>&#123;</span><br><span class="line">     <span class="built_in">ensureExplicitCapacity</span>(<span class="built_in">calculateCapacity</span>(elementData, minCapacity));</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<ul>
<li><p>先看看calculateCapacity</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">Object</span>[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="built_in">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> calculateCapacity(<span class="keyword">Object</span>[] elementData, <span class="built_in">int</span> minCapacity) &#123;</span><br><span class="line">    <span class="keyword">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.<span class="built_in">max</span>(DEFAULT_CAPACITY, minCapacity);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> minCapacity;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <code>if (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA)</code> minCapacity==10</p>
</li>
<li><p>ensureExplicitCapacity()</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void ensure<span class="constructor">ExplicitCapacity(<span class="params">int</span> <span class="params">minCapacity</span>)</span> &#123;</span><br><span class="line">    modCount++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// overflow-conscious code</span></span><br><span class="line">    <span class="keyword">if</span> (minCapacity - elementData.length &gt; <span class="number">0</span>)</span><br><span class="line">        grow(minCapacity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span> void grow(<span class="built_in">int</span> minCapacity) &#123;</span><br><span class="line">        <span class="comment">// overflow-conscious code</span></span><br><span class="line">        <span class="built_in">int</span> oldCapacity = elementData.length;</span><br><span class="line">        <span class="built_in">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - minCapacity &lt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = minCapacity;</span><br><span class="line">        <span class="keyword">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class="number">0</span>)</span><br><span class="line">            newCapacity = huge<span class="constructor">Capacity(<span class="params">minCapacity</span>)</span>;</span><br><span class="line">        <span class="comment">// minCapacity is usually close to size, so this is a win:</span></span><br><span class="line">        elementData = <span class="module-access"><span class="module"><span class="identifier">Arrays</span>.</span></span>copy<span class="constructor">Of(<span class="params">elementData</span>, <span class="params">newCapacity</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>添加<code>arrayList.add(1);</code>时，size 为10的数组， elementData[size++] = e; 注意size初始化值==0，程序先 执行elementData[0]=1,然后是size++;</p>
<p>当添加的数是11时，<code>        int newCapacity = oldCapacity + (oldCapacity &gt;&gt; 1);</code>开始执行 10 + 1010&gt;&gt;1 = 10+5,申请了5个空间</p>
<p>然后get()可以获取element</p>
</li>
<li><p>源码简写</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> <span class="built_in">size</span> =<span class="number">0</span>;</span><br><span class="line"><span class="keyword">Object</span>[] elementData= &#123;&#125;;</span><br><span class="line"><span class="keyword">Object</span>[] elementArr = Arrays.copyOf(elementData, <span class="number">10</span>);</span><br><span class="line">elementArr[<span class="built_in">size</span>++] = <span class="number">5</span>;</span><br><span class="line">elementArr[<span class="built_in">size</span>++] = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">for</span> ( <span class="keyword">Object</span> el :elementArr)&#123;</span><br><span class="line">    System.out.<span class="built_in">print</span>(el+<span class="string">&quot;  &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">System.out.<span class="built_in">println</span>(elementArr[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h5 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h5><p> 源码功能如图所示</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">void linkLast(E e) &#123;</span><br><span class="line">    final <span class="keyword">Node</span><span class="title">&lt;E</span>&gt; l = last;</span><br><span class="line">    final <span class="keyword">Node</span><span class="title">&lt;E</span>&gt; newNode = new <span class="keyword">Node</span><span class="title">&lt;&gt;(l</span>, e, null);</span><br><span class="line">    last = newNode;</span><br><span class="line">    if (l == null)</span><br><span class="line">        first = newNode;</span><br><span class="line">    else</span><br><span class="line">        l.next = newNode;</span><br><span class="line">    size++;</span><br><span class="line">    modCount++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private static class <span class="keyword">Node</span><span class="title">&lt;E</span>&gt; &#123;</span><br><span class="line">        E item;</span><br><span class="line">        <span class="keyword">Node</span><span class="title">&lt;E</span>&gt; next;</span><br><span class="line">        <span class="keyword">Node</span><span class="title">&lt;E</span>&gt; prev;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">Node</span><span class="title">(Node</span><span class="tag">&lt;E&gt;</span> prev, E element, <span class="keyword">Node</span><span class="title">&lt;E</span>&gt; next) &#123;</span><br><span class="line">            this.item = element;</span><br><span class="line">            this.next = next;</span><br><span class="line">            this.prev = prev;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/05/Java-List/linkedlist.png" alt="linkedlist"></p>
<h5 id="List-iterator"><a href="#List-iterator" class="headerlink" title="List iterator"></a>List iterator</h5><p>  List<String> crunchifyList = <strong>new</strong> ArrayList<String>();</String></String></p>
<p>​    // add 4 different values to list</p>
<p>​    crunchifyList.add(“Facebook”);</p>
<p>​    crunchifyList.add(“Paypal”);</p>
<p>​    crunchifyList.add(“Google”);</p>
<p>​    crunchifyList.add(“Yahoo”);</p>
<p>​    // Other way to define list is - we will not use this list :)</p>
<p>​    List<String> crunchifyListNew = Arrays.asList(“Facebook”, “Paypal”, “Google”, “Yahoo”);</String></p>
<ul>
<li><p>​      Iterator - Returns an iterator over the elements in this list in proper sequence.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Iterator</span>&lt;<span class="keyword">String</span>&gt; crunchifyIterator = crunchifyList.<span class="built_in">iterator</span>();</span><br><span class="line">  </span><br><span class="line"> <span class="keyword">while</span>(crunchifyIterator.hasNext()) &#123;</span><br><span class="line">  </span><br><span class="line">   System.out.println(crunchifyIterator.next());</span><br><span class="line">  </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></li>
<li><p> // ListIterator - traverse a list of elements in either forward or backward order</p>
</li>
</ul>
<p>  ​    // An iterator for lists that allows the programmer to traverse the list in either direction, modify the list during iteration,</p>
<p>  ​    // and obtain the iterator’s current position in the list.</p>
  <figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">ListIterator&lt;String&gt; crunchifyListIterator = crunchifyList.<span class="built_in">list</span><span class="constructor">Iterator()</span>;</span><br><span class="line">      <span class="keyword">while</span> (crunchifyListIterator.has<span class="constructor">Next()</span>) &#123;</span><br><span class="line">          <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(crunchifyListIterator.next<span class="literal">()</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Iterable.forEach() util: Returns a sequential Stream with this collection as its source</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">crunchifyList.<span class="keyword">forEach</span>((<span class="keyword">temp</span>) -&gt; &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">System</span>.<span class="keyword">out</span>.println(<span class="keyword">temp</span>);</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li><p> collection Stream.forEach() util: Returns a sequential Stream with this collection as its source</p>
</li>
</ul>
  <figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">crunchifyList.stream<span class="function"><span class="params">()</span>.<span class="title">forEach</span><span class="params">((crunchifyTemp) -&gt; System.out.println(crunchifyTemp))</span>;</span></span><br></pre></td></tr></table></figure>

<h5 id="List-use-in-kotlin"><a href="#List-use-in-kotlin" class="headerlink" title="List use in kotlin"></a>List use in kotlin</h5><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">var</span> mPatientList = patientList<span class="selector-class">.filter</span> &#123; it<span class="selector-class">.patientCode</span> == patientCode &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">return</span> mQnList?.<span class="keyword">let</span> &#123; <span class="literal">it</span> -&gt;</span><br><span class="line">    <span class="literal">it</span>.filter &#123; <span class="literal">it</span>.type == type &#125;.<span class="keyword">map</span> &#123; <span class="literal">it</span>.value &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>Java_Queue</title>
    <url>/2020/03/23/Java-Queue/</url>
    <content><![CDATA[<p><a href="https://blog.csdn.net/bn493235694/article/details/79600634">https://blog.csdn.net/bn493235694/article/details/79600634</a></p>
<p><em>队列是一个先进先出的的数据结构</em></p>
<img src="/2020/03/23/Java-Queue/16d7ddc81e9f954f.jpg" alt="16d7ddc81e9f954f">





<h5 id="Deque"><a href="#Deque" class="headerlink" title="Deque"></a>Deque</h5><p><strong>I need to have a thread-safe LIFO structure</strong></p>
<p>Use LinkedBlockingDeque if at a time you want only single thread can operate your data.</p>
<p>Use ConcurrentLinkedDeque if you want that each thread can access the shared data</p>
<p><a href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentLinkedDeque.html">https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentLinkedDeque.html</a></p>
<ul>
<li><p>ConcurrentLinkedDeque</p>
<p><a href="https://blog.csdn.net/hello_worldee/article/details/77880532">https://blog.csdn.net/hello_worldee/article/details/77880532</a></p>
</li>
</ul>
<p>Deque : <a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html">https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1265122668445536">https://www.liaoxuefeng.com/wiki/1252599548343744/1265122668445536</a></p>
<p><a href="https://www.geeksforgeeks.org/deque-interface-java-example/">https://www.geeksforgeeks.org/deque-interface-java-example/</a></p>
<ul>
<li>LinkedList 线程安全处理</li>
</ul>
<p><a href="https://blog.csdn.net/d380025303/article/details/81010980">https://blog.csdn.net/d380025303/article/details/81010980</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>JavaIo</title>
    <url>/2017/09/12/JavaIo/</url>
    <content><![CDATA[<p>![Screen Shot 2020-09-12 at 5.20.14 PM](JavaIo/Screen Shot 2020-09-12 at 5.20.14 PM.png)</p>
<p>![Screen Shot 2020-09-12 at 5.22.29 PM](JavaIo/Screen Shot 2020-09-12 at 5.22.29 PM.png)</p>
<img src="/2017/09/12/JavaIo/java7-1535863955.jpg" alt="java7-1535863955">



<p>Byte Stream : 对于二进制文件或处理 数字字母之类的数据</p>
<p><a href="https://www.javazhiyin.com/17362.html">https://www.javazhiyin.com/17362.html</a></p>
<h4 id="FileInputStream"><a href="#FileInputStream" class="headerlink" title="FileInputStream"></a>FileInputStream</h4><p>单个字节读</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line">FileInputStream fis = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    fis = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;/Users/john/Documents/jywork/THINKJAVA/src/main/resource/a.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> data;</span><br><span class="line">    <span class="keyword">while</span> ((data = fis.<span class="keyword">read</span>()) != -<span class="number">1</span>) &#123;</span><br><span class="line">        System.out.<span class="keyword">print</span>((<span class="keyword">char</span>) data+<span class="string">&quot;  &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>读到bytes数组里面</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">FileInputStream fis = null;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">14</span>];</span><br><span class="line">    fis = <span class="keyword">new</span> <span class="built_in">FileInputStream</span>(<span class="string">&quot;/Users/john/Documents/jywork/THINKJAVA/src/main/resource/a.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> read = fis.<span class="built_in">read</span>(bytes);</span><br><span class="line">    <span class="keyword">String</span> s  = <span class="keyword">new</span> <span class="built_in"><span class="keyword">String</span></span>(bytes);</span><br><span class="line">    System.out.<span class="built_in">println</span>(s);</span><br><span class="line">    System.out.<span class="built_in">println</span>(read);</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>读到bytes里面 ,限定读的字节个数</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">FileInputStream fis = null;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">14</span>];</span><br><span class="line">    fis = <span class="keyword">new</span> <span class="built_in">FileInputStream</span>(<span class="string">&quot;/Users/john/Documents/jywork/THINKJAVA/src/main/resource/a.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> read = fis.<span class="built_in">read</span>(bytes,<span class="number">0</span>,<span class="number">4</span>);</span><br><span class="line">    <span class="keyword">String</span> s  = <span class="keyword">new</span> <span class="built_in"><span class="keyword">String</span></span>(bytes);</span><br><span class="line">    System.out.<span class="built_in">println</span>(s);</span><br><span class="line">    System.out.<span class="built_in">println</span>(read);</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException e) &#123;</span><br><span class="line">    e.<span class="built_in">printStackTrace</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于为什么必须继承装饰器父类 FilterInputStream的思考</p>
<blockquote>
<p>实际上，如果去查看 JDK 的源码，你会发现，BufferedInputStream、DataInputStream 并非继承自 InputStream，而是另外一个叫 FilterInputStream 的类。那这又是出于什么样的设计意图，才引入这样一个类呢？我们再重新来看一下 BufferedInputStream 类的代码。InputStream 是一个抽象类而非接口，而且它的大部分函数（比如 read()、available()）都有默认实现，按理来说，我们只需要在 BufferedInputStream 类中重新实现那些需要增加缓存功能的函数就可以了，其他函数继承 InputStream 的默认实现。但实际上，这样做是行不通的。对于即便是不需要增加缓存功能的函数来说，BufferedInputStream 还是必须把它重新实现一遍，简单包裹对 InputStream 对象的函数调用。具体的代码示例如下所示。如果不重新实现，那 BufferedInputStream 类就无法将最终读取数据的任务，委托给传递进来的 InputStream 对象来完成。这一部分稍微有点不好理解，你自己多思考一下。</p>
</blockquote>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>Keyboard</title>
    <url>/2017/12/21/Keyboard/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/training/keyboard-input/style.html">https://developer.android.com/training/keyboard-input/style.html</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">static</span> Timer timer = <span class="keyword">new</span> Timer();</span><br><span class="line"></span><br><span class="line">     timer.schedule(<span class="keyword">new</span> TimerTask() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">               showSoftKeyboard(etInvestMoney);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;, <span class="number">200</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showSoftKeyboard</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (view.requestFocus()) &#123;</span><br><span class="line">           InputMethodManager imm = (InputMethodManager) getActivity().getSystemService(Context.INPUT_METHOD_SERVICE);</span><br><span class="line">           imm.showSoftInput(view, InputMethodManager.RESULT_UNCHANGED_SHOWN);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><a href="http://www.jianshu.com/p/215b388a6e7d">http://www.jianshu.com/p/215b388a6e7d</a></p>
<p><a href="https://juejin.im/post/5eddf8456fb9a04804041738">https://juejin.im/post/5eddf8456fb9a04804041738</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>keyboard</tag>
      </tags>
  </entry>
  <entry>
    <title>LOG</title>
    <url>/2017/12/09/LOG/</url>
    <content><![CDATA[<h5 id="Timber"><a href="#Timber" class="headerlink" title="Timber"></a>Timber</h5><ol>
<li>添加库</li>
</ol>
<p><code>   implementation &#39;com.jakewharton.timber:timber:4.6.0&#39;</code></p>
<p>**注意 **:  一开始日志打印不了还以为 okhttplogger冲突，BuildConfig需要导入项目的包<code>import com.jonzhou.nytime.BuildConfig;，而不是Timber或其他的包 </code></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void onCreate() &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        <span class="keyword">if</span> (<span class="type">BuildConfig</span>.<span class="type">DEBUG</span>) &#123;</span><br><span class="line">            <span class="type">Timber</span>.plant(<span class="keyword">new</span> <span class="type">Timber</span>.<span class="type">DebugTree</span>());</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">Timber</span>.plant(<span class="keyword">new</span> <span class="type">CrashReportingTree</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A tree which logs important information for crash reporting.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> static <span class="class"><span class="keyword">class</span> <span class="title">CrashReportingTree</span> <span class="keyword">extends</span> <span class="title">Timber</span>.<span class="title">Tree</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> void log(int priority, <span class="type">String</span> tag, <span class="meta">@NonNull</span> <span class="type">String</span> message, <span class="type">Throwable</span> t) &#123;</span><br><span class="line">            <span class="keyword">if</span> (priority == <span class="type">Log</span>.<span class="type">VERBOSE</span> || priority == <span class="type">Log</span>.<span class="type">DEBUG</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">FakeCrashLibrary</span>.log(priority, tag, message);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (t != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (priority == <span class="type">Log</span>.<span class="type">ERROR</span>) &#123;</span><br><span class="line">                    <span class="type">FakeCrashLibrary</span>.logError(t);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (priority == <span class="type">Log</span>.<span class="type">WARN</span>) &#123;</span><br><span class="line">                    <span class="type">FakeCrashLibrary</span>.logWarning(t);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用</li>
</ol>
<p>jake的例子</p>
<p><a href="https://github.com/JakeWharton/timber/blob/master/timber-sample/src/main/java/com/example/timber/ui/LintActivity.java">LintActivity</a> </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">  <span class="comment">// LogNotTimber</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;msg&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;msg&quot;</span>, <span class="keyword">new</span> <span class="constructor">Exception()</span>);</span><br><span class="line">  android.util.<span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;msg&quot;</span>);</span><br><span class="line">  android.util.<span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(<span class="string">&quot;TAG&quot;</span>, <span class="string">&quot;msg&quot;</span>, <span class="keyword">new</span> <span class="constructor">Exception()</span>);</span><br><span class="line">  <span class="comment">// StringFormatInTimber</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>w(<span class="module-access"><span class="module"><span class="identifier">String</span>.</span></span>format(<span class="string">&quot;%s&quot;</span>, get<span class="constructor">String()</span>));</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>w(format(<span class="string">&quot;%s&quot;</span>, get<span class="constructor">String()</span>));</span><br><span class="line">  <span class="comment">// ThrowableNotAtBeginning</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;%s&quot;</span>, <span class="keyword">new</span> <span class="constructor">Exception()</span>);</span><br><span class="line">  <span class="comment">// BinaryOperationInTimber</span></span><br><span class="line">  String foo = <span class="string">&quot;foo&quot;</span>;</span><br><span class="line">  String bar = <span class="string">&quot;bar&quot;</span>;</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;foo&quot;</span> + <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;foo&quot;</span> + bar);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(foo + <span class="string">&quot;bar&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(foo + bar);</span><br><span class="line">  <span class="comment">// TimberArgCount</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;%s %s&quot;</span>, <span class="string">&quot;arg0&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;arg0&quot;</span>, <span class="string">&quot;arg1&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>tag(<span class="string">&quot;tag&quot;</span>).d(<span class="string">&quot;%s %s&quot;</span>, <span class="string">&quot;arg0&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>tag(<span class="string">&quot;tag&quot;</span>).d(<span class="string">&quot;%s&quot;</span>, <span class="string">&quot;arg0&quot;</span>, <span class="string">&quot;arg1&quot;</span>);</span><br><span class="line">  <span class="comment">// TimberArgTypes</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;%d&quot;</span>, <span class="string">&quot;arg0&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>tag(<span class="string">&quot;tag&quot;</span>).d(<span class="string">&quot;%d&quot;</span>, <span class="string">&quot;arg0&quot;</span>);</span><br><span class="line">  <span class="comment">// TimberTagLength</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>tag(<span class="string">&quot;abcdefghijklmnopqrstuvwx&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>tag(<span class="string">&quot;abcdefghijklmnopqrstuvw&quot;</span> + <span class="string">&quot;x&quot;</span>);</span><br><span class="line">  <span class="comment">// TimberExceptionLogging</span></span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="keyword">new</span> <span class="constructor">Exception()</span>, <span class="keyword">new</span> <span class="constructor">Exception()</span>.get<span class="constructor">Message()</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="keyword">new</span> <span class="constructor">Exception()</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="keyword">new</span> <span class="constructor">Exception()</span>, null);</span><br><span class="line">  */</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String get<span class="constructor">String()</span> &#123;</span><br><span class="line">  return <span class="string">&quot;foo&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Xlog"><a href="#Xlog" class="headerlink" title="Xlog"></a>Xlog</h5><p>1 . 环境配置 </p>
<p> 安装 pyelliptic1.5.7  <code> sudo python setup.py install</code></p>
<ol start="2">
<li>解码日志 </li>
</ol>
<p> <code>python mars/log/crypt/decode_mars_nocrypt_log_file.py  MarsSample_20200417.xlog</code></p>
<p>但是现在碰到了问题</p>
<p>mq初始化有日志，接收消息没有日志，可能在不同的线程里，需要做处理</p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Lambda</title>
    <url>/2018/07/11/Lambda/</url>
    <content><![CDATA[<p><a href="http://blog.oneapm.com/apm-tech/226.html">http://blog.oneapm.com/apm-tech/226.html</a></p>
<p>android </p>
<p><a href="https://maxwell-nc.github.io/android/retrolambda.html">https://maxwell-nc.github.io/android/retrolambda.html</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1526621">https://cloud.tencent.com/developer/article/1526621</a></p>
<p><a href="https://juejin.im/post/6844903668592934925">https://juejin.im/post/6844903668592934925</a></p>
<p>kotlin  lambda</p>
<p><a href="https://juejin.im/post/6844903604613021703">https://juejin.im/post/6844903604613021703</a></p>
<p>Video</p>
<h4 id="Java-lambda"><a href="#Java-lambda" class="headerlink" title="Java lambda"></a>Java lambda</h4><p>函数式编程</p>
<p><a href="https://www.bilibili.com/video/av54941486/">https://www.bilibili.com/video/av54941486/</a></p>
<p><a href="http://www.chilangedu.com/sectionq/2132352424">http://www.chilangedu.com/sectionq/2132352424</a></p>
<h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">&lt;R&gt; Stream&lt;R&gt; <span class="keyword">map</span>(<span class="built_in">Function</span>&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> R&gt; mapper);</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">Function</span>&lt;<span class="symbol">T</span>, <span class="symbol">R</span>&gt; &#123;</span><br><span class="line">	    R apply(T t); <span class="comment">//将T类型转为R</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>LeakMemory</title>
    <url>/2018/02/09/LeakMemory/</url>
    <content><![CDATA[<h4 id="内存泄漏"><a href="#内存泄漏" class="headerlink" title="内存泄漏"></a>内存泄漏</h4><img src="/2018/02/09/LeakMemory/2021-07-31_leankreson.png" style="zoom:50%;">



<img src="/2018/02/09/LeakMemory/Users/john/Documents/noteforme.github.io/source/_posts/LeakMemory/2021-07-31_4.28_oom.png" style="zoom:33%;">





<img src="/2018/02/09/LeakMemory/Users/john/Documents/noteforme.github.io/source/_posts/LeakMemory/2021-07-31_4_webview.png" style="zoom:50%;">



<p><img src="/2018/02/09/LeakMemory/Users/john/Documents/noteforme.github.io/source/_posts/LeakMemory/2021-07-31_4_thread.png"></p>
<p><a href="https://mp.weixin.qq.com/s/tO1yxFs2qNQlQ2bJ8vGzQA">https://mp.weixin.qq.com/s/tO1yxFs2qNQlQ2bJ8vGzQA</a></p>
<p><a href="https://www.jianshu.com/p/ac00e370f83d">https://www.jianshu.com/p/ac00e370f83d</a></p>
<p><a href="https://github.com/francistao/LearningNotes/blob/master/Part1/Android/Android%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%80%BB%E7%BB%93.md">内存泄漏总结</a></p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">SampleActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Instances of static inner classes do not hold an implicit</span></span><br><span class="line"><span class="comment">   * reference to their outer class.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> static <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">WeakReference</span>&lt;<span class="type">SampleActivity</span>&gt; mActivity;</span><br><span class="line"></span><br><span class="line">    public <span class="type">MyHandler</span>(<span class="type">SampleActivity</span> activity) &#123;</span><br><span class="line">      mActivity = <span class="keyword">new</span> <span class="type">WeakReference</span>&lt;<span class="type">SampleActivity</span>&gt;(activity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    public void handleMessage(<span class="type">Message</span> msg) &#123;</span><br><span class="line">      <span class="type">SampleActivity</span> activity = mActivity.get();</span><br><span class="line">      <span class="keyword">if</span> (activity != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">MyHandler</span> mHandler = <span class="keyword">new</span> <span class="type">MyHandler</span>(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Instances of anonymous classes do not hold an implicit</span></span><br><span class="line"><span class="comment">   * reference to their outer class when they are &quot;static&quot;.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">private</span> static <span class="keyword">final</span> <span class="type">Runnable</span> sRunnable = <span class="keyword">new</span> <span class="type">Runnable</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      public void run() &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">protected</span> void onCreate(<span class="type">Bundle</span> savedInstanceState) &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Post a message and delay its execution for 10 minutes.</span></span><br><span class="line">    mHandler.postDelayed(sRunnable, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Go back to the previous Activity.</span></span><br><span class="line">    finish();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>kotin Fragment方式</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> : <span class="type">Handler &#123;</span></span></span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">var</span> mFragment: WeakReference&lt;Any&gt;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">constructor</span>(fragment: Fragment) &#123;</span><br><span class="line">          mFragment = WeakReference(fragment)</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleMessage</span><span class="params">(msg: <span class="type">android</span>.<span class="type">os</span>.<span class="type">Message</span>?)</span></span> &#123;</span><br><span class="line">          <span class="keyword">super</span>.handleMessage(msg)</span><br><span class="line">          <span class="keyword">val</span> fragment = mFragment.<span class="keyword">get</span>() <span class="keyword">as</span> PayProFragment</span><br><span class="line">          fragment.reloadPay()</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p><a href="https://www.jianshu.com/p/63aead89f3b9">内存泄漏处理-Handler</a></p>
</li>
<li><p><a href="https://juejin.im/entry/589542ed2f301e0069054007">查找方式</a></p>
<p><a href="https://www.jianshu.com/p/bdfd2a6b2681">https://www.jianshu.com/p/bdfd2a6b2681</a></p>
</li>
</ul>
<p>​    <a href="https://developer.android.com/studio/profile/memory-profiler">https://developer.android.com/studio/profile/memory-profiler</a></p>
<h4 id="leakcanary"><a href="#leakcanary" class="headerlink" title="leakcanary"></a>leakcanary</h4><p><a href="https://square.github.io/leakcanary/recipes/">https://square.github.io/leakcanary/recipes/</a></p>
<p><a href="https://juejin.im/post/5d617d6851882575e8054fab">https://juejin.im/post/5d617d6851882575e8054fab</a></p>
<p><img src="/2018/02/09/LeakMemory/2021-07-31_10.4_leankcanary.png"></p>
<img src="/2018/02/09/LeakMemory/2021-07-31_10.41_leankcanry_1.png" style="zoom:50%;">

<p><img src="/2018/02/09/LeakMemory/2021-07-31_10.4_leakcanary_2.png"></p>
<p><img src="/2018/02/09/LeakMemory/Users/john/Documents/noteforme.github.io/source/_posts/LeakMemory/2021-07-31_10.48_leakcanry3.png"></p>
<h4 id="内存抖动"><a href="#内存抖动" class="headerlink" title="内存抖动"></a>内存抖动</h4><p>Profiler</p>
<p><a href="https://www.bilibili.com/video/BV1oz4y1m7Gw?p=14">https://www.bilibili.com/video/BV1oz4y1m7Gw?p=14</a></p>
<h4 id="App瘦身"><a href="#App瘦身" class="headerlink" title="App瘦身"></a>App瘦身</h4><ol>
<li><p>大图转成 webapp</p>
</li>
<li><p>svg批量转换</p>
<p>设置<code> vectorDrawables.useSupportLibrary = true</code>  然后 <code>app:srcCompat = </code> 否则会在每个drawable生成一个png图片，达不到效果了。</p>
<p>tink修改图片颜色</p>
<img src="/2018/02/09/LeakMemory/2021-08-01_4.4_image_tint.png" style="zoom:50%;"></li>
<li><p>国际化</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">android&#123;</span><br><span class="line">	defaultConfig&#123;</span><br><span class="line">		 resConfigs <span class="string">&#x27;en&#x27;</span>  <span class="comment">//只适配英语</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 这样只会保存 语言的映射</p>
</li>
<li><p>so库</p>
<p> 一般像微信用Armeabi-v7a</p>
<p>虚拟机运行 还需要 x86</p>
</li>
<li><p>删除无用资源</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">debug&#123;</span><br><span class="line">  minifyEnabled <span class="literal">true</span> <span class="comment">// 删除无用代码</span></span><br><span class="line">  shrinkResource <span class="literal">true</span> <span class="comment">//删除资源文件 minifyEnabled 为true,删除了无用代码，这个才知道删除哪些资源。</span></span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>LifeCycle</title>
    <url>/2020/08/02/LifeCycle/</url>
    <content><![CDATA[<p><img src="/2020/08/02/LifeCycle/2021-08-02_8.12_lifecycle.png"></p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<br>LifeCycle应用</p>
<ol>
<li>解藕页面与组件</li>
<li>解藕Service与组件</li>
<li>ProcessLifecycleOwner监听应用程序生命周期</li>
</ol>
<h5 id="解藕页面与组件"><a href="#解藕页面与组件" class="headerlink" title="解藕页面与组件"></a>解藕页面与组件</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyChronometer</span> <span class="keyword">extends</span> <span class="title">Chronometer</span> <span class="keyword">implements</span> <span class="title">LifecycleObserver</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">long</span> elapseTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyChronometer</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">startMeter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        setBase(SystemClock.elapsedRealtime() - elapseTime);</span><br><span class="line">        start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">stopMeter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        elapseTime = SystemClock.elapsedRealtime() - getBase();</span><br><span class="line">        stop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">chronometer = (MyChronometer)findViewById(R.id.chronometer);</span><br><span class="line">getLifecycle().addObserver(chronometer);</span><br></pre></td></tr></table></figure>



<h5 id="解藕Service与组件"><a href="#解藕Service与组件" class="headerlink" title="解藕Service与组件"></a>解藕Service与组件</h5><p>=======</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>d7906d4909f312e25743be4a4c56ad1539df1ea6</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
  </entry>
  <entry>
    <title>LiveData</title>
    <url>/2020/06/15/LiveData/</url>
    <content><![CDATA[<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ol>
<li>确保界面符合数据状态</li>
<li>不会发生内存泄漏</li>
<li>不会因Activity停止而导致崩溃</li>
<li>不再需要手动处理生命周期</li>
<li>数据始终保持最新状态</li>
<li>适当的配置更改</li>
<li>共享资源</li>
</ol>
<h4 id="livedata和viewmodel关系"><a href="#livedata和viewmodel关系" class="headerlink" title="livedata和viewmodel关系"></a>livedata和viewmodel关系</h4><p>viewmodel中的数据发生变化时通知页面</p>
<h4 id="LiveData原理"><a href="#LiveData原理" class="headerlink" title="LiveData原理"></a>LiveData原理</h4><p>注册观察者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">observe</span><span class="params">(<span class="meta">@NonNull</span> LifecycleOwner owner, <span class="meta">@NonNull</span> Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">     assertMainThread(<span class="string">&quot;observe&quot;</span>);</span><br><span class="line">     <span class="keyword">if</span> (owner.getLifecycle().getCurrentState() == DESTROYED) &#123;</span><br><span class="line">         <span class="comment">// ignore</span></span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     LifecycleBoundObserver wrapper = <span class="keyword">new</span> LifecycleBoundObserver(owner, observer);</span><br><span class="line">     ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper);</span><br><span class="line">     <span class="keyword">if</span> (existing != <span class="keyword">null</span> &amp;&amp; !existing.isAttachedTo(owner)) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Cannot add the same observer&quot;</span></span><br><span class="line">                 + <span class="string">&quot; with different lifecycles&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (existing != <span class="keyword">null</span>) &#123;</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">     &#125; </span><br><span class="line">     owner.getLifecycle().addObserver(wrapper); <span class="comment">//在这里注册</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>





<p>给观察者发送消息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dispatchingValue</span><span class="params">(<span class="meta">@Nullable</span> ObserverWrapper initiator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mDispatchingValue) &#123;</span><br><span class="line">        mDispatchInvalidated = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    mDispatchingValue = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        mDispatchInvalidated = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (initiator != <span class="keyword">null</span>) &#123;</span><br><span class="line">            considerNotify(initiator);</span><br><span class="line">            initiator = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Iterator&lt;Map.Entry&lt;Observer&lt;? <span class="keyword">super</span> T&gt;, ObserverWrapper&gt;&gt; iterator =</span><br><span class="line">                    mObservers.iteratorWithAdditions(); iterator.hasNext(); ) &#123; <span class="comment">//遍历观察者，给观察者发送消息</span></span><br><span class="line">                considerNotify(iterator.next().getValue());</span><br><span class="line">                <span class="keyword">if</span> (mDispatchInvalidated) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">while</span> (mDispatchInvalidated);</span><br><span class="line">    mDispatchingValue = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="数据粘性"><a href="#数据粘性" class="headerlink" title="数据粘性"></a>数据粘性</h4><p>经过了解和使用 view model,databiding后，我觉得这个不是官方留的坑，在特定的场景可能还需要这样做，我获取手环睡眠数据此时有其他fragment还没创建，我就需要创建后才就监听到数据。</p>
<h5 id="方法1"><a href="#方法1" class="headerlink" title="方法1"></a>方法1</h5><p>我们能不能再创建新的ObserverWrapper的时候，直接把mVersion的值赋给mLastVersion，这样就符合(observer.mLastVersion &gt;= mVersion)这一条件了，就不会再继续执行onChanged方法了</p>
<p><a href="https://blog.csdn.net/geyuecang/article/details/89028283">https://blog.csdn.net/geyuecang/article/details/89028283</a></p>
<h5 id="方法2"><a href="#方法2" class="headerlink" title="方法2"></a>方法2</h5><p> singleLiveEvent</p>
<p>其实这个方法解决的并不是粘性事件的问题，而是“数据倒灌”的问题。“数据倒灌”一词出自<a href="https://links.jianshu.com/go?to=https://xiaozhuanlan.com/u/kunminx">KunMinX</a>的Blog<a href="https://links.jianshu.com/go?to=https://xiaozhuanlan.com/topic/6719328450"><strong>重学安卓：LiveData 数据倒灌 背景缘由全貌 独家解析</strong></a>,即在setValue后,observe对此次set的value值会进行多次消费。比如进行第二次observe的时候获取到的数据是第一次的旧数据。这样会带来不可预期的后果。</p>
<h4 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h4><p>UnPeekLiveData</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProtectedUnPeekLiveData</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">LiveData</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> isAllowNullValue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;Integer, Boolean&gt; observers = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">observeInActivity</span><span class="params">(<span class="meta">@NonNull</span> AppCompatActivity activity, <span class="meta">@NonNull</span> Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line">        LifecycleOwner owner = activity;</span><br><span class="line">        Integer storeId = System.identityHashCode(observer);<span class="comment">//源码这里是activity.getViewModelStore()，是为了保证同一个ViewModel环境下&quot;唯一可信源&quot;</span></span><br><span class="line">        observe(storeId, owner, observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">observe</span><span class="params">(<span class="meta">@NonNull</span> Integer storeId,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@NonNull</span> LifecycleOwner owner,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@NonNull</span> Observer&lt;? <span class="keyword">super</span> T&gt; observer)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (observers.get(storeId) == <span class="keyword">null</span>) &#123;</span><br><span class="line">            observers.put(storeId, <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.observe(owner, t -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (!observers.get(storeId)) &#123;</span><br><span class="line">                observers.put(storeId, <span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">if</span> (t != <span class="keyword">null</span> || isAllowNullValue) &#123;</span><br><span class="line">                    observer.onChanged(t);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(T value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (value != <span class="keyword">null</span> || isAllowNullValue) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;Integer, Boolean&gt; entry : observers.entrySet()) &#123;</span><br><span class="line">                entry.setValue(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">super</span>.setValue(value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.setValue(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>，为每个传入的observer对象携带一个布尔类型的值，作为其是否能进入observe方法的开关。每当有一个新的observer存进来的时候，开关默认关闭。</p>
<p>每次setValue后，打开所有Observer的开关，允许所有observe执行。</p>
<p>这个确实清晰，简单</p>
<p><a href="https://www.jianshu.com/p/d0244c4c7cc9">https://www.jianshu.com/p/d0244c4c7cc9</a></p>
<p><a href="https://juejin.cn/post/6844903623252508685">https://juejin.cn/post/6844903623252508685</a></p>
<p>UnPeekLiveData</p>
<p>或者 ELiveData </p>
<p><a href="https://www.ershicimi.com/p/2f57df7148300017e8a0f7227720a2e8">https://www.ershicimi.com/p/2f57df7148300017e8a0f7227720a2e8</a></p>
<p><a href="https://juejin.im/post/5b2b1b2cf265da5952314b63">https://juejin.im/post/5b2b1b2cf265da5952314b63</a></p>
<p><a href="https://www.jianshu.com/p/79d909b6f8bd">https://www.jianshu.com/p/79d909b6f8bd</a></p>
<p><a href="https://juejin.im/post/6892704779781275662">https://juejin.im/post/6892704779781275662</a></p>
<p><a href="https://www.jianshu.com/p/d0244c4c7cc9">https://www.jianshu.com/p/d0244c4c7cc9</a></p>
]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
  </entry>
  <entry>
    <title>MarkdownStnddard</title>
    <url>/2017/07/11/Markdown-Standard/</url>
    <content><![CDATA[<p>第一篇还没写</p>
<p>在CSDN写了一年多的博客也算是自己历程的简单记录，竟然莫名奇妙的就被封了，客服说被系统误封了，接着帮我解封，然而自己建博客就提前排上了日常，接着就是Google了，好在几天就建好了，开始吧　骚年！！！</p>
<p>** Markdown规范**</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">a</span> <span class="selector-tag">b</span> .</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="Dogs"><a href="#Dogs" class="headerlink" title="Dogs"></a>Dogs</h1><h2 id="Anatomy-of-the-dog"><a href="#Anatomy-of-the-dog" class="headerlink" title="Anatomy of the dog"></a>Anatomy of the dog</h2><h1 id="Cats"><a href="#Cats" class="headerlink" title="Cats"></a>Cats</h1><h2 id="Anatomy-of-the-cat"><a href="#Anatomy-of-the-cat" class="headerlink" title="Anatomy of the cat"></a>Anatomy of the cat</h2><p>参考: <a href="http://einverne.github.io/markdown-style-guide/zh.html">http://einverne.github.io/markdown-style-guide/zh.html</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Math_Trigonometric_functions</title>
    <url>/2019/12/08/Math-Trigonometric-functions/</url>
    <content><![CDATA[<h5 id="Trigonometric-function"><a href="#Trigonometric-function" class="headerlink" title="Trigonometric function"></a>Trigonometric function</h5><p><a href="https://zhidao.baidu.com/question/498563235">https://zhidao.baidu.com/question/498563235</a></p>
<p><a href="https://www.shuxuele.com/algebra/trig-four-quadrants.html">https://www.shuxuele.com/algebra/trig-four-quadrants.html</a></p>
]]></content>
      <categories>
        <category>Mathematics</category>
      </categories>
  </entry>
  <entry>
    <title>MediaPlayer</title>
    <url>/2018/11/18/MediaPlayer/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/reference/android/media/MediaPlayer">https://developer.android.com/reference/android/media/MediaPlayer</a></p>
<p><a href="http://www.runoob.com/w3cnote/android-tutorial-mediaplayer.html">http://www.runoob.com/w3cnote/android-tutorial-mediaplayer.html</a></p>
<p><img src="/2018/11/18/MediaPlayer/MediaPlayer%5Cmediaplayer_state_diagram.gif" alt="mediaplayer_state_diagram"></p>
<p>这张状态转换图清晰的描述了MediaPlayer的各个状态，也列举了主要的方法的调用时序，每种方法只能在一些特定的状态下使用，如果使用时MediaPlayer的状态不正确则会引发IllegalStateException异常。</p>
<p>Idle 状态：当使用new()方法创建一个MediaPlayer对象或者调用了其reset()方法时，该MediaPlayer对象处于idle状态。这两种方法的一个重要差别就是：如果在这个状态下调用了getDuration()等方法（相当于调用时机不正确），通过reset()方法进入idle状态的话会触发OnErrorListener.onError()，并且MediaPlayer会进入Error状态；如果是新创建的MediaPlayer对象，则并不会触发onError(),也不会进入Error状态。</p>
<p>End 状态：通过release()方法可以进入End状态，只要MediaPlayer对象不再被使用，就应当尽快将其通过release()方法释放掉，以释放相关的软硬件组件资源，这其中有些资源是只有一份的（相当于临界资源）。如果MediaPlayer对象进入了End状态，则不会在进入任何其他状态了。</p>
<p>Initialized 状态：这个状态比较简单，MediaPlayer调用setDataSource()方法就进入Initialized状态，表示此时要播放的文件已经设置好了。</p>
<p>Prepared 状态：初始化完成之后还需要通过调用prepare()或prepareAsync()方法，这两个方法一个是同步的一个是异步的，只有进入Prepared状态，才表明MediaPlayer到目前为止都没有错误，可以进行文件播放。</p>
<p>Preparing 状态：这个状态比较好理解，主要是和prepareAsync()配合，如果异步准备完成，会触发OnPreparedListener.onPrepared()，进而进入Prepared状态。</p>
<p>Started 状态：显然，MediaPlayer一旦准备好，就可以调用start()方法，这样MediaPlayer就处于Started状态，这表明MediaPlayer正在播放文件过程中。可以使用isPlaying()测试MediaPlayer是否处于了Started状态。如果播放完毕，而又设置了循环播放，则MediaPlayer仍然会处于Started状态，类似的，如果在该状态下MediaPlayer调用了seekTo()或者start()方法均可以让MediaPlayer停留在Started状态。</p>
<p>Paused 状态：Started状态下MediaPlayer调用pause()方法可以暂停MediaPlayer，从而进入Paused状态，MediaPlayer暂停后再次调用start()则可以继续MediaPlayer的播放，转到Started状态，暂停状态时可以调用seekTo()方法，这是不会改变状态的。</p>
<p>Stop 状态：Started或者Paused状态下均可调用stop()停止MediaPlayer，而处于Stop状态的MediaPlayer要想重新播放，需要通过prepareAsync()和prepare()回到先前的Prepared状态重新开始才可以。</p>
<p>PlaybackCompleted状态：文件正常播放完毕，而又没有设置循环播放的话就进入该状态，并会触发OnCompletionListener的onCompletion()方法。此时可以调用start()方法重新从头播放文件，也可以stop()停止MediaPlayer，或者也可以seekTo()来重新定位播放位置。</p>
<p>Error状态：如果由于某种原因MediaPlayer出现了错误，会触发OnErrorListener.onError()事件，此时MediaPlayer即进入Error状态，及时捕捉并妥善处理这些错误是很重要的，可以帮助我们及时释放相关的软硬件资源，也可以改善用户体验。通过setOnErrorListener(android.media.MediaPlayer.OnErrorListener)可以设置该监听器。如果MediaPlayer进入了Error状态，可以通过调用reset()来恢复，使得MediaPlayer重新返回到Idle状态。</p>
<p>原文：<a href="https://blog.csdn.net/ddna/article/details/5178864">https://blog.csdn.net/ddna/article/details/5178864</a><br><a href="https://blog.csdn.net/biaobiao1217/article/details/51557733">https://blog.csdn.net/biaobiao1217/article/details/51557733</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Navigation_Drawer</title>
    <url>/2017/12/27/NavigationDrawer/</url>
    <content><![CDATA[<h2 id="Drawer使用"><a href="#Drawer使用" class="headerlink" title="Drawer使用"></a>Drawer使用</h2><ul>
<li> 业务</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> void init<span class="constructor">View()</span> &#123;</span><br><span class="line">        mPlanetTitles = get<span class="constructor">Resources()</span>.get<span class="constructor">StringArray(R.<span class="params">array</span>.<span class="params">recycle_array</span>)</span>;</span><br><span class="line">        mDrawerLayout = find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">drawer_layout</span>)</span>;</span><br><span class="line">        mDrawerList = find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">left_drawer</span>)</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Set the adapter for the list view</span></span><br><span class="line">        mDrawerList.set<span class="constructor">Adapter(<span class="params">new</span> ArrayAdapter&lt;String&gt;(<span class="params">this</span>, R.<span class="params">layout</span>.<span class="params">drawer_list_item</span>, <span class="params">mPlanetTitles</span>)</span>);</span><br><span class="line">        mDrawerList.set<span class="constructor">OnItemClickListener(<span class="params">new</span> DrawerItemClickListener()</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> DrawerItemClickListener implements ListView.OnItemClickListener &#123;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">ItemClick(AdapterView&lt;?&gt; <span class="params">adapterView</span>, View <span class="params">view</span>, <span class="params">int</span> <span class="params">position</span>, <span class="params">long</span> <span class="params">l</span>)</span> &#123;</span><br><span class="line">            select<span class="constructor">Item(<span class="params">position</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Swaps fragments in the main content view</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> void select<span class="constructor">Item(<span class="params">int</span> <span class="params">position</span>)</span> &#123;</span><br><span class="line">        <span class="comment">// Create a new fragment and specify the planet to show based on position</span></span><br><span class="line">        Fragment fragment = <span class="keyword">new</span> <span class="constructor">PullToRefreshFragment()</span>;</span><br><span class="line">        <span class="comment">// Insert the fragment by replacing any existing fragment</span></span><br><span class="line">        FragmentManager fragmentManager = get<span class="constructor">FragmentManager()</span>;</span><br><span class="line">        fragmentManager.<span class="keyword">begin</span><span class="constructor">Transaction()</span>.replace(<span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.content_frame, fragment)</span><br><span class="line">        .commit<span class="literal">()</span>;</span><br><span class="line">        set<span class="constructor">Title(<span class="params">mPlanetTitles</span>[<span class="params">position</span>])</span>;</span><br><span class="line">        mDrawerLayout.close<span class="constructor">Drawer(<span class="params">mDrawerList</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void set<span class="constructor">Title(CharSequence <span class="params">title</span>)</span> &#123;</span><br><span class="line">        super.set<span class="constructor">Title(<span class="params">title</span>)</span>;</span><br><span class="line"><span class="comment">//        getActionBar().setTitle(title);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;com.jonzhou.mineutils.RecycleView.RecycleViewActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;FrameLayout</span><br><span class="line">        android:id=&quot;@+id/content_frame&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;ListView</span><br><span class="line">        android:id=&quot;@+id/left_drawer&quot;</span><br><span class="line">        android:layout_width=&quot;240dp&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_gravity=&quot;start&quot;</span><br><span class="line">        android:background=&quot;#111&quot;</span><br><span class="line">        android:choiceMode=&quot;singleChoice&quot;</span><br><span class="line">        android:divider=&quot;@android:color/transparent&quot;</span><br><span class="line">        android:dividerHeight=&quot;0dp&quot; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="原生用法"><a href="#原生用法" class="headerlink" title="原生用法"></a>原生用法</h2><p>　    一般情况抽屉内容都不会很多所以就可以用　　<em>NavigationView替换ListView</em></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">	<span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.v4.widget.DrawerLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/drawer_layout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fitsSystemWindows</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:openDrawer</span>=<span class="string">&quot;start&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;include</span><br><span class="line">        layout=&quot;@layout/app_bar_navigation&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;android.support.design.widget.NavigationView</span><br><span class="line">        android:id=&quot;@+id/nav_view&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        android:layout_gravity=&quot;start&quot;</span><br><span class="line">        android:fitsSystemWindows=&quot;true&quot;</span><br><span class="line">        app:headerLayout=&quot;@layout/nav_header_navigation&quot;</span><br><span class="line">        app:menu=&quot;@menu/activity_navigation_drawer&quot; /&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.v4.widget.DrawerLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  查看NavigationView,可以看到　headerLayout，menu分别时抽屉的上下两部分，activity_navigation_drawer最好别用这个名称，否则可能加载系统默认布局怎么改都没用</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">	</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">onCreate</span>(<span class="params">Bundle savedInstanceState</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    setContentView(R.layout.activity_navigation);</span><br><span class="line">    Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);</span><br><span class="line">    setSupportActionBar(toolbar);</span><br><span class="line"></span><br><span class="line">    FloatingActionButton fab = (FloatingActionButton) findViewById(R.id.fab);</span><br><span class="line">    fab.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onClick</span>(<span class="params">View view</span>)</span> &#123;</span><br><span class="line">            Snackbar.make(view, <span class="string">&quot;Replace with your own action&quot;</span>, Snackbar.LENGTH_LONG)</span><br><span class="line">                    .setAction(<span class="string">&quot;Action&quot;</span>, <span class="literal">null</span>).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">    ActionBarDrawerToggle toggle = <span class="keyword">new</span> ActionBarDrawerToggle(</span><br><span class="line">            <span class="built_in">this</span>, drawer, toolbar, R.string.navigation_drawer_open, R.string.navigation_drawer_close);</span><br><span class="line">    drawer.addDrawerListener(toggle);</span><br><span class="line">    toggle.syncState();</span><br><span class="line"></span><br><span class="line">    NavigationView navigationView = (NavigationView) findViewById(R.id.nav_view);</span><br><span class="line">    navigationView.setNavigationItemSelectedListener(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onBackPressed</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">    <span class="keyword">if</span> (drawer.isDrawerOpen(GravityCompat.START)) &#123;</span><br><span class="line">        drawer.closeDrawer(GravityCompat.START);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onBackPressed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">boolean</span> <span class="function"><span class="title">onCreateOptionsMenu</span>(<span class="params">Menu menu</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// Inflate the menu; this adds items to the action bar if it is present.</span></span><br><span class="line">    getMenuInflater().inflate(R.menu.navigation, menu);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">boolean</span> <span class="function"><span class="title">onOptionsItemSelected</span>(<span class="params">MenuItem item</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// Handle action bar item clicks here. The action bar will</span></span><br><span class="line">    <span class="comment">// automatically handle clicks on the Home/Up button, so long</span></span><br><span class="line">    <span class="comment">// as you specify a parent activity in AndroidManifest.xml.</span></span><br><span class="line">    int id = item.getItemId();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">    <span class="keyword">if</span> (id == R.id.action_settings) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">super</span>.onOptionsItemSelected(item);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">&quot;StatementWithEmptyBody&quot;</span>)</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">boolean</span> <span class="function"><span class="title">onNavigationItemSelected</span>(<span class="params">MenuItem item</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// Handle navigation view item clicks here.</span></span><br><span class="line">    int id = item.getItemId();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (id == R.id.nav_camera) &#123;</span><br><span class="line">        <span class="comment">// Handle the camera action</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id == R.id.nav_gallery) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (id == R.id.nav_slideshow) &#123;</span><br><span class="line"></span><br><span class="line">    &#125; </span><br><span class="line">    DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);</span><br><span class="line">    drawer.closeDrawer(GravityCompat.START);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>动态修改　headLayout的内容</p>
<pre><code>   View headerLayout = navView.getHeaderView(0);
  TextView tevtView = headerLayout.findViewById(R.id.textView);
  tevtView.setText(&quot;nishiminglema &quot;);
</code></pre>
</li>
</ul>
<p>注意　NavigationView也可以添加头部<br>参考：　　<a href="https://segmentfault.com/a/1190000004151222">https://segmentfault.com/a/1190000004151222</a></p>
<p><a href="https://developer.android.com/reference/android/support/design/widget/NavigationView.html">https://developer.android.com/reference/android/support/design/widget/NavigationView.html</a></p>
<p><a href="https://developer.android.com/reference/android/support/v4/widget/DrawerLayout.html">https://developer.android.com/reference/android/support/v4/widget/DrawerLayout.html</a></p>
<p><a href="https://developer.android.com/training/implementing-navigation/nav-drawer.html?hl=zh-cn">https://developer.android.com/training/implementing-navigation/nav-drawer.html?hl=zh-cn</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>Drawer</tag>
      </tags>
  </entry>
  <entry>
    <title>Network</title>
    <url>/2017/08/03/Network/</url>
    <content><![CDATA[<p><a href="https://www.bilibili.com/video/BV1F54y1t7Dx?from=search&amp;seid=12798261982184143495">https://www.bilibili.com/video/BV1F54y1t7Dx?from=search&amp;seid=12798261982184143495</a></p>
<h4 id="Open-System-Interconnection"><a href="#Open-System-Interconnection" class="headerlink" title="Open System Interconnection"></a>Open System Interconnection</h4><p>OSI 7层模型</p>
<p>TCP/IP 5层模型</p>
<p><img src="/2017/08/03/Network/2021-08-15_10_network.png"></p>
<img src="/2017/08/03/Network/network1.png" style="zoom:33%;">





<h4 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h4><h5 id="protocol"><a href="#protocol" class="headerlink" title="protocol"></a>protocol</h5><p>URI</p>
<blockquote>
<p><a href="ftp://ftp.is.co.za/rfc/rfc1808.txt">ftp://ftp.is.co.za/rfc/rfc1808.txt</a> <a href="http://www.ietf.org/rfc/rfc2396.txt">http://www.ietf.org/rfc/rfc2396.txt</a> </p>
<p>ldap://[2001:db8::7]/c=GB?objectClass?one mailto:<a href="mailto:&#x4a;&#x6f;&#104;&#110;&#46;&#68;&#x6f;&#x65;&#x40;&#101;&#x78;&#x61;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">&#x4a;&#x6f;&#104;&#110;&#46;&#68;&#x6f;&#x65;&#x40;&#101;&#x78;&#x61;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#x6f;&#x6d;</a> </p>
<p>news:comp.infosystems.<a href="http://www.servers.unix/">www.servers.unix</a> </p>
<p>tel:+1-816-555-1212</p>
<p>telnet://192.0.2.16:80/ urn:oasis:names:specification:docbook:dtd:xml:4.1.2</p>
</blockquote>
<h5 id="Http1-1"><a href="#Http1-1" class="headerlink" title="Http1.1"></a>Http1.1</h5><p><a href="https://tools.ietf.org/html/rfc7230#section-6">https://tools.ietf.org/html/rfc7230#section-6</a></p>
<p>HyperText Transfer Protocol 可靠的数据传输协议，基于TCP</p>
<h6 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h6><p><img src="Network/2021-07-21_3.21_http_protical.png"></p>
<h5 id="Http2-0"><a href="#Http2-0" class="headerlink" title="Http2.0"></a>Http2.0</h5><p><a href="https://tools.ietf.org/html/rfc7540">https://tools.ietf.org/html/rfc7540</a></p>
<img src="Network/2021-07-25_5.00_http2.png" style="zoom:50%;">



<p>可以看到http2.0改造了协议， head 改成了 HEADERS frame ,Body 改成了 DATA frame。</p>
<img src="Network/2021-07-25_5.04_http2.png" style="zoom:33%;">

<ul>
<li>Length :  整个frame  开始到结束 </li>
<li>Type :  frame的类型</li>
<li>Stream ID用作流控制</li>
<li>Payload 请求正文</li>
</ul>
<p><a href="https://www.bilibili.com/video/BV1SJ411q7ei?from=search&amp;seid=10178848750670062838">https://www.bilibili.com/video/BV1SJ411q7ei?from=search&amp;seid=10178848750670062838</a></p>
<p><a href="https://www.bilibili.com/video/BV1Sw411d7oE?from=search&amp;seid=10178848750670062838">https://www.bilibili.com/video/BV1Sw411d7oE?from=search&amp;seid=10178848750670062838</a></p>
<h5 id="端口作用"><a href="#端口作用" class="headerlink" title="端口作用"></a>端口作用</h5><p>进程id是会变化的，进程通过绑定固定不变的端口，来实现通信。</p>
<p>http版本区别</p>
<p> <a href="https://juejin.cn/post/6844903489596833800">https://juejin.cn/post/6844903489596833800</a></p>
<h6 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h6><p>对TCP/IP的封装， 提供可供程序员做网络开发的接口-Socket编程接口。</p>
<img src="/2017/08/03/Network/2021-07-21_3.09_UML_HTTP.png" style="zoom: 67%;">

<p>SocketHttpTest.java</p>
<ul>
<li><p>http get请求</p>
<p>按照get请求拼接字符串</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">StringBuffer protocol = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">             <span class="comment">//请求行</span></span><br><span class="line">             protocol.append(<span class="string">&quot;GET &quot;</span>);</span><br><span class="line">             protocol.append(url.getPath());</span><br><span class="line">             protocol.append(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">             protocol.append(url.getQuery());</span><br><span class="line">             protocol.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">             protocol.append(<span class="string">&quot;HTTP/1.1&quot;</span>);</span><br><span class="line">             protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">             <span class="comment">// http请求头</span></span><br><span class="line">             protocol.append(<span class="string">&quot;Host:&quot;</span>);</span><br><span class="line">             protocol.append(url.getHost());</span><br><span class="line">             protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">             <span class="comment">//空行</span></span><br><span class="line">             protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">             <span class="comment">//post请求体 get没有</span></span><br><span class="line">             System.out.println(<span class="string">&quot;发送的http报文: \n&quot;</span> + protocol.toString());</span><br><span class="line">  </span><br><span class="line">             Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">             socket.connect(<span class="keyword">new</span> InetSocketAddress(url.getHost(), <span class="number">80</span>));</span><br><span class="line">  </span><br><span class="line">             <span class="comment">//获得输入输出流</span></span><br><span class="line">             BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(socket.getOutputStream()));</span><br><span class="line">             BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line">  </span><br><span class="line">             bufferedWriter.write(protocol.toString());</span><br><span class="line">             bufferedWriter.flush();</span><br><span class="line">  </span><br><span class="line">             StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">             String line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">             <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                 stringBuilder.append(line)</span><br><span class="line">                         .append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">             &#125;</span><br><span class="line">             System.out.println(stringBuilder.toString());</span><br></pre></td></tr></table></figure></li>
<li><p>Http Post请求</p>
<p>参数放入请求体中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> 						URL url = <span class="keyword">new</span> URL(cUrl);</span><br><span class="line">            StringBuffer protocol = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">            <span class="comment">//请求行</span></span><br><span class="line">            protocol.append(<span class="string">&quot;POST &quot;</span>);</span><br><span class="line">            protocol.append(url.getPath());</span><br><span class="line">            protocol.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            protocol.append(<span class="string">&quot;HTTP/1.1&quot;</span>);</span><br><span class="line">            protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// http请求头</span></span><br><span class="line">            protocol.append(<span class="string">&quot;Host:&quot;</span>);</span><br><span class="line">            protocol.append(url.getHost());</span><br><span class="line">            protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            protocol.append(<span class="string">&quot;Content-Length: 60\r\n&quot;</span>);</span><br><span class="line">            protocol.append(<span class="string">&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//空行</span></span><br><span class="line">            protocol.append(<span class="string">&quot;\r\n&quot;</span>); <span class="comment">// 必须用空行分隔请求体</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//post请求体 get没有</span></span><br><span class="line"><span class="comment">//                protocol.append(&quot;city=&quot;+ URLEncoder.encode(&quot;长沙&quot;,&quot;UTF-8&quot;) +&quot;&amp;key=13cb58f5884f9749287abbead9c658f2&quot;);</span></span><br><span class="line">            protocol.append(url.getQuery());</span><br><span class="line">            System.out.println(<span class="string">&quot;发送的http报文: \n&quot;</span> + protocol.toString());</span><br><span class="line"></span><br><span class="line">            Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">            socket.connect(<span class="keyword">new</span> InetSocketAddress(url.getHost(), <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获得输入输出流</span></span><br><span class="line">            BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(socket.getOutputStream()));</span><br><span class="line">            BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line"></span><br><span class="line">            bufferedWriter.write(protocol.toString());</span><br><span class="line">            bufferedWriter.flush();</span><br><span class="line"></span><br><span class="line">            StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            String line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stringBuilder.append(line)</span><br><span class="line">                        .append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(stringBuilder.toString());</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="分块编码"><a href="#分块编码" class="headerlink" title="分块编码"></a>分块编码</h6><p> 数据量很大！分块编码</p>
<p><img src="/2017/08/03/Network/2021-07-21_3.43_chunk.png"></p>
<p>上面的5就是 下面的字符长度</p>
<h5 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h5><p><a href="https://www.bilibili.com/video/BV1F54y1t7Dx?p=5">https://www.bilibili.com/video/BV1F54y1t7Dx?p=5</a></p>
<p><a href="https://www.bilibili.com/video/BV1j7411H7vV?from=search&amp;seid=12798261982184143495">https://www.bilibili.com/video/BV1j7411H7vV?from=search&amp;seid=12798261982184143495</a></p>
<p><img src="Network/2021-08-15_10_https1.png"></p>
<p><img src="Network/2021-08-15_10_https2.png"></p>
<h4 id="传输层-TCP-UDP"><a href="#传输层-TCP-UDP" class="headerlink" title="传输层  (TCP UDP)"></a>传输层  (TCP UDP)</h4><p>代码运行在用户机器上，为了对 网络层进行更好的控制 UDP(User Datagram Protocol)</p>
<ol>
<li><p>面向报文传输</p>
</li>
<li><p>没有拥塞控制,无法保证数据在网络中是否丢失</p>
</li>
<li><p>UDP首部开销小</p>
<p>​     </p>
</li>
</ol>
<img src="/2017/08/03/Network/udp_datagram.png" alt="传输层" style="zoom:67%;">

<img src="/2017/08/03/Network/udp1.png" alt="udp1" style="zoom: 25%;">

<p>  TCP (Transmission Control Protocol)</p>
<ol>
<li><p> 面向连接的协议</p>
</li>
<li><p> 提供可靠传输</p>
</li>
<li><p> 全双工通信</p>
</li>
<li><p>面向字节流协议: 可能对用户数据合并或分拆进行传输</p>
<p>   <img src="/2017/08/03/Network/tcp1.png" alt="tcp"></p>
</li>
</ol>
<p>TCP首部 <img src="/2017/08/03/Network/tcp2.png" style="zoom: 50%;"></p>
<p> 序号</p>
<p> tcp标记</p>
<h5 id="如何保证TCP可靠传输"><a href="#如何保证TCP可靠传输" class="headerlink" title="如何保证TCP可靠传输?"></a>如何保证TCP可靠传输?</h5><ul>
<li><p>停止等待协议</p>
</li>
<li><p>连续ARQ协议(Automatic Repeat request) :</p>
<p>​        滑动窗口: 以字节为单位，实现流量控制 累计确认</p>
<p>​        选择重传: 重传边界和范围</p>
</li>
<li><p>定时器</p>
<p>超时定时器</p>
<p>坚持定时器: 解决死锁局面,当收到窗口为0的消息，则启动坚持定时器,每隔一段时间发送一个窗口探测报文</p>
<p>TCP协议的拥塞控制</p>
<p> 报文超时即认为拥塞</p>
<p>  慢启动算法</p>
<p>   由小到大逐渐增加发送数据量,直到到达 “慢启动阈值”=&gt;开始 拥塞避免算法</p>
<p> 拥塞避免算法</p>
<p>   只要网络不拥塞，就试探拥塞窗口调大</p>
</li>
</ul>
<h5 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手    "></a>TCP三次握手    <img src="/2017/08/03/Network/tcpblock.png" style="zoom:33%;"></h5><p> TCP标记</p>
 <img src="/2017/08/03/Network/tcp3.png" alt="TCP" style="zoom:33%;">

<p>三次握手 </p>
<img src="/2017/08/03/Network/tcp_handshake.png" alt="shake" style="zoom:33%;">



<h6 id="为何3次握手1"><a href="#为何3次握手1" class="headerlink" title="为何3次握手1"></a>为何3次握手1</h6><p>客户端角度 : 1 ，2，说明客户端的发送和接收没问题</p>
<p>服务端角度： 1，2，说明服务端的接收没问题，但是不确定自己的发送收否有问题，所以需要3确认</p>
<h6 id="为何3次握手2"><a href="#为何3次握手2" class="headerlink" title="为何3次握手2"></a>为何3次握手2</h6><p>第一次握手客户端发出:    Server觉得 : 客户端的发送能力没问题</p>
<p>第二次握手服务端发出:    Client觉得  : 服务端的接收能力没问题， 以及服务端的发送能力没问题。</p>
<p>第三次握手客户端发出:    Server觉得: 客户端的接收能力没问题。</p>
<p><strong>为什么要第三次握手?</strong></p>
<p><img src="https://www.programmersought.com/images/29/378161939bb91ee6a16d6719b5bb381d.png"></p>
<p>只有两次握手的话，一旦第二次握手接收超时，重新发送后就会重新发送，会导致建立2个连接</p>
<img src="/2017/08/03/Network/tcp_handshake2.png" style="zoom: 33%;">

<h5 id="TCP连接的4次挥手"><a href="#TCP连接的4次挥手" class="headerlink" title="TCP连接的4次挥手"></a>TCP连接的4次挥手</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="/2017/08/03/Network/tcp_bye.png" alt="tcp4" style="zoom: 33%;"></h5><ol>
<li><p>由客户端向服务端发起    : 服务端收到信息后,就能确定客户端已经停止发送数据。    </p>
</li>
<li><p>由服务端向客户端发起    : 客户端收到消息后,就能确定服务端已经知道客户端不会再发送数据。这一次是为了TCP可靠传输，确认收到了数据包。</p>
</li>
<li><p>由服务端向客户端发起    : 客户端收到消息后,就能确定服务端已经停止发送数据。此时 服务端数据发送完了。</p>
</li>
<li><p>由客户端向服务端发起    : 服务端收到信息后,就能确定客户端已经知道服务端不会再发送数据。</p>
</li>
</ol>
<ol>
<li>Client: 分手</li>
<li>Server : what</li>
<li>Server : 好吧 分吧</li>
<li>Client : 我已经删微信了； </li>
</ol>
<ul>
<li><p>等待计时器 : 2MSL(Max Segment liftime),</p>
</li>
<li><p>**为什么需要等待计时器?**： 如果第4个挥手报文接收方没收到，那么接收方会重新发送第3次的挥手报文</p>
</li>
<li><p><strong>为什么第3次挥手是接收方发出的?</strong> :  我的理解是，第2次挥手是确认收到的回复，第三次是挥手是确认数据发送完毕，告诉发送方可以断开了,然而我又有了疑问?</p>
</li>
<li><p>为什么需要第4次挥手?</p>
</li>
</ul>
<p><img src="https://pic2.zhimg.com/80/v2-914ad7e22599fd63d2c9434d55d4b6c6_720w.jpg?source=1940ef5c"></p>
<p>小扎和小美通信</p>
<p><a href="https://www.zhihu.com/question/63264012">https://www.zhihu.com/question/63264012</a></p>
<h4 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h4><p> 通过ISP、路由 找到 ,运行在路由器上 rip协议:不太理解</p>
<p>网络配置</p>
<img src="/2017/08/03/Network/2021-08-15_8_netconfig.png" style="zoom:50%;">



<h5 id="主机计算"><a href="#主机计算" class="headerlink" title="主机计算"></a>主机计算</h5><p>IPADDR                    : 192.168.139.10</p>
<p>NETMASK子网掩码 : 255.255.255.0</p>
<p>网络号:    就是上面的IPADDR ,NETMASK进行 与运算, 192.168.139.0,10就是网络中的第10号主机。</p>
<h5 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h5><p><img src="/2017/08/03/Network/2021-08-15_8.30_router.png"></p>
<ol>
<li><p>第一条意思</p>
<p>我这台计算机通过 eth0,不需要任何中间的网关Geteway,久可以访问这个网络(192.168.150.)中的任何计算机，</p>
</li>
</ol>
<h5 id="怎么找到目标主机"><a href="#怎么找到目标主机" class="headerlink" title="怎么找到目标主机"></a>怎么找到目标主机</h5><p>面试题:路由器是怎么找目标服务器</p>
<p><a href="https://www.bilibili.com/video/BV1PU4y1s7Bs?p=18&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1PU4y1s7Bs?p=18&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.bilibili.com/video/BV1PU4y1s7Bs?p=24&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1PU4y1s7Bs?p=24&amp;spm_id_from=pageDriver</a></p>
<ol>
<li><p><a href="http://www.baidu.com通过/">www.baidu.com通过</a> DNS解析得到目标ip地址 61.135.169.121</p>
</li>
<li><p>61.135.169.121和第一条255.255.255.0进行 按位与运算的到的61.135.169.0和192.168.150.0结果不一样，所以该条目被淘汰。</p>
</li>
<li><p>第二条目不用管（好像这个条目有问题），来到第三条，按照步骤2按位与运算，得到结果0.0.0.0，和Destination结果一样。则此时的Gateway起作用。</p>
</li>
<li><p>数据给到下一跳网关，也就是192.168.150.2，如果获得的下一跳网关Gateway是 0.0.0.0的话，那么说明在同一个局域网直接发数据就好了，不用跳了。</p>
</li>
</ol>
<h4 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h4><h5 id="封装成帧"><a href="#封装成帧" class="headerlink" title="封装成帧"></a>封装成帧</h5><h5 id="透明传输"><a href="#透明传输" class="headerlink" title="透明传输"></a>透明传输</h5><h5 id="差错检测"><a href="#差错检测" class="headerlink" title="差错检测"></a>差错检测</h5><p>ARP协议</p>
<p><img src="/2017/08/03/Network/2021-08-15_9_arp.png"></p>
<p>网卡的IP 192.168.150.1     和at后面对应的 网卡mac地址。</p>
<p><img src="/2017/08/03/Network/2021-08-15_arp_demo.png"></p>
<p><img src="/2017/08/03/Network/2021-08-15_9.37_arp_router.png"></p>
<h5 id="网卡pc1到pc5的过程"><a href="#网卡pc1到pc5的过程" class="headerlink" title="网卡pc1到pc5的过程"></a>网卡pc1到pc5的过程</h5><p>网络数据里层存放目标IP地址，外层有下一跳的mac地址。</p>
<p>但是mac地址是怎么来的呢?</p>
<p>就是通过 arp协议,</p>
<ol>
<li>pc1发到pc2路由器,带的数据是1，mac先定义成FFFFFF</li>
<li>pc2接受到后，回传给pc1自己的mac地址，接着上面的传输层步骤4就有了下一跳的mac地址了。</li>
</ol>
<h4 id="物理层-铜线介质类"><a href="#物理层-铜线介质类" class="headerlink" title="物理层: 铜线介质类"></a>物理层: 铜线介质类</h4><ol>
<li><p>数据链路层  ： 相邻两台机器间的连接，把数据报以帧的形式发送, 以太网协议</p>
  <img src="/2017/08/03/Network/Ethernet1.png" style="zoom:67%;">

  <img src="/2017/08/03/Network/Ethernet2.png" style="zoom:67%;"></li>
</ol>
<p><a href="https://www.bilibili.com/video/BV1pA411M7Ai?p=137&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1pA411M7Ai?p=137&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.bilibili.com/video/BV1PU4y1s7Bs?from=search&amp;seid=16016904944562540448">https://www.bilibili.com/video/BV1PU4y1s7Bs?from=search&amp;seid=16016904944562540448</a></p>
<p> <a href="https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</a></p>
<p><a href="https://hpbn.co/brief-history-of-http/">https://hpbn.co/brief-history-of-http/</a></p>
<p><a href="https://www.w3.org/Protocols/History.html">https://www.w3.org/Protocols/History.html</a></p>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP">https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>NewFeatures</title>
    <url>/2017/12/17/NewFeatures/</url>
    <content><![CDATA[<p> ANDROID新特性</p>
<h5 id="apk安装"><a href="#apk安装" class="headerlink" title="apk安装"></a>apk安装</h5><pre><code>   StrictMode API政策
</code></pre>
<ul>
<li>在AndroidManifest.xml添加</li>
</ul>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml">&lt;provider</span></span><br><span class="line"><span class="xml">         android:name=&quot;android.support.v4.content.FileProvider&quot;   </span></span><br><span class="line"><span class="xml">         android:authorities=&quot;$</span><span class="template-variable">&#123;applicationId&#125;</span><span class="xml">.fileProvider&quot;         // com.cqian是包名</span></span><br><span class="line"><span class="xml">         android:grantUriPermissions=&quot;true&quot;</span></span><br><span class="line"><span class="xml">         android:exported=&quot;false&quot;&gt;</span></span><br><span class="line"><span class="xml">         <span class="tag">&lt;<span class="name">meta-data</span> <span class="attr">android:name</span>=<span class="string">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span></span></span><br><span class="line"><span class="xml">             android:resource=&quot;@xml/provider_install&quot;/&gt;</span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;/<span class="name">provider</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>编写provider_install.xml文件　<br> 新建xml指定共享目录</p>
<p> 有下面几种存储方式, name不变，path就是下面得apkCacheFile</p>
</li>
</ul>
<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">&lt;files-<span class="built_in">path</span> <span class="keyword">name</span>=<span class="string">&quot;name&quot;</span> <span class="built_in">path</span>=<span class="string">&quot;path&quot;</span> /&gt; 物理路径相当于Context.getFilesDir() + /<span class="built_in">path</span>/  </span><br><span class="line">  </span><br><span class="line">&lt;cache-<span class="built_in">path</span> <span class="keyword">name</span>=<span class="string">&quot;name&quot;</span> <span class="built_in">path</span>=<span class="string">&quot;path&quot;</span> /&gt; 物理路径相当于Context.getCacheDir() + /<span class="built_in">path</span>/  </span><br><span class="line">  </span><br><span class="line">&lt;external-<span class="built_in">path</span> <span class="keyword">name</span>=<span class="string">&quot;name&quot;</span> <span class="built_in">path</span>=<span class="string">&quot;path&quot;</span> /&gt; 物理路径相当于Environment.getExternalStorageDirectory() + /<span class="built_in">path</span>/  </span><br><span class="line">  </span><br><span class="line">&lt;external-files-<span class="built_in">path</span> <span class="keyword">name</span>=<span class="string">&quot;name&quot;</span> <span class="built_in">path</span>=<span class="string">&quot;path&quot;</span> /&gt; 物理路径相当于Context.getExternalFilesDir(String) + /<span class="built_in">path</span>/  </span><br><span class="line">  </span><br><span class="line">&lt;external-cache-<span class="built_in">path</span> <span class="keyword">name</span>=<span class="string">&quot;name&quot;</span> <span class="built_in">path</span>=<span class="string">&quot;path&quot;</span> /&gt; 物理路径相当于Context.getExternalCacheDir() + /<span class="built_in">path</span>/  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 由于我的存储目录用这个，apkCacheFile是SDk卡上得目录名称</p>
<p> <code>String downFile = context.getExternalCacheDir() + &quot;apkCacheFile&quot;</code> </p>
<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line">&lt;external-cache-<span class="built_in">path</span></span><br><span class="line">     <span class="keyword">name</span>=<span class="string">&quot;name&quot;</span></span><br><span class="line">     <span class="built_in">path</span>=<span class="string">&quot;apkCacheFile&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>安装APK</p>
<p>就这个安装方法</p>
</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> static void install<span class="constructor">Apk(Context <span class="params">context</span>, File <span class="params">apkFile</span>)</span> &#123;</span><br><span class="line">      Intent intent = <span class="keyword">new</span> <span class="constructor">Intent()</span>;</span><br><span class="line">      <span class="comment">// 由于没有在Activity环境下启动Activity,设置下面的标签</span></span><br><span class="line">      intent.add<span class="constructor">Flags(Intent.FLAG_ACTIVITY_NEW_TASK)</span>;</span><br><span class="line">      intent.set<span class="constructor">Action(Intent.ACTION_VIEW)</span>;</span><br><span class="line">      String <span class="keyword">type</span> = <span class="string">&quot;application/vnd.android.package-archive&quot;</span>;</span><br><span class="line"></span><br><span class="line">      Uri uri;</span><br><span class="line">      <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">24</span>) &#123;</span><br><span class="line">          <span class="comment">// 参数2 清单文件中provider节点里面的authorities ; 参数3  共享的文件,即apk包的file类</span></span><br><span class="line">          uri = <span class="module-access"><span class="module"><span class="identifier">FileProvider</span>.</span></span>get<span class="constructor">UriForFile(<span class="params">context</span>, <span class="string">&quot;getPackageName().fileProvider&quot;</span>, <span class="params">apkFile</span>)</span>;</span><br><span class="line">          <span class="comment">//对目标应用临时授权该Uri所代表的文件</span></span><br><span class="line">          intent.add<span class="constructor">Flags(Intent.FLAG_GRANT_READ_URI_PERMISSION)</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          uri = <span class="module-access"><span class="module"><span class="identifier">Uri</span>.</span></span>from<span class="constructor">File(<span class="params">apkFile</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      intent.set<span class="constructor">DataAndType(<span class="params">uri</span>, <span class="params">type</span>)</span>;</span><br><span class="line">      context.start<span class="constructor">Activity(<span class="params">intent</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>




<p><a href="https://developer.android.google.cn/about/versions/nougat/android-7.0-changes.html">https://developer.android.google.cn/about/versions/nougat/android-7.0-changes.html</a></p>
<p><a href="http://blog.csdn.net/github_2011/article/details/74297460">http://blog.csdn.net/github_2011/article/details/74297460</a></p>
<h5 id="图片拍照"><a href="#图片拍照" class="headerlink" title="图片拍照"></a>图片拍照</h5><p>Android P veridex工具使用</p>
<p>win10安装ubuntu</p>
<p><a href="https://www.linuxidc.com/Linux/2018-03/151256.htm">https://www.linuxidc.com/Linux/2018-03/151256.htm</a></p>
<h5 id="对test-apk进行扫描"><a href="#对test-apk进行扫描" class="headerlink" title="对test.apk进行扫描"></a>对test.apk进行扫描</h5><blockquote>
<p>./appcompat.sh –dex-file=test.apk</p>
</blockquote>
<ul>
<li><p>在cmd里敲bash，找到/mnt，你会发现下面有c d e f ，这些就是你win下的硬盘，你可以直接对win下的文件进行操作，包括执行一些linux指令或者编译Linux程序</p>
</li>
<li><p>用mv /mnt/x/a/b-c.zip /home/user/b.zip这类命令</p>
<p>示例:</p>
<p><a href="http://www.10tiao.com/html/227/201812/2650244825/1.html">http://www.10tiao.com/html/227/201812/2650244825/1.html</a></p>
</li>
</ul>
<h5 id="android-11适配"><a href="#android-11适配" class="headerlink" title="android 11适配"></a>android 11适配</h5><p><a href="https://juejin.im/post/6860370635664261128">https://juejin.im/post/6860370635664261128</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>AndroidNewFeatures</tag>
      </tags>
  </entry>
  <entry>
    <title>OKHTTP</title>
    <url>/2017/08/07/OKHTTP/</url>
    <content><![CDATA[<p>Okhttp使用线程池无 核心级线程，不应该先把阻塞队列塞满，再执行非核心级线程吗，这样任何不应该会立即执行呀？？？</p>
<p>阻塞队列用了synchrnized 会添加失败。所以直接创建非核心线程。</p>
<h4 id="如何阅读开源项目"><a href="#如何阅读开源项目" class="headerlink" title="如何阅读开源项目"></a>如何阅读开源项目</h4><p><a href="https://time.geekbang.org/column/article/186778">https://time.geekbang.org/column/article/186778</a></p>
<p><a href="https://www.imooc.com/article/301778">https://www.imooc.com/article/301778</a></p>
<p><a href="https://baixin.ink/2019/05/10/how-to-learn-opensorce-project/">https://baixin.ink/2019/05/10/how-to-learn-opensorce-project/</a></p>
<p><a href="https://www.jianshu.com/p/656dbb97a40f">https://www.jianshu.com/p/656dbb97a40f</a></p>
<p><a href="https://www.codedump.info/post/20200605-how-to-read-code-v2020/">https://www.codedump.info/post/20200605-how-to-read-code-v2020/</a></p>
<p>不管写的怎么样，先把东西弄出来，然后参考别人的写法，做对比</p>
<h4 id="Okhttp优势"><a href="#Okhttp优势" class="headerlink" title="Okhttp优势"></a>Okhttp优势</h4><p><a href="https://square.github.io/okhttp/">https://square.github.io/okhttp/</a></p>
<p>OkHttp is an HTTP client that’s efficient by default:</p>
<ul>
<li>HTTP/2 support allows all requests to the same host to share a socket.</li>
<li>Connection pooling reduces request latency (if HTTP/2 isn’t available).</li>
<li>Transparent GZIP shrinks download sizes.</li>
<li>Response caching avoids the network completely for repeat requests.</li>
</ul>
<h4 id="任务运行图"><a href="#任务运行图" class="headerlink" title="任务运行图"></a>任务运行图</h4><p><img src="/2017/08/07/OKHTTP/2021-07-23_2.26_OKHTTP.png"></p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>一开始看了网上视频，就说Okhttp是自驱动循环调用，相对于AsyncTask的优势就是 并发执行，但是这两条不就矛盾了吗，既然环形链式调用，怎么能并发呢。就从源码中找答案。</p>
<p>Dispatcher.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxRequests = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxRequestsPerHost = <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(AsyncCall call)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; runningCallsForHost(call) &lt; maxRequestsPerHost) &#123;</span><br><span class="line">      runningAsyncCalls.add(call);</span><br><span class="line">      executorService().execute(call);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      readyAsyncCalls.add(call);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>可以看到提交任务 &gt;5时，才会被添加到readyAsyncCalls队列中。&lt;5的任务直接提交。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">promoteCalls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="keyword">return</span>; <span class="comment">// Already running max capacity.</span></span><br><span class="line">  <span class="keyword">if</span> (readyAsyncCalls.isEmpty()) <span class="keyword">return</span>; <span class="comment">// No ready calls to promote.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Iterator&lt;AsyncCall&gt; i = readyAsyncCalls.iterator(); i.hasNext(); ) &#123;</span><br><span class="line">    AsyncCall call = i.next();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (runningCallsForHost(call) &lt; maxRequestsPerHost) &#123;</span><br><span class="line">      i.remove();</span><br><span class="line">      runningAsyncCalls.add(call);</span><br><span class="line">      Log.i(<span class="string">&quot;Dispatcher&quot;</span>, <span class="string">&quot;promoteCalls:  准备队列 &quot;</span>+call.request().tag+<span class="string">&quot; 执行&quot;</span>);</span><br><span class="line">      executorService().execute(call);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="keyword">return</span>; <span class="comment">// Reached max capacity.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>readyAsyncCalls不为空，然后取出一条，再执行，可以看到，默认情况下会有5条环形任务链。</p>
<h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><p><img src="/2017/08/07/OKHTTP/2021-07-24_6.43_interupt.png"></p>
<p>OkHttp的拦截器有：</p>
<ul>
<li>RetryAndFollowUpInterceptor：失败和重定向拦截器；</li>
<li>BridgeInterceptor：负责将http协议必备的请求头加入其中(host),并添加一些默认的行为(gzip),获得结果后，调用cookie接口并解析GZIP数据。</li>
<li>CacheInterceptor：缓存处理相关的拦截器；</li>
<li>ConnectInterceptor： 负责找到或者新建一个连接，并获取对应的socket流；在获得结果后不进行额外的处理。</li>
<li>CallServerInterceptor：进行真正的与服务器的通信，向服务器请求和读响应的拦截器；</li>
</ul>
<h5 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h5><p><a href="https://mp.weixin.qq.com/s/TeQhe4T4wRjdAEPz6Ne45g"><em>okhttp</em> 是如何支持 Http2 的？</a></p>
<p>Handshake则会把服务端支持的Tls版本，加密方式等都带回来，然后会把这个没有验证过的HandShake用X509Certificate去验证证书的有效性。然后会通过Platform去从SSLSocket去获取ALPN的协议支持信息，当后端支持的协议内包含Http2.0时，则就会把请求升级到Http2.0阶段。</p>
<p><a href="https://juejin.cn/post/6898145227765186567">Okhttp连接池是咋实现的?</a></p>
<p>在连接池中找连接的时候会对比连接池中相同host的连接。</p>
<p>如果在连接池中找不到连接的话，会创建连接，创建完后会存储到连接池中。</p>
<p>在把连接放入连接池中时，会把清除操作的任务放入到线程池中执行，删除任务中会判断当前连接有没有在使用中，有没有正在使用通过RealConnection的transmitters集合的size是否为0来判断，如果不在使用中，找出空闲时间最长的连接，如果空闲时间最长的连接超过了keep-alive默认的5分钟或者空闲的连接数超过了最大的keep-alive连接数5个的话，会把存活时间最长的连接从连接池中删除。保证keep-alive的最大空闲时间和最大的连接数</p>
<ul>
<li><p><a href="https://juejin.im/post/5f0452615188252e5522b747">雨露均沾的OkHttp—WebSocket长连接（使用篇）</a> </p>
</li>
<li><p><a href="http://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&mid=2650237860&idx=1&sn=d66e75f6f7752ededdcaa3ce780862d3&chksm=88639acbbf1413dd170ba41a67035c62811b489cfc7a405977ae23254205a6b3acb99358b1f2&scene=38#wechat_redirect"><em>OKHTTP</em>之缓存配置详解</a></p>
</li>
<li><p>OkHttp对于网络请求都有哪些优化</p>
</li>
<li><p>OkHttp框架中都用到了哪些设计模式</p>
<p> <a href="https://www.codetd.com/article/4354895">https://www.codetd.com/article/4354895</a></p>
<p> <a href="https://www.jianshu.com/p/d85e556b8da6">https://www.jianshu.com/p/d85e556b8da6</a></p>
</li>
</ul>
<h5 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h5><p>Okhttp缓存</p>
<p> 1、添加cache 路径<br> 2、初始化OkhttpClient</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewCacheInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         Request request = chain.request();</span><br><span class="line">         Response response = chain.proceed(request);</span><br><span class="line">         Response response1 = response.newBuilder()</span><br><span class="line">                 .removeHeader(<span class="string">&quot;Pragma&quot;</span>)</span><br><span class="line">                 .removeHeader(<span class="string">&quot;Cache-Control&quot;</span>)</span><br><span class="line">                 .header(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=&quot;</span> + <span class="number">3600</span> * <span class="number">24</span> * <span class="number">30</span>)</span><br><span class="line">                 .build();</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> response1;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><a href="https://juejin.cn/post/6873476209737629709/">https://juejin.cn/post/6873476209737629709/</a></p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html</a></p>
<p><a href="http://blog.csdn.net/briblue/article/details/52920531">http://blog.csdn.net/briblue/article/details/52920531</a><br><a href="http://mushuichuan.com/2016/03/01/okhttpcache/">http://mushuichuan.com/2016/03/01/okhttpcache/</a></p>
<p><a href="https://www.mocklab.io/blog/which-java-http-client-should-i-use-in-2020/">https://www.mocklab.io/blog/which-java-http-client-should-i-use-in-2020/</a></p>
<p><a href="https://www.bilibili.com/video/BV12Q4y1d7uD?p=7&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV12Q4y1d7uD?p=7&amp;spm_id_from=pageDriver</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>OS_PROCESS</title>
    <url>/2020/08/17/OS-PROCESS/</url>
    <content><![CDATA[<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>进程有很大的独立性</p>
<p>为了实现进程模型，操作系统维护着一张表格，进程表。每个进程占用一个进程表项。</p>
<h4 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h4><h5 id="进程通信方式"><a href="#进程通信方式" class="headerlink" title="进程通信方式"></a>进程通信方式</h5><pre><code>文件
AIDL （基于 Binder）
    Android 进阶：进程通信之 AIDL 的使用
    Android 进阶：进程通信之 AIDL 解析
Binder
    Android 进阶：进程通信之 Binder 机制浅析
Messenger （基于 Binder）
    Android 进阶：进程通信之 Messenger 使用与解析 
ContentProvider （基于 Binder）
    Android 进阶：进程通信之 ContentProvider 内容提供者 
Socket
    Android 进阶：进程通信之 Socket （顺便回顾 TCP UDP）
</code></pre>
<p><img src="https://img-blog.csdn.net/20170605011532312?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMTI0MDg3Nw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><br>原文链接：<a href="https://blog.csdn.net/u011240877/article/details/72863432">https://blog.csdn.net/u011240877/article/details/72863432</a></p>
<p><img src="/2020/08/17/OS-PROCESS/2021-08-17_COMM_TYPE.png"></p>
<p>管道通信</p>
<p>无名管道， 有名管道:文件系统中有这样一个文件名</p>
<p>信号通信： </p>
<h5 id="进程通信的思想"><a href="#进程通信的思想" class="headerlink" title="进程通信的思想"></a>进程通信的思想</h5><p><img src="/2020/08/17/OS-PROCESS/2021-08-17_INTER_THINK.png"></p>
<p><strong>共享内存</strong></p>
<p> 共享存储允许不相关的进程访问同一片物理内存</p>
<p>共享内存是两个进程之间共享和传递数据最快的方式</p>
<p>共享内存未提供同步机制，需要借助其他机制管理访问</p>
<p>共享存储是两个进程之间共享和传递数据最快的一种方式</p>
<p>共享内存未提供同步机制，需要借助其他机制管理访问</p>
<p><strong>Unix域套接字</strong></p>
<p>域套接字是一种高级的进程间通信的方法</p>
<p>Unix域套接字可以用于同一机器进程间通信</p>
<p><a href="https://www.bilibili.com/video/BV1tJ41117ty?from=search&amp;seid=13006387505737298314">https://www.bilibili.com/video/BV1tJ41117ty?from=search&amp;seid=13006387505737298314</a></p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
  </entry>
  <entry>
    <title>OnClick</title>
    <url>/2020/03/16/OnClick/</url>
    <content><![CDATA[<p>点击抖动</p>
<p><a href="https://www.jianshu.com/p/483d6ae21322">https://www.jianshu.com/p/483d6ae21322</a></p>
<p><a href="https://juejin.im/post/5bffbcbf5188255b5d59705e">https://juejin.im/post/5bffbcbf5188255b5d59705e</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>PMS</title>
    <url>/2020/08/07/PMS/</url>
    <content><![CDATA[<p>PMS</p>
<p><img src="/2020/08/07/PMS/2021-08-07_8.27_pms.png"></p>
<h5 id="PMS服务是干什么的"><a href="#PMS服务是干什么的" class="headerlink" title="PMS服务是干什么的"></a>PMS服务是干什么的</h5><ol>
<li>管理 加载  缓存APK文件，把APK文件加载成package对象，缓存到mPackages中</li>
<li>当AMS需要加载Activity时，PMS提供对应的信息(javabean)</li>
</ol>
<h5 id="PMS是谁启动的"><a href="#PMS是谁启动的" class="headerlink" title="PMS是谁启动的"></a>PMS是谁启动的</h5><p>SystemServer</p>
<h5 id="PMS扫描是为了什么"><a href="#PMS扫描是为了什么" class="headerlink" title="PMS扫描是为了什么"></a>PMS扫描是为了什么</h5><p>以空间换时间</p>
<h5 id="PMS启动应用，会发生什么"><a href="#PMS启动应用，会发生什么" class="headerlink" title="PMS启动应用，会发生什么"></a>PMS启动应用，会发生什么</h5><ol>
<li>通过包名，找到对应的apk文件</li>
<li>解压apk文件</li>
<li>经过dom解析，找到Launcher对应的activity</li>
<li>再反射加载</li>
<li>app启动成功。</li>
</ol>
]]></content>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>Package-signature</title>
    <url>/2017/09/21/Package-signature/</url>
    <content><![CDATA[<h4 id="Apk打包流程"><a href="#Apk打包流程" class="headerlink" title="Apk打包流程"></a>Apk打包流程</h4><img src="/2017/09/21/Package-signature/2021-08-01_3.apk_package.png" style="zoom:50%;">







<h2 id="相同签名-不同包名问题"><a href="#相同签名-不同包名问题" class="headerlink" title="相同签名 不同包名问题"></a>相同签名 不同包名问题</h2><p>现在把项目重新生成签名，然后安装，安装后会安装失败，因为和以前的app冲突</p>
<p>应用安装后会在data/data 目录生成和包名一样的文件夹</p>
<p>虽然生成了了新的签名但是会覆盖</p>
<h2 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h2><p>android studio更新了新版本 打包的时候v1和v2都需要勾选才能安装</p>
<p><a href="http://blog.h5min.cn/daihuimaozideren/article/details/77842549">http://blog.h5min.cn/daihuimaozideren/article/details/77842549</a></p>
<h2 id="walle打包"><a href="#walle打包" class="headerlink" title="walle打包"></a>walle打包</h2><p>生成渠道包</p>
<ul>
<li>生成渠道包 ./gradlew clean assembleReleaseChannels </li>
<li>支持 productFlavors ./gradlew clean<br>  assembleMeituanReleaseChannels</li>
</ul>
<p><a href="https://github.com/Meituan-Dianping/walle">https://github.com/Meituan-Dianping/walle</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>PerformancePatterns</title>
    <url>/2017/08/16/PerformancePatterns/</url>
    <content><![CDATA[<p> 性能优化</p>
<h2 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h2><p><a href="https://www.jianshu.com/p/ee9e4b8cb95f">https://www.jianshu.com/p/ee9e4b8cb95f</a></p>
<h2 id="ANR"><a href="#ANR" class="headerlink" title="ANR"></a>ANR</h2><p>  全称 Application Nor Responding,在debug的时候经常会出现的一个框框，询问关闭或等待，在正常环境下出现的情况<br>  *　主线程IO 操作<br>  *　主线程耗时任务<br>  *　主线程错误的操作 Thread.wait或Thread.sleep<br>    Android系统监控程序的响应状况，出现下面两种情况弹出ANR对话框<br>    *应用在5秒内未响应用户的输入事件(按键或者触摸)<br>    *BroadcastReceiver未在　10秒内完成相关的处理</p>
<h2 id="AndroidStudio-Profiler工具"><a href="#AndroidStudio-Profiler工具" class="headerlink" title="AndroidStudio Profiler工具"></a>AndroidStudio Profiler工具</h2><p><a href="https://www.youtube.com/watch?v=qJ1QLgiL24o">这个视频</a> 讲解了找出内存泄漏的步骤　<br>还有AndroidStudio3.0的<a href="https://www.jianshu.com/p/bdfd2a6b2681">图文方法</a> </p>
<h2 id="leakcanary"><a href="#leakcanary" class="headerlink" title="leakcanary"></a>leakcanary</h2><p><a href="https://github.com/square/leakcanary">https://github.com/square/leakcanary</a></p>
<p>图片处理</p>
<p><a href="https://developer.android.com/topic/performance/graphics/index.html">https://developer.android.com/topic/performance/graphics/index.html</a><br><a href="https://developer.android.com/topic/performance/graphics/load-bitmap.html#read-bitmap">https://developer.android.com/topic/performance/graphics/load-bitmap.html#read-bitmap</a></p>
<ul>
<li><p>apk size</p>
<p><a href="https://mp.weixin.qq.com/s/jnZpgaRFQT5ULk9tHWMAGg">https://mp.weixin.qq.com/s/jnZpgaRFQT5ULk9tHWMAGg</a></p>
</li>
</ul>
<p><a href="https://www.jianshu.com/p/fba7b43bdc9c">https://www.jianshu.com/p/fba7b43bdc9c</a></p>
<p>性能优化</p>
<p><a href="https://mp.weixin.qq.com/s/ceXsH06fUFa7y4lzi4uXzw">https://mp.weixin.qq.com/s/ceXsH06fUFa7y4lzi4uXzw</a></p>
<p><a href="https://mp.weixin.qq.com/s/xqrGukIqA2zpGsGzah2EzA">https://mp.weixin.qq.com/s/xqrGukIqA2zpGsGzah2EzA</a></p>
<p>包体积优化</p>
<p><a href="https://juejin.im/post/6854573210408189960">https://juejin.im/post/6854573210408189960</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Permission</title>
    <url>/2017/12/02/Permission/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/training/permissions/requesting">https://developer.android.com/training/permissions/requesting</a></p>
<p><a href="https://developer.android.com/guide/topics/permissions/overview#normal-dangerous">https://developer.android.com/guide/topics/permissions/overview#normal-dangerous</a></p>
<h4 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h4><h5 id="Normal-permissions"><a href="#Normal-permissions" class="headerlink" title="Normal permissions"></a>Normal permissions</h5><h5 id="Dangerous-permissions"><a href="#Dangerous-permissions" class="headerlink" title="Dangerous permissions"></a>Dangerous permissions</h5><img src="/2017/12/02/Permission/Screen Shot 2020-09-17 at 2.06.37 PM.png" alt="Screen Shot 2020-09-17 at 2.06.37 PM" style="zoom: 80%;">

<h4 id="Android11权限申请"><a href="#Android11权限申请" class="headerlink" title="Android11权限申请"></a>Android11权限申请</h4><p>申请位置权限，先申请前台，后申请后台权限。</p>
<p><a href="https://zhuanlan.zhihu.com/p/275758740">https://zhuanlan.zhihu.com/p/275758740</a></p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PERMISSION_REQUEST_CODE = <span class="number">1000</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">requestPermission</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Here, thisActivity is the current activity</span></span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.M) &#123;</span><br><span class="line">            <span class="comment">//则每次执行需要这一权限的操作时您都必须检查自己是否具有该权限</span></span><br><span class="line">            <span class="keyword">if</span> (ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                <span class="comment">// Should we show an explanation?</span></span><br><span class="line">                <span class="keyword">if</span> (ActivityCompat.shouldShowRequestPermissionRationale(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE)) &#123;</span><br><span class="line"><span class="comment">//                            当某条权限之前已经请求过，并且用户已经拒绝了该权限时</span></span><br><span class="line">                    <span class="comment">//异步向用户显示解释，这里先弹出解释框，再请求权限.</span></span><br><span class="line">                    Log.d(TAG, <span class="string">&quot;用户看到解释后，再次常识请求权限&quot;</span>);</span><br><span class="line">                    ActivityCompat.requestPermissions(<span class="keyword">this</span>, <span class="keyword">new</span> String[]&#123;Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;, PERMISSION_REQUEST_CODE);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//无需解释，首次请求许可</span></span><br><span class="line">                    ActivityCompat.requestPermissions(<span class="keyword">this</span>, <span class="keyword">new</span> String[]&#123;Manifest.permission.WRITE_EXTERNAL_STORAGE&#125;, PERMISSION_REQUEST_CODE);</span><br><span class="line">                    Log.d(TAG, <span class="string">&quot;requestPermissions&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//权限已经授予</span></span><br><span class="line">                Log.d(TAG, <span class="string">&quot;requestPermissions is ok&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line">        <span class="keyword">switch</span> (requestCode) &#123;</span><br><span class="line">            <span class="keyword">case</span> PERMISSION_REQUEST_CODE: &#123;</span><br><span class="line">                <span class="comment">// If request is cancelled, the result arrays are empty. 如果取消请求，则grantResult 为空</span></span><br><span class="line">                <span class="keyword">if</span> (grantResults.length &gt; <span class="number">0</span> &amp;&amp; grantResults[<span class="number">0</span>] == PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">&quot;onRequestPermissionResult:ok&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">&quot;onRequestPermissionResult:no&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<blockquote>
<p>注意:需要在androidmanifest.xml声明 否则一直返回false</p>
</blockquote>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span> /&gt;</span><br><span class="line">&lt;uses-permission android:<span class="built_in">name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>1、检查权限是否授予。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Activity</span>.</span></span>java</span><br><span class="line">public <span class="built_in">int</span> check<span class="constructor">SelfPermission(<span class="params">permission</span>)</span></span><br></pre></td></tr></table></figure>

<p>2、申请权限。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">Activity</span>.</span></span>java    </span><br><span class="line">public final void request<span class="constructor">Permissions( <span class="params">new</span> String[<span class="params">permission1</span>,<span class="params">permission2</span>,<span class="operator">...</span>], <span class="params">requestCode</span>)</span></span><br></pre></td></tr></table></figure>

<p>这个时候，会弹出系统授权弹窗（<strong>授权弹窗是不支持自定义的，原因理所当然</strong>）。</p>
<p>3、权限回调。</p>
<p>用户在系统弹窗里面选择后，结果会通过<code>Activity</code>的 <code>onRequestPermissionsResult</code>方法回调APP。</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, <span class="keyword">String</span>[] permissions, <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//继续执行逻辑或者提示权限获取失败</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、权限说明。</p>
<p>用户如果选择了拒绝，下一次在需要声明该权限的时候，Google建议APP开发者给予用户更多的说明，因此提供了下面这个API,<strong>这个方法返回值在使用过程中会发现有点纠结（具体解析见下面代码块说明）</strong>。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">boolean</span> shouldShowRequestPermissionRationale(permission)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="number">1</span>、APP没有申请这个权限的话，返回<span class="literal">false</span></span><br><span class="line">    <span class="number">2</span>、用户拒绝时，勾选了不再提示的话，返回<span class="literal">false</span></span><br><span class="line">    <span class="number">3</span>、用户拒绝，但是没有勾选不再提示的话，返回<span class="literal">true</span></span><br><span class="line">    因此如果想在第一次就给用户提示，需要记录权限是否申请过，没有申请过的话，强制弹窗提示，而不能根据这个方法的返回值来。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个 看情况选用</p>
<p>参考 <a href="https://juejin.im/entry/58b2e490ac502e0069d9ae62">https://juejin.im/entry/58b2e490ac502e0069d9ae62</a></p>
<p><a href="https://developer.android.com/guide/topics/security/permissions?hl=zh-cn#normal-dangerous">https://developer.android.com/guide/topics/security/permissions?hl=zh-cn#normal-dangerous</a></p>
<p><a href="http://www.10tiao.com/html/227/201610/2650237473/1.html">http://www.10tiao.com/html/227/201610/2650237473/1.html</a></p>
<h4 id="PERMISSION"><a href="#PERMISSION" class="headerlink" title="PERMISSION"></a>PERMISSION</h4><p>​      </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这个权限用于进行网络定位--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_COARSE_LOCATION&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 这个权限用于访问GPS定位--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_FINE_LOCATION&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 用于访问wifi网络信息，wifi信息会用于进行网络定位--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_WIFI_STATE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 获取运营商信息，用于支持提供运营商信息相关的接口--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.ACCESS_NETWORK_STATE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 这个权限用于获取wifi的获取权限，wifi信息会用来进行网络定位--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.CHANGE_WIFI_STATE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 用于读取手机当前的状态--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.READ_PHONE_STATE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 写入扩展存储，向扩展卡写入数据，用于写入离线定位数据--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 访问网络，网络定位需要上网--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.INTERNET&quot;</span> /&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- SD卡读取权限，用户写入离线定位数据--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">permission</span> <span class="attr">android:name</span>=<span class="string">&quot;android.permission.MOUNT_UNMOUNT_FILESYSTEMS&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">permission</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="One-time-permissions"><a href="#One-time-permissions" class="headerlink" title="One-time permissions"></a>One-time permissions</h5><p>Starting in Android 11 (API level 30), whenever your app requests a permission related to location, microphone, or camera, the user-facing permissions dialog contains an option called <strong>Only this time</strong>. If the user selects this option in the dialog, your app is granted a temporary <em>one-time permission</em>.</p>
<h5 id="Permission-groups"><a href="#Permission-groups" class="headerlink" title="Permission groups"></a>Permission groups</h5><ul>
<li><p>If the app has already been granted another dangerous permission in the same permission group, the system immediately grants the permission without any interaction with the user. For example, if an app had previously requested and been granted the <code>READ_CONTACTS</code> permission, and it then requests <code>WRITE_CONTACTS</code>, the system immediately grants that permission without showing the permissions dialog to the user.</p>
</li>
<li><p><strong>Caution:</strong> Future versions of the Android SDK might move a particular permission from one group to another. Therefore, don’t base your app’s logic on the structure of these permission groups.</p>
<p>For example, <code>READ_CONTACTS</code> is in the same permission group as <code>WRITE_CONTACTS</code> as of Android 8.1 (API level 27). If your app requests the <code>READ_CONTACTS</code> permission, and then requests the <code>WRITE_CONTACTS</code> permission, don’t assume that the system can automatically grant the <code>WRITE_CONTACTS</code> permission.</p>
</li>
</ul>
<h4 id="多权限申请"><a href="#多权限申请" class="headerlink" title="多权限申请"></a>多权限申请</h4><p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher">https://github.com/permissions-dispatcher/PermissionsDispatcher</a></p>
<p><a href="https://github.com/googlesamples/android-RuntimePermissions">https://github.com/googlesamples/android-RuntimePermissions</a></p>
<p><a href="https://www.jianshu.com/p/a51593817825">https://www.jianshu.com/p/a51593817825</a></p>
<p><a href="https://developer.android.com/training/permissions/requesting">https://developer.android.com/training/permissions/requesting</a></p>
<p>livedata</p>
<p><a href="https://mp.weixin.qq.com/s/Hw_FI0GRpUDWJ1NwjK652w">https://mp.weixin.qq.com/s/Hw_FI0GRpUDWJ1NwjK652w</a></p>
<p><a href="https://mp.weixin.qq.com/s/7RpGzTjXo9rnHRCVEnrYWQ">https://mp.weixin.qq.com/s/7RpGzTjXo9rnHRCVEnrYWQ</a></p>
<p><a href="https://mp.weixin.qq.com/s/i8K-6CSxYuLanR4x1WNSGA">https://mp.weixin.qq.com/s/i8K-6CSxYuLanR4x1WNSGA</a></p>
<p><a href="https://mp.weixin.qq.com/s/gaSmpT5UQLqNa4Ck0r0eOg">https://mp.weixin.qq.com/s/gaSmpT5UQLqNa4Ck0r0eOg</a></p>
<p><a href="http://blog.csdn.net/huaiyiheyuan/article/details/52473984">http://blog.csdn.net/huaiyiheyuan/article/details/52473984</a><br><a href="https://developer.android.com/training/permissions/requesting.html">https://developer.android.com/training/permissions/requesting.html</a></p>
<h4 id="Android-10权限"><a href="#Android-10权限" class="headerlink" title="Android 10权限"></a>Android 10权限</h4><p>在后台运行时访问设备位置信息需要权限</p>
<p><code> &lt;uses-permission android:name=&quot;android.permission.ACCESS_BACKGROUND_LOCATION&quot;/&gt;</code>        </p>
<p>该权限允许应用程序在后台访问位置。如果请求此权限，则还必须请求<code>ACCESS_FINE_LOCATION</code> 或 <code>ACCESS_COARSE_LOCATION</code>权限。只请求此权限无效果</p>
<p>在Android 10的设备上，如果你的应用的 <code>targetSdkVersion</code> &lt; 29，则在请求<code>ACCESS_FINE_LOCATION</code> 或<code>ACCESS_COARSE_LOCATION</code>权限时，系统会自动同时请求<code>ACCESS_BACKGROUND_LOCATION</code>。在请求弹框中，选择“始终允许”表示同意后台获取位置信息，选择“仅在应用使用过程中允许”或”拒绝”选项表示拒绝授权。</p>
<p>如果你的应用的 <code>targetSdkVersion</code> &gt;= 29，则请求<code>ACCESS_FINE_LOCATION</code> 或 <code>ACCESS_COARSE_LOCATION</code>权限表示在前台时拥有访问设备位置信息的权限。在请求弹框中，选择“始终允许”表示前后台都可以获取位置信息，选择“仅在应用使用过程中允许”只表示拥有前台的权限。</p>
<p><a href="https://developer.android.com/about/versions/10/privacy/changes">https://developer.android.com/about/versions/10/privacy/changes</a></p>
<p><a href="https://juejin.im/post/6844904073024503822#heading-5">https://juejin.im/post/6844904073024503822#heading-5</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Popupwindow</title>
    <url>/2019/03/26/Popupwindow/</url>
    <content><![CDATA[<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="showAtLocation"><a href="#showAtLocation" class="headerlink" title="showAtLocation"></a>showAtLocation</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public void show<span class="constructor">AtLocation(View <span class="params">parent</span>, <span class="params">int</span> <span class="params">gravity</span>, <span class="params">int</span> <span class="params">x</span>, <span class="params">int</span> <span class="params">y</span>)</span> &#123;</span><br><span class="line">       mParentRootView = <span class="keyword">new</span> WeakReference&lt;&gt;(parent.get<span class="constructor">RootView()</span>);</span><br><span class="line">       show<span class="constructor">AtLocation(<span class="params">parent</span>.<span class="params">getWindowToken</span>()</span>, gravity, x, y);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>gravity 9种情况</p>
<p>从 parent.getRootView()可以看到 parentview就是整个屏幕</p>
<p>Gravity.NO_GRAVITY ：显示效果同 Gravity.LEFT | Gravity.TOP<br>Gravity.LEFT：以屏幕左边中间位置为圆点<br>Gravity.TOP：以屏幕顶部中间位置为参照物<br>Gravity.RIGHT：以屏幕右侧中间位置为参照物<br>Griavity.BOTTOM：以屏幕底部中间为参照物<br>Gravity.LEFT | Gravity.TOP：以屏幕左上角为参照物<br>Gravity.RIGHT | Gravity.TOP ：以屏幕右上角为参照物<br>Gravity.LEFT | Gravity.BOTTOM ：以屏幕左下角为参照物<br>Gravity.RIGHT | Gravity.BOTTOM ：以屏幕右下角为参照物<br>x ：x &lt; 0时，向左偏移， x &gt;0 时，向右偏移</p>
<p>y ：显示效果受gravity参数影响。当参数不带Gravity.BOTTOM时，y &lt; 0，向上偏移， y &gt; 0 ，向下偏移；当参数带有Gravity.BOTTOM时, y &lt; 0,向下偏移，y &gt; 0，向下偏移</p>
</li>
</ul>
<p>  原文：<a href="https://blog.csdn.net/Justwen26/article/details/61621076">https://blog.csdn.net/Justwen26/article/details/61621076</a> </p>
<h5 id="showAsDropDown"><a href="#showAsDropDown" class="headerlink" title="showAsDropDown"></a>showAsDropDown</h5><figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">public void showAsDropDown(View <span class="built_in">anchor</span>, int xoff, int yoff) &#123;</span><br><span class="line">    showAsDropDown(<span class="built_in">anchor</span>, xoff, yoff, DEFAULT_ANCHORED_GRAVITY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>弹窗会显示在anchor控件的正下方。</li>
</ul>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>PrincipleComputer</title>
    <url>/2019/04/08/PrincipleComputer/</url>
    <content><![CDATA[<p><img src="/2019/04/08/PrincipleComputer/computer_overview.png"></p>
<h4 id="进制运算的基本知识"><a href="#进制运算的基本知识" class="headerlink" title="进制运算的基本知识"></a>进制运算的基本知识</h4><h5 id="整数二进制"><a href="#整数二进制" class="headerlink" title="整数二进制"></a>整数二进制</h5><p>2进制转10进制： 重复除2取余数</p>
<h5 id="小数二进制"><a href="#小数二进制" class="headerlink" title="小数二进制 :"></a>小数二进制 :</h5><p>𝑁= 0.11001 =1∗2−1+1∗2−2+1∗2−5=0.78125=25 / 32</p>
<p>(小数)十进制转换二进制:重复相乘法</p>
<p><img src="/2019/04/08/PrincipleComputer/caculate_binary_01.png"></p>
<h4 id="二进制数据的表示方法"><a href="#二进制数据的表示方法" class="headerlink" title="二进制数据的表示方法"></a>二进制数据的表示方法</h4><h5 id="原码"><a href="#原码" class="headerlink" title="原码"></a>原码</h5><ul>
<li>原码表示法</li>
</ul>
<ol>
<li>使用0表示正数、1表示负数</li>
<li>规定符号位位于数值第一位</li>
<li>表达简单明了，是人类最容易理解的表示法</li>
</ol>
<p>0有两种表示方法:00 , 10</p>
<ul>
<li>缺陷</li>
</ul>
<p>但是原码表示法有缺陷</p>
<p><strong>希望找到不同符号操作数更加简单的运算方法</strong></p>
<p><strong>希望找到使用正数代替负数的方法</strong></p>
<p><strong>使用加法操作代替减法操作，从而消除减法</strong>    </p>
<h5 id="阶码-尾数"><a href="#阶码-尾数" class="headerlink" title="阶码 尾数"></a>阶码 尾数</h5><p><img src="/2019/04/08/PrincipleComputer/JiemaWeiShu.png"></p>
<h5 id="补码"><a href="#补码" class="headerlink" title="补码"></a>补码</h5><p>补码表示法</p>
<p><img src="/2019/04/08/PrincipleComputer/complementcode.png"></p>
<ul>
<li><p>例子2:  x=-13，计算x的二进制原码和补码</p>
<p>原码:x=1,1101</p>
<p>补码:2^(𝑛+1) + 𝑥 = 2^(4+1) − 13 = 100000 − 1101 = <u>1</u>,0011 </p>
<p>​                                                                                1是符号位</p>
<p>补码:x=1,0011</p>
</li>
<li><p>例子3:   x=-7，计算x的二进制原码和补码</p>
<p>原码:x=1,0111</p>
<p>补码:2^(𝑛+1) + 𝑥 = 2^(4+1) − 7 = <u>100000 − 0111</u> = 11001</p>
<p>​        补码:x=1,1001</p>
</li>
<li><p>缺陷</p>
<p>还是同样的问题,</p>
<p><strong>希望找到使用正数代替负数的方法</strong>$$</p>
<p><strong>使用加法操作代替减法操作，从而消除减法</strong></p>
<p>在计算补码的过程中，还是使用了减法!!</p>
</li>
</ul>
<h5 id="反码"><a href="#反码" class="headerlink" title="反码"></a>反码</h5><p><img src="/2019/04/08/PrincipleComputer/FANMA.png"></p>
<ul>
<li><p><strong>引进补码的目的</strong></p>
<p>减法运算复杂，希望找到使用正数替代负数的方法</p>
<p>使用加法代替减法操作，从而消除减法</p>
</li>
<li><p>例子1:    x=-13，计算x的二进制原码和,反码,补码</p>
<p>原码:      x=1,1101</p>
<p>反码:    2^(𝑛+1)−1 + 𝑥 = (2^(4+1)−1) − 13 = 011111 − 1101 = <u>1</u>0010</p>
<p>​            反码:x=1,0010</p>
<p>补码:    2^(𝑛+1) + 𝑥 = 2^(4+1) − <u>13 = 100000 − 11</u>01 = 10011</p>
</li>
<li><p>例子2:x=-7，计算x的二进制原码和反码</p>
<p>原码:x=1,0111</p>
<p>反码:2^(𝑛+1) + 𝑥 = 2^(4+1) − 7 = 011111 − 0111 = <u>1</u>1000</p>
<p>​        反码:x=1,1000</p>
</li>
<li><p>反码表示法</p>
<p><img src="/2019/04/08/PrincipleComputer/FANMA2.png"></p>
<p><strong>负数的反码</strong>等于原码除符号位外按位取反</p>
<p><strong>负数的补码</strong>= (反码+1)                </p>
</li>
<li><p>例子3:x=-7，计算x的二进制原码和反码和补码</p>
<p>原码:x=1,0111                    反码:x=1,1000.         补码:x=1,1001        </p>
</li>
<li><p>例子4:x=-9，计算x的二进制原码和反码和补码</p>
<p>原码:x=1,1001                    反码:x=1,0110         补码:x=1,0111    </p>
<p>​                </p>
<p><img src="/2019/04/08/PrincipleComputer/fanma03.png"></p>
</li>
</ul>
<h5 id="小数的补码"><a href="#小数的补码" class="headerlink" title="小数的补码"></a>小数的补码</h5><p>小数的补码 反码规则和整数一样，原码的方式按照 小数二进制 先算出来</p>
<ul>
<li><p>例子1: x= 9/16 ，计算x的二进制原码和反码和补码</p>
<p>原码:x=0,0.1001        反码:x= 0,0.1001            补码:x= 0,0.1001</p>
</li>
<li><p>例子2:x=- ，计算x的二进制原码和反码和补码</p>
<p>原码:x=1,0.01011    反码:x=1,1.10100             补码:x=1,1.10101</p>
</li>
</ul>
<h4 id="二进制数据的运算"><a href="#二进制数据的运算" class="headerlink" title="二进制数据的运算"></a>二进制数据的运算</h4><h5 id="定点数的加法运算"><a href="#定点数的加法运算" class="headerlink" title="定点数的加法运算"></a><strong>定点数的加法运算</strong></h5><p>整数加法: A 补 + B 补 = 𝐴 + 𝐵 补 (𝑚𝑜𝑑2𝑛+1)</p>
<p>小数加法: A补 +B补 = 𝐴+𝐵 补(𝑚𝑜𝑑2)</p>
<p>数值位与符号位一同运算，并将符号位产生的进位自然丢掉                         </p>
<ul>
<li><p>例子1:    A=-110010， B=001101，求A+B</p>
<p>A[补] = 1,001110     =&gt;     A[原] = 1,110010 =&gt; A[反]= 1,001101            </p>
<p>B 补 = B[原] = 0,001101                </p>
<p>A 补 +B 补 =(A+B) 补 =1,011011 </p>
<p>A + B = −100101                    <img src="/2019/04/08/PrincipleComputer/computer_principle.png" style="zoom:33%;"></p>
</li>
<li><p>例子2:A=-0.1010010， B=0.0110100，求A+B</p>
<p>A[补] = 1,1.0101110</p>
<p>B 补 = B[原] = 0,0.0110100</p>
<p>A 补 +B 补 =(A+B) 补 =1,1.1100010 </p>
<p>A + B =-0.0011110                    <img src="/2019/04/08/PrincipleComputer/computer_principle02.png" style="zoom: 67%;"></p>
</li>
<li><p>例子4 ： A=-10010000， B=-11010000，求A+B</p>
<p>A补 =1,01110000</p>
<p>B补 =1,00110000        </p>
<p> A 补 +B 补 =(A+B) 补 =0,10100000</p>
<p> A + B = 10100000        A + B = 160</p>
<p>A = −144    B = −208            <img src="/2019/04/08/PrincipleComputer/computer_principle04.png" style="zoom: 67%;"></p>
<p>发生了溢出 : A</p>
</li>
<li><p><strong>判断溢出</strong></p>
<p> 双符号位判断法</p>
<p>**单符号位表示变成双符号位:**<strong>0=&gt;00,1=&gt;11</strong></p>
<p><strong>双符号位产生的进位丢弃</strong></p>
<p><strong>结果的双符号位不同则表示溢出</strong></p>
</li>
<li><p>例子4:A=-10010000， B=-11010000，求A+B</p>
<p>A补 =1,01110000    </p>
<p>B补 =1,00110000</p>
<p>A 补 +B 补 =(A+B) 补 =<u>10</u>,10100000        双符号位不同，表示溢出    </p>
<p><img src="/2019/04/08/PrincipleComputer/computer_principle04.png" style="zoom: 67%;">              符号位进位舍去</p>
</li>
<li><p>例子3:A=-10010000， B=-01010000，求A+B</p>
<p>A补 =1,01110000</p>
<p>B补 =1,10110000</p>
<p>A 补 +B 补 =(A+B) 补 =<u>11,</u>00100000     双符号位相同，没有溢出</p>
<p>(A+B)[原] = 11,11100000 = −11100000</p>
</li>
</ul>
<h5 id="定点数的减法运算"><a href="#定点数的减法运算" class="headerlink" title="定点数的减法运算"></a><strong>定点数的减法运算</strong></h5><p>整数减法: A补 −B补 =𝐴+(−𝐵)补(𝑚𝑜𝑑2𝑛+1)</p>
<p>小数减法: A 补 −B 补 =𝐴+(−𝐵) 补 (𝑚𝑜𝑑2)</p>
<p>-B[补]等于B[补]连同符号位按位取反，末位加一</p>
<p>B 补 = 1,0010101             (−B) 补 = 0,1101011</p>
<ul>
<li><p>例子5:A=11001000， B=-00110100，求A-B</p>
<p>A 补 = A[原] = 0,11001000</p>
<p>B 补 = 1,11001100</p>
<p> (−B) 补 = 0,00110100</p>
</li>
</ul>
<p>A补 −B补 =A+(−B)补</p>
<p>A+(−B)补 =0,11111100</p>
<p>A − B = 111111100</p>
<h5 id="浮点数的加减法运算"><a href="#浮点数的加减法运算" class="headerlink" title="浮点数的加减法运算"></a>浮点数的加减法运算</h5><p><strong>対阶                          尾数求和                          尾数规格化 舍入                          溢出判断</strong></p>
<p>浮点数乘除法也是上面4个步骤</p>
<p>做蓝牙开发时byte数组出现 -122，来看看这个负数是怎么出现的</p>
<p>byte转int类型</p>
<p>b1 &amp; 0xff</p>
<p><a href="http://ju.outofmemory.cn/entry/215778">http://ju.outofmemory.cn/entry/215778</a></p>
<p><a href="https://blog.csdn.net/RuobaiMEN/article/details/79890823">https://blog.csdn.net/RuobaiMEN/article/details/79890823</a></p>
<p><a href="https://blog.csdn.net/LVXIANGAN/article/details/72726152">https://blog.csdn.net/LVXIANGAN/article/details/72726152</a></p>
<p>问题: 计算机负数加法 8 + （-1）</p>
<p>​    b1 &amp; 0xff 不理解</p>
<p><a href="https://www.imooc.com/article/21360">https://www.imooc.com/article/21360</a></p>
<p><a href="https://blog.csdn.net/zdy10326621/article/details/50236529">https://blog.csdn.net/zdy10326621/article/details/50236529</a></p>
<h4 id="字节"><a href="#字节" class="headerlink" title="字节"></a>字节</h4><h6 id="一个字节byte-两位16进制数"><a href="#一个字节byte-两位16进制数" class="headerlink" title="一个字节byte 两位16进制数"></a>一个字节byte 两位16进制数</h6><p>1个字节是8位，二进制8位：xxxxxxxx 范围从00000000－11111111，表示0到255。</p>
<p>1位16进制数最大是15（用二进制表示是xxxx ）（即对应16进制的0xF 1111 4位），要表示到255,就还需要4位。</p>
<ul>
<li>位运算符基本操作</li>
</ul>
<p><a href="https://blog.csdn.net/qiantudou/article/details/49928423">https://blog.csdn.net/qiantudou/article/details/49928423</a></p>
<p><a href="https://www.orchome.com/1190">https://www.orchome.com/1190</a></p>
<h6 id="取一个字节-某几位"><a href="#取一个字节-某几位" class="headerlink" title="取一个字节 某几位"></a>取一个字节 某几位</h6><figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取一个字节高几位</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> b</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> length</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">int</span> <span class="title">getLeftNum</span><span class="params">(<span class="keyword">byte</span> b, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b &gt;&gt; (<span class="number">8</span> - length);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 取一个字节低几位bit</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> b</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> length</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">int</span> <span class="title">getRightNum</span><span class="params">(<span class="keyword">byte</span> b, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span> mv = (<span class="keyword">byte</span>) (<span class="number">0xff</span> &gt;&gt; (<span class="number">8</span> - length));</span><br><span class="line">    <span class="keyword">return</span> b &amp; mv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * https://blog.csdn.net/bluestarjava/article/details/83446129</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> b</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> startIndex 高位从0开始</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> endIndex</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">int</span> <span class="title">getMidNum</span><span class="params">(<span class="keyword">byte</span> b, <span class="keyword">int</span> startIndex, <span class="keyword">int</span> endIndex)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span> i = (<span class="keyword">byte</span>) getLeftNum(b, endIndex + <span class="number">1</span>);<span class="comment">//先取高几位</span></span><br><span class="line">    <span class="function"><span class="keyword">return</span> <span class="title">getRightNum</span><span class="params">(i, endIndex - startIndex + <span class="number">1</span>)</span></span>;<span class="comment">//再取低几位</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://bbs.csdn.net/topics/310178646">https://bbs.csdn.net/topics/310178646</a></p>
]]></content>
      <categories>
        <category>Organization</category>
      </categories>
  </entry>
  <entry>
    <title>RecyclerViewUse</title>
    <url>/2017/07/17/RecyclerView/</url>
    <content><![CDATA[<h4 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h4><p><img src="/2017/07/17/RecyclerView/2021-08-02_10.11_recyleview.png"></p>
<p><a href="https://www.bilibili.com/video/BV1Fi4y1x7p5?from=search&amp;seid=3244755609076396172">https://www.bilibili.com/video/BV1Fi4y1x7p5?from=search&amp;seid=3244755609076396172</a></p>
<ol>
<li><p>RecycleView复用机制</p>
</li>
<li><p>无</p>
</li>
<li><p>问题3</p>
<p>适配不同类型的View布局，将用户界面显示与逻辑代码分离</p>
</li>
<li><p>无</p>
</li>
</ol>
<h5 id="滑动坐标"><a href="#滑动坐标" class="headerlink" title="滑动坐标"></a>滑动坐标</h5><p>第一个左边 - 第二个坐标</p>
<p>所以负值 一定是往下滑</p>
<p>用栈数组保存不同类型回收的view</p>
<h4 id="回收情况"><a href="#回收情况" class="headerlink" title="回收情况"></a>回收情况</h4><p>ScrollY  第一个可见Item的左上顶点 距离屏幕左上角的距离。</p>
<h5 id="顶部item回收"><a href="#顶部item回收" class="headerlink" title="顶部item回收"></a>顶部item回收</h5><p>网上滑动 </p>
<p>当顶部item滑出屏幕，ScrollY的高度等于第一个item高度时，就被滑出了屏幕。</p>
<h5 id="底部item再添加"><a href="#底部item再添加" class="headerlink" title="底部item再添加"></a>底部item再添加</h5><p>网上滑动</p>
<p>当 屏幕显示的几个Item 长度 -  ScrollY  刚好等于 屏幕高度，底部item之下再开始添加item。</p>
<p>因为ScrollY变大.</p>
<h5 id="顶部item添加"><a href="#顶部item添加" class="headerlink" title="顶部item添加"></a>顶部item添加</h5><p>向下滑动</p>
<p>ScrollY = 顶部item高度，顶部添加item</p>
<h4 id="底部item回收"><a href="#底部item回收" class="headerlink" title="底部item回收"></a>底部item回收</h4><p>ScrollY = 底部item高度，底部回收。</p>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LinearLayoutManager layoutManager = <span class="keyword">new</span> LinearLayoutManager(getActivity());</span><br><span class="line">layoutManager.setOrientation(LinearLayoutManager.VERTICAL); <span class="comment">//默认竖直布局</span></span><br><span class="line">mRecyclerView.setLayoutManager(layoutManager);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomAdapter</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">Adapter</span>&lt;<span class="title">CustomAdapter</span>.<span class="title">ViewHolder</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;CustomAdapter&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String[] mDataSet;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BEGIN_INCLUDE(recyclerViewSampleViewHolder)</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Provide a reference to the type of views that you are using (custom ViewHolder)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ViewHolder</span> <span class="keyword">extends</span> <span class="title">RecyclerView</span>.<span class="title">ViewHolder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> TextView textView;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ViewHolder</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">super</span>(v);</span><br><span class="line">            <span class="comment">// Define click listener for the ViewHolder&#x27;s View.</span></span><br><span class="line">            v.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">                    Log.d(TAG, <span class="string">&quot;Element &quot;</span> + getAdapterPosition() + <span class="string">&quot; clicked.&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            textView = (TextView) v.findViewById(R.id.textView);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> TextView <span class="title">getTextView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> textView;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// END_INCLUDE(recyclerViewSampleViewHolder)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Initialize the dataset of the Adapter.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dataSet String[] containing the data to populate views to be used by RecyclerView.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomAdapter</span><span class="params">(String[] dataSet)</span> </span>&#123;</span><br><span class="line">        mDataSet = dataSet;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BEGIN_INCLUDE(recyclerViewOnCreateViewHolder)</span></span><br><span class="line">    <span class="comment">// Create new views (invoked by the layout manager)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ViewHolder <span class="title">onCreateViewHolder</span><span class="params">(ViewGroup viewGroup, <span class="keyword">int</span> viewType)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Create a new view.</span></span><br><span class="line">        View v = LayoutInflater.from(viewGroup.getContext())</span><br><span class="line">                .inflate(R.layout.text_row_item, viewGroup, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ViewHolder(v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// END_INCLUDE(recyclerViewOnCreateViewHolder)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// BEGIN_INCLUDE(recyclerViewOnBindViewHolder)</span></span><br><span class="line">    <span class="comment">// Replace the contents of a view (invoked by the layout manager)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onBindViewHolder</span><span class="params">(ViewHolder viewHolder, <span class="keyword">final</span> <span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;Element &quot;</span> + position + <span class="string">&quot; set.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get element from your dataset at this position and replace the contents of the view</span></span><br><span class="line">        <span class="comment">// with that element</span></span><br><span class="line">        viewHolder.getTextView().setText(mDataSet[position]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// END_INCLUDE(recyclerViewOnBindViewHolder)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Return the size of your dataset (invoked by the layout manager)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mDataSet.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/googlesamples/android-RecyclerView">https://github.com/googlesamples/android-RecyclerView</a></p>
<p><a href="http://blog.csdn.net/lmj623565791/article/details/51854533">http://blog.csdn.net/lmj623565791/article/details/51854533</a><br><a href="http://blog.csdn.net/qibin0506/article/details/49716795">http://blog.csdn.net/qibin0506/article/details/49716795</a></p>
<h4 id="Jectpack-Paging"><a href="#Jectpack-Paging" class="headerlink" title="Jectpack Paging"></a>Jectpack Paging</h4><p><a href="https://developer.android.com/topic/libraries/architecture/paging">https://developer.android.com/topic/libraries/architecture/paging</a></p>
<p><a href="https://www.youtube.com/watch?v=BE5bsyGGLf4&amp;t=841s">https://www.youtube.com/watch?v=BE5bsyGGLf4&amp;t=841s</a></p>
<p><a href="https://codelabs.developers.google.com/codelabs/android-paging/index.html?index=../../index#1">https://codelabs.developers.google.com/codelabs/android-paging/index.html?index=..%2F..%2Findex#1</a></p>
<p>ItemKeyedDataSource的子类需要实现loadInitial、loadAfter、loadBefore和getKey方法。它们分别的作用如下：</p>
<ul>
<li><p>loadInitial：此方法之后在用DataSource构建PageList的时候才会调用一次。用于进行加载初始化。</p>
</li>
<li><p>loadAfter：在每次RecyclerView滑动到<code>底部</code>没有数据的时候就会调用此方法进行数据的加载。</p>
</li>
<li><p>loadBefore：在每次RecyclerView滑动到<code>顶部</code>没有数据的时候就会调用此方法进行数据的加载。</p>
</li>
<li><p>getKey: 这返回下一个loadAfter调用所需要用到的key。<strong>就相当于链表的指针。</strong></p>
<p><a href="https://anriku.top/2018/09/25/Android%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD-Paging%E7%9A%84%E4%BD%BF%E7%94%A8/">https://anriku.top/2018/09/25/Android%E5%A4%A7%E9%87%8F%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD-Paging%E7%9A%84%E4%BD%BF%E7%94%A8/</a></p>
</li>
</ul>
<p><a href="https://github.com/fmtjava/Jetpack_GitHub">https://github.com/fmtjava/Jetpack_GitHub</a></p>
<p><a href="https://github.com/Hankkin/JetPack_Note">https://github.com/Hankkin/JetPack_Note</a></p>
<p>解释 paging diff</p>
<p><a href="http://www.jeepxie.net/article/25492.html">http://www.jeepxie.net/article/25492.html</a></p>
<p><a href="https://www.jianshu.com/p/bbb96fc62bcd">https://www.jianshu.com/p/bbb96fc62bcd</a></p>
<p><a href="https://www.jianshu.com/p/10bf4bf59122">https://www.jianshu.com/p/10bf4bf59122</a></p>
<p><a href="https://juejin.im/post/5db06bb6518825646d79070b">https://juejin.im/post/5db06bb6518825646d79070b</a></p>
<h4 id="Item分类"><a href="#Item分类" class="headerlink" title="Item分类"></a>Item分类</h4><p>前面添加header, footer就用到了item分类<br>reclverview也有很多分类方式</p>
<ul>
<li>使用adapter　组合设计模式，进行组装，代码简洁，比较好操作<br><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0810/3282.html">多adapter分类</a> </li>
</ul>
<p><a href="https://github.com/luizgrp/SectionedRecyclerViewAdapter">https://github.com/luizgrp/SectionedRecyclerViewAdapter</a><br><a href="http://blog.csdn.net/wzlyd1/article/details/52292548">http://blog.csdn.net/wzlyd1/article/details/52292548</a><br><a href="https://github.com/luizgrp/SectionedRecyclerViewAdapter">https://github.com/luizgrp/SectionedRecyclerViewAdapter</a></p>
<p><a href="https://github.com/donkingliang/GroupedRecyclerViewAdapter">https://github.com/donkingliang/GroupedRecyclerViewAdapter</a></p>
<p><a href="https://mp.weixin.qq.com/s/oCl4BQ8uB9ZDSOEKESM7hA">https://mp.weixin.qq.com/s/oCl4BQ8uB9ZDSOEKESM7hA</a></p>
<p> 复杂布局: <a href="https://github.com/385841539/RecycleviewStaggered">https://github.com/385841539/RecycleviewStaggered</a></p>
<p> 竖直嵌套水平:<a href="https://github.com/drakeet/MultiType/issues/67">https://github.com/drakeet/MultiType/issues/67</a></p>
<p>分割线</p>
<p><a href="https://www.jianshu.com/p/4eff036360da">https://www.jianshu.com/p/4eff036360da</a></p>
<p><a href="https://www.jianshu.com/p/b2ef4f8e859f">https://www.jianshu.com/p/b2ef4f8e859f</a></p>
<p><a href="https://github.com/YoKeyword/IndexableRecyclerView">https://github.com/YoKeyword/IndexableRecyclerView</a></p>
<p><a href="https://juejin.im/post/5eae33a26fb9a043586c7f19">https://juejin.im/post/5eae33a26fb9a043586c7f19</a></p>
<h5 id="Reycleview-preview"><a href="#Reycleview-preview" class="headerlink" title="Reycleview preview"></a>Reycleview preview</h5><p><a href="https://medium.com/aubergine-solutions/creating-recyclerview-layout-in-android-no-pain-only-gain-404280471003">https://medium.com/aubergine-solutions/creating-recyclerview-layout-in-android-no-pain-only-gain-404280471003</a></p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">tools:</span>itemCount=<span class="string">&quot;5&quot;</span></span><br><span class="line"><span class="symbol">tools:</span>listitem=<span class="string">&quot;@layout/adapter_red_pack&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">tools:</span>src=<span class="string">&quot;@sample/RedPack.json/dataList/redEnvelopeMoney&quot;</span></span><br></pre></td></tr></table></figure>



<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>使用recycleView中会遇到一些问题,总结一下</p>
<ol>
<li>问题1<br>下拉刷新 滑动列表 crash</li>
</ol>
<p>使用下拉刷新的时候 往上滑动item会出现这样的错误</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">E/CrashReport: sys default last handle start!</span><br><span class="line">FATAL EXCEPTION: main</span><br><span class="line"> Process: com.huifu, PID: <span class="number">22865</span></span><br><span class="line"> java.lang.IndexOutOfBoundsException: Inconsistency detected. Invalid item position <span class="number">4</span>(offset:<span class="number">4</span>).state:<span class="number">10</span></span><br><span class="line"> at android.support.v7.widget.<span class="module-access"><span class="module"><span class="identifier">RecyclerView$Recycler</span>.</span></span><span class="keyword">try</span><span class="constructor">GetViewHolderForPositionByDeadline(RecyclerView.<span class="params">java</span>:5504)</span></span><br><span class="line"> at android.support.v7.widget.<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>prefetch<span class="constructor">PositionWithDeadline(GapWorker.<span class="params">java</span>:282)</span></span><br><span class="line"> at android.support.v7.widget.<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>flush<span class="constructor">TaskWithDeadline(GapWorker.<span class="params">java</span>:336)</span></span><br><span class="line"> at android.support.v7.widget.<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>flush<span class="constructor">TasksWithDeadline(GapWorker.<span class="params">java</span>:349)</span></span><br><span class="line"> at android.support.v7.widget.<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>prefetch(<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>java:<span class="number">356</span>)</span><br><span class="line"> at android.support.v7.widget.<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">GapWorker</span>.</span></span>java:<span class="number">387</span>)</span><br><span class="line"> at android.os.<span class="module-access"><span class="module"><span class="identifier">Handler</span>.</span></span>handle<span class="constructor">Callback(Handler.<span class="params">java</span>:739)</span></span><br><span class="line"> at android.os.<span class="module-access"><span class="module"><span class="identifier">Handler</span>.</span></span>dispatch<span class="constructor">Message(Handler.<span class="params">java</span>:95)</span></span><br><span class="line"> at android.os.<span class="module-access"><span class="module"><span class="identifier">Looper</span>.</span></span>loop(<span class="module-access"><span class="module"><span class="identifier">Looper</span>.</span></span>java:<span class="number">148</span>)</span><br><span class="line"> at android.app.<span class="module-access"><span class="module"><span class="identifier">ActivityThread</span>.</span></span>main(<span class="module-access"><span class="module"><span class="identifier">ActivityThread</span>.</span></span>java:<span class="number">5417</span>)</span><br><span class="line"> at java.lang.reflect.<span class="module-access"><span class="module"><span class="identifier">Method</span>.</span></span>invoke(Native Method)</span><br><span class="line"> at com.android.internal.os.<span class="module-access"><span class="module"><span class="identifier">ZygoteInit$MethodAndArgsCaller</span>.</span></span>run(<span class="module-access"><span class="module"><span class="identifier">ZygoteInit</span>.</span></span>java:<span class="number">726</span>)</span><br><span class="line"> at com.android.internal.os.<span class="module-access"><span class="module"><span class="identifier">ZygoteInit</span>.</span></span>main(<span class="module-access"><span class="module"><span class="identifier">ZygoteInit</span>.</span></span>java:<span class="number">616</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 刷新之后数据清空，再滑动数据和item不一致, 情况数据应该在拿到数据之后, 使用下面这种方式解决问题，</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onRefresh</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="comment">//        if (!mProjectList.isEmpty()) &#123;</span></span><br><span class="line"><span class="comment">//            mProjectList.clear();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">        start = <span class="number">0</span>;</span><br><span class="line">        loadData();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//拿到数据后</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onSuccess</span>(<span class="params">List&lt;Project&gt; projects</span>)</span> &#123;</span><br><span class="line">                        swipeInvest.setRefreshing(<span class="literal">false</span>);</span><br><span class="line">                        isloading = <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">if</span> (start == <span class="number">0</span>) mProjectList.clear();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>  <a href="http://blog.csdn.net/weixiao_812/article/details/78138075">http://blog.csdn.net/weixiao_812/article/details/78138075</a><br> <a href="https://allen218.github.io/2016/06/02/RecyclerView%E4%B8%8B%E6%8B%89%E5%88%B7%E6%96%B0%E6%97%B6%E5%BF%AB%E9%80%9F%E6%BB%91%E5%8A%A8%E5%B4%A9%E6%BA%83%E7%9A%84%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/">下拉刷新时快速滑动崩溃的问题解决</a>  </p>
<ol start="2">
<li>问题2</li>
</ol>
<p>界面不能展示 ,和ListView  不同的是RecyclerView不同,没设置下面的参数是不显示的</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">mLayoutManager = <span class="keyword">new</span> <span class="constructor">LinearLayoutManager(<span class="params">getActivity</span>()</span>);</span><br><span class="line">rcvRrecord.set<span class="constructor">LayoutManager(<span class="params">mLayoutManager</span>)</span>;</span><br></pre></td></tr></table></figure>

<p>如果还是没有就看看 recycleview布局是否显示</p>
<p><a href="https://blog.csdn.net/mjb00000/article/details/106014544">https://blog.csdn.net/mjb00000/article/details/106014544</a></p>
<p>不用等数据来了后再显示</p>
<p><a href="https://github.com/leobert-lan/Pandora">https://github.com/leobert-lan/Pandora</a> </p>
<h4 id="RecyclerView拖拽功能"><a href="#RecyclerView拖拽功能" class="headerlink" title="RecyclerView拖拽功能"></a>RecyclerView拖拽功能</h4><p><a href="https://www.jianshu.com/p/9605d14ddcc2">https://www.jianshu.com/p/9605d14ddcc2</a></p>
<p><a href="https://www.jianshu.com/p/b9a22f0c537d">https://www.jianshu.com/p/b9a22f0c537d</a></p>
<p><a href="https://medium.com/@ipaulpro/drag-and-swipe-with-recyclerview-b9456d2b1aaf">https://medium.com/@ipaulpro/drag-and-swipe-with-recyclerview-b9456d2b1aaf</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Regular</title>
    <url>/2020/07/20/Regular/</url>
    <content><![CDATA[<p><a href="https://deerchao.cn/tools/wegester/">https://deerchao.cn/tools/wegester/</a></p>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions</a></p>
<p><a href="https://www.jb51.net/shouce/jquery1.82/regexp.html">https://www.jb51.net/shouce/jquery1.82/regexp.html</a></p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><h4 id="字符"><a href="#字符" class="headerlink" title="字符"></a>字符</h4><h5 id="普通字符"><a href="#普通字符" class="headerlink" title="普通字符"></a>普通字符</h5><p>字母、数字、汉字、下划线、以及没有特殊定义的标点符号都是普通字符。直接匹配与之相同的字符</p>
<p>-简单的转义字符</p>
<table>
<thead>
<tr>
<th>\n</th>
<th>换行符</th>
</tr>
</thead>
<tbody><tr>
<td>\t</td>
<td>制表符</td>
</tr>
<tr>
<td>\</td>
<td>\本身</td>
</tr>
</tbody></table>
<p>其他都是类似  ^ $  ( 这样匹配这些字符本身的（还有    ) { } ? + * | [ ]    ）</p>
<h5 id="标准字符集合"><a href="#标准字符集合" class="headerlink" title="标准字符集合"></a>标准字符集合</h5><p> 能够与多种字符匹配的表达式  注意区分大小写 大写是相反的意思</p>
<table>
<thead>
<tr>
<th>\d</th>
<th>任意一个数字，0-9中任意一个     \D 表示所有非数字</th>
</tr>
</thead>
<tbody><tr>
<td>\w</td>
<td>任意一个字母或下划线，也就是A-Z、a-z、0-9、_ 、中的任意一个</td>
</tr>
<tr>
<td>\s</td>
<td>包括空格、制表符、换行符等空白字符中的任意一个</td>
</tr>
<tr>
<td>.</td>
<td>小数点可以匹配任意一个字符（除了换行符）。如果要匹配包括“\n”在内的所有字符，一般用 [\s\S]</td>
</tr>
</tbody></table>
<h5 id="自定义字符集合"><a href="#自定义字符集合" class="headerlink" title="自定义字符集合"></a>自定义字符集合</h5><p>[]方括号匹配方式 ，能够匹配方括号中任意一个字符。^符号在方括号里表示 取反  方括号外表示零宽标记，见后面</p>
<table>
<thead>
<tr>
<th>[ab5@]</th>
<th>匹配 “a”或“b”或“5”或“@”</th>
</tr>
</thead>
<tbody><tr>
<td>[^abc]</td>
<td>匹配“a”、“b”、”c“之外的任意一个字符</td>
</tr>
<tr>
<td>[f-k]</td>
<td>匹配“f”-“k”之间的任意一个字母</td>
</tr>
<tr>
<td>[^A-F0-3]</td>
<td>匹配“A”-“F”，“0”-“3”之外的任意一个字符</td>
</tr>
</tbody></table>
<ul>
<li><p>正则表达式的特殊符号，被包含到中括号中则失去其特殊意义（就表示自身这个字符），除了^,-之外。</p>
</li>
<li><p>标准字符集合，除小数点外，如果被包含于中括号，自定义字符集合将包含该集合。</p>
<p>比如： [\d.-+]将匹配：数字、小数点、+、- 本身意义，除非加转义字符\ </p>
<p>上面两句一个意思呀</p>
</li>
</ul>
<h4 id="量词Quantifier"><a href="#量词Quantifier" class="headerlink" title="量词Quantifier"></a>量词Quantifier</h4><p>修饰匹配次数的特殊符号</p>
<table>
<thead>
<tr>
<th>{n}</th>
<th>表达式重复n次</th>
<th>如：\d{6}  匹配6位数字  \d\d{6} 匹配7位数字  {\d\d}{6} 匹配12位数字</th>
</tr>
</thead>
<tbody><tr>
<td>{m,n}</td>
<td>表达式至少重复m次，最多重复n次</td>
<td></td>
</tr>
<tr>
<td>{m,}</td>
<td>至少重复m次</td>
<td></td>
</tr>
<tr>
<td>？</td>
<td>匹配表达式0次或1次 ，相当于{0，1}</td>
<td>如：a\d{0,1}b  a\d?b  是等价的</td>
</tr>
<tr>
<td>+</td>
<td>表达式至少出现1次,相当于{1，}</td>
<td>如：a\d+b</td>
</tr>
<tr>
<td>*</td>
<td>表达式不出现或出现任意次</td>
<td>相当于{0，}</td>
</tr>
</tbody></table>
<p>匹配次数中的贪婪模式 （匹配字符数越多越好，默认的）如\d{3,6} 会优先匹配 6位数字</p>
<p>匹配次数中的非贪婪模式 （匹配字符越少越好，修饰匹配次数的特殊符号后再加上一个“？”号）</p>
<h4 id="字符边界-零宽，不占长度"><a href="#字符边界-零宽，不占长度" class="headerlink" title="字符边界(零宽，不占长度)"></a>字符边界(零宽，不占长度)</h4><p>-（本组标记匹配的不是字符而是位置，符合某种条件的位置）</p>
<table>
<thead>
<tr>
<th>^</th>
<th>与字符开始的地方匹配</th>
</tr>
</thead>
<tbody><tr>
<td>$</td>
<td>与字符结束的地方匹配</td>
</tr>
<tr>
<td>\b</td>
<td>匹配一个单词边界</td>
</tr>
</tbody></table>
<p>REG : John\b</p>
<p>John 匹配 可以看到 John_    下划线_就是\b的位置，他的左侧n 匹配，但是右侧空格不匹配 \w,所以就是不全是\w,所以匹配。</p>
<p>-\b匹配这样一个位置：前面的字符和后面的字符不全是\w （全是的就不匹配）</p>
<p>如：^i  匹配 i开头的位置    i$ 匹配i结束的位置  hello\b  匹配前后不全是\w表示的hello </p>
<h4 id="匹配模式"><a href="#匹配模式" class="headerlink" title="匹配模式"></a>匹配模式</h4><p>IGNORECASE</p>
<p>忽略大小写 默认情况下正则表达式区分大小写(Case Insensitive)</p>
<p>SINGLELINE</p>
<p>单行模式  整个文本看作一个字符串，只有一个开头，一个结尾。使得小数点“.”可以匹配包含换行符（\n）在内的任意字符</p>
<p>MULTILINE</p>
<p>多行模式 每行都是一个字符串，都有开头和结尾。在指定了此模式后，如果需要仅匹配字符串开始和结束位置，可以使用\A和\Z</p>
<p>如：\Ai匹配 第一行第一个i     ^i 匹配每一行第一个的i   i$匹配每一行的最后一个i  i\Z  匹配整个文档最后一个i</p>
<h4 id="选择符和分组"><a href="#选择符和分组" class="headerlink" title="选择符和分组"></a>选择符和分组</h4><table>
<thead>
<tr>
<th>表达式</th>
<th>作用</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>| 分支结构</td>
<td>左右两边表达式之间 “或” 关系，匹配左边或者右边</td>
<td>表示“或”   如 h</td>
</tr>
<tr>
<td>()   捕获组</td>
<td>(1) 在被修饰匹配次数的时候，括号中的表达式可以作为整体被修饰<br><br> (2)取匹配结果的时候，括号中的表达式匹配到的内容可以被单独地编号    <br><br> (3)每一对括号会被分配一个编号，使用（）的捕获根据左括号的顺序从1开始自动编号。捕获元素编号为零的第一 个捕获是由整个正则表达式模式匹配的内容</td>
<td></td>
</tr>
<tr>
<td>(?:Expression) 非捕获组</td>
<td>一些表达式中，不得不使用（），但又不需要保存（）中的子表达式匹配的内容，这时可以用非捕获组来抵消使用（）带来的副作用。节省内存。</td>
<td></td>
</tr>
</tbody></table>
<h4 id="反向引用（-nnn）-nnn表示可以匹配多位数字"><a href="#反向引用（-nnn）-nnn表示可以匹配多位数字" class="headerlink" title="反向引用（\nnn）\nnn表示可以匹配多位数字"></a>反向引用（\nnn）\nnn表示可以匹配多位数字</h4><p>-每一对（）会分配一个编号，使用（）的捕获根据左括号的顺序从1开始自动编号。</p>
<p>-通过反向引用，可以对分组已捕获的字符串进行引用。</p>
<p>  如  ([a-z]{2})\1  中的\1 代表第一个组里的内容,匹配到gogo，toto，dodo这样的字符串。</p>
<p>（）（）（） 捕获的内容分别用\1 \2 \3  编号以左括号为准。</p>
<h4 id="预搜索（零宽断言）（也叫环视）"><a href="#预搜索（零宽断言）（也叫环视）" class="headerlink" title="预搜索（零宽断言）（也叫环视）"></a>预搜索（零宽断言）（也叫环视）</h4><ol>
<li>只进行子表达式的匹配，匹配内容不计入最终的匹配结果，是零宽度。</li>
<li>这个位置应该符合某个条件。判断当前位置的前后字符，是否符合指定的条件，但不匹配前后的字符。<strong>是对位置的匹配</strong>。</li>
<li>正则表达式匹配过程中，如果子表达式匹配到的是字符内容，而非位置，并被保存到最终的匹配结果中，那么就认为这个子表达式是占有字符的；如果子表达式匹配的仅仅是位置，或者匹配的内容并不保存到最终的匹配结果中，那么就认为这个子表达式是零宽度的。占有字符还是零宽度，是针对匹配的内容是否保存到最终的匹配结果中而言的。</li>
</ol>
<table>
<thead>
<tr>
<th>表达式</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>(?=exp)</td>
<td>断言自身出现的位置的后面能匹配表达式exp</td>
</tr>
<tr>
<td>(?&lt;=exp)</td>
<td>断言自身出现的位置的前面能匹配表达式exp</td>
</tr>
<tr>
<td>(?!exp)</td>
<td>断言此位置的后面不能匹配表达式exp</td>
</tr>
<tr>
<td>(?&lt;!exp)</td>
<td>断言此位置的前面不能匹配表达式exp</td>
</tr>
</tbody></table>
<p>(?&lt;=\d)[a-z]+</p>
<p>22john</p>
<p>如：[a-z]+(?=ing) 匹配ing结尾的字符串，但不匹配ing本身</p>
<pre><code>   [a-z]+(?=\d+) 匹配数字结尾的字符串    
</code></pre>
<h3 id="常用的一些正则表达式"><a href="#常用的一些正则表达式" class="headerlink" title="常用的一些正则表达式"></a>常用的一些正则表达式</h3><h5 id="电话号码验证"><a href="#电话号码验证" class="headerlink" title="电话号码验证"></a>电话号码验证</h5><p>（包含固话和手机号，不能确认号码一定存在，只能匹配格式）</p>
<p>（1）电话号码由数字和“-”构成</p>
<p>（2）电话号码为7-8位</p>
<p>（3）如果电话号码中包含有区号，那么区号为3位或4位，首位是0</p>
<p>（4）区号用“-”和其他部分隔开</p>
<p>（5）移动电话号码为11位</p>
<p>（6）11位移动电话号码的第一位和第二位为“13”“15”“18”</p>
<p> 固话   0\d{2,3}-\d{7,9}   手机号    1[35789]\d{9}</p>
<h5 id="电子邮箱地址验证"><a href="#电子邮箱地址验证" class="headerlink" title="电子邮箱地址验证"></a>电子邮箱地址验证</h5><p>1.用户名：字母、数字、中划线、下划线组成</p>
<p>2.@</p>
<p>3.网址：字母、数字组成</p>
<p>4.小数点。</p>
<p>5.组织域名：2-4位字母组成</p>
<p>不区分大小写</p>
<p>[\w-]+@[a-z0-9A-Z]+(.[A-Za-z]{2,4}){1,2} </p>
<p>如：<a href="mailto:&#x73;&#115;&#x61;&#x68;&#100;&#97;&#104;&#100;&#x40;&#115;&#x69;&#110;&#x61;&#46;&#99;&#111;&#109;&#46;&#99;&#x6e;">&#x73;&#115;&#x61;&#x68;&#100;&#97;&#104;&#100;&#x40;&#115;&#x69;&#110;&#x61;&#46;&#99;&#111;&#109;&#46;&#99;&#x6e;</a></p>
<h5 id="常用正则表达式列表"><a href="#常用正则表达式列表" class="headerlink" title="常用正则表达式列表"></a>常用正则表达式列表</h5><table>
<thead>
<tr>
<th>表达式</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>[\u4e00-\u9fa5]</td>
<td>匹配中文字符</td>
</tr>
<tr>
<td>\n\s*\r</td>
<td>匹配空白行</td>
</tr>
<tr>
<td>`&lt;(\S*?)[^&gt;]<em>&gt;.</em>?&lt;/\1&gt;</td>
<td>&lt;.*? /&gt;`</td>
</tr>
<tr>
<td><code>^\s*\s*$</code></td>
<td>匹配首尾空白字符</td>
</tr>
<tr>
<td><code>\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*</code></td>
<td>匹配Email地址</td>
</tr>
<tr>
<td><code>[a-zA-z]+://[^\s]*</code></td>
<td>匹配网址URL</td>
</tr>
<tr>
<td><code>\d&#123;3&#125;-\d&#123;8&#125;\d&#123;4&#125;-\d&#123;7&#125;</code></td>
<td>匹配国内电话号码</td>
</tr>
<tr>
<td><code>[1-9][0-9]&#123;4,&#125;</code></td>
<td>匹配腾讯QQ号</td>
</tr>
<tr>
<td><code>[1-9]\d&#123;5&#125;(?!\d)</code></td>
<td>匹配中国邮政编码</td>
</tr>
<tr>
<td><code>\d&#123;15&#125;\d&#123;18&#125;</code></td>
<td>匹配身份证</td>
</tr>
<tr>
<td><code>\d+\.\d+\.\d+\.\d+</code></td>
<td>匹配ip地址</td>
</tr>
</tbody></table>
<h3 id="工作学习中各种环境的使用"><a href="#工作学习中各种环境的使用" class="headerlink" title="工作学习中各种环境的使用"></a>工作学习中各种环境的使用</h3><h5 id="JAVA程序中使用正则表达式"><a href="#JAVA程序中使用正则表达式" class="headerlink" title="JAVA程序中使用正则表达式"></a>JAVA程序中使用正则表达式</h5><p>相关类位于：<strong>java.util.regex包下面</strong>：</p>
<ol>
<li><strong>类 Pattern：</strong><br> 正则表达式的编译表示形式。<br> Pattern p = Pattern.compile(r,int); //建立正则表达式，并启用相应模式</li>
<li><strong>类 Matcher：</strong><br> 通过解释 Pattern 对 character sequence 执行匹配操作的引擎。<br> Matcher m = p.matcher(str); //匹配str字符串</li>
<li><strong>java代码应用正则的查找、分组、替换、分割：</strong></li>
</ol>
<h5 id="查找"><a href="#查找" class="headerlink" title="查找"></a>查找</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.regex.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试正则表达式对象的基本用法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//在这个字符串：abcd1234，是否符合指定的正则表达式：\w+</span></span><br><span class="line">		<span class="comment">//表达式对象</span></span><br><span class="line">		Pattern p = Pattern.compile(<span class="string">&quot;\\w+&quot;</span>);</span><br><span class="line">		<span class="comment">//创建Matcher对象</span></span><br><span class="line">		Matcher m = p.matcher(<span class="string">&quot;abcd￥￥1234&quot;</span>);</span><br><span class="line">		<span class="comment">//boolean result= m.matches();	//尝试将整个字符序列与该模式匹配</span></span><br><span class="line">		<span class="comment">//System.out.println(result);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//boolean result= m.find();	//该方法扫描输入的序列，查找与该模式匹配的下一个子序列</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//System.out.println(m.find());</span></span><br><span class="line">		<span class="comment">//System.out.println(m.group());</span></span><br><span class="line">		<span class="comment">//System.out.println(m.find());</span></span><br><span class="line">		<span class="comment">//System.out.println(m.group());</span></span><br><span class="line">	</span><br><span class="line">		<span class="keyword">while</span>(m.find())&#123;</span><br><span class="line">			System.out.println(m.group());	<span class="comment">//group(),group(0)匹配整个表达式的子字符串</span></span><br><span class="line">			System.out.println(m.group(<span class="number">0</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.regex.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试正则表达式对象中分组的处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//在这个字符串：abcd1234，是否符合指定的正则表达式：\w+</span></span><br><span class="line">		<span class="comment">//表达式对象</span></span><br><span class="line">		Pattern p = Pattern.compile(<span class="string">&quot;([a-z]+)([0-9]+)&quot;</span>);</span><br><span class="line">		<span class="comment">//创建Matcher对象</span></span><br><span class="line">		Matcher m = p.matcher(<span class="string">&quot;abc123%%abcd234%abcde4567&quot;</span>);</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">while</span>(m.find())&#123;</span><br><span class="line">			System.out.println(m.group());	<span class="comment">//group(),group(0)匹配整个表达式的子字符串</span></span><br><span class="line">			System.out.println(m.group(<span class="number">1</span>));</span><br><span class="line">			System.out.println(m.group(<span class="number">2</span>));</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="替换"><a href="#替换" class="headerlink" title="替换"></a>替换</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.regex.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试正则表达式对象的替换操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test3</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//表达式对象</span></span><br><span class="line">		Pattern p = Pattern.compile(<span class="string">&quot;[0-9]&quot;</span>);</span><br><span class="line">		<span class="comment">//创建Matcher对象</span></span><br><span class="line">		Matcher m = p.matcher(<span class="string">&quot;abc123%%abcd234%abcde4567&quot;</span>);</span><br><span class="line">		<span class="comment">//替换</span></span><br><span class="line">		String result= m.replaceAll(<span class="string">&quot;#&quot;</span>);</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="分割"><a href="#分割" class="headerlink" title="分割"></a>分割</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.regex.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试正则表达式对象的分割字符串的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test4</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String str = <span class="string">&quot;ab23jk123ji8890123asd&quot;</span>;</span><br><span class="line">		String[] arrs = str.split(<span class="string">&quot;\\d+&quot;</span>);</span><br><span class="line">		System.out.println(Arrays.toString(arrs));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="手写网络爬虫（基本原理-amp-乱码处理）"><a href="#手写网络爬虫（基本原理-amp-乱码处理）" class="headerlink" title="手写网络爬虫（基本原理&amp;乱码处理）"></a><strong>手写网络爬虫（基本原理&amp;乱码处理）</strong></h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.bjsxt.regex.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.net.MalformedURLException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 网络爬虫取链接	</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSpiderTest</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获得urlStr对应的网页的源码内容</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> urlStr</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String  <span class="title">getURLContent</span><span class="params">(String urlStr,String charset)</span></span>&#123;</span><br><span class="line">		StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			URL url = <span class="keyword">new</span> URL(urlStr);</span><br><span class="line">			BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(url.openStream(),Charset.forName(charset)));</span><br><span class="line">			String temp = <span class="string">&quot;&quot;</span>;</span><br><span class="line">			<span class="keyword">while</span>((temp=reader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				sb.append(temp);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> sb.toString();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getMatherSubstrs</span><span class="params">(String destStr,String regexStr)</span></span>&#123;</span><br><span class="line">		Pattern p = Pattern.compile(regexStr);	<span class="comment">//取到的超链接的地址</span></span><br><span class="line">		Matcher m = p.matcher(destStr);</span><br><span class="line">		List&lt;String&gt; result = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		<span class="keyword">while</span>(m.find())&#123;</span><br><span class="line">			result.add(m.group(<span class="number">1</span>));</span><br><span class="line">		&#125;	</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		String destStr = getURLContent(<span class="string">&quot;http://www.163.com&quot;</span>,<span class="string">&quot;gbk&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//Pattern p = Pattern.compile(&quot;&lt;a[\\s\\S]+?&lt;/a&gt;&quot;);//取到的超链接的整个内容</span></span><br><span class="line">		List&lt;String&gt; result = getMatherSubstrs(destStr, <span class="string">&quot;href=\&quot;([\\w\\s./:]+?)\&quot;&quot;</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span> (String temp : result) &#123;</span><br><span class="line">			System.out.println(temp);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><a href="https://blog.csdn.net/qq_39636602/article/details/101236461">https://blog.csdn.net/qq_39636602/article/details/101236461</a></p>
<p><a href="https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md">https://github.com/ziishaned/learn-regex/blob/master/translations/README-cn.md</a></p>
<p><a href="https://regexr.com/">https://regexr.com/</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>Retrofit</title>
    <url>/2017/09/23/Retrofit/</url>
    <content><![CDATA[<h4 id="Okhttp缺陷"><a href="#Okhttp缺陷" class="headerlink" title="Okhttp缺陷"></a>Okhttp缺陷</h4><p><img src="retrofit/2021-07-26_4.24_vsokhttp.png"></p>
<p><img src="/2017/09/23/Retrofit/retrofit/2021-07-28_7.46.04.png"></p>
<h4 id="Retofit调用"><a href="#Retofit调用" class="headerlink" title="Retofit调用"></a>Retofit调用</h4><p><img src="/2017/09/23/Retrofit/retrofit/2021-07-27_10.42_retrofit.png"></p>
<h4 id="Retrofit-Rxjava"><a href="#Retrofit-Rxjava" class="headerlink" title="Retrofit Rxjava"></a>Retrofit Rxjava</h4><p><img src="/2017/09/23/Retrofit/retrofit/2021-07-27_10.43_rxjava.png"></p>
<p><img src="/2017/09/23/Retrofit/retrofit/2021-07-28_3.02.05.png"></p>
<p><img src="/2017/09/23/Retrofit/retrofit/2021-07-28_04.21.png"></p>
<p> Retorift使用过程</p>
<ol>
<li><p>动态生成了实现了接口类型的， 类的对象。</p>
<p>调用方法,通过反射解析接口，拿到方法参数</p>
<p>生成代理类</p>
<p>Retrofit.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">create</span><span class="params">(<span class="keyword">final</span> Class&lt;T&gt; service)</span> </span>&#123;</span><br><span class="line">  validateServiceInterface(service);</span><br><span class="line">  <span class="keyword">return</span> (T)</span><br><span class="line">      Proxy.newProxyInstance(</span><br><span class="line">          service.getClassLoader(),</span><br><span class="line">          <span class="keyword">new</span> Class&lt;?&gt;[] &#123;service&#125;,</span><br><span class="line">          <span class="keyword">new</span> InvocationHandler() &#123;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> Platform platform = Platform.get();</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">final</span> Object[] emptyArgs = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="meta">@Nullable</span> <span class="function">Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, <span class="meta">@Nullable</span> Object[] args)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">              <span class="comment">// If the method is a method from Object then defer to normal invocation.</span></span><br><span class="line">              <span class="keyword">if</span> (method.getDeclaringClass() == Object.class) &#123;</span><br><span class="line">                <span class="keyword">return</span> method.invoke(<span class="keyword">this</span>, args); <span class="comment">//传入的是this</span></span><br><span class="line">              &#125;</span><br><span class="line">              args = args != <span class="keyword">null</span> ? args : emptyArgs;</span><br><span class="line">              <span class="keyword">return</span> platform.isDefaultMethod(method)</span><br><span class="line">                  ? platform.invokeDefaultMethod(method, service, proxy, args)</span><br><span class="line">                  : loadServiceMethod(method).invoke(args); <span class="comment">//这个动态代理的形式，为什么没传对象？</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">IApiStores iApiStores = RetrofitFactory.create(IApiStores.class);</span><br><span class="line">retrofit2.Call&lt;List&lt;SharedListBean&gt;&gt; sharedListCall = iApiStores.getSharedList(<span class="number">2</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>ServiceMethod</p>
<p>一个方法对应一个serviceMethod,使用hashmap缓存,构建okhttp的网络请求。</p>
</li>
</ol>
<h4 id="Retrofit包装类"><a href="#Retrofit包装类" class="headerlink" title="Retrofit包装类"></a>Retrofit包装类</h4><p>Retrofit组装完数据，使用Okhttp进行网络请求的类</p>
<p>OkHttpCall.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(<span class="keyword">final</span> Callback&lt;T&gt; callback)</span> </span>&#123;</span><br><span class="line">  Objects.requireNonNull(callback, <span class="string">&quot;callback == null&quot;</span>);</span><br><span class="line"></span><br><span class="line">  okhttp3.Call call;</span><br><span class="line">  Throwable failure;</span><br><span class="line">  <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">    call = rawCall = createRawCall();     <span class="comment">// 创建OkhttpCall</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  call.enqueue(</span><br><span class="line">      <span class="keyword">new</span> okhttp3.Callback() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(okhttp3.Call call, okhttp3.Response rawResponse)</span> </span>&#123;</span><br><span class="line">          Response&lt;T&gt; response;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            response = parseResponse(rawResponse);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            throwIfFatal(e);</span><br><span class="line">            callFailure(e);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            callback.onResponse(OkHttpCall.<span class="keyword">this</span>, response);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            throwIfFatal(t);</span><br><span class="line">            t.printStackTrace(); <span class="comment">// TODO this is not great</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(okhttp3.Call call, IOException e)</span> </span>&#123;</span><br><span class="line">          callFailure(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">callFailure</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            callback.onFailure(OkHttpCall.<span class="keyword">this</span>, e);</span><br><span class="line">          &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            throwIfFatal(t);</span><br><span class="line">            t.printStackTrace(); <span class="comment">// TODO this is not great</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.bilibili.com/video/BV1mU4y1p71g?p=10&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1mU4y1p71g?p=10&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.bilibili.com/video/BV12Q4y1d7uD?p=7&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV12Q4y1d7uD?p=7&amp;spm_id_from=pageDriver</a></p>
<p><a href="http://www.jianshu.com/p/308f3c54abdd">http://www.jianshu.com/p/308f3c54abdd</a><br>这篇文章不错，深入浅出<br>我还加了了提交Map参数的<a href="https://gitee.com/huaiyi/RetrofitDemo.git">Demo</a> Demo</p>
<p> <a href="http://www.10tiao.com/html/227/201701/2650238307/1.html">http://www.10tiao.com/html/227/201701/2650238307/1.html</a><br> <a href="http://blog.csdn.net/itjianghuxiaoxiong/article/details/52135748">http://blog.csdn.net/itjianghuxiaoxiong/article/details/52135748</a></p>
<p><a href="https://juejin.im/post/5afc1706518825426f30f6ec">https://juejin.im/post/5afc1706518825426f30f6ec</a></p>
<p>要实现类似这样的请求,用post方式怎么也不行<br><a href="https://newsapi.org/v2/top-headlines?sources=financial-times&amp;apiKey=e4f505f73a9f4ee99119ab33a19ab05e">https://newsapi.org/v2/top-headlines?sources=financial-times&amp;apiKey=e4f505f73a9f4ee99119ab33a19ab05e</a><br><a href="http://wuxiaolong.me/2016/06/18/retrofits/">http://wuxiaolong.me/2016/06/18/retrofits/</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>RxJava</title>
    <url>/2020/08/04/RxJava/</url>
    <content><![CDATA[<h4 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h4><h5 id="观察者模式使用"><a href="#观察者模式使用" class="headerlink" title="观察者模式使用"></a>观察者模式使用</h5><p><img src="/2020/08/04/RxJava/2021-07-11_observer.png"></p>
<p><img src="/2020/08/04/RxJava/2021-07-11_observable.png"></p>
<ol>
<li>最主要的是Observable里面持有observer引用，就可以给observer发消息，其他的都是拓展。</li>
<li>Rxjava2会有Flower等背压类继承ObservableSource，所以 Observable 从ObservableSource分离出来，让ObservableCreate实现subscribeAcutal(Observer)</li>
<li>本来可以在ObservableCreate中直接发消息，因为emmit也可能变，现在把调用流程放到了ObservableOnSubscribe,并且传了emmit,最终ObservableOnSubscribe打包给了了ObservableCreate</li>
</ol>
<h5 id="观察者模式应用"><a href="#观察者模式应用" class="headerlink" title="观察者模式应用"></a>观察者模式应用</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的被观察者</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ObservableCreate</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Observable</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    ObservableOnSubscribe&lt;T&gt; source;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ObservableCreate</span><span class="params">(ObservableOnSubscribe&lt;T&gt; source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.source = source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer observer)</span> </span>&#123;</span><br><span class="line">        observer.onSubscribe(); <span class="comment">//订阅成功，回调给观察者</span></span><br><span class="line">        <span class="comment">//创建发射器</span></span><br><span class="line">        CreateEmitter createEmitter = <span class="keyword">new</span> CreateEmitter(observer); <span class="comment">//发射器和观察者建立关联</span></span><br><span class="line">        source.subscribe(createEmitter); <span class="comment">//发射器与被观察者建立关联</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateEmitter</span>&lt;<span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">Emitter</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> Observer&lt;T&gt; observer;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CreateEmitter</span><span class="params">(Observer&lt;T&gt; observer)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.observer = observer;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">            observer.onNext(t);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onError</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">            observer.onError(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            observer.onComplete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h4><h5 id="装饰器模式使用"><a href="#装饰器模式使用" class="headerlink" title="装饰器模式使用"></a>装饰器模式使用</h5><p>RxJava观察者模式最主要是这个方法 subscribeActual(Observer observer) ，通过发射器与 观察者、被观察者建立关联，接着通过发射器发送事件给观察者。</p>
<p>!(RxJava/2021-07-12_RXJAVA.png)</p>
<p><img src="/2020/08/04/RxJava/2021-07-13_5.37.48_observer1.png"></p>
<p><img src="/2020/08/04/RxJava/2021-07-14_3.14.28_zhuangshi.png"></p>
<p>红色方框中用到了 装饰器模式。</p>
<h4 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h4><p>WriteRxJavaActivity.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Observable.create(<span class="keyword">new</span> ObservableOnSubscribe&lt;Object&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Emitter&lt;Object&gt; emitter)</span> </span>&#123;</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;subscribe: &quot;</span>);</span><br><span class="line">        emitter.onNext(<span class="string">&quot;aaaa&quot;</span>);</span><br><span class="line">        emitter.onNext(<span class="string">&quot;bbb&quot;</span>);</span><br><span class="line">        emitter.onNext(<span class="string">&quot;12312&quot;</span>);</span><br><span class="line">        emitter.onComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">        .map(<span class="keyword">new</span> Function&lt;Object, Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">&quot;apply 后 1 &quot;</span> + o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .map(<span class="keyword">new</span> Function&lt;Object, Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">apply</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (<span class="string">&quot;apply 后 2 &quot;</span> + o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        .subscribe(<span class="keyword">new</span> Observer() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onNext</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">                Log.i(TAG, <span class="string">&quot;onNext: &quot;</span> + o);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>



<h5 id="调用结构图"><a href="#调用结构图" class="headerlink" title="调用结构图"></a>调用结构图</h5><p>上面代码的调用结构可以用下图表示</p>
<p><img src="/2020/08/04/RxJava/RxJava_LinkedList.png"></p>
<p><img src="/2020/08/04/RxJava/2021-07-17_at_8.51.53_stream.png"></p>
<p>上面三条流，可以看到每一条流的结束会启动另一条流的开端。</p>
<p>N0持有source引用，自己又创建Observable,订阅了O4。</p>
<ol>
<li>链式构建流</li>
</ol>
<p><img src="/2020/08/04/RxJava/2021-07-17_9.40.53_observable.png"></p>
<ol start="2">
<li>订阅流</li>
</ol>
<p><img src="/2020/08/04/RxJava/2021-07-17_9.41.07_observer.png"></p>
<ol start="3">
<li>观察者回调流（事件回调流）</li>
</ol>
<p><img src="/2020/08/04/RxJava/2021-07-17_9.41.41_emmit.png"></p>
<h5 id="ObservableMap"><a href="#ObservableMap" class="headerlink" title="ObservableMap"></a>ObservableMap</h5><p>其中关键代码在ObservableMap.java ,subscribeActual方法。</p>
<p>Observalbe.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;R&gt;  <span class="function">ObservableMap&lt;T, R&gt; <span class="title">map</span><span class="params">(Function&lt;T,R&gt; function)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  <span class="keyword">new</span> ObservableMap(<span class="keyword">this</span>,function); <span class="comment">//上层Observable传入 ObservableMap</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ObservableMap.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">subscribeActual</span><span class="params">(Observer observer)</span> </span>&#123;         <span class="comment">// source上层Observable,</span></span><br><span class="line">    source.subscribe(<span class="keyword">new</span> MapObserver(observer, function)); <span class="comment">//传入的observer是下游的observer,可以从最后往前看</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="调用流程"><a href="#调用流程" class="headerlink" title="调用流程"></a>调用流程</h5><ol>
<li>第一遍 把 Observable传入下一层的Observable中。 可以理解为 调用结构图 -&gt;向右建立关联</li>
<li>直至调用到最后的观察者subscribe(new Observer())，开始把下一级的Observer传入Observable(被观察者)，可以理解为向左建立关联。</li>
<li> 1，2完成后可以理解为建立双向链表，上游一直持有下游的Observer,开始发送emitter.onNext(“aaaa”);事件。</li>
</ol>
<p>​    除了最后手动建立观察者，中间也建立了观察者，不停的向下发送事件。</p>
<p>​    observable observer都在套娃。</p>
<h5 id="ObservableFlatMap"><a href="#ObservableFlatMap" class="headerlink" title="ObservableFlatMap"></a>ObservableFlatMap</h5><p>接收事件后，创建新的事件发送。</p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><h5 id="RxJava的subscribeOn只有第一次生效"><a href="#RxJava的subscribeOn只有第一次生效" class="headerlink" title="RxJava的subscribeOn只有第一次生效?"></a>RxJava的subscribeOn只有第一次生效?</h5><p>​    subscribeOn对subscribe订阅进行处理，针对是订阅流，从后向前流动，所以最前面的一次生效。</p>
<h5 id="RxJava的observeOn多次调用哪个有效"><a href="#RxJava的observeOn多次调用哪个有效" class="headerlink" title="RxJava的observeOn多次调用哪个有效?"></a>RxJava的observeOn多次调用哪个有效?</h5><p>​    observeOn在事件发送的 onNext(T t)进行处理，针对的是观察者流，从前向后流动，所以最后一次生效。</p>
<h4 id="匿名内部类和lambda区别"><a href="#匿名内部类和lambda区别" class="headerlink" title="匿名内部类和lambda区别"></a>匿名内部类和lambda区别</h4><p>[<a href="https://github.com/CarpenterLee/JavaLambdaInternals/blob/master/2-Lambda%20and%20Anonymous%20Classes(II).md]">https://github.com/CarpenterLee/JavaLambdaInternals/blob/master/2-Lambda%20and%20Anonymous%20Classes(II).md]</a>(<a href="https://github.com/CarpenterLee/JavaLambdaInternals/blob/master/2-Lambda">https://github.com/CarpenterLee/JavaLambdaInternals/blob/master/2-Lambda</a> and Anonymous Classes(II).md)</p>
<p><strong>匿名内部类仍然是一个类，只是不需要程序员显示指定类名，编译器会自动为该类取名</strong>。因此如果有如下形式的代码，编译之后将会产生两个class文件</p>
<p><strong>Lambda表达式通过*invokedynamic*指令实现，书写Lambda表达式不会产生新的类</strong></p>
<p>推论，this引用的意义</p>
<p>既然Lambda表达式不是内部类的简写，那么Lambda内部的<code>this</code>引用也就跟内部类对象没什么关系了。在Lambda表达式中<code>this</code>的意义跟在表达式外部完全一样。因此下列代码将输出两遍<code>Hello Hoolee</code>，而不是两个引用地址。</p>
<h4 id="Java-函数式接口"><a href="#Java-函数式接口" class="headerlink" title="Java 函数式接口"></a>Java 函数式接口</h4><ol>
<li>java接口</li>
<li>只有一个方法</li>
</ol>
<h5 id="传统方法"><a href="#传统方法" class="headerlink" title="传统方法"></a>传统方法</h5><figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(<span class="keyword">int</span> level, <span class="keyword">String</span> msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (level == <span class="number">1</span>) &#123; <span class="comment">//如果不是1  msg已经拼接 所以造成浪费</span></span><br><span class="line">        System.out.<span class="built_in">println</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">String</span> msgA = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="keyword">String</span> msgB = <span class="string">&quot;World&quot;</span>;</span><br><span class="line">    <span class="keyword">String</span> msgC = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line">    <span class="built_in">log</span>(<span class="number">1</span>, msgA + msgB + msgC);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="lambda"><a href="#lambda" class="headerlink" title="lambda"></a>lambda</h5><figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">interface MessageBuilder &#123;</span><br><span class="line">    <span class="built_in">String</span> builderMessage();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private <span class="keyword">static</span> <span class="literal">void</span> showLog(int level, MessageBuilder msg) &#123;</span><br><span class="line">    <span class="keyword">if</span> (level == <span class="number">1</span>) &#123;</span><br><span class="line">        System.out.println(msg.builderMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public <span class="keyword">static</span> <span class="literal">void</span> main(<span class="built_in">String</span>[] args) &#123;</span><br><span class="line">    <span class="built_in">String</span> msgA = <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    <span class="built_in">String</span> msgB = <span class="string">&quot;World&quot;</span>;</span><br><span class="line">    <span class="built_in">String</span> msgC = <span class="string">&quot;Java&quot;</span>;</span><br><span class="line"></span><br><span class="line">    showLog<span class="function"><span class="params">(<span class="number">1</span>, () -&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">            msgA + msgB + msgC)</span>;</span></span><br><span class="line"><span class="function">    //使用<span class="title">lambda</span>表达式只是作为参数传递，仅仅吧参数传到<span class="title">showLog</span><span class="params">()</span>中</span></span><br><span class="line"><span class="function">    //只有日志等级是1时 才会调用<span class="title">builderMessage</span> 拼接字符串</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">showLog</span><span class="params">(<span class="number">1</span>, () -&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                System.out.println(<span class="string">&quot;1 是否执行&quot;</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">return</span> msgA + msgB + msgC;</span></span></span><br><span class="line"><span class="function"><span class="params">            &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>;</span></span><br><span class="line"><span class="function">    <span class="title">showLog</span><span class="params">(<span class="number">2</span>, () -&gt; &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">                System.out.println(<span class="string">&quot;2 是否执行&quot;</span>);</span></span></span><br><span class="line"><span class="function"><span class="params">                <span class="keyword">return</span> msgA + msgB + msgC;</span></span></span><br><span class="line"><span class="function"><span class="params">            &#125;</span></span></span><br><span class="line"><span class="function"><span class="params">    )</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>



<p>这样看来 lambda:  (左边是参数)  -&gt;  {右边是方法体} </p>
<p>方法体是 接口中唯一方法的实现</p>
<p><a href="https://www.bilibili.com/video/BV1U4411V7Sv?p=5">https://www.bilibili.com/video/BV1U4411V7Sv?p=5</a></p>
<h4 id="RxJava操作符"><a href="#RxJava操作符" class="headerlink" title="RxJava操作符"></a>RxJava操作符</h4><h6 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs this operation on the given argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the input argument</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">accept</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">default</span> Consumer&lt;T&gt; <span class="title">andThen</span><span class="params">(Consumer&lt;? <span class="keyword">super</span> T&gt; after)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(after);</span><br><span class="line">        <span class="keyword">return</span> (T t) -&gt; &#123; accept(t); after.accept(t); &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="accept"><a href="#accept" class="headerlink" title="accept"></a>accept</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">(String name,Consumer&lt;String&gt; con)</span></span>&#123;</span><br><span class="line">    con.accept(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">method(<span class="string">&quot;john&quot;</span>,(String name)-&gt;&#123;</span><br><span class="line">    System.out.println(name);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h6 id="andThen"><a href="#andThen" class="headerlink" title="andThen"></a>andThen</h6><p>示例1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method3</span><span class="params">(String s, Consumer1 con1, Consumer1 con2)</span> </span>&#123;</span><br><span class="line">    con1.andThen3(con2).accept(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>等价于</p>
<p>示例2</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> void <span class="function"><span class="keyword">method</span><span class="params">(String s, Consumer&lt;String&gt; con1, Consumer&lt;Double&gt; con2)</span> <span class="comment">&#123;</span></span></span><br><span class="line"><span class="function"><span class="comment">    con1.accept(s);</span></span></span><br><span class="line"><span class="function"><span class="comment">    con2.accept(Double.parseDouble(s));</span></span></span><br><span class="line"><span class="function"><span class="comment">&#125;</span></span></span><br></pre></td></tr></table></figure>



<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">method3(<span class="string">&quot;3.14&quot;</span>, <span class="function"><span class="params">(t)</span> -&gt;</span> &#123;</span><br><span class="line">    System.out.println(t + <span class="string">&quot;15926&quot;</span>);</span><br><span class="line">&#125;, <span class="function"><span class="params">(t)</span> -&gt;</span> &#123;</span><br><span class="line">    System.out.println(t + <span class="string">&quot;jj&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>一开始 纳闷 <code> con1.andThen3(con2).accept(s);</code>  为啥还调用一个accept(s)</p>
<p>自定义的Consumer1</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">@FunctionalInterface</span><br><span class="line">public interface Consumer1 &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Performs this operation on the given argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param t the input argument</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="literal">void</span> accept(<span class="built_in">String</span> t);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">default</span> Consumer1 andThen(Consumer1 after) &#123;</span><br><span class="line">        Objects.requireNonNull(after);</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">(<span class="built_in">String</span> t)</span> -&gt;</span> &#123;</span><br><span class="line">            accept(t);</span><br><span class="line">            after.accept(t);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> Consumer1 andThen1(Consumer1 after) &#123;</span><br><span class="line">        Objects.requireNonNull(after);</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">(<span class="built_in">String</span> t)</span> -&gt;</span> &#123;</span><br><span class="line">            accept(t);</span><br><span class="line">            after.accept(t);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> Consumer1 andThen2(Consumer1 after) &#123;</span><br><span class="line">        Objects.requireNonNull(after);</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">(<span class="built_in">String</span> t)</span> -&gt;</span> &#123;</span><br><span class="line">            accept(t);</span><br><span class="line">            accept(t);</span><br><span class="line">            after.accept(t);</span><br><span class="line">            after.accept(t);</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> Consumer1 andThen3(Consumer1 after) &#123;</span><br><span class="line">        Consumer1 <span class="function"><span class="title">m</span> = <span class="params">(<span class="built_in">String</span> t)</span> -&gt;</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;接收参数 t : &quot;</span>+t);</span><br><span class="line"></span><br><span class="line">            after.accept(t);</span><br><span class="line">            accept(t);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我的理解 ：</p>
<ol>
<li><p>可以看 lambda 延迟调用的示例，当调用accept(s)方法 才开始调用方法体 <code>&#123; accept(t); after.accept(t); &#125;</code>的方法，</p>
</li>
<li><p>返回lambda,可以当作匿名内部类的语法糖, <code>accept(s)</code>当作匿名内部类的方法， s作为参数 传入到 <code>(T t) -&gt; &#123; accept(t); after.accept(t); &#125;</code>  t中</p>
<p>通过下面这个示例可以验证</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MessageBuilder1</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">builderMessage</span><span class="params">(<span class="keyword">int</span> param)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showLog1</span><span class="params">(<span class="keyword">int</span> level, MessageBuilder1 msg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (level == <span class="number">1</span>) &#123;</span><br><span class="line">        System.out.println(msg.builderMessage(<span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">showLog1(<span class="number">1</span>, (t) -&gt; &#123;</span><br><span class="line">    System.out.println(t);</span><br><span class="line">    <span class="keyword">return</span> msgA + msgB + msgC;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<p>5<br>HelloWorldJava</p>
</li>
</ol>
<h6 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> java.util.function;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Represents a function that accepts one argument and produces a result.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is a &lt;a href=&quot;package-summary.html&quot;&gt;functional interface&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * whose functional method is &#123;<span class="doctag">@link</span> #apply(Object)&#125;.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;T&gt; the type of the input to the function</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &lt;R&gt; the type of the result of the function</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Applies this function to the given argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t the function argument</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the function result</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a composed function that first applies the &#123;<span class="doctag">@code</span> before&#125;</span></span><br><span class="line"><span class="comment">     * function to its input, and then applies this function to the result.</span></span><br><span class="line"><span class="comment">     * If evaluation of either function throws an exception, it is relayed to</span></span><br><span class="line"><span class="comment">     * the caller of the composed function.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;V&gt; the type of input to the &#123;<span class="doctag">@code</span> before&#125; function, and to the</span></span><br><span class="line"><span class="comment">     *           composed function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> before the function to apply before this function is applied</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a composed function that first applies the &#123;<span class="doctag">@code</span> before&#125;</span></span><br><span class="line"><span class="comment">     * function and then applies this function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if before is null</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #andThen(Function)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> &lt;V&gt; <span class="function">Function&lt;V, R&gt; <span class="title">compose</span><span class="params">(Function&lt;? <span class="keyword">super</span> V, ? extends T&gt; before)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(before);</span><br><span class="line">        <span class="keyword">return</span> (V v) -&gt; apply(before.apply(v));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a composed function that first applies this function to</span></span><br><span class="line"><span class="comment">     * its input, and then applies the &#123;<span class="doctag">@code</span> after&#125; function to the result.</span></span><br><span class="line"><span class="comment">     * If evaluation of either function throws an exception, it is relayed to</span></span><br><span class="line"><span class="comment">     * the caller of the composed function.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;V&gt; the type of output of the &#123;<span class="doctag">@code</span> after&#125; function, and of the</span></span><br><span class="line"><span class="comment">     *           composed function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> after the function to apply after this function is applied</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a composed function that first applies this function and then</span></span><br><span class="line"><span class="comment">     * applies the &#123;<span class="doctag">@code</span> after&#125; function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if after is null</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #compose(Function)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">default</span> &lt;V&gt; <span class="function">Function&lt;T, V&gt; <span class="title">andThen</span><span class="params">(Function&lt;? <span class="keyword">super</span> R, ? extends V&gt; after)</span> </span>&#123;</span><br><span class="line">        Objects.requireNonNull(after);</span><br><span class="line">        <span class="keyword">return</span> (T t) -&gt; after.apply(apply(t));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns a function that always returns its input argument.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt; the type of the input and output objects to the function</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a function that always returns its input argument</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T&gt; <span class="function">Function&lt;T, T&gt; <span class="title">identity</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t -&gt; t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compute</span><span class="params">(<span class="keyword">int</span> a, Function&lt;Integer,Integer&gt; function)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> reuslt = function.apply(a); <span class="comment">//  相当于 2 * value  操作</span></span><br><span class="line">    <span class="keyword">return</span> reuslt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FunctionTest functionTest = <span class="keyword">new</span> FunctionTest();</span><br><span class="line">functionTest.compute(<span class="number">1</span>,value-&gt;&#123;<span class="keyword">return</span>  <span class="number">2</span> * value ;&#125;);</span><br><span class="line"></span><br><span class="line">Function&lt;Integer,Integer&gt; function = value -&gt; value *<span class="number">2</span>;</span><br><span class="line">functionTest.compute(<span class="number">1</span>,function);</span><br><span class="line"></span><br><span class="line">function.compose(function);</span><br></pre></td></tr></table></figure>



<p> RxJava 思考</p>
<p><a href="https://gank.io/post/560e15be2dca930e00da1083#toc_31">https://gank.io/post/560e15be2dca930e00da1083#toc_31</a></p>
<p><a href="https://juejin.im/post/6844903670203547656">https://juejin.im/post/6844903670203547656</a></p>
<p><a href="https://juejin.im/post/6844903711416778765">https://juejin.im/post/6844903711416778765</a></p>
<p><a href="https://www.jianshu.com/p/7fce2955f2db">https://www.jianshu.com/p/7fce2955f2db</a></p>
<p><a href="https://juejin.im/post/6844903838978146317">https://juejin.im/post/6844903838978146317</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title>RxJava01</title>
    <url>/2018/03/28/RxJava01/</url>
    <content><![CDATA[<h5 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h5><h6 id="Describe"><a href="#Describe" class="headerlink" title="Describe"></a>Describe</h6><ul>
<li>subscribeOn() 指定上游发送事件的线程, observeOn　指定的是下游接收事件的线程</li>
<li>多次指定上游的线程只有第一次指定的有效,就是subscribeOn()只有第一次有效,其余忽略</li>
<li>可以多次指定下游线程,每调用一次observeOn(),下游的线程就会切换一次</li>
</ul>
<p>Demo在　AndroidDemo -&gt; RXLeran-&gt;RX基础-&gt;Rx线程切换</p>
<h6 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h6><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">RetrofitFactory</span>.</span></span>create(<span class="module-access"><span class="module"><span class="identifier">ICommonApis</span>.</span></span><span class="keyword">class</span>)</span><br><span class="line">              .img<span class="constructor">UpServer(<span class="params">part</span>)</span></span><br><span class="line">              .subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">              .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">              .<span class="keyword">do</span><span class="constructor">OnNext(<span class="params">new</span> Consumer&lt;PictureUp&gt;()</span> &#123;</span><br><span class="line">                  @Override</span><br><span class="line">                  public void accept(PictureUp pictureUp) throws Exception &#123;</span><br><span class="line">                      List&lt;PictureUp.ModelListBean&gt; picList = pictureUp.get<span class="constructor">Model_list()</span>;</span><br><span class="line">                      <span class="keyword">if</span> (picList != null<span class="operator"> &amp;&amp; </span>!picList.is<span class="constructor">Empty()</span>) &#123;</span><br><span class="line">                          String feet_id = picList.get(<span class="number">0</span>).get<span class="constructor">File_group_id()</span>;</span><br><span class="line">                          <span class="comment">//上传成功</span></span><br><span class="line">                          <span class="keyword">if</span> (!is<span class="constructor">Empty(<span class="params">feet_id</span>)</span><span class="operator"> &amp;&amp; </span>mvpView != null) &#123;</span><br><span class="line">                              mvpView.up<span class="constructor">FeetId(<span class="params">feet_id</span>)</span>;</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .observe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">              .flat<span class="constructor">Map(<span class="params">new</span> Function&lt;PictureUp, ObservableSource&lt;BaseCount&gt;&gt;()</span> &#123;</span><br><span class="line">                  @Override</span><br><span class="line">                  public ObservableSource&lt;BaseCount&gt; apply(PictureUp pictureUp) throws Exception &#123;</span><br><span class="line">                      List&lt;PictureUp.ModelListBean&gt; picList = pictureUp.get<span class="constructor">Model_list()</span>;</span><br><span class="line">                      <span class="keyword">if</span> (picList != null<span class="operator"> &amp;&amp; </span>!picList.is<span class="constructor">Empty()</span>) &#123;</span><br><span class="line">                          String feet_id = picList.get(<span class="number">0</span>).get<span class="constructor">File_group_id()</span>;</span><br><span class="line">                          <span class="comment">//上传成功</span></span><br><span class="line">                          <span class="keyword">if</span> (!is<span class="constructor">Empty(<span class="params">feet_id</span>)</span><span class="operator"> &amp;&amp; </span>mvpView != null) &#123;</span><br><span class="line">                              mvpView.up<span class="constructor">FeetId(<span class="params">feet_id</span>)</span>;</span><br><span class="line">                          &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                              return  <span class="module-access"><span class="module"><span class="identifier">Observable</span>.</span></span>error(<span class="keyword">new</span> <span class="constructor">Exception()</span>);</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                      return <span class="module-access"><span class="module"><span class="identifier">RetrofitFactory</span>.</span></span>create(<span class="module-access"><span class="module"><span class="identifier">ICommonApis</span>.</span></span><span class="keyword">class</span>).offline<span class="constructor">BoxInfo(<span class="params">requestBody</span>)</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;)</span><br><span class="line">              .subscribe(<span class="keyword">new</span> Consumer&lt;BaseCount&gt;<span class="literal">()</span> &#123;</span><br><span class="line">                  @Override</span><br><span class="line">                  public void accept(BaseCount baseCount) throws Exception &#123;</span><br><span class="line">                      <span class="keyword">if</span> (mvpView<span class="operator"> == </span>null) &#123;</span><br><span class="line">                          return;</span><br><span class="line">                      &#125;</span><br><span class="line">                      <span class="keyword">if</span> (baseCount.get<span class="constructor">Meta()</span>.get<span class="constructor">StatusCode()</span><span class="operator"> == </span>AUTH_FAILED) &#123;</span><br><span class="line">                          mvpView.un<span class="constructor">OfficeEquip(<span class="params">baseCount</span>)</span>;</span><br><span class="line">                      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (baseCount.get<span class="constructor">Meta()</span>.get<span class="constructor">StatusCode()</span><span class="operator"> == </span><span class="number">0</span>) &#123;</span><br><span class="line">                          mvpView.up<span class="constructor">Success()</span>;</span><br><span class="line">                      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                          <span class="keyword">if</span> (baseCount.get<span class="constructor">Meta()</span> != null<span class="operator"> &amp;&amp; </span>!is<span class="constructor">Empty(<span class="params">baseCount</span>.<span class="params">getMeta</span>()</span>.get<span class="constructor">Describe()</span>)) &#123;</span><br><span class="line">                              <span class="module-access"><span class="module"><span class="identifier">ToastUtil</span>.</span></span>show<span class="constructor">BiggerText(<span class="params">baseCount</span>.<span class="params">getMeta</span>()</span>.get<span class="constructor">Describe()</span>);</span><br><span class="line">                          &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;, <span class="keyword">new</span> Consumer&lt;Throwable&gt;<span class="literal">()</span> &#123;</span><br><span class="line">                  @Override</span><br><span class="line">                  public void accept(Throwable throwable) throws Exception &#123;</span><br><span class="line">                      <span class="keyword">if</span> (mvpView != null) &#123;</span><br><span class="line">                          mvpView.up<span class="constructor">UserInfoFailed()</span>;</span><br><span class="line">                      &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;);</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">fun</span> get<span class="constructor">ImgScan()</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> request = <span class="module-access"><span class="module"><span class="identifier">RetrofitWeChatFactory</span>.</span></span>create(IApiStore::<span class="keyword">class</span>.java)</span><br><span class="line">    request.get<span class="constructor">_access_token()</span></span><br><span class="line">        .flatMap &#123; request.get<span class="constructor">Ticket(<span class="params">it</span>.<span class="params">access_token</span>, 2)</span> &#125;</span><br><span class="line">        .subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">        .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">        .subscribe(<span class="keyword">object</span> : Observer&lt;WeChatSecond&gt; &#123;</span><br><span class="line">            override <span class="keyword">fun</span> on<span class="constructor">Complete()</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            override <span class="keyword">fun</span> on<span class="constructor">Subscribe(<span class="params">d</span>: Disposable)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            override <span class="keyword">fun</span> on<span class="constructor">Next(<span class="params">t</span>: WeChatSecond)</span> &#123;</span><br><span class="line">                <span class="keyword">val</span> noncestr = <span class="module-access"><span class="module"><span class="identifier">LoginNewActivity</span>.</span></span>get<span class="constructor">RandomString(8)</span></span><br><span class="line">                <span class="keyword">val</span> timeStamp =</span><br><span class="line">                    (<span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>current<span class="constructor">TimeMillis()</span><span class="operator"> / </span><span class="number">1000</span>).<span class="keyword">to</span><span class="constructor">String()</span></span><br><span class="line">                t.ticket?.<span class="keyword">let</span> &#123;</span><br><span class="line">                    <span class="keyword">val</span> string1 = <span class="module-access"><span class="module"><span class="identifier">String</span>.</span></span>format(</span><br><span class="line">                        <span class="string">&quot;appid=%s&amp;noncestr=%s&amp;sdk_ticket=%s&amp;timestamp=%s&quot;</span>,</span><br><span class="line">                        WeChatAppID,</span><br><span class="line">                        noncestr,</span><br><span class="line">                        it,</span><br><span class="line">                        timeStamp</span><br><span class="line">                    )</span><br><span class="line">                    <span class="keyword">val</span> sha = <span class="module-access"><span class="module"><span class="identifier">EncryptUtils</span>.</span></span>get<span class="constructor">SHA(<span class="params">string1</span>)</span></span><br><span class="line"></span><br><span class="line">                    mvpView.sign(noncestr, timeStamp, sha)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            override <span class="keyword">fun</span> on<span class="constructor">Error(<span class="params">e</span>: Throwable)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="http://yamlee.me/2020/03/11/2020-03-11-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3RxJava%E4%B8%8ERxKotlin/">http://yamlee.me/2020/03/11/2020-03-11-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3RxJava%E4%B8%8ERxKotlin/</a></p>
<p><a href="http://reactivex.io/documentation/operators.html">http://reactivex.io/documentation/operators.html</a></p>
<p><a href="https://www.jianshu.com/p/fa1828d70192">https://www.jianshu.com/p/fa1828d70192</a></p>
<p><a href="https://www.cnblogs.com/fuyaozhishang/p/8697404.html">https://www.cnblogs.com/fuyaozhishang/p/8697404.html</a></p>
<h6 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h6><p><a href="http://www.10tiao.com/html/169/201709/2650823932/1.html">水管系列</a> </p>
<p><a href="https://github.com/ReactiveX/RxAndroid">https://github.com/ReactiveX/RxAndroid</a><br><a href="https://github.com/amitshekhariitbhu/RxJava2-Android-Samples">https://github.com/amitshekhariitbhu/RxJava2-Android-Samples</a><br><a href="https://github.com/rengwuxian/RxJavaSample">https://github.com/rengwuxian/RxJavaSample</a></p>
<p><a href="https://github.com/ssseasonnn/RxJava2Demo">https://github.com/ssseasonnn/RxJava2Demo</a></p>
<p><a href="https://juejin.im/post/5b8f536c5188255c352d3528">https://juejin.im/post/5b8f536c5188255c352d3528</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTAzMTMxMg==&mid=2649492706&idx=1&sn=d7d213a1db9c8ae3a5b0525d45863518&chksm=8eec871db99b0e0bc4d4d1aa2b7ed5d7c32e5299aee0f0818a798c2deb2996f40f8971c7a6a2&scene=38#wechat_redirect">RxJava 只看这一篇文章就够了(上)</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTAzMTMxMg==&mid=2649492715&idx=1&sn=9d2160fae874472f1ecf40f91c52d837&chksm=8eec8714b99b0e02f08afc916f94fb2bd075c9ce31c214c5c45674739ca110bed423e8f44d5c&scene=38#wechat_redirect">RxJava 只看这一篇文章就够了 (中)</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTAzMTMxMg==&mid=2649492715&idx=2&sn=18ec403398fc5044732779ca8cbddd1b&chksm=8eec8714b99b0e02692798393314d6ac437db33e067ab2880972c1124937a66b32d07b49f978&scene=38#wechat_redirect">RxJava 只看这一篇文章就够了 (下)</a></p>
<p>使用MVP Dagger2 <a href="https://juejin.im/post/5d5ce44d5188252231108e68">https://juejin.im/post/5d5ce44d5188252231108e68</a></p>
<p><a href="https://juejin.im/user/590210f4ac502e0063d338f5/posts">https://juejin.im/user/590210f4ac502e0063d338f5/posts</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title>RxJava02</title>
    <url>/2019/09/19/RxJava02/</url>
    <content><![CDATA[<p><strong>操作符</strong></p>
<ul>
<li><p>retryWhen</p>
<p><code>retryWhen</code>是收到<code>onError</code>后触发是否要重订阅的询问，而<code>repeatWhen</code>是通过<code>onComplete</code>触发。</p>
</li>
</ul>
<p><a href="https://blog.csdn.net/qq_35599978/article/details/80290252">https://blog.csdn.net/qq_35599978/article/details/80290252</a></p>
<p><a href="https://www.jianshu.com/p/d135f19e045c">https://www.jianshu.com/p/d135f19e045c</a></p>
<h5 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h5><p>专用于合并事件，该合并不是连接（连接操作符后面会说），而是两两配对，也就意味着，最终配对出的 <code>Observable</code> 发射事件数目只和少的那个相同。</p>
<h5 id="concat"><a href="#concat" class="headerlink" title="concat"></a><code>concat</code></h5><p>单一的把两个发射器连接成一个发射器</p>
<h5 id="FlatMap"><a href="#FlatMap" class="headerlink" title="FlatMap"></a><code>FlatMap</code></h5><p>它可以把一个发射器 <code>Observable</code> 通过某种方法转换为多个 <code>Observables</code>,<code>flatMap</code> 并不能保证事件的顺序</p>
<p>如果需要保证，需要用到我们下面要讲的 <code>ConcatMap</code></p>
<h5 id="ConcatMap"><a href="#ConcatMap" class="headerlink" title="ConcatMap"></a>ConcatMap</h5><h5 id="doOnNext"><a href="#doOnNext" class="headerlink" title="doOnNext"></a>doOnNext</h5><p>让订阅者在接收到数据之前可以做其他事情,获取到数据之前想先保存一下它</p>
<h5 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h5><p> skip(2)  跳过count个数开始接收</p>
<h5 id="take"><a href="#take" class="headerlink" title="take"></a>take</h5><p>最多接收count个数据</p>
<h5 id="just"><a href="#just" class="headerlink" title="just"></a>just</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Observable.just(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="string">&quot;3&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>简单的发射器依次调用 <code>onNext()</code> 方法</p>
<h5 id="Single"><a href="#Single" class="headerlink" title="Single"></a>Single</h5><p><code>Single</code> 只会接收一个参数，而 <code>SingleObserver</code> 只会调用 <code>onError()</code> 或者 <code>onSuccess()</code></p>
<h5 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h5><p>去重操作符，简单的作用就是去重</p>
<h5 id="debounce"><a href="#debounce" class="headerlink" title="debounce"></a>debounce</h5><h5 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h5><p>每次订阅都会创建一个新的 <code>Observable</code>，并且如果没有被订阅，就不会产生新的</p>
<h5 id="last"><a href="#last" class="headerlink" title="last"></a>last</h5><p>操作符仅取出可观察到的最后一个值</p>
<h5 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h5><h5 id="window"><a href="#window" class="headerlink" title="window"></a>window</h5><p>按照实际划分窗口，将数据发送给不同的 <code>Observable</code></p>
<h5 id="empty-amp-never-amp-error"><a href="#empty-amp-never-amp-error" class="headerlink" title="empty() &amp; never() &amp; error()"></a>empty() &amp; never() &amp; error()</h5><blockquote>
<ol>
<li>empty() ： 直接发送 onComplete() 事件</li>
<li>never()：不发送任何事件</li>
<li>error()：发送 onError() 事件</li>
</ol>
</blockquote>
<p><a href="https://www.jianshu.com/p/c08bfc58f4b6">https://www.jianshu.com/p/c08bfc58f4b6</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>RxJava</tag>
      </tags>
  </entry>
  <entry>
    <title>SDK_Integration</title>
    <url>/2017/09/19/SDK_Integration/</url>
    <content><![CDATA[<p>平常集成SDK虽然简单，但是过了半年就全忘了，又得重新来过</p>
<h4 id="友盟分享"><a href="#友盟分享" class="headerlink" title="友盟分享"></a>友盟分享</h4><p><a href="https://open.weixin.qq.com/">微信开发者平台</a><br>创建应用需要 <strong>应用签名</strong></p>
<p>需要签名工具,可以从 <a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&t=resource/res_list&verify=1&id=open1419319167&token=&lang=zh_CN">微信资源中心</a> 获取</p>
<p> 注意要打包才能运行</p>
<h4 id="商汤认证"><a href="#商汤认证" class="headerlink" title="商汤认证"></a>商汤认证</h4><p><a href="https://v2-devcenter.visioncloudapi.com/#!/home/doc/ocr/android/online/useguide">文档</a></p>
<p>身份证认证</p>
<ul>
<li><p>在common-idcard包中的assets目录下添加 SenseID_OCR.lic文件就可以了</p>
</li>
<li><p>在androidmanifest.xml注册activity</p>
</li>
</ul>
<p>活体认证</p>
<p>最终调用onDetectOver</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public void on<span class="constructor">DetectOver(ResultCode <span class="params">code</span>, String <span class="params">id</span>, List <span class="params">imageData</span>)</span></span><br></pre></td></tr></table></figure>

<p>会返回id,然后把id,身份证number,name传给商汤对比</p>
<h4 id="极光推送"><a href="#极光推送" class="headerlink" title="极光推送"></a>极光推送</h4><ul>
<li><p>集成过程</p>
<p>按照文档，主要是要注意这个广播接收器就可以了</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;receiver</span><br><span class="line">          android:name=&quot;.jpush.MyReceiver&quot;</span><br><span class="line">          android:enabled=&quot;true&quot;&gt;</span><br><span class="line">          <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户注册SDK的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.REGISTRATION&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户接收SDK消息的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.MESSAGE_RECEIVED&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户接收SDK通知栏信息的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.NOTIFICATION_RECEIVED&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!--Required 用户打开自定义通知栏的intent--&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.NOTIFICATION_OPENED&quot;</span> /&gt;</span></span><br><span class="line">              <span class="comment">&lt;!-- 接收网络变化 连接/断开 since 1.6.3 --&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;cn.jpush.android.intent.CONNECTION&quot;</span> /&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">category</span> <span class="attr">android:name</span>=<span class="string">&quot;com.zhujia.land&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>有点疑惑的是推送给特定的APP</p>
<p>目前获取RegistrationID，登陆接口把 RegistrationID传给服务端, 然后Server推送过来就可以了</p>
<p><a href="http://blog.jiguang.cn/push_audience_tech-2/">http://blog.jiguang.cn/push_audience_tech-2/</a></p>
<p> 暂时别试用Jcenter集成,会出现各种问题</p>
</li>
</ul>
<h4 id="微信登陆"><a href="#微信登陆" class="headerlink" title="微信登陆"></a>微信登陆</h4><h5 id="App登录"><a href="#App登录" class="headerlink" title="App登录"></a>App登录</h5><p><a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Resource_Center_Homepage.html">https://developers.weixin.qq.com/doc/oplatform/Mobile_App/Resource_Center_Homepage.html</a></p>
<ol>
<li>问题1</li>
</ol>
<p><code>E/MtaSDK: [pool-4-thread-1(320): null:705] - Server response error code:404, error:&#123;&quot;ret&quot;:-1, &quot;msg&quot;:&quot;invalid appkey&quot;&#125;</code></p>
<p>Demo里的wechat-sdk-android-with-mta 换成     api ‘com.tencent.mm.opensdk:wechat-sdk-android-without-mta:+’  这个弄了一上午</p>
<ol start="2">
<li><p>问题2  </p>
<p> <code> No value for openid.</code> WXEntryActivity {“errcode”:40029,”errmsg”:”invalid code”}   WXEntryActivity<br> appid secret错误</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (resp.<span class="built_in">getType</span>() == ConstantsAPI.COMMAND_SENDAUTH) &#123;</span><br><span class="line">   SendAuth.Resp authResp = (SendAuth.Resp)resp;</span><br><span class="line">   <span class="keyword">final</span> <span class="keyword">String</span> code = authResp.code;</span><br><span class="line">   NetworkUtil.<span class="built_in">sendWxAPI</span>(handler, <span class="keyword">String</span>.format(<span class="string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?&quot;</span> +</span><br><span class="line">               <span class="string">&quot;appid=%s&amp;secret=%s&amp;code=%s&amp;grant_type=authorization_code&quot;</span>, <span class="string">&quot;wx930ea5d5a258f4f&quot;</span>,</span><br><span class="line">         <span class="string">&quot;1d6d1d57a3dd06336d917bc0b44d964&quot;</span>, code), NetworkUtil.GET_TOKEN);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">GET https://api.weixin.qq.com/sns/oauth2/access_token?appid=APPID&amp;secret=SECRET&amp;code=CODE&amp;grant_type=authorization_code</span><br></pre></td></tr></table></figure>

<p>demo中 </p>
<p>appid wxd930ea5d5a2584f要换成自己的</p>
<p>secret 1d6d1d57a3dd063b36d91bc0b44d964也要换成自己的</p>
<ol start="3">
<li><p>问题3  需要注册，否则WXEntryActivity不能收到回调</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String APP_ID = <span class="string">&quot;wx88888888&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IWXAPI 是第三方app和微信通信的openApi接口</span></span><br><span class="line"><span class="keyword">private</span> IWXAPI api;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">regToWx</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 通过WXAPIFactory工厂，获取IWXAPI的实例</span></span><br><span class="line">    api = WXAPIFactory.createWXAPI(<span class="keyword">this</span>, APP_ID, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将应用的appId注册到微信</span></span><br><span class="line">    api.registerApp(APP_ID);</span><br><span class="line"></span><br><span class="line">   <span class="comment">//建议动态监听微信启动广播进行注册到微信</span></span><br><span class="line">  registerReceiver(<span class="keyword">new</span> BroadcastReceiver() &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 将该app注册到微信</span></span><br><span class="line">    api.registerApp(Constants.APP_ID);</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;, <span class="keyword">new</span> IntentFilter(ConstantsAPI.ACTION_REFRESH_WXAPP));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="二维码扫码登录"><a href="#二维码扫码登录" class="headerlink" title="二维码扫码登录"></a>二维码扫码登录</h5><p><a href="https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Login_via_Scan.html">https://developers.weixin.qq.com/doc/oplatform/Mobile_App/WeChat_Login/Login_via_Scan.html</a></p>
<ol>
<li><p>登录公众平台 <a href="https://mp.weixin.qq.com/cgi-bin/home?t=home">https://mp.weixin.qq.com/cgi-bin/home?t=home</a> ,点击配置进入IP白名单</p>
<p>点击配置进入IP白名单设置页</p>
<p><a href="https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&amp;key=1495617578&amp;version=1&amp;lang=zh_CN&amp;platform=2&amp;token=38764305">https://mp.weixin.qq.com/cgi-bin/announce?action=getannouncement&amp;key=1495617578&amp;version=1&amp;lang=zh_CN&amp;platform=2&amp;token=38764305</a></p>
</li>
<li><p>二维码扫码登录的appid secret key用开放平台的  <a href="https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN">https://open.weixin.qq.com/cgi-bin/index?t=home/index&amp;lang=zh_CN</a></p>
<p>注意两个不同的平台配置</p>
</li>
</ol>
</li>
</ol>
<p>二维码失效:  首先普及一下二维码是有失效时间以及失效状态的，一旦你扫过一次二维码或者在某段时间内没有扫描页面上的二维码，该二维码就失效了</p>
<p>app分享拉新规则</p>
<p><a href="https://mp.weixin.qq.com/s/3bsmiv78yJ4XKwd8iu-0Ig">https://mp.weixin.qq.com/s/3bsmiv78yJ4XKwd8iu-0Ig</a></p>
<h4 id="Wechat-Pay"><a href="#Wechat-Pay" class="headerlink" title="Wechat Pay"></a>Wechat Pay</h4><p><a href="https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5">https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=8_5</a></p>
<h4 id="Alipay"><a href="#Alipay" class="headerlink" title="Alipay"></a>Alipay</h4><p><a href="https://opendocs.alipay.com/open/204/105296">https://opendocs.alipay.com/open/204/105296</a></p>
<p>orderInfo订单信息 由接口拼接就可以了</p>
<p><a href="https://mp.weixin.qq.com/s/wWB5ENo3eQJH03OXvoup8w">https://mp.weixin.qq.com/s/wWB5ENo3eQJH03OXvoup8w</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUxODg0MzU2OQ==&amp;mid=2247485318&amp;idx=1&amp;sn=174338566ad8c0426c95815c4f4aee5a&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzUxODg0MzU2OQ==&amp;mid=2247485318&amp;idx=1&amp;sn=174338566ad8c0426c95815c4f4aee5a&amp;scene=21#wechat_redirect</a></p>
<p>推送相关</p>
<p><a href="https://juejin.im/post/6881414546859229192">https://juejin.im/post/6881414546859229192</a></p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>SERVICE</title>
    <url>/2017/08/11/SERVICE/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/guide/components/services">https://developer.android.com/guide/components/services</a></p>
<p><a href="https://developer.android.com/reference/android/app/Service">https://developer.android.com/reference/android/app/Service</a></p>
<h5 id="Service启动服务两种方式"><a href="#Service启动服务两种方式" class="headerlink" title="Service启动服务两种方式"></a>Service启动服务两种方式</h5><ul>
<li> startService </li>
<li> bindService</li>
</ul>
<h5 id="startService"><a href="#startService" class="headerlink" title="startService"></a>startService</h5><p>一个Service被startService多次启动,那么onCreate只会调用一次,onstart()会被调用多次, StartServcie:一旦启动，服务即可在后台无限期运行，即使启动服务的Ａctivity已被销毁也不受影响,直到调用stipService，或自身的stopSelf方法。内存不足系统也会结束服务。</p>
<p> <img src="https://developer.android.google.cn/images/service_lifecycle.png" alt="Servcie lifeccle"></p>
<h5 id="bindService"><a href="#bindService" class="headerlink" title="bindService"></a>bindService</h5><p>客户端通过IBinder接口于服务进行通信,客户端可以调用unbindServie关闭连接,当所有客户端关闭连接后系统会销毁服务.<br>启动Log日志<br>I/LearnService:  – onCreate() –<br>I/LearnService:  – onBind() –<br>　一个Service被某个Activity调用Context.bindService绑定启动，不管bindService调用几次，onCreate方法只会调用一次,onStart不会调用.</p>
<ol>
<li><p>service</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BluetoothService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        Timber.i(<span class="string">&quot; onCreate()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        Timber.i(<span class="string">&quot; onStartCommand()&quot;</span>);</span><br><span class="line">        String param = intent.getStringExtra(PARRAM);</span><br><span class="line">        Timber.i(<span class="string">&quot;接受    &quot;</span> + param);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Timber.i(<span class="string">&quot; onDestroy()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLowMemory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLowMemory();</span><br><span class="line">        Timber.i(<span class="string">&quot;onLowMemory()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onUnbind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        Timber.i(<span class="string">&quot;onUnbind(intent)()&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onUnbind(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRebind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRebind(intent);</span><br><span class="line">        Timber.i(<span class="string">&quot;onRebind(intent)()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> BluetoothService <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BluetoothService.<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IBinder mBinder = <span class="keyword">new</span> LocalBinder();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        Timber.i(<span class="string">&quot;onBind(intent)()&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mBinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>启动</p>
</li>
<li><p><code>bindService(intent,mServiceConnection,BIND_AUTO_CREATE);</code></p>
</li>
<li><p>回调</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ServiceConnection mServiceConnection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">           mBlueService =  ((BluetoothService.LocalBinder)service).getService();</span><br><span class="line">           Timber.i(<span class="string">&quot;onServiceConnected(ComponentName name, IBinder service)&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line">          Timber.i(<span class="string">&quot;onServiceDisconnected(ComponentName name)&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>





<ul>
<li> 先startService创建服务，然后bindService绑定，这时候调用stopService或stopSelf(),不会停止，只能使unbindService()停止服务</li>
</ul>
<h6 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h6><p>   通过HandlerThread单独开启一个线程一次处理所有的任务<br>   不需要调用stopSelft()关闭服务，任务结束后自动关闭</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onCreate() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onStartCommand() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onStartCommand() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onStartCommand() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30655</span>/com.hyhy.lern I/MyIntentService: do task<span class="number">1</span></span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30655</span>/com.hyhy.lern I/MyIntentService: do task<span class="number">2</span></span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30655</span>/com.hyhy.lern I/MyIntentService: do task<span class="number">1</span></span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">617</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onDestroy() --</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.android.com/training/run-background-service/create-service.html">https://developer.android.com/training/run-background-service/create-service.html</a></p>
<h5 id="onStartCommand"><a href="#onStartCommand" class="headerlink" title="onStartCommand()"></a>onStartCommand()</h5><p><strong>1. onStartCommand方式中，返回START_STICKY</strong></p>
<p>首先我们来看看onStartCommand都可以返回哪些值：</p>
<p>调用Context.startService方式启动Service时，如果Android面临内存匮乏，可能会销毁当前运行的Service，待内存充足时可以重建Service。而Service被Android系统强制销毁并再次重建的行为依赖于Service的onStartCommand()方法的返回值。</p>
<p><strong>START_NOT_STICKY</strong><br> 如果返回START_NOT_STICKY，表示当Service运行的进程被Android系统强制杀掉之后，不会重新创建该Service。当然如果在其被杀掉之后一段时间又调用了startService，那么该Service又将被实例化。那什么情境下返回该值比较恰当呢？<br> 如果我们某个Service执行的工作被中断几次无关紧要或者对Android内存紧张的情况下需要被杀掉且不会立即重新创建这种行为也可接受，那么我们便可将 onStartCommand的返回值设置为START_NOT_STICKY。<br> 举个例子，某个Service需要定时从服务器获取最新数据：通过一个定时器每隔指定的N分钟让定时器启动Service去获取服务端的最新数据。当执行到Service的onStartCommand时，在该方法内再规划一个N分钟后的定时器用于再次启动该Service并开辟一个新的线程去执行网络操作。假设Service在从服务器获取最新数据的过程中被Android系统强制杀掉，Service不会再重新创建，这也没关系，因为再过N分钟定时器就会再次启动该Service并重新获取数据</p>
<p><strong>START_STICKY</strong><br> 如果返回START_STICKY，表示Service运行的进程被Android系统强制杀掉之后，Android系统会将该Service依然设置为started状态（即运行状态），但是不再保存onStartCommand方法传入的intent对象，然后Android系统会尝试再次重新创建该Service，并执行onStartCommand回调方法，但是onStartCommand回调方法的Intent参数为null，也就是onStartCommand方法虽然会执行但是获取不到intent信息。如果你的Service可以在任意时刻运行或结束都没什么问题，而且不需要intent信息，那么就可以在onStartCommand方法中返回START_STICKY，比如一个用来播放背景音乐功能的Service就适合返回该值。</p>
<p><strong>START_REDELIVER_INTENT</strong><br> 如果返回START_REDELIVER_INTENT，表示Service运行的进程被Android系统强制杀掉之后，与返回START_STICKY的情况类似，Android系统会将再次重新创建该Service，并执行onStartCommand回调方法，但是不同的是，Android系统会再次将Service在被杀掉之前最后一次传入onStartCommand方法中的Intent再次保留下来并再次传入到重新创建后的Service的onStartCommand方法中，这样我们就能读取到intent参数。只要返回START_REDELIVER_INTENT，那么onStartCommand重的intent一定不是null。如果我们的Service需要依赖具体的Intent才能运行（需要从Intent中读取相关数据信息等），并且在强制销毁后有必要重新创建运行，那么这样的Service就适合返回START_REDELIVER_INTENT。</p>
<p><a href="https://juejin.im/post/5b1747e5e51d45069a39ef45">https://juejin.im/post/5b1747e5e51d45069a39ef45</a></p>
<p> <a href="https://developer.android.com/guide/components/bound-services#kotlin">https://developer.android.com/guide/components/bound-services#kotlin</a> </p>
<ul>
<li><p>bindService callback</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">class BindingActivity : Activity() &#123;</span><br><span class="line">    <span class="keyword">private</span> lateinit <span class="keyword">var</span> mService: LocalService</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mBound: Boolean = <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Defines callbacks for service binding, passed to bindService()  */</span></span><br><span class="line">    <span class="keyword">private</span> val connection = object : ServiceConnection &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">override fun <span class="title">onServiceConnected</span><span class="params">(className: ComponentName, service: IBinder)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// We&#x27;ve bound to LocalService, cast the IBinder and get LocalService instance</span></span><br><span class="line">            val binder = service as LocalService.LocalBinder</span><br><span class="line">            mService = binder.getService()</span><br><span class="line">            mBound = <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">override fun <span class="title">onServiceDisconnected</span><span class="params">(arg0: ComponentName)</span> </span>&#123;</span><br><span class="line">            mBound = <span class="keyword">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onCreate</span><span class="params">(savedInstanceState: Bundle?)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.main)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart()</span><br><span class="line">        <span class="comment">// Bind to LocalService</span></span><br><span class="line">        Intent(<span class="keyword">this</span>, LocalService::class.java).also &#123; intent -&gt;</span><br><span class="line">            bindService(intent, connection, Context.BIND_AUTO_CREATE)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop()</span><br><span class="line">        unbindService(connection)</span><br><span class="line">        mBound = <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Called when a button is clicked (the button in the layout file attaches to</span></span><br><span class="line"><span class="comment">     * this method with the android:onClick attribute)  */</span></span><br><span class="line">    <span class="function">fun <span class="title">onButtonClick</span><span class="params">(v: View)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBound) &#123;</span><br><span class="line">            <span class="comment">// Call a method from the LocalService.</span></span><br><span class="line">            <span class="comment">// However, if this call were something that might hang, then this request should</span></span><br><span class="line">            <span class="comment">// occur in a separate thread to avoid slowing down the activity performance.</span></span><br><span class="line">            val num: Int = mService.randomNumber</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;number: $num&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>get Service object in this place </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">val binder = service as LocalService.LocalBinder</span><br><span class="line">mService = binder.getService()</span><br></pre></td></tr></table></figure>

<h5 id="Using-a-Messenger"><a href="#Using-a-Messenger" class="headerlink" title="Using a Messenger"></a>Using a Messenger</h5><p> If you need your service to communicate with remote processes, then you can use a <code>Messenger</code> to provide the interface for your service. </p>
</li>
</ul>
<h5 id="stopself"><a href="#stopself" class="headerlink" title="stopself()"></a>stopself()</h5><p>​    目前测试只有在onStartCommand()有效，多次点击startService(intent),startId持续递增.</p>
<h5 id="foreground-service（前台服务）"><a href="#foreground-service（前台服务）" class="headerlink" title="foreground service（前台服务）"></a>foreground service（前台服务）</h5><p> 被用户所知道，系统内存不足时候不允许被系统杀死的服务，前台服务必须给通知了一个通知，放在正在运行的标题之下，一般用于应用保活。</p>
<p><a href="https://www.jianshu.com/p/5505390503fa">https://www.jianshu.com/p/5505390503fa</a></p>
<h5 id="onRebind-什么情况下执行"><a href="#onRebind-什么情况下执行" class="headerlink" title="onRebind()什么情况下执行"></a>onRebind()什么情况下执行</h5><p><img src="/2017/08/11/SERVICE/service_binding_tree_lifecycle.png"></p>
<p>验证方法: startService(intent) 启动Service - bindService() 绑定Service - unBindService()解绑-  bindService() 继续绑定 就会执行onRebind()</p>
<h5 id="多个acitivty与service通信"><a href="#多个acitivty与service通信" class="headerlink" title="多个acitivty与service通信"></a>多个acitivty与service通信</h5><p><a href="https://www.jianshu.com/p/9885acf65405">https://www.jianshu.com/p/9885acf65405</a></p>
<p><a href="https://blog.csdn.net/pihailailou/article/details/78588496">https://blog.csdn.net/pihailailou/article/details/78588496</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>SharedPreferences</title>
    <url>/2019/11/06/SharedPreferences/</url>
    <content><![CDATA[<p>The different  commit and apply</p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>String</title>
    <url>/2017/07/21/String/</url>
    <content><![CDATA[<p> 　字符串连接有两种方式，一种时  “ +  “,另一种是 StringBuilder方式</p>
<p>命令行运行java</p>
<p>平常用开发工具习惯了，都忘了怎么用命令行运行，特此记录下</p>
<p>新建 Concatenation.java文件，cmd到该目录下，写入代码</p>
<pre><code> public class Concatenation&#123;
    public static void main(String[] args)&#123;
     String mango = &quot;mango&quot;;
     String s = &quot;abc&quot; + mango + &quot;def&quot; + 47;
     System.out.print(s);    
    &#125;
 &#125;
</code></pre>
<p>生成 Concatenation.calss 文件</p>
<pre><code>  D:\DemoExo&gt;javac Concatenation.java
</code></pre>
<p>运行Concatenation.class文件,后面是运行结果</p>
<pre><code>   D:\DemoExo&gt;java Concatenation
   abcmangodef47
</code></pre>
<h4 id="String字符串连接方式"><a href="#String字符串连接方式" class="headerlink" title="String字符串连接方式"></a>String字符串连接方式</h4><p>回到主题</p>
<p>  查看JDK文档（不知道在哪），String 类中每一个看起来会修改String值的方法，实际上都是创建了一个全新的String对象,以包含修改后的字符串内容.</p>
<pre><code>public class Immutable&#123;
     public static String upcase(String s)&#123;
       return s.toUpperCase();
     &#125;
     public static void println(String q)&#123;
       System.out.println(q);
     &#125;
 
    public static void main(String[] args)&#123;
        String q = &quot;howdy&quot;;
        print(q);            // howdy
       String qq= upcase(q);
       print(qq);            //HOWDY
       print(q);             //howdy
    &#125;
&#125;
</code></pre>
<p>运行结果：<br>howdy<br>HOWDY<br>howdy<br>当把q传给upcase()时，实际传递的是引用的拷贝</p>
<h4 id="编译器运行过程"><a href="#编译器运行过程" class="headerlink" title="编译器运行过程"></a>编译器运行过程</h4><p>反编译Concatenation,生成JVM字节码</p>
<pre><code>   javap -c Concatenation.class
</code></pre>
<p>字节码是这样的</p>
<pre><code>C:\DemoExo&gt;javap -c Concatenation.class
 Compiled from &quot;Concatenation.java&quot;
public class Concatenation &#123;
  public Concatenation();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
       4: return

  public static void main(java.lang.String[]);
    Code:
       0: ldc           #2                  // String mango
       2: astore_1
       3: new           #3                  // class java/lang/StringBuilder
       6: dup
       7: invokespecial #4                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V
      10: ldc           #5                  // String abc
      12: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      15: aload_1
      16: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      19: ldc           #7                  // String def
      21: invokevirtual #6                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      24: bipush        47
      26: invokevirtual #8                  // Method java/lang/StringBuilder.append:(I)Ljava/lang/StringBuilder;
      29: invokevirtual #9                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      32: astore_2
      33: getstatic     #10                 // Field java/lang/System.out:Ljava/io/PrintStream;
      36: aload_2
      37: invokevirtual #11                 // Method java/io/PrintStream.print:(Ljava/lang/String;)V
      40: return
&#125;
</code></pre>
<p>可以看到，编译器创建了一个StringBuilder对象,用以构造最终的String，并四次调用了append(),最后使用命令astore_2生成 s对象。<br>这样来看，使用 “+” 连接符，是不会影响性能的咯，接着往下</p>
<h3 id="“-”连接符-和-StringBuilder对比"><a href="#“-”连接符-和-StringBuilder对比" class="headerlink" title="“+”连接符 和 StringBuilder对比"></a>“+”连接符 和 StringBuilder对比</h3><p>运行javap -c WhitherStringBuilder.class 看到两个方法对象的字节码，先看前半部分implicit()</p>
<pre><code>public class WhitherStringBuilder &#123;
  public WhitherStringBuilder();
    Code:
       0: aload_0
       1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V
       4: return

  public java.lang.String implicit(java.lang.String[]);
    Code:
       0: ldc           #2                  // String
       2: astore_2
       3: iconst_0
       4: istore_3
       5: iload_3
       6: aload_1
       7: arraylength
       8: if_icmpge     38
      11: new           #3                  // class java/lang/StringBuilder
      14: dup
      15: invokespecial #4                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V
      18: aload_2
      19: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      22: aload_1
      23: iload_3
      24: aaload
      25: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
      28: invokevirtual #6                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
      31: astore_2
      32: iinc          3, 1
      35: goto          5
      38: aload_2
      39: areturn
</code></pre>
<p>第8到35行，在for循环体内，每一次循环就创建了一个StringBuilder对象，接着看看explicit()</p>
<pre><code> public java.lang.String explicit(java.lang.String[]);
   Code:
      0: new           #3                  // class java/lang/StringBuilder
      3: dup
      4: invokespecial #4                  // Method java/lang/StringBuilder.&quot;&lt;init&gt;&quot;:()V
      7: astore_2
      8: iconst_0
      9: istore_3
     10: iload_3
     11: aload_1
     12: arraylength
     13: if_icmpge     30
     16: aload_2
     17: aload_1
     18: iload_3
     19: aaload
     20: invokevirtual #5                  // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder;
     23: pop
     24: iinc          3, 1
     27: goto          10
     30: aload_2
     31: invokevirtual #6                  // Method java/lang/StringBuilder.toString:()Ljava/lang/String;
</code></pre>
<p>第13到27行在for循环体内，StringBuilder只会生成一个对象</p>
<p>总结： 由此来看，如果字符串操作比较简单，就可以用“+”连接让编译器处理字符串<br>如果在循环中，那么自己创建一个StringBuilder对象</p>
<p>参考：<em>摘自ThinkInJava4   P286</em></p>
<h4 id="避免创建不必要的对象"><a href="#避免创建不必要的对象" class="headerlink" title="避免创建不必要的对象"></a>避免创建不必要的对象</h4><p>创建　String对象</p>
<p> 最好能重用对象而不是每次需要的时候就创建一个功能相同的新对象，重用方式即快速<br>又流行。如果对象是不可变的，它始终可以被重用。</p>
<p>极端的反面例子　｀Ｓtring s = new String(“stringette”);  //DON’T DO THIS ! ｀<br>该语句每次被执行的时候都创建一个新的String实例，传递给String构造器的参数”stringette’本身就是一个String实例，如果这种用法在一个循环中，或者在一个频繁<br>调用的方法中，就会创建出成千上万不必要的String  实例。</p>
<p>改进后的版本如下所示</p>
<figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">String s  = <span class="string">&quot;stringette&#x27;;</span></span><br></pre></td></tr></table></figure>
<p>这个版本只用了一个String实例，而且它可以保证，对于所有的同一台虚拟机中运行的代码<br>，只要包含相同的字符串字面常量，该对象就会被重用.</p>
<h2 id="返回数据处理"><a href="#返回数据处理" class="headerlink" title="返回数据处理"></a>返回数据处理</h2><p>对于同时提供静态工厂方法和构造器的不可变类，通常可以使用静态工厂方法，而不是构造器<br>以避免创建不必要的对象，例如，静态工厂方法Boolean.valueof(String)由于构造器Boolean(String),构造器每次调用的时候都会创建一个新的对象，而静态工厂方法则不会</p>
<p>我们平常解析回来后非String类型的数据，需要转换成String对象　<br>看到这里后就需要使用<code>String.valueof(String)</code> </p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Returns the string representation of the &#123;<span class="doctag">@code </span>Object&#125; argument.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param   </span>obj   an &#123;<span class="doctag">@code </span>Object&#125;.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@return  </span>if the argument is &#123;<span class="doctag">@code </span>null&#125;, then a string equal to</span></span><br><span class="line"><span class="comment">   *          &#123;<span class="doctag">@code </span>&quot;null&quot;&#125;; otherwise, the value of</span></span><br><span class="line"><span class="comment">   *          &#123;<span class="doctag">@code </span>obj.toString()&#125; is returned.</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@see     </span>java.lang.Object#toString()</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">String</span> <span class="function"><span class="title">valueOf</span>(<span class="params"><span class="built_in">Object</span> obj</span>)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> (obj == <span class="literal">null</span>) ? <span class="string">&quot;null&quot;</span> : obj.toString();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>从源码中看到对形参　做了　null判断，所以用这种方式页不用担心闪退的情况了<br>参考 Effective Java　page17</p>
<ul>
<li><p>java 8 获取对象数据</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">private WchatMobile decodeMobile(<span class="built_in">String</span> encryptedData, <span class="built_in">String</span> iv, <span class="built_in">String</span> unionid) &#123;</span><br><span class="line">  WchatMiniAppSession miniAppSession = getWchatMiniAppSession(unionid);</span><br><span class="line">  <span class="built_in">String</span> sessionKey = Optional.ofNullable(miniAppSession)</span><br><span class="line">    .orElseThrow<span class="function"><span class="params">(() -&gt; <span class="keyword">new</span> ServiceExecutionException(<span class="string">&quot;用户小程序登录信息为空&quot;</span>))</span></span></span><br><span class="line"><span class="function">    .<span class="title">getSessionKey</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">  <span class="title">return</span> <span class="title">Optional</span>.<span class="title">ofNullable</span><span class="params">(wchatMiniAppService)</span></span></span><br><span class="line"><span class="function">   .<span class="title">map</span><span class="params">(<span class="keyword">as</span> -&gt; <span class="keyword">as</span>.getWxMaService())</span></span></span><br><span class="line"><span class="function">   .<span class="title">map</span><span class="params">(s -&gt; s.getUserService())</span></span></span><br><span class="line"><span class="function">   .<span class="title">map</span><span class="params">(se -&gt; se.getPhoneNoInfo(sessionKey, encryptedData, iv))</span></span></span><br><span class="line"><span class="function">   .<span class="title">map</span><span class="params">(num -&gt; WchatMobile.<span class="keyword">from</span>(num))</span></span></span><br><span class="line"><span class="function">   .<span class="title">orElse</span><span class="params">(<span class="literal">null</span>)</span>;</span></span><br><span class="line"><span class="function"> &#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><a href="https://time.geekbang.org/column/article/209343">https://time.geekbang.org/column/article/209343</a></p>
<h4 id="亨元模式"><a href="#亨元模式" class="headerlink" title="亨元模式"></a>亨元模式</h4><pre><code>Integer a = 1;
Integer b = 2;
Integer c = 3;
Integer d = 3;
Integer e = 321;
Integer f = 321;
Long g = 3L;
System.out.println(c==d);
System.out.println(e==f);
System.out.println(c==(a+b));
System.out.println(c.equals(a+b));
System.out.println(g ==(a+b));
System.out.println(g.equals(a+b));
</code></pre>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>SurfaceView</title>
    <url>/2019/11/05/SurfaceView/</url>
    <content><![CDATA[<blockquote>
<p> 我们知道View是通过刷新来重绘视图，系统通过发出<code>VSSYNC</code>信号来进行屏幕的重绘，刷新的时间间隔是<code>16ms</code>,如果我们可以在16ms以内将绘制工作完成，则没有任何问题，如果我们绘制过程逻辑很复杂，并且我们的界面更新还非常频繁，这时候就会造成界面的卡顿，影响用户体验，为此Android提供了<code>SurfaceView</code>来解决这一问题。</p>
</blockquote>
<p>如果View需要频繁的刷新，或者刷新的数据量比较大，就需要使用SurfaceView</p>
<h4 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h4><ol>
<li><p>View中刷新频繁，Ondraw()会频繁调用,onDraw方法执行的时间过程会掉帧，出现页面卡顿。SurfaceView使用<strong>双缓冲技术</strong>，提高了绘制速度，可以缓解这一现象。</p>
</li>
<li><p>SurfaceView可以在子线程更新UI,不会阻塞主线程，提高了响应速度.</p>
<p><a href="https://www.jianshu.com/p/b037249e6d31">https://www.jianshu.com/p/b037249e6d31</a></p>
</li>
</ol>
<h4 id="啥是双缓冲技术"><a href="#啥是双缓冲技术" class="headerlink" title="啥是双缓冲技术?"></a>啥是双缓冲技术?</h4><p><a href="https://blog.csdn.net/guanguanboy/article/details/99715643">https://blog.csdn.net/guanguanboy/article/details/99715643</a></p>
<p>Android群英传 6.8</p>
<h4 id="SurfaceView使用模板"><a href="#SurfaceView使用模板" class="headerlink" title="SurfaceView使用模板"></a>SurfaceView使用模板</h4><p>大部分绘图都按照模板来</p>
<p>SurfaceViewTemplate</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SurfaceViewTemplate</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">SurfaceHolder</span>.<span class="title">Callback</span>, <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SurfaceHolder mSurfaceHolder;</span><br><span class="line">    <span class="comment">//绘图的Canvas</span></span><br><span class="line">    <span class="keyword">private</span> Canvas mCanvas;</span><br><span class="line">    <span class="comment">//子线程标志位</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsDrawing;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceViewTemplate</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceViewTemplate</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceViewTemplate</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">        mIsDrawing = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">//开启子线程</span></span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">this</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">        mIsDrawing = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (mIsDrawing)&#123;</span><br><span class="line">            draw();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//绘图逻辑</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获得当前Canva绘图对象，获取的还是继续上次的Canvas对象，而不是一个新的对象,因此之前的绘图都将被保留，如果需要擦除，则绘制前，通过drawColor()方法进行清屏操作.</span></span><br><span class="line">            mCanvas = mSurfaceHolder.lockCanvas();</span><br><span class="line">            <span class="comment">//绘制背景</span></span><br><span class="line">            mCanvas.drawColor(Color.WHITE);</span><br><span class="line">            <span class="comment">//绘图</span></span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCanvas != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//释放canvas对象并提交画布</span></span><br><span class="line">                mSurfaceHolder.unlockCanvasAndPost(mCanvas);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化View</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mSurfaceHolder = getHolder();</span><br><span class="line">        mSurfaceHolder.addCallback(<span class="keyword">this</span>);</span><br><span class="line">        setFocusable(<span class="keyword">true</span>);</span><br><span class="line">        setKeepScreenOn(<span class="keyword">true</span>);</span><br><span class="line">        setFocusableInTouchMode(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正旋曲线</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  https://www.jianshu.com/p/b037249e6d31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SurfaceViewSinFun</span> <span class="keyword">extends</span> <span class="title">SurfaceView</span> <span class="keyword">implements</span> <span class="title">SurfaceHolder</span>.<span class="title">Callback</span>, <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> SurfaceHolder mSurfaceHolder;</span><br><span class="line">    <span class="comment">//绘图的Canvas</span></span><br><span class="line">    <span class="keyword">private</span> Canvas mCanvas;</span><br><span class="line">    <span class="comment">//子线程标志位</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mIsDrawing;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;</span><br><span class="line">    <span class="keyword">private</span> Path mPath;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceViewSinFun</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceViewSinFun</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(context, attrs, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SurfaceViewSinFun</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyleAttr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs, defStyleAttr);</span><br><span class="line">        mPaint = <span class="keyword">new</span> Paint();</span><br><span class="line">        mPaint.setColor(Color.BLACK);</span><br><span class="line">        mPaint.setStyle(Paint.Style.STROKE);</span><br><span class="line">        mPaint.setAntiAlias(<span class="keyword">true</span>);</span><br><span class="line">        mPaint.setStrokeWidth(<span class="number">5</span>);</span><br><span class="line">        mPath = <span class="keyword">new</span> Path();</span><br><span class="line">        <span class="comment">//路径起始点(0, 100)</span></span><br><span class="line">        mPath.moveTo(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">        initView();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceCreated</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">        mIsDrawing = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">this</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceChanged</span><span class="params">(SurfaceHolder holder, <span class="keyword">int</span> format, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">surfaceDestroyed</span><span class="params">(SurfaceHolder holder)</span> </span>&#123;</span><br><span class="line">        mIsDrawing = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">while</span> (mIsDrawing)&#123;</span><br><span class="line">            drawSomething();</span><br><span class="line">            x += <span class="number">1</span>;</span><br><span class="line">            y = (<span class="keyword">int</span>)(<span class="number">100</span> * Math.sin(<span class="number">2</span> * x * Math.PI / <span class="number">180</span>) + <span class="number">400</span>);</span><br><span class="line">            <span class="comment">//加入新的坐标点</span></span><br><span class="line">            mPath.lineTo(x, y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//控制绘制频率</span></span><br><span class="line">        <span class="keyword">long</span> end  = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//50 - 100</span></span><br><span class="line">        <span class="keyword">if</span> (end - start&lt;<span class="number">100</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>-(end-start));  <span class="comment">//相当于绘制一次总的时间 100ms</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获得canvas对象</span></span><br><span class="line">            mCanvas = mSurfaceHolder.lockCanvas();</span><br><span class="line">            <span class="comment">//绘制背景</span></span><br><span class="line">            mCanvas.drawColor(Color.WHITE);</span><br><span class="line">            <span class="comment">//绘制路径</span></span><br><span class="line">            mCanvas.drawPath(mPath, mPaint);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line"></span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCanvas != <span class="keyword">null</span>)&#123;</span><br><span class="line">                <span class="comment">//释放canvas对象并提交画布</span></span><br><span class="line">                mSurfaceHolder.unlockCanvasAndPost(mCanvas);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化View</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mSurfaceHolder = getHolder();</span><br><span class="line">        mSurfaceHolder.addCallback(<span class="keyword">this</span>);</span><br><span class="line">        setFocusable(<span class="keyword">true</span>);</span><br><span class="line">        setKeepScreenOn(<span class="keyword">true</span>);</span><br><span class="line">        setFocusableInTouchMode(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过draw()方法所使用的逻辑时长来确定sleep的时长，这是一个非常通用的解决方案，每次绘制时间控制在100ms</p>
<p>画板</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 画板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">class DrawingBoardView : SurfaceView, SurfaceHolder.Callback, Runnable &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mCanvas: Canvas? = <span class="keyword">null</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mSurfaceHolder: SurfaceHolder? = holder</span><br><span class="line"></span><br><span class="line">    <span class="comment">//子线程标志位</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mIsDrawing = <span class="keyword">false</span></span><br><span class="line">    <span class="keyword">private</span> val x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> y: Int = <span class="number">0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mPaint: Paint? = Paint().apply &#123;</span><br><span class="line">        color = Color.BLACK</span><br><span class="line">        style = Paint.Style.STROKE</span><br><span class="line">        isAntiAlias = <span class="keyword">true</span></span><br><span class="line">        strokeWidth = <span class="number">5f</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mPath: Path? = <span class="keyword">null</span></span><br><span class="line"></span><br><span class="line">    constructor(context: Context) : <span class="keyword">this</span>(context, <span class="keyword">null</span>)</span><br><span class="line">    constructor(context: Context, attrs: AttributeSet?) : <span class="keyword">this</span>(context, attrs, <span class="number">0</span>)</span><br><span class="line">    constructor(context: Context, attrs: AttributeSet?, defStyleAttr: Int) : <span class="keyword">super</span>(context, attrs, defStyleAttr) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    init &#123;</span><br><span class="line">        mSurfaceHolder?.addCallback(<span class="keyword">this</span>)</span><br><span class="line">        isFocusable = <span class="keyword">true</span></span><br><span class="line">        keepScreenOn = <span class="keyword">true</span></span><br><span class="line">        isFocusableInTouchMode = <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">        mPath = Path()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">surfaceChanged</span><span class="params">(holder: SurfaceHolder?, format: Int, width: Int, height: Int)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">surfaceDestroyed</span><span class="params">(holder: SurfaceHolder?)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">surfaceCreated</span><span class="params">(holder: SurfaceHolder?)</span> </span>&#123;</span><br><span class="line">        mIsDrawing = <span class="keyword">true</span></span><br><span class="line">        <span class="comment">//开启子线程</span></span><br><span class="line">        Thread(<span class="keyword">this</span>).start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (mIsDrawing) &#123;</span><br><span class="line">            draw()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> fun <span class="title">draw</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            mCanvas = mSurfaceHolder?.lockCanvas()</span><br><span class="line">            <span class="comment">//SurfaceView背景</span></span><br><span class="line">            mCanvas?.drawColor(Color.WHITE)</span><br><span class="line">            mPaint?.let &#123; mPath?.let &#123; it1 -&gt; mCanvas?.drawPath(it1, it) &#125; &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            mCanvas?.let &#123;</span><br><span class="line">                mSurfaceHolder?.unlockCanvasAndPost(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onTouchEvent</span><span class="params">(event: MotionEvent?)</span>: Boolean </span>&#123;</span><br><span class="line">        val x = event?.x</span><br><span class="line">        val y = event?.y</span><br><span class="line">        when (event?.action) &#123;</span><br><span class="line">            MotionEvent.ACTION_DOWN -&gt; x?.let &#123;</span><br><span class="line">                <span class="keyword">if</span> (y != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mPath?.moveTo(it, y)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            MotionEvent.ACTION_MOVE -&gt; x?.let &#123;</span><br><span class="line">                <span class="keyword">if</span> (y != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    mPath?.lineTo(it, y)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
  </entry>
  <entry>
    <title>TAB_VIEWPAGER</title>
    <url>/2017/12/26/TAB_VIEWPAGER/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/reference/com/google/android/material/tabs/TabLayout">https://developer.android.com/reference/com/google/android/material/tabs/TabLayout</a></p>
<h4 id="ViewPager"><a href="#ViewPager" class="headerlink" title="ViewPager"></a>ViewPager</h4><h5 id="TabLayout方式"><a href="#TabLayout方式" class="headerlink" title="TabLayout方式"></a>TabLayout方式</h5><ul>
<li>动态</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">TabLayout tabLayout = ...;</span><br><span class="line"> tabLayout.add<span class="constructor">Tab(<span class="params">tabLayout</span>.<span class="params">newTab</span>()</span>.set<span class="constructor">Text(<span class="string">&quot;Tab 1&quot;</span>)</span>);</span><br><span class="line"> tabLayout.add<span class="constructor">Tab(<span class="params">tabLayout</span>.<span class="params">newTab</span>()</span>.set<span class="constructor">Text(<span class="string">&quot;Tab 2&quot;</span>)</span>);</span><br><span class="line"> tabLayout.add<span class="constructor">Tab(<span class="params">tabLayout</span>.<span class="params">newTab</span>()</span>.set<span class="constructor">Text(<span class="string">&quot;Tab 3&quot;</span>)</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>静态</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">&lt;com<span class="selector-class">.google</span><span class="selector-class">.android</span><span class="selector-class">.material</span><span class="selector-class">.tabs</span>.TabLayout</span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line">  </span><br><span class="line">    &lt;com<span class="selector-class">.google</span><span class="selector-class">.android</span><span class="selector-class">.material</span><span class="selector-class">.tabs</span>.TabItem</span><br><span class="line">            android:text=<span class="string">&quot;@string/tab_text&quot;</span>/&gt;</span><br><span class="line">  </span><br><span class="line">    &lt;com<span class="selector-class">.google</span><span class="selector-class">.android</span><span class="selector-class">.material</span><span class="selector-class">.tabs</span>.TabItem</span><br><span class="line">            android:<span class="attribute">icon</span>=<span class="string">&quot;@drawable/ic_android&quot;</span>/&gt;</span><br><span class="line">  </span><br><span class="line">&lt;/com<span class="selector-class">.google</span><span class="selector-class">.android</span><span class="selector-class">.material</span><span class="selector-class">.tabs</span>.TabLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="滑动TAB"><a href="#滑动TAB" class="headerlink" title="滑动TAB"></a>滑动TAB</h5><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">&lt;androidx<span class="selector-class">.viewpager</span><span class="selector-class">.widget</span>.ViewPager</span><br><span class="line">     android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">     android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">     &lt;com<span class="selector-class">.google</span><span class="selector-class">.android</span><span class="selector-class">.material</span><span class="selector-class">.tabs</span>.TabLayout</span><br><span class="line">         android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">         android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">         android:layout_gravity=<span class="string">&quot;top&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"> &lt;/androidx<span class="selector-class">.viewpager</span><span class="selector-class">.widget</span>.ViewPager&gt;</span><br></pre></td></tr></table></figure>

<p>设置Tab</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">TabLayout tabVp = rootView.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tab_vp</span>)</span>;</span><br><span class="line">viewPager = rootView.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">view_pager</span>)</span>;</span><br><span class="line">  framgents = <span class="keyword">new</span> LinkedHashMap&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">framgents.put(<span class="string">&quot;项目详情&quot;</span>, introFragment);</span><br><span class="line">framgents.put(<span class="string">&quot;相关图片&quot;</span>, imageFragment);</span><br><span class="line">framgents.put(<span class="string">&quot;投资记录&quot;</span>, rankFragment);</span><br><span class="line"></span><br><span class="line">titles = <span class="keyword">new</span> LinkedList&lt;&gt;<span class="literal">()</span>;</span><br><span class="line">titles.add<span class="constructor">All(<span class="params">framgents</span>.<span class="params">keySet</span>()</span>);</span><br><span class="line"></span><br><span class="line">viewPager.set<span class="constructor">Adapter(<span class="params">new</span> MyPagerAdapter(<span class="params">getFragmentManager</span>()</span>));</span><br><span class="line">tabVp.setup<span class="constructor">WithViewPager(<span class="params">viewPager</span>)</span>;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>默认设置</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">mTabLayout</span><span class="selector-class">.getTabAt</span>(roomType)<span class="selector-class">.select</span>();</span><br><span class="line"><span class="selector-tag">viewpager</span><span class="selector-class">.setCurrentItem</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><a href="https://segmentfault.com/a/1190000008753052">https://segmentfault.com/a/1190000008753052</a></p>
</li>
</ul>
<h5 id="自定义TabItem"><a href="#自定义TabItem" class="headerlink" title="自定义TabItem"></a>自定义TabItem</h5><ul>
<li><p>tab_item.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/tv_item_title&quot;</span><br><span class="line">        android:layout_width=&quot;40dp&quot;</span><br><span class="line">        android:layout_height=&quot;40dp&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_horizontal&quot;</span><br><span class="line">        android:background=&quot;@drawable/bg_tab_item_select&quot;</span><br><span class="line">        android:gravity=&quot;center&quot;</span><br><span class="line">        android:textColor=&quot;@drawable/bg_tab_item_select_txt&quot;</span><br><span class="line">        android:textSize=&quot;@dimen/text_size_14&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;View</span><br><span class="line">        android:id=&quot;@+id/view_line&quot;</span><br><span class="line">        android:layout_width=&quot;0dp&quot;</span><br><span class="line">        android:layout_height=&quot;1dp&quot;</span><br><span class="line">        android:layout_gravity=&quot;center_vertical&quot;</span><br><span class="line">        android:layout_marginLeft=&quot;@dimen/dimen_10&quot;</span><br><span class="line">        android:layout_weight=&quot;1&quot;</span><br><span class="line">        android:background=&quot;@android:color/darker_gray&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">tabLayout = find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tb_layout</span>)</span>;</span><br><span class="line">     <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; tabTitles.length; i++) &#123;</span><br><span class="line">         tabLayout.add<span class="constructor">Tab(<span class="params">tabLayout</span>.<span class="params">newTab</span>()</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; tabTitles.length; i++) &#123;</span><br><span class="line">         TabLayout.Tab tab = tabLayout.get<span class="constructor">TabAt(<span class="params">i</span>)</span>;</span><br><span class="line">         tab.set<span class="constructor">CustomView(R.<span class="params">layout</span>.<span class="params">tab_item</span>)</span>;</span><br><span class="line">         TextView tvItemTitle = tab.get<span class="constructor">CustomView()</span>.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tv_item_title</span>)</span>;</span><br><span class="line">         tvItemTitle.set<span class="constructor">Text(<span class="params">tabTitles</span>[<span class="params">i</span>])</span>;</span><br><span class="line">         <span class="keyword">if</span> (i<span class="operator"> == </span>tabTitles.length - <span class="number">1</span>) &#123;</span><br><span class="line">             tab.get<span class="constructor">CustomView()</span>.find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">view_line</span>)</span>.set<span class="constructor">Visibility(View.GONE)</span>;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.jianshu.com/p/ed129686f2cc">https://www.jianshu.com/p/ed129686f2cc</a></p>
<p><a href="https://blog.csdn.net/android_zhengyongbo/article/details/74726176">https://blog.csdn.net/android_zhengyongbo/article/details/74726176</a></p>
<h5 id="修改指示器颜色"><a href="#修改指示器颜色" class="headerlink" title="修改指示器颜色"></a>修改指示器颜色</h5><p><a href="https://codeday.me/bug/20170629/35704.html">https://codeday.me/bug/20170629/35704.html</a></p>
<h5 id="设置Tab选择背景"><a href="#设置Tab选择背景" class="headerlink" title="设置Tab选择背景"></a>设置Tab选择背景</h5><p><a href="https://blog.csdn.net/jdsjlzx/article/details/52171075">https://blog.csdn.net/jdsjlzx/article/details/52171075</a></p>
<p> <img src="/2017/12/26/TAB_VIEWPAGER/TAB_VIEWPAGER%5CtabLayout_20190603110418.png" alt="tabLayout_20190603110418"></p>
<p>首先设置 </p>
<ul>
<li><p>tabGravity fill模式 center是居中</p>
</li>
<li><p>通过layer-list设置间距</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">shape</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@android:color/transparent&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:left</span>=<span class="string">&quot;@dimen/dimen_10&quot;</span> <span class="attr">android:right</span>=<span class="string">&quot;@dimen/dimen_10&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;3dp&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;#ffa2cb79&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">shape</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@android:color/transparent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">solid</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:left</span>=<span class="string">&quot;@dimen/dimen_10&quot;</span> <span class="attr">android:right</span>=<span class="string">&quot;@dimen/dimen_10&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">shape</span> <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;3dp&quot;</span> /&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;#ffdddddd&quot;</span> /&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="ViewPager2"><a href="#ViewPager2" class="headerlink" title="ViewPager2"></a>ViewPager2</h4><h5 id="migration"><a href="#migration" class="headerlink" title="migration"></a>migration</h5><p><a href="https://developer.android.com/training/animation/screen-slide-2#kotlin">https://developer.android.com/training/animation/screen-slide-2#kotlin</a></p>
<p><a href="https://developer.android.com/training/animation/vp2-migration">https://developer.android.com/training/animation/vp2-migration</a></p>
<p><a href="https://github.com/android/views-widgets-samples/tree/master/ViewPager2">https://github.com/android/views-widgets-samples/tree/master/ViewPager2</a></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;androidx.viewpager2.widget.ViewPager2</span><br><span class="line">    android:<span class="attribute">id</span>=<span class="string">&quot;@+id/view_pater2&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_marginTop</span>=<span class="string">&quot;27dp&quot;</span></span><br><span class="line">    app:<span class="attribute">layout_constraintBottom_toBottomOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">view_pater2.adapter</span> = ScreenSlidePagerAdapter(this)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">ScreenSlidePagerAdapter</span></span>(fa: Fragment) : FragmentStateAdapter(fa) &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> = <span class="number">2</span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">createFragment</span><span class="params">(position: <span class="type">Int</span>)</span></span>: Fragment&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (position==<span class="number">1</span>)&#123;</span><br><span class="line">            BodyDataFragment.newInstance()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            SleepFragment.newInstance()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>TabLayout</tag>
      </tags>
  </entry>
  <entry>
    <title>THINKING</title>
    <url>/2020/05/19/THINKING/</url>
    <content><![CDATA[<p><a href="https://juejin.im/post/5eb168e9f265da7bb65fb27a">https://juejin.im/post/5eb168e9f265da7bb65fb27a</a></p>
<p><a href="https://www.mifengtd.cn/articles/runningcheese-gtd-system.html">https://www.mifengtd.cn/articles/runningcheese-gtd-system.html</a></p>
<p><a href="https://github.com/JsonChao/Awesome-Android-Notebook">https://github.com/JsonChao/Awesome-Android-Notebook</a></p>
<p>I don’t know what to do  if I prevent me  think code or tech in my life.   I think i   love tech ,but it could’t support my career now.I l’m  look forword is that what I can do .</p>
<p>CodeReview</p>
<img src="/2020/05/19/THINKING/codereview3.png" alt="codereview3" style="zoom:50%;">



<p><img src="/2020/05/19/THINKING/codereview4.jpg"></p>
<img src="/2020/05/19/THINKING/codereview1.jpg" alt="CodeReview1" style="zoom: 50%;">

<img src="/2020/05/19/THINKING/codereview2.jpg" alt="CodeReview1" style="zoom:50%;">

]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
      <tags>
        <tag>THINK</tag>
      </tags>
  </entry>
  <entry>
    <title>TextView</title>
    <url>/2018/03/04/TextView/</url>
    <content><![CDATA[<h5 id="TextView颜色变化"><a href="#TextView颜色变化" class="headerlink" title="TextView颜色变化"></a>TextView颜色变化</h5><ul>
<li>SpannableString</li>
</ul>
<p><a href="https://juejin.im/entry/5729d28f1ea49300606854c9">https://juejin.im/entry/5729d28f1ea49300606854c9</a><br>SpannableString有一个不方便的地方是截取字符串</p>
<pre><code>    TextView tvRegister = findViewById(R.id.tv_register);
      //将TextView的显示文字设置为SpannableString
​        tvRegister.setText(getClickableSpan());
​        //设置该句使文本的超连接起作用
​        tvRegister.setMovementMethod(LinkMovementMethod.getInstance());
​        
​       private SpannableString getClickableSpan() &#123;
​        SpannableString spanTxt = new SpannableString(&quot;阅读并同意&lt;&lt;用户注册协议&gt;&gt;&quot;);
​        //设置文字的前景色
​        spanTxt.setSpan(new ForegroundColorSpan(Color.GREEN),5, 15,Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
​        spanTxt.setSpan(new ClickableSpan() &#123;    
​            @Override
​            public void onClick(View widget) &#123;
​                Intent intent = new Intent(TextViewActivity.this, FirstActivity.class);
​                startActivity(intent);
​            &#125;
​        &#125;, 5, 15, Spanned.SPAN_EXCLUSIVE_EXCLUSIVE);
​      
</code></pre>
<p>​    </p>
<p>​     </p>
<ul>
<li>Html标签方式</li>
</ul>
<pre><code>    TextView textView = (TextView) findViewById(R.id.text_for_test);
    String textSource = &quot;修改TextView中部分文字的&lt;font color=&#39;#ff0000&#39;&gt;&lt;big&gt;大&lt;/big&gt;&lt;small&gt;小&lt;/small&gt;&lt;/font&gt;和&lt;font color=&#39;#00ff00&#39;&gt;颜色&lt;/font&gt;，展示多彩效果！&quot;;
    textView.setText(Html.fromHtml(textSource));
</code></pre>
<p><a href="http://www.jianshu.com/p/f6cef78e8652">http://www.jianshu.com/p/f6cef78e8652</a></p>
<p><a href="https://github.com/liqy/TextViewDemo">https://github.com/liqy/TextViewDemo</a></p>
<h5 id="EditText"><a href="#EditText" class="headerlink" title="EditText"></a>EditText</h5><ul>
<li>style里面的配置</li>
</ul>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">&quot;android:focusable&quot;</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line"> &lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">&quot;android:focusableInTouchMode&quot;</span>&gt;<span class="literal">true</span>&lt;/<span class="built_in">item</span>&gt;</span><br></pre></td></tr></table></figure>

<p> <a href="https://blog.csdn.net/u011630575/article/details/50775639">https://blog.csdn.net/u011630575/article/details/50775639</a></p>
<ul>
<li><p>下划线颜色</p>
<p><a href="https://blog.csdn.net/lindroid20/article/details/72551102">https://blog.csdn.net/lindroid20/article/details/72551102</a></p>
</li>
<li><p>自定义解析器</p>
<p><a href="https://my.oschina.net/ososchina/blog/3018393">https://my.oschina.net/ososchina/blog/3018393</a></p>
</li>
<li><p>密码输入框</p>
<p><a href="https://github.com/li504799868/ZEditText">https://github.com/li504799868/ZEditText</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>ThreadStop</title>
    <url>/2019/08/30/ThreadStop/</url>
    <content><![CDATA[<p><a href="https://segmentfault.com/a/1190000007961347">https://segmentfault.com/a/1190000007961347</a></p>
<p><a href="https://www.cnblogs.com/xingele0917/p/3994468.html">https://www.cnblogs.com/xingele0917/p/3994468.html</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>Toolbar</title>
    <url>/2017/10/12/Toolbar/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/training/appbar/setting-up.html">https://developer.android.com/training/appbar/setting-up.html</a></p>
<p><a href="https://github.com/xiewenfeng/statusbartextcolorchange">https://github.com/xiewenfeng/statusbartextcolorchange</a></p>
<p>目前只要考虑 5.0以上系统就可以了,有些flag虽然被标记为Deprecated,但是系统也还在用，所以有必要研究。</p>
 <img src="/2017/10/12/Toolbar/tool_color.png" alt="tool设置" style="zoom:50%;">

<p> <a href="http://blog.csdn.net/a553181867/article/details/51336899">http://blog.csdn.net/a553181867/article/details/51336899</a></p>
<h3 id="statebar"><a href="#statebar" class="headerlink" title="statebar"></a>statebar</h3><p>实现沉浸式状态栏主要跟以下四个Api相关:</p>
<ul>
<li>View#setSystemUiVisibility()</li>
<li>Window#addFlags()</li>
<li>View#setFitsSystemWindows</li>
<li>Window#setStatusBarColor()</li>
</ul>
<h5 id="View-setSystemUiVisibility-及其各种Flags"><a href="#View-setSystemUiVisibility-及其各种Flags" class="headerlink" title="View#setSystemUiVisibility()及其各种Flags"></a>View#setSystemUiVisibility()及其各种Flags</h5><p>首先setSystemUiVisibility()这个方法就是设置状态栏或者导航栏的各种属性的，哪都有些可以设置的属性呢？</p>
<ul>
<li> View.SYSTEM_UI_FLAG_FULLSCREEN</li>
</ul>
<p>  视图全屏并隐藏状态栏，当用户交互时（如下滑状态栏）会恢复隐藏的状态栏（例子：电子书阅读）缺点：进入Activity会产生一个从非全屏到全屏的闪动效果</p>
<p>  <img src="/2017/10/12/Toolbar/View.SYSTEM_UI_FLAG_FULLSCREEN.gif" alt="View.SYSTEM_UI_FLAG_FULLSCREEN"></p>
<ul>
<li><p>View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY</p>
<p>粘性沉浸模式，需要和SYSTEM_UI_FLAG_FULLSCREEN或者SYSTEM_UI_FLAG_HIDE_NAVIGATION联用，当使用View.setSystemUiVisibility(View.SYSTEM_UI_FLAG_FULLSCREEN|View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY)联用时视图全屏，当用户产生交互时（如下滑状态栏）不会恢复状态栏，只会以半透明的方式覆盖在视图上面并在一定时间内自动消失</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getWindow().getDecorView().setSystemUiVisibility(View.SYSTEM_UI_FLAG_FULLSCREEN|View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY)</span><br></pre></td></tr></table></figure>

<p><img src="/2017/10/12/Toolbar/SYSTEM_UI_FLAG_IMMERSIVE_STICKY.gif" alt="SYSTEM_UI_FLAG_IMMERSIVE_STICKY"></p>
</li>
<li><p>View.SYSTEM_UI_FLAG_IMMERSIVE：<br> 沉浸模式，只能和View.SYSTEM_UI_FLAG_FULLSCREEN联用，效果和View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY一样，目前已被后者替代。</p>
</li>
<li><p>View.SYSTEM_UI_FLAG_LOW_PROFILE:<br> 低配模式，会隐藏一些不重要的状态栏和导航栏的图标,(用模拟器跑，只剩下电池了)</p>
</li>
<li><p>View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN：<br> 视图全屏且不会产生闪动，如果没有toolbar,contentview会占住statebar的位置，状态栏会覆盖在contentview上面.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> isWhite = <span class="literal">false</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">change_statebar_element_color</span><span class="params">(view: <span class="type">View</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isWhite) &#123;</span><br><span class="line">        window.decorView.systemUiVisibility = SYSTEM_UI_FLAG_LAYOUT_STABLE <span class="comment">//statebar 元素显示白色</span></span><br><span class="line">        isWhite = <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        window.decorView.systemUiVisibility =</span><br><span class="line">            SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN or SYSTEM_UI_FLAG_LIGHT_STATUS_BAR  <span class="comment">//显示黑色</span></span><br><span class="line">        isWhite = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>View.SYSTEM_UI_FLAG_LAYOUT_STABLE：<br> 使视图稳定，当使用fitSystemWindows（）（下面会介绍这个方法）需要视图稳定，一般和SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN联用,我使用这个属性后，能使<strong>statebar的电池条变成白色</strong>。</p>
</li>
<li><p>View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR:<br> Android6.0系统以上增加的属性，设置了这个属性，状态栏会以与状态栏背景颜色兼容的模式绘制。什么意思呢？就是说如果当前的状态栏颜色是浅色，那么就有可能造成状态栏上的图标看不清了，但是如果你设置这个属性以后，状态栏的图标就会以深色绘制，这样就没有什么UI上的问题了。</p>
</li>
</ul>
<h5 id="Window-addFlags"><a href="#Window-addFlags" class="headerlink" title="Window#addFlags()"></a>Window#addFlags()</h5><p>这种方式<strong>感觉是setSystemUiVisibility之前的用法</strong>了。</p>
<p>WindowManager.LayoutParams相关属性：</p>
<ul>
<li>FLAG_TRANSLUCENT_STATUS:<br> Android4.4系统增加的属性，它会使状态栏透明,并且自动执行View.SYSTEM_UI_FLAG_LAYOUT_STABLE和View.SYSTEM_UI_FLAG_LAYOUT_FULLSCREEN</li>
<li>FLAG_FULLSCREEN:<br> 视图全屏并隐藏状态栏，效果相当于View.SYSTEM_UI_FLAG_FULLSCREEN+View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY，并且视图稳定（不会因为系统控件的变化（如输入法），而重新布局）</li>
<li>FLAG_FORCE_NOT_FULLSCREEN：<br> 重写了FLAG_FULLSCREEN并强制显示状态栏（没有啥用）</li>
<li>FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS：<br> Android5.0系统以上支持，如果设置了该属性，系统栏（状态栏和导航栏）将以透明背景绘制，并且该窗口中的相应区域将填充setStatusBar（）和setNavigationBarColor（）中设置的颜色。 现在项目就是用这种方式。<ol>
<li>感觉这也是设置stateBar颜色一种主要的方式。</li>
<li>另一种就是自己设置statebar颜色。</li>
</ol>
</li>
</ul>
<h4 id="几种全屏模式"><a href="#几种全屏模式" class="headerlink" title="几种全屏模式"></a>几种全屏模式</h4><h5 id="Lean-back"><a href="#Lean-back" class="headerlink" title="Lean back"></a>Lean back</h5><p>倾斜模式</p>
<p>When users want to bring back the system bars, they simply tap the screen anywhere.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">window.decorView.systemUiVisibility =</span><br><span class="line">    SYSTEM_UI_FLAG_FULLSCREEN or SYSTEM_UI_FLAG_HIDE_NAVIGATION</span><br></pre></td></tr></table></figure>

<p>轻触屏幕 会显示 底部导航如返回按钮 </p>
<h5 id="Immersive"><a href="#Immersive" class="headerlink" title="Immersive"></a>Immersive</h5><p>沉浸模式：从边缘滑动，显示系统Bar,也可以通过回调显示系统控件</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">window.decorView.systemUiVisibility =</span><br><span class="line">    SYSTEM_UI_FLAG_FULLSCREEN or SYSTEM_UI_FLAG_HIDE_NAVIGATION or  SYSTEM_UI_FLAG_IMMERSIVE</span><br></pre></td></tr></table></figure>



<h5 id="Sticky-immersive"><a href="#Sticky-immersive" class="headerlink" title="Sticky immersive"></a>Sticky immersive</h5><p>从边缘滑动，显示系统Bar,statebar.又恢复了。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">window.decorView.systemUiVisibility =</span><br><span class="line">    SYSTEM_UI_FLAG_FULLSCREEN or SYSTEM_UI_FLAG_HIDE_NAVIGATION or  SYSTEM_UI_FLAG_IMMERSIVE_STICKY</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.android.com/training/system-ui/immersive">https://developer.android.com/training/system-ui/immersive</a></p>
<p>android 11  systemUiVisibility过期需要更新</p>
<h4 id="Statabar-Color"><a href="#Statabar-Color" class="headerlink" title="Statabar Color"></a>Statabar Color</h4><ol>
<li><p>Application AppTheme statusBarColor</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;AppTheme&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Theme.AppCompat.Light.NoActionBar&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- Customize your theme here. --&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;colorPrimary&quot;</span>&gt;</span>@color/colorPrimary<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;colorPrimaryDark&quot;</span>&gt;</span>@color/colorPrimaryDark<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;colorAccent&quot;</span>&gt;</span>@color/colorAccent<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:statusBarColor&quot;</span>&gt;</span> @android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>Activity设置</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.R) &#123;</span><br><span class="line">    window.decorView.systemUiVisibility =</span><br><span class="line">        View.SYSTEM_UI_FLAG_LIGHT_STATUS_BAR</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    window.insetsController?.setSystemBarsAppearance(</span><br><span class="line">        WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS,</span><br><span class="line">        WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Statabar-element-Color"><a href="#Statabar-element-Color" class="headerlink" title="Statabar element Color"></a>Statabar element Color</h5><p>两种方式</p>
<h6 id="systemUiVisibility"><a href="#systemUiVisibility" class="headerlink" title="systemUiVisibility"></a>systemUiVisibility</h6><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">window.decorView.systemUiVisibility = SYSTEM_UI_FLAG_LAYOUT_STABLE <span class="comment">//statebar 元素显示白色</span></span><br><span class="line"></span><br><span class="line">window.decorView.systemUiVisibility = SYSTEM_UI_FLAG_LIGHT_STATUS_BAR  <span class="comment">//显示黑色</span></span><br></pre></td></tr></table></figure>



<h6 id="主题配置-gt-23"><a href="#主题配置-gt-23" class="headerlink" title="主题配置&gt;23"></a>主题配置&gt;23</h6><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:windowLightStatusBar&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>false : 白色</p>
<p>true :  黑色</p>
<p><a href="https://imstudio.medium.com/android-change-status-bar-text-color-659680fce49b">https://imstudio.medium.com/android-change-status-bar-text-color-659680fce49b</a></p>
<p><a href="https://developer.android.com/training/system-ui">https://developer.android.com/training/system-ui</a></p>
<p><a href="https://blog.csdn.net/shanshui911587154/article/details/86623646">https://blog.csdn.net/shanshui911587154/article/details/86623646</a></p>
<h4 id="WindowInsetsController"><a href="#WindowInsetsController" class="headerlink" title="WindowInsetsController"></a>WindowInsetsController</h4><p>Android11 使用</p>
<h5 id="statabar-text-color"><a href="#statabar-text-color" class="headerlink" title="statabar text color"></a>statabar text color</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequiresApi(Build.VERSION_CODES.R)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">AppearanceLightStatusBars</span><span class="params">(view: <span class="type">android</span>.<span class="type">view</span>.<span class="type">View</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isWhite) &#123;</span><br><span class="line">        controller?.setSystemBarsAppearance(</span><br><span class="line">            WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS,</span><br><span class="line">            WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS</span><br><span class="line">        )</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        controller?.setSystemBarsAppearance(</span><br><span class="line">            <span class="number">0</span>,</span><br><span class="line">            WindowInsetsController.APPEARANCE_LIGHT_STATUS_BARS</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">    isWhite = !isWhite</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="statebar-hide"><a href="#statebar-hide" class="headerlink" title="statebar hide"></a>statebar hide</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> isHide = <span class="literal">true</span></span><br><span class="line"><span class="meta">@RequiresApi(Build.VERSION_CODES.R)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">hide_state_bar</span><span class="params">(view: <span class="type">android</span>.<span class="type">view</span>.<span class="type">View</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isHide) &#123;</span><br><span class="line">        controller?.hide(WindowInsetsCompat.Type.statusBars())</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        controller?.show(WindowInsetsCompat.Type.statusBars())</span><br><span class="line">    &#125;</span><br><span class="line">    isHide = !isHide</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/jingzz1/article/details/111468726">https://blog.csdn.net/jingzz1/article/details/111468726</a></p>
<p><a href="https://juejin.cn/post/6940048488071856164">https://juejin.cn/post/6940048488071856164</a></p>
<h3 id="ToolBar"><a href="#ToolBar" class="headerlink" title="ToolBar"></a>ToolBar</h3><h5 id="颜色设置"><a href="#颜色设置" class="headerlink" title="颜色设置"></a>颜色设置</h5><p>  AppTheme下的设置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;application</span><br><span class="line">      android:name=&quot;.application.NBBApplication&quot;</span><br><span class="line">      android:allowBackup=&quot;true&quot;</span><br><span class="line">      android:icon=&quot;@mipmap/icon&quot;</span><br><span class="line">      android:label=&quot;@string/app_name&quot;</span><br><span class="line">      android:supportsRtl=&quot;true&quot;</span><br><span class="line">      android:theme=&quot;@style/AppTheme&quot;&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Toolbar颜色:<br><code>&lt;item name=&quot;colorPrimary&quot;&gt;@color/toolbar_color&lt;/item&gt;</code></p>
</li>
<li><p>状态栏设置 :<br><code>&lt;item name=&quot;android:windowTranslucentStatus&quot;&gt;true&lt;/item&gt;</code><br> 在 API 19 及更高版本上，Toolbar 内容延伸至状态栏上去了, statebar把toolbar给覆盖了<br> 要解决这个问题就需要下面的属性</p>
</li>
<li><p>android:fitsSystemWindows =”true”<br>  这个属性能保持与statebar一定 的padding,能解决上面windowTranslucentStatus的重叠问题</p>
<p>   参考: <a href="http://yifeng.studio/2017/02/19/android-statusbar/">亦枫</a> </p>
</li>
<li><p>去掉阴影线</p>
<p>   toolbar底部会有一条阴影线,通过AppBarLayout标签下的app:elevation=”0dp”去掉</p>
</li>
</ul>
<h5 id="自定义返回键"><a href="#自定义返回键" class="headerlink" title="自定义返回键"></a>自定义返回键</h5><p><code> mToolbar.setNavigationIcon(R.mipmap.ic_back);//自定义返回键</code></p>
<p>或者这样设置<br> <code>app:navigationIcon=&quot;@mipmap/ic_back&quot;</code></p>
<h5 id="toolbar-xml解读"><a href="#toolbar-xml解读" class="headerlink" title="toolbar.xml解读"></a>toolbar.xml解读</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.design.widget.AppBarLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">app:elevation</span>=<span class="string">&quot;0dp&quot;</span>&gt;</span>                    			 //设置仰角,0dp可以去掉底部的线</span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.Toolbar</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;?attr/actionBarSize&quot;</span><br><span class="line">        android:minHeight=&quot;?actionBarSize&quot;</span><br><span class="line">        android:theme=&quot;@style/ThemeOverlay.AppCompat.ActionBar&quot;			//toolbar主题</span><br><span class="line">        app:popupTheme=&quot;@style/ThemeOverlay.AppCompat.Light&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/tb_title&quot;</span><br><span class="line">            style=&quot;@style/TextAppearance.AppCompat.Widget.ActionBar.Title&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;标题&quot;</span><br><span class="line">            android:textColor=&quot;#333333&quot;</span><br><span class="line">            android:textSize=&quot;18sp&quot; /&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">android.support.v7.widget.Toolbar</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.design.widget.AppBarLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>还有一种方式是在application设置，这样就不用集成baseActivity</p>
<h3 id="menu设置"><a href="#menu设置" class="headerlink" title="menu设置"></a>menu设置</h3><p>AppBarLayout下的 <code>app:theme=&quot;@style/toolbar_menu&quot;</code>用于设置menu</p>
<h5 id="menu字体颜色"><a href="#menu字体颜色" class="headerlink" title="menu字体颜色"></a>menu字体颜色</h5><p>需要设置 app:theme ,用 android:theme不起作用.</p>
<p><code>&lt;item name=&quot;android:actionMenuTextColor&quot;&gt;@color/text_my_black&lt;/item&gt;</code></p>
<h5 id="menu事件"><a href="#menu事件" class="headerlink" title="menu事件"></a>menu事件</h5><pre><code>@Override
public boolean onCreateOptionsMenu(Menu menu) &#123;
    getMenuInflater().inflate(R.menu.menu_login, menu);
    menu.findItem(R.id.item_right_text).setTitle(&quot;注册&quot;); //设置文字
    return true;
&#125;

@Override
public boolean onOptionsItemSelected(MenuItem item) &#123;
    switch (item.getItemId()) &#123;
        
            break;
    &#125;
    return super.onOptionsItemSelected(item);
&#125;
</code></pre>
<p><a href="https://blog.csdn.net/guyuealian/article/details/51721167">https://blog.csdn.net/guyuealian/article/details/51721167</a></p>
<p>使用toolbar过程中遇到了一些问题</p>
<p>问题 1</p>
<p>弹出键盘后 editext不见了，应该是toolbar被拉伸了</p>
<p>暂时解决方式:</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;activity</span><br><span class="line">   android:name=&quot;.activity.WebActivity&quot;</span><br><span class="line">   android:hardwareAccelerated=&quot;true&quot;</span><br><span class="line">   android:screenOrientation=&quot;portrait&quot;</span><br><span class="line">   android:windowSoftInputMode=&quot;adjustPan&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p><a href="https://github.com/CoolThink/StatusBarAdapt/issues/2">https://github.com/CoolThink/StatusBarAdapt/issues/2</a></p>
<h5 id="fragment使用toolbar"><a href="#fragment使用toolbar" class="headerlink" title="fragment使用toolbar"></a>fragment使用toolbar</h5><p><a href="http://wuxiaolong.me/2015/12/21/fragmentToolbar/">http://wuxiaolong.me/2015/12/21/fragmentToolbar/</a></p>
<h5 id="三条线的颜色修改"><a href="#三条线的颜色修改" class="headerlink" title="三条线的颜色修改"></a>三条线的颜色修改</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;DrawerArrowStyle&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Base.Widget.AppCompat.DrawerArrowToggle&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;spinBars&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;color&quot;</span>&gt;</span>@android:color/white<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>具体可以查看mineutil:PopupWindowActivity</p>
<ul>
<li>溢出菜单三个点离右边的距离</li>
</ul>
<p> AppTheme中设置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:actionOverflowButtonStyle&quot;</span>&gt;</span>@style/OverflowMenuStyle<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;OverflowMenuStyle&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;Widget.AppCompat.Light.PopupMenu.Overflow&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;overlapAnchor&quot;</span>&gt;</span>false<span class="tag">&lt;/<span class="name">item</span>&gt;</span>  <span class="comment">&lt;!--把该属性改为false即可使menu位置位于toolbar之下--&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:src&quot;</span>&gt;</span>@mipmap/doc_ic_new_patient<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:paddingRight&quot;</span>&gt;</span>15dp<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>





<table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>＆</td>
<td>如果相对应位都是1，则结果为1，否则为0</td>
<td>（A＆B），得到12，即0000 1100</td>
</tr>
<tr>
<td>|</td>
<td>如果相对应位都是 0，则结果为 0，否则为 1</td>
<td>（A | B）得到61，即 0011 1101</td>
</tr>
<tr>
<td>^</td>
<td>如果相对应位值相同，则结果为0，否则为1</td>
<td>（A ^ B）得到49，即 0011 0001</td>
</tr>
</tbody></table>
<p><a href="https://noteforme.github.io/2018/01/07/Operators/">https://noteforme.github.io/2018/01/07/Operators/</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>TouchEvent1</title>
    <url>/2018/01/08/TouchEvent1/</url>
    <content><![CDATA[<p>​                                                                    <strong>Android Touch Event</strong></p>
<h4 id="Question"><a href="#Question" class="headerlink" title="Question"></a>Question</h4><p>手机屏幕是由一个个像素点渲染而成的，不同的布局类似于幕布一层层叠上去形成了屏幕上显示的效果，The action is from  DOWN、MOVE、UP, How they formed while we used like longClick , touch, click?</p>
<p>a button on the listview item，why the listview item don’t response while we click the button in a interview ?  but I cann’t answer the key point.</p>
<p>multible listview or recycleview in a  Scrollview  ,how to resolve it?</p>
<p>Android provide NestedScrollView for us now,how does it work?</p>
<h4 id="Answer"><a href="#Answer" class="headerlink" title="Answer"></a>Answer</h4><h5 id="Image-clear"><a href="#Image-clear" class="headerlink" title="Image  clear"></a>Image  clear</h5><img src="/2018/01/08/TouchEvent1/Screen_touch_event.png" alt="touch" style="zoom: 67%;">



<p>I found it very useful when i looked it.it make me have global view.and then I read Activity ViewGroup and View source code from framework. But I found some place could do better ,so I draw another Image.</p>
<img src="/2018/01/08/TouchEvent1/ACTION_DOWN No childView.png" alt="action down" style="zoom:67%;">





<img src="/2018/01/08/TouchEvent1/ACTION_DOWN.png" alt="down" style="zoom:67%;">





<img src="/2018/01/08/TouchEvent1/ACTION_MOVE UP.png" alt="move" style="zoom:67%;">



<p>开发中常用的事件分发</p>
<p>ListView　</p>
<p>item 上有Button ,item上的onItemClick事件得不到响应，可以看看官方<a href="https://developer.android.com/reference/android/view/ViewGroup.html#attr_android:descendantFocusability">ViewGroup</a> 描述</p>
<h5 id="item-Button"><a href="#item-Button" class="headerlink" title="item Button"></a>item Button</h5><blockquote>
<p>页面搜索　android:descendantFocusability</p>
<p>android:descendantFocusability属性共有三个取值，分别为<br>beforeDescendants：viewgroup会优先其子类控件而获取到焦点<br>afterDescendants：viewgroup 只有当其子类控件不需要获取焦点时才获取焦点<br>blocksDescendants：viewgroup 会覆盖子类控件而直接获得焦点</p>
</blockquote>
<p>原因 : 在View <code>onTouchEvent(MotionEvent event) </code>中,只要view可点击就返回true,事件就被消费掉了,<br>    set isClickable = true  才可以收到 action move up事件</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> x = event.getX();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">float</span> y = event.getY();</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> viewFlags = mViewFlags;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> action = event.getAction();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> clickable = ((viewFlags &amp; CLICKABLE) == CLICKABLE</span><br><span class="line">            || (viewFlags &amp; LONG_CLICKABLE) == LONG_CLICKABLE)</span><br><span class="line">            || (viewFlags &amp; CONTEXT_CLICKABLE) == CONTEXT_CLICKABLE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((viewFlags &amp; ENABLED_MASK) == DISABLED) &#123;</span><br><span class="line">        <span class="keyword">if</span> (action == MotionEvent.ACTION_UP &amp;&amp; (mPrivateFlags &amp; PFLAG_PRESSED) != <span class="number">0</span>) &#123;</span><br><span class="line">            setPressed(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mPrivateFlags3 &amp;= ~PFLAG3_FINGER_DOWN;</span><br><span class="line">        <span class="comment">// A disabled view that is clickable still consumes the touch</span></span><br><span class="line">        <span class="comment">// events, it just doesn&#x27;t respond to them.</span></span><br><span class="line">        <span class="keyword">return</span> clickable;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>按钮是可以点击的直接被onTouchEvent消费</p>
<p>事件分发</p>
<p><a href="https://juejin.im/post/6862254703837708302">https://juejin.im/post/6862254703837708302</a></p>
<p><a href="https://www.jianshu.com/p/d82f426ba8f7">https://www.jianshu.com/p/d82f426ba8f7</a></p>
<p><a href="https://www.jianshu.com/p/e99b5e8bd67b">https://www.jianshu.com/p/e99b5e8bd67b</a></p>
<p><a href="https://www.jianshu.com/p/5279e887841b">https://www.jianshu.com/p/5279e887841b</a></p>
<p>滑动冲突</p>
<p><a href="https://blog.csdn.net/gdutxiaoxu/article/details/52939127">https://blog.csdn.net/gdutxiaoxu/article/details/52939127</a></p>
<p><a href="https://www.jianshu.com/p/982a83271327">https://www.jianshu.com/p/982a83271327</a></p>
<p><a href="https://juejin.im/user/4336129588334958/posts">https://juejin.im/user/4336129588334958/posts</a></p>
<p><a href="https://www.bilibili.com/video/BV1fb4y1o7ey?from=search&amp;seid=11728197632179808067">https://www.bilibili.com/video/BV1fb4y1o7ey?from=search&amp;seid=11728197632179808067</a></p>
<p><a href="https://www.bilibili.com/video/BV1fb4y1o7ey?p=5">https://www.bilibili.com/video/BV1fb4y1o7ey?p=5</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
      <tags>
        <tag>TouchEvent</tag>
      </tags>
  </entry>
  <entry>
    <title>TouchEvent3</title>
    <url>/2020/11/25/TouchEvent3/</url>
    <content><![CDATA[<h4 id="Button-TextView"><a href="#Button-TextView" class="headerlink" title="Button TextView"></a>Button TextView</h4><p>button clickable=true,所以 默认消费事件,TextView不会</p>
<ul>
<li>value.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;Base.Widget.AppCompat.Button&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;android:Widget&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:background&quot;</span>&gt;</span>@drawable/abc_btn_default_mtrl_shape<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textAppearance&quot;</span>&gt;</span>?android:attr/textAppearanceButton<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:minHeight&quot;</span>&gt;</span>48dip<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:minWidth&quot;</span>&gt;</span>88dip<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:focusable&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:clickable&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:gravity&quot;</span>&gt;</span>center_vertical|center_horizontal<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>处理开篇问题</strong></p>
<h4 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h4><h5 id="外部拦截法"><a href="#外部拦截法" class="headerlink" title="外部拦截法:"></a>外部拦截法:</h5><p>​    需要在父ViewGroup，重写onInterceptTouchEvent( [ˌɪntərˈsept])方法，根据业务需要，判断哪些事件是父Viewgroup需要的，需要的话就对该事件进行拦截，然后交由onTouchEvent方法处理，若不需要，则不拦截，然后传递给子view或子viewGroup。</p>
<h5 id="内部拦截法"><a href="#内部拦截法" class="headerlink" title="内部拦截法"></a>内部拦截法</h5><p>主要由子view控制事件，配合requestDisallowInterceptTouchEvent(),父View不拦截任何down事件</p>
<p>,思路是这样的，在ViewGroupA的Action_Down动作中设置requestDisallowInterceptTouchEvent(true),这样RootView不会走拦截方法，保证Action_Move,能进入ViewGroupA,然后在ViewGroupA的move事件中，根据需要控制RootView发送过来的后续Action_Move事件.</p>
<img src="/2020/11/25/TouchEvent3/TouchEvent3.png" style="zoom:50%;">

<ol>
<li>代码</li>
</ol>
<p>ViewGroupA</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line"> public boolean dispatch<span class="constructor">TouchEvent(MotionEvent <span class="params">ev</span>)</span> &#123;</span><br><span class="line">     <span class="module-access"><span class="module"><span class="identifier">Logger</span>.</span></span>d(ev.get<span class="constructor">Action()</span>, TAG, <span class="module-access"><span class="module"><span class="identifier">Static</span>.</span></span>dispatchTouchEvent + <span class="string">&quot;老板要做淘宝,下周上线?&quot;</span>);</span><br><span class="line">     <span class="built_in">int</span> x = (<span class="built_in">int</span>) ev.get<span class="constructor">X()</span>;</span><br><span class="line">     <span class="built_in">int</span> y = (<span class="built_in">int</span>) ev.get<span class="constructor">Y()</span>;</span><br><span class="line">     switch (ev.get<span class="constructor">Action()</span>) &#123;</span><br><span class="line">         case MotionEvent.ACTION_DOWN:</span><br><span class="line">					get<span class="constructor">Parent()</span>.request<span class="constructor">DisallowInterceptTouchEvent(<span class="params">true</span>)</span>;</span><br><span class="line">             break;</span><br><span class="line"></span><br><span class="line">         case MotionEvent.ACTION_MOVE:</span><br><span class="line">             <span class="built_in">int</span> deltaX = x - mLastX;</span><br><span class="line">             <span class="built_in">int</span> deltaY = y - mLastY;</span><br><span class="line">             <span class="keyword">if</span> (<span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(deltaX) &gt; <span class="module-access"><span class="module"><span class="identifier">Math</span>.</span></span>abs(deltaY)) &#123;</span><br><span class="line">                 get<span class="constructor">Parent()</span>.request<span class="constructor">DisallowInterceptTouchEvent(<span class="params">false</span>)</span>;</span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 get<span class="constructor">Parent()</span>.request<span class="constructor">DisallowInterceptTouchEvent(<span class="params">true</span>)</span>;</span><br><span class="line">             &#125;</span><br><span class="line">             break;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     mLastX = x;</span><br><span class="line">     mLastY = y;</span><br><span class="line">     return super.dispatch<span class="constructor">TouchEvent(<span class="params">ev</span>)</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>RootView</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean on<span class="constructor">InterceptTouchEvent(MotionEvent <span class="params">ev</span>)</span> &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Logger</span>.</span></span>d(ev.get<span class="constructor">Action()</span>, TAG, <span class="module-access"><span class="module"><span class="identifier">Static</span>.</span></span>onInterceptTouchEvent + <span class="string">&quot;(老板可能疯了,但又不是我做.)&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (ev.get<span class="constructor">Action()</span><span class="operator"> == </span>MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        return <span class="literal">false</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>内部拦截ViewGroupA消费事件</li>
</ol>
<p><img src="/2020/11/25/TouchEvent3/%E5%86%85%E9%83%A8%E6%8B%A6%E6%88%AA%E6%B3%95ViewGroupA%E6%B6%88%E8%B4%B9.png" alt="内部拦截"></p>
<p>运行结果</p>
<blockquote>
<p>D/MainActivity [老板] ACTION_DOWN: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>D/RootView     [经理] ACTION_DOWN: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>D/RootView     [经理] ACTION_DOWN: onInterceptTouchEvent  (老板可能疯了,但又不是我做.)<br>D/ViewGroupA   [组长] ACTION_DOWN: dispatchTouchEvent     老板要做淘宝,下周上线?<br>D/ViewGroupA   [组长] ACTION_DOWN: onInterceptTouchEvent  (看着不太靠谱,先问问小王怎么看)<br>D/ViewGroupA   [组长] ACTION_DOWN: onTouchEvent           小王说做不了</p>
<p>D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
<p>D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
</blockquote>
<p>代码流程</p>
<p>Action_down都会被ViewGroupA消费,所以主要分析Action_Move事件流程,由于Action_down  requestDisallowInterceptTouchEvent(true)那么 disallowIntercept =true,</p>
<blockquote>
<p>第1次 Action_Move 分发</p>
<p>RootView      :   dispatchTouchEvent() 29 =&gt; 32=&gt;36 intercepted = false =&gt; 58 =&gt;</p>
<p>ViewGroupA:   dispatchTouchEvent() 29=&gt; 设置 getParent().requestDisallowInterceptTouchEvent(true) =&gt;view =&gt; dispatchTouchEvent被消费</p>
<p>第2次Action_Move 分发</p>
<p>RootView      :   dispatchTouchEvent() 29 =&gt; 32=&gt;36 intercepted = false =&gt; 58 =&gt;</p>
<p>ViewGroupA:   dispatchTouchEvent() 29=&gt; 设置y&gt;x getParent().requestDisallowInterceptTouchEvent(true) =&gt;view =&gt; dispatchTouchEvent被消费</p>
</blockquote>
<p><img src="/2020/11/25/TouchEvent3/%E5%86%85%E9%83%A8%E6%8B%A6%E6%88%AA%E6%B3%95RootView%E6%B6%88%E8%B4%B9.png"></p>
<p>运行结果</p>
<blockquote>
<p>225 24328-24328/ D/MainActivity [老板] ACTION_DOWN: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>226 24328-24328/ D/RootView     [经理] ACTION_DOWN: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>226 24328-24328/ D/RootView     [经理] ACTION_DOWN: onInterceptTouchEvent  (老板可能疯了,但又不是我做.)<br>227 24328-24328/ D/ViewGroupA   [组长] ACTION_DOWN: dispatchTouchEvent     老板要做淘宝,下周上线?<br>227 24328-24328/ D/ViewGroupA   [组长] ACTION_DOWN: onInterceptTouchEvent  (看着不太靠谱,先问问小王怎么看)<br>228 24328-24328/ D/ViewGroupA   [组长] ACTION_DOWN: onTouchEvent           小王说做不了</p>
<p>237 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>237 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>237 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>237 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     dx:0 dy:0<br>238 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     Math.abs(deltaX) &gt; Math.abs(deltaY) false<br>238 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
<p>287 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>287 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>287 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>288 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     dx:2 dy:0<br>288 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     Math.abs(deltaX) &gt; Math.abs(deltaY) true<br>288 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
<p>304 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>305 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>305 24328-24328/ D/RootView     [经理] ACTION_MOVE: onInterceptTouchEvent  (老板可能疯了,但又不是我做.)</p>
<p>320 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>321 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>321 24328-24328/ D/RootView     [经理] ACTION_MOVE: onTouchEvent           报告老板, 技术部说做不了</p>
<p>338 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>338 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>338 24328-24328/ D/RootView     [经理] ACTION_MOVE: onTouchEvent           报告老板, 技术部说做不了</p>
</blockquote>
<p>代码流程</p>
<blockquote>
<p>百思不得其姐， RootView dispatchTouchEvent 后面的onInterceptTouchEvent() 方法日志为什么没打印，其他都能通</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">MotionEvent.ACTION_DOWN request<span class="constructor">DisallowInterceptTouchEvent(<span class="params">true</span>)</span>,必须设置,否则后续的Action_Move无法进入 ViewGroupA</span><br></pre></td></tr></table></figure>

<p><a href="https://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&amp;mid=2650237941&amp;idx=1&amp;sn=40bca69abe10015cc469132f8c76a910&amp;chksm=88639a9abf14138cae7409adec85c5496486a044d7f4ef102e513d9c052aaa30017fb37e3439&amp;scene=38#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&amp;mid=2650237941&amp;idx=1&amp;sn=40bca69abe10015cc469132f8c76a910&amp;chksm=88639a9abf14138cae7409adec85c5496486a044d7f4ef102e513d9c052aaa30017fb37e3439&amp;scene=38#wechat_redirect</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
      <tags>
        <tag>TouchEvent</tag>
      </tags>
  </entry>
  <entry>
    <title>UML</title>
    <url>/2020/03/20/UML/</url>
    <content><![CDATA[<h4 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h4><p>Android Studio插件</p>
<img src="/2020/03/20/UML/UML.png" style="zoom:50%;">

<pre><code>                                           UML.xmind
</code></pre>
<h4 id="UML标准建模语言中5种主要的类型图"><a href="#UML标准建模语言中5种主要的类型图" class="headerlink" title="UML标准建模语言中5种主要的类型图"></a><strong>UML标准建模语言中5种主要的类型图</strong></h4><p><a href="https://www.visual-paradigm.com/tw/guide/uml-unified-modeling-language/what-is-uml/">https://www.visual-paradigm.com/tw/guide/uml-unified-modeling-language/what-is-uml/</a></p>
<p><a href="https://www.cnblogs.com/shindo/p/5579191.html">https://www.cnblogs.com/shindo/p/5579191.html</a></p>
<p><a href="https://juejin.im/post/5e96b1cae51d4546e41beeb3">https://juejin.im/post/5e96b1cae51d4546e41beeb3</a></p>
<h4 id="类图"><a href="#类图" class="headerlink" title="类图"></a>类图</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="依赖关系-dependency"><a href="#依赖关系-dependency" class="headerlink" title="依赖关系-dependency"></a>依赖关系-dependency</h5><ol>
<li>类中用到了对方。</li>
<li>如果是类的成员属性。</li>
<li>如果是方法的返回类型。</li>
<li>是方法接收的参数类型。</li>
<li>方法中使用到。</li>
</ol>
<p><img src="/2020/03/20/UML/dependency.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> PersonDao personDao;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Person person)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Department department = <span class="keyword">new</span> Department();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonDao</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IdCard</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="泛化关系-generalization"><a href="#泛化关系-generalization" class="headerlink" title="泛化关系-generalization"></a>泛化关系-generalization</h5><p>泛化关系实际上就是继承关系，他是依赖关系的特例。</p>
<p><img src="/2020/03/20/UML/Generalization.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSupport</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(Object entity)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Object id)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> <span class="keyword">extends</span> <span class="title">DataSupport</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="实现关系-realization"><a href="#实现关系-realization" class="headerlink" title="实现关系-realization"></a>实现关系-realization</h5><p>A实现B类，就是依赖关系的特例。</p>
<p><img src="/2020/03/20/UML/Realization.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//A实现B类，就是依赖关系的特例。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonServiceBean</span> <span class="keyword">implements</span> <span class="title">PersonService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;delte..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span>  <span class="title">PersonService</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="关联关系-Association"><a href="#关联关系-Association" class="headerlink" title="关联关系-Association"></a>关联关系-Association</h5><p>关联关系实际上是 类与类之间的联系，他是依赖关系的特例。</p>
<p>关联具有导航性（理解成属性）： 即双向关系或单向关系</p>
<p>关系具有多重性： “1” 有且仅有一个，“0”表示0个或者多个，”n…m”表示n到m个</p>
<p><img src="/2020/03/20/UML/association.png"></p>
<p>单向一对一关系</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> IDCard card;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IDCard</span></span>&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>双向一对一关系</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> IDCard card;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IDCard</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> Person person;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="聚合关系-Aggregation"><a href="#聚合关系-Aggregation" class="headerlink" title="聚合关系- Aggregation"></a>聚合关系- Aggregation</h5><p>表示整体和部分的关系，整体与部分可以分开。聚合关系是关联关系的特例，所有他具有关联的导航性与多重性。</p>
<p>如:一台电脑由keyboard ,monitor  mouse组成，组成电脑的各个配件是可以从电脑上分离处理的，使用带空心菱形的实线表示。</p>
<p><img src="/2020/03/20/UML/aggregation.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Moniter moniter; <span class="comment">//moniter可以和computer分离</span></span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;<span class="comment">//mouse可以和computer分离</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moniter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>下面是组合关系</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// computer对象创建moniter,mouse创建， computer销毁也跟着销毁。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Computer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Moniter moniter = <span class="keyword">new</span> Moniter(); <span class="comment">//moniter可以和computer不能分离</span></span><br><span class="line">    <span class="keyword">private</span> Mouse mouse = <span class="keyword">new</span> Mouse();<span class="comment">//mouse可以和computer不能分离</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mouse</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moniter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="组合关系-Composition"><a href="#组合关系-Composition" class="headerlink" title="组合关系-Composition"></a>组合关系-Composition</h5><p>也是整体与部分的关系，整体与部分不可以分开。</p>
<p>Person与IDCard Head，Head与Person就是组合关系，IDCard与Person就是聚合关系。</p>
<p>但是如果在程序中Person实体中定义了对 IDCard进行 <strong>级联删除</strong>，即删除Person时连同IDCard一起删除，那么IDCard和Person就是组合了。</p>
<p><img src="/2020/03/20/UML/composition.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> IDCard card;</span><br><span class="line">    <span class="keyword">private</span> Head head = <span class="keyword">new</span> Head();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IDCard</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Head</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>





<p><a href="https://www.bilibili.com/video/BV1W4411c77E?p=28&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1W4411c77E?p=28&amp;spm_id_from=pageDriver</a></p>
<h4 id="drawio部署"><a href="#drawio部署" class="headerlink" title="drawio部署"></a>drawio部署</h4><p>​    <a href="https://zhangzw.com/posts/20200107.html">https://zhangzw.com/posts/20200107.html</a></p>
<ol>
<li><p><a href="https://tomcat.apache.org/download-80.cgi">tomacat</a> 下载,下载 Core下的文件,解压</p>
</li>
<li><p><a href="https://github.com/jgraph/drawio/releases">Draw</a>下载，解压放到/apache-tomcat-8.5.65/webapps</p>
</li>
<li><p>启动<code>tomcat chomd +x ./startup.sh  ,</code></p>
<p><code> sudo ./statup.sh</code></p>
</li>
</ol>
<h4 id="PlantUml"><a href="#PlantUml" class="headerlink" title="PlantUml"></a>PlantUml</h4><p><a href="https://plantuml.com/zh/">https://plantuml.com/zh/</a></p>
<p><a href="https://tngdigital.yuque.com/tngd-mobile/key-battle/xccdfz">https://tngdigital.yuque.com/tngd-mobile/key-battle/xccdfz</a></p>
<p>时序图都是plantuml,点编辑才能看到code</p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>VideoAudio</title>
    <url>/2017/07/14/VideoAudio/</url>
    <content><![CDATA[<p>先安装codelabs把整个流程走一便，对库的使用有了整体的认识，<br><a href="https://codelabs.developers.google.com/codelabs/exoplayer-intro/#1">https://codelabs.developers.google.com/codelabs/exoplayer-intro/#1</a></p>
<p> 接着了解基本概念</p>
<p>语音转化</p>
<p>AudioApplication</p>
<blockquote>
<p>/Applications/VLC.app/Contents/MacOS/VLC –demux=rawaud –rawaud-channels 1 –rawaud-samplerate 44100 /Users/john/Desktop/audio/recording.pcm</p>
</blockquote>
<h4 id="声音"><a href="#声音" class="headerlink" title="声音"></a>声音</h4><h5 id="声音三要素"><a href="#声音三要素" class="headerlink" title="声音三要素"></a>声音三要素</h5><p>音调 : 音频的快慢  男生 &lt; 女生 &lt; 儿童</p>
<p>音量: 振动的幅度</p>
<p>音色:  谐波</p>
<h5 id="PCM"><a href="#PCM" class="headerlink" title="PCM"></a>PCM</h5><p>采样大小 ： 一个采样用多少bit存放。常用16bit</p>
<p>采样率     :  采样频率 8k , 16k , 32k, 44.1k 48k</p>
<p>声道数    ： 单声道 ， 双声道 ， 多声道</p>
<h5 id="WAV"><a href="#WAV" class="headerlink" title="WAV"></a>WAV</h5><p>![](/Users/john/Documents/noteforme.github.io/source/_posts/VideoAudio/Screen Shot 2021-03-07 at 5.21.18 PM.png)</p>
<p>![](/Users/john/Documents/noteforme.github.io/source/_posts/VideoAudio/Screen Shot 2021-03-07 at 5.23.23 PM.png)</p>
<h4 id="采集"><a href="#采集" class="headerlink" title="采集"></a>采集</h4><h5 id="命令采集"><a href="#命令采集" class="headerlink" title="命令采集"></a>命令采集</h5><figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">ffmpeg -f avfoundation -<span class="selector-tag">i</span> :<span class="number">0</span> out<span class="selector-class">.wav</span>  <span class="comment">//采集</span></span><br><span class="line">ffplay out<span class="selector-class">.wav</span>			<span class="comment">//播放</span></span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>VideoNDK</title>
    <url>/2018/06/14/VideoNDK/</url>
    <content><![CDATA[<p><img src="/2018/06/14/VideoNDK/2021-03-19_2.55.38_PM.png"></p>
<h4 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="comment">// insert code here...</span></span><br><span class="line">    <span class="keyword">char</span>* p = (<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">10</span>);    <span class="comment">//字符型指针 malloc堆空间分配内存</span></span><br><span class="line">    *p = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    *(p+<span class="number">1</span>) = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    *(p+<span class="number">2</span>) = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line">    <span class="comment">// p = NULL;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s \n&quot;</span>,p); </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出 abc</p>
<h5 id="指针函数-带指针的函数"><a href="#指针函数-带指针的函数" class="headerlink" title="指针函数:带指针的函数"></a>指针函数:带指针的函数</h5><p> 函数的返回值为指针类型</p>
<p> 函数声明 : <code>int* func(int x,int y)</code></p>
<p>指针函数调用</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span> *q;</span><br><span class="line">q = func(m);	<span class="comment">// q与被调用的函数的返回类型一致</span></span><br></pre></td></tr></table></figure>



<h6 id="示例1"><a href="#示例1" class="headerlink" title="示例1"></a>示例1</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">getWord</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>: <span class="keyword">return</span> <span class="string">&quot;Apple&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>: <span class="keyword">return</span> <span class="string">&quot;Banana&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span>: <span class="keyword">return</span> <span class="string">&quot;Cat&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: <span class="keyword">return</span> <span class="string">&quot;Dog&quot;</span>;</span><br><span class="line">        <span class="keyword">default</span>:<span class="keyword">return</span> <span class="string">&quot;None&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> input;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;please input a charactar:&quot;</span>);</span><br><span class="line">    input = getchar();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,input);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,getWord(input));</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">please</span> <span class="selector-tag">input</span> <span class="selector-tag">a</span> <span class="selector-tag">charactar</span>:<span class="selector-tag">A</span></span><br><span class="line"><span class="selector-tag">A</span></span><br><span class="line"><span class="selector-tag">Apple</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> 输入A ，getWord()返回值为 Apple的首地址,printf(“%s\n),输出首地址所指向的值</p>
</blockquote>
<h6 id="示例2"><a href="#示例2" class="headerlink" title="示例2"></a>示例2</h6><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">getWord2</span><span class="params">(<span class="keyword">char</span> c)</span></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> str1[] = <span class="string">&quot;Apple&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span> str2[] = <span class="string">&quot;Banana&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span> str3[] = <span class="string">&quot;Cat&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span> str4[] = <span class="string">&quot;Dog&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span> str5[] = <span class="string">&quot;None&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (c) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;A&#x27;</span>: <span class="keyword">return</span> str1;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;B&#x27;</span>: <span class="keyword">return</span> str2;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;C&#x27;</span>: <span class="keyword">return</span> str3;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;D&#x27;</span>: <span class="keyword">return</span> str4;</span><br><span class="line">        <span class="keyword">default</span>:<span class="keyword">return</span> str5;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//#if (0)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> input;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;please input a charactar:&quot;</span>);</span><br><span class="line">    input = getchar();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%c\n&quot;</span>,input);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,getWord2(input));</span><br><span class="line">    getchar();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//#endif</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>注意: 不要返回局部变量的指针</strong></p>
<p>例子2中,str1数组是局部变量，这个字符数组在子程序结束后，它对应的存储空间会被释放.</p>
<h5 id="函数指针：指向函数的指针"><a href="#函数指针：指向函数的指针" class="headerlink" title="函数指针：指向函数的指针"></a>函数指针：指向函数的指针</h5><p>指向函数起始地址的指针</p>
<h6 id="函数指针的定义"><a href="#函数指针的定义" class="headerlink" title="函数指针的定义"></a>函数指针的定义</h6><ul>
<li><p><code>int (*fptr)(int,int)</code>  // (*func)中括号是必要的，这会告诉编译器我们声明的是函数指针而不是声明一个具有返回型为指针的函数</p>
</li>
<li><p>指针变量 :  *fptr , </p>
</li>
<li><p>如果*fptr变为函数名，整个就是一个函数</p>
</li>
</ul>
<h6 id="函数指针的使用"><a href="#函数指针的使用" class="headerlink" title="函数指针的使用"></a>函数指针的使用</h6><p><code> fptr = func;</code></p>
<p>int x = fptr(5,8);</p>
<blockquote>
<p>“%x “ 打印指针本身</p>
</blockquote>
<ol>
<li>示例</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">square</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  num * num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num;</span><br><span class="line">    <span class="keyword">int</span> (*fp)(<span class="keyword">int</span>); <span class="comment">// fp是一个指针，指向返回类型为int，参数为int的函数.</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;please input a number:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;num);</span><br><span class="line">    fp = square;	<span class="comment">// 函数与指针的联系</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fp = 0x%x, %d\n&quot;</span>,fp,(*fp)(num));	<span class="comment">//&#x27;0x%x&#x27; 打印指针本身</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;fp = 0x%x, %d\n&quot;</span>,fp,fp(num));		<span class="comment">// fp直接调用也可以</span></span><br><span class="line">    <span class="keyword">return</span>  <span class="number">0</span>;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>square内存中占据的位置，fp保存square指针的入口地址,fp指向square(),*fp代表 调用square().</p>
<p><img src="/2018/06/14/VideoNDK/2021-03-06_9.54.34_PM.png"></p>
<ol start="2">
<li>用法</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1+num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub</span><span class="params">(<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1-num2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calculate</span><span class="params">(<span class="keyword">int</span> (*fp)(<span class="keyword">int</span>,<span class="keyword">int</span>),<span class="keyword">int</span> num1,<span class="keyword">int</span> num2)</span></span>&#123;	<span class="comment">//通用功能的函数</span></span><br><span class="line">    <span class="keyword">return</span> (*fp)(num1,num2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;3+5=%d\n&quot;</span>,calculate(add,<span class="number">3</span>,<span class="number">5</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;3-5=%d\n&quot;</span>,calculate(sub,<span class="number">3</span>,<span class="number">5</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>函数指针数组</li>
</ol>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function1</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function2</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function3</span><span class="params">(<span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function1</span><span class="params">(<span class="keyword">int</span> choice)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;input %d, run function1().\n &quot;</span>,choice);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function2</span><span class="params">(<span class="keyword">int</span> choice)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;input %d, run function2().\n &quot;</span>,choice);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function3</span><span class="params">(<span class="keyword">int</span> choice)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;input %d, run function3().\n &quot;</span>,choice);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span>(1)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">void</span> (*f[<span class="number">3</span>])(<span class="keyword">int</span>) = &#123;function1,function2,function3&#125;;<span class="comment">//f[3] f是有3个元素的数组，数组的每个元素是指针类型,每个指针指向 参数为(int)类型的函数</span></span><br><span class="line">    <span class="keyword">int</span> choice;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;please enter a digit : [0-2]: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;choice);</span><br><span class="line">    <span class="keyword">while</span> (choice&gt;<span class="number">0</span>&amp;&amp;choice&lt;<span class="number">3</span>) &#123;</span><br><span class="line">        (*f[choice])(choice);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;please enter a digit : [0-2]: &quot;</span>);</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;choice);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;run end&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2018/06/14/VideoNDK/2021-03-06_10.12.11_PM.png"></p>
<p><a href="https://www.bilibili.com/video/BV15J411Q7t9?from=search&amp;seid=1110914330533311902">https://www.bilibili.com/video/BV15J411Q7t9?from=search&amp;seid=1110914330533311902</a></p>
<p>函数指针pft指向了一个已经声明的函数bar()，然后通过pft来实现输出字符和整型的目的。</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">(<span class="keyword">char</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">typedef</span>  <span class="title">void</span> <span class="params">(*PFT)</span><span class="params">(<span class="keyword">char</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    PFT pft;</span><br><span class="line">    pft = bar;</span><br><span class="line">    <span class="built_in">pft</span>(<span class="string">&#x27;e&#x27;</span>,<span class="number">91</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">(<span class="keyword">char</span> ch,<span class="keyword">int</span> i)</span></span>&#123;</span><br><span class="line">    cout&lt;&lt; <span class="string">&quot; bar &quot;</span>&lt;&lt;ch&lt;&lt;<span class="string">&#x27; &#x27;</span>&lt;&lt;i&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>函数指针作为函数的参数，我们可以在一个函数的形参列表中传入一个函数指针， 然后便可以在这个函数中使用这个函数指针所指向的函数</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">void</span> <span class="params">(*PFT)</span><span class="params">(<span class="keyword">char</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">(<span class="keyword">char</span> ch, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;bar &quot;</span> &lt;&lt; ch &lt;&lt; <span class="string">&#x27; &#x27;</span> &lt;&lt; i &lt;&lt; endl;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">char</span> ch, <span class="keyword">int</span> i, PFT pf)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">pf</span>(ch, i);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PFT pft;</span><br><span class="line">    pft = bar;</span><br><span class="line">    <span class="built_in">foo</span>(<span class="string">&#x27;e&#x27;</span>, <span class="number">12</span>, pft);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>函数对象</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123; <span class="keyword">return</span> x; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    A a;</span><br><span class="line">    cout&lt;&lt;<span class="built_in">a</span>(<span class="number">5</span>)&lt;&lt;endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Func</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; a &lt;&lt; <span class="string">&#x27;+&#x27;</span> &lt;&lt; b &lt;&lt; <span class="string">&#x27;=&#x27;</span> &lt;&lt; a + b &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">addFunc</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b, Func &amp;func)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">func</span>(a, b);</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Func func;</span><br><span class="line">    <span class="built_in">addFunc</span>(<span class="number">1</span>, <span class="number">3</span>, func);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h4><h5 id="结构指针"><a href="#结构指针" class="headerlink" title="结构指针"></a>结构指针</h5><p>point</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span>  *<span class="title">pp</span>;</span></span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">point</span> <span class="title">pt</span> =</span> &#123;<span class="number">400</span>,<span class="number">600</span>&#125;;</span><br><span class="line"> pp = &amp;pt;</span><br><span class="line"> </span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;pt  %d, %d   \n&quot;</span>,pt.x, pt.y);<span class="comment">//(*pp.x)中的圆括号是必须的，因为结构成员运算符的 &quot;.&quot; 的优先级比先级高</span></span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;*pp %d, %d    \n&quot;</span>,(*pp).x, (*pp).y);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;pp-&gt;  %d, %d  \n&quot;</span>,pp-&gt;x, pp-&gt;y);</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight tap"><table><tr><td class="code"><pre><span class="line">pt  400,<span class="number"> 600 </span>  </span><br><span class="line">*pp 400,<span class="number"> 600 </span>   </span><br><span class="line">pp-&gt;  400,<span class="number"> 600 </span> </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>结构指针的使用频度非常高，C语言提供了另一种简写方式，假定P指向一个结构的指针，可以用</p>
<p>p-&gt; 结构成员  ==  *p.结构成员</p>
<p>代码表达式<code>printf(&quot;origin is (%d,%d)\n&quot;, pp-&gt;x, pp-&gt;y);</code></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rect</span> <span class="title">r</span> =</span> &#123;&#123;<span class="number">200</span>,<span class="number">300</span>&#125;,&#123;<span class="number">400</span>,<span class="number">500</span>&#125;&#125;;</span><br><span class="line"> <span class="class"><span class="keyword">struct</span> <span class="title">rect</span> *<span class="title">rp</span> =</span> &amp;r;</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;pt1.x %d         \n&quot;</span>,r.pt1.x);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;(*rp).pt1.x %d  \n&quot;</span>,(*rp).pt1.x);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot; rp-&gt;pt1.x %d   \n&quot;</span>,rp-&gt;pt1.x);</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">&quot;r.pt1.x %d  \n&quot;</span>,r.pt1.x);</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">pt1<span class="selector-class">.x</span> <span class="number">200</span>         </span><br><span class="line">(*rp)<span class="selector-class">.pt1</span><span class="selector-class">.x</span> <span class="number">200</span>  </span><br><span class="line"> rp-&gt;pt1<span class="selector-class">.x</span> <span class="number">200</span>   </span><br><span class="line">r<span class="selector-class">.pt1</span><span class="selector-class">.x</span> <span class="number">200</span>  </span><br></pre></td></tr></table></figure>



<h4 id="动态内存分配"><a href="#动态内存分配" class="headerlink" title="动态内存分配"></a>动态内存分配</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">int</span> a[<span class="number">5</span>] = &#123;<span class="number">4</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">6</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;请输入你需要分配的数组的长度：len = &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>,&amp;len);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * sizeof(int) *len 分配len个int字节的长度，len =5时，就是20个字节</span></span><br><span class="line"><span class="comment">     * malloc返回 指向 第一个字节的地址</span></span><br><span class="line"><span class="comment">     * int * 第一个字节的地址，代表Int类型地址， pArr等价于a， pArr+1代表第二个Int地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> *pArr = (<span class="keyword">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="keyword">int</span>) *len);</span><br><span class="line">    *pArr = <span class="number">5</span>; <span class="comment">//类似于 a[0] =4;</span></span><br><span class="line">     pArr[<span class="number">1</span>] = <span class="number">10</span>; <span class="comment">//类似于a[1]=10;</span></span><br><span class="line"><span class="comment">//     printf(&quot;%d %d &quot;,*pArr,pArr[1]);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;len ; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span> , &amp;pArr[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>;  i&lt;len ; ++i) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n &quot;</span> , *(pArr+i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(pArr); <span class="comment">//把pArr所代表的动态分配的20个字节的内存释放</span></span><br></pre></td></tr></table></figure>

<p><img src="/2018/06/14/VideoNDK/point_diagram.png"></p>
<h5 id="结构体变量-hao"><a href="#结构体变量-hao" class="headerlink" title="结构体变量(hao)"></a>结构体变量(hao)</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sid;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">200</span>];</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(struct Student student)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g2</span><span class="params">(struct Student *pst)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(struct Student *pst)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">st</span> =</span> &#123;<span class="number">1000</span>, <span class="string">&quot;张三&quot;</span>, <span class="number">20</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d   %s   %d\n&quot;</span>, st.sid, st.name, st.age);</span><br><span class="line">    st.sid = <span class="number">99</span>;</span><br><span class="line"><span class="comment">//    st.name = &quot;lili&quot;; //error</span></span><br><span class="line">    <span class="built_in">strcpy</span>(st.name, <span class="string">&quot;lili&quot;</span>);<span class="comment">//复制</span></span><br><span class="line">    st.age = <span class="number">22</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d   %s   %d\n&quot;</span>, st.sid, st.name, st.age);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> *<span class="title">pst</span>;</span></span><br><span class="line">    pst = &amp;st;</span><br><span class="line">    pst-&gt;sid = <span class="number">99</span>; <span class="comment">//  pst -&gt; sid 等价于 (*pst).sid 而(*pst).sid 等价于 st.sid</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// pst -&gt; sid</span></span><br><span class="line">    <span class="comment">// 所指向的结构体变量的sid这个成员</span></span><br><span class="line"></span><br><span class="line">    g(st);</span><br><span class="line">    g2(&amp;st);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g2</span><span class="params">(struct Student *pst)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;g2  %d   %s   %d\n&quot;</span>, pst-&gt;sid, pst-&gt;name, pst-&gt;age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这种方式多耗 208 内存，耗时间 不推荐</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(struct Student st)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;g  %d   %s   %d\n&quot;</span>, st.sid, st.name, st.age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="跨函数使用内存"><a href="#跨函数使用内存" class="headerlink" title="跨函数使用内存"></a>跨函数使用内存</h5><figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;malloc.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Student</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> sid;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">struct Student *<span class="title">createStudent</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showStudent</span><span class="params">(struct Student *pst)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span>  <span class="title">Student</span> *<span class="title">ps</span>;</span></span><br><span class="line">    ps = <span class="built_in">createStudent</span>();</span><br><span class="line">    <span class="built_in">showStudent</span>(ps);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">showStudent</span><span class="params">(struct Student *pst)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,pst-&gt;sid,pst-&gt;age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">struct Student *<span class="title">createStudent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span>  <span class="title">Student</span> *<span class="title">p</span> =</span> <span class="built_in">malloc</span>(<span class="built_in"><span class="keyword">sizeof</span></span>(struct Student)); <span class="comment">//表示   struct Student整体的数据类型代表的字节数</span></span><br><span class="line">            p-&gt;sid = <span class="number">99</span>;</span><br><span class="line">            p-&gt;age = <span class="number">88</span>;</span><br><span class="line">    <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h5><ul>
<li><p>java运算符优先级</p>
<blockquote>
<p>!   &amp;&amp;    ||</p>
</blockquote>
</li>
</ul>
<h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><p><a href="https://space.bilibili.com/501486236/video">https://space.bilibili.com/501486236/video</a></p>
<h5 id="typedef-别名"><a href="#typedef-别名" class="headerlink" title="typedef  别名"></a>typedef  别名</h5><p>type_1</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> ZHANGSAN;<span class="comment">//为int再重新多取一个名字，ZHANGSAN等价于int</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sid;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">char</span> sex;</span><br><span class="line">&#125; ST;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>; <span class="comment">//等价于 ZHANGSAN i = 10;</span></span><br><span class="line">    ZHANGSAN j = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, j);</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">st</span>;</span><span class="comment">//等价于 ST st;</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> *<span class="title">ps</span> =</span> &amp;st; <span class="comment">// 等价于 ST * ps</span></span><br><span class="line">    ST st2;</span><br><span class="line">    st2.sid = <span class="number">200</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,st2.sid);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>type_2</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sid;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">char</span> sex;</span><br><span class="line">&#125; * PST ; <span class="comment">//PST等价于 struct Student * ,这样就是一个指针类型了</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span>  <span class="title">Student</span> <span class="title">st</span>;</span></span><br><span class="line">    PST ps  = &amp;st;</span><br><span class="line">    ps-&gt;sid = <span class="number">99</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ps-&gt;sid);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>type_3</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> sid;</span><br><span class="line">    <span class="keyword">char</span> name[<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">char</span> sex;</span><br><span class="line">&#125; * PSTU, STU; <span class="comment">//等价于 ST代表了 struct Student st, PST 代表了struct Student *;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    STU st; <span class="comment">//等价于 struct Student st;</span></span><br><span class="line">    PSTU  ps = &amp;st; <span class="comment">//struct Student * ps = &amp;st;</span></span><br><span class="line">    ps-&gt;sid = <span class="number">99</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ps-&gt;sid);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h4><h5 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h5><blockquote>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="comment">C</span>++ <span class="comment">引用引用变量是一个别名，也就是说，它是某个已存在变量的另一个名字。一旦把引用初始化为某个变量，就可以使用该引用名称或变量名称来指向变量</span></span><br></pre></td></tr></table></figure>
</blockquote>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(<span class="keyword">int</span> &amp;x, <span class="keyword">int</span> &amp;y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t = x;</span><br><span class="line">    x = y;</span><br><span class="line">    y = t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">3</span>, b = <span class="number">4</span>;</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">swap</span>(a, b);</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; <span class="string">&quot;\t&quot;</span> &lt;&lt; b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="函数模板"><a href="#函数模板" class="headerlink" title="函数模板"></a>函数模板</h5><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span>  T&gt;</span><br><span class="line"><span class="function">T <span class="title">add</span><span class="params">(T x,T y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span>  x+y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line">    cout&lt;&lt;add&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>,<span class="number">3</span>)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;add&lt;<span class="keyword">double</span> &gt;(<span class="number">5.3</span>,<span class="number">7.8</span>)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;add&lt;<span class="keyword">int</span>&gt;(<span class="number">4</span>,<span class="number">6</span>)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;add&lt;string&gt;(<span class="string">&quot;hello&quot;</span>,<span class="string">&quot;world&quot;</span>)&lt;&lt;endl;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="comment">//类型自动推断</span></span><br><span class="line">    cout&lt;&lt;<span class="built_in">add</span>(<span class="number">5</span>,<span class="number">3</span>)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="built_in">add</span>(<span class="number">5.3</span>,<span class="number">7.8</span>)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="built_in">add</span>(<span class="number">4</span>,<span class="number">6</span>)&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="built_in">add</span>((<span class="keyword">double</span>)<span class="number">5</span>,<span class="number">7.8</span>)&lt;&lt;endl;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h4 id="swift语法"><a href="#swift语法" class="headerlink" title="swift语法"></a>swift语法</h4><figure class="highlight swift"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">var</span> b: <span class="type">Int</span> <span class="operator">=</span> <span class="number">20</span></span><br><span class="line"><span class="keyword">let</span> aa <span class="operator">=</span> <span class="number">40</span> <span class="comment">//const</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> a<span class="operator">&lt;</span><span class="number">20</span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a &lt; 20 , true&quot;</span> )</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;a &gt;= 20&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> a &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;a equals 10&quot;</span>)</span><br><span class="line"><span class="keyword">case</span> <span class="number">20</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;a equals 20&quot;</span>)</span><br><span class="line"><span class="keyword">default</span> :</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;other&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">25</span><span class="operator">..&lt;</span><span class="number">100</span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;aa,i=&quot;</span>,i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> list  <span class="operator">=</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> list&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;aa, i=&quot;</span>,i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> loop <span class="operator">=</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> loop<span class="operator">&lt;</span><span class="number">10</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;loop, xxx = &quot;</span>,loop)</span><br><span class="line">    loop <span class="operator">=</span> loop <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myFunc</span>(<span class="params">a</span> : <span class="type">Int</span>)</span> -&gt; <span class="type">Int</span>&#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;this is a function&quot;</span>,a)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> mm  <span class="operator">=</span> myFunc(a: <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hello, World!&quot;</span>,a,b,aa,mm)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>environment<br><a href="https://juejin.im/post/5ad98412518825670960c13c">https://juejin.im/post/5ad98412518825670960c13c</a></p>
<p><a href="https://developer.android.com/ndk/">https://developer.android.com/ndk/</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>ViewDynamic</title>
    <url>/2018/07/17/ViewDynamic/</url>
    <content><![CDATA[<h4 id="动态添加布局"><a href="#动态添加布局" class="headerlink" title="动态添加布局"></a>动态添加布局</h4><h5 id="LinearLayout添加"><a href="#LinearLayout添加" class="headerlink" title="LinearLayout添加"></a>LinearLayout添加</h5><ul>
<li><p>父容器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id=&quot;@+id/ll_plan_one&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>子布局</p>
<figure class="highlight gauss"><table><tr><td class="code"><pre><span class="line"><span class="built_in">View</span> view1 = inflate.inflate(R.layout.layout_animation, <span class="built_in">null</span>);</span><br><span class="line"><span class="built_in">View</span> view2 = inflate.inflate(R.layout.ic_hpan_suger_press_y, <span class="built_in">null</span>);</span><br><span class="line"><span class="built_in">View</span> view3 = inflate.inflate(R.layout.ic_hpan_suger_press_y, <span class="built_in">null</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>添加进容器</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">llVertical.add<span class="constructor">View(<span class="params">view1</span>)</span>;</span><br><span class="line">llVertical.add<span class="constructor">View(<span class="params">view2</span>)</span>;</span><br><span class="line">llVertical.add<span class="constructor">View(<span class="params">view3</span>)</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>添加同一个子布局会<strong>报错</strong></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">llVertical.add<span class="constructor">View(<span class="params">view1</span>)</span>;</span><br><span class="line">llVertical.add<span class="constructor">View(<span class="params">view1</span>)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​    Caused by: java.lang.IllegalStateException: The specified child already has a parent. You must call removeView() on the child’s parent first.</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>ViewGroup</title>
    <url>/2020/08/13/ViewGroup/</url>
    <content><![CDATA[<h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p><img src="/2020/08/13/ViewGroup/2021-08-10_view_lifecycle.png"></p>
<p>每次onMeasure，onLayout用到的值都不能在构造方法里面初始化。</p>
<h4 id="ViewGroup测量"><a href="#ViewGroup测量" class="headerlink" title="ViewGroup测量"></a>ViewGroup测量</h4><p><img src="/2020/08/13/ViewGroup/2021-08-12_viewgroup_layout.png"></p>
<p>![](/Users/john/Documents/noteforme.github.io/source/_posts/ViewGroup/Screen Shot 2021-08-13 at 6.21.59 PM.png)</p>
<h4 id="MeasureSpec"><a href="#MeasureSpec" class="headerlink" title="MeasureSpec"></a>MeasureSpec</h4><h5 id="MeasureSpec创建规则"><a href="#MeasureSpec创建规则" class="headerlink" title="MeasureSpec创建规则"></a>MeasureSpec创建规则</h5><p><img src="/2020/08/13/ViewGroup/2021-08-12_9.33_measure_spec_mode.png"></p>
<ol>
<li>子View为精确宽高，无论父容器的MeasureSpec，子View的MeasureSpec都为精确值且遵循LayoutParams中的值。 </li>
<li>子View为match_parent时，如果父容器是精确模式，则子View也为精确模式且为父容器的剩余空间大小；如果父容器是最大模式，则子View也是最大模式且不会超过父容器的剩余空间。</li>
<li>子View为wrap_content时，无论父View是精确还是最大模式，子View的模式总是最大模式，且不会超过父容器的剩余空间。 </li>
</ol>
<p>艺术探索</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7177220-a24570ca31b1b9df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200"></p>
<p><a href="https://www.jianshu.com/p/cb529ed03597">https://www.jianshu.com/p/cb529ed03597</a></p>
<p><a href="https://juejin.cn/post/6844904094205739016">https://juejin.cn/post/6844904094205739016</a></p>
<h5 id="MeasureSpec表示"><a href="#MeasureSpec表示" class="headerlink" title="MeasureSpec表示"></a>MeasureSpec表示</h5><ol>
<li>MeasureSpec用int表示,总共32位，高2位代表SpecMode，低30位代表SpecSize,SpecMode是指测量模式，而SpecSize是指在某种测量模式下的规格大小。MeasureSpec通过将SpecMode和SpecSize打包成一个int值来避免过多的对象内存分配.打包makeMeasureSpec。</li>
<li>高2位 00 , 01, 10, 分别对应UNSPECIFIED, EXACTLY,AT_MOST。</li>
</ol>
<ul>
<li><p><strong>UNSPECIFIED</strong></p>
<p>父容器不对View有任何限制，要多大给多大，这种情况一般用于系统内部，表示一种测量的状态。</p>
</li>
<li><p><strong>EXACTLY</strong></p>
<p>父容器已经检测出View所需要的精确大小，这个时候View的最终大小就是SpecSize所指定的值。它对应于LayoutParams中的match_parent和具体的数值这两种模式。</p>
</li>
<li><p><strong>AT_MOST</strong> </p>
<p>父容器指定了一个可用大小即SpecSize,View的大小不能大于这个值，具体是什么值要看不同View的具体实现。它对应于LayoutParams中的wrap_content。</p>
</li>
</ul>
<p>​     </p>
<p><img src="/2020/08/13/ViewGroup/2021-08-12_9.29_measure_spec.png"></p>
<ul>
<li><p>getMeasuredWidth</p>
<p>在measure()过程结束后就可以获取到对应的值。通过setMeasuredDimension()方法来进行设置。</p>
</li>
<li><p>getWidth区别</p>
<p>在view.layout()过程结束后才能获取到； 通过视图右边的坐标-左边的左边计算出来的</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> childHeightMeasureSpec;</span><br><span class="line"><span class="keyword">if</span> (lp.height == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> height = Math.max(<span class="number">0</span>, getMeasuredHeight()</span><br><span class="line">            - getPaddingTopWithForeground() - getPaddingBottomWithForeground()</span><br><span class="line">            - lp.topMargin - lp.bottomMargin);</span><br><span class="line">    childHeightMeasureSpec = MeasureSpec.makeMeasureSpec(</span><br><span class="line">            height, MeasureSpec.EXACTLY);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,</span><br><span class="line">            getPaddingTopWithForeground() + getPaddingBottomWithForeground() +</span><br><span class="line">            lp.topMargin + lp.bottomMargin,</span><br><span class="line">            lp.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br></pre></td></tr></table></figure>

<p>Frame layout 子节点重新绘制，为什么</p>
<p>Framelayout边界怎么算的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span> (absoluteGravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) &#123;</span><br><span class="line">    <span class="keyword">case</span> Gravity.CENTER_HORIZONTAL:</span><br><span class="line">        childLeft = parentLeft + (parentRight - parentLeft - width) / <span class="number">2</span> +</span><br><span class="line">        lp.leftMargin - lp.rightMargin;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Gravity.RIGHT:</span><br><span class="line">        <span class="keyword">if</span> (!forceLeftGravity) &#123;</span><br><span class="line">            childLeft = parentRight - width - lp.rightMargin;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">case</span> Gravity.LEFT:</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        childLeft = parentLeft + lp.leftMargin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><img src="/2020/08/13/ViewGroup/home/mc/Documents/noteforme.github.io/source/_posts/ViewGroup/2021-08-13_22_viewgroup_XY.png"></p>
<p>Inflate解析过程</p>
<p><img src="/2020/08/13/ViewGroup/home/mc/Documents/noteforme.github.io/source/_posts/ViewGroup/2021-08-14_19-48_inflate_xml.png"></p>
<p><a href="https://www.bilibili.com/video/BV1Ka4y1j7HA?p=4&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Ka4y1j7HA?p=4&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.youtube.com/watch?v=aOb4Hvqbeu4">https://www.youtube.com/watch?v=aOb4Hvqbeu4</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
  </entry>
  <entry>
    <title>View_CanvasApi</title>
    <url>/2017/11/12/View_CanvasApi/</url>
    <content><![CDATA[<h4 id="Canvas的常用操作速查表"><a href="#Canvas的常用操作速查表" class="headerlink" title="Canvas的常用操作速查表"></a>Canvas的常用操作速查表</h4><table>
<thead>
<tr>
<th>操作类型</th>
<th>相关API</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>绘制颜色</td>
<td>drawColor, drawRGB, drawARGB</td>
<td>使用单一颜色填充整个画布</td>
</tr>
<tr>
<td>绘制基本形状</td>
<td>drawPoint, drawPoints, drawLine, drawLines, drawRect, drawRoundRect, drawOval, drawCircle, drawArc</td>
<td>依次为 点、线、矩形、圆角矩形、椭圆、圆、圆弧</td>
</tr>
<tr>
<td>绘制图片</td>
<td>drawBitmap, drawPicture</td>
<td>绘制位图和图片</td>
</tr>
<tr>
<td>绘制文本</td>
<td>drawText,    drawPosText, drawTextOnPath</td>
<td>依次为 绘制文字、绘制文字时指定每个文字位置、根据路径绘制文字</td>
</tr>
<tr>
<td>绘制路径</td>
<td>drawPath</td>
<td>绘制路径，绘制贝塞尔曲线时也需要用到该函数</td>
</tr>
<tr>
<td>顶点操作</td>
<td>drawVertices, drawBitmapMesh</td>
<td>通过对顶点操作可以使图像形变，drawVertices直接对画布作用、 drawBitmapMesh只对绘制的Bitmap作用</td>
</tr>
<tr>
<td>画布剪裁</td>
<td>clipPath,    clipRect</td>
<td>设置画布的显示区域</td>
</tr>
<tr>
<td>画布快照</td>
<td>save, restore, saveLayerXxx, restoreToCount, getSaveCount</td>
<td>依次为 保存当前状态、 回滚到上一次保存的状态、 保存图层状态、 回滚到指定状态、 获取保存次数</td>
</tr>
<tr>
<td>画布变换</td>
<td>translate, scale, rotate, skew</td>
<td>依次为 位移、缩放、 旋转、错切</td>
</tr>
<tr>
<td>Matrix(矩阵)</td>
<td>getMatrix, setMatrix, concat</td>
<td>实际画布的位移，缩放等操作的都是图像矩阵Matrix，只不过Matrix比较难以理解和使用，故封装了一些常用的方法。</td>
</tr>
</tbody></table>
<blockquote>
<p>PS： Canvas常用方法在上面表格中已经全部列出了，当然还存在一些其他的方法未列出，具体可以参考官方文档 <a href="http://developer.android.com/reference/android/graphics/Canvas.html">Canvas</a></p>
</blockquote>
<h4 id="Use-Canvas"><a href="#Use-Canvas" class="headerlink" title="Use Canvas"></a>Use Canvas</h4><h5 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h5><ul>
<li>lineTo简单实现</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">canvas.translate(DeviceUtil.mWidth / <span class="number">2</span>, DeviceUtil.mHeight / <span class="number">2</span>); <span class="comment">//原点移动到屏幕中心</span></span><br><span class="line">   Path path = <span class="keyword">new</span> Path();</span><br><span class="line">   path.lineTo(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">   path.lineTo(<span class="number">200</span>, <span class="number">0</span>);</span><br><span class="line">   canvas.drawPath(path, mPaint);</span><br></pre></td></tr></table></figure>

<img src="/2017/11/12/View_CanvasApi/custoview_02.jpg" alt="customview" style="zoom: 25%;">

<p>从字面意思 lineto,顾名思义肯定就有from的坐标点，再看这个借的图，第一条线是从原点开始的，第二条线是从A开始的，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">path.close();  <span class="comment">//形成封闭的图形</span></span><br></pre></td></tr></table></figure>



<p>   这些操作都可以叠加</p>
<ul>
<li><p>Rect RectF区别: Rect是使用int类型作为数值，RectF是使用float类型作为数值。</p>
<p>四个参数是 矩形左上角和右下角两个点的坐标</p>
</li>
<li><p>画线</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Path path = <span class="keyword">new</span> Path();</span><br><span class="line">path.moveTo(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">path.rLineTo(<span class="number">100</span>, <span class="number">200</span>);</span><br><span class="line">canvas.drawPath(path, mPaint);</span><br></pre></td></tr></table></figure>

<h5 id="Draw-Circle"><a href="#Draw-Circle" class="headerlink" title="Draw Circle"></a>Draw Circle</h5><ul>
<li><p>画笔</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">mPaint = <span class="keyword">new</span> <span class="constructor">Paint()</span>;</span><br><span class="line">mPaint.set<span class="constructor">Color(Color.BLUE)</span>;</span><br><span class="line">mPaint.set<span class="constructor">Style(Paint.Style.FILL)</span>; <span class="comment">// Fill是空心圆 ，STROKE实心圆,</span></span><br><span class="line">空心圆就需要设置setStrokeWidth这个属性</span><br></pre></td></tr></table></figure>

<p>canvas.drawCircle(getWidth()/2,getHeight()/2,getWidth()/2,mPaint);</p>
<p>public void drawArc(RectF oval, float startAngle, float sweepAngle, boolean useCenter, Paint paint)</p>
<p>oval :指定圆弧的外轮廓矩形区域。<br>startAngle: 圆弧起始角度，单位为度。<br>sweepAngle: 圆弧扫过的角度(起始位置 X轴)，顺时针方向，单位为度,从右中间开始为零度。<br>useCenter: 如果为True时，在绘制圆弧时将圆心包括在内，通常用来绘制扇形</p>
<p>RectF是矩形的内接圆,left top right bottom分别对象 左上角和右下角 坐标</p>
</li>
</ul>
<h5 id="drawText"><a href="#drawText" class="headerlink" title="drawText"></a>drawText</h5><p>坐标(0,0)位于左下角</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">canvas</span>?.drawText(<span class="string">&quot;测试文字&quot;</span>,<span class="number">0</span>f,<span class="number">0</span>f,mPaint)</span><br></pre></td></tr></table></figure>

<p>measure textSize </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">val</span> kgRect = <span class="constructor">Rect()</span></span><br><span class="line">var kgText = <span class="string">&quot;hello world&quot;</span></span><br><span class="line">mDialPaint.get<span class="constructor">TextBounds(<span class="params">kgText</span>,0,<span class="params">kgText</span>.<span class="params">length</span>,<span class="params">kgRect</span>)</span></span><br><span class="line">var txtHeight = kgRect.height<span class="literal">()</span></span><br><span class="line">var txtWidth = kgRect.width<span class="literal">()</span></span><br></pre></td></tr></table></figure>



<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">canvas</span><span class="selector-class">.drawPoint</span>(<span class="number">200</span>, <span class="number">200</span>, mPaint);</span><br><span class="line">       <span class="selector-tag">canvas</span><span class="selector-class">.drawPoints</span>(new <span class="attribute">float</span><span class="selector-attr">[]</span>&#123;          //绘制一组点，坐标位置由<span class="attribute">float</span>数组指定</span><br><span class="line">               <span class="number">500</span>, <span class="number">500</span>,</span><br><span class="line">               <span class="number">500</span>, <span class="number">600</span>,</span><br><span class="line">               <span class="number">500</span>, <span class="number">700</span></span><br><span class="line">       &#125;, mPaint);</span><br></pre></td></tr></table></figure>

<p>位移(translate)</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 在坐标原点绘制一个黑色圆形</span></span><br><span class="line">    <span class="selector-tag">canvas</span><span class="selector-class">.translate</span>(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="selector-tag">canvas</span><span class="selector-class">.drawCircle</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, mPaint);</span><br><span class="line">    <span class="comment">// 在坐标原点绘制一个蓝色圆形</span></span><br><span class="line">    <span class="selector-tag">mPaint</span><span class="selector-class">.setColor</span>(Color.BLUE);</span><br><span class="line">    <span class="selector-tag">canvas</span><span class="selector-class">.translate</span>(<span class="number">200</span>, <span class="number">200</span>);</span><br><span class="line">    <span class="selector-tag">canvas</span><span class="selector-class">.drawCircle</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, mPaint);</span><br></pre></td></tr></table></figure>

<p>缩放(scale)</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">canvas.translate(mWidth<span class="operator"> / </span><span class="number">2</span>, mHeight<span class="operator"> / </span><span class="number">2</span>);</span><br><span class="line">   RectF rect = <span class="keyword">new</span> <span class="constructor">RectF(0, -400, 400, 0)</span>;   <span class="comment">// 矩形区域</span></span><br><span class="line">   mPaint.set<span class="constructor">Color(Color.BLACK)</span>;           <span class="comment">// 绘制黑色矩形</span></span><br><span class="line">   canvas.draw<span class="constructor">Rect(<span class="params">rect</span>, <span class="params">mPaint</span>)</span>;</span><br><span class="line">   canvas.scale(-<span class="number">0.5</span>f, -<span class="number">0.5</span>f);          <span class="comment">// 画布缩放  &lt;-- 缩放中心向右偏移了200个单位</span></span><br><span class="line">   mPaint.set<span class="constructor">Color(Color.BLUE)</span>;            <span class="comment">// 绘制蓝色矩形</span></span><br><span class="line">   canvas.draw<span class="constructor">Rect(<span class="params">rect</span>, <span class="params">mPaint</span>)</span>;</span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">   RectF rect = <span class="keyword">new</span> <span class="constructor">RectF(-400, -400, 400, 400)</span>;</span><br><span class="line">   canvas.draw<span class="constructor">Rect(<span class="params">rect</span>, <span class="params">mPaint</span>)</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">       canvas.scale(<span class="number">0.9</span>f, <span class="number">0.9</span>f);</span><br><span class="line">       canvas.draw<span class="constructor">Rect(<span class="params">rect</span>, <span class="params">mPaint</span>)</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>旋转(rotate)</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">canvas</span><span class="selector-class">.rotate</span>(<span class="number">180</span>);</span><br></pre></td></tr></table></figure>

<h5 id="drawPicture-三个方法"><a href="#drawPicture-三个方法" class="headerlink" title="drawPicture 三个方法"></a>drawPicture 三个方法</h5><blockquote>
<p>public void drawPicture (Picture picture) </p>
<p>public void drawPicture (Picture picture, Rect dst) </p>
<p>public void drawPicture (Picture picture, RectF dst)</p>
</blockquote>
<h5 id="drawBitmap-三个方法"><a href="#drawBitmap-三个方法" class="headerlink" title="drawBitmap 三个方法"></a>drawBitmap 三个方法</h5><blockquote>
<p>// 第一种 public void drawBitmap (Bitmap bitmap, Matrix matrix, Paint paint) </p>
<p>// 第二种 public void drawBitmap (Bitmap bitmap, float left, float top, Paint paint)</p>
<p>// 第三种 public void drawBitmap (Bitmap bitmap, Rect src, Rect dst, Paint paint) public void drawBitmap (Bitmap bitmap, Rect src, RectF dst, Paint paint)</p>
</blockquote>
<p>直接看第三种方法</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定图片绘制区域(左上角的四分之一)</span></span><br><span class="line">Rect src = <span class="keyword">new</span> <span class="constructor">Rect(0, 0, <span class="params">bitmap</span>.<span class="params">getWidth</span>()</span><span class="operator"> / </span><span class="number">2</span>, bitmap.get<span class="constructor">Height()</span><span class="operator"> / </span><span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指定图片在屏幕上显示的区域</span></span><br><span class="line">Rect dst = <span class="keyword">new</span> <span class="constructor">Rect(0, 0, 400, 500)</span>;</span><br><span class="line"><span class="comment">//绘制图片</span></span><br><span class="line">canvas.draw<span class="constructor">Bitmap(<span class="params">bitmap</span>, <span class="params">src</span>, <span class="params">dst</span>, <span class="params">null</span>)</span>;</span><br></pre></td></tr></table></figure>



<p>Angle</p>
<p><strong>在常见的数学坐标系中角度增大方向为逆时针，</strong></p>
<p><strong>在默认的屏幕坐标系中角度增大方向为顺时针。</strong></p>
<p>sweepAngle扫过的角度</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">drawArc</span>(<span class="variable">@NonNull</span> RectF oval, float startAngle, float sweepAngle, boolean useCenter,</span><br><span class="line">        <span class="variable">@NonNull</span> Paint paint)</span><br></pre></td></tr></table></figure>

<p>canvas?.drawArc(rectF,0f,145f,false,mDialPaint)</p>
<h5 id="save-restore"><a href="#save-restore" class="headerlink" title="save restore"></a>save restore</h5><p>SaveRestoreView</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">   canvas?.drawLine(<span class="number">0</span>f,<span class="number">200</span>f,<span class="number">700</span>f,<span class="number">200</span>f,linePaint)</span><br><span class="line"><span class="regexp">//</span>        canvas?.save()  <span class="regexp">//</span>将画布状态保存</span><br><span class="line">   canvas?.rotate(<span class="number">90</span>f, px <span class="regexp">/ 2, py /</span> <span class="number">2</span>);</span><br><span class="line"><span class="regexp">//</span>        canvas?.restore();<span class="regexp">//</span>恢复画布状态 这个操作能撤销到 上次保存的画布状态</span><br><span class="line">   canvas?.drawLine(<span class="number">0</span>f,<span class="number">400</span>f,<span class="number">700</span>f,<span class="number">400</span>f,bgPaint)</span><br></pre></td></tr></table></figure>

<p>运行效果：</p>
<img src="/2017/11/12/View_CanvasApi/Screen_Shot_2020-02-25_0.44.15.png" style="zoom: 50%;">



<p>打开注释后的运行效果，这样运行后相当于 没有发生选择画布这件事。</p>
<img src="/2017/11/12/View_CanvasApi/Screen_Shot_2020-02-25_10.46.05.png" alt="Screen_Shot_2020-02-25_10.46.05" style="zoom:50%;">



<h4 id="saveslayer-图层"><a href="#saveslayer-图层" class="headerlink" title="saveslayer 图层"></a>saveslayer 图层</h4><p><a href="https://blog.csdn.net/cquwentao/article/details/51423371">https://blog.csdn.net/cquwentao/article/details/51423371</a></p>
<p> <a href="https://www.jianshu.com/p/0bd672626c8d">https://www.jianshu.com/p/0bd672626c8d</a></p>
<p>Canvas demo</p>
<p><a href="https://medium.com/better-programming/learn-all-android-canvas-draw-functions-dd5d6595884a">https://medium.com/better-programming/learn-all-android-canvas-draw-functions-dd5d6595884a</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
      <tags>
        <tag>VIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>View_OVER</title>
    <url>/2017/11/12/View_OVER/</url>
    <content><![CDATA[<p>自定义View函数调用流程 </p>
<p> <img src="/2017/11/12/View_OVER/View_OVER%5C2019-04-29-71649.jpg" alt="流程"></p>
<p>构造函数执行一次</p>
<p>onMeasure(), onLayout(), onDraw()都可能运行很多次。</p>
<p>所以onMeasure() 用的变量不能在构造方法初始化。</p>
<p><a href="http://gcssloop.github.io/customview/CustomViewProcess">http://gcssloop.github.io/customview/CustomViewProcess</a></p>
<h4 id="窗口显示"><a href="#窗口显示" class="headerlink" title="窗口显示"></a>窗口显示</h4><p> <img src="/2017/11/12/View_OVER/View_OVER%5C2021-02-21_at_5.19.41.png" alt="流程"></p>
<p>每个Activity包含一个Window对象，Android中window对象由PhoneWindow实现，PhoneWindow将一个DecorView设置为整个应用窗口的根View,DecorView作为窗口界面的顶层视图，封装了窗口操作的通用方法，DecorView将要显示的具体内容显示在PhoneWindow上，这里所有的View监听事件通过WindowMangerService来接收,通过Activity对象来回调相应的onCLicklistener.显示是将屏幕分成两部分，一个TitleView，另一个是ContentView.</p>
<h4 id="Measure"><a href="#Measure" class="headerlink" title="Measure"></a>Measure</h4><p>如果是原始的 View,通过measure方法就完成了测量过程,如果是ViewGroup,除了完成自己的测量外，还需要遍历所有的子View,各个子元素再去递归执行这个流程.</p>
<h5 id="View-OnMeasure-方法"><a href="#View-OnMeasure-方法" class="headerlink" title="View OnMeasure()方法"></a>View OnMeasure()方法</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> widthMode = <span class="module-access"><span class="module"><span class="identifier">MeasureSpec</span>.</span></span>get<span class="constructor">Mode(<span class="params">widthMeasureSpec</span>)</span>;</span><br><span class="line"><span class="keyword">val</span> widthSize = <span class="module-access"><span class="module"><span class="identifier">MeasureSpec</span>.</span></span>get<span class="constructor">Size(<span class="params">widthMeasureSpec</span>)</span>; widthSize父控件留个子空间的最大宽度</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> heightMode = <span class="module-access"><span class="module"><span class="identifier">MeasureSpec</span>.</span></span>get<span class="constructor">Mode(<span class="params">heightMeasureSpec</span>)</span>;</span><br><span class="line"><span class="keyword">val</span> heightSize = <span class="module-access"><span class="module"><span class="identifier">MeasureSpec</span>.</span></span>get<span class="constructor">Size(<span class="params">heightMeasureSpec</span>)</span>;</span><br><span class="line"></span><br><span class="line">var width = <span class="number">10</span></span><br><span class="line">var height = <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> (widthMode<span class="operator"> == </span>MeasureSpec.EXACTLY) &#123;   <span class="comment">//如果match_parent或者具体的值，直接赋值</span></span><br><span class="line">    width = widthSize</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (widthMode<span class="operator"> == </span>MeasureSpec.AT_MOST) &#123; <span class="comment">//w，我们要得到控件需要多大的尺寸</span></span><br><span class="line">    width = paddingLeft + mBound.width<span class="literal">()</span> + paddingRight</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//高度跟宽度处理方式一样</span></span><br><span class="line"><span class="keyword">if</span> (heightMode<span class="operator"> == </span>MeasureSpec.EXACTLY) &#123;</span><br><span class="line">    height = heightSize</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (heightMode<span class="operator"> == </span>MeasureSpec.AT_MOST) &#123;</span><br><span class="line">    height = paddingTop + mBound.height<span class="literal">()</span> + paddingBottom</span><br><span class="line">&#125;</span><br><span class="line">set<span class="constructor">MeasuredDimension(<span class="params">width</span>, <span class="params">height</span>)</span></span><br></pre></td></tr></table></figure>

<p>理解onMeasure <a href="https://blog.csdn.net/tuke_tuke/article/details/73302595">https://blog.csdn.net/tuke_tuke/article/details/73302595</a></p>
<p>加载布局</p>
<img src="/2017/11/12/View_OVER/2021-02-16_at_3.37.39.png" alt="图" style="zoom:80%;">

<h5 id="onSizeChanged"><a href="#onSizeChanged" class="headerlink" title="onSizeChanged"></a>onSizeChanged</h5><p>因为View的大小不仅由View本身控制，而且受父控件的影响，所以我们在确定View大小的时候最好使用系统提供的onSizeChanged回调函数。它又四个参数，分别为 宽度，高度，上一次宽度，上一次高度。这个函数比较简单，我们只需关注 宽度(w), 高度(h) 即可，这两个参数就是View最终的大小。</p>
<p>链接：<a href="https://juejin.cn/post/6844903448186454030">https://juejin.cn/post/6844903448186454030</a></p>
<h4 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h4><p><code>public void layout(int l, int t, int r, int b) </code></p>
<p>该控件的左 上 右 下边距</p>
<h4 id="Scroller"><a href="#Scroller" class="headerlink" title="Scroller"></a>Scroller</h4><h5 id="scrollTo-scrollBy"><a href="#scrollTo-scrollBy" class="headerlink" title="scrollTo scrollBy"></a>scrollTo scrollBy</h5><p>在 View 类中，有两个变量 <code>mScrollX</code> 和 <code>mScrollY</code>，它们记录的是 View 的内容的偏移值。<code>mScrollX</code> 和 <code>mScrollY</code> 的默认值都是 0，即默认不偏移。另外我们需要知道一点，向左滑动，<code>mScrollX</code> 为正数，反正为负数。假设我们令 <code>mScrollX = 10</code>，那么该 View 的内容会相对于原来向左偏移 10px。 看看系统的 View 类中的源码：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * The offset, in pixels, by which the content of this view is scrolled</span></span><br><span class="line"><span class="comment">  * horizontally.</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@hide</span>&#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">int</span> mScrollX; <span class="comment">//整个滑动过程的 X移动范围</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * The offset, in pixels, by which the content of this view is scrolled</span></span><br><span class="line"><span class="comment">  * vertically.</span></span><br><span class="line"><span class="comment">  * &#123;<span class="doctag">@hide</span>&#125;</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="keyword">int</span> mScrollY;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>滑动绝对距离</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollTo</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br></pre></td></tr></table></figure>

<p>滑动相对距离</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scrollBy</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></span><br></pre></td></tr></table></figure>



<h5 id="Scroller辅助类"><a href="#Scroller辅助类" class="headerlink" title="Scroller辅助类"></a>Scroller辅助类</h5><p>HorizontalScrollViewEx</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HorizontalScrollViewEx</span> <span class="keyword">extends</span> <span class="title">ViewGroup</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;HorizontalScrollViewEx&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChildrenSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChildWidth;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mChildIndex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 分别记录上次滑动的坐标</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLastX = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLastY = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// 分别记录上次滑动的坐标(onInterceptTouchEvent)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLastXIntercept = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> mLastYIntercept = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Scroller mScroller;</span><br><span class="line">    <span class="keyword">private</span> VelocityTracker mVelocityTracker;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HorizontalScrollViewEx</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context, attrs);</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mScroller = <span class="keyword">new</span> Scroller(getContext());</span><br><span class="line">        mVelocityTracker = VelocityTracker.obtain();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent event)</span> </span>&#123;</span><br><span class="line">        mVelocityTracker.addMovement(event);</span><br><span class="line">        <span class="keyword">int</span> x = (<span class="keyword">int</span>) event.getX();</span><br><span class="line">        <span class="keyword">int</span> y = (<span class="keyword">int</span>) event.getY();</span><br><span class="line">        <span class="keyword">switch</span> (event.getAction()) &#123;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_DOWN: &#123;</span><br><span class="line">                <span class="keyword">if</span> (!mScroller.isFinished()) &#123;</span><br><span class="line">                    mScroller.abortAnimation();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_MOVE: &#123;</span><br><span class="line">                <span class="keyword">int</span> deltaX = x - mLastX;</span><br><span class="line">                <span class="keyword">int</span> deltaY = y - mLastY;</span><br><span class="line">                scrollBy(-deltaX, <span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> MotionEvent.ACTION_UP: &#123;</span><br><span class="line">                <span class="keyword">int</span> scrollX = getScrollX();</span><br><span class="line"><span class="comment">//                int scrollToChildIndex = scrollX / mChildWidth;</span></span><br><span class="line">                mVelocityTracker.computeCurrentVelocity(<span class="number">1000</span>);</span><br><span class="line">                <span class="keyword">float</span> xVelocity = mVelocityTracker.getXVelocity();</span><br><span class="line">                <span class="keyword">if</span> (Math.abs(xVelocity) &gt;= <span class="number">50</span>) &#123;</span><br><span class="line">                    mChildIndex = xVelocity &gt; <span class="number">0</span> ? mChildIndex - <span class="number">1</span> : mChildIndex + <span class="number">1</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    mChildIndex = (scrollX + mChildWidth / <span class="number">2</span>) / mChildWidth;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                mChildIndex = Math.max(<span class="number">0</span>, Math.min(mChildIndex, mChildrenSize - <span class="number">1</span>));</span><br><span class="line">                Log.d(TAG,  <span class="string">&quot;xVelocity &quot;</span>+xVelocity+ <span class="string">&quot; mChildIndex &quot;</span> +mChildIndex +<span class="string">&quot; mChildWidth &quot;</span> + mChildWidth);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> dx = mChildIndex * mChildWidth - scrollX;</span><br><span class="line"></span><br><span class="line">                Log.d(TAG,  <span class="string">&quot; scrollX &quot;</span> + scrollX + <span class="string">&quot; dx &quot;</span> + dx);</span><br><span class="line">                smoothScrollBy(dx, <span class="number">0</span>);</span><br><span class="line">                mVelocityTracker.clear();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        mLastX = x;</span><br><span class="line">        mLastY = y;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> l, <span class="keyword">int</span> t, <span class="keyword">int</span> r, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;left &quot;</span> + l + <span class="string">&quot; top &quot;</span> + t + <span class="string">&quot; right &quot;</span> + r + <span class="string">&quot; bottom &quot;</span> + b);</span><br><span class="line">        <span class="keyword">int</span> childLeft = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> childCount = getChildCount();</span><br><span class="line">        mChildrenSize = childCount;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; childCount; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> View childView = getChildAt(i);</span><br><span class="line">            <span class="keyword">if</span> (childView.getVisibility() != View.GONE) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> childWidth = childView.getMeasuredWidth();</span><br><span class="line">                mChildWidth = childWidth;</span><br><span class="line">                childView.layout(childLeft, <span class="number">0</span>, childLeft + childWidth,</span><br><span class="line">                        childView.getMeasuredHeight());</span><br><span class="line">                childLeft += childWidth;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">smoothScrollBy</span><span class="params">(<span class="keyword">int</span> dx, <span class="keyword">int</span> dy)</span> </span>&#123;</span><br><span class="line">        mScroller.startScroll(getScrollX(), <span class="number">0</span>, dx, <span class="number">0</span>, <span class="number">500</span>);</span><br><span class="line">        invalidate();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">computeScroll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mScroller.computeScrollOffset()) &#123;</span><br><span class="line">            Log.d(TAG,<span class="string">&quot;getCurrX &quot;</span>+mScroller.getCurrX() + <span class="string">&quot;mScroller.getCurrY() &quot;</span> +mScroller.getCurrY());</span><br><span class="line">            scrollTo(mScroller.getCurrX(), mScroller.getCurrY());</span><br><span class="line">            postInvalidate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mVelocityTracker.recycle();</span><br><span class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>可知View的scrollTo()、scrollBy()是瞬间完成的，当我们的手指在屏幕上移动时，内容会跟着手指滑动，但是当我们手指一抬起时，滑动就会停止,为使得滚动更加平滑,Scroller只是计算辅助类，它的startScroll()和computeScrollOffset()方法中也只是对一些轨迹参数进行设置和计算，真正需要进行滑动还是得通过View的scrollTo()、scrollBy()方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 开始滚动，并记下当前时间点作为开始滚动的时间点</span></span><br><span class="line">startX startY，滑动时起点偏移量，</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startScroll</span><span class="params">(<span class="keyword">int</span> startX, <span class="keyword">int</span> startY, <span class="keyword">int</span> dx, <span class="keyword">int</span> dy, <span class="keyword">int</span> duration)</span> </span></span><br></pre></td></tr></table></figure>

<p>开始一个动画控制，由(startX , startY)在duration时间内前进(dx,dy)个单位，即到达偏移坐标为(startX+dx , startY+dy)处。</p>
<p>滑动日志,startX+dx是1080 2160,印证了上面的判断</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">com</span>.ryg.chapter_<span class="number">3</span> D/HorizontalScrollViewEx:  scrollX <span class="number">821</span> dx <span class="number">259</span></span><br><span class="line"><span class="attribute">com</span>.ryg.chapter_<span class="number">3</span> D/HorizontalScrollViewEx:  scrollX <span class="number">2007</span> dx <span class="number">153</span></span><br></pre></td></tr></table></figure>



<p>实际滑动处理类，Scroller类应该有个插值器，提供滑动控制</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void compute<span class="constructor">Scroll()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mScroller.compute<span class="constructor">ScrollOffset()</span>) &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG,<span class="string">&quot;getCurrX &quot;</span>+mScroller.get<span class="constructor">CurrX()</span> + <span class="string">&quot;mScroller.getCurrY() &quot;</span> +mScroller.get<span class="constructor">CurrY()</span>);</span><br><span class="line">        scroll<span class="constructor">To(<span class="params">mScroller</span>.<span class="params">getCurrX</span>()</span>, mScroller.get<span class="constructor">CurrY()</span>);</span><br><span class="line">        post<span class="constructor">Invalidate()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="http://chanthuang.github.io/2016/08/31/Android-View-%E7%9A%84%E6%BB%9A%E5%8A%A8%E5%8E%9F%E7%90%86%E5%92%8C-Scroller%E3%80%81VelocityTracker-%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8/">http://chanthuang.github.io/2016/08/31/Android-View-%E7%9A%84%E6%BB%9A%E5%8A%A8%E5%8E%9F%E7%90%86%E5%92%8C-Scroller%E3%80%81VelocityTracker-%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8/</a></p>
<p><a href="https://www.jianshu.com/p/f10809e1964b">https://www.jianshu.com/p/f10809e1964b</a></p>
<h4 id="Draw"><a href="#Draw" class="headerlink" title="Draw"></a>Draw</h4><p>Paint</p>
<p>为了展示方便，容易看出效果，之前使用的模式一直为填充模式，实际上画笔有三种模式，如下：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">STROKE                <span class="regexp">//</span>描边</span><br><span class="line">FILL                  <span class="regexp">//</span>填充</span><br><span class="line">FILL_AND_STROKE       <span class="regexp">//</span>描边加填充</span><br></pre></td></tr></table></figure>

<p>为了区分三者效果我们做如下实验：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Paint paint = <span class="keyword">new</span> <span class="constructor">Paint()</span>;</span><br><span class="line">paint.set<span class="constructor">Color(Color.BLUE)</span>;</span><br><span class="line">paint.set<span class="constructor">StrokeWidth(40)</span>;     <span class="comment">//为了实验效果明显，特地设置描边宽度非常大</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 描边</span></span><br><span class="line">paint.set<span class="constructor">Style(Paint.Style.STROKE)</span>;</span><br><span class="line">canvas.draw<span class="constructor">Circle(200,200,100,<span class="params">paint</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 填充</span></span><br><span class="line">paint.set<span class="constructor">Style(Paint.Style.FILL)</span>;</span><br><span class="line">canvas.draw<span class="constructor">Circle(200,500,100,<span class="params">paint</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 描边加填充</span></span><br><span class="line">paint.set<span class="constructor">Style(Paint.Style.FILL_AND_STROKE)</span>;</span><br><span class="line">canvas.draw<span class="constructor">Circle(200, 800, 100, <span class="params">paint</span>)</span>;</span><br></pre></td></tr></table></figure>

<img src="https://camo.githubusercontent.com/cb4ff7eb6df1e98d082a48ceaf4c29370e236103/687474703a2f2f7777342e73696e61696d672e636e2f6c617267652f30303558746469326a77316632373467366c7862706a3330753031686371336e2e6a7067" alt="显示图" style="zoom:25%;">



<h5 id="画布"><a href="#画布" class="headerlink" title="画布"></a>画布</h5><p>坐标操作</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">canvas</span><span class="selector-class">.scale</span>(<span class="number">1</span>,-<span class="number">1</span>);                 <span class="comment">// 翻转Y轴</span></span><br></pre></td></tr></table></figure>





<h5 id="自定义属性类别"><a href="#自定义属性类别" class="headerlink" title="自定义属性类别"></a>自定义属性类别</h5><blockquote>
<p>boolean     表示attr取值为true或者false<br>color         表示attr取值是颜色类型，例如#ff3344,或者是一个指向color的资源id，例如R.color.colorAccent.<br>dimension 表示 attr 取值是尺寸类型，例如例如取值16sp、16dp，也可以是一个指向dimen的资源id，例          如R.dimen.dp_16<br>float      表示attr取值是整形或者浮点型<br>fraction     表示 attr取值是百分数类型，只能以%结尾，例如30%<br>integer      表示attr取值是整型<br>string        表示attr取值是String类型，或者一个指向String的资源id，例如R.string.testString<br>reference   表示attr取值只能是一个指向资源的id。<br>enum     表示attr取值只能是枚举类型。</p>
</blockquote>
<p><strong>refrence , 表示attr取值只能是一个指向资源的id。</strong></p>
<attr name="color" format="refrence">

<p>注意  dimension ,</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">val <span class="selector-tag">a</span> = context!!<span class="selector-class">.obtainStyledAttributes</span>(attrs, R<span class="selector-class">.styleable</span><span class="selector-class">.ViewBodySleep</span> , defStyleAttr, <span class="number">0</span>)</span><br><span class="line"> linePaint<span class="selector-class">.textSize</span>   = <span class="selector-tag">a</span><span class="selector-class">.getDimensionPixelSize</span>(R<span class="selector-class">.styleable</span><span class="selector-class">.ViewBodySleep_vbltextsize</span>,<span class="number">21</span>)<span class="selector-class">.toFloat</span>()</span><br><span class="line"> indexPaint<span class="selector-class">.textSize</span>   = <span class="selector-tag">a</span><span class="selector-class">.getDimensionPixelSize</span>(R<span class="selector-class">.styleable</span><span class="selector-class">.ViewBodySleep_vbltextsize</span>,<span class="number">21</span>)<span class="selector-class">.toFloat</span>()</span><br><span class="line"> <span class="selector-tag">a</span><span class="selector-class">.recycle</span>()</span><br></pre></td></tr></table></figure>



<p> <a href="https://github.com/GcsSloop/AndroidNote/tree/master/CustomView">https://github.com/GcsSloop/AndroidNote/tree/master/CustomView</a></p>
<p><a href="https://www.sunzn.com/2017/08/21/%E8%87%AA%E5%AE%9A%E4%B9%89-View-%E5%9F%BA%E7%A1%80-%E8%A7%92%E5%BA%A6%E4%B8%8E%E5%BC%A7%E5%BA%A6/">https://www.sunzn.com/2017/08/21/%E8%87%AA%E5%AE%9A%E4%B9%89-View-%E5%9F%BA%E7%A1%80-%E8%A7%92%E5%BA%A6%E4%B8%8E%E5%BC%A7%E5%BA%A6/</a></p>
<h5 id="setWillNotDraw"><a href="#setWillNotDraw" class="headerlink" title="setWillNotDraw"></a>setWillNotDraw</h5><p>ViewGroup默认情况下，出于性能考虑，会被设置成WILL_NOT_DROW，这样，ondraw就不会被执行了。</p>
<p>如果我们想重写一个viewgroup的ondraw方法，有两种方法：</p>
<p>1，构造函数中，给viewgroup设置一个颜色。</p>
<p>2，构造函数中，调用setWillNotDraw（false），去掉其WILL_NOT_DRAW flag。</p>
<p>在viewgroup初始化的时候，它调用了一个私有方法：initViewGroup，它里面会有一句setFlags（WILLL_NOT_DRAW,DRAW_MASK）;相当于调用了setWillNotDraw（true），所以说，对于ViewGroup，他就认为是透明的了，如果我们想要重写onDraw，就要调用setWillNotDraw（false）。</p>
<p><a href="https://www.jianshu.com/p/7df7e8a0b1a6">https://www.jianshu.com/p/7df7e8a0b1a6</a></p>
<p><a href="https://juejin.im/post/5e6e0b91f265da5716712288">https://juejin.im/post/5e6e0b91f265da5716712288</a></p>
<p>RelativeLayout就是拓扑排序，用到了不光是树，还有图。所以数据结构与算法真的非常重要，他会让你的学习不会再那么枯燥。</p>
<p>childview</p>
<p><a href="https://www.jianshu.com/p/c84693096e41">https://www.jianshu.com/p/c84693096e41</a></p>
<p><a href="https://mp.weixin.qq.com/s/psrDADxwl782Fbs_vzxnQg">https://mp.weixin.qq.com/s/psrDADxwl782Fbs_vzxnQg</a></p>
<h5 id="UI-优化系列专题"><a href="#UI-优化系列专题" class="headerlink" title="UI 优化系列专题"></a>UI 优化系列专题</h5><p><a href="https://www.jianshu.com/p/ea464eb15436">https://www.jianshu.com/p/ea464eb15436</a></p>
<h5 id="淘宝详情"><a href="#淘宝详情" class="headerlink" title="淘宝详情"></a>淘宝详情</h5><p>onLayout 两个子view切换绘制</p>
<p><a href="https://juejin.cn/post/6844903828035207182">https://juejin.cn/post/6844903828035207182</a></p>
</attr>]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
      <tags>
        <tag>VIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>View_Practice</title>
    <url>/2019/01/01/View_Practice/</url>
    <content><![CDATA[<p>绘制心电图</p>
<p><a href="https://github.com/SeekerFighter/LuckyEcgDemo">https://github.com/SeekerFighter/LuckyEcgDemo</a></p>
<p><a href="https://www.jianshu.com/p/16301de41a18">https://www.jianshu.com/p/16301de41a18</a></p>
<h5 id="表单输入"><a href="#表单输入" class="headerlink" title="表单输入"></a>表单输入</h5><p><img src="/2019/01/01/View_Practice/CustomView2018-05-12_09-42-16.png" alt="CustomView2018-05-12 09-42-16"></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * EditText文字固定在右边</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">public <span class="keyword">class</span> EditTextRight extends AppCompatEditText &#123;</span><br><span class="line">    <span class="keyword">private</span> String txtRight;</span><br><span class="line">    <span class="keyword">private</span> Paint mPaint;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">EditTextRight(Context <span class="params">context</span>)</span> &#123;</span><br><span class="line">        super(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="constructor">EditTextRight(Context <span class="params">context</span>, AttributeSet <span class="params">attrs</span>)</span> &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line"></span><br><span class="line">        init<span class="constructor">Attrs(<span class="params">context</span>, <span class="params">attrs</span>)</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> void init<span class="constructor">Attrs(Context <span class="params">context</span>, AttributeSet <span class="params">attrs</span>)</span> &#123;</span><br><span class="line">        TypedArray ta = context.obtain<span class="constructor">StyledAttributes(<span class="params">attrs</span>, R.<span class="params">styleable</span>.EditTextRight)</span>;</span><br><span class="line">        mPaint = <span class="keyword">new</span> <span class="constructor">Paint(Paint.ANTI_ALIAS_FLAG)</span>;</span><br><span class="line">        txtRight = ta.get<span class="constructor">String(R.<span class="params">styleable</span>.EditTextRight_textright)</span>;</span><br><span class="line"><span class="comment">//        Timber.d(&quot;text&quot; + txtRight);</span></span><br><span class="line">        ta.recycle<span class="literal">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void on<span class="constructor">Draw(Canvas <span class="params">canvas</span>)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">Draw(<span class="params">canvas</span>)</span>;</span><br><span class="line">        <span class="built_in">float</span> txtSize = get<span class="constructor">TextSize()</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="module-access"><span class="module"><span class="identifier">TextUtils</span>.</span></span>is<span class="constructor">Empty(<span class="params">txtRight</span>)</span>) &#123;</span><br><span class="line">            <span class="built_in">float</span> yrig = get<span class="constructor">Width()</span> - txtSize<span class="operator"> * </span>txtRight.length<span class="literal">()</span> - <span class="number">10</span>; <span class="comment">//getWidth() 控件宽度</span></span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;txt &quot;</span> + txtRight + <span class="string">&quot;   getRight &quot;</span> + yrig);</span><br><span class="line">            canvas.draw<span class="constructor">Text(<span class="params">txtRight</span>, <span class="params">yrig</span>, <span class="params">getBaseline</span>()</span>, get<span class="constructor">Paint()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">&lt;com<span class="selector-class">.jonzhou</span><span class="selector-class">.mineutils</span><span class="selector-class">.ui</span><span class="selector-class">.customview</span>.EditTextRight</span><br><span class="line">      android:layout_width=<span class="string">&quot;100dp&quot;</span></span><br><span class="line">      android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">      mineutils:textright=<span class="string">&quot;幢&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>







<h5 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h5><p>画正方形</p>
<ul>
<li><p>```<br>&lt;com.jonzhou.cusomview.view.MyView</p>
<pre><code>android:layout_width=&quot;wrap_content&quot;
android:layout_height=&quot;100dp&quot;
android:background=&quot;@android:color/holo_blue_bright&quot; /&gt;
</code></pre>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>public class MyView extends View {<br>  public MyView(Context context) {</p>
<pre><code>  super(context);
</code></pre>
<p>  }</p>
<p>  public MyView(Context context, AttributeSet attrs) {</p>
<pre><code>  super(context, attrs);
  Timber.i(&quot; MyView(Context context, AttributeSet attrs)&quot;);
</code></pre>
<p>  }</p>
<p>  public MyView(Context context, AttributeSet attrs, int defStyleAttr) {</p>
<pre><code>  super(context, attrs, defStyleAttr);
</code></pre>
<p>  }</p>
</li>
</ul>
<pre><code>@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;
    super.onMeasure(widthMeasureSpec, heightMeasureSpec);

    Timber.i(&quot;onMeasure(int widthMeasureSpec, int heightMeasureSpec)&quot;);
    int width = getMySize(100, widthMeasureSpec);
    int height = getMySize(100, heightMeasureSpec);
    if (width &lt; height) &#123;
        height = width;
    &#125; else &#123;
        width = height;
    &#125;
    Timber.i(&quot;width &quot; + width + &quot;   height  &quot; + height);
    setMeasuredDimension(width,height);
&#125;

private int getMySize(int defaultSize, int measureSpec) &#123;
    int mySize = defaultSize;
    int mode = MeasureSpec.getMode(measureSpec);
    int size = MeasureSpec.getSize(measureSpec);
    switch (mode) &#123;
        case MeasureSpec.UNSPECIFIED: //如果没有指定大小，就设置为默认大小
            mySize = defaultSize;
            break;
        case MeasureSpec.AT_MOST://如果测量模式是最大取值为size
            //我们将大小取最大值,你也可以取其他值
            mySize = size;
            break;
        case MeasureSpec.EXACTLY:
            mySize = size;
            break;
    &#125;
    return mySize;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">设置 match_parent不是正方形?</span><br><span class="line"></span><br><span class="line">- 关于自定义属性不提示 declare-styleable name要和自定义类名相同，然后重启Ide就好了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- 那么获取到的<span class="keyword">mode</span>和size又代表了什么呢？ </span><br><span class="line">  <span class="keyword">mode</span>代表了我们当前控件的父控件告诉我们控件，你应该按怎样的方式来布局。 </span><br><span class="line">  <span class="keyword">mode</span>有三个可选值：EXACTLY, AT_MOST, UNSPECIFIED。它们的含义是：</span><br><span class="line"></span><br><span class="line">  EXACTLY：父控件告诉我们子控件了一个确定的大小，你就按这个大小来布局。比如我们指定了确定的<span class="keyword">dp</span>值和macth_parent的情况。 </span><br><span class="line">  AT_MOST：当前控件不能超过一个固定的最大值，一般是wrap_content的情况。 UNSPECIFIED:当前控件没有限制，要多大就有多大，这种情况很少出现。</span><br><span class="line"></span><br><span class="line">  - 下面是一个重写onMeasure的固定伪代码写法：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>  if mode is EXACTLY{<br>       父布局已经告诉了我们当前布局应该是多大的宽高, 所以我们直接返回从measureSpec中获取到的size<br>  }else{<br>       计算出希望的desiredSize<br>       if mode is AT_MOST<br>            返回desireSize和specSize当中的最小值<br>       else:<br>            返回计算出的desireSize<br>     }<br>  <figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  原文：https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/yissan/</span>article<span class="regexp">/details/</span><span class="number">51136088</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">##### 自定义属性不提示 </span></span><br><span class="line"></span><br><span class="line">  按照如图两名称一致，重启AndroidStudio</span><br><span class="line"></span><br><span class="line">![customview_2018-<span class="number">05</span>-<span class="number">17</span>_01](View_Practice/customview_2018-<span class="number">05</span>-<span class="number">17</span>_01.png)</span><br><span class="line"></span><br><span class="line">![customview_2018-<span class="number">05</span>-<span class="number">17</span>_02](View_Practice\customview_2018-<span class="number">05</span>-<span class="number">17</span>_02.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/skysmile_/</span>article<span class="regexp">/details/</span><span class="number">78833438</span></span><br><span class="line"></span><br><span class="line"> https:<span class="regexp">//</span>developer.android.com<span class="regexp">/guide/</span>topics<span class="regexp">/ui/</span>custom-components</span><br><span class="line"></span><br><span class="line"> https:<span class="regexp">//</span>developer.android.com<span class="regexp">/training/</span>custom-views/custom-drawing</span><br><span class="line"></span><br><span class="line">绘图</span><br><span class="line">http:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/huaiyiheyuan/</span>article<span class="regexp">/details/</span><span class="number">52205969</span></span><br><span class="line"></span><br><span class="line">画圆</span><br><span class="line">http:<span class="regexp">//</span>www.jianshu.com<span class="regexp">/p/</span>d891fe636898</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##### Scroll 滑动</span></span><br><span class="line"></span><br><span class="line">https:<span class="regexp">//</span>juejin.im<span class="regexp">/post/</span><span class="number">5</span>c7f4f0351882562ed516ab6<span class="comment">#heading-17</span></span><br><span class="line"></span><br><span class="line">https:<span class="regexp">//</span>blog.csdn.net<span class="regexp">/guolin_blog/</span>article<span class="regexp">/details/</span><span class="number">48719871</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### Kotlin</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><br>class TermRoundView @JvmOverloads constructor(<br>        context: Context?, attrs: AttributeSet?,<br>        defStyleAttr: Int = 0<br>) : View(context, attrs, defStyleAttr) {<br>    init{<br>      val a = context?.theme?.obtainStyledAttributes(attrs, R.styleable.TermRoundView, 0, 0)<br>        try {<br>            isRulerInput = a!!.getBoolean(R.styleable.TermRoundView_isRulerInput, false)<br>        } finally {<br>            a?.recycle()<br>        }<br>    }<br>}</p>
<p>```</p>
<p><a href="https://juejin.im/post/6844903909320835080">https://juejin.im/post/6844903909320835080</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
      <tags>
        <tag>VIEW</tag>
      </tags>
  </entry>
  <entry>
    <title>WMS</title>
    <url>/2020/08/09/WMS/</url>
    <content><![CDATA[<p>AMS启动activity</p>
<h5 id="Activity启动流程"><a href="#Activity启动流程" class="headerlink" title="Activity启动流程"></a>Activity启动流程</h5><p><img src="/2020/08/09/WMS/2021-08-09_22-45-activity_start.png"></p>
<p><img src="/2020/08/09/WMS/2021-08-10_11.32_activity.png"></p>
<h5 id="window作用"><a href="#window作用" class="headerlink" title="window作用"></a>window作用</h5><p>单一职责:解藕activity view</p>
<img src="/2020/08/09/WMS/2021-08-09_22-view2.png" style="zoom:100%;">



<p><img src="/2020/08/09/WMS/2021-08-09_22-view.png"></p>
<h5 id="View是生命周期哪个方法绘制"><a href="#View是生命周期哪个方法绘制" class="headerlink" title="View是生命周期哪个方法绘制"></a>View是生命周期哪个方法绘制</h5><ol>
<li><p>window负责管理UI,因为window是在 onCreate()之后产生的，所以view绘制一定在onCreate()之后。</p>
</li>
<li><p> onResume() decorview和Activity进行绑定，所以也是 onCreate()能在子线程刷新UI的原因 ,</p>
</li>
<li><p>接着在 onResume()调用 performMeasure() performLayout(), performDraw()</p>
</li>
</ol>
<p><img src="/2020/08/09/WMS/2021-08-10_11.44_draw.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">textView = findViewById(R.id.tv_thread);</span><br><span class="line"><span class="keyword">new</span> Handler().post(() -&gt; &#123;</span><br><span class="line">    Log.i(<span class="string">&quot;GlideActivity&quot;</span>, <span class="string">&quot;onResume: &quot;</span> + textView.getWidth());</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行结果 </p>
<blockquote>
<p>I/GlideActivity: onResume: 0</p>
</blockquote>
<p>OnResume()也是一个消息，虽然post消息放在后面，但是是因为建立了消息屏障。所以还是先执行，然后获取宽度为0;</p>
<p><a href="https://www.bilibili.com/video/BV1FK4y1R7Nw?from=search&amp;seid=12068296586023469576">https://www.bilibili.com/video/BV1FK4y1R7Nw?from=search&amp;seid=12068296586023469576</a></p>
]]></content>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>WebView</title>
    <url>/2017/09/01/WebView/</url>
    <content><![CDATA[<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><h5 id="加载apk包中的html页面"><a href="#加载apk包中的html页面" class="headerlink" title="加载apk包中的html页面"></a>加载apk包中的html页面</h5><p><code> webView.loadUrl(&quot;file:///android_asset/java.html&quot;);</code></p>
<h5 id="Enabling-JavaScript"><a href="#Enabling-JavaScript" class="headerlink" title="Enabling JavaScript"></a>Enabling JavaScript</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">WebView myWebView = (WebView) find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">webview</span>)</span>;</span><br><span class="line">WebSettings webSettings = myWebView.get<span class="constructor">Settings()</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//支持JavaScript</span></span><br><span class="line"><span class="comment">//        webSettings.setJavaScriptEnabled(true); // 在 onStop 和 onResume 里分别把 setJavaScriptEnabled() 给设置成 false 和 true 即可</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  设置自适应屏幕,两者合用</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        webSettings.set<span class="constructor">UseWideViewPort(<span class="params">true</span>)</span>; <span class="comment">//将图片调整到适合webview的大小</span></span><br><span class="line">        webSettings.set<span class="constructor">LoadWithOverviewMode(<span class="params">true</span>)</span>; <span class="comment">//缩放至屏幕的大小</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 缩放操作</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        webSettings.set<span class="constructor">SupportZoom(<span class="params">true</span>)</span>;  <span class="comment">//支持缩放，默认为true。是下面那个的前提。</span></span><br><span class="line">        webSettings.set<span class="constructor">BuiltInZoomControls(<span class="params">true</span>)</span>; <span class="comment">//设置内置的缩放控件。若为false，则该WebView不可缩放</span></span><br><span class="line">        webSettings.set<span class="constructor">DisplayZoomControls(<span class="params">false</span>)</span>;<span class="comment">//隐藏原生的缩放控件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//        myWebView.setWebChromeClient(new MyWebViewClient());</span></span><br><span class="line">        myWebView.set<span class="constructor">WebViewClient(<span class="params">new</span> MyViewClient()</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面是一些常用的操作</p>
<h5 id="Binding-JavaScript-code-to-Android-code-JS交互"><a href="#Binding-JavaScript-code-to-Android-code-JS交互" class="headerlink" title="Binding JavaScript code to Android code(JS交互)"></a>Binding JavaScript code to Android code(JS交互)</h5><p>When developing a web application that’s designed specifically for the WebView in your Android application, you can create interfaces between your JavaScript code and client-side Android code. For example, your JavaScript code can call a method in your Android code to display a Dialog, instead of using JavaScript’s alert() function.</p>
<p>To bind a new interface between your JavaScript and Android code, call addJavascriptInterface(), passing it a class instance to bind to your JavaScript and an interface name that your JavaScript can call to access the class.</p>
<ul>
<li>office Demo</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">inner <span class="keyword">class</span> <span class="constructor">WebLoginInterface(<span class="params">context</span>: Context?)</span> &#123;</span><br><span class="line">     @JavascriptInterface</span><br><span class="line">     <span class="keyword">fun</span> app<span class="constructor">Login()</span> &#123;</span><br><span class="line">         <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;appLogin&quot;</span>)</span><br><span class="line">             mWebView?.post &#123;</span><br><span class="line">                 <span class="keyword">val</span> mSessionId = <span class="module-access"><span class="module"><span class="identifier">SharedPreferencesUtils</span>.</span></span>get<span class="constructor">Param(AppCtxUtil.<span class="params">getApp</span>()</span>, GsonUtil.SHARE_TOKEN_KEY, <span class="string">&quot;&quot;</span>) <span class="keyword">as</span> String</span><br><span class="line">                 <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;mSessionId $&#123;mSessionId&#125;&quot;</span>)</span><br><span class="line">                 <span class="keyword">val</span> jsMethodName = <span class="string">&quot;javascript:appLoginCallBack(&#x27;$mSessionId&#x27;,&#x27;4&#x27;)&quot;</span>; <span class="comment">//需要参数的JS函数名</span></span><br><span class="line">                 <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;jsMethodName $jsMethodName&quot;</span>)</span><br><span class="line">                 mWebView?.load<span class="constructor">Url(<span class="params">jsMethodName</span>)</span></span><br><span class="line">             &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>注意</p>
<blockquote>
<p>Caution: If you’ve set your targetSdkVersion to 17 or higher, you must add the @JavascriptInterface annotation to any method that you want available to your JavaScript (the method must also be public). If you do not provide the annotation, the method is not accessible by your web page when running on Android 4.2 or higher.</p>
</blockquote>
<p> html小例子</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">&lt;input <span class="keyword">type</span>=<span class="string">&quot;button&quot;</span> value=<span class="string">&quot;Say hello&quot;</span> onClick=<span class="string">&quot;showAndroidToast(&#x27;Hello Android!&#x27;)&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;script <span class="keyword">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    <span class="keyword">function</span> show<span class="constructor">AndroidToast(<span class="params">toast</span>)</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Android</span>.</span></span>show<span class="constructor">Toast(<span class="params">toast</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>


<p>接着加载JS</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">WebView webView = (WebView) find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">webview</span>)</span>;</span><br><span class="line">webView.add<span class="constructor">JavascriptInterface(<span class="params">new</span> WebAppInterface(<span class="params">this</span>)</span>, <span class="string">&quot;Android&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><a href="https://developer.android.com/guide/webapps/webview.html">https://developer.android.com/guide/webapps/webview.html</a><br><a href="http://www.jianshu.com/p/3c94ae673e2a">http://www.jianshu.com/p/3c94ae673e2a</a></p>
<p><a href="http://www.jianshu.com/p/c20513cad758">http://www.jianshu.com/p/c20513cad758</a></p>
<h5 id="缓存方案"><a href="#缓存方案" class="headerlink" title="缓存方案"></a>缓存方案</h5><h5 id="office-原生缓存"><a href="#office-原生缓存" class="headerlink" title="office (原生缓存)"></a>office (原生缓存)</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">	   </span><br><span class="line">WebSettings webSettings = wbNews.get<span class="constructor">Settings()</span>;</span><br><span class="line">   webSettings.set<span class="constructor">JavaScriptEnabled(<span class="params">true</span>)</span>;<span class="comment">// 启用支持javascript</span></span><br><span class="line">   webSettings.set<span class="constructor">CacheMode(WebSettings.LOAD_CACHE_ELSE_NETWORK)</span>;<span class="comment">//缓存模式</span></span><br><span class="line">   webSettings.set<span class="constructor">DomStorageEnabled(<span class="params">true</span>)</span>; <span class="comment">// 开启DOM storage API 功能</span></span><br><span class="line">   <span class="comment">// 开启database storage API功能</span></span><br><span class="line">   webSettings.set<span class="constructor">DatabaseEnabled(<span class="params">true</span>)</span>;</span><br><span class="line">   webSettings.set<span class="constructor">AllowFileAccess(<span class="params">true</span>)</span>;<span class="comment">//可以访问文件</span></span><br><span class="line">   webSettings.set<span class="constructor">BuiltInZoomControls(<span class="params">true</span>)</span>;<span class="comment">//支持缩放</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// 设置数据库缓存路径</span></span><br><span class="line">   String cacheDirPath = get<span class="constructor">FilesDir()</span>.get<span class="constructor">AbsolutePath()</span> + APP_CACHE_DIRNAME;</span><br><span class="line">   webSettings.set<span class="constructor">AppCachePath(<span class="params">cacheDirPath</span>)</span>;</span><br><span class="line">   webSettings.set<span class="constructor">AppCacheEnabled(<span class="params">true</span>)</span>;</span><br></pre></td></tr></table></figure>
<p><a href="http://blog.csdn.net/coder_pig/article/details/48468969">http://blog.csdn.net/coder_pig/article/details/48468969</a></p>
<h5 id="图片替换方式"><a href="#图片替换方式" class="headerlink" title="图片替换方式"></a>图片替换方式</h5><p><a href="https://github.com/GcsSloop/diycode/blob/master/blog/journal-02.md">https://github.com/GcsSloop/diycode/blob/master/blog/journal-02.md</a></p>
<p><a href="https://github.com/yipianfengye/androidProject/blob/master/18%20android%E4%BA%A7%E5%93%81%E7%A0%94%E5%8F%91-webview%E9%97%AE%E9%A2%98%E9%9B%86%E9%94%A6.md">其他常用方式</a><br><a href="https://tech.meituan.com/WebViewPerf.html">美团点评</a><br><a href="https://mp.weixin.qq.com/s/evzDnTsHrAr2b9jcevwBzA">腾讯</a></p>
<p><a href="https://juejin.im/post/5a94f9d15188257a63113a74">https://juejin.im/post/5a94f9d15188257a63113a74</a></p>
<h5 id="页面白屏"><a href="#页面白屏" class="headerlink" title="页面白屏"></a>页面白屏</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">webSettings.set<span class="constructor">DomStorageEnabled(<span class="params">true</span>)</span>; <span class="comment">// 开启DOM storage API 功能</span></span><br></pre></td></tr></table></figure>

<p>​      </p>
<p><a href="https://blog.csdn.net/ONLYMETAGAIN/article/details/78390643">https://blog.csdn.net/ONLYMETAGAIN/article/details/78390643</a></p>
<p><a href="https://iluhcm.com/2017/12/10/design-an-elegant-and-powerful-android-webview-part-one/">https://iluhcm.com/2017/12/10/design-an-elegant-and-powerful-android-webview-part-one/</a></p>
<ul>
<li><p>不显示图片的问题</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">webSettings</span><span class="selector-class">.setBlockNetworkImage</span>(false);</span><br><span class="line"><span class="selector-tag">if</span> (Build.VERSION.SDK_INT&gt;=Build.VERSION_CODES.LOLLIPOP)&#123;</span><br><span class="line">    <span class="selector-tag">webSettings</span><span class="selector-class">.setMixedContentMode</span>(WebSettings.MIXED_CONTENT_ALWAYS_ALLOW);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是我的还是不显示</p>
</li>
</ul>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">android:</span>hardwareAccelerated=<span class="string">&quot;false&quot;</span></span><br></pre></td></tr></table></figure>



<p>WebView缓存功能</p>
<p><a href="https://github.com/yale8848/CacheWebView">https://github.com/yale8848/CacheWebView</a></p>
<p><a href="http://blog.leanote.com/post/zbyzhlsp/%E6%BC%AB%E8%B0%88Android-Webview%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E5%9C%BA%E6%99%AF%E4%B8%8E%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">http://blog.leanote.com/post/zbyzhlsp/%E6%BC%AB%E8%B0%88Android-Webview%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E5%9C%BA%E6%99%AF%E4%B8%8E%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95</a></p>
<p><a href="https://www.zybuluo.com/zyl06/note/737188">https://www.zybuluo.com/zyl06/note/737188</a></p>
<p><a href="https://juejin.im/post/5b94ca52e51d450e7d097f38">https://juejin.im/post/5b94ca52e51d450e7d097f38</a></p>
<p><strong>2、缓存模式(5种)</strong></p>
<p><strong>LOAD_CACHE_ONLY:</strong>  不使用网络，只读取本地缓存数据</p>
<p><strong>LOAD_DEFAULT:</strong>  根据cache-control决定是否从网络上取数据。</p>
<p><strong>LOAD_CACHE_NORMAL: API level 17</strong>中已经废弃, 从<strong>API level 11</strong>开始作用同LOAD_DEFAULT模式</p>
<p><strong>LOAD_NO_CACHE:</strong> 不使用缓存，只从网络获取数据.</p>
<p><strong>LOAD_CACHE_ELSE_NETWORK</strong>，只要本地有，无论是否过期，或者no-cache，都使用缓存中的数据。<br>如：<a href="http://www.taobao.com的cache-control为no-cache,在模式load_default下,无论如何都会从网络上取数据,如果没有网络,就会出现错误页面;在load_cache_else_network模式下,无论是否有网络,只要本地有缓存,都使用缓存.本地没有缓存时才从网络上获取./">www.taobao.com的cache-control为no-cache，在模式LOAD_DEFAULT下，无论如何都会从网络上取数据，如果没有网络，就会出现错误页面；在LOAD_CACHE_ELSE_NETWORK模式下，无论是否有网络，只要本地有缓存，都使用缓存。本地没有缓存时才从网络上获取。</a><br><a href="http://www.360.com.cn的cache-control为max-age=60,在两种模式下都使用本地缓存数据./">www.360.com.cn的cache-control为max-age=60，在两种模式下都使用本地缓存数据。</a></p>
<p><a href="https://juejin.im/entry/5ad70987f265da239148a614">https://juejin.im/entry/5ad70987f265da239148a614</a></p>
<p>zip离线缓存</p>
<p><a href="https://mp.weixin.qq.com/s/AV2SwFfwwJH7xyrIBJemgw">https://mp.weixin.qq.com/s/AV2SwFfwwJH7xyrIBJemgw</a></p>
<h4 id="安全问题"><a href="#安全问题" class="headerlink" title="安全问题"></a>安全问题</h4><p>WebView漏洞的根源在于强制其访问攻击者控制的网页。网页中含有攻击者可以控制的JS,因此可能钓鱼，窃取私有文件，甚至是 RCE,带来比较大的危害。</p>
<p>下面主要是4.4系统以上的机型</p>
<h5 id="Webview密码明文存储漏洞"><a href="#Webview密码明文存储漏洞" class="headerlink" title="Webview密码明文存储漏洞"></a>Webview密码明文存储漏洞</h5><p>WebView默认开启密码保存功能mWebView.setSavePassword(true),如果未关闭，用户输入密码时，会弹出提示框，询问用户是否保存密码，如果选是，密码会明文保存到 /data/data/com.package.name/databases/webview.db</p>
<h5 id="WebView域控制不严格漏洞"><a href="#WebView域控制不严格漏洞" class="headerlink" title="WebView域控制不严格漏洞"></a>WebView域控制不严格漏洞</h5><p>setAllowFileAccess(true) : 窃取APP任意目录下的私有文件</p>
<p>setAllowUniversalAccessFromFileURLs : 允许通过file域url中的 javascript访问其他的源。</p>
<p>方案</p>
<ol>
<li><p>通过以下设置，防止越权访问，跨域等安全问题</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setAllowFileAccess(<span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line">setAllowFileAccessFromFileURLs(<span class="keyword">false</span>)</span><br><span class="line"></span><br><span class="line">setAllowUniversalAccessFromFileURLs(<span class="keyword">false</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>WebSettings.setSavePassword(false)</p>
<p>关闭密码保存提醒功能</p>
</li>
<li><p>建议开发者通过以下方式移除该JavaScript接口</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">removeJavascriptInterface(<span class="string">&quot;searchBoxJavaBridge_&quot;</span>)</span><br><span class="line"></span><br><span class="line">removeJavascriptInterface(<span class="string">&quot;accessibility&quot;</span>)；</span><br><span class="line"></span><br><span class="line">removeJavascriptInterface(<span class="string">&quot;accessibilityTraversal&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<p><a href="https://zhuanlan.zhihu.com/p/21787366">https://zhuanlan.zhihu.com/p/21787366</a></p>
<p><a href="https://zhuanlan.kanxue.com/article-14155.htm">https://zhuanlan.kanxue.com/article-14155.htm</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Zigbee</title>
    <url>/2018/06/20/Zigbee/</url>
    <content><![CDATA[<p><a href="https://blog.csdn.net/qq_34581118/article/details/78452316">https://blog.csdn.net/qq_34581118/article/details/78452316</a></p>
<p>0000 0101<br>0001 0000</p>
<p>0001 0101   = 1 * 2^4+ 1*2^2 + 1 = 21  =  0X15<img src="/2018/06/20/Zigbee/Zigbee%5CZigbee_20180620172017.png" alt="Zigbee_20180620172017"></p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">01</span> <span class="number">02</span> <span class="number">10</span> <span class="number">11</span> <span class="number">02</span> <span class="number">10</span> <span class="number">02</span> <span class="number">10</span> <span class="number">11</span> <span class="number">03</span></span><br><span class="line">	  <span class="attribute">10</span>       <span class="number">10</span>    <span class="number">10</span> <span class="number">10</span> </span><br><span class="line"><span class="attribute">01</span>    <span class="number">00</span>  <span class="number">11</span>    <span class="number">00</span>   <span class="number">00</span>  <span class="number">11</span> <span class="number">03</span></span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/feiyangxiaomi/article/details/9257375">https://blog.csdn.net/feiyangxiaomi/article/details/9257375</a></p>
<p><a href="https://juejin.im/post/5b124346e51d450684732790">https://juejin.im/post/5b124346e51d450684732790</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>annotation</title>
    <url>/2020/04/25/annotation/</url>
    <content><![CDATA[<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><h4 id="注解的作用"><a href="#注解的作用" class="headerlink" title="注解的作用"></a>注解的作用</h4><p><img src="/2020/04/25/annotation/2021-07-29_9.08.16_function.png"></p>
<p><a href="https://blog.csdn.net/briblue/article/details/73824058">https://blog.csdn.net/briblue/article/details/73824058</a></p>
<ul>
<li>提供信息给编译器： 编译器可以利用注解来探测错误和警告信息</li>
<li>编译阶段时的处理：  软件工具可以用来利用注解信息来生成代码、Html文档或者做其它相应处理。</li>
<li>运行时的处理：  某些注解可以在程序运行的时候接受代码的提取</li>
</ul>
<p>元注解 ： 不可以再分的注解， 负责注解其他注解。java定义了4个标准的meta-annotation类型,它们被用来提供对其它annotation类型作说明。Target Retention Documented Inherited</p>
<p>​                如上图的 Overide被@Target和@Retention修饰，他们用来说明解释其他注解，位于 java.lang.annotation下</p>
<h4 id="元注解类型"><a href="#元注解类型" class="headerlink" title="元注解类型"></a>元注解类型</h4><h5 id="Target"><a href="#Target" class="headerlink" title="Target"></a>Target</h5><p>用于描述注解的使用范围(注解可以用在什么地方)</p>
<p>如 类 属性 方法等</p>
<p><img src="/2020/04/25/annotation/2021-06-28_21-32-34_target.png"></p>
<h5 id="Retention"><a href="#Retention" class="headerlink" title="Retention"></a>Retention</h5><p>需要什么级别保存该注释信息，用于保留注解的生命周期</p>
<p><img src="/2020/04/25/annotation/2021-06-28_21-36-57_retention.png"></p>
<h5 id="Inherited"><a href="#Inherited" class="headerlink" title="@Inherited"></a>@Inherited</h5><p>标明所修饰的注解，在所作用的类上，是否可以被继承。</p>
<h5 id="Documented"><a href="#Documented" class="headerlink" title="@Documented"></a>@Documented</h5><p>javadoc的工具文档化</p>
<h4 id="注解使用"><a href="#注解使用" class="headerlink" title="注解使用"></a>注解使用</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Sxt&#123;</span><br><span class="line"> 	<span class="function">String <span class="title">studentName</span><span class="params">()</span></span>;  <span class="comment">// studentName 参数名， String参数类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注解元素必须要有值，我们定义注解元素时，经常使用空字符串，0作为默认值。</p>
<p>也经常使用负数(比如:-1)表示不存在的含义</p>
<p>annotation01</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(value = &#123;ElementType.METHOD,ElementType.TYPE&#125;)</span> <span class="comment">//针对方法 和类有效</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span>	<span class="comment">// 针对运行时有效</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Annotation01 &#123;</span><br><span class="line">    <span class="function">String <span class="title">studentName</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">age</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">id</span><span class="params">()</span> <span class="keyword">default</span> -1</span>; <span class="comment">// String indexOf(&quot;abc&quot;) -1</span></span><br><span class="line"></span><br><span class="line">    String[] schools() <span class="keyword">default</span> &#123;<span class="string">&quot;清华大学&quot;</span>,<span class="string">&quot;哈工大&quot;</span>&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Annotation02</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(value = &#123;ElementType.METHOD,ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Annotation02 &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果只有一个参数，一般写成value</p>
<p>Demo01</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Annotation01</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo02</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Annotation01(age = 19, studentName = &quot;老高&quot;,</span></span><br><span class="line"><span class="meta">            id = 1001, schools = &#123;&quot;哈工大&quot;, &quot;清华大学&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Annotation02(value = &quot;aaaa&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test01</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Annotation02(&quot;aaaa&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test02</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用注解,参照 test01(),也可以省略”value=” 参见test02()</p>
<h5 id="注解实例"><a href="#注解实例" class="headerlink" title="注解实例"></a>注解实例</h5><p>注解设置 SxtStudent信息，映射数据库</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(value = &#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SxtTable &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Target(value = &#123;ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SxtField &#123;</span><br><span class="line">    <span class="function">String <span class="title">columnName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">type</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">length</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SxtTable(&quot;tb_student&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SxtStudent</span> </span>&#123;</span><br><span class="line">    <span class="meta">@SxtField(columnName = &quot;id&quot;,type = &quot;int&quot;,length = 10)</span></span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SxtField(columnName = &quot;sname&quot;,type = &quot;varchar&quot;,length = 10)</span></span><br><span class="line">    <span class="keyword">private</span> String studentName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SxtField(columnName = &quot;age&quot;,type = &quot;int&quot;,length = 3)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过第三方工具获取注解信息</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class clazz = Class.forName(<span class="string">&quot;annotation.SxtStudent&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获得类的所有有效注解</span></span><br><span class="line">    Annotation[] annotations = clazz.getAnnotations();</span><br><span class="line">    <span class="keyword">for</span> (Annotation a:annotations)&#123;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//获得类的指定注解</span></span><br><span class="line">    SxtTable st = (SxtTable)clazz.getAnnotation(SxtTable.class);</span><br><span class="line">    System.out.println(st.value());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获得类的属性的注解</span></span><br><span class="line">    Field f = clazz.getDeclaredField(<span class="string">&quot;studentName&quot;</span>);</span><br><span class="line">    SxtField sxtField = f.getAnnotation(SxtField.class);</span><br><span class="line">    System.out.println(sxtField.columnName()+<span class="string">&quot;--&quot;</span> + sxtField.type()+<span class="string">&quot;---&quot;</span> + sxtField.length());</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行结果</p>
<blockquote>
<p>@annotation.SxtTable(value=tb_student)<br>tb_student<br>sname–varchar—10</p>
</blockquote>
<h5 id="反射实例"><a href="#反射实例" class="headerlink" title="反射实例"></a>反射实例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String path = <span class="string">&quot;reflection.User&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class&lt;?&gt; clazz = Class.forName(path);</span><br><span class="line">    <span class="comment">//对象是表示或封装一些数据。一个类被加载后，JVM会创建一个对应该类的Class对象，类的整个结构信息会放到对应的CLass对象中。</span></span><br><span class="line">    <span class="comment">//这个Class对象就像一面镜子一样，通过这面镜子我可已看到对应类的全部信息。</span></span><br><span class="line">    System.out.println(clazz.hashCode());</span><br><span class="line"></span><br><span class="line">    Class clazz2 = Class.forName(path); <span class="comment">// 一个类对应的一个class对象</span></span><br><span class="line">    System.out.println(clazz2.hashCode());</span><br><span class="line"></span><br><span class="line">    Class intCLazz = <span class="keyword">int</span>.class;</span><br><span class="line">    <span class="keyword">int</span>[] arr01 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span>[][] arr02 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">30</span>][<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">int</span>[]arr03 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">double</span>[] arr04 = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">10</span>];</span><br><span class="line"></span><br><span class="line">    System.out.println(arr01.getClass().hashCode());</span><br><span class="line">    System.out.println(arr02.getClass().hashCode());</span><br><span class="line">    System.out.println(arr03.getClass().hashCode());</span><br><span class="line">    System.out.println(arr04.getClass().hashCode());</span><br></pre></td></tr></table></figure>





<p><a href="https://www.youtube.com/watch?v=vZe5zG0vh3U&amp;list=PLC664nq_h8b9Jzh-qYJ_AeOpmSoBLC_tg&amp;index=1">https://www.youtube.com/watch?v=vZe5zG0vh3U&amp;list=PLC664nq_h8b9Jzh-qYJ_AeOpmSoBLC_tg&amp;index=1</a></p>
<h3 id="注解处理器"><a href="#注解处理器" class="headerlink" title="注解处理器"></a>注解处理器</h3><p>是javac处理注解的一种工具，它用来在编译时扫描和处理注解。简单来说就是在编译器，通过注解采集信息，生成.java文件。减少重复代码的编写。</p>
<h5 id="APT原理"><a href="#APT原理" class="headerlink" title="APT原理"></a>APT原理</h5><p><img src="/2020/04/25/annotation/2021-07-29_2.39.54_apt.png"></p>
<p><img src="/2020/04/25/annotation/2021-07-29_2.10_process.png"></p>
<h5 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h5><p><img src="/2020/04/25/annotation/2021-07-29_2.10.48_step.png"></p>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><p>APT就这固定的几步，网上demo可以生成，我的就是没法生成，原来是因为,@DIActivity类的头部没有设置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@DIActivity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目 MRouter</p>
<h4 id="Arouter"><a href="#Arouter" class="headerlink" title="Arouter"></a>Arouter</h4><h5 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h5><p>获得当前程序在手机中对应的apk文件,使用classsloader:dexfile(PMS)，反射获取apk所有的类，筛选出注册activity的类。初始化</p>
<h5 id="核心实现"><a href="#核心实现" class="headerlink" title="核心实现"></a>核心实现</h5><p><img src="/2020/04/25/annotation/2021-08-12_1.18_arouter.png"></p>
<p><a href="https://www.bilibili.com/video/BV1uV411n787?p=6&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1uV411n787?p=6&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.bilibili.com/video/BV1Ly4y1W7f5?p=6&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Ly4y1W7f5?p=6&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://www.bilibili.com/video/BV1nU4y1a79o?from=search&amp;seid=3188418579827888379">https://www.bilibili.com/video/BV1nU4y1a79o?from=search&amp;seid=3188418579827888379</a></p>
<p><a href="https://juejin.cn/post/6925283352698159117#heading-14">https://juejin.cn/post/6925283352698159117#heading-14</a></p>
<p><a href="https://juejin.cn/post/6947992544252788767">https://juejin.cn/post/6947992544252788767</a></p>
<p><a href="https://blog.csdn.net/xx326664162/article/details/68490059">https://blog.csdn.net/xx326664162/article/details/68490059</a></p>
<p><a href="https://hanshuliang.blog.csdn.net/article/details/117072224">https://hanshuliang.blog.csdn.net/article/details/117072224</a></p>
<p><a href="https://github.com/han1202012/APT">https://github.com/han1202012/APT</a></p>
<h4 id="反射机制"><a href="#反射机制" class="headerlink" title="反射机制"></a>反射机制</h4><p>Java反射机制是在运行状态中，对于任意一个类，都能够知道这个类的所有属性和方法；对于任意一个对象都能够调用它的任意一个方法；这种动态获取的信息以及动态调用对象的方法的功能称为java的反射机制。</p>
<h5 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflection;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodReflect</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">addResult</span><span class="params">(<span class="keyword">int</span> addNum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> addNum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用反射第一步:获取操作类MethodDemoFieldDemo所对应的Class对象</span></span><br><span class="line">Class &lt; ?&gt;cls = Class.forName(<span class="string">&quot;reflection.MethodReflect&quot;</span>);</span><br><span class="line"><span class="comment">//使用MethodDemo类的class对象生成 实例</span></span><br><span class="line">Object obj = cls.newInstance();</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取public int addResult(int addNum)方法</span></span><br><span class="line">Method addMethod = cls.getMethod(<span class="string">&quot;addResult&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">        <span class="keyword">int</span>.class</span><br><span class="line">&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;修饰符: &quot;</span> + Modifier.toString(addMethod.getModifiers()));</span><br><span class="line">System.out.println(<span class="string">&quot;返回值: &quot;</span> + addMethod.getReturnType());</span><br><span class="line">System.out.println(<span class="string">&quot;方法名称: &quot;</span> + addMethod.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;参数列表: &quot;</span> + addMethod.getParameterTypes());</span><br><span class="line"><span class="keyword">int</span> result = (<span class="keyword">int</span>) addMethod.invoke(obj, <span class="number">2</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;调用addResult后的运行结果:&quot;</span> + result);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;--------------------------------&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取public String toString() 方法</span></span><br><span class="line">Method toStringMethod = cls.getMethod(<span class="string">&quot;toString&quot;</span>, <span class="keyword">new</span> Class[] &#123;&#125;);</span><br><span class="line">System.out.println(<span class="string">&quot;修饰符: &quot;</span> + Modifier.toString(toStringMethod.getModifiers()));</span><br><span class="line">System.out.println(<span class="string">&quot;返回值: &quot;</span> + toStringMethod.getReturnType());</span><br><span class="line">System.out.println(<span class="string">&quot;方法名称: &quot;</span> + toStringMethod.getName());</span><br><span class="line">System.out.println(<span class="string">&quot;参数列表: &quot;</span> + toStringMethod.getParameterTypes());</span><br><span class="line">String msg = (String) toStringMethod.invoke(obj);</span><br><span class="line">System.out.println(<span class="string">&quot;调用toString后的运行结果:&quot;</span> + msg);</span><br></pre></td></tr></table></figure>



<p>Method类的invoke(Object obj,Object  args[])方法接收的参数必须为对象,如果参数为基本类型数据,必须转换为相应的包装类型的对象。invoke()方法的返回值总是对象,如果实际被调用的方法的返回类型是基本类型数据,那么invoke()方法会把它转换为相应的包装类型的对象,再将其返回.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokeTester</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">InvokeTester</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> param1, <span class="keyword">int</span> param2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> param1 + param2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">echo</span><span class="params">(String mesg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;echo&quot;</span> + mesg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Class classType = InvokeTester.class;</span><br><span class="line">        Object invokertester = classType.newInstance(); <span class="comment">//1</span></span><br><span class="line">        Method addMethod = classType.getMethod(<span class="string">&quot;add&quot;</span>, <span class="keyword">new</span> Class[]&#123; <span class="comment">//2</span></span><br><span class="line">                <span class="keyword">int</span>.class,</span><br><span class="line">                <span class="keyword">int</span>.class</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Object result = addMethod.invoke(invokertester, <span class="keyword">new</span> Object[]&#123; <span class="comment">//3</span></span><br><span class="line">                <span class="keyword">new</span> Integer(<span class="number">100</span>),</span><br><span class="line">                <span class="keyword">new</span> Integer(<span class="number">200</span>)</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(result);</span><br><span class="line">        Method echo = classType.getMethod(<span class="string">&quot;echo&quot;</span>, <span class="keyword">new</span> Class[]&#123;</span><br><span class="line">                String.class</span><br><span class="line">        &#125;);</span><br><span class="line">        Object obj = echo.invoke(invokertester, <span class="keyword">new</span> Object[]&#123;</span><br><span class="line">                <span class="keyword">new</span> String(<span class="string">&quot;Jon is very good!!!&quot;</span>)</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(obj.toString());</span><br><span class="line"></span><br><span class="line">        InvokeTester test = <span class="keyword">new</span> InvokeTester(); <span class="comment">//1</span></span><br><span class="line">        test.setName(<span class="string">&quot;黄翊&quot;</span>); <span class="comment">//2</span></span><br><span class="line">        <span class="comment">//Method[] methods;</span></span><br><span class="line">        Method[] methods = test.getClass().getDeclaredMethods(); <span class="comment">//3</span></span><br><span class="line">        <span class="comment">//循环查找获取id方法，并执行查看是否有返回值</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; methods.length; i++) &#123;</span><br><span class="line">            <span class="comment">//如果此方法有get和Id关键字则执行</span></span><br><span class="line">            <span class="keyword">if</span> (methods[i].getName().indexOf(<span class="string">&quot;get&quot;</span>) != -<span class="number">1</span> &amp;&amp; methods[i].getName().indexOf(<span class="string">&quot;Name&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">// 获取此get方法返回值,判断是否有值,如果没有值说明即将执行的操作新增</span></span><br><span class="line">                <span class="keyword">if</span> (methods[i].invoke(test, <span class="keyword">null</span>) == <span class="keyword">null</span>) &#123; <span class="comment">//4</span></span><br><span class="line">                    System.out.println(<span class="string">&quot;此对象没有值！！！&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Object strName = methods[i].invoke(test, <span class="keyword">null</span>);</span><br><span class="line">                    System.out.println(strName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="invoke方法的使用"><a href="#invoke方法的使用" class="headerlink" title="invoke方法的使用"></a>invoke方法的使用</h5><p>实际上invoke方法的使用，和我们常见的有所区别。</p>
<p>我们经常创建一个对象A，A对象里面的方法getA()方法，然后A.getA()</p>
<p>我们采用新的方式调用<br>（1）弄一个方法的“替身”（其实就是构建一个Method对象，让这个Method对象来代替你现在要用的方法）<br>（2）然后给替身需要的对象和参数，让替身去替你调用（像替身替你去战斗）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InvokeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(String[] arg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (String string : arg) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;zp is &quot;</span> + string);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeDemo</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//获取字节码对象,这里要填好你对应对象的包的路径</span></span><br><span class="line">        Class&lt;InvokeTest&gt; clazz = (Class&lt;InvokeTest&gt;) Class.forName(<span class="string">&quot;reflection.InvokeTest&quot;</span>);</span><br><span class="line">        <span class="comment">//形式一：获取一个对象</span></span><br><span class="line"><span class="comment">//        Constructor con =  clazz.getConstructor();</span></span><br><span class="line"><span class="comment">//        InvokeTest m = (InvokeTest) con.newInstance();</span></span><br><span class="line">        <span class="comment">//形式二：直接new对象，实际上不是框架的话，自己写代码直接指定某个对象创建并调用也可以</span></span><br><span class="line">        InvokeTest m = <span class="keyword">new</span> InvokeTest();</span><br><span class="line">        String[] s = <span class="keyword">new</span> String[]&#123;<span class="string">&quot;handsome&quot;</span>,<span class="string">&quot;smart&quot;</span>&#125;;</span><br><span class="line">        <span class="comment">//获取Method对象</span></span><br><span class="line">        Method method = clazz.getMethod(<span class="string">&quot;test&quot;</span>, String[].class); <span class="comment">//invoke方法要比别的方法多做一步</span></span><br><span class="line">        <span class="comment">//调用invoke方法来调用</span></span><br><span class="line">        method.invoke(m, (Object) s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<blockquote>
<p>zp is handsome<br>zp is smart</p>
</blockquote>
<p>所以使用invoke方法要比别的方法多做一步，就是构建一个Method对象，这个对象替代的是现在程序要调用方法的替代品。</p>
<p>而且除了参数以外，invoke还会多要一个对象，因为方法调用需要对象，所以invoke要想调用的目标方法，就需要目标方法的需要的对象。</p>
<p>看起来invoke方法不仅比平常方法直接调用要麻烦很多，但是你有想过吗，我只需要输入参数，我可以调用替代各种方法，在未知的情况下，根据条件决定去调用什么对象，什么方法，一下子就让代码变得灵活，这不仅是invoke的妙处，也是整个反射的妙处，在程序运行时根据条件灵活使用。</p>
<p><a href="https://zhuanlan.zhihu.com/p/350058223">https://zhuanlan.zhihu.com/p/350058223</a></p>
<h5 id="Method信息"><a href="#Method信息" class="headerlink" title="Method信息"></a>Method信息</h5><p>我们已经能通过<code>Class</code>实例获取所有<code>Field</code>对象，同样的，可以通过<code>Class</code>实例获取所有<code>Method</code>信息。<code>Class</code>类提供了以下几个方法来获取<code>Method</code>：</p>
<ul>
<li><code>Method getMethod(name, Class...)</code>：获取某个<code>public</code>的<code>Method</code>（包括父类）</li>
<li><code>Method getDeclaredMethod(name, Class...)</code>：获取当前类的某个<code>Method</code>（不包括父类）</li>
<li><code>Method[] getMethods()</code>：获取所有<code>public</code>的<code>Method</code>（包括父类）</li>
<li><code>Method[] getDeclaredMethods()</code>：获取当前类的所有<code>Method</code>（不包括父类）</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">99</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getGrade</span><span class="params">(<span class="keyword">int</span> year)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    @Override</span></span><br><span class="line"><span class="comment">//    public void hello() &#123;</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;Student:hello&quot;);</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Person:hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;Student&gt; methodClass = Student.class;</span><br><span class="line">Arrays.stream(methodClass.getMethods()).forEach(method -&gt; System.out.println(<span class="string">&quot;method方法:    &quot;</span> + method));</span><br></pre></td></tr></table></figure>

<p>打印出</p>
<blockquote>
<p>method方法:    public int reflection.liao.Student.getScore(java.lang.String)<br>method方法:    public void reflection.liao.Person.hello()<br>method方法:    public java.lang.String reflection.liao.Person.getName()</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;Person&gt; methodClass = Person.class;</span><br><span class="line">Arrays.stream(methodClass.getMethods()).forEach(method -&gt; System.out.println(<span class="string">&quot;method方法:    &quot;</span> + method));</span><br></pre></td></tr></table></figure>

<p>打印出</p>
<blockquote>
<p>method方法:    public void reflection.liao.Person.hello()<br>method方法:    public java.lang.String reflection.liao.Person.getName()</p>
<p>…object方法</p>
</blockquote>
<ol>
<li><p>getMethods()可以 获取所有<code>public</code>的<code>Method</code>（包括父类），</p>
</li>
<li><p>不能获取到子类的方法,除非是是多肽实现</p>
</li>
</ol>
<h5 id="getDeclaredMethod获取的Method能否调用子类"><a href="#getDeclaredMethod获取的Method能否调用子类" class="headerlink" title="getDeclaredMethod获取的Method能否调用子类?"></a>getDeclaredMethod获取的Method能否调用子类?</h5><p>父类class通过getDeclaredMethod获取的Method能否调用子类的对象</p>
<p>验证是不可以</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clz = Class.forName(<span class="string">&quot;reflection.liao.Person&quot;</span>);</span><br><span class="line">Object o = clz.newInstance();</span><br><span class="line">Method methodGetName = clz.getMethod(<span class="string">&quot;getName&quot;</span>);</span><br><span class="line">Object noParams = methodGetName.invoke(o);</span><br><span class="line">System.out.println(noParams);</span><br><span class="line"></span><br><span class="line">Method methodHello  = clz.getMethod(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">System.out.println(methodHello.invoke(o));</span><br><span class="line"></span><br><span class="line">Method methodGetGrade = clz.getMethod(<span class="string">&quot;getGrade&quot;</span>);</span><br><span class="line">System.out.println(methodGetGrade.invoke(o));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>A Person<br>Person:hello<br>null        // 这个null是哪里来的</p>
</blockquote>
<p>提示</p>
<p>java.lang.NoSuchMethodException: reflection.liao.Person.getGrade()</p>
<p>所以是调用不了的。</p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1264803678201760">https://www.liaoxuefeng.com/wiki/1252599548343744/1264803678201760</a></p>
<p><a href="http://www.51gjie.com/java/796.html">http://www.51gjie.com/java/796.html</a></p>
<p><a href="https://www.cnblogs.com/onlywujun/p/3519037.html">https://www.cnblogs.com/onlywujun/p/3519037.html</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>background_draw (背景图形绘制)</title>
    <url>/2017/11/03/background_draw/</url>
    <content><![CDATA[<p> ** 为了提高App性能，经常会用到代码写背景 **</p>
<h4 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h4><ul>
<li><p>solid : 　填充内容</p>
</li>
<li><p>stroke:   绘制边框</p>
<p>代码里设置颜色  <code>Color.parseColor(&quot;#fa6d62&quot;)</code></p>
</li>
</ul>
<h5 id="点击选中状态"><a href="#点击选中状态" class="headerlink" title="点击选中状态"></a>点击选中状态</h5><ul>
<li>android:state_pressed 是否按下，如一个按钮触摸或者点击。</li>
<li>android:state_focused 是否取得焦点，比如用户选择了一个文本框。</li>
<li> android:state_hovered 光标是否悬停，通常与focused state相同，它是4.0的新特性 </li>
<li>android:state_selected 被选中，它与focus state并不完全一样，如一个list view 被选中的时候，它里面的各个子组件可能通过方向键，被选中了。 </li>
<li>android:state_checkable 组件是否能被check。如：RadioButton是可以被check的。 android:state_checked 被checked了，如：一个RadioButton可以被check了。</li>
<li> android:state_enabled 能够接受触摸或者点击事件 android:state_activated 被激活(这个麻烦举个例子，不是特明白) android:state_window_focused 应用程序是否在前台，当有通知栏被拉下来或者一个对话框弹出的时候应用程序就不在前台了 </li>
</ul>
<p>注意:如果有多个item，那么程序将自动从上到下进行匹配，最先匹配的将得到应用。（不是通过最佳匹配） 如果一个item没有任何的状态说明，那么它将可以被任何一个状态匹配。 </p>
<p><a href="https://blog.csdn.net/yinbucheng/article/details/52922759">https://blog.csdn.net/yinbucheng/article/details/52922759</a></p>
<p>seleced用于单选，checked用于多选,</p>
<p>selected是选择很多项，但是只取当前的项，即最后一个选中的</p>
<p>checked是选中很多项，都选中。</p>
<h1 id="shape-layer-list-selector"><a href="#shape-layer-list-selector" class="headerlink" title="shape  layer-list    selector"></a>shape  layer-list    selector</h1><h5 id="设置Button按钮背景"><a href="#设置Button按钮背景" class="headerlink" title="设置Button按钮背景"></a>设置Button按钮背景</h5><p><img src="/2017/11/03/background_draw/bg_login.png" alt="登录背景"></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;20dp&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 边框的颜色--&gt;</span></span><br><span class="line">    &lt;stroke</span><br><span class="line">        android:width=&quot;2dp&quot;</span><br><span class="line">        android:color=&quot;#009cff&quot; /&gt;</span><br><span class="line">    <span class="comment">&lt;!--填充的颜色 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@android:color/transparent&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="shape"><a href="#shape" class="headerlink" title="shape"></a>shape</h5><pre><code>    &lt;shape android:shape=&quot;rectangle&quot;&gt; 
        &lt;solid android:color=&quot;#2e97f3&quot; /&gt;       //填充颜色
        &lt;stroke
            android:width=&quot;2dp&quot;                 //描边宽度
            android:color=&quot;#2e97f3&quot; /&gt;          //描边颜色
    &lt;/shape&gt;
</code></pre>
<h5 id="layer-list"><a href="#layer-list" class="headerlink" title="layer-list"></a>layer-list</h5><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
 &lt;item&gt;
    &lt;shape android:shape=&quot;rectangle&quot;&gt;
        &lt;solid android:color=&quot;#2e97f3&quot; /&gt;
        &lt;stroke
            android:width=&quot;2dp&quot;
            android:color=&quot;#2e97f3&quot; /&gt;
    &lt;/shape&gt;
&lt;/item&gt;

&lt;item android:top=&quot;50dp&quot;&gt;
    &lt;shape android:shape=&quot;rectangle&quot;&gt;
        &lt;solid android:color=&quot;@android:color/holo_green_dark&quot; /&gt;
        &lt;padding android:left=&quot;50dp&quot;/&gt;
    &lt;/shape&gt;
&lt;/item&gt;

&lt;item android:top=&quot;100dp&quot;&gt;
    &lt;shape android:shape=&quot;rectangle&quot;&gt;
        &lt;solid android:color=&quot;@android:color/holo_orange_light&quot; /&gt;
    &lt;/shape&gt;
&lt;/item&gt;
&lt;/layer-list&gt;
</code></pre>
<p><img src="/2017/11/03/background_draw/bg_layer.png" alt="图层显示"></p>
<p>LayerDrawable 是管理其他可绘制对象阵列的可绘制对象。列表中的每个可绘制对象按照列表的顺序绘制，列表中的最后一个可绘制对象绘于顶部。每个可绘制对象由单一 元素内的 元素表示。我们需要注意的是layer-list中有item的先后顺序会影响展示效果，不同顺序的效果可能大相径庭，因为，后面的item总是在之前的item之上并覆盖显示。</p>
<h4 id="selector"><a href="#selector" class="headerlink" title="selector"></a>selector</h4><ul>
<li>底部选择器</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">    <span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;#2e97f3&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:bottom</span>=<span class="string">&quot;5dp&quot;</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@color/white&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layer-list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">color</span> <span class="attr">android:color</span>=<span class="string">&quot;#2e97f3&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@color/white&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layer-list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>参考 <a href="https://keeganlee.me/post/android/20150909">https://keeganlee.me/post/android/20150909</a></p>
<ul>
<li>背景选择器</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/bg_circle_tab_yellow&quot;</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/bg_circle_tab_gray&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>字体颜色选择器</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/white&quot;</span> <span class="attr">android:state_selected</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:color</span>=<span class="string">&quot;#999999&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>后面的item在之前的item上显示，所有前面设置的padding,后面叠加形成图层</strong></p>
<p><a href="http://blog.csdn.net/xiehuimx/article/details/70242676">http://blog.csdn.net/xiehuimx/article/details/70242676</a><br><a href="https://developer.android.com/guide/topics/resources/drawable-resource.html#Transition">https://developer.android.com/guide/topics/resources/drawable-resource.html#Transition</a></p>
<h1 id="首页阴影效果"><a href="#首页阴影效果" class="headerlink" title="首页阴影效果"></a>首页阴影效果</h1><h2 id="office"><a href="#office" class="headerlink" title="office"></a>office</h2><p>前端时间一直找这种资料，效果一直不如意，不得已用了图片，真是　踏破铁鞋无觅处<br><a href="https://developer.android.com/training/material/shadows-clipping.html">https://developer.android.com/training/material/shadows-clipping.html</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">	<span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line">    &lt;stroke</span><br><span class="line">        android:width=&quot;1dp&quot;</span><br><span class="line">        android:color=&quot;#f9fafc&quot; /&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">corners</span> <span class="attr">android:radius</span>=<span class="string">&quot;2dp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/white&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p> 不过这种方法还是差强人意</p>
<h2 id="another"><a href="#another" class="headerlink" title="another"></a>another</h2><p>可以试试下面这种方式　<br><a href="http://blog.csdn.net/u011421608/article/details/51923812">http://blog.csdn.net/u011421608/article/details/51923812</a><br><a href="http://yifeng.studio/2017/02/26/android-elevation-and-shadow/">http://yifeng.studio/2017/02/26/android-elevation-and-shadow/</a></p>
<h1 id="画虚线"><a href="#画虚线" class="headerlink" title="画虚线"></a>画虚线</h1><pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
 android:shape=&quot;line&quot;&gt;
&lt;!-- jon  虚线--&gt;
&lt;size android:height=&quot;1dp&quot; /&gt;
&lt;stroke
    android:width=&quot;1dp&quot;
    android:color=&quot;@color/white&quot;
    android:dashGap=&quot;2dp&quot;
    android:dashWidth=&quot;4dp&quot; /&gt;

&lt;!-- dashwidth是指- - -中每一个-的宽度--&gt;
&lt;!-- dashGap是指虚线中每一个间隔的宽度 --&gt;
</code></pre>
   

<ul>
<li>height比height高  关闭硬件加速   android:layerType=”software”</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;View</span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;10dp&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_below</span>=<span class="string">&quot;@+id/rl_time_day&quot;</span></span><br><span class="line">    android:<span class="attribute">background</span>=<span class="string">&quot;@drawable/bg_dash_line&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>参考：<br>  <a href="https://lianyuchen.github.io/2017/05/09/%E5%85%B3%E4%BA%8Eshape%E7%94%BB%E8%99%9A%E7%BA%BF/">https://lianyuchen.github.io/2017/05/09/%E5%85%B3%E4%BA%8Eshape%E7%94%BB%E8%99%9A%E7%BA%BF/</a><br>  <a href="http://www.jianshu.com/p/75cc93195f7a?from=jiantop.com">http://www.jianshu.com/p/75cc93195f7a?from=jiantop.com</a></p>
<p>  <a href="https://keeganlee.me/post/android/20150909">https://keeganlee.me/post/android/20150909</a></p>
<h4 id="LinearLayout默认横线"><a href="#LinearLayout默认横线" class="headerlink" title="LinearLayout默认横线"></a>LinearLayout默认横线</h4><ul>
<li><pre><code>android:divider=&quot;@drawable/shape_line
android:dividerPadding=&quot;@dimen/dimen_15&quot;

<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">* shape_line.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure>
&lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;solid android:color=&quot;@color/line_color&quot; /&gt;
    &lt;size android:height=&quot;0.5dp&quot; /&gt;
&lt;/shape&gt;
</code></pre>
</li>
</ul>
<p><a href="https://blog.csdn.net/BingShuShu/article/details/51444206">https://blog.csdn.net/BingShuShu/article/details/51444206</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
  </entry>
  <entry>
    <title>base64</title>
    <url>/2020/10/22/base64/</url>
    <content><![CDATA[<p><a href="https://www.jianshu.com/p/313b73ee7d6f">https://www.jianshu.com/p/313b73ee7d6f</a></p>
]]></content>
      <categories>
        <category>flutter</category>
      </categories>
  </entry>
  <entry>
    <title>databinding</title>
    <url>/2020/04/01/databinding/</url>
    <content><![CDATA[<p>layout expression of the language</p>
<p><a href="https://codelabs.developers.google.com/codelabs/android-databinding/#0">https://codelabs.developers.google.com/codelabs/android-databinding/#0</a></p>
<p><a href="https://developer.android.com/topic/libraries/data-binding">https://developer.android.com/topic/libraries/data-binding</a></p>
<h4 id="Create-first-layout-expression"><a href="#Create-first-layout-expression" class="headerlink" title="Create first layout expression"></a>Create first layout expression</h4><ol>
<li> when you want to use it in your own projects the first step is to enable the library in the modules that will use it:</li>
</ol>
   <figure class="highlight puppet"><table><tr><td class="code"><pre><span class="line"><span class="keyword">android</span> &#123;</span><br><span class="line">...</span><br><span class="line">    dataBinding &#123;</span><br><span class="line">       <span class="literal">enabled</span> <span class="keyword">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>Convert to data binding layout</p>
<p>打开布局文件，选中根布局的 <strong>ViewGroup</strong>，按住 <strong>option + 回车键</strong>，点击 “<strong>Convert to data binding layout</strong>”，就可以生成 DataBinding 需要的布局规则</p>
</li>
</ol>
<figure class="highlight dust"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">layout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span></span><br><span class="line"><span class="xml">        xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="line"><span class="xml">        xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">        &lt;variable</span></span><br><span class="line"><span class="xml">            name=&quot;name&quot;  //不能用下划线 &quot;_&quot;</span></span><br><span class="line"><span class="xml">            type=&quot;String&quot;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        &lt;variable</span></span><br><span class="line"><span class="xml">            name=&quot;lastName&quot;</span></span><br><span class="line"><span class="xml">            type=&quot;String&quot;/&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="xml">    &lt;androidx.constraintlayout.widget.ConstraintLayout</span></span><br><span class="line"><span class="xml">        android:layout_width=&quot;match_parent&quot;</span></span><br><span class="line"><span class="xml">        android:layout_height=&quot;match_parent&quot;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        &lt;TextView</span></span><br><span class="line"><span class="xml">            android:id=&quot;@+id/plain_name&quot;</span></span><br><span class="line"><span class="xml">            android:layout_width=&quot;0dp&quot;</span></span><br><span class="line"><span class="xml">            android:layout_height=&quot;wrap_content&quot;</span></span><br><span class="line"><span class="xml">            android:layout_marginStart=&quot;16dp&quot;</span></span><br><span class="line"><span class="xml">            android:layout_marginTop=&quot;8dp&quot;</span></span><br><span class="line"><span class="xml">            android:layout_marginEnd=&quot;128dp&quot;</span></span><br><span class="line"><span class="xml">            android:text=&quot;@</span><span class="template-variable">&#123;name&#125;</span><span class="xml">&quot;			</span></span><br><span class="line"><span class="xml">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Large&quot;</span></span><br><span class="line"><span class="xml">            app:layout_constraintEnd_toEndOf=&quot;parent&quot;</span></span><br><span class="line"><span class="xml">            app:layout_constraintStart_toStartOf=&quot;parent&quot;</span></span><br><span class="line"><span class="xml">            app:layout_constraintTop_toBottomOf=&quot;@+id/name_label&quot;/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="xml">        &lt;TextView</span></span><br><span class="line"><span class="xml">            android:id=&quot;@+id/plain_lastname&quot;</span></span><br><span class="line"><span class="xml">            android:layout_width=&quot;0dp&quot;</span></span><br><span class="line"><span class="xml">            android:layout_height=&quot;wrap_content&quot;</span></span><br><span class="line"><span class="xml">            android:layout_marginStart=&quot;16dp&quot;</span></span><br><span class="line"><span class="xml">            android:layout_marginTop=&quot;8dp&quot;</span></span><br><span class="line"><span class="xml">            android:layout_marginEnd=&quot;128dp&quot;</span></span><br><span class="line"><span class="xml">            android:text=&quot;@</span><span class="template-variable">&#123;lastName&#125;</span><span class="xml">&quot;</span></span><br><span class="line"><span class="xml">            android:textAppearance=&quot;@style/TextAppearance.AppCompat.Large&quot;</span></span><br><span class="line"><span class="xml">            app:layout_constraintEnd_toEndOf=&quot;parent&quot;</span></span><br><span class="line"><span class="xml">            app:layout_constraintStart_toStartOf=&quot;parent&quot;</span></span><br><span class="line"><span class="xml">            app:layout_constraintTop_toBottomOf=&quot;@+id/lastname_label&quot;/&gt;</span></span><br><span class="line"><span class="xml">            </span></span><br><span class="line"><span class="xml">       <span class="tag">&lt;/<span class="name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span>    </span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>Bind TextView</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlainOldActivitySolution2</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Obtain ViewModel from ViewModelProviders</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> viewModel <span class="keyword">by</span> lazy &#123; ViewModelProviders.of(<span class="keyword">this</span>).<span class="keyword">get</span>(SimpleViewModel::<span class="keyword">class</span>.java) &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">val</span> binding: PlainActivitySolution2Binding =</span><br><span class="line">            DataBindingUtil.setContentView(<span class="keyword">this</span>, R.layout.plain_activity_solution_2)</span><br><span class="line"></span><br><span class="line">        binding.name = <span class="string">&quot;John&quot;</span></span><br><span class="line">        binding.lastName = <span class="string">&quot;lice&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Explicitly setting initial values is a bad pattern. We&#x27;ll fix that later on.</span></span><br><span class="line">        updateLikes()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Dealing-with-user-events-Observering-data"><a href="#Dealing-with-user-events-Observering-data" class="headerlink" title="Dealing with user events  Observering data"></a>Dealing with user events  Observering data</h4><figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line">&lt;<span class="class"><span class="keyword">data</span>&gt;</span></span><br><span class="line">     &lt;variable</span><br><span class="line">             name=<span class="string">&quot;viewmodel&quot;</span></span><br><span class="line">             <span class="class"><span class="keyword">type</span>=&quot;com.example.android.databinding.basicsample.<span class="keyword">data</span>.<span class="type">SimpleViewModel</span>&quot;/&gt;</span></span><br><span class="line"> &lt;/<span class="class"><span class="keyword">data</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">android:</span>onClick=<span class="string">&quot;@&#123;() -&gt; viewmodel.onLike()&#125;&quot;</span></span><br><span class="line">   </span><br><span class="line">binding.viewmodel = viewModel</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> _likes =  <span class="constructor">MutableLiveData(0)</span></span><br><span class="line"> <span class="keyword">fun</span> on<span class="constructor">Like()</span> &#123;</span><br><span class="line">       <span class="module-access"><span class="module"><span class="identifier">_likes</span>.</span></span>value = (<span class="module-access"><span class="module"><span class="identifier">_likes</span>.</span></span>value ?: <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;TextView</span><br><span class="line">            android:<span class="built_in">id</span>=<span class="string">&quot;@+id/likes&quot;</span></span><br><span class="line">            android:<span class="built_in">text</span>=<span class="string">&quot;@&#123;Integer.toString(viewmodel.likes)&#125;&quot;</span></span><br></pre></td></tr></table></figure>





<h4 id="Using-Binding-Adapters"><a href="#Using-Binding-Adapters" class="headerlink" title="Using Binding Adapters"></a>Using Binding Adapters</h4><ol>
<li>One parameter</li>
</ol>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">BindingAdapter</span>(<span class="string">&quot;android:text&quot;</span>)</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setText</span><span class="params">(TextView view, CharSequence text)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// Some checks removed for clarity</span></span><br><span class="line"></span><br><span class="line">      view.<span class="built_in">setText</span>(text);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter(<span class="meta-string">&quot;app:hideIfZero&quot;</span>)</span></span><br><span class="line"> <span class="function"><span class="keyword">fun</span> <span class="title">hideIfZero</span><span class="params">(view: <span class="type">View</span>, number: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">     view.visibility = <span class="keyword">if</span> (number == <span class="number">0</span>) View.GONE <span class="keyword">else</span> View.VISIBLE</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;ProgressBar</span><br><span class="line">            android:<span class="attribute">id</span>=<span class="string">&quot;@+id/progressBar&quot;</span></span><br><span class="line">            app:<span class="attribute">hideIfZero</span>=<span class="string">&quot;@&#123;viewmodel.likes&#125;&quot;</span></span><br></pre></td></tr></table></figure>



<ol start="2">
<li><p>Create a Binding Adapter with multiple parameters   </p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;ProgressBar</span><br><span class="line">               android:<span class="attribute">id</span>=<span class="string">&quot;@+id/progressBar&quot;</span></span><br><span class="line">               app:<span class="attribute">hideIfZero</span>=<span class="string">&quot;@&#123;viewmodel.likes&#125;&quot;</span></span><br><span class="line">               app:<span class="attribute">progressScaled</span>=<span class="string">&quot;@&#123;viewmodel.likes&#125;&quot;</span></span><br><span class="line">               android:<span class="attribute">max</span>=<span class="string">&quot;@&#123;100&#125;&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="oberver-class-field"><a href="#oberver-class-field" class="headerlink" title="oberver class field"></a>oberver class field</h4><p><a href="https://developer.android.com/topic/libraries/data-binding/observability#observable_fields">https://developer.android.com/topic/libraries/data-binding/observability#observable_fields</a></p>
<p><a href="https://developer.android.com/topic/libraries/data-binding/observability#observable_objects">https://developer.android.com/topic/libraries/data-binding/observability#observable_objects</a></p>
<h5 id="Using-Binding-Adapters-to-create-custom-attributes"><a href="#Using-Binding-Adapters-to-create-custom-attributes" class="headerlink" title="Using Binding Adapters to create custom attributes"></a>Using Binding Adapters to create custom attributes</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter(value=[<span class="meta-string">&quot;app:setSleepData&quot;</span>])</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setSleepData</span><span class="params">(viewBodySleep: <span class="type">ViewBodySleep</span>, sleepData: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    viewBodySleep.setSleepData(sleepData)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;com.android.util.view.ViewBodySleep</span><br><span class="line">    android:<span class="attribute">id</span>=<span class="string">&quot;@+id/view_body_sleep&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:<span class="attribute">paddingLeft</span>=<span class="string">&quot;55dp&quot;</span></span><br><span class="line">    android:<span class="attribute">paddingRight</span>=<span class="string">&quot;48dp&quot;</span></span><br><span class="line">    app:<span class="attribute">setSleepData</span>=<span class="string">&quot;@&#123;vmBodyFragment.spData&#125;&quot;</span></span><br><span class="line">    app:<span class="attribute">layout_constraintTop_toTopOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>



<p><a href="https://developer.android.com/topic/libraries/data-binding/expressions#expression_language">https://developer.android.com/topic/libraries/data-binding/expressions#expression_language</a></p>
<p><a href="https://developer.android.com/topic/libraries/data-binding/observability">Work with observable data objects</a></p>
<ul>
<li><p>isNull</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="symbol">android:</span><span class="keyword">text</span>=<span class="comment">&#x27;@&#123;viewModel.patientInfo.remoteCheckReceiveName??&quot;&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>visible</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@BindingAdapter(<span class="meta-string">&quot;app:goneUnless&quot;</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">goneUnless</span><span class="params">(view: <span class="type">View</span>, visible: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">    view.visibility = <span class="keyword">if</span> (visible) View.VISIBLE <span class="keyword">else</span> View.GONE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a href="https://github.com/googlecodelabs/android-databinding">android-databinding</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzAwODY4OTk2Mg==&amp;mid=2652046992&amp;idx=1&amp;sn=b8b4c47537be1227eecd01c1eaee2550&amp;chksm=808ca6d5b7fb2fc32d9ec361c91a2958e51a2db1c6b20370e7ef6493bb5cb20314cda6ab059c&amp;scene=38#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzAwODY4OTk2Mg==&amp;mid=2652046992&amp;idx=1&amp;sn=b8b4c47537be1227eecd01c1eaee2550&amp;chksm=808ca6d5b7fb2fc32d9ec361c91a2958e51a2db1c6b20370e7ef6493bb5cb20314cda6ab059c&amp;scene=38#wechat_redirect</a></p>
<p><a href="https://juejin.im/post/5d2be05ff265da1bd605d49a">https://juejin.im/post/5d2be05ff265da1bd605d49a</a></p>
<p><a href="https://mp.weixin.qq.com/s/4UP-pDs0FK66g1QUQvRN6A">https://mp.weixin.qq.com/s/4UP-pDs0FK66g1QUQvRN6A</a></p>
<p>定义xml背景</p>
<p><a href="https://juejin.im/post/5b95c6a0e51d450e664b0aa0">https://juejin.im/post/5b95c6a0e51d450e664b0aa0</a></p>
<p><a href="https://www.jianshu.com/p/741103ba2ff1">https://www.jianshu.com/p/741103ba2ff1</a></p>
<p><a href="https://www.cs.usfca.edu/~galles/visualization/RedBlack.html">https://www.cs.usfca.edu/~galles/visualization/RedBlack.html</a></p>
]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
  </entry>
  <entry>
    <title>flutter_begin</title>
    <url>/2020/01/04/flutter-begin/</url>
    <content><![CDATA[<h4 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h4><ol>
<li>bash_profile</li>
</ol>
<blockquote>
<p>~/.bash_profile</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=/Users/m/development/flutter/bin:$PATH</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ANDROID_HOME</span>=<span class="string">&quot;/Users/m/Library/Android/sdk&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;PATH&#125;</span>:$&#123;ANDROID_HOME&#125;/tools</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$&#123;PATH&#125;</span>:$&#123;ANDROID_HOME&#125;/platform-tools</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PUB_HOSTED_URL</span>=https://pub.flutter-io.cn</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">FLUTTER_STORAGE_BASE_URL</span>=https://storage.flutter-io.cn</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> <code>~/.zshrc</code> ，在其中添加：source ~/.bash_profile</li>
</ol>
<p>Project struct -&gt; Modules -&gt; no sdk 选择</p>
<p><a href="https://mp.weixin.qq.com/s/YfzcvebruRk4LJRTQFVDXA">https://mp.weixin.qq.com/s/YfzcvebruRk4LJRTQFVDXA</a></p>
<p><a href="https://github.com/toly1994328/FlutterUnit">https://github.com/toly1994328/FlutterUnit</a></p>
<h5 id="build-apk"><a href="#build-apk" class="headerlink" title="build apk"></a>build apk</h5><p>出错解决: rm  /Users/john/development/flutter/bin/cache</p>
<blockquote>
<p> A problem occurred evaluating root project ‘agora_rtm’.</p>
<p>Could not get unknown property ‘kotlin_version’ for object of type org.gradle.api.internal.artifacts.dsl.dependencies.DefaultDependencyHandler.</p>
</blockquote>
<p>版本配置</p>
<blockquote>
<p>/Users/***/flutter/.pub-cache/hosted/pub.flutter-io.cn/cipher2-xxxx/android/build.gradle’ , ext.kotlin_version = 1.3.10</p>
</blockquote>
<blockquote>
<p>Users/john/.pub-cache/hosted/pub.flutter-io.cn/agora_rtm-0.9.9/android/build.gradle’</p>
</blockquote>
<p><a href="https://blog.csdn.net/weixin_44416513/article/details/90298303">https://blog.csdn.net/weixin_44416513/article/details/90298303</a></p>
<h4 id="Widget"><a href="#Widget" class="headerlink" title="Widget"></a>Widget</h4><h5 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h5><figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">class</span> <span class="selector-tag">MyApp</span> <span class="selector-tag">extends</span> <span class="selector-tag">StatelessWidget</span> &#123;</span><br><span class="line">  <span class="variable">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    <span class="selector-tag">return</span> <span class="selector-tag">MaterialApp</span>(</span><br><span class="line">      <span class="attribute">title</span>: <span class="string">&#x27;Text widget&#x27;</span>,</span><br><span class="line">      <span class="attribute">home</span>: Scaffold(</span><br><span class="line">        <span class="attribute">body</span>: Center(</span><br><span class="line">            <span class="attribute">child</span>: Text(</span><br><span class="line">          <span class="string">&#x27;Hello JSPang  ,非常喜欢前端，并且愿意为此奋斗一生。我希望可以出1000集免费教程。&#x27;</span>,</span><br><span class="line">          <span class="attribute">textAlign</span>: TextAlign.left,</span><br><span class="line">          <span class="attribute">overflow</span>: TextOverflow.ellipsis,</span><br><span class="line">          <span class="attribute">maxLines</span>: <span class="number">1</span>,</span><br><span class="line">          <span class="attribute">style</span>: TextStyle(</span><br><span class="line">            <span class="attribute">fontSize</span>: <span class="number">25.0</span>,</span><br><span class="line">            <span class="attribute">color</span>: <span class="attribute">Color</span>.fromARGB(<span class="number">255</span>, <span class="number">255</span>, <span class="number">150</span>, <span class="number">150</span>),</span><br><span class="line">            <span class="attribute">decoration</span>: TextDecoration.underline,</span><br><span class="line">            <span class="attribute">decorationStyle</span>: TextDecorationStyle.solid,</span><br><span class="line">          ),</span><br><span class="line">        )),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Image"><a href="#Image" class="headerlink" title="Image"></a>Image</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement createState</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="string">&quot;Text WIDGET&quot;</span>,</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">        body: <span class="type">Center</span>(</span><br><span class="line">          child: <span class="type">Container</span>(</span><br><span class="line">            child: <span class="keyword">new</span> <span class="type">Image</span>.network(</span><br><span class="line">              <span class="symbol">&#x27;http</span>:<span class="comment">//blogimages.jspang.com/blogtouxiang1.jpg&#x27;,</span></span><br><span class="line">              repeat: <span class="type">ImageRepeat</span>.repeatY,</span><br><span class="line">            ),</span><br><span class="line">            width: <span class="number">300</span>,</span><br><span class="line">            height: <span class="number">200</span>,</span><br><span class="line">            color: <span class="type">Colors</span>.lightBlue,</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h5><ol>
<li> 横向</li>
</ol>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">        title: <span class="symbol">&#x27;JSPang</span> <span class="type">Flutter</span> <span class="type">Demo</span>&#x27;,</span><br><span class="line">        home: <span class="type">Scaffold</span>(</span><br><span class="line">          appBar: <span class="type">AppBar</span>(title: <span class="type">Text</span>(<span class="symbol">&#x27;ListView</span> <span class="type">Widget</span>&#x27;)),</span><br><span class="line">          body: <span class="type">Center</span>(</span><br><span class="line">            child: <span class="type">Container</span>(</span><br><span class="line">              height: <span class="number">200</span>,</span><br><span class="line">              child: <span class="type">MyListView</span>(),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyListView</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">ListView</span>(</span><br><span class="line">      scrollDirection: <span class="type">Axis</span>.horizontal,</span><br><span class="line">      children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">        <span class="type">Container</span>(</span><br><span class="line">          width: <span class="number">180</span>,</span><br><span class="line">          color: <span class="type">Colors</span>.amber,</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Container</span>(</span><br><span class="line">          width: <span class="number">180</span>,</span><br><span class="line">          color: <span class="type">Colors</span>.lightBlue,</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Container</span>(</span><br><span class="line">          width: <span class="number">180</span>,</span><br><span class="line">          color: <span class="type">Colors</span>.deepPurpleAccent,</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>动态数据</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">List</span>&lt;<span class="type">String</span>&gt; items;</span><br><span class="line"></span><br><span class="line">  <span class="type">MyApp</span>(&#123;<span class="meta">@required</span> <span class="keyword">this</span>.items&#125;) : <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">        title: <span class="symbol">&#x27;JSPang</span> <span class="type">Flutter</span> <span class="type">Demo</span>&#x27;,</span><br><span class="line">        home: <span class="type">Scaffold</span>(</span><br><span class="line">            appBar: <span class="type">AppBar</span>(title: <span class="type">Text</span>(<span class="symbol">&#x27;ListView</span> <span class="type">Widget</span>&#x27;)),</span><br><span class="line">            body: <span class="type">ListView</span>.builder(</span><br><span class="line">              itemCount: items.length,</span><br><span class="line">              itemBuilder: (context,index)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="type">ListTile</span>(</span><br><span class="line">                  title: <span class="type">Text</span>(&#x27;$&#123;items[index]&#125;&#x27;),</span><br><span class="line">                );</span><br><span class="line">              &#125;,</span><br><span class="line">            )));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>gridview</p>
<figure class="highlight haskell"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="type">MyApp</span> extends <span class="type">StatelessWidget</span> &#123;</span></span><br><span class="line"><span class="class">  @override</span></span><br><span class="line"><span class="class">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> <span class="title">context</span>) &#123;</span></span><br><span class="line"><span class="class">    return <span class="type">MaterialApp</span>(</span></span><br><span class="line"><span class="class">        <span class="title">title</span>: &#x27;<span class="type">JSPang</span> <span class="type">Flutter</span> <span class="type">Demo</span>&#x27;,</span></span><br><span class="line"><span class="class">        <span class="title">home</span>: <span class="type">Scaffold</span>(</span></span><br><span class="line"><span class="class">            <span class="title">appBar</span>: <span class="type">AppBar</span>(<span class="title">title</span>: <span class="type">Text</span>(&#x27;<span class="type">ListView</span> <span class="type">Widget</span>&#x27;)),</span></span><br><span class="line"><span class="class">            body: <span class="type">GridView</span>.count(</span></span><br><span class="line"><span class="class">              <span class="title">padding</span>: <span class="type">EdgeInsets</span>.<span class="title">all</span>(20),</span></span><br><span class="line"><span class="class">              crossAxisSpacing: 10,</span></span><br><span class="line"><span class="class">              crossAxisCount: 4,</span></span><br><span class="line"><span class="class">              children: &lt;<span class="type">Widget</span>&gt;[</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">JOHN</span>&#x27;),</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">LI</span>&#x27;),</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">JON</span>&#x27;),</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">HEHE</span>&#x27;),</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">LILI</span>&#x27;),</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">SIYUE</span>&#x27;),</span></span><br><span class="line"><span class="class">                <span class="type">Text</span>(&#x27;<span class="type">I</span> <span class="title">am</span> <span class="type">QIQI</span>&#x27;),</span></span><br><span class="line"><span class="class">              ],</span></span><br><span class="line"><span class="class">            )));</span></span><br><span class="line"><span class="class">  &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="row"><a href="#row" class="headerlink" title="row"></a>row</h5><ol>
<li> 固定</li>
</ol>
   <figure class="highlight css"><table><tr><td class="code"><pre><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  <span class="keyword">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    // TODO: implement build</span><br><span class="line">    return <span class="built_in">MaterialApp</span>(</span><br><span class="line">      title: <span class="string">&#x27;Row Widget Demo&#x27;</span>,</span><br><span class="line">      home: <span class="built_in">Scaffold</span>(</span><br><span class="line">        appBar: <span class="built_in">AppBar</span>(</span><br><span class="line">          title: <span class="built_in">Text</span>(<span class="string">&quot;水平方向布局&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: <span class="built_in">Row</span>(</span><br><span class="line">          children: &lt;Widget&gt;[</span><br><span class="line">            <span class="built_in">RaisedButton</span>(</span><br><span class="line">              onPressed: () &#123;&#125;,</span><br><span class="line">              <span class="attribute">color</span>: Colors.amber,</span><br><span class="line">              child: <span class="built_in">Text</span>(<span class="string">&#x27;red Button&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">            <span class="built_in">RaisedButton</span>(</span><br><span class="line">              onPressed: () &#123;&#125;,</span><br><span class="line">              <span class="attribute">color</span>: Colors.lightBlue,</span><br><span class="line">              child: <span class="built_in">Text</span>(<span class="string">&#x27;lightBlue Button&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">            <span class="built_in">RaisedButton</span>(</span><br><span class="line">              onPressed: () &#123;&#125;,</span><br><span class="line">              <span class="attribute">color</span>: Colors.redAccent,</span><br><span class="line">              child: <span class="built_in">Text</span>(<span class="string">&#x27;redAccent Button&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">          ]</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li><p>不固定</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">class MyApp extends StatelessWidget &#123;</span><br><span class="line">  <span class="keyword">@override</span></span><br><span class="line">  Widget build(BuildContext context) &#123;</span><br><span class="line">    // TODO: implement build</span><br><span class="line">    return <span class="built_in">MaterialApp</span>(</span><br><span class="line">      title: <span class="string">&#x27;Row Widget Demo&#x27;</span>,</span><br><span class="line">      home: <span class="built_in">Scaffold</span>(</span><br><span class="line">        appBar: <span class="built_in">AppBar</span>(</span><br><span class="line">          title: <span class="built_in">Text</span>(<span class="string">&quot;水平方向布局&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: <span class="built_in">Row</span>(children: &lt;Widget&gt;[</span><br><span class="line">          <span class="built_in">Expanded</span>(</span><br><span class="line">            child: <span class="built_in">RaisedButton</span>(</span><br><span class="line">              onPressed: () &#123;&#125;,</span><br><span class="line">              <span class="attribute">color</span>: Colors.lightBlue,</span><br><span class="line">              child: <span class="built_in">Text</span>(<span class="string">&#x27;lightBlue Button&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          <span class="built_in">Expanded</span>(</span><br><span class="line">            child: <span class="built_in">RaisedButton</span>(</span><br><span class="line">              onPressed: () &#123;&#125;,</span><br><span class="line">              <span class="attribute">color</span>: Colors.redAccent,</span><br><span class="line">              child: <span class="built_in">Text</span>(<span class="string">&#x27;redAccent Button&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          <span class="built_in">Expanded</span>(</span><br><span class="line">            child: <span class="built_in">RaisedButton</span>(</span><br><span class="line">              onPressed: () &#123;&#125;,</span><br><span class="line">              <span class="attribute">color</span>: Colors.deepPurpleAccent,</span><br><span class="line">              child: <span class="built_in">Text</span>(<span class="string">&#x27;deepPurpleAccent Button&#x27;</span>),</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ]),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="coloumn"><a href="#coloumn" class="headerlink" title="coloumn"></a>coloumn</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">&#x27;Column</span> <span class="type">Widget</span> <span class="type">Demo</span>&#x27;,</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">        appBar: <span class="type">AppBar</span>(</span><br><span class="line">          title: <span class="type">Text</span>(<span class="string">&quot;水平方向布局&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body: <span class="type">Column</span>(</span><br><span class="line">          crossAxisAlignment: <span class="type">CrossAxisAlignment</span>.center,</span><br><span class="line">          mainAxisAlignment: <span class="type">MainAxisAlignment</span>.center,</span><br><span class="line">          children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">JOHN</span>&#x27;),</span><br><span class="line"></span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">LI</span>&#x27;),</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">JON</span>  <span class="type">I</span> am <span class="type">JON</span>  <span class="type">I</span> am <span class="type">JON</span>&#x27;),</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">HEHE</span>&#x27;),</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">LILI</span>&#x27;),</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">SIYUE</span>&#x27;),</span><br><span class="line">            <span class="type">Text</span>(<span class="symbol">&#x27;I</span> am <span class="type">QIQI</span>&#x27;),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li>CrossAxisAlignment  相对于最长的布局</li>
</ul>
<h5 id="StackWidget"><a href="#StackWidget" class="headerlink" title="StackWidget"></a>StackWidget</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">var</span> stack = <span class="type">Stack</span>(</span><br><span class="line">      alignment: <span class="type">FractionalOffset</span>(<span class="number">0.5</span>,<span class="number">0.8</span>),</span><br><span class="line">      children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">        <span class="type">CircleAvatar</span>(</span><br><span class="line">          backgroundImage:</span><br><span class="line">              <span class="type">NetworkImage</span>(<span class="symbol">&#x27;http</span>:<span class="comment">//blogimages.jspang.com/blogtouxiang1.jpg&#x27;),</span></span><br><span class="line">          radius: <span class="number">100</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Container</span>(</span><br><span class="line">          decoration: <span class="type">BoxDecoration</span>(color: <span class="type">Colors</span>.blue),</span><br><span class="line">          padding: <span class="type">EdgeInsets</span>.all(<span class="number">5</span>),</span><br><span class="line">          child: <span class="type">Text</span>(<span class="string">&quot;I am JON&quot;</span>),</span><br><span class="line">        )</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">&#x27;Column</span> <span class="type">Widget</span> <span class="type">Demo</span>&#x27;,</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">        appBar: <span class="type">AppBar</span>(</span><br><span class="line">          title: <span class="type">Text</span>(<span class="string">&quot;水平方向布局&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        body:<span class="type">Center</span>(child: stack),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>FractionalOffset 0-1  相对于当前容器的 X Y轴</p>
</blockquote>
<h5 id="Position-Widget"><a href="#Position-Widget" class="headerlink" title="Position Widget"></a>Position Widget</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">var</span> stack = <span class="type">Stack</span>(</span><br><span class="line">      alignment: <span class="type">FractionalOffset</span>(<span class="number">0.1</span>, <span class="number">0.5</span>),</span><br><span class="line">      children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">        <span class="type">CircleAvatar</span>(</span><br><span class="line">          backgroundImage:</span><br><span class="line">              <span class="type">NetworkImage</span>(<span class="symbol">&#x27;http</span>:<span class="comment">//blogimages.jspang.com/blogtouxiang1.jpg&#x27;),</span></span><br><span class="line">          radius: <span class="number">100</span>,</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Positioned</span>(</span><br><span class="line">          top: <span class="number">10</span>,</span><br><span class="line">          left: <span class="number">60</span>,</span><br><span class="line">          child: <span class="type">Text</span>(<span class="string">&quot;I am JON&quot;</span>),</span><br><span class="line">        ),</span><br><span class="line">        <span class="type">Positioned</span>(</span><br><span class="line">          bottom: <span class="number">10</span>,</span><br><span class="line">          right: <span class="number">10</span>,</span><br><span class="line">          child: <span class="type">Text</span>(</span><br><span class="line">            <span class="string">&quot;I am JON&quot;</span>,</span><br><span class="line">            style: <span class="type">TextStyle</span>(fontSize: <span class="number">25</span>, color: <span class="type">Colors</span>.lightBlue),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">      ],</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">      title: <span class="symbol">&#x27;Column</span> <span class="type">Widget</span> <span class="type">Demo</span>&#x27;,</span><br><span class="line">      home: <span class="type">Scaffold</span>(</span><br><span class="line">        appBar: <span class="type">AppBar</span>(</span><br><span class="line">          title: <span class="type">Text</span>(</span><br><span class="line">            <span class="string">&quot;水平方向布局&quot;</span>,</span><br><span class="line">            style: <span class="type">TextStyle</span>(fontSize: <span class="number">25</span>, color: <span class="type">Colors</span>.redAccent),</span><br><span class="line">          ),</span><br><span class="line">        ),</span><br><span class="line">        body: <span class="type">Center</span>(child: stack),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Positioned 相对于当前容器 padding?</p>
</blockquote>
<h5 id="card"><a href="#card" class="headerlink" title="card"></a>card</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">var</span> card = <span class="keyword">new</span> <span class="type">Card</span>(</span><br><span class="line">      child: <span class="type">Column</span>(</span><br><span class="line">        children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">          <span class="type">ListTile</span>(</span><br><span class="line">            title: <span class="type">Text</span>(</span><br><span class="line">              <span class="string">&quot;上海市 高兴区&quot;</span>,</span><br><span class="line">              style: <span class="type">TextStyle</span>(fontWeight: <span class="type">FontWeight</span>.w500),</span><br><span class="line">            ),</span><br><span class="line">            subtitle: <span class="type">Text</span>(<span class="string">&quot;john 182929739933&quot;</span>),</span><br><span class="line">            leading: <span class="type">Icon</span>(</span><br><span class="line">              <span class="type">Icons</span>.account_box,</span><br><span class="line">              color: <span class="type">Colors</span>.lightBlue,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          <span class="type">Divider</span>(),</span><br><span class="line">          <span class="type">ListTile</span>(</span><br><span class="line">            title: <span class="type">Text</span>(</span><br><span class="line">              <span class="string">&quot;北京市 高兴区&quot;</span>,</span><br><span class="line">              style: <span class="type">TextStyle</span>(fontWeight: <span class="type">FontWeight</span>.w500),</span><br><span class="line">            ),</span><br><span class="line">            subtitle: <span class="type">Text</span>(<span class="string">&quot;elon 182929739933&quot;</span>),</span><br><span class="line">            leading: <span class="type">Icon</span>(</span><br><span class="line">              <span class="type">Icons</span>.account_box,</span><br><span class="line">              color: <span class="type">Colors</span>.lightBlue,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">          <span class="type">Divider</span>(),</span><br><span class="line"></span><br><span class="line">          <span class="type">ListTile</span>(</span><br><span class="line">            title: <span class="type">Text</span>(</span><br><span class="line">              <span class="string">&quot;江西省 高兴区&quot;</span>,</span><br><span class="line">              style: <span class="type">TextStyle</span>(fontWeight: <span class="type">FontWeight</span>.w500),</span><br><span class="line">            ),</span><br><span class="line">            subtitle: <span class="type">Text</span>(<span class="string">&quot;lari 182929739933&quot;</span>),</span><br><span class="line">            leading: <span class="type">Icon</span>(</span><br><span class="line">              <span class="type">Icons</span>.account_box,</span><br><span class="line">              color: <span class="type">Colors</span>.lightBlue,</span><br><span class="line">            ),</span><br><span class="line">          ),</span><br><span class="line">        ],</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="type">MaterialApp</span>(</span><br><span class="line">        title: <span class="string">&quot;Row Widget Demo&quot;</span>,</span><br><span class="line">        home: <span class="type">Scaffold</span>(</span><br><span class="line">          appBar: <span class="type">AppBar</span>(</span><br><span class="line">            title: <span class="type">Text</span>(<span class="symbol">&#x27;Card</span>布局&#x27;),</span><br><span class="line">          ),</span><br><span class="line">          body: <span class="type">Center</span>(</span><br><span class="line">            child: card,</span><br><span class="line">          ),</span><br><span class="line">        ));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="页面跳转"><a href="#页面跳转" class="headerlink" title="页面跳转"></a>页面跳转</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstScreen</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(title: <span class="type">Text</span>(&#x27;导航页面&#x27;)),</span><br><span class="line">      body: <span class="type">Center</span>(</span><br><span class="line">        child: <span class="type">RaisedButton</span>(</span><br><span class="line">          child: <span class="type">Text</span>(&#x27;查看商品详情页&#x27;),</span><br><span class="line">          onPressed: () &#123;</span><br><span class="line">            <span class="type">Navigator</span>.push(context,</span><br><span class="line">                <span class="type">MaterialPageRoute</span>(builder: (context) =&gt; <span class="keyword">new</span> <span class="type">SecondScreen</span>()));</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecondScreen</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(&#x27;导航商品详情页&#x27;),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="type">Center</span>(</span><br><span class="line">        child: <span class="type">RaisedButton</span>(</span><br><span class="line">          child: <span class="type">Text</span>(&#x27;返回&#x27;),</span><br><span class="line">          onPressed: ()&#123;</span><br><span class="line">            <span class="type">Navigator</span>.pop(context);</span><br><span class="line">          &#125;,</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="列表传参"><a href="#列表传参" class="headerlink" title="列表传参"></a>列表传参</h4><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">void main() =&gt; runApp(<span class="type">MaterialApp</span>(</span><br><span class="line">    title: <span class="string">&quot;列表数据传递&quot;</span>,</span><br><span class="line">    home: <span class="type">ProductList</span>(</span><br><span class="line">        products:</span><br><span class="line">            <span class="type">List</span>.generate(<span class="number">20</span>, (i) =&gt; <span class="type">Product</span>(&#x27; 商品 $i&#x27;, &#x27;这是一个商品详情， 编号: $i&#x27;)))));</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductList</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">List</span>&lt;<span class="type">Product</span>&gt; products;</span><br><span class="line"></span><br><span class="line">  <span class="type">ProductList</span>(&#123;<span class="keyword">this</span>.products&#125;) : <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(&#x27;商品列表&#x27;),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="type">ListView</span>.builder(</span><br><span class="line">          itemCount: products.length,</span><br><span class="line">          itemBuilder: (context, index) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="type">ListTile</span>(</span><br><span class="line">              title: <span class="type">Text</span>(products[index].title),</span><br><span class="line">              onTap: () &#123;</span><br><span class="line">                <span class="type">Navigator</span>.push(</span><br><span class="line">                    context,</span><br><span class="line">                    <span class="type">MaterialPageRoute</span>(</span><br><span class="line">                        builder: (context) =&gt;</span><br><span class="line">                            <span class="type">ProductDetail</span>(product: products[index])));</span><br><span class="line">              &#125;,</span><br><span class="line">            );</span><br><span class="line">          &#125;),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Product</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">String</span> title;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">String</span> description;</span><br><span class="line"></span><br><span class="line">  <span class="type">Product</span>(<span class="keyword">this</span>.title, <span class="keyword">this</span>.description);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductDetail</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="type">Product</span> product;</span><br><span class="line"></span><br><span class="line">  <span class="type">ProductDetail</span>(&#123;<span class="keyword">this</span>.product&#125;) : <span class="keyword">super</span>();</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(&#x27;$&#123;product.title&#125;&#x27;),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="type">Center</span>(</span><br><span class="line">        child: <span class="type">Text</span>(&#x27;$&#123;product.description&#125;&#x27;),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="跳转返回"><a href="#跳转返回" class="headerlink" title="跳转返回"></a>跳转返回</h5><figure class="highlight scala"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstPage</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(&#x27;小姐姐要电话&#x27;),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="type">Center</span>(</span><br><span class="line">        child: <span class="type">RouteButton</span>(),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RouteButton</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">RaisedButton</span>(</span><br><span class="line">      onPressed: () &#123;</span><br><span class="line">        _navigateToXiaoJIe(context);</span><br><span class="line">      &#125;,</span><br><span class="line">      child: <span class="type">Text</span>(&#x27;找小姐姐&#x27;),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_navigateToXiaoJIe(<span class="type">BuildContext</span> context) async &#123;</span><br><span class="line">  <span class="keyword">final</span> result = await <span class="type">Navigator</span>.push(</span><br><span class="line">      context, <span class="type">MaterialPageRoute</span>(builder: (context) =&gt; <span class="type">XiaoJieJie</span>()));</span><br><span class="line"></span><br><span class="line">  <span class="type">Scaffold</span>.of(context).showSnackBar(<span class="type">SnackBar</span>(</span><br><span class="line">    content: <span class="type">Text</span>(&#x27;$result&#x27;),</span><br><span class="line">  ));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XiaoJieJie</span> <span class="keyword">extends</span> <span class="title">StatelessWidget</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="type">Widget</span> build(<span class="type">BuildContext</span> context) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> implement build</span></span><br><span class="line">    <span class="keyword">return</span> <span class="type">Scaffold</span>(</span><br><span class="line">      appBar: <span class="type">AppBar</span>(</span><br><span class="line">        title: <span class="type">Text</span>(&#x27;我是小姐姐&#x27;),</span><br><span class="line">      ),</span><br><span class="line">      body: <span class="type">Center</span>(</span><br><span class="line">        child: <span class="type">Column</span>(</span><br><span class="line">          children: &lt;<span class="type">Widget</span>&gt;[</span><br><span class="line">            <span class="type">RaisedButton</span>(</span><br><span class="line">              child: <span class="type">Text</span>(&#x27;可爱小姐姐&#x27;),</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                <span class="type">Navigator</span>.pop(context, &#x27;可爱小姐姐 <span class="number">1550008883</span>&#x27;);</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">            <span class="type">RaisedButton</span>(</span><br><span class="line">              child: <span class="type">Text</span>(&#x27;漂亮小姐姐&#x27;),</span><br><span class="line">              onPressed: () &#123;</span><br><span class="line">                <span class="type">Navigator</span>.pop(context, &#x27;漂亮小姐姐 <span class="number">1550009983</span>&#x27;);</span><br><span class="line">              &#125;,</span><br><span class="line">            ),</span><br><span class="line">          ],</span><br><span class="line">        ),</span><br><span class="line">      ),</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>flutter</category>
      </categories>
  </entry>
  <entry>
    <title>flutter_layout</title>
    <url>/2020/09/24/flutter-layout/</url>
    <content><![CDATA[<p><a href="https://jspang.com/detailed?id=43">https://jspang.com/detailed?id=43</a></p>
<p><a href="https://book.flutterchina.club/chapter4/row_and_column.html">https://book.flutterchina.club/chapter4/row_and_column.html</a></p>
<h3 id="主轴和纵轴"><a href="#主轴和纵轴" class="headerlink" title="主轴和纵轴"></a>主轴和纵轴</h3><p>对于线性布局，有主轴和纵轴之分，如果布局是沿水平方向(Row),那么主轴就是指水平方向，而纵轴即垂直方向.</p>
<p>如果布局沿垂直方向(Colomn)，那么主轴就是指垂直方向，而纵轴就是水平方向</p>
<ul>
<li><p>MainAxisAlignment</p>
<p> 表示子组件在<code>Row</code>所占用的水平空间内对齐方式，如果<code>mainAxisSize</code>值为<code>MainAxisSize.min</code>，则此属性无意义</p>
</li>
<li><p>crossAxisAlignment </p>
<p>表示子组件在纵轴方向的对齐方式，<code>Row</code>的高度等于子组件中最高的子元素高度</p>
</li>
<li><p>TextDirection : 字体方向</p>
</li>
<li><p>CrossAxisAlignment : 表示<code>Row</code>纵轴（垂直）的对齐方向，默认是<code>VerticalDirection.down</code>，表示从上到下.</p>
</li>
<li><p><strong><code>Row</code>和<code>Column</code>都只会在主轴方向占用尽可能大的空间，而纵轴的长度则取决于他们最大子元素的长度</strong></p>
<p>特殊情况 : </p>
<p>如果<code>Row</code>里面嵌套<code>Row</code>，或者<code>Column</code>里面再嵌套<code>Column</code>，那么只有最外面的<code>Row</code>或<code>Column</code>会占用尽可能大的空间，里面<code>Row</code>或<code>Column</code>所占用的空间为实际大小，下面以<code>Column</code>为例说明</p>
</li>
</ul>
]]></content>
      <categories>
        <category>flutter</category>
      </categories>
  </entry>
  <entry>
    <title>flutter_paint</title>
    <url>/2020/10/14/flutter-paint/</url>
    <content><![CDATA[<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="constructor">Offset(<span class="params">size</span>.<span class="params">width</span><span class="operator">*</span>0.5, <span class="params">size</span>.<span class="params">height</span>)</span> <span class="comment">//坐标</span></span><br></pre></td></tr></table></figure>



<p><a href="https://codewithandrea.com/videos/2020-01-27-flutter-custom-painting-do-not-fear-canvas/">https://codewithandrea.com/videos/2020-01-27-flutter-custom-painting-do-not-fear-canvas/</a></p>
<p><a href="https://flutter.dev/docs/development/ui/widgets/painting">https://flutter.dev/docs/development/ui/widgets/painting</a></p>
]]></content>
      <categories>
        <category>flutter</category>
      </categories>
  </entry>
  <entry>
    <title>flutterdev</title>
    <url>/2020/08/26/flutterdev/</url>
    <content><![CDATA[<p>​        </p>
<p><img src="/2020/08/26/flutterdev/CgqCHl7zAM2AFYCOAAFd30sb1Ck089.png" alt="CgqCHl7zAM2AFYCOAAFd30sb1Ck089"></p>
<p><a href="https://flutter.dev/docs/development/ui/layout">https://flutter.dev/docs/development/ui/layout</a></p>
<h4 id="Aligning-widgets"><a href="#Aligning-widgets" class="headerlink" title="Aligning widgets"></a>Aligning widgets</h4><h5 id="MainAxisAlignment"><a href="#MainAxisAlignment" class="headerlink" title="MainAxisAlignment"></a>MainAxisAlignment</h5><p><a href="https://blog.csdn.net/BINGXIHEART/article/details/95077098">https://blog.csdn.net/BINGXIHEART/article/details/95077098</a></p>
<p> 可以接着完善</p>
<ul>
<li><p>row </p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">Row(</span><br><span class="line">  mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><br><span class="line">  children: [</span><br><span class="line">    Image.asset(<span class="string">&#x27;images/pic1.jpg&#x27;</span>),</span><br><span class="line">    Image.asset(<span class="string">&#x27;images/pic2.jpg&#x27;</span>),</span><br><span class="line">    Image.asset(<span class="string">&#x27;images/pic3.jpg&#x27;</span>),</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<img src="/2020/08/26/flutterdev/Screen Shot 2020-08-26 at 11.55.17 AM.png" alt="Screen Shot 2020-08-26 at 11.55.17 AM" style="zoom: 50%;"></li>
<li><p>Column</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Wid<span class="keyword">get</span> <span class="title">buildRow</span>() =&gt; <span class="title">Column</span>(<span class="params"></span></span><br><span class="line"><span class="params">      mainAxisAlignment: MainAxisAlignment.center,</span></span><br><span class="line"><span class="params">      children: &lt;Widget&gt;[</span></span><br><span class="line"><span class="params">        Image.asset(<span class="string">&#x27;images/pic1.jpg&#x27;</span>),</span></span><br><span class="line"><span class="params">        Image.asset(<span class="string">&#x27;images/pic2.jpg&#x27;</span>),</span></span><br><span class="line"><span class="params">        Image.asset(<span class="string">&#x27;images/pic3.jpg&#x27;</span>),</span></span><br><span class="line"><span class="params">      ],</span></span><br><span class="line"><span class="params">    </span>);</span><br></pre></td></tr></table></figure>

<img src="/2020/08/26/flutterdev/Screen Shot 2020-08-26 at 12.04.23 PM.png" alt="Screen Shot 2020-08-26 at 12.04.23 PM" style="zoom: 33%;"></li>
</ul>
<h4 id="constraints"><a href="#constraints" class="headerlink" title="constraints"></a>constraints</h4><h5 id="ConstrainedBox"><a href="#ConstrainedBox" class="headerlink" title="ConstrainedBox"></a>ConstrainedBox</h5><p>  The <code>ConstrainedBox</code> imposes <strong>additional</strong> constraints from its <code>constraints</code> parameter onto its child .</p>
<h5 id="UnconstrainedBox"><a href="#UnconstrainedBox" class="headerlink" title="UnconstrainedBox"></a>UnconstrainedBox</h5><p>The screen forces the <code>UnconstrainedBox</code> to be exactly the same size as the screen. However, the <code>UnconstrainedBox</code> lets its child <code>Container</code> be any size it wants</p>
<p><a href="https://resocoder.com/2019/08/15/flutter-custom-icons-automatic-manual-way-icon-font-or-svg/">https://resocoder.com/2019/08/15/flutter-custom-icons-automatic-manual-way-icon-font-or-svg/</a></p>
<p><a href="https://www.fluttericon.com/">https://www.fluttericon.com/</a></p>
<h4 id="json-and-serializtion"><a href="#json-and-serializtion" class="headerlink" title="json and serializtion"></a>json and serializtion</h4><figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">dependencies</span>:</span><br><span class="line">	<span class="attribute">json_annotation</span>: ^<span class="number">2</span>.<span class="number">2</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">dev_dependencies</span>:</span><br><span class="line">  <span class="attribute">flutter_test</span>:</span><br><span class="line">    <span class="attribute">sdk</span>: flutter</span><br><span class="line"></span><br><span class="line">  <span class="attribute">build_runner</span>: ^<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">json_serializable</span>: ^<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">json_model</span>:</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flutter packages pub run json_model</p>
</blockquote>
<figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutteruse/models/user.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  final jsonString = File(<span class="string">&#x27;jsons/user.json&#x27;</span>).readAsStringSync();</span><br><span class="line">  <span class="built_in">print</span>(jsonString);</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span> var jsonString = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;John Smith&quot;,&quot;email&quot;: &quot;john@example.com&quot;&#125;&#x27;</span>;</span><br><span class="line">  <span class="regexp">//</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, dynamic&gt; user = jsonDecode(jsonString) <span class="keyword">as</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, dynamic&gt;;</span><br><span class="line">  <span class="regexp">//</span> <span class="built_in">print</span>(<span class="string">&#x27;Howdy, $&#123;user[&#x27;</span>name<span class="string">&#x27;]&#125;!&#x27;</span>);</span><br><span class="line">  <span class="regexp">//</span> <span class="built_in">print</span>(<span class="string">&#x27;We sent the verification link to $&#123;user[&#x27;</span>email<span class="string">&#x27;]&#125;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span> userMap = jsonDecode(jsonString);</span><br><span class="line">  var user = User.fromJson(userMap);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;Howdy, $&#123;user.name&#125;!&#x27;</span>);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;We sent the verification link to $&#123;user.email&#125;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(user.toJson());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>项目中采用第三种方法</p>
<p><strong>使用json_model自动生成</strong></p>
<p>1.在项目根目录新建jsons文件夹并将json数据新建成为文件，在lib目录下新建包名为models</p>
<p>注意：这两个文件夹的名字都必须为jsons和models</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-2fef1bf9e56b2ad9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/658/format/webp" alt="img"></p>
<p>2、加入依懒</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-48c442858ef185e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/794/format/webp" alt="img"></p>
<p>注意：这里添加完json_serializable相关依赖之后还添加了json_model的依赖，这就是快捷生成的关键，还有如果json中引用了其他model可以使用如下方式</p>
<p>{</p>
<p>“name”:”wendux”,</p>
<p>“father”:”$user”,//可以通过”$”符号引用其它model类</p>
<p>“friends”:”$[]user”,//可以通过”$[]”来引用数组</p>
<p>“keywords”:”$[]String”,//同上</p>
<p>“age”:20</p>
<p>}</p>
<p><strong>3.完成上面的操作之后</strong></p>
<p>在当前项目的根目录执行如下命令：flutter packages pub run json_model</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-1aa8170bb500d178.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1157/format/webp" alt="img"></p>
<p>控制台打印如下日志就成功了</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-e3a705329f02ae39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>注意：如果json文件中加了注释可能会报错，需要删除注释，错误信息如下</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-bbf32b1d29e8a279.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1182/format/webp" alt="img"></p>
<p>其实，我们也可以不使用命令行的方式自动生成，</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-f2f6d6dfb8e1f5e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1058/format/webp" alt="img"></p>
<p>用run([‘src=jsons’])的方法也可以，run方法为json_model暴露的方法</p>
<p><a href="https://www.jianshu.com/p/f37d8546ab8f">https://www.jianshu.com/p/f37d8546ab8f</a></p>
<ul>
<li> 修改包名后  pubspec.yaml</li>
</ul>
<blockquote>
<p> target file “lib/main_dev.dart” not found</p>
</blockquote>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">plugin:</span></span><br><span class="line"><span class="symbol">  platforms:</span></span><br><span class="line"><span class="symbol">    android:</span></span><br><span class="line"><span class="symbol">      package:</span> com.casanube.flutter_ble <span class="comment">//记得修改这个包名 要不然爆出上面的错误</span></span><br><span class="line"><span class="symbol">      pluginClass:</span> FlutterBlePlugin</span><br></pre></td></tr></table></figure>



<p>flutter自定义控件</p>
<p><a href="https://mp.weixin.qq.com/s/aVvos5iWYVmiVZRv4hMQMQ">https://mp.weixin.qq.com/s/aVvos5iWYVmiVZRv4hMQMQ</a></p>
<p><a href="https://juejin.im/post/6874061694491721736">https://juejin.im/post/6874061694491721736</a></p>
]]></content>
      <categories>
        <category>flutter</category>
      </categories>
  </entry>
  <entry>
    <title>hot_patch（热更新）</title>
    <url>/2017/10/17/hot-patch/</url>
    <content><![CDATA[<p>为了预防项目紧急问题，使用热更新比发版要好点</p>
<h5 id="热更新选择"><a href="#热更新选择" class="headerlink" title="热更新选择"></a>热更新选择</h5><ul>
<li><p>VitrualApk  滴滴开源的方案，之前的dynamic-load-apk推动的热更新的发展,不过这个开源没多久，准备后面迁移到这上面来</p>
</li>
<li><p>Tinker-Bugly      这个很不错免费，就是只支持 冷启动，配合bugly教程用起来方便</p>
</li>
<li><p>sophix         这个支持热启动 配置也方便，不过5万设备以上就要收费，对于收费我觉得也无可厚非，毕竟是别人的劳动成果，</p>
<pre><code>           作为开发者的角度，还是开源最好，以后可以学习下。
</code></pre>
</li>
</ul>
<p>所以先选择Tinker-Bugly</p>
<h5 id="接入"><a href="#接入" class="headerlink" title="接入"></a>接入</h5><p> 按照<a href="https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/" title="bugly">接入文档</a> 配合Demo接入配置，然后就开始做自己的app 定义</p>
<ol>
<li>修改appid </li>
</ol>
<p> bugly平台申请后的 AppId</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 这里实现SDK初始化，appId替换成你的在Bugly平台申请的appId</span></span><br><span class="line">       <span class="comment">// 调试时，将第三个参数改为true</span></span><br><span class="line">       <span class="module-access"><span class="module"><span class="identifier">Bugly</span>.</span></span>init(get<span class="constructor">Application()</span>, <span class="string">&quot;f7b6508f55&quot;</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p> 第三个参数设置  log是否展示</p>
<ol start="2">
<li>tinkerId</li>
</ol>
<p>每次修改 基线版本和 补丁版本都要修改 tinkerId</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">tinkerId</span> = <span class="string">&quot;1.0.6-patch&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>点击 assembleDebug</li>
</ol>
<p>生成 基线版本</p>
<p><a href="https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix-demo/">https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix-demo/</a></p>
<figure class="highlight elm"><table><tr><td class="code"><pre><span class="line">实际应用中，请注意保存线上发布版本的基准apk包、mapping文件、<span class="type">R</span>.txt文件，如果线上版本有bug，就可以借助我们tinker-sup<span class="keyword">port</span>插件进行补丁包的生成。</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>修改 def baseApkDir , 修改 tinkerId</li>
</ol>
<ul>
<li>修改bug</li>
<li>baseApkDir是根据基线版本生成的目录</li>
<li>修改tinkerId</li>
</ul>
<ol start="5">
<li>编译patch包 </li>
</ol>
<p>  点击 buildTinkerPatchRelease，生成patch_signed_7zip.apk上传,然后重启就可以了</p>
<ol start="6">
<li>对于开发设备和全量设备</li>
</ol>
<p>修改</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指定为开发设备</span></span><br><span class="line">   <span class="module-access"><span class="module"><span class="identifier">Bugly</span>.</span></span>set<span class="constructor">IsDevelopmentDevice(<span class="params">getApplication</span>()</span>,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<p> 参考 ：<br>  <a href="https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/">https://bugly.qq.com/docs/user-guide/instruction-manual-android-hotfix/</a><br>  <a href="https://github.com/Tencent/tinker">https://github.com/Tencent/tinker</a><br>  <a href="https://github.com/BuglyDevTeam/Bugly-Android-Demo">https://github.com/BuglyDevTeam/Bugly-Android-Demo</a></p>
<h5 id="UncaughtExceptionHandler-Bugly冲突-不上报日志"><a href="#UncaughtExceptionHandler-Bugly冲突-不上报日志" class="headerlink" title="UncaughtExceptionHandler Bugly冲突 不上报日志"></a>UncaughtExceptionHandler Bugly冲突 不上报日志</h5><p><a href="https://blog.csdn.net/ZPCrobot/article/details/97390156">https://blog.csdn.net/ZPCrobot/article/details/97390156</a></p>
<h5 id="从零开始实现一个插件化框架"><a href="#从零开始实现一个插件化框架" class="headerlink" title="从零开始实现一个插件化框架"></a>从零开始实现一个插件化框架</h5><p><a href="https://blog.csdn.net/qq_22090073/article/details/103946596">https://blog.csdn.net/qq_22090073/article/details/103946596</a></p>
<p><a href="https://www.jianshu.com/p/af8c47fabb12">https://www.jianshu.com/p/af8c47fabb12</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>kmp</title>
    <url>/2021/06/17/kmp/</url>
    <content><![CDATA[<h4 id="蛮力算法"><a href="#蛮力算法" class="headerlink" title="蛮力算法"></a>蛮力算法</h4><ol>
<li><p>i++  j++</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************************</span></span><br><span class="line"><span class="comment"> * Text     :  0   1   2   .   .   .   i-j .   .   .   .   i   .   .   n-1</span></span><br><span class="line"><span class="comment"> *             ------------------------|-------------------|------------</span></span><br><span class="line"><span class="comment"> * Pattern  :                          0   .   .   .   .   j   .   .</span></span><br><span class="line"><span class="comment"> *                                     |-------------------|</span></span><br><span class="line"><span class="comment"> ******************************************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">match</span> <span class="params">( <span class="keyword">char</span>* P, <span class="keyword">char</span>* T )</span> </span>&#123; <span class="comment">//串匹配算法（Brute-force-1）</span></span><br><span class="line">   <span class="keyword">size_t</span> n = <span class="built_in">strlen</span> ( T ), i = <span class="number">0</span>; <span class="comment">//文本串长度、当前接受比对字符的位置</span></span><br><span class="line">   <span class="keyword">size_t</span> m = <span class="built_in">strlen</span> ( P ), j = <span class="number">0</span>; <span class="comment">//模式串长度、当前接受比对字符的位置</span></span><br><span class="line">   <span class="keyword">while</span> ( j &lt; m &amp;&amp; i &lt; n ) <span class="comment">//自左向右逐个比对字符</span></span><br><span class="line">      <span class="comment">/*DSA*/</span>&#123;</span><br><span class="line"><span class="comment">//      /*DSA*/showProgress ( T, P, i - j, j );   getchar();</span></span><br><span class="line">      <span class="keyword">if</span> ( T[i] == P[j] ) <span class="comment">//若匹配</span></span><br><span class="line">         &#123; i ++;  j++; &#125; <span class="comment">//则转到下一对字符</span></span><br><span class="line">      <span class="keyword">else</span> <span class="comment">//否则</span></span><br><span class="line">         &#123; i -= (j - <span class="number">1</span>); j = <span class="number">0</span>; &#125; <span class="comment">//文本串回退、模式串复位   // i j 都在往右走， i -= (j - 1) 相当于i在初始位置 又往右走了一步</span></span><br><span class="line">      <span class="comment">/*DSA*/</span>&#125;</span><br><span class="line">   <span class="keyword">return</span> i - j; <span class="comment">//如何通过返回值，判断匹配结果？</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>i , j++</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/******************************************************************************************</span></span><br><span class="line"><span class="comment"> * Text     :  0   1   2   .   .   .   i   i+1 .   .   .   i+j .   .   n-1</span></span><br><span class="line"><span class="comment"> *             ------------------------|-------------------|------------</span></span><br><span class="line"><span class="comment"> * Pattern  :                          0   1   .   .   .   j   .   .</span></span><br><span class="line"><span class="comment"> *                                     |-------------------|</span></span><br><span class="line"><span class="comment"> ******************************************************************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">match</span> <span class="params">( <span class="keyword">char</span>* P, <span class="keyword">char</span>* T )</span> </span>&#123; <span class="comment">//串匹配算法（Brute-force-2）</span></span><br><span class="line">   <span class="keyword">size_t</span> n = <span class="built_in">strlen</span> ( T ), i = <span class="number">0</span>; <span class="comment">//文本串长度、与模式串首字符的对齐位置</span></span><br><span class="line">   <span class="keyword">size_t</span> m = <span class="built_in">strlen</span> ( P ), j; <span class="comment">//模式串长度、当前接受比对字符的位置</span></span><br><span class="line">   <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; n - m + <span class="number">1</span>; i++ ) &#123; <span class="comment">//文本串从第i个字符起，与</span></span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; m; j++ ) <span class="comment">//模式串中对应的字符逐个比对</span></span><br><span class="line">         <span class="comment">/*DSA*/</span>&#123;<span class="built_in">showProgress</span> ( T, P, i, j ); <span class="built_in">getchar</span>();</span><br><span class="line">         <span class="keyword">if</span> ( T[i + j] != P[j] ) <span class="keyword">break</span>; <span class="comment">//若失配，模式串整体右移一个字符，再做一轮比对</span></span><br><span class="line">         <span class="comment">/*DSA*/</span>&#125;</span><br><span class="line">      <span class="keyword">if</span> ( j &gt;= m ) <span class="keyword">break</span>; <span class="comment">//找到匹配子串</span></span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> i; <span class="comment">//如何通过返回值，判断匹配结果？</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="KMP算法"><a href="#KMP算法" class="headerlink" title="KMP算法"></a>KMP算法</h4><p><img src="/2021/06/17/kmp/1kmp/2021-06-17_21-27-43_kmp.png"></p>
<p>算法主体</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">match</span> <span class="params">( <span class="keyword">char</span>* P, <span class="keyword">char</span>* T )</span> </span>&#123;  <span class="comment">//KMP算法</span></span><br><span class="line">   <span class="keyword">int</span>* next = <span class="built_in">buildNext</span> ( P ); <span class="comment">//构造next表</span></span><br><span class="line">   <span class="keyword">int</span> n = ( <span class="keyword">int</span> ) <span class="built_in">strlen</span> ( T ), i = <span class="number">0</span>; <span class="comment">//文本串指针</span></span><br><span class="line">   <span class="keyword">int</span> m = ( <span class="keyword">int</span> ) <span class="built_in">strlen</span> ( P ), j = <span class="number">0</span>; <span class="comment">//模式串指针</span></span><br><span class="line">   <span class="keyword">while</span> ( j &lt; m  &amp;&amp; i &lt; n ) <span class="comment">//自左向右逐个比对字符</span></span><br><span class="line">      <span class="comment">/*DSA*/</span>&#123;</span><br><span class="line">      <span class="comment">/*DSA*/</span><span class="built_in">showProgress</span> ( T, P, i - j, j );</span><br><span class="line">      <span class="comment">/*DSA*/</span><span class="built_in">printNext</span> ( next, i - j, <span class="built_in">strlen</span> ( P ) );</span><br><span class="line">      <span class="comment">/*DSA*/</span><span class="built_in">getchar</span>(); <span class="built_in">printf</span> ( <span class="string">&quot;\n&quot;</span> );</span><br><span class="line">      <span class="keyword">if</span> ( <span class="number">0</span> &gt; j || T[i] == P[j] ) <span class="comment">//若匹配，或P已移出最左侧（两个判断的次序不可交换）</span></span><br><span class="line">         &#123; i ++;  j ++; &#125; <span class="comment">//则转到下一字符</span></span><br><span class="line">      <span class="keyword">else</span> <span class="comment">//否则</span></span><br><span class="line">         j = next[j]; <span class="comment">//模式串右移（注意：文本串不用回退）</span></span><br><span class="line">      <span class="comment">/*DSA*/</span>&#125;</span><br><span class="line">   <span class="keyword">delete</span> [] next; <span class="comment">//释放next表</span></span><br><span class="line">   <span class="keyword">return</span> i - j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>构建next表</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span>* <span class="title">buildNext</span> <span class="params">( <span class="keyword">char</span>* P )</span> </span>&#123; <span class="comment">//构造模式串P的next表</span></span><br><span class="line">   <span class="keyword">size_t</span> m = <span class="built_in">strlen</span> ( P ), j = <span class="number">0</span>; <span class="comment">//“主”串指针</span></span><br><span class="line">   <span class="keyword">int</span>* N = <span class="keyword">new</span> <span class="keyword">int</span>[m]; <span class="comment">//next表</span></span><br><span class="line">   <span class="keyword">int</span> t = N[<span class="number">0</span>] = <span class="number">-1</span>; <span class="comment">//模式串指针</span></span><br><span class="line">   <span class="keyword">while</span> ( j &lt; m - <span class="number">1</span> )</span><br><span class="line">      <span class="keyword">if</span> ( <span class="number">0</span> &gt; t || P[j] == P[t] ) &#123; <span class="comment">//匹配</span></span><br><span class="line">         j ++; t ++;</span><br><span class="line">         N[j] = t; <span class="comment">//此句可改进...</span></span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="comment">//失配</span></span><br><span class="line">         t = N[t];</span><br><span class="line">   <span class="comment">/*DSA*/</span><span class="built_in">printString</span> ( P ); <span class="built_in">printf</span> ( <span class="string">&quot;\n&quot;</span> );</span><br><span class="line">   <span class="comment">/*DSA*/</span><span class="built_in">printNext</span> ( N, <span class="number">0</span>, m );</span><br><span class="line">   <span class="keyword">return</span> N;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.bilibili.com/video/av3246487/">https://www.bilibili.com/video/av3246487/</a></p>
]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
  </entry>
  <entry>
    <title>linux</title>
    <url>/2017/07/19/linux/</url>
    <content><![CDATA[<h5 id="Linux使用"><a href="#Linux使用" class="headerlink" title="Linux使用"></a>Linux使用</h5><ol>
<li>find  ： $ find . -name ‘my*’   搜索当前目录（含子目录，以下同）中，所有文件名以my开头的文件。 <a href="http://www.ruanyifeng.com/blog/2009/10/5_ways_to_search_for_files_using_the_terminal.html">http://www.ruanyifeng.com/blog/2009/10/5_ways_to_search_for_files_using_the_terminal.html</a></li>
</ol>
<h5 id="ubuntu-wifi热点"><a href="#ubuntu-wifi热点" class="headerlink" title="ubuntu　wifi热点"></a>ubuntu　wifi热点</h5><p><a href="http://blog.csdn.net/sunmc1204953974/article/details/45740853">http://blog.csdn.net/sunmc1204953974/article/details/45740853</a></p>
<h5 id="删除build文件"><a href="#删除build文件" class="headerlink" title="删除build文件"></a>删除build文件</h5><p><code>find . -name &quot;build&quot;  | xargs rm -rf</code></p>
<img class="kroki" src="/2017/07/19/linux/data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMjM2cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDo1NDlweDtoZWlnaHQ6MjM2cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgNTQ5IDIzNiIgd2lkdGg9IjU0OXB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImYxNTBrdW1zZTNiMDBuIiB3aWR0aD0iMzAwJSIgeD0iLTEiIHk9Ii0xIj48ZmVHYXVzc2lhbkJsdXIgcmVzdWx0PSJibHVyT3V0IiBzdGREZXZpYXRpb249IjIuMCIvPjxmZUNvbG9yTWF0cml4IGluPSJibHVyT3V0IiByZXN1bHQ9ImJsdXJPdXQyIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgLjQgMCIvPjxmZU9mZnNldCBkeD0iNC4wIiBkeT0iNC4wIiBpbj0iYmx1ck91dDIiIHJlc3VsdD0iYmx1ck91dDMiLz48ZmVCbGVuZCBpbj0iU291cmNlR3JhcGhpYyIgaW4yPSJibHVyT3V0MyIgbW9kZT0ibm9ybWFsIi8+PC9maWx0ZXI+PC9kZWZzPjxnPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wO3N0cm9rZS1kYXNoYXJyYXk6NS4wLDUuMDsiIHgxPSIyOCIgeDI9IjI4IiB5MT0iNDAuNzk5OSIgeTI9IjE5My4yIi8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheTo1LjAsNS4wOyIgeDE9IjUxNi41IiB4Mj0iNTE2LjUiIHkxPSI0MC43OTk5IiB5Mj0iMTkzLjIiLz48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZjE1MGt1bXNlM2IwMG4pIiBoZWlnaHQ9IjMwLjc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQzIiB4PSI1IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjkiIHg9IjEyIiB5PSIyNS45OTk5Ij5BbGljZTwvdGV4dD48cmVjdCBmaWxsPSIjRkVGRUNFIiBmaWx0ZXI9InVybCgjZjE1MGt1bXNlM2IwMG4pIiBoZWlnaHQ9IjMwLjc5OTkiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS41OyIgd2lkdGg9IjQzIiB4PSI1IiB5PSIxOTIuMiIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI5IiB4PSIxMiIgeT0iMjEzLjE5OTkiPkFsaWNlPC90ZXh0PjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmMTUwa3Vtc2UzYjAwbikiIGhlaWdodD0iMzAuNzk5OSIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB3aWR0aD0iMzgiIHg9IjQ5NS41IiB5PSI1Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9IjUwMi41IiB5PSIyNS45OTk5Ij5Cb2I8L3RleHQ+PHJlY3QgZmlsbD0iI0ZFRkVDRSIgZmlsdGVyPSJ1cmwoI2YxNTBrdW1zZTNiMDBuKSIgaGVpZ2h0PSIzMC43OTk5IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIzOCIgeD0iNDk1LjUiIHk9IjE5Mi4yIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTQiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMjQiIHg9IjUwMi41IiB5PSIyMTMuMTk5OSI+Qm9iPC90ZXh0PjxyZWN0IGZpbGw9IiNFRUVFRUUiIGZpbHRlcj0idXJsKCNmMTUwa3Vtc2UzYjAwbikiIGhlaWdodD0iMyIgc3R5bGU9InN0cm9rZTojRUVFRUVFO3N0cm9rZS13aWR0aDoxLjA7IiB3aWR0aD0iNTQyLjUiIHg9IjAiIHk9IjcxLjU5OTkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIwIiB4Mj0iNTQyLjUiIHkxPSI3MS41OTk5IiB5Mj0iNzEuNTk5OSIvPjxsaW5lIHN0eWxlPSJzdHJva2U6IzAwMDAwMDtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjAiIHgyPSI1NDIuNSIgeTE9Ijc0LjU5OTkiIHkyPSI3NC41OTk5Ii8+PHJlY3QgZmlsbD0iI0VFRUVFRSIgZmlsdGVyPSJ1cmwoI2YxNTBrdW1zZTNiMDBuKSIgaGVpZ2h0PSIyMy42IiBzdHlsZT0ic3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjIuMDsiIHdpZHRoPSI5NSIgeD0iMjIzLjc1IiB5PSI2MC43OTk5Ii8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9Ijc3IiB4PSIyMjkuNzUiIHk9Ijc3Ljc5OTkiPkluaXRpYWxpemF0aW9uPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNTA0LjUsMTEyLDUxNC41LDExNiw1MDQuNSwxMjAsNTA4LjUsMTE2IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiIHgxPSIyOC41IiB4Mj0iNTEwLjUiIHkxPSIxMTYiIHkyPSIxMTYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0NjQiIHg9IjM1LjUiIHk9IjExMS40Ij46IENhbiB5b3Ugc29sdmU6ICBCb2IgLS0mZ3Q7IEFsaWNlOiAgYWN0aXZhdGUgQWxpY2UgI0ZGQkJCQiBub3RlIGxlZnQ6IHRoaXMgaXMgYSBmaXJzdCBub3RlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iNTA0LjUsMTQxLjYsNTE0LjUsMTQ1LjYsNTA0LjUsMTQ5LjYsNTA4LjUsMTQ1LjYiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxsaW5lIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIgeDE9IjI4LjUiIHgyPSI1MTAuNSIgeTE9IjE0NS42IiB5Mj0iMTQ1LjYiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIxOTAiIHg9IjM1LjUiIHk9IjE0MSI+QW5vdGhlciBkaWFsb2d1ZSBkZWFjdGl2YXRlIEFsaWNlPC90ZXh0Pjxwb2x5Z29uIGZpbGw9IiNBODAwMzYiIHBvaW50cz0iMzkuNSwxNzEuMiwyOS41LDE3NS4yLDM5LjUsMTc5LjIsMzUuNSwxNzUuMiIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7c3Ryb2tlLWRhc2hhcnJheToyLjAsMi4wOyIgeDE9IjMzLjUiIHgyPSI1MTUuNSIgeTE9IjE3NS4yIiB5Mj0iMTc1LjIiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMyIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI5NiIgeD0iNDUuNSIgeT0iMTcwLjYiPkFub3RoZXIgZGlhbG9ndWU8L3RleHQ+PCEtLU1ENT1bZGJkNDkzYmM5Y2I5ZTljYzZhYjIwMjkzODIyNmViNzJdCkBzdGFydHVtbA0KDQo9PSBJbml0aWFsaXphdGlvbiA9PQ0KDQpBbGljZSAtPiBCb2I6IDogQ2FuIHlvdSBzb2x2ZTogIEJvYiAtIC0+IEFsaWNlOiAgYWN0aXZhdGUgQWxpY2UgI0ZGQkJCQiBub3RlIGxlZnQ6IHRoaXMgaXMgYSBmaXJzdCBub3RlDQoNCkFsaWNlIC0+IEJvYjogQW5vdGhlciBkaWFsb2d1ZSBkZWFjdGl2YXRlIEFsaWNlDQoNCkFsaWNlIDwtIC0gQm9iOiBBbm90aGVyIGRpYWxvZ3VlDQoNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS44KFNhdCBKdW4gMjYgMDg6MjA6NTkgR01UIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IFVTCi0tPjwvZz48L3N2Zz4=">



<img class="kroki" src="/2017/07/19/linux/data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiBjb250ZW50U2NyaXB0VHlwZT0iYXBwbGljYXRpb24vZWNtYXNjcmlwdCIgY29udGVudFN0eWxlVHlwZT0idGV4dC9jc3MiIGhlaWdodD0iMjE2cHgiIHByZXNlcnZlQXNwZWN0UmF0aW89Im5vbmUiIHN0eWxlPSJ3aWR0aDoxMzZweDtoZWlnaHQ6MjE2cHg7YmFja2dyb3VuZDojRkZGRkZGOyIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMTM2IDIxNiIgd2lkdGg9IjEzNnB4IiB6b29tQW5kUGFuPSJtYWduaWZ5Ij48ZGVmcz48ZmlsdGVyIGhlaWdodD0iMzAwJSIgaWQ9ImZ4djBuZGc3N2FrcmciIHdpZHRoPSIzMDAlIiB4PSItMSIgeT0iLTEiPjxmZUdhdXNzaWFuQmx1ciByZXN1bHQ9ImJsdXJPdXQiIHN0ZERldmlhdGlvbj0iMi4wIi8+PGZlQ29sb3JNYXRyaXggaW49ImJsdXJPdXQiIHJlc3VsdD0iYmx1ck91dDIiIHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAuNCAwIi8+PGZlT2Zmc2V0IGR4PSI0LjAiIGR5PSI0LjAiIGluPSJibHVyT3V0MiIgcmVzdWx0PSJibHVyT3V0MyIvPjxmZUJsZW5kIGluPSJTb3VyY2VHcmFwaGljIiBpbjI9ImJsdXJPdXQzIiBtb2RlPSJub3JtYWwiLz48L2ZpbHRlcj48L2RlZnM+PGc+PCEtLU1ENT1bYWE3ZjU4NjUzMmUxODcxOWU2Y2VmYTcwZmM2NTA1ODNdCmNsYXNzIE9iamVjdC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmeHYwbmRnNzdha3JnKSIgaGVpZ2h0PSI2MS4xOTk5IiBpZD0iT2JqZWN0IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSI2NiIgeD0iMzEuNSIgeT0iNyIvPjxlbGxpcHNlIGN4PSI0Ni41IiBjeT0iMjMiIGZpbGw9IiNBREQxQjIiIHJ4PSIxMSIgcnk9IjExIiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuMDsiLz48cGF0aCBkPSJNNDUuODU5NCwyNi43ODEzIFE0Ni42NTYzLDI2Ljc4MTMgNDcuMjE4OCwyNi41OTM4IFE0Ny43OTY5LDI2LjM5MDYgNDguMDMxMywyNi4xNzE5IFE0OC4yODEzLDI1LjkzNzUgNDguNTE1NiwyNS43NSBRNDguNzY1NiwyNS41NDY5IDQ4Ljk4NDQsMjUuNTQ2OSBRNDkuMzI4MSwyNS41NDY5IDQ5LjU3ODEsMjUuODEyNSBRNDkuODQzOCwyNi4wNjI1IDQ5Ljg0MzgsMjYuMzkwNiBRNDkuODQzOCwyNy4xMjUgNDguNjcxOSwyNy44MTI1IFE0Ny41MTU2LDI4LjQ4NDQgNDUuODEyNSwyOC40ODQ0IFE0My42NTYzLDI4LjQ4NDQgNDIuMjM0NCwyNy4yMTg4IFE0MC44MTI1LDI1Ljk1MzEgNDAuODEyNSwyNC4wMTU2IEw0MC44MTI1LDIyLjg5MDYgUTQwLjgxMjUsMjAuODU5NCA0Mi4xNDA2LDE5LjQ4NDQgUTQzLjQ2ODgsMTguMDkzOCA0NS40Mzc1LDE4LjA5MzggUTQ2LjYyNSwxOC4wOTM4IDQ3Ljg0MzgsMTguNjcxOSBMNDguMDE1NiwxOC43NSBRNDguMzEyNSwxOC4zNDM4IDQ4LjczNDQsMTguMzQzOCBRNDkuMjE4OCwxOC4zNDM4IDQ5LjM5MDYsMTguNjQwNiBRNDkuNTc4MSwxOC45MjE5IDQ5LjU3ODEsMTkuNDY4OCBMNDkuNTc4MSwyMC44OTA2IFE0OS41NzgxLDIyLjAxNTYgNDguNzM0NCwyMi4wMTU2IFE0OC40MjE5LDIyLjAxNTYgNDguMjE4OCwyMS44NDM4IFE0OC4wMzEzLDIxLjY3MTkgNDcuOTg0NCwyMS41MzEzIFE0Ny45NTMxLDIxLjM3NSA0Ny45MDYzLDIxLjEwOTQgUTQ3Ljc5NjksMjAuNTkzOCA0Ny4yODEzLDIwLjI4MTMgUTQ2Ljc2NTYsMTkuOTY4OCA0Ni4zMTI1LDE5Ljg5MDYgUTQ1Ljg3NSwxOS43OTY5IDQ1LjUsMTkuNzk2OSBRNDQuMjE4OCwxOS43OTY5IDQzLjM1OTQsMjAuNjcxOSBRNDIuNTE1NiwyMS41NDY5IDQyLjUxNTYsMjIuODkwNiBMNDIuNTE1NiwyMy45ODQ0IFE0Mi41MTU2LDI1LjI2NTYgNDMuNDIxOSwyNi4wMzEzIFE0NC4zMjgxLDI2Ljc4MTMgNDUuODU5NCwyNi43ODEzIFogIiBmaWxsPSIjMDAwMDAwIi8+PHRleHQgZmlsbD0iIzAwMDAwMCIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGxlbmd0aEFkanVzdD0ic3BhY2luZyIgdGV4dExlbmd0aD0iMzQiIHg9IjYwLjUiIHk9IjI3LjgiPk9iamVjdDwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzMi41IiB4Mj0iOTYuNSIgeTE9IjM5IiB5Mj0iMzkiLz48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSIzMi41IiB4Mj0iOTYuNSIgeTE9IjQ3IiB5Mj0iNDciLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMSIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSIzOSIgeD0iMzcuNSIgeT0iNjEuOTk5OSI+ZXF1YWxzKCk8L3RleHQ+PCEtLU1ENT1bYWI4ODcxZWQ2MzdmNDA3MDdiODY2YmE2NTk3NzM0YmNdCmNsYXNzIEFycmF5TGlzdC0tPjxyZWN0IGZpbGw9IiNGRUZFQ0UiIGZpbHRlcj0idXJsKCNmeHYwbmRnNzdha3JnKSIgaGVpZ2h0PSI3NC4zOTk4IiBpZD0iQXJyYXlMaXN0IiBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHdpZHRoPSIxMTUiIHg9IjciIHk9IjEyOCIvPjxlbGxpcHNlIGN4PSIzNy43NSIgY3k9IjE0NCIgZmlsbD0iI0FERDFCMiIgcng9IjExIiByeT0iMTEiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwYXRoIGQ9Ik0zNy4xMDk0LDE0Ny43ODEzIFEzNy45MDYzLDE0Ny43ODEzIDM4LjQ2ODgsMTQ3LjU5MzggUTM5LjA0NjksMTQ3LjM5MDYgMzkuMjgxMywxNDcuMTcxOSBRMzkuNTMxMywxNDYuOTM3NSAzOS43NjU2LDE0Ni43NSBRNDAuMDE1NiwxNDYuNTQ2OSA0MC4yMzQ0LDE0Ni41NDY5IFE0MC41NzgxLDE0Ni41NDY5IDQwLjgyODEsMTQ2LjgxMjUgUTQxLjA5MzgsMTQ3LjA2MjUgNDEuMDkzOCwxNDcuMzkwNiBRNDEuMDkzOCwxNDguMTI1IDM5LjkyMTksMTQ4LjgxMjUgUTM4Ljc2NTYsMTQ5LjQ4NDQgMzcuMDYyNSwxNDkuNDg0NCBRMzQuOTA2MywxNDkuNDg0NCAzMy40ODQ0LDE0OC4yMTg4IFEzMi4wNjI1LDE0Ni45NTMxIDMyLjA2MjUsMTQ1LjAxNTYgTDMyLjA2MjUsMTQzLjg5MDYgUTMyLjA2MjUsMTQxLjg1OTQgMzMuMzkwNiwxNDAuNDg0NCBRMzQuNzE4OCwxMzkuMDkzOCAzNi42ODc1LDEzOS4wOTM4IFEzNy44NzUsMTM5LjA5MzggMzkuMDkzOCwxMzkuNjcxOSBMMzkuMjY1NiwxMzkuNzUgUTM5LjU2MjUsMTM5LjM0MzggMzkuOTg0NCwxMzkuMzQzOCBRNDAuNDY4OCwxMzkuMzQzOCA0MC42NDA2LDEzOS42NDA2IFE0MC44MjgxLDEzOS45MjE5IDQwLjgyODEsMTQwLjQ2ODggTDQwLjgyODEsMTQxLjg5MDYgUTQwLjgyODEsMTQzLjAxNTYgMzkuOTg0NCwxNDMuMDE1NiBRMzkuNjcxOSwxNDMuMDE1NiAzOS40Njg4LDE0Mi44NDM4IFEzOS4yODEzLDE0Mi42NzE5IDM5LjIzNDQsMTQyLjUzMTMgUTM5LjIwMzEsMTQyLjM3NSAzOS4xNTYzLDE0Mi4xMDk0IFEzOS4wNDY5LDE0MS41OTM4IDM4LjUzMTMsMTQxLjI4MTMgUTM4LjAxNTYsMTQwLjk2ODggMzcuNTYyNSwxNDAuODkwNiBRMzcuMTI1LDE0MC43OTY5IDM2Ljc1LDE0MC43OTY5IFEzNS40Njg4LDE0MC43OTY5IDM0LjYwOTQsMTQxLjY3MTkgUTMzLjc2NTYsMTQyLjU0NjkgMzMuNzY1NiwxNDMuODkwNiBMMzMuNzY1NiwxNDQuOTg0NCBRMzMuNzY1NiwxNDYuMjY1NiAzNC42NzE5LDE0Ny4wMzEzIFEzNS41NzgxLDE0Ny43ODEzIDM3LjEwOTQsMTQ3Ljc4MTMgWiAiIGZpbGw9IiMwMDAwMDAiLz48dGV4dCBmaWxsPSIjMDAwMDAwIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgbGVuZ3RoQWRqdXN0PSJzcGFjaW5nIiB0ZXh0TGVuZ3RoPSI0OCIgeD0iNTUuMjUiIHk9IjE0OC44Ij5BcnJheUxpc3Q8L3RleHQ+PGxpbmUgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjU7IiB4MT0iOCIgeDI9IjEyMSIgeTE9IjE2MCIgeTI9IjE2MCIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjEwMyIgeD0iMTMiIHk9IjE3NC45OTk5Ij5PYmplY3RbXSBlbGVtZW50RGF0YTwvdGV4dD48bGluZSBzdHlsZT0ic3Ryb2tlOiNBODAwMzY7c3Ryb2tlLXdpZHRoOjEuNTsiIHgxPSI4IiB4Mj0iMTIxIiB5MT0iMTgxLjE5OTkiIHkyPSIxODEuMTk5OSIvPjx0ZXh0IGZpbGw9IiMwMDAwMDAiIGZvbnQtZmFtaWx5PSJzYW5zLXNlcmlmIiBmb250LXNpemU9IjExIiBsZW5ndGhBZGp1c3Q9InNwYWNpbmciIHRleHRMZW5ndGg9IjI2IiB4PSIxMyIgeT0iMTk2LjE5OTgiPnNpemUoKTwvdGV4dD48IS0tTUQ1PVs3OGVkM2Q1NGM2YWQ5NmZiNjQzNGE0ZTQ1YWE0YjVmMF0KcmV2ZXJzZSBsaW5rIE9iamVjdCB0byBBcnJheUxpc3QtLT48cGF0aCBjb2RlTGluZT0iMSIgZD0iTTY0LjUsODguNSBDNjQuNSwxMDEuNjIgNjQuNSwxMTUuNTEgNjQuNSwxMjcuNzYgIiBmaWxsPSJub25lIiBpZD0iT2JqZWN0LWJhY2t0by1BcnJheUxpc3QiIHN0eWxlPSJzdHJva2U6I0E4MDAzNjtzdHJva2Utd2lkdGg6MS4wOyIvPjxwb2x5Z29uIGZpbGw9Im5vbmUiIHBvaW50cz0iNTcuNSw4OC4yNCw2NC41LDY4LjI0LDcxLjUsODguMjQsNTcuNSw4OC4yNCIgc3R5bGU9InN0cm9rZTojQTgwMDM2O3N0cm9rZS13aWR0aDoxLjA7Ii8+PCEtLU1ENT1bYTMzZmQyZWZlOTBkMDMwYzIwMGM1NGJjOTQ3NTA0ZmNdCkBzdGFydHVtbA0KT2JqZWN0IDx8LSAtIEFycmF5TGlzdA0KT2JqZWN0IDogZXF1YWxzKCkNCkFycmF5TGlzdCA6IE9iamVjdFtdIGVsZW1lbnREYXRhDQpBcnJheUxpc3QgOiBzaXplKCkNCkBlbmR1bWwNCgpQbGFudFVNTCB2ZXJzaW9uIDEuMjAyMS44KFNhdCBKdW4gMjYgMDg6MjA6NTkgR01UIDIwMjEpCihHUEwgc291cmNlIGRpc3RyaWJ1dGlvbikKSmF2YSBSdW50aW1lOiBPcGVuSkRLIFJ1bnRpbWUgRW52aXJvbm1lbnQKSlZNOiBPcGVuSkRLIDY0LUJpdCBTZXJ2ZXIgVk0KRGVmYXVsdCBFbmNvZGluZzogVVRGLTgKTGFuZ3VhZ2U6IGVuCkNvdW50cnk6IFVTCi0tPjwvZz48L3N2Zz4=">]]></content>
      <categories>
        <category>LINUX</category>
      </categories>
  </entry>
  <entry>
    <title>mina</title>
    <url>/2018/11/03/mina/</url>
    <content><![CDATA[<p>MINA配置</p>
<ul>
<li>下载 <a href="http://mina.apache.org/mina-project/downloads.html">http://mina.apache.org/mina-project/downloads.html</a>   <a href="http://mirrors.shu.edu.cn/apache/mina/mina/2.0.19/apache-mina-2.0.19-bin.zip"><strong>apache-mina-2.0.19-bin.zip</strong></a> 解压</li>
<li>下载 <a href="https://www.slf4j.org/download.html">https://www.slf4j.org/download.html</a>   slf4j-1.7.25.zip解压</li>
</ul>
<p>在MineUtil项目中有demo实现</p>
<p>IM键盘</p>
<p><a href="https://juejin.im/post/5ef850c9f265da231019f6e4">https://juejin.im/post/5ef850c9f265da231019f6e4</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
  </entry>
  <entry>
    <title>onActivityResult</title>
    <url>/2017/09/26/onActivityResult/</url>
    <content><![CDATA[<h4 id="传统方式"><a href="#传统方式" class="headerlink" title="传统方式"></a>传统方式</h4><h6 id="单个页面跳转"><a href="#单个页面跳转" class="headerlink" title="单个页面跳转"></a>单个页面跳转</h6><p> 主要有三个方法实现</p>
<ul>
<li> startActivityForResult(@RequiresPermission Intent intent, int requestCode)</li>
<li> setResult(int resultCode, Intent data)</li>
<li> onActivityResult(int requestCode, int resultCode, Intent data)</li>
</ul>
<p>下面是简单例子<br>跳转MainActivity</p>
<p>目标SecondAcitivty</p>
<p>其中数据传递很简单,特别注意requestCode，resultCode不同的区分的区别</p>
<ul>
<li><p>requestCode：假设  MainActivity　button1 button2到SecondAcitivty,回来的在onActivityResult就需要</p>
<pre><code>   判断是哪个button点击的
</code></pre>
</li>
<li><p>resultCode: 假设MainActivity　button1跳转到SecondAcitivty,  button2到ThirdActiivty,回来后onActivityResult</p>
<pre><code>   就需要判断是哪个Activity回来的
</code></pre>
<p>   参考:<a href="http://blog.csdn.net/jiangwei0910410003/article/details/16983049">http://blog.csdn.net/jiangwei0910410003/article/details/16983049</a></p>
</li>
</ul>
<p><em>注意</em>:onActivityResult方法用的算比较普遍，刚好有个困惑，回传数据时<code>intent.putExtra(&quot;text&quot;,122);</code>  使用 <code>  String couponId = data.getStringExtra(&quot;text&quot;);</code> 接收时为null,里面跳转和回传,存的值是int类型，获取string类型</p>
<h6 id="Fragment接收onActivityResult"><a href="#Fragment接收onActivityResult" class="headerlink" title="Fragment接收onActivityResult"></a>Fragment接收onActivityResult</h6><p><em>必须使用Fragment 的 startActivityForResult()</em>*</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">startForResult</span><span class="params">(Activity activity, Fragment fragment)</span> </span>&#123;</span><br><span class="line">       Intent intent = <span class="keyword">new</span> Intent(activity, LoginActivity.class);</span><br><span class="line">       fragment.startActivityForResult(intent, REQUEST_CODE_MINE_FRAGMENT);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>setResult(RESULT_OK, result); ,finish()后 onActivityResult 返回 resultCode </p>
<h4 id="Activity嵌套Fragment-他们各自发起startActivityForResult发起数据请求"><a href="#Activity嵌套Fragment-他们各自发起startActivityForResult发起数据请求" class="headerlink" title="Activity嵌套Fragment,他们各自发起startActivityForResult发起数据请求"></a>Activity嵌套Fragment,他们各自发起startActivityForResult发起数据请求</h4><h5 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h5><p> <img src="/2017/09/26/onActivityResult/20161119124707067.jpg"></p>
<ul>
<li><p>Fragment发起</p>
<p> Fragment onActivityResult能接收。Activity onActivityResult能接收,但是requestCode不正确。</p>
</li>
<li><p>Activity发起</p>
<p> Fragment不能接收。 Activity onActivityResult能接收。</p>
</li>
</ul>
<h5 id="代码验证"><a href="#代码验证" class="headerlink" title="代码验证"></a>代码验证</h5><p>FirstResultActivity</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> requestCode = <span class="number">1000</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">initView</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.initView()</span><br><span class="line">      <span class="keyword">val</span> intent = Intent(<span class="keyword">this</span>, SecondResultActivity::<span class="keyword">class</span>.java)</span><br><span class="line">      findViewById&lt;View&gt;(R.id.bt_activity).setOnClickListener &#123;</span><br><span class="line">          startActivityForResult(intent, requestCode)</span><br><span class="line">          Timber.i(<span class="string">&quot;startActivityForResult <span class="variable">$requestCode</span>&quot;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">      <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">      Timber.d(<span class="string">&quot;onActivityResult resultCode <span class="variable">$requestCode</span> resultCode <span class="variable">$resultCode</span>  data  <span class="subst">$&#123;data?.getStringExtra(SecondResultActivity.sData)&#125;</span>&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initFragment</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">val</span> ftn = supportFragmentManager.beginTransaction().replace(R.id.fl_content, newInstance(<span class="string">&quot;数据&quot;</span>))</span><br><span class="line">      ftn.commit()</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ResultOkFragment</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">val</span> requestCode: <span class="built_in">Int</span> = <span class="number">2000</span></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityCreated</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityCreated(savedInstanceState)</span><br><span class="line">    <span class="keyword">val</span> intent = Intent(context, SecondResultActivity::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    bt_fragment.setOnClickListener &#123;</span><br><span class="line">        startActivityForResult(intent, requestCode)</span><br><span class="line">        Timber.d(<span class="string">&quot;startActivityForResult <span class="variable">$requestCode</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onActivityResult</span><span class="params">(requestCode: <span class="type">Int</span>, resultCode: <span class="type">Int</span>, <span class="keyword">data</span>: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onActivityResult(requestCode, resultCode, <span class="keyword">data</span>)</span><br><span class="line">    Timber.d(<span class="string">&quot;onActivityResult resultCode <span class="variable">$requestCode</span> resultCode <span class="variable">$resultCode</span>  data 			<span class="subst">$&#123;data?.getStringExtra(SecondResultActivity.sData)&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SecondResultActivity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">setResult(<span class="number">21</span>, <span class="keyword">new</span> Intent().putExtra(sData, <span class="string">&quot;我要回调啦!!!&quot;</span>));</span><br><span class="line">finish();</span><br></pre></td></tr></table></figure>



<ul>
<li><p>Activity发起</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">I</span>/FirstResultActivity$initView: startActivityForResult <span class="number">1000</span></span><br><span class="line"><span class="attribute">D</span>/FirstResultActivity: onActivityResult resultCode <span class="number">1000</span> resultCode <span class="number">21</span>  data  我要回调啦!!!</span><br></pre></td></tr></table></figure></li>
<li><p>Fragment发起</p>
<figure class="highlight erlang-repl"><table><tr><td class="code"><pre><span class="line">D/ResultOkFragment$onActivityCreated: startActivityForResult <span class="number">2000</span></span><br><span class="line">D/ResultOkFragment: onActivityResult resultCode <span class="number">2000</span> resultCode <span class="number">21</span>  data 我要回调啦!!!</span><br><span class="line">D/FirstResultActivity: onActivityResult resultCode <span class="number">329680</span> resultCode <span class="number">21</span>  data  我要回调啦!!!</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="跳转多个页面-回来"><a href="#跳转多个页面-回来" class="headerlink" title="跳转多个页面 回来"></a>跳转多个页面 回来</h4><p>中间页面不能finish，也需要在onActivityResult方法内部 起到桥梁作用，回传数据</p>
<p><a href="http://blog.csdn.net/lanyachuanshu/article/details/52172143">http://blog.csdn.net/lanyachuanshu/article/details/52172143</a><br><a href="https://developer.android.com/training/basics/intents/result.html">https://developer.android.com/training/basics/intents/result.html</a></p>
<p><a href="http://45.77.222.97:3000/root/MineUtils/src/master/app/src/main/java/com/jonzhou/mineutils/result/FirstResultActivity.java">http://45.77.222.97:3000/root/MineUtils/src/master/app/src/main/java/com/jonzhou/mineutils/result/FirstResultActivity.java</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzAxMTI4MTkwNQ==&amp;mid=2650826252&amp;idx=1&amp;sn=9ec620d630706c9f8de328e87bb8a0f1&amp;chksm=80b7b292b">https://mp.weixin.qq.com/s?__biz=MzAxMTI4MTkwNQ==&amp;mid=2650826252&amp;idx=1&amp;sn=9ec620d630706c9f8de328e87bb8a0f1&amp;chksm=80b7b292b</a></p>
<h5 id="ActivityResultContract新方式"><a href="#ActivityResultContract新方式" class="headerlink" title="ActivityResultContract新方式"></a>ActivityResultContract新方式</h5><p><a href="https://mp.weixin.qq.com/s/o2_2DeAIcJGYSvm2WlhUxg">https://mp.weixin.qq.com/s/o2_2DeAIcJGYSvm2WlhUxg</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>proguard</title>
    <url>/2017/12/19/proguard/</url>
    <content><![CDATA[<h1 id="ProGuard中间文件"><a href="#ProGuard中间文件" class="headerlink" title="ProGuard中间文件"></a>ProGuard中间文件</h1><p>开启ProGuard，Android工程被Build后，会生成以下文件：<project_root>\app\build\outputs\mapping\release </project_root></p>
<ul>
<li><p>dump.txt<br>apk文件中所有类的构成一览 </p>
</li>
<li><p>mapping.txt<br>记录了混淆后的名字与混淆前的名字的对应关系，每一次混淆结果和映射关系都不一样。<br>当遇到Bug是，查看到的堆信息，要和混淆前的源码关联起来，所以管理这个文件很重要。<br>retrace.bat -verbose mapping.txt stacktrace.txt </p>
<blockquote>
<p>com.rensanning.example.androidsample.User -&gt; com.rensanning.example.androidsample.g:<br>  java.lang.String name -&gt; a<br>  java.lang.String hometown -&gt; b<br>  java.util.ArrayList getUsers() -&gt; a</p>
</blockquote>
</li>
<li><p>seeds.txt<br>未被混淆的类和方法一览 </p>
</li>
<li><p>usage.txt<br>记录了从apk文件中删掉的代码。这个文件一定要认真确认，是否这些代码真的是多余的。</p>
</li>
</ul>
<p><a href="https://www.jianshu.com/p/6a07046e65f4">https://www.jianshu.com/p/6a07046e65f4</a></p>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/50451259">http://blog.csdn.net/guolin_blog/article/details/50451259</a><br><a href="https://developer.android.com/studio/build/shrink-code.html?hl=zh-cn">https://developer.android.com/studio/build/shrink-code.html?hl=zh-cn</a></p>
<p><a href="https://mp.weixin.qq.com/s/WmJyiA3fDNriw5qXuoA9MA">https://mp.weixin.qq.com/s/WmJyiA3fDNriw5qXuoA9MA</a></p>
<h5 id="apktool-判断是否混淆"><a href="#apktool-判断是否混淆" class="headerlink" title="apktool 判断是否混淆"></a>apktool 判断是否混淆</h5><ul>
<li><p>最快的方式</p>
<p>把Apk后缀改成 zip ,解压后把 classes.dex 文件拖到 jadx里面</p>
</li>
</ul>
<p><a href="https://blog.csdn.net/xiaohai695943820/article/details/72367896">https://blog.csdn.net/xiaohai695943820/article/details/72367896</a></p>
<p><a href="https://www.itread01.com/content/1548717866.html">https://www.itread01.com/content/1548717866.html</a></p>
<ul>
<li>反编译工具介绍</li>
</ul>
<p><a href="https://www.cnblogs.com/zhen-android/p/7830249.html">https://www.cnblogs.com/zhen-android/p/7830249.html</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>proguard</tag>
      </tags>
  </entry>
  <entry>
    <title>resume</title>
    <url>/2020/07/15/resume/</url>
    <content><![CDATA[<p><a href="https://juejin.im/post/5e801a49e51d45470e2bc8bf">https://juejin.im/post/5e801a49e51d45470e2bc8bf</a></p>
<p><a href="https://wanandroid.com/blog/show/2754">https://wanandroid.com/blog/show/2754</a></p>
<p> <a href="https://mp.weixin.qq.com/s/AJ4QUqdYMeQWgWEQAFPsww">https://mp.weixin.qq.com/s/AJ4QUqdYMeQWgWEQAFPsww</a></p>
<p><a href="https://juejin.im/post/6876968255597051917">https://juejin.im/post/6876968255597051917</a></p>
<h4 id="APP模式-MVC-MVP-MVVM"><a href="#APP模式-MVC-MVP-MVVM" class="headerlink" title="APP模式 MVC MVP. MVVM:"></a>APP模式 MVC MVP. MVVM:</h4><p>面试题</p>
<ul>
<li><p>mvp与mvvm的区别，mvvm怎么更新UI</p>
</li>
<li><p>讲讲mvc,mvp模式，presenter内存泄漏的问题</p>
</li>
<li><p>代理模式与装饰模式的区别，手写一个静态代理，一个动态代理</p>
</li>
<li><p>MVP怎么处理内存泄漏</p>
</li>
<li><p><strong>Mvp与Mvvm有什么区别?</strong></p>
</li>
<li><p>mvvm双向数据绑定的原理是怎样的？ViewModel</p>
</li>
<li><p>你在项目中有用到什么设计模式吗？</p>
</li>
<li><p>单例模式有什么缺点？</p>
</li>
<li><p>动画里面用到了什么设计模式？</p>
</li>
<li><p>OkHttp里面用到了什么设计模式？</p>
</li>
<li><p>谈谈设计模式，你了解多少，运用了多少？</p>
</li>
<li><p>MVP</p>
<p>Presenter 的作用类似于MVC中的Controller,但是其会反作用与View层，Model层的数据更新会被首先反馈到</p>
<p>Presenter,由Presenter优先处理并决定是否刷新以及刷新哪个View,也就是说Presenter完全将View层与Model层</p>
<p>隔离开，充当一个名副其实的中间人角色.</p>
</li>
<li><p>MVVM</p>
<p>MVVM则是思想的完全变革。它是将“数据模型数据双向绑定”的思想作为核心，因此在View和Model之间没有联系，通过ViewModel进行交互，而且Model和ViewModel之间的交互是双向的，因此视图的数据的变化会同时修改数据源，而数据源数据的变化也会立即反应到View上</p>
<p>缺点</p>
<p>1、过于简单的图形界面不适用，或说牛刀杀鸡。<br>2、对于大型的图形应用程序，视图状态较多，ViewModel的构建和维护的成本都会比较高。<br>3、数据绑定的声明是指令式地写在View的模版当中的，这些内容是没办法去打断点debug的。</p>
</li>
</ul>
<h4 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h4><h5 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h5><ol>
<li><p>设计模式六大原则1-单一职责原则</p>
</li>
<li><p>设计模式六大原则2-里氏替换原则</p>
<blockquote>
<p>子类必须实现父类的抽象方法，但不得重写（覆盖）父类的非抽象（已实现）方法，里氏替换原则规定，子类不能覆写父类已实现的方法。父类中已实现的方法其实是一种已定好的规范和契约，如果我们随意的修改了它，那么可能会带来意想不到的错误。</p>
<p>子类完美继承父类的设计初衷，并做了增强</p>
</blockquote>
<p><a href="https://www.jianshu.com/p/cf9f3c7c0df5">https://www.jianshu.com/p/cf9f3c7c0df5</a></p>
</li>
<li><p>设计模式六大原则3-依赖倒置原则</p>
<blockquote>
<p>高层模块不应该依赖于底层模块，两者都应该依赖于抽象，抽象不应该依赖于细节，细节应该依赖于抽象</p>
</blockquote>
</li>
<li><p>设计模式六大原则4-接口隔离原则</p>
<p>接口隔离原则:Clients should not be forced to depend upon interfaces that they do not use.与外部关系上只依赖需要的抽象</p>
<blockquote>
<p>接口隔离原则的关键是接口以及这个接口要小，如何小呢，也就是我们要为专门的类创建专门的接口，这个接口只对它有效，不要试图让一个接口包罗万象，要建立最小的依赖关系</p>
</blockquote>
<p><a href="https://blog.csdn.net/dingshuo168/article/details/103531805">https://blog.csdn.net/dingshuo168/article/details/103531805</a></p>
</li>
<li><p>设计模式六大原则5-迪米特法则</p>
<p>减少依赖 Each unit should have only limited knowledge about other units: only units “closely” related to the current unit. Or: Each unit should only talk to its friends; Don’t talk to strangers</p>
<blockquote>
<p>一个类应该应该对其他类尽可能了解得最少；类只与直接的朋友通信等等。但是其最终目的只有一个，就是让类间解耦。</p>
</blockquote>
<p><a href="https://tianweili.github.io/2015/02/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99-%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99/">https://tianweili.github.io/2015/02/12/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%AD%E5%A4%A7%E5%8E%9F%E5%88%99-%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99/</a></p>
</li>
<li><p>设计模式六大原则6-开闭原则</p>
</li>
<li><p>控制反转</p>
<p>在使用框架之后，整个程序的执行流程通过框架来控制。流程的控制权从程序员“反转”给了框架。</p>
</li>
</ol>
<p>谈一谈自己对依赖、关联、聚合和组合之间区别的理解</p>
<p><a href="http://blog.itpub.net/69952849/viewspace-2672009/">http://blog.itpub.net/69952849/viewspace-2672009/</a></p>
<h5 id="设计模式之美"><a href="#设计模式之美" class="headerlink" title="设计模式之美"></a>设计模式之美</h5><p>迪米特法则的描述为：不该有直接依赖关系的类之间，不要有依赖；有依赖关系的类之间，尽量只依赖必要的接口。</p>
<p><a href="https://www.jianshu.com/p/35f76e87ac45">https://www.jianshu.com/p/35f76e87ac45</a></p>
<p><a href="https://juejin.im/post/6844903591686176776">https://juejin.im/post/6844903591686176776</a></p>
<p> <a href="https://github.com/Meng997998/AndroidJX">https://github.com/Meng997998/AndroidJX</a></p>
<p><a href="https://juejin.im/post/6864252499466354701">https://juejin.im/post/6864252499466354701</a></p>
<p><a href="https://github.com/JsonChao/Awesome-Android-Interview">https://github.com/JsonChao/Awesome-Android-Interview</a></p>
<p><a href="https://juejin.im/post/6878902981400625160">https://juejin.im/post/6878902981400625160</a></p>
<h4 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h4><p>单例为什么使用volatile修饰 </p>
<p><a href="https://juejin.im/post/6844903605292498958">https://juejin.im/post/6844903605292498958</a></p>
<p><a href="http://static.kancloud.cn/alex_wsc/mianshi/1811436">http://static.kancloud.cn/alex_wsc/mianshi/1811436</a></p>
<p><a href="https://mp.weixin.qq.com/s/eCotdGOWvSMki062eLjS8g">https://mp.weixin.qq.com/s/eCotdGOWvSMki062eLjS8g</a></p>
<p><a href="https://mp.weixin.qq.com/s/7DvReHYugl1KClKFGBwSfg">https://mp.weixin.qq.com/s/7DvReHYugl1KClKFGBwSfg</a></p>
<ul>
<li>平常有用到什么锁，synchronized底层原理是什么</li>
<li>锁之间的区别</li>
<li>线程间同步的方法</li>
<li>阿里编程规范不建议使用线程池，为什么？</li>
<li>RXJava怎么切换线程</li>
<li>平常有用到什么锁，synchronized底层原理是什么</li>
<li>简单描述下Handler,Handler是怎么切换线程的,Handler同步屏障</li>
<li>synchronized是公平锁还是非公平锁,ReteranLock是公平锁吗？是怎么实现的</li>
<li>线程间同步的方法</li>
<li>锁之间的区别</li>
<li>OkHttp怎么实现连接池</li>
<li>如果让你来实现一个网络框架，你会考虑什么</li>
<li>说说你对volatile字段有什么用途？</li>
<li>四种线程池原理？</li>
<li>怎么中止一个线程，Thread.Interupt一定有效吗？</li>
<li>如何让两个线程循环交替打印</li>
<li>线程池了解多少？拒绝策略有几种,为什么有newSingleThread</li>
<li></li>
</ul>
<p>okhttp线程使用方式</p>
<h4 id="RXJava"><a href="#RXJava" class="headerlink" title="RXJava"></a>RXJava</h4><ul>
<li>RXJava怎么切换线程</li>
<li>Rxjava自定义操作符</li>
</ul>
<h5 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h5><p><a href="https://juejin.im/post/6875638406165037063">https://juejin.im/post/6875638406165037063</a></p>
<p>设计模式之美</p>
<p>25 26 39. 40代码没什么了解</p>
<p>Hashmap </p>
<h4 id="注解作用"><a href="#注解作用" class="headerlink" title="注解作用"></a>注解作用</h4><p>路线图 </p>
<p>注解</p>
]]></content>
      <tags>
        <tag>inter</tag>
      </tags>
  </entry>
  <entry>
    <title>room</title>
    <url>/2019/09/20/room/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/training/data-storage/room">https://developer.android.com/training/data-storage/room</a></p>
<h5 id="Room"><a href="#Room" class="headerlink" title="Room"></a>Room</h5><p> <a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view/#0">https://codelabs.developers.google.com/codelabs/android-room-with-a-view/#0</a></p>
<p><a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view-kotlin/#0">https://codelabs.developers.google.com/codelabs/android-room-with-a-view-kotlin/#0</a></p>
<p>kotlin need familiar [basic coroutines](</p>
<h5 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h5><ul>
<li><p>主键</p>
<p>每个实体必须定义至少1个字段作为主键。即使只有1个字段，仍然需要用<code>@PrimaryKey</code>注解字段。此外，如果您想Room自动分配IDs给实体，则可以设置<code>@PrimaryKey</code>的<code>autoGenerate</code>属性。如果实体具有复合主键，则可以使用<code>@Entity</code>注解的<code>primaryKeys</code>属性</p>
</li>
</ul>
<ul>
<li><p>Entity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BleData</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">long</span> createDttm;</span><br><span class="line">    <span class="keyword">public</span> String bleParam;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Dao</p>
</li>
</ul>
<p><a href="https://developer.android.com/topic/libraries/architecture/room">https://developer.android.com/topic/libraries/architecture/room</a></p>
<p><a href="https://github.com/googlecodelabs/android-room-with-a-view">https://github.com/googlecodelabs/android-room-with-a-view</a></p>
<p><a href="https://codelabs.developers.google.com/codelabs/android-room-with-a-view/#0">https://codelabs.developers.google.com/codelabs/android-room-with-a-view/#0</a></p>
<p><a href="https://github.com/googlecodelabs/android-room-with-a-view/tree/kotlin">https://github.com/googlecodelabs/android-room-with-a-view/tree/kotlin</a></p>
<p><a href="https://blog.skymxc.com/2018/04/15/Room/">https://blog.skymxc.com/2018/04/15/Room/</a></p>
<p><a href="https://www.jianshu.com/p/0ed8b17a199e">https://www.jianshu.com/p/0ed8b17a199e</a></p>
<p>索引为什么加快访问速度</p>
<h4 id="数据库迁移"><a href="#数据库迁移" class="headerlink" title="数据库迁移"></a>数据库迁移</h4><p><a href="https://www.jianshu.com/p/72eeaded8913">https://www.jianshu.com/p/72eeaded8913</a></p>
<p><a href="https://blog.csdn.net/a254837127/article/details/84564545">https://blog.csdn.net/a254837127/article/details/84564545</a></p>
<p><a href="https://developer.android.com/training/data-storage/room#java">https://developer.android.com/training/data-storage/room#java</a></p>
<p><a href="https://codelabs.developers.google.com/codelabs/kotlin-coroutines/#0">https://codelabs.developers.google.com/codelabs/kotlin-coroutines/#0</a>)</p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>DB</tag>
      </tags>
  </entry>
  <entry>
    <title>token</title>
    <url>/2018/03/29/token/</url>
    <content><![CDATA[<h4 id="rxjava-方式"><a href="#rxjava-方式" class="headerlink" title="rxjava 方式"></a>rxjava 方式</h4><p><a href="http://alighters.com/blog/2016/05/02/rxjava-plus-retrofitshi-xian-wang-luo-dai-li/">http://alighters.com/blog/2016/05/02/rxjava-plus-retrofitshi-xian-wang-luo-dai-li/</a><br><a href="http://alighters.com/blog/2016/08/22/rxjava-plus-retrofitshi-xian-zhi-demo/">http://alighters.com/blog/2016/08/22/rxjava-plus-retrofitshi-xian-zhi-demo/</a></p>
<p><a href="https://blog.csdn.net/qq_20521573/article/details/76100558">最流行的网络请求框架Rxjava2+Retrofit之Token处理</a></p>
<p><a href="https://blog.csdn.net/jdsjlzx/article/details/52442113">https://blog.csdn.net/jdsjlzx/article/details/52442113</a></p>
<p><a href="https://blog.csdn.net/qq_20521573/article/details/76100558">https://blog.csdn.net/qq_20521573/article/details/76100558</a></p>
<h4 id="拦截器做控制"><a href="#拦截器做控制" class="headerlink" title="拦截器做控制"></a>拦截器做控制</h4><p><a href="https://blog.csdn.net/u012771445/article/details/79750648">https://blog.csdn.net/u012771445/article/details/79750648</a></p>
<p><a href="https://blog.csdn.net/bestlbw/article/details/53984647">https://blog.csdn.net/bestlbw/article/details/53984647</a></p>
<p><a href="https://www.jianshu.com/p/c325f5c32709">https://www.jianshu.com/p/c325f5c32709</a></p>
<h4 id="RxjavaPlugin处理token"><a href="#RxjavaPlugin处理token" class="headerlink" title="RxjavaPlugin处理token"></a>RxjavaPlugin处理token</h4><p><a href="https://github.com/ssseasonnn/RxErrorHandler">https://github.com/ssseasonnn/RxErrorHandler</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>tool_imgResource</title>
    <url>/2017/10/21/tool-imgResource/</url>
    <content><![CDATA[<p>有时候想写点东西　苦于没有素材</p>
<p><a href="https://icons8.com/">https://icons8.com/</a><br><a href="http://www.iconfont.cn/">http://www.iconfont.cn</a></p>
<p><a href="https://icomoon.io/">https://icomoon.io/</a><br><a href="http://fontello.com/">http://fontello.com/</a></p>
<p>也可以导入矢量图<br><a href="https://developer.android.com/studio/write/vector-asset-studio.html?hl=zh-cn">https://developer.android.com/studio/write/vector-asset-studio.html?hl=zh-cn</a></p>
<p><a href="https://material.io/icons/">https://material.io/icons/</a>  官方图</p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>tool_mac</title>
    <url>/2020/04/11/tool-mac/</url>
    <content><![CDATA[<h5 id="IntelliJ-idea-clion"><a href="#IntelliJ-idea-clion" class="headerlink" title="IntelliJ idea clion"></a>IntelliJ idea clion</h5><p>clion激活: CLion-2019.2.5.dmg 下载完成后,先使用再打开,jetbrains-agent-20200227.zip直接拖入就好了。</p>
<p>some tool for mac</p>
<p>查看当前环境变量 : env</p>
<h5 id="Packet-Sender"><a href="#Packet-Sender" class="headerlink" title="Packet Sender"></a>Packet Sender</h5><p>tcp ip tool</p>
<img src="/2020/04/11/tool-mac/Screen Shot 2020-04-11 at 4.40.59 PM.png" alt="Screen Shot 2020-04-11 at 4.40.59 PM" style="zoom:67%;">







<h5 id="HomeBrew安装"><a href="#HomeBrew安装" class="headerlink" title="HomeBrew安装"></a>HomeBrew安装</h5><ol>
<li>下载</li>
</ol>
<p><a href="https://raw.githubusercontent.com/Homebrew/install/master/install.sh">https://raw.githubusercontent.com/Homebrew/install/master/install.sh</a></p>
<ol start="2">
<li><p>更换源</p>
<figure class="highlight makefile"><table><tr><td class="code"><pre><span class="line">BREW_REPO=<span class="string">&quot;https://github.com/Homebrew/brew&quot;</span></span><br><span class="line">   换成  </span><br><span class="line">BREW_REPO=<span class="string">&quot;git://mirrors.ustc.edu.cn/brew.git&quot;</span> </span><br></pre></td></tr></table></figure></li>
<li><p>权限</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">chmod <span class="number">755</span> <span class="keyword">install</span>.sh </span><br><span class="line">./<span class="keyword">install</span>.sh </span><br></pre></td></tr></table></figure>



<p><a href="https://blog.csdn.net/weixin_43635647/article/details/104249968">https://blog.csdn.net/weixin_43635647/article/details/104249968</a></p>
<h5 id="set-environment-variable-mac"><a href="#set-environment-variable-mac" class="headerlink" title="set environment variable mac"></a>set environment variable mac</h5><ol>
<li>Flutter</li>
</ol>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">vi ~/.bash_profile</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="string">&quot;<span class="variable">$PATH</span>:/Users/john/development/flutter/bin&quot;</span></span><br><span class="line"></span><br><span class="line">which flutter</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>jdk </p>
<p><a href="https://docs.oracle.com/javase/10/install/installation-jdk-and-jre-macos.htm#JSJIG-GUID-F575EB4A-70D3-4AB4-A20E-DBE95171AB5F">https://docs.oracle.com/javase/10/install/installation-jdk-and-jre-macos.htm#JSJIG-GUID-F575EB4A-70D3-4AB4-A20E-DBE95171AB5F</a></p>
</li>
</ol>
<h5 id="mac-terminal"><a href="#mac-terminal" class="headerlink" title="mac terminal"></a>mac terminal</h5><ol>
<li>download and install iterm2</li>
<li>Download iterm2-finder-tools-1.0.0  open Open iTerm.workflow install</li>
<li>file top 右键 customize toolbar then move opem iTerm into toolbar</li>
</ol>
</li>
<li><p>Ignore</p>
<p><code>Command + Shift + .</code></p>
</li>
<li><p>Environment set</p>
<p>AppledeMacBook-Pro:~ apple$ cat ~/.bash_profile</p>
<p>export PATH=”$PATH:/Users/john/development/flutter/bin”</p>
<p>export PUB_HOSTED_URL=<a href="https://pub.flutter-io.cn/">https://pub.flutter-io.cn</a></p>
<p>export FLUTTER_STORAGE_BASE_URL=<a href="https://storage.flutter-io.cn/">https://storage.flutter-io.cn</a> </p>
</li>
</ol>
<h5 id="gradle-阿里云镜像"><a href="#gradle-阿里云镜像" class="headerlink" title="gradle 阿里云镜像"></a>gradle 阿里云镜像</h5><p>/Users/john/.gradle 目录添加 init.gradle</p>
<h5 id="鼠须管默认简繁体"><a href="#鼠须管默认简繁体" class="headerlink" title="鼠须管默认简繁体"></a>鼠须管默认简繁体</h5><p>control 加上 ~ 快捷键</p>
<h5 id="屏幕录制"><a href="#屏幕录制" class="headerlink" title="屏幕录制"></a>屏幕录制</h5><p><a href="https://blog.csdn.net/qq_43428139/article/details/109038098">https://blog.csdn.net/qq_43428139/article/details/109038098</a></p>
<p><a href="https://www.cnblogs.com/hi3254014978/p/15084851.html#:~:text=%E8%A7%A3%E5%86%B3Mac%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%94%B5%E8%84%91%E8%87%AA%E5%B8%A6%E5%BD%95%E5%B1%8F%E8%BD%AF%E4%B">https://www.cnblogs.com/hi3254014978/p/15084851.html#:~:text=%E8%A7%A3%E5%86%B3Mac%E7%AC%94%E8%AE%B0%E6%9C%AC%E7%94%B5%E8%84%91%E8%87%AA%E5%B8%A6%E5%BD%95%E5%B1%8F%E8%BD%AF%E4%B</a></p>
<h5 id="adb-环境变量"><a href="#adb-环境变量" class="headerlink" title="adb 环境变量"></a>adb 环境变量</h5><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo touch ~/.zshrc</span><br><span class="line">sudo vi ~/.zshrc</span><br><span class="line"></span><br><span class="line">复制</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ANDROID_HOME</span>=/Users/m/Library/Android/sdk</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$ANDROID_HOME</span>/platform-tools:$PATH</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$ANDROID_HOME</span>/tools:$PATH</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$ANDROID_HOME</span>/tools/bin:$PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://dev.to/ravics09/solution-of-command-not-found-adb-error-29e7">https://dev.to/ravics09/solution-of-command-not-found-adb-error-29e7</a></p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>tool_pc_phone</title>
    <url>/2017/10/13/tool-miflash/</url>
    <content><![CDATA[<h2 id="mi救砖"><a href="#mi救砖" class="headerlink" title="mi救砖"></a>mi救砖</h2><p>前两天不小心把　新买的小米４给刷成黑砖了，我的操作是<br><strong>双击磁盘模式工具目录里的“清除fastboot进磁盘操作.bat”进入磁盘模式</strong><br> 使用这种方式把fastboot清掉了，然后手机都没法进入fastboot模式，插入电脑无法识别</p>
<h1 id="我的方法"><a href="#我的方法" class="headerlink" title="我的方法"></a>我的方法</h1><h2 id="进入方法三：通过线刷升级"><a href="#进入方法三：通过线刷升级" class="headerlink" title="进入方法三：通过线刷升级"></a>进入方法三：通过线刷升级</h2><p>　　点以下链接 <a href="http://www.miui.com/shuaji-393.html,%E4%B8%8B%E8%BD%BD%E9%80%9A%E7%94%A8%E5%88%B7%E6%9C%BA%E5%B7%A5%E5%85%B7%EF%BC%8C%E5%AE%89%E8%A3%85%E5%90%8E">http://www.miui.com/shuaji-393.html,下载通用刷机工具，安装后</a>(需要<br>　　一段时间)，插上已成砖手机，windows设备管理器　端口我的显示9006
　　</p>
<h2 id="下载fastboot完整包"><a href="#下载fastboot完整包" class="headerlink" title="下载fastboot完整包"></a>下载fastboot完整包</h2><pre><code>   也是在上面链接路径下面
</code></pre>
<h2 id="下载-miflash"><a href="#下载-miflash" class="headerlink" title="下载 miflash"></a>下载 miflash</h2><p>   我下载的是15版的miflash　新版 .bat文件不同会报各种错误<br>    链接: <a href="https://pan.baidu.com/s/1pKPLJdD">https://pan.baidu.com/s/1pKPLJdD</a> 密码: 94mi</p>
<h2 id="救活"><a href="#救活" class="headerlink" title="救活"></a>救活</h2><p>  选择下载的fastboot包，刷机，然后是等待</p>
<p>   看到一篇文章高通下教程　<a href="http://www.miui.com/thread-2689657-1-1.html">http://www.miui.com/thread-2689657-1-1.html</a></p>
<h2 id="Thinkpad更换固态硬盘"><a href="#Thinkpad更换固态硬盘" class="headerlink" title="Thinkpad更换固态硬盘"></a>Thinkpad更换固态硬盘</h2><ul>
<li>视频教程:</li>
</ul>
<p><a href="https://v.qq.com/x/page/k0157zxhob1.html">https://v.qq.com/x/page/k0157zxhob1.html</a></p>
<p><a href="https://www.youtube.com/watch?v=Qgh5v6ccMOg">https://www.youtube.com/watch?v=Qgh5v6ccMOg</a></p>
<p><a href="http://v.youku.com/v_show/id_XMzE3NTU5MjA4OA==.html?spm=a2hzp.8244740.0.0">http://v.youku.com/v_show/id_XMzE3NTU5MjA4OA==.html?spm=a2hzp.8244740.0.0</a></p>
<ul>
<li>文字教程:</li>
</ul>
<p><a href="http://www.xinxunwei.com/bjbcj/2016/0119/5261.html">http://www.xinxunwei.com/bjbcj/2016/0119/5261.html</a></p>
<ul>
<li>Ubuntu系统安装:</li>
</ul>
<p><a href="https://blog.csdn.net/dkh_321/article/details/79304377">https://blog.csdn.net/dkh_321/article/details/79304377</a></p>
<p>　　</p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntu-mariaDb</title>
    <url>/2017/07/18/ubuntu-mariaDb/</url>
    <content><![CDATA[<h1 id="数据库常用用法"><a href="#数据库常用用法" class="headerlink" title="数据库常用用法"></a>数据库常用用法</h1><p>W3C教程 :   <a href="https://www.w3cschool.cn/mariadb/">https://www.w3cschool.cn/mariadb/</a><br>1、创建/删除 数据库：CREATE  DATABASE  数据库名 / drop database 数据库名;<br>2、建表/删除表 ： h_id为主键   /DROP TABLE  table_name ;</p>
<pre><code>MariaDB [person]&gt; CREATE TABLE home_recycler(
  h_id INT NOT NULL AUTO_INCREMENT,
  h_title VARCHAR(100) NOT NULL,
  h_describe VARCHAR(100) NOT NULL,
  h_imgurl VARCHAR(40) NOT NULL,
  PRIMARY KEY(h_id)
 );
Query OK, 0 rows affected (0.29 sec)
</code></pre>
<p>3、 插入数据</p>
<pre><code>MariaDB [person]&gt; INSERT INTO home_recycler(h_title,h_describable,h_imgurl) VALUES(&#39;1&#39;,&#39;D&#39;,&#39;m&#39;);
</code></pre>
<p>   删除数据,删除全部表的数据就不需要条件了</p>
<pre><code>  DELETE FROM home_recycler WHERE product_id=133;
</code></pre>
<p>注意：插入数据乱码： 在命令行也是插入数据也是中文乱码，解决方法<br>          <a href="https://my.oschina.net/u/1011130/blog/864540">https://my.oschina.net/u/1011130/blog/864540</a><br>          重启数据库：<a href="http://www.cnblogs.com/anseey/archive/2013/04/28/3049785.html">http://www.cnblogs.com/anseey/archive/2013/04/28/3049785.html</a></p>
<h1 id="、-Ubuntu数据库安装"><a href="#、-Ubuntu数据库安装" class="headerlink" title="、  Ubuntu数据库安装"></a>、  Ubuntu数据库安装</h1><p>  更新系统</p>
<pre><code>$ sudo apt update
$ sudo apt upgrade
</code></pre>
<p> 安装MariaDB：</p>
<pre><code> $ sudo apt install mariadb-server
</code></pre>
<p> 登陆MariaDB命令行</p>
<pre><code> $ sudo mysql -u root -p
</code></pre>
<p> 参考：<a href="http://blog.topspeedsnail.com/archives/6323">http://blog.topspeedsnail.com/archives/6323</a><br>           <a href="https://linux.cn/article-6210-1.html">https://linux.cn/article-6210-1.html</a></p>
<hr>
<h1 id="、-数据库操作"><a href="#、-数据库操作" class="headerlink" title="、  数据库操作"></a>、  数据库操作</h1><ol>
<li> 登录 ：mysql -u root -p  </li>
</ol>
<hr>
<ol start="2">
<li>数据库导出 导入<pre><code>在网上查了下，导出命令 千遍一律 都是这样的 mysqldump -u username -p dbname &gt; filename.sql ，按照这个操作，语法错误，   在我的惯性思维中，觉得是命令行登录数据库后再导出，其实是不需要登录的，首先Win + r 输入cmd,进入命令行 输入 mysqldump，如果看到下面这个

            C:\Users\Administrator&gt;mysqldump&#39;
            mysqldump&#39; 不是内部或外部命令，也不是可运行的程序或批处理文件。
</code></pre>
</li>
</ol>
<ul>
<li><p>说明需要配置环境变量了，类似我的就需要 D:\install\Mariadb\bin；加入path路径后面<br> 然后输入mysqldump ，</p>
<pre><code> C:\Users\Administrator&gt;mysqldump
 Usage: mysqldump [OPTIONS] database [tables]
 OR     mysqldump [OPTIONS] --databases [OPTIONS] DB1 [DB2 DB3...]
 OR     mysqldump [OPTIONS] --all-databases [OPTIONS]
 For more options, use mysqldump --help 
</code></pre>
</li>
</ul>
<ul>
<li><p>然后主题来了</p>
<pre><code>  mysqldump -u root -p person &gt; &quot;C:\mysql.sql&quot;
</code></pre>
<p>root是用户名 ， person是数据库，&gt;后面是存放位置 ，标准格式是这样的  mysqldump -u username -p dbname &gt; filename.sql</p>
<pre><code> 然后导入：mysql -u username -p dbname &lt; filename.sql

 但是我在vps导入后数据库为空
</code></pre>
</li>
</ul>
<p>参考： <a href="https://www.youtube.com/watch?v=2hsOk0XcYC4">https://www.youtube.com/watch?v=2hsOk0XcYC4</a><br>           <a href="https://john-dugan.com/dump-and-restore-mysql-databases-in-windows/">https://john-dugan.com/dump-and-restore-mysql-databases-in-windows/</a><br> <a href="http://wqss.2008.blog.163.com/blog/static/912428082010102092548409/">http://wqss.2008.blog.163.com/blog/static/912428082010102092548409/</a>    </p>
<hr>
<h1 id="MariaDB-配置远程访问"><a href="#MariaDB-配置远程访问" class="headerlink" title="MariaDB 配置远程访问"></a>MariaDB 配置远程访问</h1><pre><code>   有时候在家也要整整这些玩意儿，代码可以用github同步，每次数据库数据还倒腾来倒腾去的 ，如果在vps直接访问就最好了
</code></pre>
<ol>
<li>找到默认配置文件 : 目的是要找到 my.cnf  ， 可以先 “ cd /“ ，到根目录下  ，输入下面命令<pre><code>    root@TrustingDevoted-VM:/# find -name &quot;my.cnf&quot;
    ./etc/mysql/my.cnf
</code></pre>
</li>
</ol>
<p>2.修改my.cnf， 找到【mysqld】 ” bind-address        = 127.0.0.1“ ，前面加个” # “就可以了， 教程说 “skip-networking”前面也需要修改，但是我这里没有就作罢了</p>
<p>3 授予权限 ，这里授予的是183.129.133.0/24段的ip</p>
<pre><code>   GRANT ALL PRIVILEGES ON *.* TO &#39;root&#39;@&#39;183.129.133.%&#39; IDENTIFIED BY &#39;123456&#39; WITH GRANT OPTION;
</code></pre>
<p> 4   给远程主机给予连接用户，查询已经存在的远程用户</p>
<pre><code>       SELECT User, Host FROM mysql.user WHERE Host &lt;&gt; &#39;localhost&#39;;
                             
            | User      | Host               |
            +-----------+--------------------+
            | user_name | %                  |
            | root      | 127.0.0.1          |
            | root      | 183.129.133.%      |
            | root      | ::1                |
            | root      | trustingdevoted-vm |
            +-----------+--------------------+
</code></pre>
<p> “user_name” 是给的所有用户授予的 ,”root  暂时不知道怎么删除，     | 183.129.133.%”是刚才添加的，然后 sudo reboot 重启下</p>
<p>5   本地远程登录 </p>
<pre><code>      mysql -h66.168.1.11 -uroot -p123456

 注意中间没有空格, -h 后面yourVpsIp ,-u后面 用户名， -p 后面密码
</code></pre>
<p> 参考：<a href="https://mariadb.com/kb/zh-cn/configuring-mariadb-for-remote-client-access/">https://mariadb.com/kb/zh-cn/configuring-mariadb-for-remote-client-access/</a><br>       <a href="http://blog.csdn.net/ithomer/article/details/6976148">http://blog.csdn.net/ithomer/article/details/6976148</a><br>       <a href="http://www.jianshu.com/p/9c175e9293e2">http://www.jianshu.com/p/9c175e9293e2</a></p>
<h2 id="安装Navicat"><a href="#安装Navicat" class="headerlink" title="安装Navicat"></a>安装Navicat</h2><p><a href="https://www.jianshu.com/p/42a33b0dda9c">https://www.jianshu.com/p/42a33b0dda9c</a></p>
]]></content>
      <categories>
        <category>LINUX</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntu_server</title>
    <url>/2017/11/20/ubuntu-server/</url>
    <content><![CDATA[<h5 id="Linux下上传"><a href="#Linux下上传" class="headerlink" title="Linux下上传"></a>Linux下上传</h5><p><a href="http://www.jianshu.com/p/c3e4f96ced97">http://www.jianshu.com/p/c3e4f96ced97</a><br>在html目录下放文件就可以了</p>
<p><code>scp /home/jon/桌面/img.jpg  root@45.77.222.97:/var/www/html/</code></p>
<ul>
<li>nexus-3.20.0-04: not a regular file</li>
</ul>
<p><code>scp -r /home/jon/桌面/img.jpg  root@45.77.222.97:/var/www/html/</code></p>
<p>windows下上传</p>
<ol>
<li><p>安装Xshell</p>
</li>
<li><p>给ubuntu安装管理器 <code>apt-get install -y lrzsz</code></p>
</li>
</ol>
<p><a href="https://www.linuxidc.com/Linux/2015-05/117975.ht%E3%80%81">https://www.linuxidc.com/Linux/2015-05/117975.ht、</a></p>
<ol start="3">
<li> <code>rz</code>命令上传，会弹出一个框选择文件</li>
</ol>
<p>  查看图片 <a href="http://45.77.222.97/homedetail_pic.png">http://45.77.222.97/homedetail_pic.png</a></p>
<h5 id="JDK-Environment-ubuntu"><a href="#JDK-Environment-ubuntu" class="headerlink" title="JDK Environment ubuntu"></a>JDK Environment ubuntu</h5><ol>
<li> when I wget tar.gz from oracle office.  I couldn’t tar tar.gz ,so I upload one.</li>
</ol>
<blockquote>
<p>scp jdk-11.0.5_linux-x64_bin.tar.gz root@xxx/opt/java/</p>
<p>tar -zxvf FileName.tar.gz</p>
</blockquote>
<ol start="2">
<li><p>Edit  /etc/profile,  touch it if not have, 或者直接在根目录‘ cd / ’输入下面的这些，也可以，具体写入到哪先不管了</p>
<blockquote>
<p>#set java JDK</p>
<p>export JAVA_HOME=/opt/java/jdk1.8.0_231</p>
<p>export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</p>
<p>export PATH=$JAVA_HOME/bin:$PATH</p>
</blockquote>
</li>
<li><p>make it work</p>
<blockquote>
<p>source /etc/profile</p>
</blockquote>
</li>
</ol>
<h5 id="set-jdk-on-Mac"><a href="#set-jdk-on-Mac" class="headerlink" title="set jdk. on Mac"></a>set jdk. on Mac</h5><blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">Open ~/.bash_profile </span><br><span class="line">export JAVA_HOME=<span class="constructor">$(<span class="operator">/</span><span class="params">usr</span><span class="operator">/</span><span class="params">libexec</span><span class="operator">/</span><span class="params">java_home</span>)</span></span><br><span class="line">source ~/.bash_profile</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>在64位机器上跑x86的jdk一直提示</li>
</ul>
<blockquote>
<p>-bash: /opt/jdk/jdk1.8.0_231/bin/java: No such file or directory</p>
</blockquote>
<p>free -m</p>
]]></content>
      <categories>
        <category>TOOL</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntu_guide</title>
    <url>/2017/09/20/ubuntu_guide/</url>
    <content><![CDATA[<p>　<strong>解决Ubuntu 16.04 系统的一些错误</strong></p>
<h2 id="Unable-to-mount-root-fs-on-unknown-block"><a href="#Unable-to-mount-root-fs-on-unknown-block" class="headerlink" title="Unable to mount root fs on unknown-block"></a>Unable to mount root fs on unknown-block</h2><p>　看到Ubuntu系统有更新就点了下，早上打开电脑 Ubuntu直接进不去最下面弹出这这样的<br>　错误　Unable to mount root fs on unknown-block　而且只能强制关机，心想完了我的<br>　资料，还有辛苦编译的源码，不过好在晚上回来倒腾了一把　终于好了。</p>
<p>步骤<br>1、  Advanced options for Ubuntu<br>２、ubuntu Linux 4.4.0-96… (recovery mdoe)  　这里我选择的是第二个，第一个点击后还是<br>　　会报错<br>3、Menu界面　，把能清的先清了，然后点击grub,执行后续操作</p>
<p>4、登录进入命令行界面</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">sudo mount -o rw <span class="regexp">//</span>这一行和参考资料不同</span><br><span class="line">sudo dpkg --configure -a　<span class="regexp">//</span>在这里等了很久 Device ....Start的字样,接着就按了　Ctrl + Alt + Delete , 重启就好了</span><br><span class="line"></span><br><span class="line">sudo apt-get install -f  <span class="comment"># to finish upgrades 最好加这个吧</span></span><br><span class="line">type reboot</span><br></pre></td></tr></table></figure>

<p>  <a href="https://askubuntu.com/questions/875862/kernel-panic-unable-to-mount-root-in-ubuntu-16-04/875868">https://askubuntu.com/questions/875862/kernel-panic-unable-to-mount-root-in-ubuntu-16-04/875868</a></p>
<h2 id="解压乱码"><a href="#解压乱码" class="headerlink" title="解压乱码"></a>解压乱码</h2><p>在windows上压缩的文件，是以系统默认编码中文来压缩文件。由于zip文件中没有声明其编码，所以linux上的unzip一般以默认编码解压，中文文件名会出现乱码。<br>可以使用终端zip文件进行解压并指定解压的编码<br>　<code>unzip -O GBK   xxx.zip</code><br>解压后的文件的路径为当前终端所在的路径</p>
<p>参考：　<a href="http://hareric.com/2016/07/26/%E7%AE%80%E6%98%93%E6%96%B9%E6%B3%95%E8%A7%A3%E5%86%B3ubuntu%E4%B8%8B%E8%A7%A3%E5%8E%8B%E6%96%87%E4%BB%B6%E4%B9%B1%E7%A0%81/">Eric Chan</a> </p>
<p>** 17.10的问题　**</p>
<ul>
<li>Android studio3.1无法输入中文<br>　使用 fcitx 选择sunpingying  也可以选择 google pinyin<br>  　然后输入这两行命令<pre><code>      pidof fcitx | xargs kill  #找到原有的fcitx端口并kill掉
      fcitx                     #开启fcitx
</code></pre>
</li>
</ul>
<p>参考： 　<a href="https://blog.csdn.net/he729164860/article/details/78484713">https://blog.csdn.net/he729164860/article/details/78484713</a>
  　
  　
  　</p>
<h2 id="安装Gnome-shell"><a href="#安装Gnome-shell" class="headerlink" title="安装Gnome　shell"></a>安装Gnome　shell</h2><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="builtin-name">get</span> install gnome-tweak-tool</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install chrome-gnome-shell</span><br></pre></td></tr></table></figure>
<p>打开tweak可以看到按钮</p>
<p>浏览点击 ||| off按钮系统就会安装</p>
<p>开源chromium加载有问题，使用firefox</p>
<p>很有用的插件</p>
<p><a href="https://extensions.gnome.org/extension/545/hide-top-bar/">https://extensions.gnome.org/extension/545/hide-top-bar/</a></p>
<p>参考:<a href="https://www.mobibrw.com/2017/9342">https://www.mobibrw.com/2017/9342</a></p>
<p>　</p>
<h2 id="ctrl-alt-left-（Intellij-idea-shortcut-conflict）"><a href="#ctrl-alt-left-（Intellij-idea-shortcut-conflict）" class="headerlink" title="ctrl + alt + left （Intellij idea shortcut conflict）"></a>ctrl + alt + left （Intellij idea shortcut conflict）</h2><ul>
<li><p>install <u>Dconf Editor</u>   in ubuntu software</p>
</li>
<li><p>launch <u>Dconf Editor</u>, go to    /org/gnome/desktop/wm/keybindings/switch-to-workspace-left  </p>
<p>double click like below</p>
<p><img src="/2017/09/20/ubuntu_guide/ubuntu_guide_01.png" alt="df"></p>
</li>
</ul>
<p> use default value(click Off) -&gt; Custom value(like me or else)</p>
<ul>
<li>you could use it in intellij idea now .</li>
</ul>
<h4 id="genymotion安装"><a href="#genymotion安装" class="headerlink" title="genymotion安装"></a>genymotion安装</h4><ul>
<li>下载Virtualbox</li>
<li>下载genymotion</li>
<li>下载Android stuido genymotion插件</li>
</ul>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">chmod +x genymotion-<span class="number">2.6</span>.<span class="number">0</span>-linux_x64.bin      </span><br><span class="line">.<span class="regexp">/genymotion-2.6.0-linux_x64.bin -d /</span>home<span class="regexp">/qiu/</span>Work/genymotion  </span><br></pre></td></tr></table></figure>

<p>//注意： chmod +x 有空格</p>
<h4 id="输入法设置"><a href="#输入法设置" class="headerlink" title="输入法设置"></a>输入法设置</h4><p>ubuntu 18.04 intellij 输入法选择有问题，可以用命令行安装 ibus-pinyin，然后input souce选择拼音输入法</p>
]]></content>
      <categories>
        <category>LINUX</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntu_vr</title>
    <url>/2017/07/18/ubuntu_vr/</url>
    <content><![CDATA[<p>  自从shadowsocks出来，我们的上网问题算是解决了，通过google查资料确实更便利</p>
<h5 id="shadowsocks安装"><a href="#shadowsocks安装" class="headerlink" title="shadowsocks安装"></a>shadowsocks安装</h5><p>   对于新手 作者建议安装在ubuntu上，那就用他开始吧</p>
<ul>
<li><p>安装软件</p>
<pre><code>   sudo apt-get install python-pip
   pip install shadowsocks
</code></pre>
</li>
</ul>
<p>  然而我遇到了这样的问题<br>  Command “python setup.py egg_info” failed with error code 1 in /tmp/pip-build-Mlx8an/shadowsocks/<br>You are using pip version 8.1.1, however version 9.0.1 is available.<br>You should consider upgrading via the ‘pip install –upgrade pip’ command.<br>接着按照他的指示来</p>
<pre><code>pip install --upgrade pip
</code></pre>
<p>  然而又出问题了，这次是这个 Could not import setuptools which is required to install from a source distribution.<br>Please install setuptools.<br>  这时候Google派上用场了，解决方案是 </p>
<pre><code> sudo pip install -U setuptools
</code></pre>
<p>  参考：<a href="https://github.com/fredley/play-pi/issues/22">https://github.com/fredley/play-pi/issues/22</a></p>
<p>  然后执行 pip install shadowsocks ，终于OK，Collecting shadowsocks<br>  Using cached shadowsocks-2.8.2.tar.gz<br>Installing collected packages: shadowsocks<br>  Running setup.py install for shadowsocks … done<br>Successfully installed shadowsocks-2.8.2</p>
<h5 id="前台运行"><a href="#前台运行" class="headerlink" title="前台运行"></a>前台运行</h5><p> 软件安装好了，现在可以配置了，先在前台跑下</p>
<pre><code>    ssserver -p 8388 -k 123456 -m aes-256-cfb
</code></pre>
<p> 然后手机或电脑同样配置看下代理是否有用，Ok的话，新建一个文件替代命令</p>
<pre><code>    vi  /etc/shadowsocks.json 
  &#123;
  &quot;server&quot;:&quot;my_server_ip&quot;,
  &quot;server_port&quot;:8388,
  &quot;local_address&quot;: &quot;127.0.0.1&quot;,
  &quot;local_port&quot;:1080,
  &quot;password&quot;:&quot;123456&quot;,
  &quot;timeout&quot;:300,
  &quot;method&quot;:&quot;aes-256-cfb&quot;,
  &quot;fast_open&quot;: false
 &#125;
</code></pre>
<p>   前台执行 :   </p>
<pre><code>    ssserver -c /etc/shadowsocks.json
</code></pre>
<p> 后台执行:<br>​<br>​        ssserver -c /etc/shadowsocks.json -d start<br>​        ssserver -c /etc/shadowsocks.json -d stop </p>
<p>接着就可以愉快的玩耍了</p>
<ul>
<li> 卸载shadowsocks</li>
</ul>
<p>　先停掉服务 <code>sudo ssserver -d stop</code><br>　然后　      <code>pip uninstall shadowsocks</code>
　
　</p>
<hr>
<h5 id="shadowsocks-libev安装"><a href="#shadowsocks-libev安装" class="headerlink" title="shadowsocks-libev安装"></a>shadowsocks-libev安装</h5><p>ubuntu 17</p>
<figure class="highlight cmake"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt <span class="keyword">install</span> shadowsocks-libev</span><br></pre></td></tr></table></figure>
<p>如果是其他版本可以看下面　参考<br>from :<a href="https://github.com/shadowsocks/shadowsocks-libev#install-from-repository">https://github.com/shadowsocks/shadowsocks-libev#install-from-repository</a></p>
<ol>
<li>启动测试连接</li>
</ol>
<p>和shadowsocks启动类似 ssserver 换成了 ss-server</p>
<ul>
<li>启动测试 : <code>ss-server -s 0.0.0.0 -p 8388 -k 123456 -m aes-256-cfb</code>　　没有 <code>-d start</code><br>可能会占用端口</li>
<li>配置文件启动<br>To run in the foreground: <code>ss-server -c /etc/shadowsocks-libev/config.json </code></li>
<li>To run in the background:　<br>｀nohup ss-server -c /etc/shadowsocks-libev/config.json｀</li>
<li>停止运行: <code>sudo ss-server -d stop</code></li>
</ul>
<ol start="2">
<li>simple-obfs(混淆工具)安装</li>
</ol>
<p>Build<br>For Unix-like systems, especially Debian-based systems, e.g. Ubuntu, Debian or Linux Mint, you can build the binary like this:</p>
<ul>
<li><p>Debian / Ubuntu　环境配置<br><code>sudo apt-get install --no-install-recommends build-essential autoconf libtool libssl-dev libpcre3-dev libc-ares-dev libev-dev asciidoc xmlto automake </code></p>
</li>
<li><p>下载simple-obfs</p>
<p>  //Debian / Ubuntu<br>  ​    sudo apt-get install –no-install-recommends build-essential autoconf libtool             libssl-dev libpcre3-dev libev-dev asciidoc xmlto automake<br>  ​            //CentOS / Fedora / RHEL<br>  ​        sudo yum install gcc autoconf libtool automake make zlib-devel openssl-devel asciidoc xmlto<br>  ​        // Arch<br>  ​    sudo pacman -Syu gcc autoconf libtool automake make zlib openssl asciidoc xmlto<br>  ​     //Alpine<br>  ​    apk add gcc autoconf make libtool automake zlib-devel openssl asciidoc xmlto libpcre32 libev-dev g++ linux-headers</p>
<pre><code>  git clone https://github.com/shadowsocks/simple-obfs.git
  cd simple-obfs
  git submodule update --init --recursive
  ./autogen.sh
  ./configure &amp;&amp; make
  sudo make install
</code></pre>
</li>
</ul>
<p>​         </p>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意:"></a>注意:</h5><ol>
<li>Question</li>
</ol>
<ul>
<li><p>问题1<br><code>autoconf --version</code><br>需要安装 <code>sudo apt install autoconf</code></p>
</li>
<li><p>问题2</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">configure.ac:<span class="number">19</span>: error: possibly undefined macro: AC_DISABLE_STATIC</span><br><span class="line">      If this token and others are legitimate, please use m4_pattern_allow.</span><br><span class="line">      See the Autoconf documentation.</span><br><span class="line">configure.ac:<span class="number">20</span>: error: possibly undefined macro: AC_DISABLE_SHARED</span><br><span class="line">configure.ac:<span class="number">44</span>: error: possibly undefined macro: AC_PROG_LIBTOOL</span><br><span class="line">autoreconf: <span class="regexp">/usr/</span>bin/autoconf failed with <span class="keyword">exit</span> status: <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p><code>sudo apt-get install libtool</code></p>
</li>
<li><p>问题3<br><code>sudo apt-get install automake</code><br><a href="http://ask.xmodulo.com/fix-failed-to-run-aclocal.html">http://ask.xmodulo.com/fix-failed-to-run-aclocal.html</a></p>
<p><img src="/2017/07/18/ubuntu_vr/shadowsocklib_autogen.png" alt="shadowsocklib_autogen"></p>
</li>
</ul>
<ol start="2">
<li>混淆</li>
</ol>
<ul>
<li><p>server端: <code>ss-server -c  /etc/shadowsocks-libev/config.json  --plugin obfs-server --plugin-opts &quot;obfs=http&quot;</code></p>
</li>
<li><p>clinet 端:<code>ss-local -c config.json --plugin obfs-local --plugin-opts &quot;obfs=http;obfs-host=www.baidu.com&quot; </code><br>也可以都放在配置文件中</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;server_port&quot;</span>:your_server_port,</span><br><span class="line">    <span class="attr">&quot;local_address&quot;</span>:<span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;local_port&quot;</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>:<span class="string">&quot;your_password&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;timeout&quot;</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="attr">&quot;method&quot;</span>:<span class="string">&quot;your_encryption_method&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;plugin&quot;</span>:<span class="string">&quot;/usr/local/bin/obfs-server --obfs http&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么服务端直接运行``ss-server -c /etc/shadowsocks-libev/config.json `就可以了</p>
<p>后台运行就是前面的测试连接 nohup命令　</p>
<p>from:<a href="https://teddysun.com/511.html">https://teddysun.com/511.html</a></p>
<ul>
<li><p>参数: </p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">插件：obfs-<span class="built_in">local</span></span><br><span class="line">插件选项：obfs=<span class="keyword">http</span>;obfs-host=www.baidu.com</span><br></pre></td></tr></table></figure></li>
<li><p>客户端连接<br>　client也按照 simple-obfs  服务端安装方式安装<br>　连接命令 <code> ss-local -c /etc/shadowsocks-libev/config.json --plugin obfs-local --plugin-opts &quot;obfs=http;obfs-host=www.biadu.com&quot;</code></p>
</li>
</ul>
<p>参考:<a href="https://github.com/shadowsocks/simple-obfs">https://github.com/shadowsocks/simple-obfs</a><br><a href="https://blog.phpgao.com/shadowsocks_on_linux.html">https://blog.phpgao.com/shadowsocks_on_linux.html</a><br><a href="https://softwaredownload.gitbooks.io/openwrt-fanqiang/content/ebook/03.2.html">https://softwaredownload.gitbooks.io/openwrt-fanqiang/content/ebook/03.2.html</a></p>
<h5 id="配置ubuntu开机启动"><a href="#配置ubuntu开机启动" class="headerlink" title="配置ubuntu开机启动"></a>配置ubuntu开机启动</h5><ul>
<li> home下　新建 run_server.sh<br>输入</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">cd</span> /home/jon/shadowsocksr/shadowsocks</span><br><span class="line">python local.py -c /etc/shadowsocks.json</span><br></pre></td></tr></table></figure>
<ul>
<li><p>修改脚本权限<br>一定要让脚本具备可执行权限，可以执行如下指令：<br><code>$ sudo chmod 755 run_server.sh</code></p>
</li>
<li><p>将脚本放置在启动路径下<br>将run_server.sh移动到/etc/init.d路径下，可以直接拷贝，也可以链接过去<br><code>$ sudo cp run_server.sh /etc/init.d/</code></p>
</li>
<li><p>将脚本添加到启动脚本。<br>执行如下指令，在这里90表明一个优先级，越高表示执行的越晚</p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="variable">$</span> <span class="built_in">cd</span> /etc/init.d/</span><br><span class="line"><span class="variable">$</span> sudo <span class="built_in">update-rc</span>.d run_server.sh defaults <span class="number">90</span></span><br></pre></td></tr></table></figure>

<ul>
<li>如何移除该脚本<br>很简单，执行如下指令：<br><code> sudo update-rc.d -f run_server.sh remove</code></li>
</ul>
<p><a href="http://jackqdyulei.github.io/2016/03/06/linux-auto-script/">http://jackqdyulei.github.io/2016/03/06/linux-auto-script/</a></p>
<h5 id="设置系统全局代理"><a href="#设置系统全局代理" class="headerlink" title="设置系统全局代理"></a>设置系统全局代理</h5><p> <a href="https://blog.csdn.net/u012810317/article/details/52139361">https://blog.csdn.net/u012810317/article/details/52139361</a></p>
<ul>
<li><p>terminal代理</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">http_proxy</span>=http://127.0.0.1:8118</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">https_proxy</span>=http://127.0.0.1:8118</span><br></pre></td></tr></table></figure>

<p>或者</p>
<p>git config –global http.proxy “localhost:1080”</p>
<p>git config –global http.proxy “localhost:1080”</p>
</li>
</ul>
<p>   git clone –recurse-submodules <a href="mailto:&#x67;&#x69;&#x74;&#64;&#103;&#x69;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;">&#x67;&#x69;&#x74;&#64;&#103;&#x69;&#x74;&#x68;&#x75;&#x62;&#x2e;&#x63;&#111;&#109;</a>:shadowsocks/shadowsocks-android.git</p>
<h5 id="修改包名"><a href="#修改包名" class="headerlink" title="修改包名"></a>修改包名</h5><ul>
<li><p>把apk改成 shadowsocks.apk</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">!<span class="selector-attr">[SS_20190DD]</span>(E:\noteforme<span class="selector-class">.github</span>.io\source\_posts\ubuntu_ssr\SS_20190DD.png)java -jar apktool<span class="selector-class">.jar</span> d shadowsocks<span class="selector-class">.apk</span>      <span class="comment">//解包</span></span><br><span class="line">											<span class="comment">//中间做修改</span></span><br><span class="line">java -jar apktool<span class="selector-class">.jar</span> <span class="selector-tag">b</span> shadowsocks			<span class="comment">//打成apk再dist目录下</span></span><br><span class="line"></span><br><span class="line">jarsigner -verbose -keystore androidTest<span class="selector-class">.jks</span> -signedjar signed<span class="selector-class">.apk</span> AndroidTest<span class="selector-class">.apk</span> test  <span class="comment">//生成签名</span></span><br><span class="line"></span><br><span class="line">jarsigner -verbose -keystore androidTest<span class="selector-class">.jks</span> -signedjar signed<span class="selector-class">.apk</span> shadowsockstt<span class="selector-class">.apk</span> test</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/huaiyiheyuan/article/details/53114490">https://blog.csdn.net/huaiyiheyuan/article/details/53114490</a></p>
</li>
</ul>
<h5 id="windows全局代理"><a href="#windows全局代理" class="headerlink" title="windows全局代理"></a>windows全局代理</h5><p><a href="https://www.flyzy2005.com/fan-qiang/shadowsocks/proxifier-with-shadowsocks/">https://www.flyzy2005.com/fan-qiang/shadowsocks/proxifier-with-shadowsocks/</a></p>
<p><img src="/2017/07/18/ubuntu_vr/SS_20190DD.png" alt="SS_20190DD"></p>
<h5 id="win7下使用"><a href="#win7下使用" class="headerlink" title="win7下使用"></a>win7下使用</h5><ol>
<li>首先下载 Microsoft .NET Framework 4.6.2，但是win7系统不支持安装</li>
<li>下载 <strong>需要升级为Windows 7 SP1</strong> 需要去官网下载 Windows 7 SP1</li>
</ol>
<h5 id="VR-INSTALL"><a href="#VR-INSTALL" class="headerlink" title="VR  INSTALL"></a>VR  INSTALL</h5><ul>
<li>安装</li>
</ul>
<p><a href="https://toutyrater.github.io/prep/install.html">https://toutyrater.github.io/prep/install.html</a></p>
<ol>
<li><p>Install</p>
</li>
<li><blockquote>
<p>```<br>wget <a href="https://install.direct/go.sh">https://install.direct/go.sh</a></p>
<p>sudo bash go.sh</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">2. check</span><br><span class="line"></span><br><span class="line">cat /etc/v2ray/config.json</span><br><span class="line"></span><br><span class="line"> you will see the config,I won&#x27;t be  change it</span><br><span class="line"></span><br><span class="line">3. ff</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>$ sudo systemctl start v2ray</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="symbol">  sudo:</span> unable <span class="keyword">to</span> resolve host vm<span class="number">8</span>l</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>. $ cat /etc/hostname</span><br><span class="line"></span><br><span class="line">  vm<span class="number">8</span>lcxg<span class="number">8</span>.hostflyte.com</span><br><span class="line"></span><br><span class="line"> <span class="keyword">or</span> you  could use this[vr使用](https://github.com/<span class="number">233</span>boy/v<span class="number">2</span>ray/wiki/V<span class="number">2</span>Ray<span class="variable">%E6</span><span class="variable">%90</span><span class="variable">%AD</span><span class="variable">%E5</span><span class="variable">%BB</span><span class="variable">%BA</span><span class="variable">%E8</span><span class="variable">%AF</span><span class="variable">%A6</span><span class="variable">%E7</span><span class="variable">%BB</span><span class="variable">%86</span><span class="variable">%E5</span><span class="variable">%9</span>B<span class="variable">%BE</span><span class="variable">%E6</span><span class="variable">%96</span><span class="variable">%87</span><span class="variable">%E6</span><span class="variable">%95</span><span class="variable">%99</span><span class="variable">%E7</span><span class="variable">%A8</span><span class="variable">%8</span>B)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*  macOS use</span><br><span class="line"></span><br><span class="line">proxy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Github slowly</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>git config –global http.proxy socks5://127.0.0.1:1081</p>
</blockquote>
</li>
</ol>
<p>git config –global https.proxy socks5://127.0.0.1:1081</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>git config –global –unset http.proxy<br>git config –global –unset https.proxy</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">https:<span class="regexp">//</span>www.jianshu.com<span class="regexp">/p/</span><span class="number">5</span>e74b1042b70</span><br><span class="line"></span><br><span class="line">GitHub 镜像 </span><br><span class="line"></span><br><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/Zenquan/</span>quickgitclone</span><br><span class="line"></span><br><span class="line">git clone  https:<span class="regexp">//gi</span>thub.com.cnpmjs.org<span class="regexp">/android/m</span>edia-samples.git</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>sudo dscacheutil -flushcache</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Terminal</span><br><span class="line"></span><br><span class="line">```cpp</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">http_proxy</span>=<span class="string">&quot;http://127.0.0.1:1081&quot;</span></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">https_proxy</span>=<span class="string">&quot;http://127.0.0.1:1081&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>google 搭建vr</p>
<p>查看网络详情 -》防火墙</p>
<p>按照这个教程 <a href="https://zelikk.blogspot.com/2019/01/gcp-v2ray-firewall.html">https://zelikk.blogspot.com/2019/01/gcp-v2ray-firewall.html</a></p>
<p>网络标记就选了全部实例</p>
<img src="/2017/07/18/ubuntu_vr/veray_go_engile_1.png" alt="veray_go_engile_1" style="zoom:67%;"></li>
</ul>
<pre><code>  注意复制的端口号 带上了逗号
</code></pre>
<p>​    root身份运行    </p>
<p>-bash: sudo: command not found</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">dpkg -l|grep sudo</span><br><span class="line">apt-<span class="builtin-name">get</span> install sudo</span><br><span class="line">sudo apt-<span class="builtin-name">get</span> install wget</span><br></pre></td></tr></table></figure>

<p>root运行</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">sudo -<span class="selector-tag">i</span></span><br></pre></td></tr></table></figure>



<p>安装</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//install.direct/<span class="keyword">go</span>.<span class="keyword">sh</span></span><br><span class="line">sudo bash <span class="keyword">go</span>.<span class="keyword">sh</span></span><br><span class="line">sudo systemctl start v2ray</span><br></pre></td></tr></table></figure>



<p>设置mac终端走ssr或者是v2ray代理</p>
<p><a href="http://www.xiaosuiyin.com/2020/02/15/%E8%AE%BE%E7%BD%AEmac%E7%BB%88%E7%AB%AF%E8%B5%B0ssr%E6%88%96%E8%80%85%E6%98%AFv2ray%E4%BB%A3%E7%90%86/">http://www.xiaosuiyin.com/2020/02/15/%E8%AE%BE%E7%BD%AEmac%E7%BB%88%E7%AB%AF%E8%B5%B0ssr%E6%88%96%E8%80%85%E6%98%AFv2ray%E4%BB%A3%E7%90%86/</a></p>
<p><a href="https://github.com/233boy/v2ray/wiki/V2Ray%E6%90%AD%E5%BB%BA%E8%AF%A6%E7%BB%86%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B">https://github.com/233boy/v2ray/wiki/V2Ray%E6%90%AD%E5%BB%BA%E8%AF%A6%E7%BB%86%E5%9B%BE%E6%96%87%E6%95%99%E7%A8%8B</a></p>
<p><a href="https://github.com/v2fly/fhs-install-v2ray/blob/master/README.zh-Hans-CN.md">https://github.com/v2fly/fhs-install-v2ray/blob/master/README.zh-Hans-CN.md</a></p>
<p>注意配置  tcp端口</p>
<p><a href="https://by.affpass.com/go/jms">https://justmysocks3.net</a></p>
]]></content>
      <categories>
        <category>LINUX</category>
      </categories>
  </entry>
  <entry>
    <title>viewmodel</title>
    <url>/2020/04/06/viewmodel/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/topic/libraries/architecture/viewmodel">https://developer.android.com/topic/libraries/architecture/viewmodel</a></p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h5 id="Share-data-between-fragments"><a href="#Share-data-between-fragments" class="headerlink" title="Share data between fragments"></a>Share data between fragments</h5><p>=======</p>
<h4 id="livedata和viewmodel关系"><a href="#livedata和viewmodel关系" class="headerlink" title="livedata和viewmodel关系"></a>livedata和viewmodel关系</h4><p>viewmodel中的数据发生变化时通知页面</p>
<h4 id="ViewModel出现前"><a href="#ViewModel出现前" class="headerlink" title="ViewModel出现前"></a>ViewModel出现前</h4><ol>
<li>瞬间数据丢失</li>
<li>异步调用的内存泄漏</li>
<li>类膨胀提高维护难度和测试难度</li>
</ol>
<p><img src="/2020/04/06/viewmodel/2021-08-02_8.18_viewmodel.png"></p>
<p>Share data between fragments</p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>d7906d4909f312e25743be4a4c56ad1539df1ea6</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>It’s very common that two or more fragments in an activity need to communicate with each other</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SharedViewModel</span> : <span class="type">ViewModel</span></span>() &#123;</span><br><span class="line">    <span class="keyword">val</span> selected = MutableLiveData&lt;Item&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">select</span><span class="params">(item: <span class="type">Item</span>)</span></span> &#123;</span><br><span class="line">        selected.value = item</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MasterFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">lateinit</span> <span class="keyword">var</span> itemSelector: Selector</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use the &#x27;by activityViewModels()&#x27; Kotlin property delegate</span></span><br><span class="line">    <span class="comment">// from the fragment-ktx artifact</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> model: SharedViewModel <span class="keyword">by</span> activityViewModels()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">        itemSelector.setOnClickListener &#123; item -&gt;</span><br><span class="line">            <span class="comment">// Update the UI</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DetailFragment</span> : <span class="type">Fragment</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use the &#x27;by activityViewModels()&#x27; Kotlin property delegate</span></span><br><span class="line">    <span class="comment">// from the fragment-ktx artifact</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> model: SharedViewModel <span class="keyword">by</span> activityViewModels()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onViewCreated</span><span class="params">(view: <span class="type">View</span>, savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onViewCreated(view, savedInstanceState)</span><br><span class="line">        model.selected.observe(viewLifecycleOwner, Observer&lt;Item&gt; &#123; item -&gt;</span><br><span class="line">            <span class="comment">// Update the UI</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://codelabs.developers.google.com/codelabs/android-lifecycles/#0">https://codelabs.developers.google.com/codelabs/android-lifecycles/#0</a></p>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</p>
<h5 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span>  <span class="keyword">extends</span> <span class="title">ViewModel</span> </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewModel</span><span class="params">(Application application)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyViewModel</span> <span class="keyword">extends</span> <span class="title">AndroidViewModel</span> </span>&#123; <span class="comment">//需要用到application就用AndroidViewModel</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyViewModel</span><span class="params">(Application application)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(application);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>=======</p>
<h4 id="ViewModel保持数据原理"><a href="#ViewModel保持数据原理" class="headerlink" title="ViewModel保持数据原理"></a>ViewModel保持数据原理</h4><ol>
<li>使用</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">viewModel = <span class="keyword">new</span> ViewModelProvider(<span class="keyword">this</span>, <span class="keyword">new</span> ViewModelProvider.AndroidViewModelFactory(getApplication())).get(MyViewModel.class);</span><br></pre></td></tr></table></figure>



<ol start="2">
<li><p>owner.getViewModelStore()</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ViewModelProvider</span><span class="params">(<span class="meta">@NonNull</span> ViewModelStoreOwner owner, <span class="meta">@NonNull</span> Factory factory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(owner.getViewModelStore(), factory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ComponentActivity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ViewModelStore <span class="title">getViewModelStore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getApplication() == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Your activity is not yet attached to the &quot;</span></span><br><span class="line">                + <span class="string">&quot;Application instance. You can&#x27;t request ViewModel before onCreate call.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mViewModelStore == <span class="keyword">null</span>) &#123;</span><br><span class="line">        NonConfigurationInstances nc =</span><br><span class="line">                (NonConfigurationInstances) getLastNonConfigurationInstance(); <span class="comment">//拿到上次屏幕的状态</span></span><br><span class="line">        <span class="keyword">if</span> (nc != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// Restore the ViewModelStore from NonConfigurationInstances</span></span><br><span class="line">            mViewModelStore = nc.viewModelStore; <span class="comment">// 获取上次的mViewModelStore，里面保存有HashMap&lt;String, ViewModel&gt; mMap</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (mViewModelStore == <span class="keyword">null</span>) &#123;</span><br><span class="line">            mViewModelStore = <span class="keyword">new</span> ViewModelStore();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> mViewModelStore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>所以ViewModel横竖屏切换保存数据的秘诀就是</p>
<p>//拿到上次屏幕的状态,获取上次的mViewModelStore，里面保存有HashMap&lt;String, ViewModel&gt; mMap,接着通过.get(MyViewModel.class);获取ViewModel,如果获取不到就反射newInstance()一个。</p>
<p><a href="https://www.bilibili.com/video/BV1Hh411a7LX?p=6&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Hh411a7LX?p=6&amp;spm_id_from=pageDriver</a></p>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>d7906d4909f312e25743be4a4c56ad1539df1ea6</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
]]></content>
      <categories>
        <category>Jetpack</category>
      </categories>
  </entry>
  <entry>
    <title>AnimPropertyView</title>
    <url>/2019/12/29/AnimPropertyView/</url>
    <content><![CDATA[<h4 id="估值器（TypeEvaluator）"><a href="#估值器（TypeEvaluator）" class="headerlink" title="估值器（TypeEvaluator）"></a>估值器（TypeEvaluator）</h4><p>设置动画 如何从初始值 过渡到 结束值 的逻辑</p>
<ul>
<li>插值器（<code>Interpolator</code>）决定 值 的变化模式（匀速、加速）</li>
<li>估值器（<code>TypeEvaluator</code>）决定 值 的具体变化数值</li>
</ul>
<h4 id="ValueAnimator"><a href="#ValueAnimator" class="headerlink" title="ValueAnimator"></a>ValueAnimator</h4><p>实现原理 : 通过不断控制 值的变化， 再不断赋值给对象的属性，从而实现动画的效果。</p>
<img src="/2019/12/29/AnimPropertyView/Screen Shot 2021-01-31 at 10.02.48 PM.png" style="zoom:80%;">

<p>从上面原理可以看出：<code>ValueAnimator</code>类中有3个重要方法：</p>
<ol>
<li><code>ValueAnimator.ofInt（int values）</code></li>
<li><code>ValueAnimator.ofFloat（float values）</code></li>
<li><code>ValueAnimator.ofObject（int values）</code></li>
</ol>
<h4 id="ValueAnimator-ofInt（int-values）"><a href="#ValueAnimator-ofInt（int-values）" class="headerlink" title="ValueAnimator.ofInt（int values）"></a>ValueAnimator.ofInt（int values）</h4><p>将初始值 <strong>以整型数值的形式</strong> 过渡到结束值</p>
<blockquote>
<p>即估值器是整型估值器 - <code>IntEvaluator</code></p>
</blockquote>
<h5 id="模板代码"><a href="#模板代码" class="headerlink" title="模板代码"></a>模板代码</h5><p>实际开发中，建议使用Java代码实现属性动画：因为很多时候属性的起始值是无法提前确定的（无法使用XML设置），这就需要在<code>Java</code>代码里动态获取。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 步骤1：设置动画属性的初始值 &amp; 结束值</span></span><br><span class="line">ValueAnimator anim = ValueAnimator.ofInt(<span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// ofInt（）作用有两个</span></span><br><span class="line">        <span class="comment">// 1. 创建动画实例</span></span><br><span class="line">        <span class="comment">// 2. 将传入的多个Int参数进行平滑过渡:此处传入0和1,表示将值从0平滑过渡到1</span></span><br><span class="line">        <span class="comment">// 如果传入了3个Int参数 a,b,c ,则是先从a平滑过渡到b,再从b平滑过渡到C，以此类推</span></span><br><span class="line">        <span class="comment">// ValueAnimator.ofInt()内置了整型估值器,直接采用默认的.不需要设置，即默认设置了如何从初始值 过渡到 结束值</span></span><br><span class="line">        <span class="comment">// 关于自定义插值器我将在下节进行讲解</span></span><br><span class="line">        <span class="comment">// 下面看看ofInt()的源码分析 -&gt;&gt;关注1</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">// 步骤2：设置动画的播放各种属性</span></span><br><span class="line">        anim.setDuration(<span class="number">500</span>);</span><br><span class="line">        <span class="comment">// 设置动画运行的时长</span></span><br><span class="line">        </span><br><span class="line">        anim.setStartDelay(<span class="number">500</span>);</span><br><span class="line">        <span class="comment">// 设置动画延迟播放时间</span></span><br><span class="line"></span><br><span class="line">        anim.setRepeatCount(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 设置动画重复播放次数 = 重放次数+1</span></span><br><span class="line">        <span class="comment">// 动画播放次数 = infinite时,动画无限重复</span></span><br><span class="line">        </span><br><span class="line">        anim.setRepeatMode(ValueAnimator.RESTART);</span><br><span class="line">        <span class="comment">// 设置重复播放动画模式</span></span><br><span class="line">        <span class="comment">// ValueAnimator.RESTART(默认):正序重放</span></span><br><span class="line">        <span class="comment">// ValueAnimator.REVERSE:倒序回放</span></span><br><span class="line">     </span><br><span class="line"><span class="comment">// 步骤3：将改变的值手动赋值给对象的属性值：通过动画的更新监听器</span></span><br><span class="line">        <span class="comment">// 设置 值的更新监听器</span></span><br><span class="line">        <span class="comment">// 即：值每次改变、变化一次,该方法就会被调用一次</span></span><br><span class="line">        anim.addUpdateListener(<span class="keyword">new</span> ValueAnimator.AnimatorUpdateListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> currentValue = (Integer) animation.getAnimatedValue();</span><br><span class="line">                <span class="comment">// 获得改变后的值</span></span><br><span class="line">                </span><br><span class="line">                System.out.println(currentValue);</span><br><span class="line">                <span class="comment">// 输出改变后的值</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 步骤4：将改变后的值赋给对象的属性值，下面会详细说明</span></span><br><span class="line">                View.setproperty（currentValue）；</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 步骤5：刷新视图，即重新绘制，从而实现动画效果</span></span><br><span class="line">                View.requestLayout();</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        anim.start();</span><br><span class="line">        <span class="comment">// 启动动画</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 关注1：ofInt（）源码分析</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ValueAnimator <span class="title">ofInt</span><span class="params">(<span class="keyword">int</span>... values)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 允许传入一个或多个Int参数</span></span><br><span class="line">        <span class="comment">// 1. 输入一个的情况（如a）：从0过渡到a；</span></span><br><span class="line">        <span class="comment">// 2. 输入多个的情况（如a，b，c）：先从a平滑过渡到b，再从b平滑过渡到C</span></span><br><span class="line">        </span><br><span class="line">        ValueAnimator anim = <span class="keyword">new</span> ValueAnimator();</span><br><span class="line">        <span class="comment">// 创建动画对象</span></span><br><span class="line">        anim.setIntValues(values);</span><br><span class="line">        <span class="comment">// 将传入的值赋值给动画对象</span></span><br><span class="line">        <span class="keyword">return</span> anim;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="XML设置"><a href="#XML设置" class="headerlink" title="XML设置"></a>XML设置</h5><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// ValueAnimator采用<span class="tag">&lt;<span class="name">animator</span>&gt;</span>  标签</span><br><span class="line"><span class="tag">&lt;<span class="name">animator</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>  </span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueFrom</span>=<span class="string">&quot;0&quot;</span>   // 初始值</span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueTo</span>=<span class="string">&quot;100&quot;</span>  // 结束值</span></span><br><span class="line"><span class="tag">    <span class="attr">android:valueType</span>=<span class="string">&quot;intType&quot;</span> // 变化值类型 ：<span class="attr">floatType</span> &amp; <span class="attr">intType</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">&quot;3000&quot;</span> // 动画持续时间（<span class="attr">ms</span>），必须设置，动画才有效果</span></span><br><span class="line"><span class="tag">    <span class="attr">android:startOffset</span> =<span class="string">&quot;1000&quot;</span> // 动画延迟开始时间（<span class="attr">ms</span>）</span></span><br><span class="line"><span class="tag">    <span class="attr">android:fillBefore</span> = <span class="string">“true”</span> // 动画播放完后，视图是否会停留在动画开始的状态，默认为<span class="attr">true</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fillAfter</span> = <span class="string">“false”</span> // 动画播放完后，视图是否会停留在动画结束的状态，优先于<span class="attr">fillBefore</span>值，默认为<span class="attr">false</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fillEnabled</span>= <span class="string">“true”</span> // 是否应用<span class="attr">fillBefore</span>值，对<span class="attr">fillAfter</span>值无影响，默认为<span class="attr">true</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:repeatMode</span>= <span class="string">“restart”</span> // 选择重复播放动画模式，<span class="attr">restart</span>代表正序重放，<span class="attr">reverse</span>代表倒序回放，默认为<span class="attr">restart</span>|</span></span><br><span class="line"><span class="tag">    <span class="attr">android:repeatCount</span> = <span class="string">“0”</span> // 重放次数（所以动画的播放次数=<span class="string">重放次数+1），为infinite时无限重复</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:interpolator</span> = <span class="string">@[package:]anim/interpolator_resource</span> // 插值器，即影响动画的播放速度,下面会详细讲</span></span><br><span class="line"><span class="tag">/&gt;</span>  </span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Animator animator = AnimatorInflater.loadAnimator(context, R.animator.set_animation);  </span><br><span class="line"><span class="comment">// 载入XML动画</span></span><br><span class="line"></span><br><span class="line">animator.setTarget(view);  </span><br><span class="line"><span class="comment">// 设置动画对象</span></span><br><span class="line"></span><br><span class="line">animator.start();  </span><br><span class="line"><span class="comment">// 启动动画</span></span><br></pre></td></tr></table></figure>



<h5 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h5><p>按钮的宽度从 <code>200px</code> 放大到 <code>500px</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    android:id=&quot;@+id/bt_value_anim&quot;</span><br><span class="line">    android:layout_width=&quot;200px&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:layout_centerInParent=&quot;true&quot;</span><br><span class="line">    android:text=&quot;动画&quot; /&gt;</span><br></pre></td></tr></table></figure>

<p>？代码设置初始值</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 步骤1：设置属性数值的初始值(此处在xml中200) &amp; 结束值(600)</span></span><br><span class="line"><span class="keyword">val</span> valueAnimator = ValueAnimator.ofInt(bt_value_anim.layoutParams.width, <span class="number">600</span>)</span><br><span class="line">    <span class="comment">// ValueAnimator.ofInt()内置了整型估值器,直接采用默认的.不需要设置</span></span><br><span class="line">       <span class="comment">// 即默认设置了如何从初始值200 过渡到 结束值500</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 步骤2：设置动画的播放各种属性</span></span><br><span class="line">valueAnimator.duration = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 步骤3：将改变的值手动赋值给对象的属性值：通过动画的更新监听器</span></span><br><span class="line">        <span class="comment">// 设置 值的更新监听器</span></span><br><span class="line">        <span class="comment">// 即：值每次改变、变化一次,该方法就会被调用一次</span></span><br><span class="line">valueAnimator.addUpdateListener &#123;</span><br><span class="line">    <span class="keyword">val</span> currentValue = it.animatedValue</span><br><span class="line">    <span class="comment">// 获得每次变化后的属性值</span></span><br><span class="line">    Timber.d(<span class="string">&quot;currentValue <span class="variable">$currentValue</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 每次值变化时，将值手动赋值给对象的属性</span></span><br><span class="line">    bt_value_anim.layoutParams.width = currentValue <span class="keyword">as</span> <span class="built_in">Int</span></span><br><span class="line">    <span class="comment">// 即将每次变化后的值 赋 给按钮的宽度，这样就实现了按钮宽度属性的动态变化</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 步骤4：刷新视图，即重新绘制，从而实现动画效果</span></span><br><span class="line">    bt_value_anim.requestLayout()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">valueAnimator.start()</span><br></pre></td></tr></table></figure>



<h4 id="浮点型：ValueAnimator-oFloat（）"><a href="#浮点型：ValueAnimator-oFloat（）" class="headerlink" title="浮点型：ValueAnimator.oFloat（）"></a>浮点型：ValueAnimator.oFloat（）</h4><p>将初始值 以浮点型数值的形式 过渡到结束值</p>
<ul>
<li><code>ValueAnimator.oFloat（）</code>采用默认的浮点型估值器 (<code>FloatEvaluator</code>)</li>
<li><code>ValueAnimator.ofInt（）</code>采用默认的整型估值器（<code>IntEvaluator</code>）</li>
</ul>
<p>在使用上完全没有区别</p>
<h5 id="ValueAnimator-ofObject（）"><a href="#ValueAnimator-ofObject（）" class="headerlink" title="ValueAnimator.ofObject（）"></a>ValueAnimator.ofObject（）</h5><p>将初始值 以对象的形式 过渡到结束值</p>
<blockquote>
<p>即通过操作 对象 实现动画效果</p>
</blockquote>
<h5 id="实战-1"><a href="#实战-1" class="headerlink" title="实战"></a>实战</h5><p>可以看到 <code>ValueAnimator.ofObject（）</code>的本质还是操作 <strong>值</strong>,将多个值封装到一个对象里的方式，同时对多个值一起操作</p>
<p>PointEvaluator</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PointEvaluator</span> : <span class="type">TypeEvaluator</span>&lt;<span class="type">Point</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">evaluate</span><span class="params">(fraction: <span class="type">Float</span>, startValue: <span class="type">Point</span>?, endValue: <span class="type">Point</span>?)</span></span>: Point &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将动画初始值startValue 和 动画结束值endValue 强制类型转换成Point对象</span></span><br><span class="line">        <span class="keyword">val</span> startPoint = startValue</span><br><span class="line">        <span class="keyword">val</span> endPoint =  endValue</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据fraction来计算当前动画的x和y的值</span></span><br><span class="line">        <span class="keyword">val</span> x = startPoint!!.x + fraction * (endPoint!!.x - startPoint!!.x)</span><br><span class="line">        <span class="keyword">val</span> y = startPoint!!.y + fraction * (endPoint!!.y - startPoint!!.y)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将计算后的坐标封装到一个新的Point对象中并返回</span></span><br><span class="line">        <span class="keyword">val</span> point = Point(x,y)</span><br><span class="line">        <span class="keyword">return</span>  point</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Point</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span></span>(<span class="keyword">val</span> x: <span class="built_in">Float</span>, <span class="keyword">val</span> y: <span class="built_in">Float</span>)</span><br></pre></td></tr></table></figure>





<p>MyView</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span> : <span class="type">View &#123;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(context: Context?, attrs: AttributeSet?) : <span class="keyword">super</span>(context, attrs)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置需要用到的变量</span></span><br><span class="line">    <span class="keyword">val</span> RADIUS = <span class="number">70f</span> <span class="comment">// 圆的半径 = 70</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> currentPoint <span class="comment">// 当前点坐标</span></span><br><span class="line">            : Point? = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">val</span> mPaint = Paint(Paint.ANTI_ALIAS_FLAG).apply &#123;</span><br><span class="line">        color = Color.BLUE</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(canvas: <span class="type">Canvas</span>?)</span></span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果当前点坐标为空(即第一次执行)</span></span><br><span class="line">        <span class="keyword">if</span> (currentPoint == <span class="literal">null</span>) &#123;</span><br><span class="line">            currentPoint = Point(RADIUS, RADIUS)</span><br><span class="line">            <span class="keyword">val</span> x = currentPoint?.x</span><br><span class="line">            <span class="keyword">val</span> y = currentPoint?.y</span><br><span class="line">            <span class="keyword">if</span> (x != <span class="literal">null</span> &amp;&amp; y != <span class="literal">null</span>) &#123;</span><br><span class="line">                canvas?.drawCircle(x, y, RADIUS, mPaint)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// (重点关注)将属性动画作用到View中</span></span><br><span class="line">            <span class="comment">// 步骤1:创建初始动画时的对象点  &amp; 结束动画时的对象点</span></span><br><span class="line">            <span class="comment">// (重点关注)将属性动画作用到View中</span></span><br><span class="line">            <span class="comment">// 步骤1:创建初始动画时的对象点  &amp; 结束动画时的对象点</span></span><br><span class="line">            <span class="keyword">val</span> startPoint = Point(RADIUS, RADIUS) <span class="comment">// 初始点为圆心(70,70)</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">val</span> endPoint = Point(<span class="number">700f</span>, <span class="number">1000f</span>) <span class="comment">// 结束点为(700,1000)</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 步骤2:创建动画对象 &amp; 设置初始值 和 结束值</span></span><br><span class="line">            <span class="keyword">val</span> anim = ValueAnimator.ofObject(PointEvaluator(), startPoint, endPoint)</span><br><span class="line">            <span class="comment">// 参数说明</span></span><br><span class="line">            <span class="comment">// 参数1：TypeEvaluator 类型参数 - 使用自定义的PointEvaluator(实现了TypeEvaluator接口)</span></span><br><span class="line">            <span class="comment">// 参数2：初始动画的对象点</span></span><br><span class="line">            <span class="comment">// 参数3：结束动画的对象点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 步骤3：设置动画参数</span></span><br><span class="line">            anim.duration = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 设置 值的更新监听器</span></span><br><span class="line">            <span class="comment">// 即每当坐标值（Point对象）更新一次,该方法就会被调用一次</span></span><br><span class="line">            anim.addUpdateListener &#123;</span><br><span class="line">                currentPoint = it.animatedValue <span class="keyword">as</span> Point?</span><br><span class="line">                <span class="comment">// 将每次变化后的坐标值（估值器PointEvaluator中evaluate（）返回的Piont对象值）到当前坐标值对象（currentPoint）</span></span><br><span class="line">                <span class="comment">// 从而更新当前坐标值（currentPoint）</span></span><br><span class="line">                Timber.d(<span class="string">&quot;currentPoint==null  <span class="subst">$&#123;currentPoint?.x&#125;</span>  <span class="subst">$&#123;currentPoint?.y&#125;</span>&quot;</span>)</span><br><span class="line">                <span class="comment">// 步骤4：每次赋值后就重新绘制，从而实现动画效果</span></span><br><span class="line">                invalidate()</span><br><span class="line">            &#125;</span><br><span class="line">            anim.start()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          </span><br><span class="line">          	<span class="comment">//除了第一次，后面每次都根据addUpdateListener回调，在这画圆</span></span><br><span class="line">          </span><br><span class="line">            <span class="comment">// 所以坐标值每改变一次,就会调用onDraw()一次,就会画一次圆,从而实现动画效果</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 在该点画一个圆:圆心 = (30,30),半径 = 30</span></span><br><span class="line">            <span class="keyword">val</span> x = currentPoint!!.x</span><br><span class="line">            <span class="keyword">val</span> y = currentPoint!!.y</span><br><span class="line">            canvas?.drawCircle(x, y, RADIUS, mPaint)</span><br><span class="line">					</span><br><span class="line">            Timber.d(<span class="string">&quot;currentPoint currentPoint!=null  <span class="subst">$&#123;currentPoint?.x&#125;</span>  <span class="subst">$&#123;currentPoint?.y&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="插值器"><a href="#插值器" class="headerlink" title="插值器"></a>插值器</h4><h5 id="xml设置"><a href="#xml设置" class="headerlink" title="xml设置"></a>xml设置</h5><p>当在XML文件设置插值器时，只需传入对应的插值器资源ID即可</p>
<p>主要是设置插值器属性<code>android:interpolator</code></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scale</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:interpolator</span>=<span class="string">&quot;@android:anim/overshoot_interpolator&quot;</span></span></span><br><span class="line"><span class="tag">    // 通过资源<span class="attr">ID</span>设置插值器</span></span><br><span class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">&quot;3000&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fromXScale</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:fromYScale</span>=<span class="string">&quot;0.0&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:pivotX</span>=<span class="string">&quot;50%&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:pivotY</span>=<span class="string">&quot;50%&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:toXScale</span>=<span class="string">&quot;2&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:toYScale</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>

<h5 id="代码设置"><a href="#代码设置" class="headerlink" title="代码设置"></a>代码设置</h5><p>当在Java代码设置插值器时，只需创建对应的插值器对象即可</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Button mButton = (Button) findViewById(R.id.Button);</span><br><span class="line"><span class="comment">// 步骤1:创建 需要设置动画的 视图View</span></span><br><span class="line"></span><br><span class="line">Animation alphaAnimation = <span class="keyword">new</span> AlphaAnimation(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">// 步骤2：创建透明度动画的对象 &amp; 设置动画效果</span></span><br><span class="line"></span><br><span class="line">alphaAnimation.setDuration(<span class="number">3000</span>);</span><br><span class="line">Interpolator overshootInterpolator = <span class="keyword">new</span> OvershootInterpolator();</span><br><span class="line"><span class="comment">// 步骤3：创建对应的插值器类对象</span></span><br><span class="line"></span><br><span class="line">alphaAnimation.setInterpolator(overshootInterpolator);</span><br><span class="line"><span class="comment">// 步骤4：给动画设置插值器</span></span><br><span class="line"></span><br><span class="line">mButton.startAnimation(alphaAnimation);</span><br><span class="line"><span class="comment">// 步骤5：播放动画</span></span><br></pre></td></tr></table></figure>



<h5 id="系统内置插值器"><a href="#系统内置插值器" class="headerlink" title="系统内置插值器"></a>系统内置插值器</h5><p>![](AnimPropertyView/Screen Shot 2021-02-01 at 10.57.34 AM.png)</p>
<h5 id="自定义插值器"><a href="#自定义插值器" class="headerlink" title="自定义插值器"></a>自定义插值器</h5><p>​    根据动画的进度（0%-100%）计算出当前属性值改变的百分比</p>
<p>​    自定义插值器需要实现 <code>Interpolator</code> / <code>TimeInterpolator</code>接口 &amp; 复写<code>getInterpolation（）</code></p>
<ol>
<li>补间动画 实现 <code>Interpolator</code>接口；属性动画实现<code>TimeInterpolator</code>接口</li>
<li><code>TimeInterpolator</code>接口是属性动画中新增的，用于兼容<code>Interpolator</code>接口，这使得所有过去的<code>Interpolator</code>实现类都可以直接在属性动画使用</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Interpolator接口 tween动画</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Interpolator</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 内部只有一个方法</span></span><br><span class="line">     <span class="function"><span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;  </span><br><span class="line">         <span class="comment">// 参数说明</span></span><br><span class="line">         <span class="comment">// input值值变化范围是0-1，且随着动画进度（0% - 100% ）均匀变化</span></span><br><span class="line">        <span class="comment">// 即动画开始时，input值 = 0；动画结束时input = 1</span></span><br><span class="line">        <span class="comment">// 而中间的值则是随着动画的进度（0% - 100%）在0到1之间均匀增加</span></span><br><span class="line">        </span><br><span class="line">      ...<span class="comment">// 插值器的计算逻辑</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> xxx；</span><br><span class="line">      <span class="comment">// 返回的值就是用于估值器继续计算的fraction值，下面会详细说明</span></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line"><span class="comment">// TimeInterpolator接口  属性动画</span></span><br><span class="line"><span class="comment">// 同上</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TimeInterpolator</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span></span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>



<ol start="3">
<li><p>匀速插值器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 匀速差值器：LinearInterpolator</span></span><br><span class="line"><span class="meta">@HasNativeInterpolator</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinearInterpolator</span> <span class="keyword">extends</span> <span class="title">BaseInterpolator</span> <span class="keyword">implements</span> <span class="title">NativeInterpolatorFactory</span> </span>&#123;  </span><br><span class="line">   <span class="comment">// 仅贴出关键代码</span></span><br><span class="line">  ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> input;  </span><br><span class="line">        <span class="comment">// 没有对input值进行任何逻辑处理，直接返回</span></span><br><span class="line">        <span class="comment">// 即input值 = fraction值</span></span><br><span class="line">        <span class="comment">// 因为input值是匀速增加的，因此fraction值也是匀速增加的，所以动画的运动情况也是匀速的，所以是匀速插值器</span></span><br><span class="line">    &#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 先加速再减速 差值器：AccelerateDecelerateInterpolator</span></span><br><span class="line"><span class="meta">@HasNativeInterpolator</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccelerateDecelerateInterpolator</span> <span class="keyword">implements</span> <span class="title">Interpolator</span>, <span class="title">NativeInterpolatorFactory</span> </span>&#123;  </span><br><span class="line">      <span class="comment">// 仅贴出关键代码</span></span><br><span class="line">  ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">float</span>)(Math.cos((input + <span class="number">1</span>) * Math.PI) / <span class="number">2.0f</span>) + <span class="number">0.5f</span>;</span><br><span class="line">        <span class="comment">// input的运算逻辑如下：</span></span><br><span class="line">        <span class="comment">// 使用了余弦函数，因input的取值范围是0到1，那么cos函数中的取值范围就是π到2π。</span></span><br><span class="line">        <span class="comment">// 而cos(π)的结果是-1，cos(2π)的结果是1</span></span><br><span class="line">        <span class="comment">// 所以该值除以2加上0.5后，getInterpolation()方法最终返回的结果值还是在0到1之间。只不过经过了余弦运算之后，最终的结果不再是匀速增加的了，而是经历了一个先加速后减速的过程</span></span><br><span class="line">        <span class="comment">// 所以最终，fraction值 = 运算后的值 = 先加速后减速</span></span><br><span class="line">        <span class="comment">// 所以该差值器是先加速再减速的</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>先加速再减速 插值器：<code>AccelerateDecelerateInterpolator</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 先加速再减速 差值器：AccelerateDecelerateInterpolator</span></span><br><span class="line"><span class="meta">@HasNativeInterpolator</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccelerateDecelerateInterpolator</span> <span class="keyword">implements</span> <span class="title">Interpolator</span>, <span class="title">NativeInterpolatorFactory</span> </span>&#123;  </span><br><span class="line">      <span class="comment">// 仅贴出关键代码</span></span><br><span class="line">  ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getInterpolation</span><span class="params">(<span class="keyword">float</span> input)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">float</span>)(Math.cos((input + <span class="number">1</span>) * Math.PI) / <span class="number">2.0f</span>) + <span class="number">0.5f</span>;</span><br><span class="line">        <span class="comment">// input的运算逻辑如下：</span></span><br><span class="line">        <span class="comment">// 使用了余弦函数，因input的取值范围是0到1，那么cos函数中的取值范围就是π到2π。</span></span><br><span class="line">        <span class="comment">// 而cos(π)的结果是-1，cos(2π)的结果是1</span></span><br><span class="line">        <span class="comment">// 所以该值除以2加上0.5后，getInterpolation()方法最终返回的结果值还是在0到1之间。只不过经过了余弦运算之后，最终的结果不再是匀速增加的了，而是经历了一个先加速后减速的过程</span></span><br><span class="line">        <span class="comment">// 所以最终，fraction值 = 运算后的值 = 先加速后减速</span></span><br><span class="line">        <span class="comment">// 所以该差值器是先加速再减速的</span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>对input值 根据动画的进度（0%-100%）通过逻辑计算 计算出当前属性值改变的百分比</strong></p>
<p>实战</p>
<p>DecelerateAccelerateInterpolator</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecelerateAccelerateInterpolator</span> : <span class="type">TimeInterpolator &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getInterpolation</span><span class="params">(input: <span class="type">Float</span>)</span></span>: <span class="built_in">Float</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> result: <span class="built_in">Float</span> = <span class="number">0.0f</span></span><br><span class="line">        <span class="keyword">if</span> (input &lt;= <span class="number">0.5</span>) &#123;</span><br><span class="line">            result = Math.sin(Math.PI * input).toFloat() / <span class="number">2</span></span><br><span class="line">            <span class="comment">// 使用正弦函数来实现先减速后加速的功能，逻辑如下：</span></span><br><span class="line">            <span class="comment">// 因为正弦函数初始弧度变化值非常大，刚好和余弦函数是相反的</span></span><br><span class="line">            <span class="comment">// 随着弧度的增加，正弦函数的变化值也会逐渐变小，这样也就实现了减速的效果。</span></span><br><span class="line">            <span class="comment">// 当弧度大于π/2之后，整个过程相反了过来，现在正弦函数的弧度变化值非常小，渐渐随着弧度继续增加，变化值越来越大，弧度到π时结束，这样从0过度到π，也就实现了先减速后加速的效果</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">             result= (<span class="number">2</span> - Math.sin(Math.PI * input)).toFloat() / <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">        <span class="comment">// 返回的result值 = 随着动画进度呈先减速后加速的变化趋势</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>InterpolatorActivity</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> curTranslationX = bt_anim_interpolator.translationX</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> animator = <span class="module-access"><span class="module"><span class="identifier">ObjectAnimator</span>.</span></span><span class="keyword">of</span><span class="constructor">Float(<span class="params">bt_anim_interpolator</span>, <span class="string">&quot;translationX&quot;</span>, <span class="params">curTranslationX</span>, 300f, <span class="params">curTranslationX</span>)</span></span><br><span class="line">animator.duration = <span class="number">5000</span></span><br><span class="line">animator.interpolator = <span class="constructor">DecelerateAccelerateInterpolator()</span></span><br><span class="line">animator.start<span class="literal">()</span></span><br></pre></td></tr></table></figure>



<h4 id="ObjectAnimator与-ValueAnimator类的区别"><a href="#ObjectAnimator与-ValueAnimator类的区别" class="headerlink" title="ObjectAnimator与 ValueAnimator类的区别"></a><code>ObjectAnimator</code>与 <code>ValueAnimator</code>类的区别</h4><ul>
<li><code>ValueAnimator</code> 类是先改变值，然后 <strong>手动赋值</strong> 给对象的属性从而实现动画；是 <strong>间接</strong> 对对象属性进行操作；</li>
<li><code>ObjectAnimator</code> 类是先改变值，然后 <strong>自动赋值</strong> 给对象的属性从而实现动画；是 <strong>直接</strong> 对对象属性进行操作</li>
</ul>
<h3 id="估值器（TypeEvaluator-和插值器"><a href="#估值器（TypeEvaluator-和插值器" class="headerlink" title="估值器（TypeEvaluator) 和插值器"></a>估值器（TypeEvaluator) 和插值器</h3><ol>
<li>插值器（<code>Interpolator</code>）决定 值 的变化模式（匀速、加速）</li>
<li>估值器（<code>TypeEvaluator</code>）决定 值 的具体变化数值,设置动画从初始值过渡到结束值的逻辑。</li>
</ol>
<p><a href="https://blog.csdn.net/carson_ho/article/details/99619871">https://blog.csdn.net/carson_ho/article/details/99619871</a></p>
<p>作者：Carson_Ho<br>链接：<a href="https://www.jianshu.com/p/7c95342f4bc2">https://www.jianshu.com/p/7c95342f4bc2</a></p>
<p>​            <a href="https://www.jianshu.com/p/2f19fe1e3ca1">https://www.jianshu.com/p/2f19fe1e3ca1</a></p>
<p>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
]]></content>
      <categories>
        <category>anim</category>
      </categories>
  </entry>
  <entry>
    <title>Bluetooth02</title>
    <url>/2018/07/05/Bluetooth02/</url>
    <content><![CDATA[<h4 id="BLE-stack-蓝牙协议栈"><a href="#BLE-stack-蓝牙协议栈" class="headerlink" title="BLE stack(蓝牙协议栈)"></a>BLE stack(蓝牙协议栈)</h4><img src="/2018/07/05/Bluetooth02/bluetooth_20180706093223.png" alt="bluetooth_20180706093223" style="zoom: 80%;">



<p> 作为 Android 开发者，我们不必理解 BLE 的协议栈每个细节，这里大概介绍一下协议架构。 协议一般都是分层设计的。BLE 协议栈也不例外。我们来看一下这个图。整个协议栈大致分为三部分，从下到上分别为，控制器    （Controller）→主机（Host）→应用（Applications）。 </p>
<ul>
<li>Controller :  它是协议栈的底层的实现，直接与硬件相关，一般直接集成在 SoC 中，由芯片厂商实现，包括物理层和链路层。 </li>
<li>HOST : 这是协议栈的上层实现，是硬件的抽象，与具体的硬件和厂家无关 </li>
<li>应用层： 就是使用 Host 层提供的 API，开发的应用。 </li>
</ul>
<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><ul>
<li><p>PhysicalLayer(物理层 ): 蓝牙是工作在 2.4GHz 附近，这是工业、科学、医疗 ISM 频段。可以看到它和 WiFi 工作在同一个频段。蓝牙把频段切分为 40 个通道，3 个广播通道，37 个数据通道，按照一定规律跳频通信（高斯频移键控 GFSK）。 </p>
</li>
<li><p>HCI   : 在 Host 层和 Controller 之间有一个接口层 :主机和控制器之间就是通过 HCI 命令和事件交互的。HCI 这一层是协议栈中是可选的，例如在一些简单小型的设备上可能就没有，但是所有的 Android 设备上肯定是有。这是蓝牙上层应用和芯片的交互的必经之路。后面我们会讲到，这一层的 log，能够很好的帮助我们分析和调试问题。 </p>
</li>
</ul>
<h4 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h4><h5 id="ATT-Attribute-Protocol"><a href="#ATT-Attribute-Protocol" class="headerlink" title="ATT (Attribute Protocol)"></a>ATT (Attribute Protocol)</h5><p>它是 BLE 通信的基础。ATT 把数据封装，向外暴露为“属性”，提供“属性”的为服务端，获取“属性”的为客户端。ATT 是专门为低功耗蓝牙设计的，结构非常简单，数据长度很短 .</p>
<h5 id="GATT-Generic-Attribute-Profile"><a href="#GATT-Generic-Attribute-Profile" class="headerlink" title="GATT(Generic Attribute Profile)"></a>GATT(Generic Attribute Profile)</h5><p> 全称叫做通用属性配置文件，它是建立在前面说的 ATT 的基础上，对 ATT 进行进一步的逻辑封装，定义数据的交互方式和含义。这是我们做 BLE 开发的时候直接接触的概念。 GATT 按照层级定义了三个概念：服务（Service）、特征（Characteristic）和描述（Descriptor）。 一个 Service 包含若干个 Characteristic，一个 Characteristic 可以包含若干 Descriptor。而 Characteristic 定义了数值和操作。Characteristic 的操作这几种权限：读、写、通知等权限。我们说的 BLE 通信，其实就是对 Characteristic 的读写或者订阅通知。还有最外面一层，Profile配置文件，把若干个相关的 Service 组合在一起，就成为了一个 Profile，Profile 就是定义了一个实际的应用场景。 </p>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5Cbluetooth_20180706102358.png" alt="Bluetooth02_20180706102358"></p>
<p>Service、Characteristic相当于标签（Service相当于他的类别，Characteristic相当于它的名字），而value才真正的包含数据，Descriptor是对这个value进行的说明和描述，当然我们可以从不同角度来描述和说明，因此可以有多个Descriptor. </p>
<ul>
<li>例如: </li>
</ul>
<p>常见的小米手环是一个BLE设备，（假设）它包含三个Service,分别是提供设备信息的Service、提供步数的Service、检测心率的Service; 而设备信息的service中包含的characteristic包括厂商信息、硬件信息、版本信息等；而心率Service则包括心率characteristic等，而心率characteristic中的value则真正的包含心率的数据，而descriptor则是对该value的描述说明，比如value的单位啊，描述啊，权限啊等。 </p>
<h5 id="GAP-Generic-Access-Profile"><a href="#GAP-Generic-Access-Profile" class="headerlink" title="GAP(Generic Access Profile)"></a>GAP(Generic Access Profile)</h5><p>它定义了 BLE 整个通信过程中的流程，例如广播、扫描、连接等流程。还定义了参与通信的设备角色，以及他们各自的职能，例如广播数据的 Broadcaster，接收广播的 Observer，还有被连接的“外设” Peripheral 和发起连接的“中心设备” Central。可以看到，参与交互的设备角色都不是对等 </p>
<h5 id="Applications"><a href="#Applications" class="headerlink" title="Applications"></a>Applications</h5><p>就是使用 Host 提供的 API 开发的低功耗蓝牙应用。 到这里，我们就把 BLE 的协议栈过了一下，为我们开发 BLE 有了一些理论基础。 </p>
<h4 id="BLE-on-Android"><a href="#BLE-on-Android" class="headerlink" title="BLE on Android"></a>BLE on Android</h4><ul>
<li><p>Central mode :  从Android 4.3 Jelly Bean，也就是 API 18 才开始支持低功耗蓝牙(蓝牙4.0)。这时支持 BLE 的 Central 模式，也就是我们在上面 GAP 中说的，Android 设备只能作为中心设备去连接其他设备。</p>
</li>
<li><p>Peripheral mode:从 Android 5.0 开始才支持外设模式(蓝牙4.1)。Android 设备现在可以发挥蓝牙 LE <em>外围设备</em>的作用。应用可以利用此功能让附近设备发现它。例如，您可以开发这样的应用：让设备发挥计步器或健康监测仪的作用，并与其他蓝牙 LE 设备进行数据通信。</p>
<p>新增的 <code>android.bluetooth.le</code> API 让您的应用可以发布广告、扫描响应以及与附近的蓝牙 LE 设备建立连接。要使用新增的广告和扫描功能，请在您的清单中添加 <code>BLUETOOTH_ADMIN</code> 权限。当用户更新您的应用或从 Play 商店下载您的应用时，会被要求向您的应用授予以下权限：“Bluetooth connection information:Allows the app to control Bluetooth, including broadcasting to or getting information about nearby Bluetooth devices.”</p>
<p>要启动蓝牙 LE 广播，以便其他设备能发现您的应用，请调用 <code>startAdvertising()</code>，并传入 <code>AdvertiseCallback</code> 类的实现。回调对象会收到广播操作成功或失败的报告。</p>
<p>Android 5.0 引入了 <code>ScanFilter</code> 类，让您的应用可以只扫描其感兴趣的特定类型设备。要开始扫描蓝牙 LE 设备，请调用 <code>startScan()</code>，并传入筛选器列表。在方法调用中，您还必须提供 <code>ScanCallback</code> 的实现，以便在发现蓝牙 LE 广播时进行报告。</p>
<p><a href="https://developer.android.com/about/versions/android-5.0?hl=zh-cn#BluetoothBroadcasting">https://developer.android.com/about/versions/android-5.0?hl=zh-cn#BluetoothBroadcasting</a></p>
<p><a href="https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection">https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection</a></p>
</li>
</ul>
<h5 id="Android-7-0-蓝牙架构"><a href="#Android-7-0-蓝牙架构" class="headerlink" title="Android 7.0 蓝牙架构"></a>Android 7.0 蓝牙架构</h5><p><img src="/2018/07/05/Bluetooth02/v2-8bf93957bb78f938894bec7749a0433b_hd.jpg" alt="v2-8bf93957bb78f938894bec7749a0433b_hd"></p>
<h5 id="Android-8-0-蓝牙架构"><a href="#Android-8-0-蓝牙架构" class="headerlink" title="Android 8.0 蓝牙架构"></a>Android 8.0 蓝牙架构</h5><p>Android 提供支持经典蓝牙和蓝牙低功耗的默认蓝牙堆栈。借助蓝牙，Android 设备可以创建个人区域网络，以便通过附近的蓝牙设备发送和接收数据。</p>
<p>在 Android 4.3 及更高版本中，Android 蓝牙堆栈可提供实现蓝牙低功耗 (BLE) 的功能。要充分利用 BLE API，请遵循 <a href="https://source.android.com/devices/bluetooth/hci_requirements.html?hl=zh-cn">Android 蓝牙 HCI 要求</a>。具有合格芯片组的 Android 设备可以实现经典蓝牙或同时实现经典蓝牙和 BLE。BLE 不能向后兼容较旧版本的蓝牙芯片组。</p>
<p>在 Android 8.0 中，原生蓝牙堆栈完全符合蓝牙 5.0 的要求。要使用可用的蓝牙 5.0 功能，该设备需要具有符合蓝牙 5 要求的芯片组。</p>
<p><strong>注意</strong>：Android 8.0 及以前版本之间的原生蓝牙堆栈的最大变化是使用<a href="https://source.android.com/devices/architecture/treble.html?hl=zh-cn">高音</a>。Android 8.0 中的供应商实现必须使用 HIDL 而不是 <code>libbt-vendor</code>。</p>
   <img src="/2018/07/05/Bluetooth02/bluetooth_fluoride_architecture.png" alt="fluoride_archite">

<ul>
<li><p>蓝牙系统服务</p>
<p>蓝牙系统服务（位于 <code>packages/apps/Bluetooth</code> 中）被打包为 Android 应用，并在 Android 框架层实现蓝牙服务和配置文件。此应用通过 JNI 调用原生蓝牙堆栈。</p>
</li>
<li><p>JNI</p>
<p>与 android.bluetooth 相关联的 JNI 代码位于 <code>packages/apps/Bluetooth/jni</code> 中。当发生特定蓝牙操作时（例如发现设备时），JNI 代码会调用蓝牙堆栈。</p>
</li>
<li><p>蓝牙堆栈</p>
<p>系统在 AOSP 中提供了默认蓝牙堆栈，它位于 <code>system/bt</code> 中。该堆栈会实现常规蓝牙 HAL，并通过扩展程序和更改配置对其进行自定义。</p>
</li>
<li><p>供应商实现</p>
<p>供应商设备使用硬件接口设计语言 (HIDL) 与蓝牙堆栈交互。</p>
</li>
</ul>
<img src="/2018/07/05/Bluetooth02/android-stack_2x.png" alt="android-stack_2x" style="zoom:67%;">

<h4 id="HIDL"><a href="#HIDL" class="headerlink" title="HIDL"></a>HIDL</h4><p><a href="https://source.android.com/devices/architecture/hidl.html?hl=zh-cn">HIDL</a> 定义了蓝牙堆栈和供应商实现之间的接口。要生成蓝牙 HIDL 文件，请将蓝牙接口文件传递到 HIDL 生成工具中。接口文件位于 <code>hardware/interfaces/bluetooth</code> 下。</p>
<p><del>Android 7.x 及更早版本的蓝牙架构</del></p>
<p><a href="https://developer.android.com/guide/platform/?hl=zh-cn">https://developer.android.com/guide/platform/?hl=zh-cn</a></p>
<p><a href="https://source.android.com/setup/">https://source.android.com/setup/</a></p>
<p><a href="https://source.android.com/devices/bluetooth/?hl=zh-cn">https://source.android.com/devices/bluetooth/?hl=zh-cn</a></p>
<h5 id="Android-中-BLE-操作的过程"><a href="#Android-中-BLE-操作的过程" class="headerlink" title="Android 中 BLE 操作的过程"></a>Android 中 BLE 操作的过程</h5><p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5Cbluetooth_20180706120947.png" alt="bluetooth_20180706120947"></p>
<p>这里介绍一下 Android 中 BLE 操作的过程，APP 发起一个 BLE 操作，然后理解返回，操作结果通过回调上报。操作被封装为一个消息，然后放到协议栈的消息队列中，有一个独立的线程获取消息进行处理，类似于 Looper 和 Handler 机制。</p>
<p>因为是使用消息机制，回调的时候必须知道通知哪个客户端？客户端发起请求之前，首先要向协议栈注册客户端，注册成功以后，返回一个 clientIf，这是一个整型，是客户端在协议栈的一个句柄，客户端的后续操作，都只需要带上这个 clientIf 句柄即可。</p>
<p>在操作完成的时候，一般都有一个显式的停止操作，用来释放前面的申请的 clientIf 和资源。如果不能正确的释放，不仅会造成内存泄漏，而且可能会导致后续所有的 BLE 操作都是不能做了。因为这个 clientIf 是有限，在现在蓝牙协议栈中只有 32 个，而且是Android 上所有 APP 共用的。当这些资源用完以后，只有通过杀掉对应的 APP 或者重启蓝牙才能恢复。</p>
<h5 id="BLE-应用"><a href="#BLE-应用" class="headerlink" title="BLE 应用"></a>BLE 应用</h5><p>BLE 应用可以分为两大类：基于非连接的和连接的。</p>
<ul>
<li><p>Beacon 基于非连接的，这种应用就是依赖 BLE 的广播，也叫作 Beacon。这里有两个角色，发送广播的一方叫做 Broadcaster，监听广播的一方叫 Observer。</p>
</li>
<li><p>基于连接的，就是通过建立 GATT 连接，收发数据。这里也有两个角色，发起连接的一方，叫做中心设备—Central，被连接的设备，叫做外设—Peripheral。</p>
</li>
</ul>
<h6 id="非连接"><a href="#非连接" class="headerlink" title="非连接"></a>非连接</h6><p>它的网络拓扑结构如下。我们知道广播是单向的，Broadcaster 向外广播，监听者接收附近的广播，整体来说形成一个单向的星型。网络中可以有多个外设，也可以有多个监听者 </p>
<p>还有些设备，可以同时实现两个角色，既能发送广播，也可以接收广播。一个设备接收到广播，可以通过处理，然后再转发出去，这样就可以形成一个双向的网格，这就是蓝牙的 Mesh。这样的网络可以不受蓝牙传输距离限制了，只要在空间中布置足够密集的节点，就能把信息从网络一点，传递到任何一点。这个可以应用在物联网和智能家居系统中。 </p>
<p>前面在介绍协议栈物理层的时候，我们知道广播只在37、38、39这三个广播频道进行广播，监听者也在这三个频道进行监听。我们前面介绍了，蓝牙通信是跳频的，只有双方设备在某个时刻跳到同一个频到上，才能收到广播，这种传播数据效率比较低，数据量也有限，不适合大规模的数据传输。 </p>
<ul>
<li>广播包 </li>
</ul>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5CAndroid-BLE-in-Action.018.jpeg" alt="Android-BLE-in-Action.018"></p>
<p>​    广播数据其实包含两部分：Advertising Data（广播数据） 和 Scan Response Data（扫描响应数据）。通常    情况下，广播的一方，按照一定的间隔，往空中广播 Advertising Data，当某个监听设备监听到这个广播数据时    候，会通过发送 Scan Response Request，请求广播方发送扫描响应数据数据。这两部分数据的长度都是固定的 31 字节。在 Android 中，系统会把这两个数据拼接在一起，返回一个 62 字节的数组。</p>
<p>广播数据包的结构如这个图所示。广播包中是包含一个一个的小 AD structure，每个 AD structure 是一个完整的数据，它的结构是：第一个字节表示长度 n，后面紧接 n 个字节的数据。数据部分第一个字节表示数据类型，也就是后面的数据含义，后面 n - 1 个字节表示真实数据.</p>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5CAndroid-BLE-in-Action.019.jpeg" alt="Android-BLE-in-Action"></p>
<p>这些广播数据可以自己手动去解析，在 Android 5.0 也提供 ScanRecord 帮你解析，直接可以通过这个类获得有意义的数据。</p>
<ul>
<li><p>广播数据类型：设备连接属性，标识设备支持的 BLE 模式，这个是必须的。设备名字，设备包含的关键 GATT service，或者 Service data，厂商自定义数据等等。  </p>
</li>
<li><p>RSSI （信号强度 ）：RSSI 单位是 dB，通过 RSSI 能够大致推测出距离的远近。但是这个在 Android 设备上非常不靠谱，RSSI 的值波动很大，跟环境和手机的角度关系很大。 </p>
<p>​     Android 作为接收者怎么接收广播数据，扫描设备。代码其实很简单，首先创建一个 LeScanCallback，用来接收收到广播以后，回调上报数据。然后会用 BluetoothAdapter 的 startLeScan 来开始扫描，需要停止扫描的时候，使用 stopLeScan 来停止。 有 BluetoothDevice 这个参数，代表扫描到的设备，关键是设备的的 MAC 地址信息。然后就是 RSSI，表示扫描到的设备的信号强度，接下来 scanRecord 就是我们前面介绍的广播数据，这个数据的长度是62字节。值得提的一点是，BLE 所有回调函数都不是在主线程中的。</p>
<p>这里有几点需要注意，这里在不需要扫描以后，一定要 stopLeScan，而且 start 和 stop 中传入的 LeScanCallback 一定要是同一个，因为 LeScanCallback 就是我们客户端的标识。否者就会出现我们前面说的 clientIf 不释放的问题。在 Android 开发中，我们经常会使用匿名内部类来做参数，在这里就千万不要这么做。</p>
<p>在 Android 5.0 中，提供了全新的扫描 API — BluetoothLeScanner，它提供了对扫描更加精细的控制。</p>
<p>除了这种方法，还可以使用经典蓝牙扫描的方式，BluetoothAdapter 的 startDiscovery()，然后通过 BroadcastReceiver 来接收收到的广播。如果只是做 BLE 的开发，不建议使用这个方法，这是一个非常重的操作，灵活性非常差。</p>
</li>
<li><p>扫描的工作流程 </p>
<p><img src="/2018/07/05/Bluetooth02/E:/noteforme.github.io\source_posts\Bluetooth02\Android-BLE-in-Action.021.jpeg"></p>
<p>​    首先 APP 发起扫描请求，通过蓝牙的 Service 发送请求给蓝牙芯片。蓝牙芯片开始扫描，扫描到了设备，就通过回调上报。我们知道，扫描真正执行实在 BT 芯片中，只要 APP 发送了请求下去以后，Android 系统就可以休眠了，也就是我们常说的 AP （Application Processor），等扫描到了设备以后，底层 BP （Baseband Processor）就会唤醒上层 AP，执行回调通知到 APP，（动画）就像我们图中红色框标出的这样。这里有一个问题，随着我们周围的 BLE 设备逐渐增多，频繁扫描到设备，系统就会被频繁的唤醒，甚至睡眠不下去，从而导致耗电严重。</p>
<p>为了避免这种问题，耗电的问题。我们需要尽可能少的使用扫描。即使需要扫描，我们也希望尽可能少的上报扫描到的设备。这里就可以使用 Android 5.0 上提供的新接口，设置 ScanFilter，通过一定的规则过滤，只有扫描到了符合我们的规则的设备才上报，或者通过设置延迟上报，从而减少唤醒系统的次数。</p>
<p>这里总结一下扫描中一些建议。1、首先，尽可能使用新的 API，功能更强大；2、尽可能少地扫描，因为毕竟扫描是一个比较重的操作，耗电，也会减慢 BLE 连接速度；3、扫描的时候，尽量设置 ScanFilter，只扫描那些你感兴趣的设备，而不是全盘扫描；4、正确使用 API，特别是合理停止扫描，防止资源泄漏。</p>
</li>
<li><p>Android手机 作为 Broadcaster</p>
<p>从 Android 5.0 开始，Android 设备就可以像外设一样发送 BLE 广播了。这时 Android 设备之间就可以通过 BLE 来交互数据，或者发现对方设备了，例如类似 NFC 一样交换简单信息的应用，想象空间还是很大的。</p>
<p>Android 中实现的代码如下，通过前面的介绍，我们知道广播有两种包：Advertising Data 和 Scan Response Data，我们这里设置好这两种包，然后通过 BluetoothLeAdvertier 的 startAdvertising 就可以了。这里需要注意的点和前面一样，Start 了，需要注意 Stop。</p>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5CAndroid-BLE-in-Action.023.jpeg" alt="Android-BLE-in-Action"></p>
</li>
</ul>
<h5 id="基于连接"><a href="#基于连接" class="headerlink" title="基于连接"></a>基于连接</h5><p>BLE 连接的建立是通过 GAP 来协商和创建连接。Central 设备发起连接，外设接收连接请求，并协商连接参数。</p>
<p>前面我们介绍了 GATT，GATT 核心内容就是 Service、Characteristic 以及 Descriptor。每个 BLE 外设，根据自己的功能，向外暴露 Service 等。其实最重要的获取 Service 中的 Characteristic，Characteristic 可以被读、写、还有变化的时候有通知，这样就实现了双向的通信。</p>
<p> <img src="/2018/07/05/Bluetooth02/Bluetooth02%5Cbluetooth_2018-02-02.png" alt="bluetooth_2018-02-02.png"></p>
<p>​            连接到GATT服务器（发送数据的BLE设备）</p>
<p><a href="https://blog.csdn.net/Roshen_android/article/details/76916111">https://blog.csdn.net/Roshen_android/article/details/76916111</a></p>
<p><a href="https://www.race604.com/android-ble-in-action/">https://www.race604.com/android-ble-in-action/</a></p>
<p> <a href="http://yannischeng.com/Android%20BLE%20%E8%93%9D%E7%89%99%E5%BC%80%E5%8F%91/">http://yannischeng.com/Android%20BLE%20%E8%93%9D%E7%89%99%E5%BC%80%E5%8F%91/</a></p>
]]></content>
      <categories>
        <category>BLE</category>
      </categories>
  </entry>
  <entry>
    <title>Concurrency_SychronizedVolatile</title>
    <url>/2021/03/08/Concurrency-SychronizedVolatile/</url>
    <content><![CDATA[<img src="/2021/03/08/Concurrency-SychronizedVolatile/2020-08-19_at_3.54.13.png" alt="Screen Shot 2020-08-19_at_3.54.13 PM">

<h4 id="MESI"><a href="#MESI" class="headerlink" title="MESI"></a>MESI</h4><p>为什么需要MESI协议 : CPU的高度运算需要高速的数据,然而内存和硬盘的发展速度远远不及CPU</p>
<p>一个CPU的变量发生改变，其他拥有这个变量CPU需要同步.</p>
<p>查看如下链接的 多核缓存协同操作流程图</p>
<p><img src="https://images2018.cnblogs.com/blog/1195582/201805/1195582-20180503162525310-2087402052.png"></p>
<p> <a href="https://www.bilibili.com/video/BV1fK4y1E7NC%E8%A7%86%E9%A2%91%E8%AE%B2%E8%A7%A3%E4%BA%86%E8%BF%99%E4%B8%AA%E7%8A%B6%E6%80%81%E5%9B%BE%E7%9A%84%E5%90%84%E4%B8%AA%E6%83%85%E5%86%B5">https://www.bilibili.com/video/BV1fK4y1E7NC视频讲解了这个状态图的各个情况</a>.</p>
<p><a href="https://www.cnblogs.com/yanlong300/p/8986041.html">https://www.cnblogs.com/yanlong300/p/8986041.html</a></p>
<p><a href="https://www.codenong.com/cs106520859/">https://www.codenong.com/cs106520859/</a></p>
<p><img src="https://www.researchgate.net/profile/Paul-Mckenney/publication/228824849/figure/fig4/AS:340743597117458@1458251012215/Caches-With-Store-Forwarding.png"></p>
<p>Memory Barriers</p>
<p>通过 Store Forwarding 解决了单个 CPU 执行顺序性和内存可见性问题，但是在全局多 CPU 的环境下，这种内存可见性恐怕就很难保证了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">foo</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> a = <span class="number">1</span>;</span><br><span class="line"> b = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bar</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">while</span> (b == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"> <span class="keyword">assert</span>(a == <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设上面的 foo 方法被 CPU 0 执行，bar 方法被 CPU 1  执行，也就是我们常说的多线程环境。试想，即便在多线程环境下，foo 和 bar 如若严格按照理想的顺序执行，是无论如何都不会出现 assert  failed 的情况的。但往往事与愿违，这种看似很诡异的且有一定几率发生的 assert failed ，结合上面所说的 Store  Buffer 就一点都不难理解了。</p>
<p>我们来还原 assert failed 的整个过程，假设 a,b 初始值为 0 ，a 被 CPU0 和 CPU1 共同持有，b 被 CPU0 独占；</p>
<p>CPU0 处理 a=1 之前发送 Invalidate 消息给 CPU1 ，并将其<strong>放入 Store Buffer ，尚未及时刷入缓存</strong>；</p>
<p>CPU 0 转而处理 b=1 ，此时 b=1 直接被刷入缓存；<br> CPU 1 发出 Read 消息读取 b 的值，发现 b 为 1 ，跳出 while 语句；</p>
<p>CPU 1 发出 Read 消息读取 a 的值，发现 a 却为旧值 0，assert failed。</p>
<p>在日常开发过程中也是完全有可能遇到上面的情况，由于 a 的变更对 CPU1 不可见，虽然执行指令的时序没有真正被打乱，但对于 CPU1  来说，这造成了 b=1 先于 a=1 执行的假象，这种看是乱序的问题，通常称为 “重排序”。当然上面所说的情况，只是指令重排序的一种可能。</p>
<h5 id="Java内存模型-工作内存与主内存之间的原子操作"><a href="#Java内存模型-工作内存与主内存之间的原子操作" class="headerlink" title="Java内存模型 工作内存与主内存之间的原子操作"></a>Java内存模型 工作内存与主内存之间的原子操作</h5><p>lock( 锁定 )：作用于<strong>主内存的变量</strong>，把一个变量标识为一条线程独占的状态。</p>
<p>unlock（解锁）：作用于<strong>主内存</strong>的变量，把一个处于锁定的变量释放出来，释放变量才可以被其他线程锁定。</p>
<p>read（读取）：作用于<strong>主内存</strong>的变量，把一个变量的值从主内存传输到线程的工作内存中，以便随后的load动作使用。</p>
<p>load（载入）：作用于<em><strong>工作内存</strong></em>的变量，它把read操作从主内存中得到的变量值放入工作内存的变量副本中。</p>
<p>use（使用）：作用于<em><strong>工作内</strong></em>存种的变量，它把工作内存中一个变量的值传递给执行引擎，每当虚拟机遇到一个需要使用到变量的值的字节码指令时将会执行这个操作。</p>
<p>assign（赋值）：作用于<em><strong>工作内存</strong></em>中的变量，它把一个从执行引擎接收到的值赋给工作内存的变量，每当虚拟机遇到一个给变量赋值的字节码指令时执行这个操作。</p>
<p>store（存储）：作用于<em><strong>工作内存</strong></em>的变量，它把工作内存中一个变量的值传送到主内存中，以便随后的write操作使用</p>
<p>write（写入）：作用于<strong>主内存</strong>的变量，它把store操作从工作内存中得到的值放入主内存的变量中。</p>
<p>深入理解java虚拟机(12.3.2 内存间交互操作)</p>
<h5 id="总线上传递的消息"><a href="#总线上传递的消息" class="headerlink" title="总线上传递的消息"></a>总线上传递的消息</h5><p>首先不同CPU之间也是需要沟通的，这里的沟通是通过在消息总线上传递message实现的。</p>
<p><strong>Read</strong>: sent if CPU needs to read from an address</p>
<p><em><strong>Read Response:</strong></em> response to a <em>read</em> message, carries the data at the requested address</p>
<p><strong>Invalidate</strong>: asks others to evict a cache line <em>Invalidate Acknowledge:</em> reply indicating that an</p>
<p><strong>Read Invalidate:</strong> like <em>Read</em> + <em>Invalidate</em> (also called “read with intend to modify”)</p>
<p>​        </p>
<p><strong>Writeback:</strong> info on what data has been sent to main memory</p>
<p>​                        该消息包含一个物理内存地址和数据内容，目的是把这块数据通过总线写回内存里。</p>
<ul>
<li><p>Read：当CPU在自己的cache中没有发现需要的物理地址，就会发送一条“READ”消息，该消息包括缓存行需要读的物理地址。</p>
</li>
<li><p>Read Response: 顾名思义，”Read Response”消息是回复“Read”消息的。“Read  Response”消息是由内存或者其他CPU缓存提供的。如果其他缓存请求一个处于“modified”状态的数据，则本地缓存必须提供“Read  Response”消息。这个很容易理解，别的CPU在请求本地缓存中的数据，而这份数据还没有刷新到内存，所以必须告诉其他CPU该数据的最新值。接收到”Read Response”消息后，该数据的缓存状态就由”invalid”变成了”share”或者”exclusive”，这取决于”Read  Response”的提供者是内存还是其他CPU缓存。</p>
</li>
<li><p>Invalidate：“ invalidate”  消息包含要使无效的缓存行的物理地址。其他的缓存必须从它们的缓存中移除相应的数据并且响应此消息。当CPU要对一个变量进行写操作，而此变量处于只读状态(share)，就需要发送“invalid”消息。由于一个变量被多个CPU缓存，所以单个CPU的改写会造成缓存不一致，所以在写之前必须告诉其他CPU你们缓存的值马上就要过时了。接受到”invalidate”消息的CPU就会把本地缓存中的对应数据无效掉。</p>
</li>
<li><p>Invalidate Acknowledge：一个接收到“invalidate”消息的  CPU必须在移除指定数据后响应一个“invalidate  acknowledge”消息。这个消息就是告诉“invalidate”消息的提供者“我已经知道你要更改这个数据了，我放弃使用自己缓存中的拷贝！”</p>
</li>
<li><p>Read Invalidate：”read  invalidate”消息包含要缓存行读取的物理地址。同时指示其他缓存移除数据。因此，它包含一个”read”和一个”invalidate”。“read invalidate”也需要“read response”以及”invalidate acknowledge”消息集。</p>
<pre><code>“Read  Invalidate”消息的发送时机有两个：第一个是CPU对一个数据进行原子读写操作，但是该数据没有在本地CPU的缓存中，在其他CPU缓存中可能有该数据的拷贝。所以它需要发送一条“Read Invalidate”消息，它不仅需要读取该数据的最新值，还要无效掉其他的CPU缓存(它马上就要改写该数据)。
</code></pre>
</li>
<li><p>Writeback：“writeback”消息包含要回写到内存的地址和数据。这个消息允许缓存在必要时换出“modified”状态的数据以腾出空间。消息的发送时机是，CPU把本地缓存中的数据刷新到内存中，而该数据是share状态(只读)，它需要告诉其他CPU”我不再使用这些缓存数据了”</p>
</li>
</ul>
<p><a href="http://intheworld.win/2015/07/16/%E5%A4%9A%E6%A0%B8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AEmesi/">http://intheworld.win/2015/07/16/%E5%A4%9A%E6%A0%B8%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E5%8D%8F%E8%AE%AEmesi/</a></p>
<h5 id="MESI为什么还需要volatile"><a href="#MESI为什么还需要volatile" class="headerlink" title="MESI为什么还需要volatile?"></a>MESI为什么还需要volatile?</h5><p>volatile 和MESI 中间差了好几层抽象，中间会经历java编译器，java虚拟机和JIT，操作系统，CPU核心。</p>
<p>volatile 是Java 中标识变量可见性的关键字，说直接点：使用volatile 修饰的变量是有内存可见性的，这是Java  语法定的，Java 不关心你底层操作系统、硬件CPU 是如何实现内存可见的，我的语法规定就是volatile 修饰的变量必须是具有可见性的。</p>
<p>CPU 有X86（复杂指令集）、ARM（精简指令集）等体系架构，版本类型也有很多种，CPU 可能通过锁总线、MESI  协议实现多核心缓存的一致性。因为有硬件的差异以及编译器和处理器的指令重排优化的存在，所以Java  需要一种协议来规避硬件平台的差异，保障同一段代表在所有平台运行效果一致，这个协议叫做Java 内存模型（Java Memory Model）。</p>
<p><a href="https://www.wwwbuild.net/java3y/5614.html">https://www.wwwbuild.net/java3y/5614.html</a></p>
<p>可见性问题存在的主要原因就是，Store Buffer ，尚未及时刷入缓存，然后其他CPU还是从内存里面取出旧值.为了提高CPU效率，MESI引入了缓存失效机制.</p>
<p><a href="https://www.cnblogs.com/xmzJava/p/11417943.html">https://www.cnblogs.com/xmzJava/p/11417943.html</a>   <strong>这篇文章很好</strong></p>
<p>而对于JAVA而言，他必须要屏蔽各个处理器的差异，所以才有了java内存模型(JMM),volatile只是内存模型的一小部分，实现了变量的可见性和禁止指令重排序优化的功能。整个内存模型必须要实现可见性，原子性，和有序性。而volatile实现了其中的可见性和有序性。</p>
<h5 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h5><p>上面说的意思是volitle是上层实现，不管底层是什么，其实MESI volatile还是没搞懂，但是MESI是CPU具体存在的，而且MESI也和可见性差不多原理，如果不用volatile就没有MESI了？</p>
<p><a href="https://www.scss.tcd.ie/jeremy.jones/VivioJS/caches/MESI.htm">https://www.scss.tcd.ie/jeremy.jones/VivioJS/caches/MESI.htm</a></p>
<p>各种文章人云亦云，要么直接回避上面问题，有的还说volatile保障MESI,自己相信吗?</p>
<p><a href="https://www.youtube.com/watch?v=q8r7b1KMUlE">https://www.youtube.com/watch?v=q8r7b1KMUlE</a></p>
<p>看了<strong>这个视频感觉</strong>能说通了，volatile是在MESI基础上，禁止指令重排序(加了栅栏),来保障可见性。</p>
<p>有空看看其他几个视频链接，该删的删.</p>
<h5 id="CPU代码执行顺序"><a href="#CPU代码执行顺序" class="headerlink" title="CPU代码执行顺序"></a>CPU代码执行顺序</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VisibilityThread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> initFlag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;waiting data...&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (!initFlag) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;=========success&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);</span><br><span class="line"></span><br><span class="line">        initFlag = <span class="keyword">false</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">new</span> Thread(()-&gt;prepareData()).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">prepareData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;prepareData&quot;</span>);</span><br><span class="line">        initFlag = <span class="keyword">true</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;prepare data end..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>流程图</p>
<p><img src="/2021/03/08/Concurrency-SychronizedVolatile/2021-03-11_at_10.30.09.png"></p>
<p><a href="https://www.bilibili.com/video/BV1XZ4y157Pj?p=4">https://www.bilibili.com/video/BV1XZ4y157Pj?p=4</a></p>
<h5 id="Volatile禁止重排序"><a href="#Volatile禁止重排序" class="headerlink" title="Volatile禁止重排序"></a>Volatile禁止重排序</h5><p>单个线程中，只要重排序不会对结果产生影响，就不能保证其中的操作一定按照程序写定的顺序执行——即使重排序对于其他线程会产生影响。java并发编程实战3.1</p>
<p>这个视频讲了 Volatile重排序的实现，没讲可见性</p>
<p><a href="https://www.bilibili.com/video/BV1UD4y127Kw?p=4">https://www.bilibili.com/video/BV1UD4y127Kw?p=4</a> </p>
<p><a href="https://blog.csdn.net/reliveIT/article/details/50450136">https://blog.csdn.net/reliveIT/article/details/50450136</a></p>
<p>第五章 Cache - 处理器的肚量(大话处理器-处理器基础知识读本)</p>
<p><a href="https://zhuanlan.zhihu.com/p/148772753">https://zhuanlan.zhihu.com/p/148772753</a></p>
<p><a href="https://www.bilibili.com/video/BV1tE411o7oj?p=2">https://www.bilibili.com/video/BV1tE411o7oj?p=2</a></p>
<p><a href="https://wudaijun.com/2019/04/cpu-cache-and-memory-model/#valine-comments">https://wudaijun.com/2019/04/cpu-cache-and-memory-model/#valine-comments</a></p>
<h4 id="Sychronized三种应用方式"><a href="#Sychronized三种应用方式" class="headerlink" title="Sychronized三种应用方式"></a>Sychronized三种应用方式</h4><ul>
<li>修饰实例方法，作用于当前实例加锁，进入同步代码前要获得当前实例的锁</li>
<li>修饰静态方法，作用于当前类对象加锁，进入同步代码前要获得当前类对象的锁</li>
<li>修饰代码块，指定加锁对象，对给定对象加锁，进入同步代码库前要获得给定对象的锁。</li>
</ul>
<ol>
<li><p>作用于实例方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span></span>&#123;</span><br><span class="line">      i++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountingSync</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">    <span class="comment">//共享资源(临界资源)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * synchronized 修饰实例方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">1000000</span>;j++)&#123;</span><br><span class="line">            increase();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        AccountingSync instance=<span class="keyword">new</span> AccountingSync();</span><br><span class="line">        Thread t1=<span class="keyword">new</span> Thread(instance);</span><br><span class="line">        Thread t2=<span class="keyword">new</span> Thread(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出结果:</span></span><br><span class="line"><span class="comment">     * 2000000</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当一个线程正在访问一个对象的 synchronized 实例方法，那么其他线程不能访问该对象的其他 synchronized 方法，毕竟一个对象只有一把锁。</p>
<p>如果是一个线程 A 需要访问实例对象 obj1 的 synchronized 方法 f1(当前对象锁是obj1)，另一个线程 B  需要访问实例对象 obj2 的 synchronized 方法 f2(当前对象锁是obj2)，这样是允许的，因为两个实例对象锁并不同相同</p>
</li>
<li><p>synchronized作用于静态方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">synchronized_01</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对于全局</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1000000</span>; j++) &#123;</span><br><span class="line">            increase();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//new新实例</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> AccountingSyncBad());</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">1000000</span>; j++) &#123;</span><br><span class="line">            increase();</span><br><span class="line">        &#125;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 输出结果:</span></span><br><span class="line"><span class="comment">     * 2000000</span></span><br><span class="line"><span class="comment">     */</span></span><br></pre></td></tr></table></figure>

<p>其锁对象是当前类的class对象. 可以看到主线程和自线程发生互斥。</p>
</li>
<li><p>synchronized同步代码块</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">synchronized_03</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> synchronized_03 instance=<span class="keyword">new</span> synchronized_03();</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i=<span class="number">0</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//省略其他耗时操作....</span></span><br><span class="line">        <span class="comment">//使用同步代码块对变量i进行同步操作,锁对象为instance</span></span><br><span class="line">        <span class="keyword">synchronized</span>(instance)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">1000000</span>;j++)&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">//new新实例</span></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> synchronized_03());</span><br><span class="line">        t1.start();</span><br><span class="line">        System.out.println(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将synchronized作用于一个给定的实例对象instance，即当前实例对象就是锁对象.当然除了instance作为对象外，我们还可以使用this对象(代表当前实例)或者当前类的class对象作为锁</p>
<p>//this,当前实例对象锁</p>
<figure class="highlight d"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(<span class="keyword">this</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">1000000</span>;j++)&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//class对象锁</span></span><br><span class="line"><span class="keyword">synchronized</span>(AccountingSync.<span class="keyword">class</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;<span class="number">1000000</span>;j++)&#123;</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/javazejian/article/details/72828483">https://blog.csdn.net/javazejian/article/details/72828483</a></p>
<h5 id="Sychronized-volatile区别？"><a href="#Sychronized-volatile区别？" class="headerlink" title="Sychronized volatile区别？"></a>Sychronized volatile区别？</h5></li>
</ol>
<ul>
<li>Sychronized </li>
</ul>
<p> 保证原子性和可见性    synchronized可见性，线程加锁时，必须清空工作内存中共享变量的值，从而使用共享变量时需要从主内存重新读取；线程在解锁时，需要把工作内存中最新的共享变量的值写入到主存，以此来保证共享变量的可见性</p>
<ul>
<li><p>volatile</p>
<p> 只能保证可见性</p>
</li>
</ul>
<h4 id="CAS原理"><a href="#CAS原理" class="headerlink" title="CAS原理"></a>CAS原理</h4><h5 id="CAS操作流程"><a href="#CAS操作流程" class="headerlink" title="CAS操作流程"></a>CAS操作流程</h5><img src="https://s0.lgstatic.com/i/image3/M01/80/96/Cgq2xl6EXp-ASQS-AABhaV6D_TQ117.png" style="zoom:50%;">

<img src="https://s0.lgstatic.com/i/image3/M01/80/96/Cgq2xl6EXp-AcJwKAABgmaSYNG4278.png" style="zoom:50%;">

<p>CPU1发现 待修改的变量值是100，期望值100，启动修改</p>
<p>Cpu2发现不是100了，修改失败</p>
<h5 id="CAS缺点"><a href="#CAS缺点" class="headerlink" title="CAS缺点"></a>CAS缺点</h5><ol>
<li><p>ABA问题</p>
<p>从上一次看到这个值以来到现在，这个值是否发生过变化,从 A 变成了 B，再由 B 变回了 A,CAS 并不能检测出在此期间值是不是被修改过，它只能检查出现在的值和最初的值是不是一样。</p>
<p>通过添加版本号解决,A→B→A 变成了 1A→2B→3A,atomic 包中提供了 AtomicStampedReference 这个类，它是专门用来解决 ABA 问题的</p>
</li>
<li><p>自旋时间过长</p>
<p>CAS 往往是配合着循环来实现的，有的时候甚至是死循环，不停地进行重试，直到线程竞争不激烈的时候，才能修改成功</p>
</li>
<li><p>范围不能灵活控制</p>
<p>执行 CAS 的时候，是针对某一个，而不是多个共享变量的，这个变量可能是 Integer 类型，也有可能是 Long 类型、对象类型等等，但是我们不能针对多个共享变量同时进行 CAS 操作，因为这多个变量之间是独立的，简单的把原子操作组合到一起，并不具备原子性.</p>
<p>解决方案:那就是利用一个新的类，来整合刚才这一组共享变量，这个新的类中的多个成员变量就是刚才的那多个共享变量，然后再利用 atomic 包中的 AtomicReference 来把这个新对象整体进行 CAS 操作，这样就可以保证线程安全。</p>
</li>
</ol>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>concurrency</tag>
      </tags>
  </entry>
  <entry>
    <title>Concurrency_thread</title>
    <url>/2021/02/26/Concurrency-thread/</url>
    <content><![CDATA[<p>用户态 : 应用程序运行</p>
<p>内核态 ：操作系统运行</p>
<p><img src="http://s0.lgstatic.com/i/image2/M01/A5/5E/CgotOV3DgLSAGmEWAADo6Lxf6ww652.png"></p>
<h4 id="线程的6中状态"><a href="#线程的6中状态" class="headerlink" title="线程的6中状态"></a>线程的6中状态</h4><ol>
<li>New（新创建）</li>
<li>Runnable（可运行）</li>
<li>Blocked（被阻塞）</li>
<li>Waiting（等待）</li>
<li>Timed Waiting（计时等待）</li>
<li>Terminated（被终止）</li>
</ol>
<p><img src="/2021/02/26/Concurrency-thread/thread_state.png"></p>
<h5 id="状态分析"><a href="#状态分析" class="headerlink" title="状态分析"></a>状态分析</h5><ul>
<li><p>New</p>
<p>​        当我们用 new Thread() 新建一个线程时，如果线程没有开始运行 start() 方法，所以也没有开始执行 run() 方法里面的代码，那么此时它的状态就是 New。而一旦线程调用了 start()，它的状态就会从 New 变成 Runnable</p>
<p>如果一个正在运行的线程是 Runnable 状态，当它运行到任务的一半时，执行该线程的 CPU 被调度去做其他事情，导致该线程暂时不运行，它的状态依然不变，还是 Runnable，因为它有可能随时被调度回来继续执行任务。</p>
</li>
<li><p><strong>Blocked</strong></p>
<p>​    从 Runnable 状态进入 Blocked 状态只有一种可能，就是进入 synchronized 保护的代码时没有抢到 monitor 锁，无论是进入 synchronized 代码块，还是 synchronized 方法，都是一样。</p>
</li>
<li><h6 id="Waiting-等待"><a href="#Waiting-等待" class="headerlink" title="Waiting 等待"></a>Waiting 等待</h6><ol>
<li><p>没有设置 Timeout 参数的 Object.wait() 方法。</p>
</li>
<li><p>没有设置 Timeout 参数的 Thread.join() 方法。</p>
</li>
<li><p>LockSupport.park() 方法。</p>
</li>
</ol>
<p>Blocked 仅仅针对 synchronized monitor 锁，可是在 Java 中还有很多其他的锁，比如 ReentrantLock，如果线程在获取这种锁时没有抢到该锁就会进入 Waiting 状态，因为本质上它执行了 LockSupport.park() 方法，所以会进入 Waiting 状态。同样，Object.wait() 和 Thread.join() 也会让线程进入 Waiting 状态。</p>
<p>Blocked 与 Waiting 的区别是 Blocked 在等待其他线程释放 monitor 锁，而 Waiting 则是在等待某个条件，比如 join 的线程执行完毕，或者是 notify()/notifyAll() 。</p>
</li>
<li><h6 id="Timed-Waiting-限期等待"><a href="#Timed-Waiting-限期等待" class="headerlink" title="Timed Waiting 限期等待"></a>Timed Waiting 限期等待</h6><p>在 Waiting 上面是 Timed Waiting 状态，这两个状态是非常相似的，区别仅在于有没有时间限制，Timed Waiting 会等待超时，由系统自动唤醒，或者在超时前被唤醒信号唤醒。</p>
<p>以下情况会让线程进入 Timed Waiting 状态。</p>
<ol>
<li>设置了时间参数的 Thread.sleep(long millis) 方法；</li>
<li>设置了时间参数的 Object.wait(long timeout) 方法；</li>
<li>设置了时间参数的 Thread.join(long millis) 方法；</li>
<li>设置了时间参数的 LockSupport.parkNanos(long nanos) 方法和 LockSupport.parkUntil(long deadline) 方法。</li>
</ol>
<p>想要从 Blocked 状态进入 Runnable 状态，要求线程获取 monitor 锁，而从 Waiting 状态流转到其他状态则比较特殊，因为首先 Waiting 是不限时的，也就是说无论过了多长时间它都不会主动恢复。</p>
<p>如果其他线程调用 notify() 或 notifyAll()来唤醒它，它会直接进入 Blocked 状态，这是为什么呢？因为唤醒 Waiting 线程的线程如果调用 notify() 或 notifyAll()，要求必须首先持有该 monitor 锁，所以处于 Waiting 状态的线程被唤醒时拿不到该锁，就会进入 Blocked 状态，直到执行了 notify()/notifyAll() 的唤醒它的线程执行完毕并释放 monitor 锁，才可能轮到它去抢夺这把锁，如果它能抢到，就会从 Blocked 状态回到 Runnable 状态。</p>
<p>同样在 Timed Waiting 中执行 notify() 和 notifyAll() 也是一样的道理，它们会先进入 Blocked 状态，然后抢夺锁成功后，再回到 Runnable 状态。</p>
</li>
<li><p>Terminated</p>
<p>run() 方法执行完毕，线程正常退出。</p>
<p>出现一个没有捕获的异常，终止了 run() 方法，最终导致意外终止。</p>
</li>
</ul>
<h5 id="多线程方法"><a href="#多线程方法" class="headerlink" title="多线程方法"></a>多线程方法</h5><h5 id="notify"><a href="#notify" class="headerlink" title="notify()"></a>notify()</h5><p>只能叫醒别人 </p>
<h4 id="状态实例"><a href="#状态实例" class="headerlink" title="状态实例"></a>状态实例</h4><h5 id="WAITING"><a href="#WAITING" class="headerlink" title="WAITING"></a>WAITING</h5><h6 id="wait"><a href="#wait" class="headerlink" title="wait()"></a>wait()</h6><p>WAITING.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">     threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadA.getState());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">               lock.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;Thread-A&quot;</span>);</span><br><span class="line">    threadA.start();</span><br><span class="line">    Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程A的状态 &quot;</span> + threadA.getState());</span><br></pre></td></tr></table></figure>



<h6 id="join"><a href="#join" class="headerlink" title="join"></a>join</h6><p>WaitJOIN.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadA.getState());</span><br><span class="line">            threadB.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;Thread-A&quot;</span>);</span><br><span class="line"></span><br><span class="line">threadB = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadB.getState());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000l</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;Thread-B&quot;</span>);</span><br><span class="line"></span><br><span class="line">threadA.start();</span><br><span class="line">threadB.start();</span><br><span class="line"></span><br><span class="line">Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot;运行 线程A的状态 &quot;</span> + threadA.getState());</span><br></pre></td></tr></table></figure>



<p>运行结果</p>
<hr>
<p>Thread-A RUNNABLE<br>main运行 线程A的状态 WAITING</p>
<hr>
<h6 id="wait-1"><a href="#wait-1" class="headerlink" title="wait"></a>wait</h6><p>WaitState.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line"> threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadA.getState());</span><br><span class="line">            lock.wait();</span><br><span class="line">            Thread.sleep(<span class="number">5000l</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;BLOCKED-Thread-A&quot;</span>);</span><br><span class="line"></span><br><span class="line"> threadB = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadB.getState());</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程A的状态 &quot;</span> + threadA.getState());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">5000l</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;BLOCKED-Thread-B&quot;</span>);</span><br></pre></td></tr></table></figure>

<p> 结果</p>
<hr>
<p>BLOCKED-Thread-A RUNNABLE<br>BLOCKED-Thread-B RUNNABLE<br>BLOCKED-Thread-B 线程A的状态 WAITING</p>
<hr>
<p>从结果可以得到两个结论:</p>
<ol>
<li>线程A调用 lock.wait()后 A出于WAITING状态。</li>
<li>线程A调用 lock.wait()后，立马释放锁，线程B获得锁开始执行。</li>
</ol>
<h6 id="park"><a href="#park" class="headerlink" title="park"></a>park</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">char</span>[] aI = <span class="string">&quot;1234567&quot;</span>.toCharArray();</span><br><span class="line"><span class="keyword">char</span>[] aC = <span class="string">&quot;ABCDEFG&quot;</span>.toCharArray();</span><br><span class="line"></span><br><span class="line">t1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">char</span> c : aI) &#123;</span><br><span class="line">            System.out.print(c);</span><br><span class="line">            LockSupport.unpark(t2); <span class="comment">//叫醒T2</span></span><br><span class="line">            LockSupport.park(); <span class="comment">//T1阻塞</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line"></span><br><span class="line">t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">char</span> c : aC) &#123;</span><br><span class="line">        LockSupport.park(); <span class="comment">//t2阻塞</span></span><br><span class="line">        System.out.print(c);</span><br><span class="line">        LockSupport.unpark(t1); <span class="comment">//叫醒t1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;, <span class="string">&quot;t2&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>轮流打印数字和字母</p>
<h5 id="TIMED-WAITING"><a href="#TIMED-WAITING" class="headerlink" title="TIMED_WAITING"></a>TIMED_WAITING</h5><h6 id="wait-5000"><a href="#wait-5000" class="headerlink" title="wait(5000)"></a>wait(5000)</h6><p>WAITING_TIMEOUT.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadA.getState());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.wait(<span class="number">5000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;Thread-A&quot;</span>);</span><br><span class="line">threadA.start();</span><br><span class="line">Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程A的状态 &quot;</span> + threadA.getState());</span><br></pre></td></tr></table></figure>

<p>运行结果:</p>
<hr>
<p>Thread-A RUNNABLE<br>main 线程A的状态 TIMED_WAITING</p>
<hr>
<h6 id="sleep-5000"><a href="#sleep-5000" class="headerlink" title="sleep(5000)"></a>sleep(5000)</h6><p>TIMED_WAITING.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + threadA.getState());</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;Thread-A&quot;</span>);</span><br><span class="line">threadA.start();</span><br><span class="line">Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程A的状态 &quot;</span> + threadA.getState());</span><br></pre></td></tr></table></figure>



<p>调用了 Thread.sleep(5000l);</p>
<p>运行结果:</p>
<hr>
<p>Thread-A RUNNABLE<br>main 线程A的状态 TIMED_WAITING</p>
<hr>
<h5 id="BLOCKED"><a href="#BLOCKED" class="headerlink" title="BLOCKED"></a>BLOCKED</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">    threadA = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程A的状态 &quot;</span> + threadA.getState());</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程B的状态 &quot;</span> + threadB.getState());</span><br><span class="line">                Thread.sleep(<span class="number">10000l</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;Thread-A&quot;</span>);</span><br><span class="line"></span><br><span class="line">    threadB = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程A的状态 &quot;</span> + threadA.getState());</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 线程B的状态 &quot;</span> + threadB.getState());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">10000l</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;Thread-B&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>运行结果:线程A得到锁，线程B进入阻塞状态。</p>
<hr>
<p>Thread-A 线程A的状态 RUNNABLE<br>Thread-A 线程B的状态 BLOCKED<br>Thread-B 线程A的状态 TERMINATED<br>Thread-B 线程B的状态 RUNNABLE</p>
<hr>
<h5 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h5><ol>
<li><p>线程的状态是需要按照箭头方向来走的，比如线程从 New 状态是不可以直接进入 Blocked 状态的，它需要先经历 Runnable 状态。</p>
</li>
<li><p>线程生命周期不可逆：一旦进入 Runnable 状态就不能回到 New 状态；一旦被终止就不可能再有任何状态的变化。所以一个线程只能有一次 New 和 Terminated 状态，只有处于中间状态才可以相互转换。</p>
</li>
<li><p>Thread sleep() yield()结束后，回到就绪状态.</p>
</li>
</ol>
<p><a href="https://www.geeksforgeeks.org/lifecycle-and-states-of-a-thread-in-java/">https://www.geeksforgeeks.org/lifecycle-and-states-of-a-thread-in-java/</a></p>
<p><a href="https://fangjian0423.github.io/2016/06/04/java-thread-state/">https://fangjian0423.github.io/2016/06/04/java-thread-state/</a></p>
<h6 id="让步-yield"><a href="#让步-yield" class="headerlink" title="让步(yield)"></a>让步(yield)</h6><p>  如果已经完成了run()方法循环的一次迭代过程所需的工作，可以给线程调度机制一个暗示：你的工作已经做的差不多了，可以让别的线程使用CPU了，这个暗示將通过调用yield()来做做出(不过这只是一个暗示，没有任何机制保证它將被采纳)，也只是建议相同优先级的其他线程运行。<br>  -ThinkInJava P661</p>
<p>加入一个线程 (join)</p>
<p>　在Joiner线程里面调用Sleeper线程 的join() , Joiner任务必须等Sleeper任务结束活被打断或结束　才恢复</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sleeper</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> int duration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">Sleeper</span>(<span class="params"><span class="built_in">String</span> name, int sleepTime</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        duration = sleepTime;</span><br><span class="line">        start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.run();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleep(duration);</span><br><span class="line"><span class="comment">//            Print.print(getName()+&quot;执行了&quot;);</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Print.print(getName() + <span class="string">&quot;  被打断&quot;</span> + <span class="string">&quot;isInterrupted()  &quot;</span> + isInterrupted());</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Print.print(getName() + <span class="string">&quot;   has awakened&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Joiner</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Sleeper sleeper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">Joiner</span>(<span class="params"><span class="built_in">String</span> name, Sleeper sleeper</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.sleeper = sleeper;</span><br><span class="line">        start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.run();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            sleeper.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        Print.print(getName() + <span class="string">&quot;   join completed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Joining</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        Sleeper</span><br><span class="line">                sleepy = <span class="keyword">new</span> Sleeper(<span class="string">&quot;Sleepy&quot;</span>, <span class="number">1500</span>),</span><br><span class="line">                grumpy = <span class="keyword">new</span> Sleeper(<span class="string">&quot;Grumpy&quot;</span>, <span class="number">1500</span>);</span><br><span class="line"></span><br><span class="line">        Joiner</span><br><span class="line">                dopey = <span class="keyword">new</span> Joiner(<span class="string">&quot;Dopey&quot;</span>, sleepy),</span><br><span class="line">                doc = <span class="keyword">new</span> Joiner(<span class="string">&quot;Doc&quot;</span>, grumpy);</span><br><span class="line">        grumpy.interrupt();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其他对象上同步</p>
<p> 有时候必须在另一个对象上同步，如果需要这样，必须确保所有相关的任务都是在同一个对象上同步。</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DualSynch</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">Object</span> syncObject = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> synchronized <span class="built_in">void</span> <span class="function"><span class="title">f</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            System.out.print(<span class="string">&quot;  f()  &quot;</span>);</span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  <span class="built_in">void</span> <span class="function"><span class="title">g</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        synchronized (syncObject) &#123;</span><br><span class="line">            <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.print(<span class="string">&quot;  g()  &quot;</span>);</span><br><span class="line">                Thread.yield();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncObject</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line">        DualSynch ds = <span class="keyword">new</span> DualSynch();</span><br><span class="line">        <span class="keyword">new</span> <span class="function"><span class="title">Thread</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">run</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>.run();</span><br><span class="line">                ds.f();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.start();</span><br><span class="line">        ds.g();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这两个方式在同时运行，任何一个方法都没有对另一个方法同步而阻塞</p>
<p>线程间的协作</p>
<p>wait() :  在wait期间　对象锁是释放的,而Sleep期间是没有的</p>
<h4 id="线程的停止方法"><a href="#线程的停止方法" class="headerlink" title="线程的停止方法"></a>线程的停止方法</h4><h5 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h5><p>通常情况下，我们不会手动停止一个线程，而是允许线程运行到结束，</p>
<p>贸然强制停止线程就可能会造成一些安全的问题，为了避免造成问题就需要给对方一定的时间来整理收尾工作。比如：线程正在写入一个文件，这时收到终止信号，它就需要根据自身业务判断，是选择立即停止，还是将整个文件写入成功后停止，而如果选择立即停止就可能造成数据不完整，不管是中断命令发起者，还是接收者都不希望数据出现问题。</p>
<h4 id="正确的停止方式"><a href="#正确的停止方式" class="headerlink" title="正确的停止方式"></a>正确的停止方式</h4><p>对于 Java 而言，最正确的停止线程的方式是使用 interrupt。但 interrupt 仅仅起到通知被停止线程的作用。而对于被停止的线程而言，它拥有完全的自主权，它既可以选择立即停止，也可以选择一段时间后停止，也可以选择压根不停止。首先通过 Thread.currentThread().isInterrupt() 判断线程是否被中断，随后检查是否还有工作要做。&amp;&amp; 逻辑表示只有当两个判断条件同时满足的情况下，才会去执行下面的工作。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; cout&lt;<span class="number">1000</span>) &#123;</span><br><span class="line">    <span class="keyword">do</span> more work</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例子1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; count &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;count = &quot;</span> + count++);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;sleep isInterrupted &quot;</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(<span class="keyword">new</span> StopThread());</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">5</span>);</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line"><span class="built_in">count</span> = <span class="number">0</span></span><br><span class="line"><span class="built_in">count</span> = <span class="number">1</span></span><br><span class="line"><span class="built_in">count</span> = <span class="number">2</span></span><br><span class="line">.</span><br><span class="line">.</span><br><span class="line"><span class="built_in">count</span> = <span class="number">304</span></span><br><span class="line"><span class="built_in">count</span> = <span class="number">305</span></span><br><span class="line"><span class="built_in">count</span> = <span class="number">306</span></span><br><span class="line"><span class="built_in">sleep</span> isInterrupted <span class="literal">true</span></span><br></pre></td></tr></table></figure>



<h5 id="sleep-期间能否感受到中断"><a href="#sleep-期间能否感受到中断" class="headerlink" title="sleep 期间能否感受到中断"></a>sleep 期间能否感受到中断</h5><ol>
<li><p>try catch在while外面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopDuringSleep</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Runnable runnable = () -&gt; &#123;</span><br><span class="line">            <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; num &lt;= <span class="number">1000</span>) &#123;</span><br><span class="line">                    System.out.println(num);</span><br><span class="line">                    num++;</span><br><span class="line">                    Thread.sleep(<span class="number">1000000</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">5</span>);</span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在还没打印完1000个数的时候就会停下来，这种就属于通过 interrupt 正确停止线程的情况。</p>
<p>输出</p>
<blockquote>
<p>0</p>
</blockquote>
</li>
<li><p>try catch在while里面</p>
<p>外层设置标志中断</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopDuringSleep_answer01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Runnable runnable = () -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    subTas2();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"><span class="comment">//                    Thread.currentThread().interrupt(); 注释2</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;thread  isInterrupted &quot;</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">subTas2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;subTas2  isInterrupted &quot;</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<blockquote>
<p>subTas2  isInterrupted false<br>subTas2  isInterrupted false<br>subTas2  isInterrupted false<br>subTas2  isInterrupted false</p>
</blockquote>
<p>把注释打开输出</p>
<blockquote>
<p>subTas2  isInterrupted false<br>thread  isInterrupted true</p>
</blockquote>
<p>结论 ：如果 sleep、wait 等可以让线程进入阻塞的方法使线程休眠了，而处于休眠中的线程被中断，那么线程是可以感受到中断信号的，并且会抛出一个 InterruptedException 异常，<strong>同时清除中断信号，将中断标记位设置成 false</strong>。这样一来就不用担心长时间休眠中线程感受不到中断了，因为即便线程还在休眠，仍然能够响应中断通知，并抛出异常。</p>
<p>我们先来看下 try/catch 的处理逻辑。如上面的代码所示，catch 语句块里代码是空的，它并没有进行任何处理。假设线程执行到这个方法，并且正在 sleep，此时有线程发送 interrupt 通知试图中断线程，就会立即抛出异常，并清除中断信号。抛出的异常被 catch 语句块捕捉。</p>
<p>但是，捕捉到异常的 catch 没有进行任何处理逻辑，相当于把中断信号给隐藏了，这样做是非常不合理的，那么究竟应该怎么处理呢？首先，可以选择在方法签名中抛出异常。</p>
</li>
<li><p>另一种处理方式类似</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StopDuringSleep_answer01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        Runnable runnable = () -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                subTas1();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;thread  isInterrupted &quot;</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread thread = <span class="keyword">new</span> Thread(runnable);</span><br><span class="line">        thread.start();</span><br><span class="line">        Thread.sleep(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">        thread.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">subTas2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;subTas2  isInterrupted &quot;</span> + Thread.currentThread().isInterrupted());</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">subTas1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// 在这里不处理该异常是非常不好的</span></span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再次中断方式 设置标志,在方法中处理，上一种是抛出上一层,在上一层设置标志中断</p>
</li>
</ol>
<h4 id="volatile-修饰标记位不适用的场景"><a href="#volatile-修饰标记位不适用的场景" class="headerlink" title="volatile 修饰标记位不适用的场景"></a>volatile 修饰标记位不适用的场景</h4><h5 id="生产者-消费者模式的案例来演示为什么说-volatile-标记位的停止方法是不完美的。"><a href="#生产者-消费者模式的案例来演示为什么说-volatile-标记位的停止方法是不完美的。" class="headerlink" title="生产者/消费者模式的案例来演示为什么说  volatile 标记位的停止方法是不完美的。"></a>生产者/消费者模式的案例来演示为什么说  volatile 标记位的停止方法是不完美的。</h5><p>生产者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> canceled = <span class="keyword">false</span>;</span><br><span class="line">    BlockingQueue storage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(BlockingQueue storage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.storage = storage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (num &lt;= <span class="number">100000</span> &amp;&amp; !canceled) &#123;</span><br><span class="line">                <span class="keyword">if</span> (num % <span class="number">50</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                    storage.put(num);</span><br><span class="line">                    System.out.println(num + <span class="string">&quot;是50的倍数,被放到仓库中了。&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                num++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;生产者结束运行&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>消费者</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line">    BlockingQueue storage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(BlockingQueue storage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.storage = storage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">needMoreNums</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Math.random() &gt; <span class="number">0.97</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayBlockingQueue storage = <span class="keyword">new</span> ArrayBlockingQueue(<span class="number">8</span>);</span><br><span class="line"></span><br><span class="line">Producer producer = <span class="keyword">new</span> Producer(storage);</span><br><span class="line">Thread producerThread = <span class="keyword">new</span> Thread(producer);</span><br><span class="line">producerThread.start();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Thread.sleep(<span class="number">500</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Consumer consumer = <span class="keyword">new</span> Consumer(storage);</span><br><span class="line"><span class="keyword">while</span> (consumer.needMoreNums()) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(consumer.storage.take() + <span class="string">&quot;被消费了&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;消费者不需要更多数据了。&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//一旦消费不需要更多数据了，我们应该让生产者也停下来，但是实际情况却停不下来</span></span><br><span class="line">producer.canceled = <span class="keyword">true</span>;</span><br><span class="line">System.out.println(producer.canceled);</span><br></pre></td></tr></table></figure>

<p>当 <code>producer.canceled = true</code>时,生产者Producer跳出循环 while (num &lt;= 100000 &amp;&amp; !canceled) ,来到运行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">System.out.println(<span class="string">&quot;生产者结束运行&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>然而结果却不是我们想象的那样，尽管已经把 canceled 设置成 true，但生产者仍然没有停止，这是因为在这种情况下，生产者在执行 storage.put(num) 时发生阻塞，在它被叫醒之前是没有办法进入下一次循环判断 canceled 的值的，所以在这种情况下用 volatile 是没有办法让生产者停下来的，相反如果用 interrupt 语句来中断，即使生产者处于阻塞状态，仍然能够感受到中断信号，并做响应处理。</p>
<h5 id="修复版本"><a href="#修复版本" class="headerlink" title="修复版本"></a>修复版本</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrongWayVolatileFixed</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        ArrayBlockingQueue storage = <span class="keyword">new</span> ArrayBlockingQueue(<span class="number">10</span>);</span><br><span class="line">        WrongWayVolatileFixed body = <span class="keyword">new</span> WrongWayVolatileFixed();</span><br><span class="line">        Producer producer = body.<span class="function">new <span class="title">Producer</span><span class="params">(storage)</span></span>;</span><br><span class="line">        Thread producerThread = <span class="keyword">new</span> Thread(producer);</span><br><span class="line">        producerThread.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        Consumer consumer = body.<span class="function">new <span class="title">Consumer</span><span class="params">(storage)</span></span>;</span><br><span class="line">        <span class="keyword">while</span> (consumer.needMoreNums()) &#123;</span><br><span class="line">            System.out.println(storage.take()+<span class="string">&quot;被消费&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者不需要更多数据了&quot;</span>);</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  一旦消费不需要更多数据了，我们应该让生产者也停下来，</span></span><br><span class="line"><span class="comment">         *  但是实际情况,在 storage.put(num);处被阻塞了，无法进入新的一层while()循环中判断，!Canceled 的值也就无法判断</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        producerThread.interrupt();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        BlockingQueue storage;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(BlockingQueue storage)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.storage = storage;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> num = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//canceled为true，则无法进入</span></span><br><span class="line">                <span class="keyword">while</span> (num &lt;= <span class="number">100000</span> &amp;&amp; !Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (num % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        storage.put(num);</span><br><span class="line">                        System.out.println(num + <span class="string">&quot;是100的倍数,被放到仓库中了。&quot;</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    num++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;生产者结束运行&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        BlockingQueue storage;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(BlockingQueue storage)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.storage = storage;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">needMoreNums</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (Math.random() &gt; <span class="number">0.95</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> producerThread.interrupt();去打断</p>
<h5 id="线程池关闭方式"><a href="#线程池关闭方式" class="headerlink" title="线程池关闭方式"></a>线程池关闭方式</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShutdownTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">        exec.submit(<span class="keyword">new</span> ShutDownThread());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        exec.shutdownNow();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ShutDownThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">int</span> taskId = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted())&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                    System.out.println();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;taskId Terminated&quot;</span> + taskId++);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>为什么 wait 必须在 synchronized 保护的同步代码中使用?</p>
<p>不在synchronized就不能保证原子性，执行wait之前的代码后，被其他线程抢占执行了notifiy(此时没起作用，wait方法还没调用)，回来继续执行wait，这样该线程就得不到唤醒.</p>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=242">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=242</a></p>
<p><a href="https://github.com/Lvshujia/JUC">https://github.com/Lvshujia/JUC</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>concurrency</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/2017/10/15/ConstraintLayout/</url>
    <content><![CDATA[<h5 id="introduce"><a href="#introduce" class="headerlink" title="introduce"></a>introduce</h5><p><a href="https://developer.android.com/reference/androidx/constraintlayout/widget/ConstraintLayout">https://developer.android.com/reference/androidx/constraintlayout/widget/ConstraintLayout</a></p>
<p><a href="https://juejin.cn/post/6949186887609221133#heading-6">https://juejin.cn/post/6949186887609221133#heading-6</a></p>
<h5 id="Group"><a href="#Group" class="headerlink" title="Group"></a>Group</h5><p>可以控制一组控件的隐藏和显示</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;androidx.constraintlayout.widget.Group</span><br><span class="line">      android:<span class="attribute">id</span>=<span class="string">&quot;@+id/gp_1&quot;</span></span><br><span class="line">      android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">      android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">      android:<span class="attribute">visibility</span>=<span class="string">&quot;gone&quot;</span></span><br><span class="line">      app:<span class="attribute">constraint_referenced_ids</span>=<span class="string">&quot;cl_h4,cl_h2&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">((Group)find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">gp_1</span>)</span>).set<span class="constructor">Visibility(View.GONE)</span>;</span><br></pre></td></tr></table></figure>

<p>​    <code>findViewById(R.id.gp_2).setVisibility(View.INVISIBLE);  doesnt not work</code></p>
<p><a href="https://juejin.cn/post/6844903875569254414#heading-17">https://juejin.cn/post/6844903875569254414#heading-17</a></p>
<h5 id="Here-is-the-list-of-available-constraints-Fig-2"><a href="#Here-is-the-list-of-available-constraints-Fig-2" class="headerlink" title="Here is the list of available constraints (Fig. 2):"></a>Here is the list of available constraints (Fig. 2):</h5><p>layout_constraintBaseline_toBaselineOf         //元素对齐<br>layout_constraintStart_toEndOf        控件开始位置 相对另一控件的结束位置</p>
<p>They all take a reference id to another widget, or the parent (which will reference the parent container, i.e. the ConstraintLayout):</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Button android:<span class="attribute">id</span>=<span class="string">&quot;@+id/buttonB&quot;</span> <span class="built_in">..</span>.</span><br><span class="line">                 app:<span class="attribute">layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>layout_constraintBaseline_toBaselineOf : 表示此控件与某个空间水平对齐</p>
<h5 id="Margins"><a href="#Margins" class="headerlink" title="Margins"></a>Margins</h5><p>If side margins are set, they will be applied to the corresponding constraints (if they exist) (Fig. 3), enforcing the margin as a space between the target and the source side. The usual layout margin attributes can be used to this effect:</p>
<p>android:layout_marginBottom<br>Note that a margin can only be positive or equals to zero, and takes a Dimension.</p>
<p>Margins when connected to a GONE widget<br>When a position constraint target’s visibility is View.GONE, you can also indicate a different margin value to be used using the following attributes:</p>
<p>layout_goneMarginStart</p>
<p>layout_goneMarginBottom</p>
<p>Centering positioning and bias<br>A useful aspect of ConstraintLayout is in how it deals with “impossible” constrains. For example, if we have something like:</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;android.support.constraint.ConstraintLayout <span class="built_in">..</span>.&gt;</span><br><span class="line">  &lt;Button android:<span class="attribute">id</span>=<span class="string">&quot;@+id/button&quot;</span> <span class="built_in">..</span>.</span><br><span class="line">      app:<span class="attribute">layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span><br><span class="line">      app:<span class="attribute">layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent/&gt;</span></span><br><span class="line"><span class="string">&lt;/&gt;</span></span><br><span class="line"><span class="string">         </span></span><br></pre></td></tr></table></figure>

<h5 id="Start-End"><a href="#Start-End" class="headerlink" title="Start_End"></a>Start_End</h5><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">&lt;?xml <span class="keyword">version</span>=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span><br><span class="line">&lt;android.support.<span class="keyword">constraint</span>.ConstraintLayout</span><br><span class="line">    xmlns:android=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span><br><span class="line">    xmlns:<span class="keyword">app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//全局居中</span></span><br><span class="line">    &lt;android.support.v7.widget.AppCompatButton</span><br><span class="line">        android:id=<span class="string">&quot;@+id/button1&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;100dp&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;100dp&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;button1&quot;</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintBottom_toBottomOf=<span class="string">&quot;parent&quot;</span> <span class="comment">//底部以父布局的底部为约束</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintEnd_toEndOf=<span class="string">&quot;parent&quot;</span> <span class="comment">//右侧结束以父布局的右侧为约束</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintStart_toStartOf=<span class="string">&quot;parent&quot;</span> <span class="comment">//左侧起始以父布局的左侧为约束</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintTop_toTopOf=<span class="string">&quot;parent&quot;</span>/&gt; <span class="comment">//顶部以父布局的顶部为约束</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;android.support.v7.widget.AppCompatButton</span><br><span class="line">        android:id=<span class="string">&quot;@+id/button2&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;100dp&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;100dp&quot;</span></span><br><span class="line">        android:layout_marginLeft=<span class="string">&quot;30dp&quot;</span></span><br><span class="line">        android:layout_marginTop=<span class="string">&quot;30dp&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;button2&quot;</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintStart_toStartOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintTop_toTopOf=<span class="string">&quot;parent&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 以 button2 为约束的纵向居中</span></span><br><span class="line">    &lt;android.support.v7.widget.AppCompatButton</span><br><span class="line">        android:id=<span class="string">&quot;@+id/button3&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;button3&quot;</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintBottom_toBottomOf=<span class="string">&quot;@id/button2&quot;</span> <span class="comment">//底部以button2的底部为约束</span></span><br><span class="line">        <span class="keyword">app</span>:layout_constraintStart_toEndOf=<span class="string">&quot;@id/button2&quot;</span> </span><br><span class="line">        <span class="keyword">app</span>:layout_constraintTop_toTopOf=<span class="string">&quot;@id/button2&quot;</span>/&gt;  <span class="comment">//顶部以button2的顶部为约束</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/android.support.<span class="keyword">constraint</span>.ConstraintLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h5 id="Guideline使用"><a href="#Guideline使用" class="headerlink" title="Guideline使用"></a>Guideline使用</h5><p><a href="https://developer.android.com/reference/android/support/constraint/Guideline.html">https://developer.android.com/reference/android/support/constraint/Guideline.html</a></p>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">app:</span>layout_constraintGuide_percent=<span class="string">&quot;0.2&quot;</span></span><br><span class="line"><span class="symbol">app:</span>layout_constraintGuide_begin=<span class="string">&quot;100dp&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="特色属性"><a href="#特色属性" class="headerlink" title="特色属性"></a>特色属性</h5><ul>
<li><p>layout_constraintDimensionRatio</p>
<p>指定高度，宽度随着宽高比自适应</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;ImageView</span><br><span class="line">    android:<span class="attribute">id</span>=<span class="string">&quot;@+id/iv_img01&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_width</span>=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">    android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">    android:<span class="attribute">src</span>=<span class="string">&quot;@mipmap/img_1&quot;</span></span><br><span class="line">    app:<span class="attribute">layout_constraintDimensionRatio</span>=<span class="string">&quot;1:1&quot;</span></span><br><span class="line">    app:<span class="attribute">layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<!--指定高度，宽度随着宽高比自适应 app:layout_constraintDimensionRatio="H,16:9"  H: 表示高宽比-->     </li>
<li><p>layout_constraintHorizontal_bias  先设置约束</p>
</li>
</ul>
<figure class="highlight avrasm"><table><tr><td class="code"><pre><span class="line"><span class="symbol">app:</span>layout_constraintLeft_toLeftOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line"><span class="symbol">app:</span>layout_constraintRight_toRightOf=<span class="string">&quot;parent&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="然后是比例"><a href="#然后是比例" class="headerlink" title="然后是比例"></a>然后是比例</h5><h5 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h5><ul>
<li>居中显示 : 四个方向添加约束</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">&quot;@+id/constraint_layout&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:background=&quot;@color/white&quot;</span><br><span class="line">        app:layout_constraintBottom_toBottomOf=&quot;@+id/constraint_layout&quot;</span><br><span class="line">        app:layout_constraintEnd_toEndOf=&quot;@id/constraint_layout&quot;</span><br><span class="line">        app:layout_constraintStart_toStartOf=&quot;@id/constraint_layout&quot;</span><br><span class="line">        app:layout_constraintTop_toTopOf=&quot;@+id/constraint_layout&quot;&gt;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>相对邻里控件 居中</li>
</ul>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">&lt;android.support.constraint.ConstraintLayout</span><br><span class="line">    android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:layout_height=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">    android:paddingLeft=<span class="string">&quot;@dimen/dimen_16&quot;</span></span><br><span class="line">    android:paddingRight=<span class="string">&quot;@dimen/dimen_16&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/tv_calculate_date&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:background=<span class="string">&quot;@drawable/bg_rectangle_blue&quot;</span></span><br><span class="line">        android:paddingBottom=<span class="string">&quot;4dp&quot;</span></span><br><span class="line">        android:paddingLeft=<span class="string">&quot;@dimen/dimen_16&quot;</span></span><br><span class="line">        android:paddingRight=<span class="string">&quot;@dimen/dimen_16&quot;</span></span><br><span class="line">        android:paddingTop=<span class="string">&quot;4dp&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;三个月&quot;</span></span><br><span class="line">        android:textColor=<span class="string">&quot;@color/white&quot;</span></span><br><span class="line">        android:textSize=<span class="string">&quot;@dimen/text_size_12&quot;</span></span><br><span class="line">        app:layout_constraintStart_toStartOf=<span class="string">&quot;parent&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=<span class="string">&quot;@+id/tv_calculate_money&quot;</span></span><br><span class="line">        android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">        android:layout_marginLeft=<span class="string">&quot;@dimen/dimen_16&quot;</span></span><br><span class="line">        android:text=<span class="string">&quot;￥ 2000&quot;</span></span><br><span class="line">        android:textColor=<span class="string">&quot;#0097fc&quot;</span></span><br><span class="line">        android:textSize=<span class="string">&quot;@dimen/text_size_12&quot;</span></span><br><span class="line">        app:layout_constraintBottom_toBottomOf=<span class="string">&quot;@+id/tv_calculate_date&quot;</span></span><br><span class="line">        app:layout_constraintTop_toTopOf=<span class="string">&quot;@+id/tv_calculate_date&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/android.support.constraint.ConstraintLayout&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h5 id="chain"><a href="#chain" class="headerlink" title="chain"></a>chain</h5><p> 3个Button 两两依赖,相当于组成了一个链</p>
<ul>
<li>Button均分 width = match_constraint (0dp)</li>
</ul>
<p> <img src="/2017/10/15/ConstraintLayout/ConstraintLayout_000.png" alt="图"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">       android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_00&quot;</span></span><br><span class="line">       android:<span class="attribute">layout_width</span>=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">       android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">       android:<span class="attribute">text</span>=<span class="string">&quot;Button_00&quot;</span></span><br><span class="line">       app:<span class="attribute">layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span><br><span class="line">       app:<span class="attribute">layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/bt_01&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">   &lt;Button</span><br><span class="line">       android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_01&quot;</span></span><br><span class="line">       android:<span class="attribute">layout_width</span>=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">       android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">       android:<span class="attribute">text</span>=<span class="string">&quot;Button_01&quot;</span></span><br><span class="line">       app:<span class="attribute">layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/bt_00&quot;</span></span><br><span class="line">       app:<span class="attribute">layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/bt_02&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">   &lt;Button</span><br><span class="line">       android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_02&quot;</span></span><br><span class="line">       android:<span class="attribute">layout_width</span>=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">       android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">       android:<span class="attribute">text</span>=<span class="string">&quot;Button_02&quot;</span></span><br><span class="line">       app:<span class="attribute">layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/bt_01&quot;</span></span><br><span class="line">       app:<span class="attribute">layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>

<h2 id="app-layout-constraintHorizontal-weight-quot-2-quot"><a href="#app-layout-constraintHorizontal-weight-quot-2-quot" class="headerlink" title="  app:layout_constraintHorizontal_weight=&quot;2&quot;"></a><code>  app:layout_constraintHorizontal_weight=&quot;2&quot;</code></h2><p>看属性也可以猜到是干嘛用的了.<br><img src="/2017/10/15/ConstraintLayout/ConstraintLayout_001.png" alt="宽度为wrap_content"></p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">&lt;androidx.constraintlayout.widget.ConstraintLayout</span><br><span class="line">       android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">       <span class="keyword">app</span>:layout_constraintTop_toBottomOf=<span class="string">&quot;@+id/guideline_00&quot;</span></span><br><span class="line">       android:layout_height=<span class="string">&quot;wrap_content&quot;</span>&gt;</span><br><span class="line">       &lt;Button</span><br><span class="line">           android:id=<span class="string">&quot;@+id/bt_00&quot;</span></span><br><span class="line">           android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">           android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:text=<span class="string">&quot;Button_00&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintHorizontal_weight=<span class="string">&quot;2&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintLeft_toLeftOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintRight_toLeftOf=<span class="string">&quot;@+id/bt_01&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">       &lt;Button</span><br><span class="line">           android:id=<span class="string">&quot;@+id/bt_01&quot;</span></span><br><span class="line">           android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">           android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:text=<span class="string">&quot;Button_01&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintHorizontal_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintLeft_toRightOf=<span class="string">&quot;@+id/bt_00&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintRight_toLeftOf=<span class="string">&quot;@+id/bt_02&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">       &lt;Button</span><br><span class="line">           android:id=<span class="string">&quot;@+id/bt_02&quot;</span></span><br><span class="line">           android:layout_width=<span class="string">&quot;0dp&quot;</span></span><br><span class="line">           android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintHorizontal_weight=<span class="string">&quot;1&quot;</span></span><br><span class="line">           android:text=<span class="string">&quot;Button_02&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintLeft_toRightOf=<span class="string">&quot;@+id/bt_01&quot;</span></span><br><span class="line">           <span class="keyword">app</span>:layout_constraintRight_toRightOf=<span class="string">&quot;parent&quot;</span> /&gt;</span><br><span class="line">   &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>







<ul>
<li>Button均份　宽度不为match_constraint</li>
</ul>
<p><img src="/2017/10/15/ConstraintLayout/ConstraintLayout_10.png" alt="宽度为wrap_content"></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">           android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_10&quot;</span></span><br><span class="line">           android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:<span class="attribute">text</span>=<span class="string">&quot;Button_00&quot;</span></span><br><span class="line">           app:<span class="attribute">layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span><br><span class="line">           app:<span class="attribute">layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/bt_11&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">       &lt;Button</span><br><span class="line">           android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_11&quot;</span></span><br><span class="line">           android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:<span class="attribute">text</span>=<span class="string">&quot;Button_01&quot;</span></span><br><span class="line">           app:<span class="attribute">layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/bt_10&quot;</span></span><br><span class="line">           app:<span class="attribute">layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/bt_12&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">       &lt;Button</span><br><span class="line">           android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_12&quot;</span></span><br><span class="line">           android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">           android:<span class="attribute">text</span>=<span class="string">&quot;Button_02&quot;</span></span><br><span class="line">           app:<span class="attribute">layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/bt_11&quot;</span></span><br><span class="line">           app:<span class="attribute">layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>layout_constraintHorizontal_chainStyle</p>
<p>  这个属性默认是　spread，还有另外两种方式 packed 和spread_inside</p>
</li>
<li><p>packed</p>
</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">          android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_20&quot;</span></span><br><span class="line">          android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:<span class="attribute">text</span>=<span class="string">&quot;Button_20&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintHorizontal_chainStyle</span>=<span class="string">&quot;packed&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintLeft_toLeftOf</span>=<span class="string">&quot;parent&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/bt_21&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Button</span><br><span class="line">          android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_21&quot;</span></span><br><span class="line">          android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:<span class="attribute">text</span>=<span class="string">&quot;Button_21&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/bt_20&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintRight_toLeftOf</span>=<span class="string">&quot;@+id/bt_22&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;Button</span><br><span class="line">          android:<span class="attribute">id</span>=<span class="string">&quot;@+id/bt_22&quot;</span></span><br><span class="line">          android:<span class="attribute">layout_width</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:<span class="attribute">layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:<span class="attribute">text</span>=<span class="string">&quot;Button_22&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintLeft_toRightOf</span>=<span class="string">&quot;@+id/bt_21&quot;</span></span><br><span class="line">          app:<span class="attribute">layout_constraintRight_toRightOf</span>=<span class="string">&quot;parent&quot;</span> /&gt;</span><br></pre></td></tr></table></figure>


<p><img src="/2017/10/15/ConstraintLayout/ConstraintLayout_20.png" alt="宽度为wrap_content"></p>
<ul>
<li><p>spread_inside     :  width = wrap_content<br>  <img src="/2017/10/15/ConstraintLayout/ConstraintLayout_300.png" alt="宽度为wrap_content"></p>
</li>
<li><p>spread_inside     :  width = 0dp<br>  <img src="/2017/10/15/ConstraintLayout/ConstraintLayout_301.png" alt="宽度为wrap_content"></p>
</li>
</ul>
<p><a href="http://45.77.222.97:3000/root/MineUtils/src/master/app/src/main/java/com/jonzhou/mineutils/layout">代码</a> </p>
<ul>
<li>概述</li>
</ul>
<p>经过上面的实践，再来张官方的图就好理解了<br><img src="/2017/10/15/ConstraintLayout/constraint-chain-styles_2x.png" alt="宽度为wrap_content"></p>
<blockquote>
<p>1、 Spread: The views are evenly distributed (after margins are accounted for). This is the default.<br>2 、 Spread inside: The first and last view are affixed to the constraints on each end of the chain and the rest are evenly distributed.<br>３、Weighted: When the chain is set to either spread or spread inside, you can fill the remaining space by setting one or more views to “match constraints” (0dp). By default, the space is evenly distributed between each view that’s set to “match constraints,” but you can assign a weight of importance to each view using the layout_constraintHorizontal_weight and layout_constraintVertical_weight attributes. If you’re familiar with layout_weight in a linear layout, this works the same way. So the view with the highest weight value gets the most amount of space; views that have the same weight get the same amount of space.<br>４、Packed: The views are packed together (after margins are accounted for). You can then adjust the whole chain’s bias (left/right or up/down) by changing the chain’s head view bias.</p>
</blockquote>
<p>参考:<a href="https://developer.android.com/training/constraint-layout/index.html">https://developer.android.com/training/constraint-layout/index.html</a><br>最后就是边应用边理解了</p>
<h5 id="Barrier"><a href="#Barrier" class="headerlink" title="Barrier"></a>Barrier</h5><p>用于控制 Barrier 相对于给定的 View 的位置， app:barrierDirection=”right”,表示barrier在constraint_referenced_ids给定ID的右侧,constraint_referenced_ids的id就是左侧的这些控件</p>
<p>输入信息挺有用的 </p>
<p><a href="https://mp.weixin.qq.com/s/QIuww9b0TsNjajEUS8c2fg">https://mp.weixin.qq.com/s/QIuww9b0TsNjajEUS8c2fg</a></p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">&lt;android.support.<span class="keyword">constraint</span>.ConstraintLayout</span><br><span class="line">      android:layout_width=<span class="string">&quot;match_parent&quot;</span></span><br><span class="line">      android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">      android:layout_margin=<span class="string">&quot;@dimen/dimen_11&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">      &lt;TextView</span><br><span class="line">          android:id=<span class="string">&quot;@+id/tv_order_num&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:text=<span class="string">&quot;订单编号：10002220000001234&quot;</span></span><br><span class="line">          android:textColor=<span class="string">&quot;#ff999999&quot;</span></span><br><span class="line">          android:textSize=<span class="string">&quot;19sp&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintTop_toTopOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintStart_toStartOf=<span class="string">&quot;parent&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;TextView</span><br><span class="line">          android:id=<span class="string">&quot;@+id/tv_order_pro&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_marginTop=<span class="string">&quot;@dimen/dimen_11&quot;</span></span><br><span class="line">          android:text=<span class="string">&quot;订购产品：爱达康高血压监护服务&quot;</span></span><br><span class="line">          android:textColor=<span class="string">&quot;#ff666666&quot;</span></span><br><span class="line">          android:textSize=<span class="string">&quot;21sp&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintLeft_toLeftOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintTop_toBottomOf=<span class="string">&quot;@+id/tv_order_num&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;TextView</span><br><span class="line">          android:id=<span class="string">&quot;@+id/tv_service_team&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:text=<span class="string">&quot;服务团队：爱达康远程监护团队&quot;</span></span><br><span class="line">          android:textColor=<span class="string">&quot;#ff666666&quot;</span></span><br><span class="line">          android:textSize=<span class="string">&quot;21sp&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintLeft_toLeftOf=<span class="string">&quot;parent&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintTop_toBottomOf=<span class="string">&quot;@+id/tv_order_pro&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;TextView</span><br><span class="line">          android:id=<span class="string">&quot;@+id/tv_period_valid&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:text=<span class="string">&quot;有效期：2019-03-01至2019-12-31&quot;</span></span><br><span class="line">          android:textColor=<span class="string">&quot;#ff999999&quot;</span></span><br><span class="line">          android:textSize=<span class="string">&quot;19sp&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintStart_toEndOf=<span class="string">&quot;@+id/barrier&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;TextView</span><br><span class="line">          android:id=<span class="string">&quot;@+id/tv_order_time&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_marginTop=<span class="string">&quot;@dimen/dimen_11&quot;</span></span><br><span class="line">          android:text=<span class="string">&quot;订购时间：2019-03-11 12:00:00&quot;</span></span><br><span class="line">          android:textColor=<span class="string">&quot;#ff666666&quot;</span></span><br><span class="line">          android:textSize=<span class="string">&quot;21sp&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintStart_toEndOf=<span class="string">&quot;@+id/barrier&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintTop_toBottomOf=<span class="string">&quot;@+id/tv_period_valid&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">      &lt;TextView</span><br><span class="line">          android:id=<span class="string">&quot;@+id/tv_order_count&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:text=<span class="string">&quot;订购数量：500次&quot;</span></span><br><span class="line">          android:textColor=<span class="string">&quot;#ff666666&quot;</span></span><br><span class="line">          android:textSize=<span class="string">&quot;21sp&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintStart_toEndOf=<span class="string">&quot;@+id/barrier&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:layout_constraintTop_toBottomOf=<span class="string">&quot;@+id/tv_order_time&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &lt;android.support.<span class="keyword">constraint</span>.Barrier</span><br><span class="line">          android:id=<span class="string">&quot;@+id/barrier&quot;</span></span><br><span class="line">          android:layout_width=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          android:layout_height=<span class="string">&quot;wrap_content&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:barrierDirection=<span class="string">&quot;right&quot;</span></span><br><span class="line">          <span class="keyword">app</span>:constraint_referenced_ids=<span class="string">&quot;tv_order_num,tv_order_pro,tv_service_team&quot;</span> /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/android.support.<span class="keyword">constraint</span>.ConstraintLayout&gt;</span><br></pre></td></tr></table></figure>





]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>ConstraintLayout</tag>
      </tags>
  </entry>
  <entry>
    <title>DesignPattern</title>
    <url>/2020/11/19/DesignPattern/</url>
    <content><![CDATA[<h4 id="设计原则"><a href="#设计原则" class="headerlink" title="设计原则"></a>设计原则</h4><h5 id="单一职责"><a href="#单一职责" class="headerlink" title="单一职责"></a>单一职责</h5><p>​    一个类应该只负责一项职责。</p>
<h5 id="接口隔离"><a href="#接口隔离" class="headerlink" title="接口隔离"></a>接口隔离</h5><p>​    客户端不应该依赖它不需要的接口，即一个类对另一个类的依赖应该建立在最小的接口上。</p>
<h5 id="依赖倒置"><a href="#依赖倒置" class="headerlink" title="依赖倒置"></a>依赖倒置</h5><ul>
<li>高层模块不应该依赖低层模块，二者都应该依赖其抽象。</li>
<li>抽象不应该依赖细节，细节应该依赖抽象。</li>
<li>依赖倒置的中心思想是<strong>面向接口编程</strong>。</li>
</ul>
<h5 id="里氏替换"><a href="#里氏替换" class="headerlink" title="里氏替换"></a>里氏替换</h5><ul>
<li>所有使用基类的地方必须能透明的使用其子类。</li>
<li>使用继承时，遵循里氏替换原则，<strong>子类尽量不要重写父类的方法</strong>。继承实际上让两个类耦合性增强了，适当情况下可以通过 聚合 组合 依赖来解决问题。</li>
</ul>
<p>​    通用做法是： 原来的父类和子类都继承一个更通俗的基类，原有的继承关系去掉，采用依赖，聚合，组合等关系代替。</p>
<p>之前的方案</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Liskov</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        System.out.println(<span class="string">&quot;11-3=&quot;</span> + a.func1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + a.func1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------------&quot;</span>);</span><br><span class="line">        B b = <span class="keyword">new</span> B();</span><br><span class="line">        System.out.println(<span class="string">&quot;11-3=&quot;</span> + b.func1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + b.func1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;11+3+9=&quot;</span> + b.func2(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="comment">//没意识到 重写了该方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> func1(a, b) - <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>改进后的方案</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Liskov</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        System.out.println(<span class="string">&quot;11-3=&quot;</span> + a.func1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;1-8=&quot;</span> + a.func1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;---------------&quot;</span>);</span><br><span class="line">        B b = <span class="keyword">new</span> B();</span><br><span class="line">        <span class="comment">//因为B类不再继承A类，因此调用者，不会再func1求减法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;11+3=&quot;</span> + b.func1(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;1+8=&quot;</span> + b.func1(<span class="number">1</span>, <span class="number">8</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;11+3+9=&quot;</span> + b.func2(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用组合仍然可以使用A类相关方法</span></span><br><span class="line">        System.out.println(<span class="string">&quot;11-3=&quot;</span> + b.func3(<span class="number">11</span>, <span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span>  <span class="title">Base</span></span>&#123;</span><br><span class="line">    <span class="comment">//把更基础的方法和成员写到Base类中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 - num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">Base</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果B需要使用A类的方法，使用组合关系</span></span><br><span class="line">    <span class="keyword">private</span> A a = <span class="keyword">new</span> A();</span><br><span class="line">    <span class="comment">//没意识到 重写了该方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> num1, <span class="keyword">int</span> num2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func2</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> func1(a, b) +<span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">func3</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.a.func1(a,b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="开闭原则-ocp"><a href="#开闭原则-ocp" class="headerlink" title="开闭原则 ocp"></a>开闭原则 ocp</h5><p>open closed principle</p>
<ul>
<li><p>不适用该原则的方案</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphicEditor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GraphicEditor graphicEditor = <span class="keyword">new</span> GraphicEditor();</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> Rectangle());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> Circle());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> Triangle());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加一个图形需要修改</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">(Shape s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.m_type == <span class="number">1</span>)</span><br><span class="line">            drawRectangle(s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.m_type == <span class="number">2</span>)</span><br><span class="line">            drawCircle(s);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s.m_type == <span class="number">3</span>)</span><br><span class="line">            drawTriangle(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawCircle</span><span class="params">(Shape s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawRectangle</span><span class="params">(Shape s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加一个图形需要修改</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">drawTriangle</span><span class="params">(Shape s)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> m_type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Rectangle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Circle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增图形</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Triangle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.m_type = <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到改动很多</p>
</li>
<li><p>使用ocp原则改进后</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GraphicEditor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        GraphicEditor graphicEditor = <span class="keyword">new</span> GraphicEditor();</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> Rectangle());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> Circle());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> Triangle());</span><br><span class="line">        graphicEditor.drawShape(<span class="keyword">new</span> OtherGraphic());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">(Shape s)</span> </span>&#123;</span><br><span class="line">        s.drawShape();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> m_type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawShape</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawShape</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制矩形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawShape</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制圆形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawShape</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;绘制三角形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增一个图形</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OtherGraphic</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">drawShape</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;新增一个图形&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现代码没有任何改动</p>
</li>
</ul>
<h5 id="迪米特法则"><a href="#迪米特法则" class="headerlink" title="迪米特法则"></a>迪米特法则</h5><ul>
<li><p>一个对象应该对其他对象保持最少的了解</p>
</li>
<li><p>Demeter Principle又叫最少知道原则， 即一个类对自己依赖的类知道的越少越好。也就是说，对于被依赖的类不管多么复杂，都尽量将逻辑封装在类的内部。对外出了提供的public方法，不泄漏任何信息</p>
</li>
<li><p>只与直接的朋友通信。</p>
<p>直接的朋友: 每个对象都会与其他对象有耦合关系，只要两个对象之间有耦合关系，我们就说这两个对象之间是朋友关系。耦合的方式很多， 依赖 关联，组合，聚合等。 其中，我们称出现成员变量，方法参数，方法返回值中的类为直接的朋友，而出现在局部变量中的类不是直接的朋友。也就是说，陌生的类最好不要以局部变量的形式出现在类的内部。</p>
</li>
</ul>
<p>​    改进前</p>
<p>​    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demeter1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SchoolManager schoolManager = <span class="keyword">new</span> SchoolManager();</span><br><span class="line">        schoolManager.printAllEmployee(<span class="keyword">new</span> CollegeManger());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//学校总部员工的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchollEmployee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//学院的员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeEmployee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//管理学院员工的管理类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeManger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CollegeEmployee&gt; <span class="title">getAllEmployee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;CollegeEmployee&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            CollegeEmployee collegeEmployee = <span class="keyword">new</span> CollegeEmployee();</span><br><span class="line">            collegeEmployee.setId(<span class="string">&quot;学院员工id= &quot;</span> + i);</span><br><span class="line">            list.add(collegeEmployee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SchollEmployee , CollegeManger 是直接朋友</span></span><br><span class="line"><span class="comment">// CollegeEmployee 不是直接朋友，而是一个陌生类，这样违反了 迪米特法则。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchoolManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SchollEmployee&gt; <span class="title">getAllEmployee</span><span class="params">()</span> </span>&#123;<span class="comment">//方法返回值:直接朋友</span></span><br><span class="line">        ArrayList&lt;SchollEmployee&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            SchollEmployee schollEmployee = <span class="keyword">new</span> SchollEmployee(); <span class="comment">// CollegeEmployee 不是直接朋友，以局部变量出现在SchoolManager</span></span><br><span class="line">            schollEmployee.setId(<span class="string">&quot;学校总部员工id= &quot;</span> + i);</span><br><span class="line">            list.add(schollEmployee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//该方法完成输出学校总部和学院员工ID</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAllEmployee</span><span class="params">(CollegeManger sub)</span> </span>&#123;<span class="comment">//方法参数:直接朋友</span></span><br><span class="line"></span><br><span class="line">        List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------学院员工--------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (CollegeEmployee e : list1) &#123;</span><br><span class="line">            System.out.println(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        List&lt;SchollEmployee&gt; list2 = <span class="keyword">this</span>.getAllEmployee();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------学校总部员工--------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SchollEmployee e : list2) &#123;</span><br><span class="line">            System.out.println(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>改进后</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demeter2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;使用迪米特法则的改进&quot;</span>);</span><br><span class="line">        SchoolManager schoolManager = <span class="keyword">new</span> SchoolManager();</span><br><span class="line">        schoolManager.printAllEmployee(<span class="keyword">new</span> CollegeManger());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//学校总部员工的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchollEmployee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//学院的员工</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeEmployee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//管理学院员工的管理类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CollegeManger</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;CollegeEmployee&gt; <span class="title">getAllEmployee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ArrayList&lt;CollegeEmployee&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            CollegeEmployee collegeEmployee = <span class="keyword">new</span> CollegeEmployee();</span><br><span class="line">            collegeEmployee.setId(<span class="string">&quot;学院员工id= &quot;</span> + i);</span><br><span class="line">            list.add(collegeEmployee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出学院员工的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printCollegeEmployee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//改进方法： 将输出学院员工的方法，封装到CollegeManager中。</span></span><br><span class="line">        List&lt;CollegeEmployee&gt; list1 = getAllEmployee();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------学院员工--------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (CollegeEmployee e : list1) &#123;</span><br><span class="line">            System.out.println(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// SchollEmployee , CollegeManger 是直接朋友</span></span><br><span class="line"><span class="comment">// CollegeEmployee 不是直接朋友，而是一个陌生类，这样违反了 迪米特法则。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SchoolManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;SchollEmployee&gt; <span class="title">getAllEmployee</span><span class="params">()</span> </span>&#123;<span class="comment">//方法返回值:直接朋友</span></span><br><span class="line">        ArrayList&lt;SchollEmployee&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            SchollEmployee schollEmployee = <span class="keyword">new</span> SchollEmployee(); <span class="comment">// CollegeEmployee 不是直接朋友，以局部变量出现在SchoolManager</span></span><br><span class="line">            schollEmployee.setId(<span class="string">&quot;学校总部员工id= &quot;</span> + i);</span><br><span class="line">            list.add(schollEmployee);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//该方法完成输出学校总部和学院员工ID</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">printAllEmployee</span><span class="params">(CollegeManger sub)</span> </span>&#123;<span class="comment">//方法参数:直接朋友</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*</span></span><br><span class="line"><span class="comment">        List&lt;CollegeEmployee&gt; list1 = sub.getAllEmployee();</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;-----------学院员工--------&quot;);</span></span><br><span class="line"><span class="comment">        for (CollegeEmployee e : list1) &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(e.getId());</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">        <span class="comment">//改进方法： 将输出学院员工的方法，封装到CollegeManager中。</span></span><br><span class="line">        sub.printCollegeEmployee();</span><br><span class="line"></span><br><span class="line">        List&lt;SchollEmployee&gt; list2 = <span class="keyword">this</span>.getAllEmployee();</span><br><span class="line">        System.out.println(<span class="string">&quot;-----------学校总部员工--------&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (SchollEmployee e : list2) &#123;</span><br><span class="line">            System.out.println(e.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="创见型-对象的创建"><a href="#创见型-对象的创建" class="headerlink" title="创见型: 对象的创建"></a>创见型: 对象的创建</h4><p> 单例模式 、工厂模式 、原型模式</p>
<h4 id="结构型-类或对象的组合或组装"><a href="#结构型-类或对象的组合或组装" class="headerlink" title="结构型: 类或对象的组合或组装"></a>结构型: 类或对象的组合或组装</h4><ol>
<li><p>代理模式 : 代理模式在不改变原始类接口的条件下，为原始类定义一个代理类，主要目的是控制访问，而非加强功能，这是它跟装饰器模式最大的不同。</p>
<blockquote>
<p>还需要理解动态代理?</p>
</blockquote>
</li>
<li><p>桥接模式: 有两种理解方式。第一种理解方式是“将抽象和实现解耦，让它们能独立开发”</p>
</li>
<li><p>装饰器 : </p>
<ol>
<li><p>装饰器类和原始类继承同样的父类，这样我们可以对原始类“嵌套”多个装饰器类</p>
<p>装饰器类是对功能的<strong>增强</strong>，这也是装饰器模式应用场景的一个重要特点。</p>
<blockquote>
<p>代理模式中，代理类附加的是跟原始类无关的功能，而在装饰器模式中，装饰器类附加的是跟原始类相关的增强功能。</p>
<p>对于为什么必须继承装饰器父类 FilterInputStream的思考：<br>装饰器如BufferedInputStream等，本身并不真正处理read()等方法，而是由构造函数传入的被装饰对象：InputStream（实际上是FileInputStream或者ByteArrayInputStream等对象）来完成的。<br>如果不重写默认的read()等方法，则无法完成如FileInputStream或者ByteArrayInputStream等对象所真正实现的read功能。<br>所以必须重写对应的方法，代理给这些被装饰对象进行处理（这也是类似于代理模式的地方）。<br>如果像DataInputStream和BufferedInputStream等每个装饰器都重写的这些方法话，会存在大量重复的代码。<br>所以让它们都继承FilterInputStream提供的默认实现，可以减少代码重复，让装饰器只聚焦在它自己的装饰功能上即可。</p>
</blockquote>
</li>
</ol>
<p><a href="https://noteforme.github.io/2017/09/12/JavaIo/">https://noteforme.github.io/2017/09/12/JavaIo/</a></p>
</li>
<li><p>适配器模式：</p>
<p>适配器模式是一种事后的补救策略。适配器提供跟原始类不同的接口，而代理模式、装饰器模式提供的都是跟原始类相同的接口。</p>
<p>类适配器: 通过继承关系</p>
<p>对象适配器：通过组合关系</p>
</li>
<li><p>门面模式</p>
<p>门面模式为子系统提供一组统一的接口，定义一组高层接口让子系统更易用。这个定义很简洁，我再进一步解释一下。假设有一个系统 A，提供了 a、b、c、d 四个接口。系统 B 完成某个业务功能，需要调用 A 系统的 a、b、d 接口。利用门面模式，我们提供一个包裹 a、b、d 接口调用的门面接口 x，给系统 B 直接使用</p>
</li>
<li><p>组合模式</p>
<ol>
<li><p>将一组对象组织（Compose）成树形结构，以表示一种“部分 - 整体”的层次结构。组合让客户端（在很多设计模式书籍中，“客户端”代指代码的使用者。）可以统一单个对象和组合对象的处理逻辑。</p>
<blockquote>
<p>组合模式的设计思路，与其说是一种设计模式，倒不如说是对业务场景的一种数据结构和算法的抽象。其中，数据可以表示成树这种数据结构，业务需求可以通过在树上的递归遍历算法来实现。</p>
</blockquote>
</li>
</ol>
</li>
<li><p>享元模式</p>
<p>如果这些重复的对象是不可变对象，我们就可以利用享元模式将对象设计成享元，在内存中只保留一份实例，供多处代码引用。这样可以减少内存中对象的数量，起到节省内存的目的.</p>
<p>实际上，不仅仅相同对象可以设计成享元，对于相似对象，我们也可以将这些对象中相同的部分（字段）提取出来，设计成享元，让这些大量相似对象引用这些享元。</p>
<blockquote>
<p>思考: 提取相同对象，最终还是要创建相同的数量的对象，只是字段省略了</p>
</blockquote>
</li>
</ol>
<h4 id="行为型-类或对象之间的交互"><a href="#行为型-类或对象之间的交互" class="headerlink" title="行为型:类或对象之间的交互"></a>行为型:类或对象之间的交互</h4><ol>
<li><p>模板模式</p>
<p>模板方法模式在一个方法中定义一个算法骨架，并将某些步骤推迟到子类中实现。模板方法模式可以让子类在不改变算法整体结构的情况下，重新定义算法中的某些步骤。</p>
<p>回调基于组合关系来实现，把一个对象传递给另一个对象，是一种对象之间的关系；模板模式基于继承关系来实现，子类重写父类的抽象方法，是一种类之间的关系。</p>
</li>
<li><p>策略模式</p>
<p>包含一组策略可选，客户端代码如何选择使用哪个策略，有两种确定方法：编译时静态确定和运行时动态确定。其中，“运行时动态确定”才是策略模式最典型的应用场景。</p>
<blockquote>
<p> 类似于面向接口编程,策略模式包含策略的定义、创建和使用三部分，从代码结构上来，它非常像工厂模式。它们的区别在于，策略模式侧重“策略”或“算法”这个特定的应用场景，用来解决根据运行时状态从一组策略中选择不同策略的问题，而工厂模式侧重封装对象的创建过程，这里的对象没有任何业务场景的限定，可以是策略，但也可以是其他东西。从设计意图上来，这两个模式完全是两回事儿</p>
</blockquote>
</li>
<li><p>职责链模式</p>
<p>将请求的发送和接收解耦，让多个接收对象都有机会处理这个请求。将这些接收对象串成一条链，并沿着这条链传递这个请求，直到链上的某个接收对象能够处理它为止。</p>
<blockquote>
<p>分析在retrofit filter上的应用</p>
</blockquote>
</li>
<li><p>状态模式</p>
</li>
<li><p>迭代器模式</p>
<blockquote>
<p> 一般会涉及容器 List 和容器迭代器 iterator 两部分内容</p>
</blockquote>
</li>
<li><p>迭代器模式</p>
</li>
<li><p>访问者模式</p>
<p>在不违背封装原则的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便之后恢复对象为先前的状态</p>
</li>
<li><p>备忘录模式</p>
<p>这个模式理解、掌握起来不难，代码实现比较灵活，应用场景也比较明确和有限，主要是用来防丢失、撤销、恢复等</p>
</li>
<li><p>命令模式</p>
<p>命令模式将请求（命令）封装为一个对象，这样可以使用不同的请求参数化其他对象（将不同请求依赖注入到其他对象），并且能够支持请求（命令）的排队执行、记录日志、撤销等（附加控制）功能</p>
<blockquote>
<p>在策略模式中，不同的策略具有相同的目的、不同的实现、互相之间可以替换。比如，BubbleSort、SelectionSort 都是为了实现排序的，只不过一个是用冒泡排序算法来实现的，另一个是用选择排序算法来实现的。而在命令模式中，不同的命令具有不同的目的，对应不同的处理逻辑，并且互相之间不可替换</p>
</blockquote>
</li>
<li><p>中介模式</p>
<p>将一组对象之间的交互关系（或者依赖关系）从多对多（网状关系）转换为一对多（星状关系</p>
</li>
</ol>
<p><a href="https://www.bilibili.com/video/BV1G4411c7N4?p=44&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1G4411c7N4?p=44&amp;spm_id_from=pageDriver</a></p>
<p><a href="https://github.com/mxg133/learnforJava_DesignPattern">https://github.com/mxg133/learnforJava_DesignPattern</a></p>
]]></content>
      <categories>
        <category>DesignPatterns</category>
      </categories>
  </entry>
  <entry>
    <title>Fragment</title>
    <url>/2017/10/05/Fragment/</url>
    <content><![CDATA[<p><a href="https://developer.android.com/reference/android/app/Fragment.html">https://developer.android.com/reference/android/app/Fragment.html</a></p>
<p><a href="https://developer.android.com/guide/components/fragments.html">https://developer.android.com/guide/components/fragments.html</a></p>
<p><a href="https://wizardforcel.gitbooks.io/w3school-android/content/77.html">https://wizardforcel.gitbooks.io/w3school-android/content/77.html</a><br><a href="https://juejin.im/post/5901b564570c35005804424b">https://juejin.im/post/5901b564570c35005804424b</a></p>
<h4 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h4><p><a href="https://developer.android.com/guide/fragments/lifecycle">https://developer.android.com/guide/fragments/lifecycle</a></p>
<ul>
<li>onViewCreated(View view, Bundle savedInstanceState)</li>
</ul>
<p>Called immediately after <code>onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)</code> has returned, but before any saved state has been restored in to the view.</p>
<p><img src="/2017/10/05/Fragment/fragment-view-lifecycle.png"></p>
<h5 id="fragment回调"><a href="#fragment回调" class="headerlink" title="fragment回调"></a>fragment回调</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> mListener: IFeedBackListener? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttach</span><span class="params">(context: <span class="type">Context</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onAttach(context)</span><br><span class="line">    <span class="keyword">if</span> (parentFragment <span class="keyword">is</span> IFeedBackListener) &#123;</span><br><span class="line">        mListener = parentFragment <span class="keyword">as</span> IFeedBackListener</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (context <span class="keyword">is</span> IFeedBackListener) &#123;</span><br><span class="line">        mListener = context</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> RuntimeException(context?.toString() + <span class="string">&quot; must implement ISelectListener&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://noteforme.github.io/2017/10/05/Fragment/">https://noteforme.github.io/2017/10/05/Fragment/</a></p>
<h4 id="Fragment重叠"><a href="#Fragment重叠" class="headerlink" title="Fragment重叠"></a>Fragment重叠</h4><p> 横竖屏切换</p>
<p>被系统回收（复现 进入开发者选项 -》不保留活动）</p>
<p><a href="https://www.jianshu.com/p/c12a98a36b2b">https://www.jianshu.com/p/c12a98a36b2b</a></p>
<h5 id="BottomNavigationView-error"><a href="#BottomNavigationView-error" class="headerlink" title="BottomNavigationView error"></a>BottomNavigationView error</h5><p>使用BottomNavigationView出现很严重的问题,很久才找到原因</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">Caused <span class="keyword">by</span>: android.<span class="keyword">view</span>.InflateException: Binary XML <span class="keyword">file</span> <span class="keyword">line</span> #16: Binary XML <span class="keyword">file</span> <span class="keyword">line</span> #16: <span class="keyword">Error</span> inflating <span class="keyword">class</span> com.google.android.material.bottomnavigation.BottomNavigationView</span><br><span class="line">    Caused <span class="keyword">by</span>: android.<span class="keyword">view</span>.InflateException: Binary XML <span class="keyword">file</span> <span class="keyword">line</span> #16: <span class="keyword">Error</span> inflating <span class="keyword">class</span> com.google.android.material.bottomnavigation.BottomNavigationView</span><br></pre></td></tr></table></figure>

<p>因为 AndroidManifest.xml  application下的android:theme=”@style/AppTheme”多出了,把下面的删除了就好了.</p>
<figure class="highlight applescript"><table><tr><td class="code"><pre><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">&quot;android:textColorSecondary&quot;</span>&gt;<span class="comment">#ffffff&lt;/item&gt;</span></span><br><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">&quot;android:actionOverflowButtonStyle&quot;</span>&gt;@style/OverflowMenuStyle&lt;/<span class="built_in">item</span>&gt;</span><br><span class="line">&lt;<span class="built_in">item</span> <span class="built_in">name</span>=<span class="string">&quot;android:listDivider&quot;</span>&gt;@drawable/divider&lt;/<span class="built_in">item</span>&gt;</span><br></pre></td></tr></table></figure>

<h5 id="重叠原因"><a href="#重叠原因" class="headerlink" title="重叠原因"></a>重叠原因</h5><blockquote>
<p> 旋转屏幕时候，创建的homeFragment会被回收,在销毁前，执行了onSaveInstanceState(Bundle outState)这个方法。这个方法会保存activity的一些信息，其中就包括添加过的fragment，Activity重建后，再次初始化homeFragment，接着显示，导致了重叠的问题。</p>
</blockquote>
<h5 id="代码验证"><a href="#代码验证" class="headerlink" title="代码验证"></a>代码验证</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initFragment</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (homeFragment == <span class="literal">null</span>) &#123;</span><br><span class="line">        homeFragment = HomeFragment()</span><br><span class="line">        addFragment(homeFragment!!)</span><br><span class="line">        showFragment(homeFragment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    Timber.d(<span class="string">&quot;onCreate() <span class="variable">$homeFragment</span>&quot;</span>)</span><br><span class="line">    initFragment()</span><br><span class="line">    Timber.d(<span class="string">&quot;initFragment() <span class="variable">$homeFragment</span>&quot;</span>)   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDestroy</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy()</span><br><span class="line">        Timber.tag(TAG).d(<span class="string">&quot;onDestroy() homeFragment <span class="variable">$homeFragment</span>&quot;</span>)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>日志</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onCreate() taskId  <span class="number">641</span></span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onCreate() homeFragment null</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;<span class="number">1</span>adc<span class="number">3</span>fa&#125; (b<span class="number">0660244</span>-<span class="number">39</span>c<span class="number">4</span>-<span class="number">4104</span>-b<span class="number">558</span>-f<span class="number">5384</span>c<span class="number">7</span>adb<span class="number">0</span>d) id=<span class="number">0</span>x<span class="number">7</span>f<span class="number">09010</span>e&#125;</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;<span class="number">1</span>adc<span class="number">3</span>fa&#125; (d<span class="number">84</span>f<span class="number">5956</span>-fa<span class="number">2</span>c-<span class="number">4</span>cd<span class="number">2</span>-<span class="number">8397</span>-<span class="number">0904040</span>d<span class="number">2</span>a<span class="number">6</span>f)&#125;</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onCreate() taskId  <span class="number">641</span></span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onCreate() homeFragment null</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;ac<span class="number">076</span>db&#125; (f<span class="number">8</span>ee<span class="number">348</span>b-<span class="number">6</span>ff<span class="number">7</span>-<span class="number">4</span>b<span class="number">1</span>e-ba<span class="number">27</span>-<span class="number">6</span>e<span class="number">47</span>e<span class="number">848</span>f<span class="number">623</span>) id=<span class="number">0</span>x<span class="number">7</span>f<span class="number">09010</span>e&#125;</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onRestoreInstanceState()</span><br><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onResume()</span><br></pre></td></tr></table></figure>

<p>从 initFragment（） 1adc3fa , ac076db 可以看到，HomeFrgment重新创建了.</p>
<h5 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h5><ol>
<li><p>onSaveInstanceState 不保存信息</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSaveInstanceState</span><span class="params">(outState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">//        super.onSaveInstanceState(outState)</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这种方式的弊端就是，切换后总是回到首页.</p>
</li>
<li><p>onSaveInstanceState() 保存Fragment</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">override <span class="keyword">fun</span> on<span class="constructor">Create(<span class="params">savedInstanceState</span>: Bundle?)</span> &#123;</span><br><span class="line">    super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (savedInstanceState != null) &#123;</span><br><span class="line">        <span class="comment">/*获取保存的fragment  没有的话返回null*/</span></span><br><span class="line">        homeFragment = supportFragmentManager.get<span class="constructor">Fragment(<span class="params">savedInstanceState</span>, HOME_FRAGMENT_KEY)</span> <span class="keyword">as</span> HomeFragment?</span><br><span class="line">        healthFragment = supportFragmentManager.get<span class="constructor">Fragment(<span class="params">savedInstanceState</span>, DASHBOARD_FRAGMENT_KEY)</span> <span class="keyword">as</span> HealthFragment?</span><br><span class="line">        personFragment = supportFragmentManager.get<span class="constructor">Fragment(<span class="params">savedInstanceState</span>, NOTICE_FRAGMENT_KEY)</span> <span class="keyword">as</span> PersonFragment?</span><br><span class="line">        add<span class="constructor">ToList(<span class="params">homeFragment</span>)</span></span><br><span class="line">        add<span class="constructor">ToList(<span class="params">healthFragment</span>)</span></span><br><span class="line">        add<span class="constructor">ToList(<span class="params">personFragment</span>)</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        init<span class="constructor">Fragment()</span></span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> override <span class="keyword">fun</span> on<span class="constructor">SaveInstanceState(<span class="params">outState</span>: Bundle)</span> &#123;</span><br><span class="line">        super.on<span class="constructor">SaveInstanceState(<span class="params">outState</span>)</span></span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;MainActivity onSaveInstanceState&quot;</span>)</span><br><span class="line">        <span class="comment">/*fragment不为空时 保存*/</span><span class="keyword">if</span> (homeFragment != null) &#123;</span><br><span class="line">            supportFragmentManager.put<span class="constructor">Fragment(<span class="params">outState</span>!!, HOME_FRAGMENT_KEY, <span class="params">homeFragment</span>!!)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (healthFragment != null) &#123;</span><br><span class="line">            supportFragmentManager.put<span class="constructor">Fragment(<span class="params">outState</span>!!, DASHBOARD_FRAGMENT_KEY, <span class="params">healthFragment</span>!!)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (personFragment != null) &#123;</span><br><span class="line">            supportFragmentManager.put<span class="constructor">Fragment(<span class="params">outState</span>!!, NOTICE_FRAGMENT_KEY, <span class="params">personFragment</span>!!)</span></span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
</ol>
<p>这种方式，可以解决问题，但是打印的日志HomeFragment还是不一样，是什么情况？</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onCreate() taskId  <span class="number">4437</span></span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;dc<span class="number">2914</span>d&#125; (<span class="number">5</span>f<span class="number">30</span>b<span class="number">0</span>dd-a<span class="number">8</span>d<span class="number">2</span>-<span class="number">4</span>b<span class="number">3</span>c-a<span class="number">27</span>f-<span class="number">1</span>d<span class="number">160</span>a<span class="number">9</span>da<span class="number">58</span>e) id=<span class="number">0</span>x<span class="number">7</span>f<span class="number">09010</span>e&#125;</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity$onCreate: navigation_health</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity: MainActivity onSaveInstanceState</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;dc<span class="number">2914</span>d&#125; (ab<span class="number">276</span>ea<span class="number">2</span>-<span class="number">5</span>fa<span class="number">2</span>-<span class="number">4</span>d<span class="number">79</span>-b<span class="number">6</span>a<span class="number">6</span>-af<span class="number">7143</span>b<span class="number">114</span>e<span class="number">8</span>)&#125;</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onCreate() taskId  <span class="number">4437</span></span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity: fragmentList数量<span class="number">1</span></span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity: fragmentList数量<span class="number">2</span></span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity: fragmentList数量<span class="number">2</span></span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;<span class="number">9139494</span>&#125; (<span class="number">5</span>f<span class="number">30</span>b<span class="number">0</span>dd-a<span class="number">8</span>d<span class="number">2</span>-<span class="number">4</span>b<span class="number">3</span>c-a<span class="number">27</span>f-<span class="number">1</span>d<span class="number">160</span>a<span class="number">9</span>da<span class="number">58</span>e) id=<span class="number">0</span>x<span class="number">7</span>f<span class="number">09010</span>e&#125;</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onRestoreInstanceState()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity: MainActivity onSaveInstanceState</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"> <span class="attribute">D</span>/TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;<span class="number">9139494</span>&#125; (cadcb<span class="number">63</span>f-<span class="number">8516</span>-<span class="number">4</span>d<span class="number">44</span>-<span class="number">8</span>f<span class="number">3</span>c-<span class="number">75</span>b<span class="number">0</span>c<span class="number">8</span>e<span class="number">9</span>f<span class="number">27</span>f)&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://blog.csdn.net/yuzhiqiang_1993/article/details/75014591">https://blog.csdn.net/yuzhiqiang_1993/article/details/75014591</a></p>
<p><a href="https://www.jianshu.com/p/78ec81b42f92">https://www.jianshu.com/p/78ec81b42f92</a></p>
<h5 id="下面这种方式没理解"><a href="#下面这种方式没理解" class="headerlink" title="下面这种方式没理解"></a>下面这种方式没理解</h5><p><a href="https://www.jianshu.com/p/d9143a92ad94">https://www.jianshu.com/p/d9143a92ad94</a></p>
<p><a href="https://www.jianshu.com/p/c12a98a36b2b">https://www.jianshu.com/p/c12a98a36b2b</a></p>
<h4 id="横竖屏切换，Fragment实例复用"><a href="#横竖屏切换，Fragment实例复用" class="headerlink" title="横竖屏切换，Fragment实例复用"></a>横竖屏切换，Fragment实例复用</h4><h5 id="setRetainInstance-true"><a href="#setRetainInstance-true" class="headerlink" title="setRetainInstance=true"></a>setRetainInstance=true</h5><p><strong>retainInstance = true已经过期，改用ViewModel</strong></p>
<p>LifeFragment</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">    retainInstance = <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">fun</span> init<span class="constructor">Fragment()</span> &#123;</span><br><span class="line">    var lifeFragment = supportFragmentManager.find<span class="constructor">FragmentById(R.<span class="params">id</span>.<span class="params">fl_content</span>)</span></span><br><span class="line">    <span class="keyword">if</span> (lifeFragment<span class="operator"> == </span>null) &#123;</span><br><span class="line">        lifeFragment = <span class="constructor">LifeFragment()</span></span><br><span class="line">        supportFragmentManager.<span class="keyword">begin</span><span class="constructor">Transaction()</span>.add(<span class="module-access"><span class="module"><span class="identifier">R</span>.</span></span>id.fl_content, lifeFragment).commit<span class="literal">()</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>d(<span class="string">&quot;LifeFragment $lifeFragment&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切换屏幕后 LifeFragment,ondestroy()没志行,后面的Oncreate()也没有创建.</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="variable">D</span>/<span class="variable">LifeActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onCreate</span>() <span class="variable">taskId</span>  <span class="number">599</span></span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">LifeActivity</span>: <span class="variable">LifeFragment</span> <span class="variable">LifeFragment</span>&#123;<span class="number">6</span><span class="variable">a86311</span>&#125; (<span class="number">70133</span><span class="variable">a14</span>-<span class="number">6</span><span class="variable">dcf</span>-<span class="number">4</span><span class="variable">f8b</span>-<span class="variable">beee</span>-<span class="number">6</span><span class="variable">cd31d6623ba</span>) <span class="variable">id</span>=<span class="number">0</span><span class="variable">x7f090109</span>&#125;</span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="title">onAttach</span>(<span class="variable">Context</span> <span class="variable">context</span>)</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onCreate</span>() <span class="variable">savedInstanceState</span>    <span class="variable"><span class="literal">null</span></span></span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="title">onCreateView</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onActivityCreated</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onResume</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onPause</span>() </span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="title">onStop</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onDestroyView</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onDetach</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onAttach</span>(<span class="variable">Context</span> <span class="variable">context</span>)</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeActivity</span> <span class="variable">LaunchModeActivity</span>: <span class="function"><span class="title">onCreate</span>() <span class="variable">taskId</span>  <span class="number">599</span></span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">LifeActivity</span>: <span class="variable">LifeFragment</span> <span class="variable">LifeFragment</span>&#123;<span class="number">6</span><span class="variable">a86311</span>&#125; (<span class="number">70133</span><span class="variable">a14</span>-<span class="number">6</span><span class="variable">dcf</span>-<span class="number">4</span><span class="variable">f8b</span>-<span class="variable">beee</span>-<span class="number">6</span><span class="variable">cd31d6623ba</span>) <span class="variable">id</span>=<span class="number">0</span><span class="variable">x7f090109</span>&#125;</span></span><br><span class="line"><span class="function"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="title">onCreateView</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onActivityCreated</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">LifeFragment</span> <span class="variable">LaunchModeFragment</span>: <span class="function"><span class="title">onResume</span>()</span></span><br></pre></td></tr></table></figure>

<h4 id="Fragment懒加载"><a href="#Fragment懒加载" class="headerlink" title="Fragment懒加载"></a>Fragment懒加载</h4><p>Fragment和ViewPager一起使用会有个预加载机制，会把旁白的Fragment的生命周期方法<br>前半段先执行，然后执行自身的生命周期方法</p>
<p>在项目终从其他页面回到MainAcitivty的时候，三个页面的生命周期方法都跑了一遍</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line">　  <span class="variable">D</span>/<span class="variable">FinanceFragment</span>         <span class="variable">Test</span>: <span class="function"><span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">WealthFragment</span>         <span class="variable">Test</span>: <span class="function"><span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">MineFragment</span>         <span class="variable">Test</span>: <span class="function"><span class="title">onStart</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">FinanceFragment</span>         <span class="variable">Test</span>: <span class="function"><span class="title">onResume</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">WealthFragment</span>         <span class="variable">Test</span>: <span class="function"><span class="title">onResume</span>()</span></span><br><span class="line"><span class="variable">D</span>/<span class="variable">MineFragment</span>         <span class="variable">Test</span>: <span class="function"><span class="title">onResume</span>()</span></span><br></pre></td></tr></table></figure>


<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> isPrepared;  <span class="comment">//判断view是否加载完成,在视图未初始化的时候，在lazyLoad当中就使用的话，就会有空指针的异常</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> isVisible;  <span class="comment">//判断当前Fragment是否可见状态,标志已经初始化完成，因为setUserVisibleHint是在onCreateView之前调用的</span></span><br><span class="line">	  <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onViewCreated</span>(<span class="params">View view, <span class="meta">@Nullable</span> Bundle savedInstanceState</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onViewCreated(view, savedInstanceState);</span><br><span class="line">        isPrepared = <span class="literal">true</span>;</span><br><span class="line">        lazyLoad();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> View <span class="function"><span class="title">onCreateView</span>(<span class="params">LayoutInflater inflater, <span class="meta">@Nullable</span> ViewGroup container, Bundle savedInstanceState</span>)</span> &#123;</span><br><span class="line"><span class="comment">//        Log.d(TAG + &quot;         Test&quot;, &quot; onCreateView()&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rootView == <span class="literal">null</span>) &#123;</span><br><span class="line">            int view = setLayoutId();</span><br><span class="line">            <span class="keyword">if</span> (view != <span class="number">0</span>) &#123;</span><br><span class="line">                rootView = inflater.inflate(view, container, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ViewGroup parent = (ViewGroup) rootView.getParent();</span><br><span class="line">            <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123;</span><br><span class="line">                parent.removeView(rootView);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        initView(rootView);</span><br><span class="line">        <span class="keyword">return</span> rootView;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  http://www.10tiao.com/html/565/201702/2247483988/1.html</span></span><br><span class="line">    <span class="comment">// 标志位，标志已经初始化完成，因为setUserVisibleHint是在onCreateView之前调用的，</span></span><br><span class="line">    <span class="comment">// 在视图未初始化的时候，在lazyLoad当中就使用的话，就会有空指针的异常</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> isPrepared;</span><br><span class="line">    <span class="comment">//标志当前页面是否可见</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">boolean</span> isVisible;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">setUserVisibleHint</span>(<span class="params"><span class="built_in">boolean</span> isVisibleToUser</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.setUserVisibleHint(isVisibleToUser);</span><br><span class="line"><span class="comment">//        Log.d(TAG + &quot;         Test&quot;, &quot; setUserVisibleHint() is Visible : ?  &quot; + isVisibleToUser);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (getUserVisibleHint()) &#123;</span><br><span class="line">            isVisible = <span class="literal">true</span>;</span><br><span class="line">            onVisible();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            isVisible = <span class="literal">false</span>;</span><br><span class="line">            onInvisible();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">onInvisible</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">onVisible</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        lazyLoad();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> <span class="function"><span class="title">lazyLoad</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!isVisible || !isPrepared) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        requestData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">requestData</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        Log.d(TAG + <span class="string">&quot;         Test&quot;</span>, <span class="string">&quot; requestData &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>参考: <a href="http://www.10tiao.com/html/565/201702/2247483988/1.html">http://www.10tiao.com/html/565/201702/2247483988/1.html</a></p>
<h4 id="Activity-dialogFragment-的事件回调"><a href="#Activity-dialogFragment-的事件回调" class="headerlink" title="Activity  dialogFragment 的事件回调"></a>Activity  dialogFragment 的事件回调</h4><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ISelectListener</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getItemPosition</span><span class="params">(position: <span class="type">Int</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mListener: ISelectListener? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onAttach</span><span class="params">(context: <span class="type">Context</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">super</span>.onAttach(context)</span><br><span class="line">    <span class="keyword">if</span> (parentFragment <span class="keyword">is</span> ISelectListener)&#123;</span><br><span class="line">        mListener = parentFragment  <span class="keyword">as</span> ISelectListener</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (context <span class="keyword">is</span> ISelectListener) &#123;</span><br><span class="line">        mListener = context</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> RuntimeException(context!!.toString() + <span class="string">&quot; must implement ISelectListener&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://developer.android.com/guide/components/fragments.html">https://developer.android.com/guide/components/fragments.html</a></p>
<h4 id="onHiddenChanged切换刷新"><a href="#onHiddenChanged切换刷新" class="headerlink" title="onHiddenChanged切换刷新"></a>onHiddenChanged切换刷新</h4><p>使用hide()/show()发现生命周期基本不执行，不过可以用到这个onHiddenChanged();</p>
<p>看下执行的生命周期;   从 SecondFragment 页面开始到 -&gt;FirstFragment </p>
<blockquote>
<p>07-18 15:53:25.128 7758-7758/com.mineutils D/SecondFragment: onAttach(Context context)<br>07-18 15:53:25.129 7758-7758/com.mineutils D/SecondFragment: onCreate()<br>07-18 15:53:25.142 7758-7758/com.mineutils D/SecondFragment: onCreateView()<br>07-18 15:53:25.148 7758-7758/com.mineutils D/SecondFragment:  onViewCreated<br>                                                                onActivityCreated()<br>                                                                onStart()<br>​                                                                  onResume()</p>
<p>07-18 15:53:34.200 7758-7758/com.mineutils D/SecondFragment: onHiddenChanged hidden   true<br>07-18 15:53:34.207 7758-7758/com.mineutils D/FirstFragment:    onCreateView()<br>07-18 15:53:34.208 7758-7758/com.mineutils D/FirstFragment:    onViewCreated<br>                                                              onActivityCreated()<br>​                                                           onStart()</p>
<p>07-18 15:53:53.968 7758-7758/com.mineutils D/FirstFragment: onHiddenChanged hidden   true<br>07-18 15:53:53.968 7758-7758/com.mineutils D/SecondFragment: onHiddenChanged hidden   false</p>
</blockquote>
<p><a href="https://blog.csdn.net/cml_blog/article/details/41411451">https://blog.csdn.net/cml_blog/article/details/41411451</a></p>
<h4 id="fragment常用特性"><a href="#fragment常用特性" class="headerlink" title="fragment常用特性"></a>fragment常用特性</h4><h5 id="commitAllowingStateLoss-VS-commit-区别"><a href="#commitAllowingStateLoss-VS-commit-区别" class="headerlink" title="commitAllowingStateLoss VS  commit()区别"></a>commitAllowingStateLoss VS  commit()区别</h5><p><a href="https://huxian99.github.io/2016/08/28/cj3qymo360000owxk9zp17alo/">https://huxian99.github.io/2016/08/28/cj3qymo360000owxk9zp17alo/</a></p>
<h5 id="Fragment之间传递数据"><a href="#Fragment之间传递数据" class="headerlink" title="Fragment之间传递数据"></a>Fragment之间传递数据</h5><ol>
<li><p>Fragment.setArguments()方法传递bundle</p>
</li>
<li><p>findFragmentById()找到tag,然后直接操作Framgent</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">      ArticleFragment articleFrag = (ArticleFragment)</span><br><span class="line">              getSupportFragmentManager().findFragmentById(R.id.article_fragment);</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">if</span> (articleFrag != <span class="keyword">null</span>) &#123;</span><br><span class="line">          articleFrag.updateArticleView(position);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ArticleFragment newFragment = <span class="keyword">new</span> ArticleFragment();</span><br><span class="line">          Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">          args.putInt(ArticleFragment.ARG_POSITION, position);</span><br><span class="line">          newFragment.setArguments(args);</span><br><span class="line">   </span><br><span class="line">          FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();</span><br><span class="line">          transaction.replace(R.id.fragment_container, newFragment);</span><br><span class="line">          transaction.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">          transaction.commit();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>接口回调</p>
</li>
<li><p>ViewModel Livedata</p>
</li>
</ol>
<h5 id="给已经创建frament传递数据"><a href="#给已经创建frament传递数据" class="headerlink" title="给已经创建frament传递数据"></a>给已经创建frament传递数据</h5><p>也是直接 Fragment.refresh(),第一行代码第三版P227，也是这样做的。</p>
<h5 id="fragment回退栈"><a href="#fragment回退栈" class="headerlink" title="fragment回退栈"></a>fragment回退栈</h5><p>tx.addToBackStack(null); 添加回退功能，类似Activity压栈的过程</p>
<p><a href="https://www.jianshu.com/p/fe16553ca2ca">https://www.jianshu.com/p/fe16553ca2ca</a></p>
<p><a href="https://blog.csdn.net/zhiyuan0932/article/details/52593039">https://blog.csdn.net/zhiyuan0932/article/details/52593039</a></p>
<p>Fragment控制父Fragment展示</p>
<p><a href="https://stackoverflow.com/questions/39491655/communication-between-nested-fragments-in-android">Communication between nested fragments in Android</a></p>
<p><a href="https://blog.csdn.net/u011481547/article/details/71552720">https://blog.csdn.net/u011481547/article/details/71552720</a></p>
<p>Fragmet全局流程图</p>
<p><a href="https://kotlintc.com/articles/5693">https://kotlintc.com/articles/5693</a></p>
<p><a href="https://mp.weixin.qq.com/s/MOWdbI5IREjQP1Px-WJY1Q">https://mp.weixin.qq.com/s/MOWdbI5IREjQP1Px-WJY1Q</a></p>
<p><a href="https://juejin.im/post/5bcd58b6e51d45404c71d23f">https://juejin.im/post/5bcd58b6e51d45404c71d23f</a></p>
<p><a href="https://mp.weixin.qq.com/s/_hdbMOA2TVvX4jFnMu15bg">https://mp.weixin.qq.com/s/_hdbMOA2TVvX4jFnMu15bg</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>Handler</title>
    <url>/2017/08/21/Handler/</url>
    <content><![CDATA[<h5 id="原理图"><a href="#原理图" class="headerlink" title="原理图"></a>原理图</h5><img src="/2017/08/21/Handler/2021-07-07_15-49-54_hanlder.png">



<p> <img src="https://images.xiaozhuanlan.com/photo/2019/5dd99feb4297e4c3a5ad55dba0812a1a.png"></p>
<h5 id="各组件作用"><a href="#各组件作用" class="headerlink" title="各组件作用"></a>各组件作用</h5><ul>
<li>Handler：事件的发送及处理者，在构造方法中可以设置其 async，默认为 false。若 async 为 true 则该 Handler 发送的 Message 均为异步消息，有同步屏障的情况下会被优先处理。</li>
<li>Looper：一个用于遍历 MessageQueue 的类，每个线程有一个独有的 Looper，它会在所处的线程开启一个死循环，不断从 MessageQueue 中拿出消息，并将其发送给 target 进行处理</li>
<li>MessageQueue：在主线程,用于存储 Message，内部维护了 Message 的链表，每次拿取 Message 时，若该  Message 离真正执行还需要一段时间，会通过 nativePollOnce  进入阻塞状态，避免资源的浪费。若存在消息屏障，则会忽略同步消息优先拿取异步消息，从而实现异步消息的优先消费。</li>
</ul>
<h5 id="消息入队算法"><a href="#消息入队算法" class="headerlink" title="消息入队算法"></a>消息入队算法</h5><p><a href="https://www.jianshu.com/p/9efe3b48b730">https://www.jianshu.com/p/9efe3b48b730</a></p>
<p><a href="https://juejin.cn/post/6844904113470177293">https://juejin.cn/post/6844904113470177293</a></p>
<p><a href="https://www.bilibili.com/video/BV1VE411Z7Ay?p=4">https://www.bilibili.com/video/BV1VE411Z7Ay?p=4</a></p>
<h5 id="ThreadLocal存取算法"><a href="#ThreadLocal存取算法" class="headerlink" title="ThreadLocal存取算法"></a>ThreadLocal存取算法</h5><p>　ThreadLocal是一个线程内部的数据存储类，它可以指定线程的存储数据，数据存储后只有在指定的线程种裁可以获取到存储的数据, 其他线程无法获取。</p>
<p> 验证:</p>
<pre><code>  private ThreadLocal&lt;String&gt; mStringThreadLocal = new ThreadLocal&lt;&gt;();
  mStringThreadLocal.set(&quot;我是主线程&quot;);
    Log.d(TAG, &quot;mStringThreadLocal 主线程 :　&quot; + mStringThreadLocal.get());
    exec.submit(new Runnable() &#123;
        @Override
        public void run() &#123;
            mStringThreadLocal.set(&quot;我是线程１&quot;);
            Log.d(TAG, &quot;mStringThreadLocal 线程１:　&quot; + mStringThreadLocal.get());
        &#125;
    &#125;);

    exec.submit(new Runnable() &#123;
        @Override
        public void run() &#123;
            Log.d(TAG, &quot;mStringThreadLocal 线程2: &quot; + mStringThreadLocal.get());
        &#125;
    &#125;);
</code></pre>
<p>运行结果:</p>
<blockquote>
<pre><code>  D/MainActivity: mStringThreadLocal 主线程 :　我是主线程
 D/MainActivity: mStringThreadLocal 线程１:　我是线程１
 D/MainActivity: mStringThreadLocal 线程2: null
</code></pre>
</blockquote>
<p>从日志可以看到，虽然在不同线程访问的同一个ThreadLocal对象，但是他们通过ThreadLocal获取到的值确不一样<br>　结论：　对ThreadLocal所做的　读写操作仅限于各自线程的内部，ThreadLocal可以在多个线程互不干扰的存储和修改数据。<br>  !!!任务： 分析ThreadLocal存取算法</p>
<p>[^参考：Android开发艺术探索　p377]</p>
<h5 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h5><h6 id="同步消息"><a href="#同步消息" class="headerlink" title="同步消息"></a>同步消息</h6><p> 来个简单的例子<br> <figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line"><span class="built_in">new</span> Thread(<span class="built_in">new</span> Runnable() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        <span class="built_in">public</span> <span class="type">void</span> run() &#123;</span><br><span class="line">          Looper.<span class="keyword">prepare</span>();</span><br><span class="line">          <span class="keyword">handler</span> = <span class="built_in">new</span> <span class="keyword">Handler</span>();</span><br><span class="line">          Looper.<span class="keyword">loop</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).<span class="keyword">start</span>();</span><br></pre></td></tr></table></figure><br>把　Looper.prepare();注释，报错日志 : <code>java.lang.RuntimeException: Can&#39;t create handler inside thread that has not called Looper.prepare()</code></p>
<p>从报错信息入手看原因，初始化Handler (API = 25)</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="title">Handler</span>(<span class="params">Callback callback, <span class="built_in">boolean</span> <span class="keyword">async</span></span>)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (FIND_POTENTIAL_LEAKS) &#123;</span><br><span class="line">           final Class&lt;? <span class="keyword">extends</span> Handler&gt; klass = getClass();</span><br><span class="line">           <span class="keyword">if</span> ((klass.isAnonymousClass() || klass.isMemberClass() || klass.isLocalClass()) &amp;&amp;</span><br><span class="line">                   (klass.getModifiers() &amp; Modifier.STATIC) == <span class="number">0</span>) &#123;</span><br><span class="line">               Log.w(TAG, <span class="string">&quot;The following Handler class should be static or leaks might occur: &quot;</span> +</span><br><span class="line">                   klass.getCanonicalName());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       mLooper = Looper.myLooper();</span><br><span class="line">       <span class="keyword">if</span> (mLooper == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">               <span class="string">&quot;Can&#x27;t create handler inside thread that has not called Looper.prepare()&quot;</span>);  <span class="comment">//报错信息</span></span><br><span class="line">       &#125;</span><br><span class="line">       mQueue = mLooper.mQueue;</span><br><span class="line">       mCallback = callback;</span><br><span class="line">       mAsynchronous = <span class="keyword">async</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>　mLooper为空,所以报错，看下<code>Looper.myLooper();</code></p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Return the Looper object associated with the current thread.  Returns</span></span><br><span class="line"><span class="comment">    * null if the calling thread is not associated with a Looper.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> @<span class="function">Nullable Looper <span class="title">myLooper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> sThreadLocal.<span class="built_in">get</span>();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>  注释可以看到，当前线程没有Looper对象, 那么Looper对象是怎么创建的呢，很显然就是上面例子里的<code> Looper.prepare();</code></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/** Initialize the current thread as a looper.</span></span><br><span class="line"><span class="comment">     * This gives you a chance to create handlers that then reference</span></span><br><span class="line"><span class="comment">     * this looper, before actually starting the loop. Be sure to call</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link </span>#loop()&#125; after calling this method, and end it by calling</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@link </span>#quit()&#125;.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="function"><span class="title">prepare</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">       prepare(<span class="literal">true</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="function"><span class="title">prepare</span>(<span class="params"><span class="built_in">boolean</span> quitAllowed</span>)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (sThreadLocal.get() != <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Only one Looper may be created per thread&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       sThreadLocal.set(<span class="keyword">new</span> Looper(quitAllowed));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>如果没有Looper　则new 一个，由此也看到每个线程最多一个Looper对象,接着看初始化的Looper</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="constructor">Looper(<span class="params">boolean</span> <span class="params">quitAllowed</span>)</span> &#123;</span><br><span class="line">       mQueue = <span class="keyword">new</span> <span class="constructor">MessageQueue(<span class="params">quitAllowed</span>)</span>;</span><br><span class="line">       mThread = <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>MesageQueue也是通过Looper创建的，看到private 构造方法,一个Looper管理一个　ＭesageQueue,<br>但是我们通常在UI线程初始化Handler不需要调用 <code>Looper.prepare();</code>,这是因为应用启动后,主线程<br>ActivityThread main方法为我们做了工作。</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">       Trace.<span class="built_in">traceBegin</span>(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">&quot;ActivityThreadMain&quot;</span>);</span><br><span class="line">       SamplingProfilerIntegration.<span class="built_in">start</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// CloseGuard defaults to true and can be quite spammy.  We</span></span><br><span class="line">       <span class="comment">// disable it here, but selectively enable it later (via</span></span><br><span class="line">       <span class="comment">// StrictMode) on debug builds, but using DropBox, not logs.</span></span><br><span class="line">       CloseGuard.<span class="built_in">setEnabled</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">       Environment.<span class="built_in">initForCurrentUser</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Set the reporter for event logging in libcore</span></span><br><span class="line">       EventLogger.<span class="built_in">setReporter</span>(<span class="keyword">new</span> <span class="built_in">EventLoggingReporter</span>());</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Make sure TrustedCertificateStore looks in the right place for CA certificates</span></span><br><span class="line">       <span class="keyword">final</span> <span class="built_in">File</span> configDir = Environment.<span class="built_in">getUserConfigDirectory</span>(UserHandle.<span class="built_in">myUserId</span>());</span><br><span class="line">       TrustedCertificateStore.<span class="built_in">setDefaultUserDirectory</span>(configDir);</span><br><span class="line"></span><br><span class="line">       <span class="built_in">Process</span>.<span class="built_in">setArgV0</span>(<span class="string">&quot;&lt;pre-initialized&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">       Looper.<span class="built_in">prepareMainLooper</span>();</span><br><span class="line"></span><br><span class="line">       ActivityThread thread = <span class="keyword">new</span> <span class="built_in">ActivityThread</span>();</span><br><span class="line">       thread.<span class="built_in">attach</span>(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (sMainThreadHandler == null) &#123;</span><br><span class="line">           sMainThreadHandler = thread.<span class="built_in">getHandler</span>();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (<span class="literal">false</span>) &#123;</span><br><span class="line">           Looper.<span class="built_in">myLooper</span>().<span class="built_in">setMessageLogging</span>(<span class="keyword">new</span></span><br><span class="line">                   <span class="built_in">LogPrinter</span>(Log.DEBUG, <span class="string">&quot;ActivityThread&quot;</span>));</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// End of event ActivityThreadMain.</span></span><br><span class="line">       Trace.<span class="built_in">traceEnd</span>(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">       Looper.<span class="built_in">loop</span>();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(<span class="string">&quot;Main thread loop unexpectedly exited&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这样初始化Handler操作分析好了，接着就开始发消息了 <code>handler.sendMessage(message);</code>,经过层层调用来到这个方法</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">　 <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sendMessageAtTime</span><span class="params">(Message msg, <span class="keyword">long</span> uptimeMillis)</span> </span>&#123;</span><br><span class="line">    MessageQueue queue = mQueue;</span><br><span class="line">    <span class="keyword">if</span> (queue == null) &#123;</span><br><span class="line">        RuntimeException e = <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(</span><br><span class="line">                <span class="keyword">this</span> + <span class="string">&quot; sendMessageAtTime() called with no mQueue&quot;</span>);</span><br><span class="line">        Log.<span class="built_in">w</span>(<span class="string">&quot;Looper&quot;</span>, e.<span class="built_in">getMessage</span>(), e);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">enqueueMessage</span>(queue, msg, uptimeMillis);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二个参数时间是可以添加延时的参数</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="function">boolean <span class="title">enqueueMessage</span>(<span class="params">Message msg, <span class="built_in">long</span> <span class="keyword">when</span></span>)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (msg.target == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Message must have a target.&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (msg.isInUse()) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(msg + <span class="string">&quot; This message is already in use.&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       synchronized (<span class="keyword">this</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (mQuitting) &#123;</span><br><span class="line">               IllegalStateException e = <span class="keyword">new</span> IllegalStateException(</span><br><span class="line">                       msg.target + <span class="string">&quot; sending message to a Handler on a dead thread&quot;</span>);</span><br><span class="line">               Log.w(TAG, e.getMessage(), e);</span><br><span class="line">               msg.recycle();</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           msg.markInUse();</span><br><span class="line">           msg.<span class="keyword">when</span> = <span class="keyword">when</span>;</span><br><span class="line">           Message p = mMessages;</span><br><span class="line">           boolean needWake;</span><br><span class="line">           <span class="keyword">if</span> (p == <span class="literal">null</span> || <span class="keyword">when</span> == <span class="number">0</span> || <span class="keyword">when</span> &lt; p.<span class="keyword">when</span>) &#123;</span><br><span class="line">               <span class="comment">// New head, wake up the event queue if blocked.</span></span><br><span class="line">               msg.next = p;</span><br><span class="line">               mMessages = msg;</span><br><span class="line">               needWake = mBlocked;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="comment">// Inserted within the middle of the queue.  Usually we don&#x27;t have to wake</span></span><br><span class="line">               <span class="comment">// up the event queue unless there is a barrier at the head of the queue</span></span><br><span class="line">               <span class="comment">// and the message is the earliest asynchronous message in the queue.</span></span><br><span class="line">               needWake = mBlocked &amp;&amp; p.target == <span class="literal">null</span> &amp;&amp; msg.isAsynchronous();</span><br><span class="line">               Message prev;</span><br><span class="line">               <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                   prev = p;</span><br><span class="line">                   p = p.next;</span><br><span class="line">                   <span class="keyword">if</span> (p == <span class="literal">null</span> || <span class="keyword">when</span> &lt; p.<span class="keyword">when</span>) &#123;</span><br><span class="line">                       <span class="keyword">break</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">                   <span class="keyword">if</span> (needWake &amp;&amp; p.isAsynchronous()) &#123;</span><br><span class="line">                       needWake = <span class="literal">false</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;</span><br><span class="line">               msg.next = p; <span class="comment">// invariant: p == prev.next</span></span><br><span class="line">               prev.next = msg;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// We can assume mPtr != 0 because mQuitting is false.</span></span><br><span class="line">           <span class="keyword">if</span> (needWake) &#123;</span><br><span class="line">               nativeWake(mPtr);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这要Mesage消息就添加到 MesageQueue中了，按事件顺序添加，然后就是取消息了，通过调用<code>Looper.loop();</code></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Run the message queue in this thread. Be sure to call</span></span><br><span class="line"><span class="comment">    * &#123;@link #quit()&#125; to end the loop.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   public static void loop<span class="literal">()</span> &#123;</span><br><span class="line">       final Looper me = my<span class="constructor">Looper()</span>;</span><br><span class="line">       <span class="keyword">if</span> (me<span class="operator"> == </span>null) &#123;</span><br><span class="line">           throw <span class="keyword">new</span> <span class="constructor">RuntimeException(<span class="string">&quot;No Looper; Looper.prepare() wasn&#x27;t called on this thread.&quot;</span>)</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       final MessageQueue queue = me.mQueue;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Make sure the identity of this thread is that of the local process,</span></span><br><span class="line">       <span class="comment">// and keep track of what that identity token actually is.</span></span><br><span class="line">       <span class="module-access"><span class="module"><span class="identifier">Binder</span>.</span></span>clear<span class="constructor">CallingIdentity()</span>;</span><br><span class="line">       final long ident = <span class="module-access"><span class="module"><span class="identifier">Binder</span>.</span></span>clear<span class="constructor">CallingIdentity()</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">           Message msg = queue.next<span class="literal">()</span>; <span class="comment">// might block</span></span><br><span class="line">           <span class="keyword">if</span> (msg<span class="operator"> == </span>null) &#123;</span><br><span class="line">               <span class="comment">// No message indicates that the message queue is quitting.</span></span><br><span class="line">               return;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// This must be in a local variable, in case a UI event sets the logger</span></span><br><span class="line">           final Printer logging = me.mLogging;</span><br><span class="line">           <span class="keyword">if</span> (logging != null) &#123;</span><br><span class="line">               logging.println(<span class="string">&quot;&gt;&gt;&gt;&gt;&gt; Dispatching to &quot;</span> + msg.target + <span class="string">&quot; &quot;</span> +</span><br><span class="line">                       msg.callback + <span class="string">&quot;: &quot;</span> + msg.what);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           final long traceTag = me.mTraceTag;</span><br><span class="line">           <span class="keyword">if</span> (traceTag != <span class="number">0</span><span class="operator"> &amp;&amp; </span><span class="module-access"><span class="module"><span class="identifier">Trace</span>.</span></span>is<span class="constructor">TagEnabled(<span class="params">traceTag</span>)</span>) &#123;</span><br><span class="line">               <span class="module-access"><span class="module"><span class="identifier">Trace</span>.</span></span>trace<span class="constructor">Begin(<span class="params">traceTag</span>, <span class="params">msg</span>.<span class="params">target</span>.<span class="params">getTraceName</span>(<span class="params">msg</span>)</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               msg.target.dispatch<span class="constructor">Message(<span class="params">msg</span>)</span>;</span><br><span class="line">           &#125; finally &#123;</span><br><span class="line">               <span class="keyword">if</span> (traceTag != <span class="number">0</span>) &#123;</span><br><span class="line">                   <span class="module-access"><span class="module"><span class="identifier">Trace</span>.</span></span>trace<span class="constructor">End(<span class="params">traceTag</span>)</span>;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">if</span> (logging != null) &#123;</span><br><span class="line">               logging.println(<span class="string">&quot;&lt;&lt;&lt;&lt;&lt; Finished to &quot;</span> + msg.target + <span class="string">&quot; &quot;</span> + msg.callback);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Make sure that during the course of dispatching the</span></span><br><span class="line">           <span class="comment">// identity of the thread wasn&#x27;t corrupted.</span></span><br><span class="line">           final long newIdent = <span class="module-access"><span class="module"><span class="identifier">Binder</span>.</span></span>clear<span class="constructor">CallingIdentity()</span>;</span><br><span class="line">           <span class="keyword">if</span> (ident != newIdent) &#123;</span><br><span class="line">               <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>wtf(TAG, <span class="string">&quot;Thread identity changed from 0x&quot;</span></span><br><span class="line">                       + <span class="module-access"><span class="module"><span class="identifier">Long</span>.</span></span><span class="keyword">to</span><span class="constructor">HexString(<span class="params">ident</span>)</span> + <span class="string">&quot; to 0x&quot;</span></span><br><span class="line">                       + <span class="module-access"><span class="module"><span class="identifier">Long</span>.</span></span><span class="keyword">to</span><span class="constructor">HexString(<span class="params">newIdent</span>)</span> + <span class="string">&quot; while dispatching to &quot;</span></span><br><span class="line">                       + msg.target.get<span class="constructor">Class()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot; &quot;</span></span><br><span class="line">                       + msg.callback + <span class="string">&quot; what=&quot;</span> + msg.what);</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           msg.recycle<span class="constructor">Unchecked()</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>通过 Message msg = queue.next();　获取消息，然后用<code>  msg.target.dispatchMessage(msg);</code>把消息往哪发呢 ?</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle system messages here.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public void dispatch<span class="constructor">Message(Message <span class="params">msg</span>)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (msg.callback != null) &#123;</span><br><span class="line">            handle<span class="constructor">Callback(<span class="params">msg</span>)</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (mCallback != null) &#123;</span><br><span class="line">                <span class="keyword">if</span> (mCallback.handle<span class="constructor">Message(<span class="params">msg</span>)</span>) &#123;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            handle<span class="constructor">Message(<span class="params">msg</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>点开　handleMesage(msg),msg.target 就是Handler</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Subclasses must implement this to receive messages.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这里就清楚了，消息就传到了　Hanlder里面handleMessage的实现方法<br>从上面分析handler消息传递基本了解了，借张图看下整片森林</p>
<h6 id="异步消息"><a href="#异步消息" class="headerlink" title="异步消息"></a>异步消息</h6><p>Android系统16ms会刷新一次屏幕，如果主线程的消息过多，在16ms之内没有执行完，必然会造成卡顿或者掉帧。那怎么才能不排队，没有延时的处理呢？这个时候就需要异步消息，在处理异步消息的时候，我们就需要同步屏障，让异步消息不用排队等候处理。可以理解为同步屏障是一堵墙，把同步消息队列拦住，先处理异步消息，等异步消息处理完了，这堵墙就会取消，然后继续处理同步消息。</p>
<p><a href="https://blog.csdn.net/ly502541243/article/details/109091386">https://blog.csdn.net/ly502541243/article/details/109091386</a></p>
<p>查找异步消息方法</p>
<p>MessageQueue.java </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Message <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">           <span class="keyword">if</span> (nextPollTimeoutMillis != <span class="number">0</span>) &#123;</span><br><span class="line">               Binder.flushPendingCommands();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           nativePollOnce(ptr, nextPollTimeoutMillis);</span><br><span class="line"></span><br><span class="line">           <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">               <span class="comment">// Try to retrieve the next message.  Return if found.</span></span><br><span class="line">               <span class="keyword">final</span> <span class="keyword">long</span> now = SystemClock.uptimeMillis();</span><br><span class="line">               Message prevMsg = <span class="keyword">null</span>;</span><br><span class="line">               Message msg = mMessages;</span><br><span class="line">               <span class="keyword">if</span> (msg != <span class="keyword">null</span> &amp;&amp; msg.target == <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="comment">// Stalled by a barrier.  Find the next asynchronous message in the queue.</span></span><br><span class="line">                   <span class="keyword">do</span> &#123;</span><br><span class="line">                       prevMsg = msg;</span><br><span class="line">                       msg = msg.next;</span><br><span class="line">                   &#125; <span class="keyword">while</span> (msg != <span class="keyword">null</span> &amp;&amp; !msg.isAsynchronous()); <span class="comment">//循环查找 直到找到异步消息为止.</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://blog.csdn.net/ly502541243/article/details/109091386">https://blog.csdn.net/ly502541243/article/details/109091386</a></p>
<h5 id="发送延时消息"><a href="#发送延时消息" class="headerlink" title="发送延时消息"></a>发送延时消息</h5><p>看下面问题:handler如何实现延时发消息postdelay()</p>
<p><a href="https://zhuanlan.zhihu.com/p/260661053">https://zhuanlan.zhihu.com/p/260661053</a></p>
<p><a href="https://blog.csdn.net/thh159/article/details/103644489">https://blog.csdn.net/thh159/article/details/103644489</a></p>
<h5 id="IdleHandler使用"><a href="#IdleHandler使用" class="headerlink" title="IdleHandler使用"></a>IdleHandler使用</h5><p>当消息队列空闲时会执行IdleHandler的queueIdle()方法，该方法返回一个boolean值，如果为false则执行完毕之后移除这条消息，如果为true则保留，等到下次空闲时会再次执行，下面看下MessageQueue的next()方法可以发现确实是这样</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">Message <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Run the idle handlers.</span></span><br><span class="line">            <span class="comment">// We only ever reach this code block during the first iteration.</span></span><br><span class="line"> 	keep = idler.queueIdle();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>Activity启动优化：onCreate，onStart，onResume中耗时较短但非必要的代码可以放到IdleHandler中执行，减少启动时间</p>
</li>
<li><p>想要在一个View绘制完成之后添加其他依赖于这个View的View，当然这个用View#post()也能实现，区别就是前者会在消息队列空闲时执行</p>
</li>
<li><p>一些第三方库中有使用，比如LeakCanary，Glide中有使用到，具体可以自行去查看</p>
</li>
<li><p>以前我们在Activity中获取某个控件的宽高的时候总是得到的是0，那是因为view的测量还未完成。通常的做法是监听ViewTreeObserver，它是在ViewRootImpl测量完成之后调用ViewTreeObserver.dispatchOnGlobalLayout()方法，这时候在onGlobalLayout回调中获取的控件宽高都是正确的数据。</p>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">Looper.myQueue().addIdleHandler &#123;</span><br><span class="line">    Log.i(<span class="string">&quot;HandlerActivity&quot;</span>, <span class="string">&quot;width <span class="subst">$&#123;btFive.width&#125;</span>  height <span class="subst">$&#123;btFive.height&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/ZYJWR/article/details/103086664">https://blog.csdn.net/ZYJWR/article/details/103086664</a></p>
<p><a href="https://www.wanandroid.com/wenda/show/8723">https://www.wanandroid.com/wenda/show/8723</a></p>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><h6 id="handler的是怎样实现的？"><a href="#handler的是怎样实现的？" class="headerlink" title="handler的是怎样实现的？"></a>handler的是怎样实现的？</h6><p>新线程中执行了一个耗时操作，然后把该结果塞给message，handler将发送这个messageQueue，Loop不停的从消息队列中取出消息。Handler 分发给Ui.</p>
<h6 id="Handler是怎么切换线程的"><a href="#Handler是怎么切换线程的" class="headerlink" title="Handler是怎么切换线程的"></a>Handler是怎么切换线程的</h6><p>我们在不同的线程发送消息，线程之间的资源是共享的</p>
<h6 id="Handler机制了解吗？一个线程有几个Looper？为什么？"><a href="#Handler机制了解吗？一个线程有几个Looper？为什么？" class="headerlink" title="Handler机制了解吗？一个线程有几个Looper？为什么？"></a>Handler机制了解吗？一个线程有几个Looper？为什么？</h6><p>只能有一个，不然调用Looper.prepare()会抛出运行时异常，提示“Only one Looper may be created per thread”</p>
<h6 id="handler如何实现延时发消息postdelay"><a href="#handler如何实现延时发消息postdelay" class="headerlink" title="handler如何实现延时发消息postdelay(),"></a>handler如何实现延时发消息postdelay(),</h6><p>可以看到这里也是一个for循环遍历队列，核心变量就是nextPollTimeoutMillis。可以看到，计算出nextPollTimeoutMillis后就调用nativiePollOnce这个native方法。这里的话大概可以猜到他的运行机制，因为他是根据执行时间进行排序的，那传入的这个nextPollTimeoutMillis应该就是休眠时间，类似于java的sleep(time)。休眠到下一次message的时候就执行。那如果我在这段时间又插入了一个新的message怎么办，所以handler每次插入message都会唤醒线程，重新计算插入后，再走一次这个休眠流程。</p>
<p>值得注意的是这个方法没有开启子线程，只是调用了run(), 在<code> msg.target.dispatchMessage(msg)</code>可以看到，接着调用了handleCallback().</p>
<p><a href="https://www.jianshu.com/p/68083d432b3f">https://www.jianshu.com/p/68083d432b3f</a></p>
<h6 id="如果移除一个延时消息会解除休眠吗"><a href="#如果移除一个延时消息会解除休眠吗" class="headerlink" title="如果移除一个延时消息会解除休眠吗"></a>如果移除一个延时消息会解除休眠吗</h6><h6 id="主线程死循环不会卡死吗"><a href="#主线程死循环不会卡死吗" class="headerlink" title="主线程死循环不会卡死吗"></a>主线程死循环不会卡死吗</h6><p>从前面的主线程、子线程的分析可以看出，Looper会在线程中不断的检索消息，如果是子线程的Looper死循环，一旦任务完成，用户应该手动退出，而不是让其一直休眠等待。（引用自Gityuan）线程其实就是一段可执行的代码，当可执行的代码执行完成后，线程的生命周期便该终止了，线程退出。而对于主线程，我们是绝不希望会被运行一段时间，自己就退出，那么如何保证能一直存活呢？简单做法就是可执行代码是能一直执行下去的，死循环便能保证不会被退出，例如，binder 线程也是采用死循环的方法，通过循环方式不同与 Binder 驱动进行读写操作，当然并非简单地死循环，无消息时会休眠。<strong>Android是基于消息处理机制的，用户的行为都在这个Looper循环中，我们在休眠时点击屏幕，便唤醒主线程继续进行工作</strong>。</p>
<p>主线程的死循环一直运行是不是特别消耗 CPU 资源呢？ 其实不然，这里就涉及到 Linux pipe/epoll机制，简单说就是在主线程的 MessageQueue 没有消息时，便阻塞在 loop 的 queue.next() 中的 nativePollOnce() 方法里，此时主线程会释放 CPU 资源进入休眠状态，直到下个消息到达或者有事务发生，通过往 pipe 管道写端写入数据来唤醒主线程工作。这里采用的 epoll 机制，是一种IO多路复用机制，可以同时监控多个描述符，当某个描述符就绪(读或写就绪)，则立刻通知相应程序进行读或写操作，本质同步I/O，即读写是阻塞的。 所以说，主线程大多数时候都是处于休眠状态，并不会消耗大量CPU资源。</p>
<p><a href="https://www.jianshu.com/p/a7969d73c120">https://www.jianshu.com/p/a7969d73c120</a></p>
<h6 id="handler内存泄露问题"><a href="#handler内存泄露问题" class="headerlink" title="handler内存泄露问题"></a>handler内存泄露问题</h6><h6 id="说说你对Handler机制的了解，同步消息，异步消息等"><a href="#说说你对Handler机制的了解，同步消息，异步消息等" class="headerlink" title="说说你对Handler机制的了解，同步消息，异步消息等"></a>说说你对Handler机制的了解，同步消息，异步消息等</h6><h6 id="IdleHandler用过吗-IdleHandler应用场景？"><a href="#IdleHandler用过吗-IdleHandler应用场景？" class="headerlink" title="IdleHandler用过吗,IdleHandler应用场景？"></a>IdleHandler用过吗,IdleHandler应用场景？</h6><p> 见上面IdleHandler使用</p>
<p>handler如何实现延时发消息postdelay()。callback，runnable，msg的执行优先级。阻塞是怎么实现的？为什么不会阻塞主线程？</p>
<h6 id=""><a href="#" class="headerlink" title=""></a></h6><h6 id="Handler休眠是怎样的？epoll的原理是什么？"><a href="#Handler休眠是怎样的？epoll的原理是什么？" class="headerlink" title="Handler休眠是怎样的？epoll的原理是什么？"></a>Handler休眠是怎样的？epoll的原理是什么？</h6><h6 id="如何实现延时消息，如果移除一个延时消息会解除休眠吗？"><a href="#如何实现延时消息，如果移除一个延时消息会解除休眠吗？" class="headerlink" title="如何实现延时消息，如果移除一个延时消息会解除休眠吗？"></a>如何实现延时消息，如果移除一个延时消息会解除休眠吗？</h6><p>Handler内存泄漏的GCRoot是什么？</p>
<p>epoll的时候算是卡顿吗</p>
<p>怎么样算是卡顿了</p>
<p>怎么利用消息机制检测卡顿</p>
<p>除了这种方式还有别的监测卡顿的方式吗</p>
<h6 id="Android中为什么主线程不会因为Looper-loop-里的死循环卡死？"><a href="#Android中为什么主线程不会因为Looper-loop-里的死循环卡死？" class="headerlink" title="Android中为什么主线程不会因为Looper.loop()里的死循环卡死？"></a>Android中为什么主线程不会因为Looper.loop()里的死循环卡死？</h6><p>对于线程即是一段可执行的代码，当可执行代码执行完成后，线程生命周期便该终止了，线程退出。而对于主线程，我们是绝不希望会被运行一段时间，自己就退出，那么如何保证能一直存活呢？简单做法就是可执行代码是能一直执行下去的，死循环便能保证不会被退出，例如，binder线程也是采用死循环的方法，通过循环方式不同与Binder驱动进行读写操作，当然并非简单地死循环，无消息时会休眠。但这里可能又引发了另一个问题，既然是死循环又如何去处理其他事务呢？通过创建新线程的方式。真正会卡死主线程的操作是在回调方法<code>onCreate/onStart/onResume</code>等操作时间过长，会导致掉帧，甚至发生ANR，looper.loop本身不会导致应用卡死。</p>
<p>主线程的死循环一直运行是不是特别消耗CPU资源呢？ 其实不然，这里就涉及到<code>Linux pipe/epoll</code>机制，简单说就是在主线程的<code>MessageQueue</code>没有消息时，便阻塞在loop的<code>queue.next()</code>中的<code>nativePollOnce()</code>方法里，此时主线程会释放CPU资源进入休眠状态，直到下个消息到达或者有事务发生，通过往pipe管道写端写入数据来唤醒主线程工作。这里采用的epoll机制，是一种IO多路复用机制，可以同时监控多个描述符，当某个描述符就绪(读或写就绪)，则立刻通知相应程序进行读或写操作，本质同步I/O，即读写是阻塞的。 所以说，主线程大多数时候都是处于休眠状态，并不会消耗大量CPU资源。 Gityuan–Handler(Native层)</p>
<p>Handler通信，Binder通信</p>
<h6 id="Handler同步屏障"><a href="#Handler同步屏障" class="headerlink" title="Handler同步屏障"></a>Handler同步屏障</h6><p>Handler发送的消息分为普通消息、屏障消息、异步消息，一旦Looper在处理消息时遇到屏障消息，那么就不再处理普通的消息，而仅仅处理异步的消息。不再使用屏障后，需要撤销屏障，不然就再也执行不到普通消息了。</p>
<p>为什么需要这样？它是设计来为了让某些特殊的消息得以更快被执行的机制。比如绘制界面，这种消息可能会明显的被用户感知到，稍有不慎就会引起卡顿、掉帧之类的，所以需要及时处理（可能消息队列中有大量的消息，如果像平时一样挨个进行处理，那绘制界面这个消息就得等很久，这是不想看到的）。</p>
<p>屏障消息仅仅是起一个屏障的作用，本身一般不附带其他东西，它需要配合其他Handler组件才能发挥作用。  </p>
<p>1、Handler问题三连：是什么？有什么用？为什么要用，不用行不行？</p>
<p>2、Android UI更新机制(GUI) 为何设计成了单线程的？</p>
<p>3、真的只能在主(UI)线程中更新UI吗？</p>
<p>4、真的不能在主(UI)线程中执行网络操作吗？</p>
<p>6、为什么建议使用Message.obtain()来创建Message实例？</p>
<p>7、为什么子线程中不可以直接new Handler()而主线程中可以？</p>
<p>8、主线程给子线程的Handler发送消息怎么写？</p>
<p>9、HandlerThread实现的核心原理？</p>
<p>10、当你用Handler发送一个Message，发生了什么？</p>
<p>11、Looper是怎么拣队列里的消息的？</p>
<p>12、分发给Handler的消息是怎么处理的？</p>
<p>14、Looper在主线程中死循环，为啥不会ANR？</p>
<p>15、Handler泄露的原因及正确写法</p>
<p>16、Handler中的同步屏障机制</p>
<p>17、Android 11 Handler相关变更</p>
<p><a href="https://juejin.cn/post/6844904150140977165">https://juejin.cn/post/6844904150140977165</a></p>
<p>handler post和handleMesage区别</p>
<p>​    <strong>post的runnable会直接在callback中调用run方法执行，而sendMessage方法要用户主动重写mCallback或者handleMessage方法来处理</strong></p>
<hr>
<p><img src="/2017/08/21/Handler/handler/2021-07-31_4.42_hanlder_qustion.png"></p>
<p><a href="https://www.bilibili.com/video/BV1A7411M7zQ?from=search&amp;seid=14693797999095810218">https://www.bilibili.com/video/BV1A7411M7zQ?from=search&amp;seid=14693797999095810218</a></p>
<p><a href="https://juejin.im/post/6844904150140977165">https://juejin.im/post/6844904150140977165</a></p>
<p><a href="http://blog.csdn.net/guolin_blog/article/details/9991569">http://blog.csdn.net/guolin_blog/article/details/9991569</a></p>
<p><a href="https://xiaozhuanlan.com/topic/0843791256">https://xiaozhuanlan.com/topic/0843791256</a></p>
<p>glide handler </p>
<p><a href="https://www.bilibili.com/video/BV1FU4y1V7HE">https://www.bilibili.com/video/BV1FU4y1V7HE</a></p>
<p><a href="https://segmentfault.com/a/1190000039809784">https://segmentfault.com/a/1190000039809784</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>INTERVIEW_ANDROID</title>
    <url>/2019/01/15/INTERVIEW-ANDROID/</url>
    <content><![CDATA[<p><a href="https://www.1point3acres.com/bbs/interview/airbnb(%E5%8C%97%E4%BA%AC)%E3%80%81%E5%BF%AB%E6%89%8B%E3%80%81%E5%B0%8F%E7%BA%A2%E4%B9%A6%E3%80%81%E7%8C%BF%E9%A2%98%E5%BA%93%E7%AD%8915%E5%AE%B6%E9%9D%A2%E7%BB%8F-mobile-ios-android-530393.html">大佬面试经验</a></p>
<p><a href="https://interview-q-a-1gdnkgkla15afdbe-1258598664.tcloudbaseapp.com/Android/">https://interview-q-a-1gdnkgkla15afdbe-1258598664.tcloudbaseapp.com/Android/</a></p>
<h3 id="Android基础知识点"><a href="#Android基础知识点" class="headerlink" title="Android基础知识点"></a>Android基础知识点</h3><h5 id="四大组件是什么"><a href="#四大组件是什么" class="headerlink" title="四大组件是什么"></a>四大组件是什么</h5><p>Activity ,Service ,BroadCastReceiver,ContentProvider</p>
<h4 id="Activity"><a href="#Activity" class="headerlink" title="Activity"></a>Activity</h4><h5 id="Activity各种情况下的生命周期"><a href="#Activity各种情况下的生命周期" class="headerlink" title="Activity各种情况下的生命周期?"></a>Activity各种情况下的生命周期?</h5><ul>
<li><p>先启动A 再跳转B</p>
<p>A_onCreate()-&gt; A_onStart()-&gt;A_onResume-&gt; A_onPause()-&gt; B_onCreate() -&gt; B_onStart() -&gt; B_resume -&gt; A_onSaveInstanceState()-&gt;A_onStop()</p>
</li>
<li><p>弹出Dialog</p>
<p>不调用任何生命周期,所以Activity上有Dialog的时候按Home键时的生命周期,有没有Dialog都一样的。</p>
</li>
<li><p>横竖屏切换的时候，Activity 各种情况下的生命周期</p>
<ol>
<li><p>Activity状态保存于恢复 (什么都不设置)</p>
<p>![](INTERVIEW-ANDROID/Screen Shot 2021-01-24 at 3.37.01 PM.png)</p>
</li>
<li><p>设置<code>android:screenOrientation=&quot;portrait&quot;</code> 不会旋转</p>
</li>
<li><p>Android 8.0 设置<code>android:configChanges=&quot;orientation|keyboardHidden|screenSize&quot;</code> </p>
<p>会发生旋转，生命周期不发生变化，只是会调用 <code>onConfigurationChanged()</code> </p>
<p><a href="https://blog.csdn.net/qq_36713816/article/details/80538467">https://blog.csdn.net/qq_36713816/article/details/80538467</a></p>
</li>
</ol>
</li>
<li><p>前台切换到后台，然后再回到前台，Activity生命周期回调方法。</p>
<p>前台切换到后台: A_onCreate()-&gt; A_onStart()-&gt;A_onResume-&gt; A_onPause()-&gt;A_onSaveInstanceState()-&gt; A_onStop()</p>
<p>再回到前台: A_onRestart() -&gt;A_onStart()-&gt; A_onResume()</p>
</li>
</ul>
<h5 id="Activity之间的通信方式"><a href="#Activity之间的通信方式" class="headerlink" title="Activity之间的通信方式"></a>Activity之间的通信方式</h5><ul>
<li><p>Intent</p>
<p>startActivity()或startActivityForResult(),通过Intent传递信息,需要注意，Intent对携带信息大小有限制。</p>
</li>
</ul>
<ul>
<li><p>BroadcastReceiver</p>
</li>
<li><p>数据存取传递，sharePreference/sql/File</p>
</li>
<li><p>Application 静态变量</p>
</li>
</ul>
<h5 id="Activity的四种启动模式对比"><a href="#Activity的四种启动模式对比" class="headerlink" title="Activity的四种启动模式对比"></a>Activity的四种启动模式对比</h5><ul>
<li><p>Standard </p>
<p>默认启动模式，每次都重新创建一个新的Activity 。</p>
</li>
<li><p>SingleStop</p>
<p>当前Activity如果在栈顶，那么就不会创建新的Activity，会原先调用Activity的onNewIntent()</p>
</li>
<li><p>SingleTask</p>
<p>当前任务栈已经有Activity实例，就不会再创建了，会调用 onNewIntent().</p>
</li>
<li><p>SingleInstance</p>
<p>单一实例模式，整个手机操作系统里面只有一个实例存在。不同的应用去打开这个activity  共享公用的同一个activity。他会运行在自己单独，独立的任务栈里面，并且任务栈里面只有他一个实例存在。应用场景：呼叫来电界面。这种模式的使用情况比较罕见，在Launcher中可能使用。或者你确定你需要使Activity只有一个实例。<br> 可以得出以下结论：<br> \1. 以singleInstance模式启动的Activity具有全局唯一性，即整个系统中只会存在一个这样的实例。<br> \2. 以singleInstance模式启动的Activity在整个系统中是单例的，如果在启动这样的Activiyt时，已经存在了一个实例，那么会把它所在的任务调度到前台，重用这个实例。<br> \3. 以singleInstance模式启动的Activity具有独占性，即它会独自占用一个任务，被他开启的任何activity都会运行在其他任务中。<br> \4. 被singleInstance模式的Activity开启的其他activity，能够在新的任务中启动，但不一定开启新的任务，也可能在已有的一个任务中开启。</p>
<p><a href="https://blog.csdn.net/zivensonice/article/details/51569502">https://blog.csdn.net/zivensonice/article/details/51569502</a></p>
<p><a href="https://ayusch.com/android-launch-modes-explained/">https://ayusch.com/android-launch-modes-explained/</a></p>
<p><a href="https://noteforme.github.io/2021/01/16/Activity/">https://noteforme.github.io/2021/01/16/Activity/</a></p>
</li>
<li><p>为什么 application.startActivity 要设置NEW_TASK</p>
<p>如果Activity是由一个已经启动的Activity发起的，那么把它放在这个已经启动的任务栈是合理的，Application本来没有任务栈，那么就新创建一个放起来.</p>
<p><a href="https://www.wanandroid.com/wenda/show/8697">https://www.wanandroid.com/wenda/show/8697</a></p>
</li>
</ul>
<p>任务栈的底层原理</p>
<h5 id="Android-APK编译打包流程"><a href="#Android-APK编译打包流程" class="headerlink" title="Android APK编译打包流程"></a>Android APK编译打包流程</h5><p><img src="https://camo.githubusercontent.com/9f62ff22761b5a960fc9547be84cd05ddec48fe4b28fbb1bd17877fb88b43ed0/687474703a2f2f75706c6f61642d696d616765732e6a69616e7368752e696f2f75706c6f61645f696d616765732f333938353536332d636462613331396461623332643063372e706e673f696d6167654d6f6772322f6175746f2d6f7269656e742f7374726970253743696d61676556696577322f322f772f31323430"></p>
<ol>
<li>AAPT（Android Asset Packaging  Tools）工具会打包应用中的资源文件，如AndroidManifest.xml、layout布局中的xml等，并将xml文件编译成二进制形式，当然assets文件夹中的文件不会被编译，图片以及raw文件夹中的资源也会保持原有的形态，需要注意的是raw文件夹中的资源也会生成资源ID。AAPT编译完成后会生成R.java文件。</li>
<li>AIDL工会将所有的aidl接口转换为java接口。</li>
<li>所有的Java源代码、R文件、接口都会编译器编译成.class文件。</li>
<li>Dex工具会将上述产生的.class文件以及第三方库和其他class文件转化为dex（Dalvik虚拟机可执行文件）文件，dex文件最终会被打包进APK文件。</li>
<li>apkbuilder会把编译后的资源和其他资源文件同dex文件一起打入APK中。</li>
<li>生成APK文件之后，，需要对其签名才能安装到设备上，平时测试都会使用debug keystore，当发布应用时必须使用release版的keystore对应用进行签名。</li>
<li>如果对APK正式签名，还需要使用zipalign工具对APK进行对齐操作，这样做的好处是当应用运行时能提高速度，但是会相应的增加内存开销。</li>
</ol>
<p><strong>总结：编译 –&gt; DEX –&gt; 打包 –&gt; 签名和对齐</strong></p>
<h5 id="ART虚拟机与Dalvik虚拟机的区别"><a href="#ART虚拟机与Dalvik虚拟机的区别" class="headerlink" title="ART虚拟机与Dalvik虚拟机的区别"></a>ART虚拟机与Dalvik虚拟机的区别</h5><ul>
<li><p>什么是ART？</p>
<p>ART代表Android  Runtime，其处理应用程序执行的方式完全不同于Dalvik，Dalvik是依靠一个Just-In-Time（<strong>JIT）编译器去解释字节码</strong>。开发者编译后的应用代码需要通过一个解释器在用户的设备上运行，这一机制并不高效，但让应用能更容易在不同硬件和架构上运行。ART则完全改变了这套做法，<strong>在应用安装时就预编译字节码到机器语言</strong>，这一机制叫Ahead-Of-Time（AOT）编译。在移除解释代码这一过程后，应用程序执行将更加效率。启动更快。</p>
</li>
<li><p>ART优点：</p>
<ol>
<li>系统性能的显著提升。</li>
<li>应用启动更快、运行更快、体验更流畅、触摸反馈更及时。</li>
<li>更长的电池续航能力</li>
<li>支持更低的硬件。</li>
</ol>
</li>
<li><p>ART缺点</p>
<ol>
<li>更大的存储空间占用，可能会增加10%-20%</li>
<li>更长的应用安装时间</li>
</ol>
</li>
</ul>
<h5 id="LaunchMode应用场景"><a href="#LaunchMode应用场景" class="headerlink" title="LaunchMode应用场景"></a>LaunchMode应用场景</h5><h4 id="Fragmment"><a href="#Fragmment" class="headerlink" title="Fragmment"></a>Fragmment</h4><h5 id="Fragment生命周期管理过程遇到的坑和解决办法"><a href="#Fragment生命周期管理过程遇到的坑和解决办法" class="headerlink" title="Fragment生命周期管理过程遇到的坑和解决办法"></a>Fragment生命周期管理过程遇到的坑和解决办法</h5><h5 id="fragment各种情况下的生命周期-Activity与Fragment之间生命周期比较"><a href="#fragment各种情况下的生命周期-Activity与Fragment之间生命周期比较" class="headerlink" title="fragment各种情况下的生命周期 Activity与Fragment之间生命周期比较"></a>fragment各种情况下的生命周期 Activity与Fragment之间生命周期比较</h5><p>​        <u>onAttach() -&gt; onCreate() -</u>&gt; onCreateView() -&gt; onActivityCreate() -&gt; onStart() -&gt;  onResume() -&gt; onPause() -&gt; onStop() -&gt;      </p>
<p>​        onDestroyView() -&gt; onDestroy() -&gt; onDetach() </p>
<h5 id="Fragment状态保存startActivityForResult是哪个类的方法，在什么情况下使用？"><a href="#Fragment状态保存startActivityForResult是哪个类的方法，在什么情况下使用？" class="headerlink" title="Fragment状态保存startActivityForResult是哪个类的方法，在什么情况下使用？"></a>Fragment状态保存startActivityForResult是哪个类的方法，在什么情况下使用？</h5><ul>
<li><p>Fragment发起</p>
<p> Fragment onActivityResult能接收。Activity onActivityResult能接收,但是requestCode不正确。</p>
</li>
<li><p>Activity发起</p>
<p> Fragment不能接收。 Activity onActivityResult能接收。</p>
</li>
</ul>
<h5 id="fragment之间传递数据的方式？"><a href="#fragment之间传递数据的方式？" class="headerlink" title="fragment之间传递数据的方式？"></a>fragment之间传递数据的方式？</h5><ol>
<li><p>Fragment.setArguments()方法传递bundle</p>
</li>
<li><p>findFragmentById()找到tag,然后直接操作Framgent</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">      ArticleFragment articleFrag = (ArticleFragment)</span><br><span class="line">      getSupportFragmentManager().findFragmentById(R.id.article_fragment);</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">if</span> (articleFrag != <span class="keyword">null</span>) &#123;</span><br><span class="line">          articleFrag.updateArticleView(position);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ArticleFragment newFragment = <span class="keyword">new</span> ArticleFragment();</span><br><span class="line">          Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">          args.putInt(ArticleFragment.ARG_POSITION, position);</span><br><span class="line">          newFragment.setArguments(args);</span><br><span class="line">   </span><br><span class="line">          FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();</span><br><span class="line">          transaction.replace(R.id.fragment_container, newFragment);</span><br><span class="line">          transaction.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">          transaction.commit();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>接口回调</p>
</li>
</ol>
<h4 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h4><h5 id="请描述一下Service-的生命周期"><a href="#请描述一下Service-的生命周期" class="headerlink" title="请描述一下Service 的生命周期"></a>请描述一下Service 的生命周期</h5><ul>
<li>startService()</li>
</ul>
<p>​    启动:  onCreate() - onCommandStart()  - onDestory()</p>
<p>​    继续startService : 只会执行 onCommandStart()      </p>
<ul>
<li>bindService()</li>
</ul>
<p>​    onCreate() -   onBind() - onUnbind()-onDestory()</p>
<h5 id="service和activity怎么进行数据交互？"><a href="#service和activity怎么进行数据交互？" class="headerlink" title="service和activity怎么进行数据交互？"></a>service和activity怎么进行数据交互？</h5><ol>
<li><p>bindService()</p>
<p>Service中定义接口，ServiceConnection中获取Service实例，调用响应接口</p>
</li>
<li><p>注册广播传递数据说说ContentProvider、ContentResolver、ContentObserver 之间的关系</p>
<pre><code> 把自己的程序数据提供给其他应用程序调用，提供相关的uri接口,没用过ntentObserver 之间的关系
    把自己的程序数据提供给其他应用程序调用，提供香港的uri接口,没用过
</code></pre>
<p><a href="http://wangbufan.cn/2019/09/17/Service%E5%8F%8AService%E4%B8%8EActivity%E9%80%9A%E4%BF%A1/">http://wangbufan.cn/2019/09/17/Service%E5%8F%8AService%E4%B8%8EActivity%E9%80%9A%E4%BF%A1/</a></p>
</li>
</ol>
<h5 id="请描述一下广播BroadcastReceiver的理解"><a href="#请描述一下广播BroadcastReceiver的理解" class="headerlink" title="请描述一下广播BroadcastReceiver的理解"></a>请描述一下广播BroadcastReceiver的理解</h5><ul>
<li> 广播是可以作为应用全局监听器，可以实现应用中不同组件少量数据的通信！！！，更深研究后可以多说点.</li>
</ul>
<p>  基于消息的发布/订阅事件模型.</p>
<ul>
<li><p>广播的分类</p>
<ol>
<li><p>无序广播</p>
</li>
<li><p>有序广播</p>
<p><strong>接收者按照优先级顺序</strong>接收,每个接收者都<strong>有权终止广播</strong>,下一个就得不到.</p>
</li>
</ol>
</li>
<li><p>广播使用的方式和场景</p>
<p>app全局监听</p>
<p>binder机制 <a href="https://www.jianshu.com/p/5a983578418e">https://www.jianshu.com/p/5a983578418e</a></p>
<h5 id="BroadcastReceiver，LocalBroadcastReceiver-本地广播-区别"><a href="#BroadcastReceiver，LocalBroadcastReceiver-本地广播-区别" class="headerlink" title="BroadcastReceiver，LocalBroadcastReceiver(本地广播) 区别"></a>BroadcastReceiver，LocalBroadcastReceiver(本地广播) 区别</h5><p>BroadcastReceiver：针对应用间，系统和应用间通信。</p>
<p>LocalBroadcastReceiver： 只有自己应用内部才能收到,效率更高.</p>
</li>
</ul>
<h4 id="Dialog"><a href="#Dialog" class="headerlink" title="Dialog"></a>Dialog</h4><h5 id="AlertDialog-popupWindow-Toast区别-？"><a href="#AlertDialog-popupWindow-Toast区别-？" class="headerlink" title="AlertDialog,popupWindow,Toast区别 ？"></a>AlertDialog,popupWindow,Toast区别 ？</h5><p>Android是不允许Activity或Dialog凭空出现的,而Dialog则必须在一个Activity上面弹出</p>
<ul>
<li><p>AlertDialog </p>
<p>   拦截了屏幕上所有的TouchK/key</p>
</li>
<li><p>PopupWindow </p>
<p>  仅仅拦截自身区域touch/key</p>
<p>  需要Activity类型的Context启动</p>
</li>
<li><p>Toast</p>
<p>  可以研究下 两者最根本的区别在于有没有新建一个 window，PopupWindow 没有新建，而是通过 WMS 将 View 加到 DecorView；Dialog 是新建了一个 window (PhoneWindow)，相当于走了一遍 Activity 中创建 window 的流程</p>
<p>  <a href="https://www.jianshu.com/p/aed496937bd2">https://www.jianshu.com/p/aed496937bd2</a></p>
</li>
</ul>
<h5 id="Application-和-Activity-的-Context-对象的区别"><a href="#Application-和-Activity-的-Context-对象的区别" class="headerlink" title="Application 和 Activity 的 Context 对象的区别"></a>Application 和 Activity 的 Context 对象的区别</h5><p>ApplicatioContext ：</p>
<p>​    应用生命周期一样长,长生命周期对象就用ApplicationContext</p>
<p>Activity的Context：</p>
<p>​     当前Activity的生命周期,和UI相关的都用Activity为Context来处理</p>
<p><a href="https://www.jianshu.com/p/e215c90a460e">https://www.jianshu.com/p/e215c90a460e</a></p>
<h5 id="Context的理解？"><a href="#Context的理解？" class="headerlink" title="Context的理解？"></a>Context的理解？</h5><p>​    Context是维持Android程序中各组件能够正常工作的一个核心功能类</p>
<h4 id="Anim"><a href="#Anim" class="headerlink" title="Anim"></a>Anim</h4><h5 id="Android属性动画特性"><a href="#Android属性动画特性" class="headerlink" title="Android属性动画特性"></a>Android属性动画特性</h5><p>Android动画框架实现原理</p>
<p>可以改变对象的属性。还需要说说什么吗?</p>
<h5 id="如何导入外部数据库"><a href="#如何导入外部数据库" class="headerlink" title="如何导入外部数据库?"></a>如何导入外部数据库?</h5><p>把数据库文件防盗asserts目录下，然后写入databases目录下面, 然后通过数据库容器装载里面数据库里面的数据。</p>
<p><a href="https://blog.csdn.net/chaoyu168/article/details/50467913">https://blog.csdn.net/chaoyu168/article/details/50467913</a></p>
<h5 id="插值器-估值器区别"><a href="#插值器-估值器区别" class="headerlink" title="插值器 估值器区别"></a>插值器 估值器区别</h5><p>​     插值器: （<code>Interpolator</code>）决定 值 的变化模式（匀速、加速）</p>
<p>​     估值器 :     (<code>TypeEvaluator</code>)决定 值 的具体变化数值</p>
<h5 id="谈谈对接口与回调的理解"><a href="#谈谈对接口与回调的理解" class="headerlink" title="谈谈对接口与回调的理解"></a>谈谈对接口与回调的理解</h5><ul>
<li><p>理解: A发送消息给B,B处理完后高速A处理结果.</p>
</li>
<li><p>实现: 一般而言，处理消息的类是唯一的，发送消息的类却是各种各样的，将回调方法做成一个接口，不同的发送者实现该接口，并且把自己的接口实现类的对象在发送消息时，传递给消息处理者。</p>
</li>
</ul>
<p>注册之后不马上执行，而是某个时机再触发执行。</p>
<h5 id="回调的原理-写一个回调demo"><a href="#回调的原理-写一个回调demo" class="headerlink" title="回调的原理 写一个回调demo"></a>回调的原理 写一个回调demo</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ProcessClick process = <span class="keyword">new</span> ProcessClick(<span class="keyword">new</span> OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;已经点击&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        process.click();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">OnClickListener</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span>  <span class="title">onClick</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span>  <span class="title">ProcessClick</span> </span>&#123;</span><br><span class="line">    OnClickListener listener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProcessClick</span><span class="params">(OnClickListener listener)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.listener = listener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">click</span><span class="params">()</span></span>&#123;</span><br><span class="line">        listener.onClick();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://developer.aliyun.com/article/614769">https://developer.aliyun.com/article/614769</a></p>
<h4 id="VIEW相关"><a href="#VIEW相关" class="headerlink" title="VIEW相关"></a>VIEW相关</h4><h5 id="如何优化自定义View"><a href="#如何优化自定义View" class="headerlink" title="如何优化自定义View"></a>如何优化自定义View</h5><h5 id="android-view绘制机制和加载过程，请详细说下整个流程"><a href="#android-view绘制机制和加载过程，请详细说下整个流程" class="headerlink" title="android view绘制机制和加载过程，请详细说下整个流程"></a>android view绘制机制和加载过程，请详细说下整个流程</h5><p>每个Activity包含一个Window对象，Android中window对象由PhoneWindow实现，PhoneWindow将一个DecorView设置为整个应用窗口的根View,DecorView作为窗口界面的顶层视图，封装了窗口操作的通用方法，DecorView将要显示的具体内容显示在PhoneWindow上，这里所有的View监听事件通过WindowMangerService来接收,通过Activity对象来回调相应的onCLicklistener.显示是将屏幕分成两部分，一个TitleView，另一个是ContentView.</p>
<p> Measure</p>
<p>如果是原始的 View,通过measure方法就完成了测量过程,如果是ViewGroup,除了完成自己的测量外，还需要遍历所有的子View,各个子元素再去递归执行这个流程.</p>
<p>Layout </p>
<p>Draw</p>
<h5 id="MeasureSpeck的意义，怎么计算MeasureSpec"><a href="#MeasureSpeck的意义，怎么计算MeasureSpec" class="headerlink" title="MeasureSpeck的意义，怎么计算MeasureSpec"></a>MeasureSpeck的意义，怎么计算MeasureSpec</h5><h5 id="wrap-content-和MATCH-PARENT的测量方式"><a href="#wrap-content-和MATCH-PARENT的测量方式" class="headerlink" title="wrap content 和MATCH_PARENT的测量方式"></a>wrap content 和MATCH_PARENT的测量方式</h5><p>WRAP_CONTENT : 最大模式，大小不定，但是不能超过窗口的大小. specMode是AT_MOST模式,这种模式下，它的宽，高等于specSize,                                 这种情况下specSize是parentSize,而parentSize是父容器目前可以使用的大小,也就是父容器剩余的空间大小.</p>
<p>MATCH_PARENT: 精确模式，大小就是窗口大小.</p>
<p><a href="https://noteforme.github.io/2017/11/12/View_OVER/">https://noteforme.github.io/2017/11/12/View_OVER/</a></p>
<h5 id="LayoutParams是是什么"><a href="#LayoutParams是是什么" class="headerlink" title="LayoutParams是是什么"></a>LayoutParams是是什么</h5><h5 id="介绍下SurfaceView"><a href="#介绍下SurfaceView" class="headerlink" title="介绍下SurfaceView"></a>介绍下SurfaceView</h5><ul>
<li><p>SurfaceView使用双缓冲技术缓解，页面绘制频繁引起的卡顿。</p>
</li>
<li><p>SurfaceView可以在子线程更新 UI,不会阻塞主线程，提高响应速度。</p>
<p><a href="https://noteforme.github.io/2019/11/05/SurfaceView/">https://noteforme.github.io/2019/11/05/SurfaceView/</a></p>
<p>SurfaceView在更新视图时用到了两张 Canvas，可以先创建一个临时的Canvas对象，将图像都绘制到这个临时的Canvas对象中，绘制完成之后再将这个临时Canvas对象中的内容(也就是一个Bitmap)，通过drawBitmap()方法绘制到onDraw()方法中的canvas对象中。</p>
</li>
</ul>
<h5 id="RecycleView的使用"><a href="#RecycleView的使用" class="headerlink" title="RecycleView的使用"></a>RecycleView的使用</h5><p>​    <a href="https://noteforme.github.io/2017/07/17/RecyclerView/">https://noteforme.github.io/2017/07/17/RecyclerView/</a></p>
<h5 id="webview安全问题"><a href="#webview安全问题" class="headerlink" title="webview安全问题"></a>webview安全问题</h5><p>WebView漏洞的根源在于强制其访问攻击者控制的网页。网页中含有攻击者可以控制的JS,因此可能钓鱼，窃取私有文件，甚至是 RCE,带来比较大的危害。</p>
<p>下面主要是4.4系统以上的机型</p>
<h5 id="Webview密码明文存储漏洞"><a href="#Webview密码明文存储漏洞" class="headerlink" title="Webview密码明文存储漏洞"></a>Webview密码明文存储漏洞</h5><p>WebView默认开启密码保存功能mWebView.setSavePassword(true),如果未关闭，用户输入密码时，会弹出提示框，询问用户是否保存密码，如果选是，密码会明文保存到 /data/data/com.package.name/databases/webview.db</p>
<h5 id="WebView域控制不严格漏洞"><a href="#WebView域控制不严格漏洞" class="headerlink" title="WebView域控制不严格漏洞"></a>WebView域控制不严格漏洞</h5><p>setAllowFileAccess(true) : 窃取APP任意目录下的私有文件</p>
<p>​    setAllowUniversalAccessFromFileURLs : 允许通过file域url中的 javascript访问其他的源。</p>
<p><a href="https://noteforme.github.io/2017/09/01/WebView/">https://noteforme.github.io/2017/09/01/WebView/</a></p>
<h5 id="webview内存泄漏-Leakcanary-验证"><a href="#webview内存泄漏-Leakcanary-验证" class="headerlink" title="webview内存泄漏 Leakcanary 验证?"></a>webview内存泄漏 Leakcanary 验证?</h5><p>​    android 5.0以下有内存泄漏问题</p>
<p><a href="https://juejin.cn/post/6901487965562732551">https://juejin.cn/post/6901487965562732551</a></p>
<p>viewstub延迟加载原理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="comment">// 设置 ViewStub 不进行绘制</span></span><br><span class="line">     setWillNotDraw(<span class="keyword">true</span>);</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">replaceSelfWithView</span><span class="params">(View view, ViewGroup parent)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> index = parent.indexOfChild(<span class="keyword">this</span>);</span><br><span class="line">    <span class="comment">// 把 ViewStub 从控件层级中移除。</span></span><br><span class="line">    parent.removeViewInLayout(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把新创建的 View 对象加入控件层级结构中，并且位于 ViewStub 的位置，</span></span><br><span class="line">    <span class="comment">// 并且在这个过程中，会使用 ViewStub 的布局参数，例如宽高等。</span></span><br><span class="line">    <span class="keyword">final</span> ViewGroup.LayoutParams layoutParams = getLayoutParams();</span><br><span class="line">    <span class="keyword">if</span> (layoutParams != <span class="keyword">null</span>) &#123;</span><br><span class="line">        parent.addView(view, index, layoutParams);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        parent.addView(view, index);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    <a href="https://juejin.cn/post/6844903799337779214">https://juejin.cn/post/6844903799337779214</a></p>
<h5 id="overdraw过度绘制优化方法"><a href="#overdraw过度绘制优化方法" class="headerlink" title="overdraw过度绘制优化方法"></a>overdraw过度绘制优化方法</h5><p>​    移除默认和不必要背景</p>
<p>​    <a href="https://jaeger.itscoder.com/android/2016/09/29/android-performance-overdraw.html">https://jaeger.itscoder.com/android/2016/09/29/android-performance-overdraw.html</a></p>
<p>​    <a href="https://www.jianshu.com/p/9e095bacf44a">https://www.jianshu.com/p/9e095bacf44a</a></p>
<ul>
<li>View刷新机制</li>
<li>View绘制流程</li>
<li>自定义控件原理</li>
<li>如何取消AsyncTask？</li>
<li>为什么不能在子线程更新UI？</li>
<li>Requestlayout，onlayout，onDraw，DrawChild区别与联系</li>
<li>invalidate和postInvalidate的区别及使用</li>
<li>Activity-Window-View三者的差别</li>
<li>自定义View如何考虑机型适配</li>
<li>自定义View的事件</li>
<li>封装View的时候怎么知道view的大小</li>
</ul>
<h4 id="事件分发机制"><a href="#事件分发机制" class="headerlink" title="事件分发机制"></a>事件分发机制</h4><p>是否解决过事件冲突问题，怎么解决的。</p>
<p>问题: <a href="https://juejin.cn/post/6922300686638153736">https://juejin.cn/post/6922300686638153736</a></p>
<p><a href="https://noteforme.github.io/categories/VIEW/">https://noteforme.github.io/categories/VIEW/</a></p>
<p><a href="https://www.bilibili.com/video/BV1754y1H7jT">https://www.bilibili.com/video/BV1754y1H7jT</a></p>
<p>请描述一下View事件传递分发机制</p>
<ul>
<li>Touch事件传递流程</li>
<li>事件分发中的onTouch 和onTouchEvent 有什么区别，又该如何使用？</li>
<li>View和ViewGroup分别有哪些事件分发相关的回调方法</li>
</ul>
<h4 id="我的面试问题"><a href="#我的面试问题" class="headerlink" title="我的面试问题"></a>我的面试问题</h4><h5 id="activity被销毁后重建，怎么获取fragment"><a href="#activity被销毁后重建，怎么获取fragment" class="headerlink" title="activity被销毁后重建，怎么获取fragment"></a>activity被销毁后重建，怎么获取fragment</h5><p>​    findFragmentByTag</p>
<p>​    <a href="https://www.wanandroid.com/wenda/show/11077">https://www.wanandroid.com/wenda/show/11077</a></p>
<h5 id="activity和service通信"><a href="#activity和service通信" class="headerlink" title="activity和service通信"></a>activity和service通信</h5><ol>
<li><p>通过bindService</p>
</li>
<li><p>通过广播</p>
<p><a href="https://www.jianshu.com/p/6040dfa83594">https://www.jianshu.com/p/6040dfa83594</a></p>
</li>
</ol>
<h5 id="activity销毁线程会不会消失"><a href="#activity销毁线程会不会消失" class="headerlink" title="activity销毁线程会不会消失"></a>activity销毁线程会不会消失</h5><p>不会,  可以这样处理</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 静态内部类将不会再隐式的持有外部类的引用，所以在配置改变时，你的Activity的实例在也不会</span></span><br><span class="line"><span class="comment">  * 出现内存泄露</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">boolean</span> mRunning = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     mRunning = <span class="keyword">true</span>;</span><br><span class="line">     <span class="keyword">while</span> (mRunning) &#123;</span><br><span class="line">       SystemClock.sleep(<span class="number">1000</span>);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     mRunning = <span class="keyword">false</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h5 id="activity每个方法处理的区别"><a href="#activity每个方法处理的区别" class="headerlink" title="activity每个方法处理的区别"></a>activity每个方法处理的区别</h5><ol>
<li><p>onCreate():  Activity创建的时候调用，绑定数据。</p>
</li>
<li><p>onStart() : 当Activity对用户变得可见的时候调用.</p>
</li>
<li><p>onResume() : activity开始和用户交互的时候调用，这时候activity处于栈顶，伴随着用户的输入.</p>
</li>
<li><p>onPause() : 当activity失去前台状态，开始进入stopped/hidden or destroyed状态，不能再获取焦点，此时activity对用户可见，但是更新的UI的操作要快。</p>
</li>
<li><p>onStop()  :  当activity不再可见，可能是新的activity来到栈顶，或者当前activity正在被destroy.</p>
</li>
<li><p>onDestory(): 当前activity正在离开。</p>
</li>
</ol>
<h5 id="activity-fragment传递数据方式"><a href="#activity-fragment传递数据方式" class="headerlink" title="activity fragment传递数据方式"></a>activity fragment传递数据方式</h5><ul>
<li><p> ViewModel</p>
</li>
<li><p>onTach() 回调</p>
</li>
</ul>
<h5 id="单例模式怎么理解的"><a href="#单例模式怎么理解的" class="headerlink" title="单例模式怎么理解的"></a>单例模式怎么理解的</h5><p>  创建唯一的对象 </p>
<ul>
<li>res/raw和assets 三者目录下的文件在打包后原封不动的保存在apk包中，不会被编译成二进制。</li>
<li>Res/raw文件会被映射到R.java文件中，访问的时候直接使用资源 R.id.filename;</li>
<li>res/raw不可以有目录结构，而asserts则可以有目录结构，也就是asserts目录下可以建立文件夹.</li>
</ul>
<p><a href="https://www.jianshu.com/p/4c8bcb8c3717">https://www.jianshu.com/p/4c8bcb8c3717</a></p>
<h5 id="截获通知"><a href="#截获通知" class="headerlink" title="截获通知"></a>截获通知</h5><p>新建一个服务MessageNotificationService实现 NotificationListenerService</p>
<h5 id="final特性"><a href="#final特性" class="headerlink" title="final特性"></a>final特性</h5><ol>
<li>final类不能被继承，没有子类</li>
<li>方法不能被子类的方法重写，但可以被继承</li>
<li>表示常量，只能被赋值一次，赋值后不再改变。</li>
</ol>
<h5 id="android多线程怎么处理的-，两个子线程间怎么通讯"><a href="#android多线程怎么处理的-，两个子线程间怎么通讯" class="headerlink" title="android多线程怎么处理的 ，两个子线程间怎么通讯"></a>android多线程怎么处理的 ，两个子线程间怎么通讯</h5><p>​    Android主线程和子线程之间的通信是通过消息循环机制，主线程中的handler把子线程的 message发送给主线程的Looper，那么子线程是如何通信的， 可以把looper绑定到子线程中，调用Looper.prepare()为改子线程生成Looper,然后调用Looper.loop()启动消息队列，并且在该子线程中创建一个Handler,在另一个子线程调用handler发送消息。这样实现通信.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> threadA = ThreadA()</span><br><span class="line"><span class="keyword">val</span> threadB = ThreadB()</span><br><span class="line">Thread(threadA).start()</span><br><span class="line"><span class="keyword">if</span> (threadA.getHandler() == <span class="literal">null</span>) &#123;</span><br><span class="line">    Thread.sleep(<span class="number">1000</span>)</span><br><span class="line">    handler = threadA.getHandler()</span><br><span class="line">&#125;</span><br><span class="line">Thread(threadB).start()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> : <span class="type">Runnable &#123;</span></span></span><br><span class="line">        <span class="keyword">var</span> mHandler: Handler? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getHandler</span><span class="params">()</span></span>: Handler? &#123;</span><br><span class="line">            <span class="keyword">return</span> mHandler</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">            Looper.prepare()</span><br><span class="line">            mHandler = <span class="keyword">object</span> : Handler(Looper.myLooper()!!) &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">handleMessage</span><span class="params">(msg: <span class="type">Message</span>)</span></span> &#123;</span><br><span class="line">                    <span class="keyword">super</span>.handleMessage(msg)</span><br><span class="line">                    Timber.d(<span class="string">&quot;线程A: 线程B发过来消息了-- <span class="subst">$&#123;msg.obj&#125;</span> &quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Looper.loop()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> : <span class="type">Runnable &#123;</span></span></span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">run</span><span class="params">()</span></span> &#123;</span><br><span class="line">            <span class="keyword">val</span> message = Message.obtain()</span><br><span class="line">            message.what = <span class="number">1</span></span><br><span class="line">            message.obj = <span class="string">&quot;线程B 发送消息&quot;</span> + System.currentTimeMillis()</span><br><span class="line">            handler?.sendMessage(message)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/pbm863521/article/details/103493708">https://blog.csdn.net/pbm863521/article/details/103493708</a></p>
<h5 id="防止应用被被杀死-怎么保证service不被杀死"><a href="#防止应用被被杀死-怎么保证service不被杀死" class="headerlink" title="防止应用被被杀死,怎么保证service不被杀死"></a>防止应用被被杀死,怎么保证service不被杀死</h5><p><a href="http://www.52im.net/thread-2881-1-1.html">http://www.52im.net/thread-2881-1-1.html</a></p>
<p><a href="http://www.52im.net/thread-2893-1-1.html">http://www.52im.net/thread-2893-1-1.html</a></p>
<h5 id="怎么让线程有序"><a href="#怎么让线程有序" class="headerlink" title="怎么让线程有序"></a>怎么让线程有序</h5><h5 id="两个线程，想让来的一个插队怎么弄"><a href="#两个线程，想让来的一个插队怎么弄" class="headerlink" title="两个线程，想让来的一个插队怎么弄"></a>两个线程，想让来的一个插队怎么弄</h5><p>​    Join</p>
<p>批量网络请求</p>
<p>子线程创建Handler</p>
<p>context对象互相引用，对象回收 Android界面怎么回收的 生命周期 </p>
<p>内存溢出和内存泄露的区别，oom是怎么处理的 ， ANR怎么避免</p>
<p>java内存回收机制 android管理机制 怎么处理内存泄露</p>
<p>怎么做性能优化</p>
<p>反射机制</p>
<p>broadcastReciever和 handler区别</p>
<p>后台图片更改，前台怎么处理</p>
<p>图片加载库,图片加载方法</p>
<p>图片加载框架怎么处理oom问题</p>
<p>java Android加载机制</p>
<p>Android加载动态库</p>
<p>AndroidManifest权限是怎么获取的，封装权限管理，为什么需要权限分组.</p>
<p>listview图片 缓存，listview怎么优化</p>
<p>viewpager listview处理滑动冲突 </p>
<p>list遍历删除</p>
<p>fragment tag</p>
<p>sercice ALDL (后面再弄)</p>
<p>Hashmap实现原理  实现有序</p>
<p>android事件分发机制，请详细说下整个流程</p>
<p>android四大组件的加载过程</p>
<p>提高sqlite的查询效率</p>
<p>冒泡排序，插入排序 </p>
<h3 id="Android源码相关分析"><a href="#Android源码相关分析" class="headerlink" title="Android源码相关分析"></a>Android源码相关分析</h3><h5 id="Handler机制和底层实现"><a href="#Handler机制和底层实现" class="headerlink" title="Handler机制和底层实现"></a>Handler机制和底层实现</h5><p>​    <a href="https://noteforme.github.io/2017/08/21/Handler/">https://noteforme.github.io/2017/08/21/Handler/</a></p>
<h5 id="RecycleView"><a href="#RecycleView" class="headerlink" title="RecycleView"></a>RecycleView</h5><p>​    <a href="https://noteforme.github.io/2017/07/17/RecyclerView/">https://noteforme.github.io/2017/07/17/RecyclerView/</a></p>
<h5 id="Binder通信原理与机制"><a href="#Binder通信原理与机制" class="headerlink" title="Binder通信原理与机制"></a>Binder通信原理与机制</h5><p><a href="https://blog.csdn.net/Android_SE/article/details/103898581">https://blog.csdn.net/Android_SE/article/details/103898581</a></p>
<p><a href="https://www.bilibili.com/video/BV1Ko4y117Ca?p=74">https://www.bilibili.com/video/BV1Ko4y117Ca?p=74</a></p>
<h5 id="JetPack"><a href="#JetPack" class="headerlink" title="JetPack"></a>JetPack</h5><p><a href="https://noteforme.github.io/categories/Jetpack/">https://noteforme.github.io/categories/Jetpack/</a></p>
<ul>
<li><p>Android各个版本API的区别</p>
</li>
<li><p>描述一次网络请求的流程</p>
</li>
<li><p>Bitmap对象的理解</p>
</li>
<li><p>ActivityThread，AMS，WMS的工作原理</p>
</li>
<li><p>SpareArray原理</p>
</li>
<li><p>AndroidService与Activity之间通信的几种方式</p>
</li>
<li><p>IntentService原理及作用是什么？</p>
</li>
<li><p>说说Activity、Intent、Service 是什么关系</p>
</li>
<li><p>ApplicationContext和ActivityContext的区别</p>
</li>
<li><p>SP是进程同步的吗?有什么方法做到同步？</p>
</li>
<li><p>谈谈多线程在Android中的使用</p>
</li>
<li><p>进程和 Application 的生命周期</p>
</li>
<li><p>AsyncTask机制</p>
</li>
<li><p>AsyncTask原理及不足</p>
</li>
<li><p>AndroidManifest的作用与理解</p>
</li>
</ul>
<h3 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h3><p><a href="https://noteforme.github.io/2017/08/16/PerformancePatterns/">https://noteforme.github.io/2017/08/16/PerformancePatterns/</a></p>
<p><a href="https://noteforme.github.io/2018/02/09/LeakMemory/">https://noteforme.github.io/2018/02/09/LeakMemory/</a></p>
<ul>
<li>ANR产生的原因是什么？</li>
<li>ANR定位和修正</li>
<li>oom是什么？</li>
<li>什么情况导致oom？</li>
<li>有什么解决方法可以避免OOM？</li>
<li>Oom 是否可以try catch？为什么？</li>
<li>内存泄漏是什么？</li>
<li>什么情况导致内存泄漏？</li>
<li>如何防止线程的内存泄漏？</li>
<li>内存泄露场的解决方法</li>
<li>内存泄漏和内存溢出区别？</li>
<li>LruCache默认缓存大小</li>
<li>如何通过广播拦截和abort一条短信？</li>
<li>广播引起anr的时间限制是多少？</li>
<li>计算一个view的嵌套层级</li>
<li>Activity栈</li>
<li>Android线程有没有上限？</li>
<li>线程池有没有上限？</li>
<li>Android为什么引入Parcelable？</li>
<li>有没有尝试简化Parcelable的使用？</li>
</ul>
<p>（四）开发中常见的一些问题</p>
<ul>
<li><p>屏幕适配的处理技巧都有哪些?</p>
</li>
<li><p>服务器只提供数据接收接口，在多线程或多进程条件下，如何保证数据的有序到达？</p>
</li>
<li><p>动态布局的理解</p>
</li>
<li><p>怎么去除重复代码？</p>
</li>
<li><p>画出 Android 的大体架构图</p>
</li>
<li><p>Recycleview和ListView的区别</p>
</li>
<li><p>ListView图片加载错乱的原理和解决方案</p>
</li>
<li><p>动态权限适配方案，权限组的概念</p>
</li>
<li><p>Android系统为什么会设计ContentProvider？</p>
</li>
<li><p>下拉状态栏是不是影响activity的生命周期</p>
</li>
<li><p>如果在onStop的时候做了网络请求，onResume的时候怎么恢复？</p>
</li>
<li><p>Bitmap 使用时候注意什么？</p>
</li>
<li><p>Bitmap的recycler()</p>
</li>
<li><p>ViewPager使用细节，如何设置成每次只初始化当前的Fragment，其他的不初始化？</p>
</li>
<li><p>点击事件被拦截，但是想传到下面的View，如何操作？</p>
</li>
<li><p>微信上消息小红点的原理</p>
</li>
<li><p>CAS介绍（这是阿里巴巴的面试题，我不是很了解，可以参考博客: <a href="http://blog.csdn.net/jly4758/article/details/46673835">CAS简介</a>）</p>
</li>
</ul>
<p><a href="https://github.com/android-exchange/Android-Interview">https://github.com/android-exchange/Android-Interview</a></p>
<p>Kotin面试题</p>
<p><a href="http://www.youkmi.cn/2019/10/27/kotlin-ti-mu-zheng-li/">http://www.youkmi.cn/2019/10/27/kotlin-ti-mu-zheng-li/</a></p>
<p><a href="https://www.jianshu.com/p/45866c8415c8">https://www.jianshu.com/p/45866c8415c8</a></p>
<p>怎么看源码 </p>
<p><a href="https://www.bilibili.com/video/BV1d54y1h768">https://www.bilibili.com/video/BV1d54y1h768</a></p>
<p>面经</p>
<p><a href="https://blog.csdn.net/sjy0118/article/details/112759112">https://blog.csdn.net/sjy0118/article/details/112759112</a></p>
<p><a href="https://www.kaelli.com/43.html">https://www.kaelli.com/43.html</a></p>
<p><a href="https://www.jianshu.com/p/058c54948ca5">https://www.jianshu.com/p/058c54948ca5</a></p>
<p><a href="https://juejin.cn/post/6888222422760488974#heading-51">https://juejin.cn/post/6888222422760488974#heading-51</a></p>
<p><a href="https://github.com/Omooo/Android_QA">https://github.com/Omooo/Android_QA</a></p>
]]></content>
      <tags>
        <tag>inter</tag>
      </tags>
  </entry>
  <entry>
    <title>INTERVIEW_CONCURRENCY</title>
    <url>/2018/07/02/INTERVIEW-CONCURRENCY/</url>
    <content><![CDATA[<p><a href="https://noteforme.github.io/tags/concurrency/">https://noteforme.github.io/tags/concurrency/</a></p>
<h3 id="线程基础"><a href="#线程基础" class="headerlink" title="线程基础"></a>线程基础</h3><h5 id="Java线程模型"><a href="#Java线程模型" class="headerlink" title="Java线程模型"></a>Java线程模型</h5><ol>
<li>用户线程与内核级线程</li>
<li>并发与并行</li>
<li>多线程模型</li>
</ol>
<p><a href="https://crazyfzw.github.io/2018/06/19/thred-model/">https://crazyfzw.github.io/2018/06/19/thred-model/</a></p>
<p>谈谈对多线程的理解</p>
<ol>
<li>在Android中一个应用程序就是一个单独的进程，一般来说，当我们运行一个应用，系统就会自动创建一个进程，并且为这个进程创建一个主线程–UI线程，这样就可以运行MainActivity。</li>
<li>线程是操作系统能够进行运算调度的最小单位，线程是进程的子集，线程可以并行的执行不同任务，所有的线程共享同一片内存空间，这就为线程间通信提供了基础，线程有五种状态：创建，就绪，运行，阻塞，死亡。</li>
</ol>
<h5 id="多线程有什么要注意的问题？"><a href="#多线程有什么要注意的问题？" class="headerlink" title="多线程有什么要注意的问题？"></a>多线程有什么要注意的问题？</h5><p>并发问题，安全问题，效率问题。</p>
<p>谈谈你对并发编程的理解并举例说明</p>
<p>谈谈你对多线程同步机制的理解？</p>
<h5 id="进程和线程的区别-协程呢"><a href="#进程和线程的区别-协程呢" class="headerlink" title="? 进程和线程的区别 协程呢"></a>? 进程和线程的区别 协程呢</h5><ul>
<li>进程  </li>
</ul>
<p>​    是系统给程序分配资源的基本单位，每个进程都有唯一的地址空间，一个程序至少有一个进程，一个进程至少有一个线程.</p>
<ul>
<li><p>线程</p>
<p>线程是执行操作的基本单位，JVM结构中共享 Method Area ,Heap Area</p>
</li>
</ul>
<p>​    <a href="https://blog.csdn.net/mxsgoden/article/details/8821936">https://blog.csdn.net/mxsgoden/article/details/8821936</a></p>
<p>​    <a href="https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html">https://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html</a></p>
<p>进程 : 有很大的独立性</p>
<p>线程 :  所有线程都有完全一样的地址空间,意味着它们也共享同样的全局变量。由于线程可以访问进程地址空间的每一个内存地址，所以一个线程可以读、写甚至清除另一个线程的堆栈。</p>
<p>每个进程中的内容 : 地址空间  全局变量 打开文件 子进程    即将发生的定时器    信号与信号处理程序</p>
<p>每个线程中的内容：程序计数器、寄存器、堆栈、状态.</p>
<p>协程?</p>
<p>​        协程拥有自己的寄存器上下文和栈，协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的    时候，恢复先前保存的寄存器上下文和栈，即所有局部状态的一个特定组合），每次过程重入时，就相当于进入上一次调用的状态，换种说法：进入上一次离开时所处逻辑流的位置。</p>
<p>协程的好处:</p>
<ol>
<li>无需线程上下文切换的开销 </li>
<li>无需原子操作锁定及同步的开销</li>
<li>方便切换控制流，简化编程模型</li>
</ol>
<p>​    为什么要有线程，而不是仅仅用进程？</p>
<h5 id="怎么创建一个线程"><a href="#怎么创建一个线程" class="headerlink" title="怎么创建一个线程"></a>怎么创建一个线程</h5><ol>
<li><p>继承Thread类创建线程类.</p>
</li>
<li><p>通过Runnable接口创建线程类</p>
</li>
<li><p>通过Callable和FutureTask创建线程</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallableThreadTest</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CallableThreadTest ctt = <span class="keyword">new</span> CallableThreadTest();</span><br><span class="line">        FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> FutureTask&lt;&gt;(ctt);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 的循环变量i的值&quot;</span> + i);</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">20</span>) &#123;</span><br><span class="line">                <span class="keyword">new</span> Thread(ft, <span class="string">&quot;有返回值的线程&quot;</span>).start();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;子线程的返回值：&quot;</span> + ft.get());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="线程如何关闭？"><a href="#线程如何关闭？" class="headerlink" title="线程如何关闭？"></a>线程如何关闭？</h5><p>​    最正确的停止线程的方式是使用 interrupt,和条件满足.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (!Thread.currentThread().isInterrupted() &amp;&amp; cout&lt;<span class="number">1000</span>) &#123;</span><br><span class="line">    <span class="keyword">do</span> more work</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="在Java中wait和sleep方法的不同"><a href="#在Java中wait和sleep方法的不同" class="headerlink" title="在Java中wait和sleep方法的不同"></a>在Java中wait和sleep方法的不同</h5><pre><code>1. sleep作用Thread上，wait作用object上
2. sleep不会释放锁
3. sleep可以在任何代码块。wait必须在同步方法，持有锁中运行。
</code></pre>
<p>​    </p>
<p>谈谈wait/notify关键字的理解</p>
<ol>
<li>调用之前持有对象锁</li>
<li>wait ,线程进入 waiting状态，释放对象锁</li>
<li>notify,唤醒处于waiting状态的线程。</li>
</ol>
<p><a href="https://howtodoinjava.com/java/multi-threading/wait-notify-and-notifyall-methods/">https://howtodoinjava.com/java/multi-threading/wait-notify-and-notifyall-methods/</a></p>
<h5 id="如何控制某个方法允许并发访问线程的个数？"><a href="#如何控制某个方法允许并发访问线程的个数？" class="headerlink" title="如何控制某个方法允许并发访问线程的个数？"></a>如何控制某个方法允许并发访问线程的个数？</h5><p>​    信号量</p>
<h5 id="什么导致线程阻塞？"><a href="#什么导致线程阻塞？" class="headerlink" title="什么导致线程阻塞？"></a>什么导致线程阻塞？</h5><ol>
<li> 阻塞指的是暂停一个线程的执行以等待某个条件发生。 Thread.sleep t.join 等待输入</li>
<li>线程执行了一个对象的<code>wait()</code>方法，直接进入阻塞状态，等待其他线程执行<code>notify()</code>或者<code>notifyAll()</code>方法。</li>
</ol>
<h5 id="如何保证线程安全？"><a href="#如何保证线程安全？" class="headerlink" title="如何保证线程安全？"></a>如何保证线程安全？</h5><pre><code>1. 使用线程安全的类。
2. 使用synchronized同步代码块，或者用Lock锁。
</code></pre>
<h5 id="如何实现线程同步？"><a href="#如何实现线程同步？" class="headerlink" title="如何实现线程同步？"></a>如何实现线程同步？</h5><pre><code> 1. Synchronized修饰整个方法或代码块。
 2. Lock
</code></pre>
<h5 id="两个进程同时要求写或者读，能不能实现？如何防止进程的同步？"><a href="#两个进程同时要求写或者读，能不能实现？如何防止进程的同步？" class="headerlink" title="两个进程同时要求写或者读，能不能实现？如何防止进程的同步？"></a>两个进程同时要求写或者读，能不能实现？如何防止进程的同步？</h5><p>​    可以进行同时读写，但为了保证数据的正确，必须要针对进程访问的共享临界区进行处理；两个进程不能同时进入临界区，否则会导致数据错乱。常见的处理方式有：<strong>信号量、管程、会合、分布式系统</strong></p>
<ul>
<li><p><strong>信号量</strong><br> 信号量是一个计数器，它只支持2种操作：P操作（进入临界区）和V操作（退出临界区）。假设有信号量SV，则对它的P、V操作含义如下：<br>   P(SV)，如果SV的值大于0，意味着可以进入临界区，就将它减1；如果SV的值为0，意味着别的进程正在访问临界区，则挂起当前进程的执行；<br>   V(SV)，当前进程退出临界区时，如果有其他进程因为等待SV而挂起，则唤醒之；如果没有，则将SV加1，之后再退出临界区。</p>
</li>
<li><p><strong>管程</strong><br>   提出原因：信号量机制不足，程序编写困难、易出错</p>
<pre><code>   方案：在程序设计语言中引入一种高级维护机制
   定义：是一个特殊的模块；有一个名字；由关于共享资源的数据结构及在其上操作上的一组过程组成。进程只能通过调用管程中的过程间接访问管程中的数据结构
</code></pre>
<p>  1）互斥：管程是互斥进入的 为了保证数据结构的数据完整性<br> 管程的互斥由编译器负责保证的，是一种语言机制<br>  2）同步：设置条件变量及等待唤醒操作以解决同步问题<br> 可以让一个进程或者线程在条件变量上等待（先释放管程的管理权），也可以通过发送信号将等待在条件变量上的进程线程唤醒</p>
</li>
</ul>
<p>  链接：<a href="https://www.jianshu.com/p/72f5017c6649">https://www.jianshu.com/p/72f5017c6649</a></p>
<h5 id="线程间操作List"><a href="#线程间操作List" class="headerlink" title="线程间操作List"></a>线程间操作List</h5><p>​    </p>
<h5 id="怎么中止一个线程，Thread-Interupt一定有效吗？"><a href="#怎么中止一个线程，Thread-Interupt一定有效吗？" class="headerlink" title="怎么中止一个线程，Thread.Interupt一定有效吗？"></a>怎么中止一个线程，Thread.Interupt一定有效吗？</h5><p>不一定 </p>
<p><a href="https://juejin.cn/post/6844903896339447815#heading-6">https://juejin.cn/post/6844903896339447815#heading-6</a></p>
<h3 id="线程安全-锁"><a href="#线程安全-锁" class="headerlink" title="线程安全 锁"></a>线程安全 锁</h3><h5 id="讲一下java中的同步的方法-结果锁一起"><a href="#讲一下java中的同步的方法-结果锁一起" class="headerlink" title="讲一下java中的同步的方法 结果锁一起"></a>讲一下java中的同步的方法 结果锁一起</h5><ol>
<li><p>synchronized  </p>
</li>
<li><p>wait和notify</p>
</li>
<li><p>volatile</p>
<p>  a. volatile关键字为域变量的访问提供了一种免锁机制<br>  b.使用volatile修饰域相当于告诉虚拟机该域可能会被其他线程更新<br>  c.因此每次使用该域就要重新计算，而不是使用寄存器中的值<br>  d.volatile不会提供任何原子操作，它也不能用来修饰final类型的变量 </p>
</li>
</ol>
<h5 id="synchronize的原理"><a href="#synchronize的原理" class="headerlink" title="synchronize的原理"></a>synchronize的原理</h5><blockquote>
<ol>
<li>原子性：确保线程互斥的访问同步代码；</li>
<li>可见性：保证共享变量的修改能够及时可见，其实是通过Java内存模型中的 “<strong>对一个变量unlock操作之前，必须要同步到主内存中；如果对一个变量进行lock操作，则将会清空工作内存中此变量的值，在执行引擎使用此变量前，需要重新从主内存中load操作或assign操作初始化变量值</strong>” 来保证的；</li>
<li>有序性：有效解决重排序问题，即 “一个unlock操作先行发生(happen-before)于后面对同一个锁的lock操作”；</li>
</ol>
</blockquote>
<h5 id="谈谈对Synchronized关键字，类锁，方法锁，重入锁的理解"><a href="#谈谈对Synchronized关键字，类锁，方法锁，重入锁的理解" class="headerlink" title="谈谈对Synchronized关键字，类锁，方法锁，重入锁的理解"></a>谈谈对Synchronized关键字，类锁，方法锁，重入锁的理解</h5><ol>
<li>当synchronized作用于普通方法是，锁对象是this；</li>
<li>当synchronized作用于静态方法是，锁对象是当前类的Class对象；</li>
<li>当synchronized作用于代码块时，锁对象是synchronized(obj)中的这个obj。</li>
</ol>
<h5 id="static-synchronized-方法的多线程访问和作用"><a href="#static-synchronized-方法的多线程访问和作用" class="headerlink" title="static synchronized 方法的多线程访问和作用"></a>static synchronized 方法的多线程访问和作用</h5><p>也就是两个的区别了,也就是synchronized相当于this.synchronized，而static synchronized相当于Something.synchronized，它可以对类的所有对象实例起作用</p>
<h5 id="synchronized与Lock的区别"><a href="#synchronized与Lock的区别" class="headerlink" title="synchronized与Lock的区别"></a>synchronized与Lock的区别</h5><p>Lock支持的功能:</p>
<p>公平锁：Synchronized是非公平锁，ReentrantLock支持公平锁，默认非公平锁</p>
<p>可中断锁：ReentrantLock提供了lockInterruptibly（）的功能，可以中断争夺锁的操作，抢锁的时候会check是否被中断，中断直接抛出异常，退出抢锁。而Synchronized只有抢锁的过程，不可干预，直到抢到锁以后，才可以编码控制锁的释放。</p>
<p>快速反馈锁：ReentrantLock提供了trylock（）  和 trylock（tryTimes）的功能，不等待或者限定时间等待获取锁，更灵活。可以避免死锁的发生。</p>
<p>读写锁：ReentrantReadWriteLock类实现了读写锁的功能，类似于Mysql，锁自身维护一个计数器，读锁可以并发的获取，写锁只能独占。而synchronized全是独占锁</p>
<p>Condition：ReentrantLock提供了比Sync更精准的线程调度工具，Condition，一个lock可以有多个Condition，比如在生产消费的业务下，一个锁通过控制生产Condition和消费Condition精准控制。</p>
<p><a href="https://www.jianshu.com/p/09d5ba4bfb7a">https://www.jianshu.com/p/09d5ba4bfb7a</a></p>
<h5 id="ReentrantLock的内部实现"><a href="#ReentrantLock的内部实现" class="headerlink" title="ReentrantLock的内部实现"></a>ReentrantLock的内部实现</h5><p>显式锁ReentrantLock和同步工具类的实现基础都是AQS (AbstractQueuedSynchronizer).AQS内部有一条双向的队列存放等待线程，节点是Node对象。每个Node维护了线程、前后Node的指针和等待状态等参数。</p>
<p>ReentrantLock是可重入锁，也就是同一个线程可以多次获取锁，每获取一次就会进行一次计数，解锁的时候就会递减这个计数，直到计数变为0。</p>
<p>它有两种实现，一种是公平锁，一种是非公平锁，</p>
<h5 id="lock原理"><a href="#lock原理" class="headerlink" title="lock原理"></a>lock原理</h5><p>整体来看Lock主要是通过两个东西来实现的分别是<strong>CAS和AQS(AbstractQueuedSynchronizer)。</strong>通过加锁和解锁的过程来分析锁的实现。</p>
<p>一、整体概述流程</p>
<ol>
<li><p>读取表示锁状态的变量</p>
</li>
<li><p>如果表示状态的变量的值为0，那么当前线程尝试将变量值设置为1（通过CAS操作完成），当多个线程同时将表示状态的变量值由0设置成1时，仅一个线程能成功，其它线程都会失败。失败后进入队列自旋转并阻塞当前线程。</p>
<p>  2.1 若成功，表示获取了锁，</p>
<blockquote>
<p>2.1.1 如果该线程（或者说节点）已位于在队列中，则将其出列（并将下一个节点则变成了队列的头节点）</p>
</blockquote>
<blockquote>
<p>2.1.2 如果该线程未入列，则不用对队列进行维护</p>
</blockquote>
<blockquote>
<p>2.1.3 然后当前线程从lock方法中返回，对共享资源进行访问。           </p>
</blockquote>
<p>   2.2 若失败，则当前线程将自身放入等待（锁的）队列中并阻塞自身，此时线程一直被阻塞在lock方法中，没有从该方法中返回（被唤醒后仍然在lock方法中，并从下一条语句继续执行，这里又会回到第1步重新开始）。</p>
</li>
<li><p>如果表示状态的变量的值为1，那么将当前线程放入等待队列中，然后将自身阻塞<br> <a href="https://blog.csdn.net/liyantianmin/article/details/54673109">https://blog.csdn.net/liyantianmin/article/details/54673109</a></p>
</li>
</ol>
<h5 id="死锁的四个必要条件？"><a href="#死锁的四个必要条件？" class="headerlink" title="死锁的四个必要条件？"></a>死锁的四个必要条件？</h5><ol>
<li>互斥条件: 指线程对己经获取到的资源进行排它性使用 ，即该资源同时只由 一个线<br>程占用。如果 此时 还有其 他 线程请求获取该资源 ，则 请求者只能等待，直至占有资<br>源 的 线程释放该资源。</li>
<li>请求并持有条件 : 指一个线程己经持有了至少一个资源，但又提出了新的资源请求，<br>而新资源己被其 他 线程占有，所 以 当前线程会被阻塞 ，但 阻塞 的同时 并不释放自 己<br>己经获取的资源。</li>
<li>不可剥夺条件 : 指线程获取到的资源在自己使用完之前不能被其他线程抢占 ， 只有在自己使用完 毕后才 由 自 己释放该资源。</li>
<li>环路等待条件 : 指在发生死锁时 ，必然存在一个线程→资源的环形链 ，即线程集合</li>
</ol>
<h5 id="怎么避免死锁？"><a href="#怎么避免死锁？" class="headerlink" title="怎么避免死锁？"></a>怎么避免死锁？</h5><p>请求并持有和环路等待条件是可 以被破坏.</p>
<h5 id="synchronized是公平锁还是非公平锁-ReteranLock是公平锁吗？是怎么实现的"><a href="#synchronized是公平锁还是非公平锁-ReteranLock是公平锁吗？是怎么实现的" class="headerlink" title="synchronized是公平锁还是非公平锁,ReteranLock是公平锁吗？是怎么实现的"></a>synchronized是公平锁还是非公平锁,ReteranLock是公平锁吗？是怎么实现的</h5><ol>
<li>synchronized只能是非公平锁。</li>
<li>而ReentrantLock可以实现公平锁和非公平锁两种。</li>
<li>公平锁的公平的含义在于如果线程现在拿不到这把锁，那么线程就都会进入等待，开始排队，在等待队列里等待时间长的线程会优先拿到这把锁，有先来先得的意思。而非公平锁就不那么“完美”了，它会在一定情况下，忽略掉已经在排队的线程，发生插队现象</li>
</ol>
<h5 id="synchronized跟ReentranLock有什么区别？"><a href="#synchronized跟ReentranLock有什么区别？" class="headerlink" title="synchronized跟ReentranLock有什么区别？"></a>synchronized跟ReentranLock有什么区别？</h5><p>都是加锁方式同步，而且都是阻塞式的同步，也就是说当如果一个线程获得了对象锁，进入了同步块，其他访问该同步块的线程都必须阻塞在同步块外面等待</p>
<ul>
<li><p>synchronized</p>
<p><strong>自动释放锁</strong>,只有非公平锁。都是可重入的</p>
</li>
<li><p>ReentrantLock</p>
<p> <strong>手动释放锁</strong></p>
</li>
</ul>
<h5 id="对象锁和类锁是否会互相影响？"><a href="#对象锁和类锁是否会互相影响？" class="headerlink" title="对象锁和类锁是否会互相影响？"></a>对象锁和类锁是否会互相影响？</h5><p>不会相互影响</p>
<ul>
<li><p>类锁</p>
<p>在代码中的方法上加了static和synchronized的锁，或者synchronized(xxx.class）的代码段</p>
</li>
<li><p>对象锁</p>
<p>在代码中的方法上加了synchronized的锁，或者synchronized(this）的代码段</p>
</li>
<li><p>私有锁</p>
<p>在类内部声明一个私有属性如private Object lock，在需要加锁的代码段synchronized(lock）</p>
</li>
</ul>
<h5 id="管理线程-提高效率"><a href="#管理线程-提高效率" class="headerlink" title="管理线程 提高效率"></a>管理线程 提高效率</h5><h5 id="volatile的原理"><a href="#volatile的原理" class="headerlink" title="volatile的原理"></a>volatile的原理</h5><p> 有序性.</p>
<p> 可见性 :</p>
<p>　    （1）修改volatile变量时会强制将修改后的值刷新的主内存中。</p>
<p>　　（2）修改volatile变量后会导致其他线程工作内存中对应的变量值失效。因此，再读取该变量值的时候就需要重新从读取主内存中的值。</p>
<p><a href="https://www.cnblogs.com/paddix/p/5428507.html">https://www.cnblogs.com/paddix/p/5428507.html</a></p>
<p><a href="https://www.bilibili.com/video/BV1NT4y1G7WE?p=8">https://www.bilibili.com/video/BV1NT4y1G7WE?p=8</a></p>
<h5 id="synchronized-和volatile-关键字的区别"><a href="#synchronized-和volatile-关键字的区别" class="headerlink" title="synchronized 和volatile 关键字的区别"></a>synchronized 和volatile 关键字的区别</h5><ol>
<li>volatile仅能实现变量的修改可见性，不能保证原子性；而synchronized则可以保证变量的修改可见性和原子性</li>
<li>volatile标记的变量不会被编译器优化；synchronized标记的变量可以被编译器优化.</li>
</ol>
<p>多线程断点续传原理</p>
<p>其实原理很简单，只需要保证每个子任务的下载进度能够被即时地记录即可。这样继续下载时只需要读取这些下载记录，从上次下载结束的位置开始下载即可。</p>
<p><a href="https://juejin.cn/post/6844904013440221198">https://juejin.cn/post/6844904013440221198</a></p>
<h3 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h3><h5 id="JavaAPI线程池有哪些参数"><a href="#JavaAPI线程池有哪些参数" class="headerlink" title="JavaAPI线程池有哪些参数"></a>JavaAPI线程池有哪些参数</h5><p><img src="https://s0.lgstatic.com/i/image2/M01/AD/A3/CgoB5l3eH8mAAoJCAACEOKMHtpw036.png"></p>
<p><img src="https://s0.lgstatic.com/i/image2/M01/AD/A3/CgoB5l3eH-KAAHpkAAC4vEMOXQ4797.png"></p>
<h5 id="为什么要用线程池"><a href="#为什么要用线程池" class="headerlink" title="为什么要用线程池"></a>为什么要用线程池</h5><ol>
<li>降低资源消耗2. 提高响应速度3. 提高线程的可管理性</li>
</ol>
<h5 id="什么是线程池，如何使用"><a href="#什么是线程池，如何使用" class="headerlink" title="什么是线程池，如何使用?"></a>什么是线程池，如何使用?</h5><p>很多小任务让一组线程来执行，而不是一个任务对应一个新线程。这种能接收大量小任务并进行分发处理的就是线程池</p>
<h5 id="什么是核心线程"><a href="#什么是核心线程" class="headerlink" title="什么是核心线程"></a>什么是核心线程</h5><p>​    常驻线程池的线程数量</p>
<h5 id="怎么销毁核心线程"><a href="#怎么销毁核心线程" class="headerlink" title="怎么销毁核心线程"></a>怎么销毁核心线程</h5><p>​    allowCoreThreadTimeOut</p>
<p>​    <a href="https://objcoding.com/2019/04/14/threadpool-some-settings/">https://objcoding.com/2019/04/14/threadpool-some-settings/</a></p>
<h5 id="为什么DCL-DOUBLE-CHECK-LOCK要那么写，直接在方法前加synchronized不行吗"><a href="#为什么DCL-DOUBLE-CHECK-LOCK要那么写，直接在方法前加synchronized不行吗" class="headerlink" title="为什么DCL DOUBLE CHECK LOCK要那么写，直接在方法前加synchronized不行吗"></a>为什么DCL DOUBLE CHECK LOCK要那么写，直接在方法前加synchronized不行吗</h5><p>​    不DCL 这样写，就会创建多个实例</p>
<p>​    synchronized可以，这样粒度太大了.</p>
<p>​    <a href="https://blog.csdn.net/zhaoyajie1011/article/details/106812327">https://blog.csdn.net/zhaoyajie1011/article/details/106812327</a></p>
<h5 id="如何让两个线程循环交替打印"><a href="#如何让两个线程循环交替打印" class="headerlink" title="如何让两个线程循环交替打印"></a>如何让两个线程循环交替打印</h5><p>LockSupport_1A2B.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">char</span>[] aI = <span class="string">&quot;1234567&quot;</span>.toCharArray();</span><br><span class="line">        <span class="keyword">char</span>[] aC = <span class="string">&quot;ABCDEFG&quot;</span>.toCharArray();</span><br><span class="line"></span><br><span class="line">        t1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> c : aI) &#123;</span><br><span class="line">                System.out.print(c);</span><br><span class="line">                LockSupport.unpark(t2);</span><br><span class="line">                LockSupport.park();</span><br><span class="line">            &#125;</span><br><span class="line">            LockSupport.unpark(t2);</span><br><span class="line">        &#125;);</span><br><span class="line">        t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> c : aC) &#123;</span><br><span class="line">                System.out.print(c);</span><br><span class="line">                LockSupport.unpark(t1);</span><br><span class="line">                LockSupport.park();</span><br><span class="line">            &#125;</span><br><span class="line">            LockSupport.unpark(t1);</span><br><span class="line">        &#125;);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line"><span class="comment">//        System.out.println(&quot;t1  &quot; + t1.getState());</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;t2  &quot; + t2.getState());</span></span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br></pre></td></tr></table></figure>



<p>Notify_1A2B.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Notify_1A2B o = <span class="keyword">new</span> Notify_1A2B();</span><br><span class="line"><span class="keyword">char</span>[] aI = <span class="string">&quot;1234567&quot;</span>.toCharArray();</span><br><span class="line"><span class="keyword">char</span>[] aC = <span class="string">&quot;ABCDEFG&quot;</span>.toCharArray();</span><br><span class="line">t1 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (o) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">char</span> c : aI) &#123;</span><br><span class="line">            System.out.print(c);</span><br><span class="line">            o.notify();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                o.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">t2 = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (o) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">char</span> c : aC) &#123;</span><br><span class="line">                System.out.print(c);</span><br><span class="line">                o.notify();</span><br><span class="line">                o.wait();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">t1.start();</span><br><span class="line">t2.start();</span><br><span class="line">t1.join();</span><br><span class="line">t2.join();</span><br></pre></td></tr></table></figure>



<p>协程可以在Java项目中使用吗？</p>
<p>线程池了解多少？拒绝策略有几种,为什么有newSingleThread</p>
<h5 id="跨进程通信了解多少？管道了解吗？"><a href="#跨进程通信了解多少？管道了解吗？" class="headerlink" title="跨进程通信了解多少？管道了解吗？"></a>跨进程通信了解多少？管道了解吗？</h5><pre><code>文件
AIDL （基于 Binder）
    Android 进阶：进程通信之 AIDL 的使用
    Android 进阶：进程通信之 AIDL 解析
Binder
    Android 进阶：进程通信之 Binder 机制浅析
Messenger （基于 Binder）
    Android 进阶：进程通信之 Messenger 使用与解析 
ContentProvider （基于 Binder）
    Android 进阶：进程通信之 ContentProvider 内容提供者 
Socket
    Android 进阶：进程通信之 Socket （顺便回顾 TCP UDP）
</code></pre>
<p><img src="https://img-blog.csdn.net/20170605011532312?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMTI0MDg3Nw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><br>原文链接：<a href="https://blog.csdn.net/u011240877/article/details/72863432">https://blog.csdn.net/u011240877/article/details/72863432</a></p>
<h5 id="底层原理"><a href="#底层原理" class="headerlink" title="底层原理"></a>底层原理</h5><ul>
<li>RXJava怎么切换线程</li>
<li>binder进程间通信可以调用原进程方法吗？</li>
<li>SharedPreference原理？读取xml是在哪个线程?</li>
<li>AQS了解吗？</li>
<li>ConcurrentHashMap，线程安全，为何安全。底层实现是怎么样的。</li>
</ul>
<p><a href="https://www.zhihu.com/question/63859501">https://www.zhihu.com/question/63859501</a></p>
<h5 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h5><p><a href="http://gee.cs.oswego.edu/dl/papers/aqs.pdf">http://gee.cs.oswego.edu/dl/papers/aqs.pdf</a></p>
<p><a href="https://www.bilibili.com/video/BV11Q4y1M7K2?from=search&amp;seid=12598203519866117819">https://www.bilibili.com/video/BV11Q4y1M7K2?from=search&amp;seid=12598203519866117819</a></p>
<p><a href="https://javadoop.com/post/AbstractQueuedSynchronizer">https://javadoop.com/post/AbstractQueuedSynchronizer</a></p>
<p><a href="https://www.bilibili.com/video/BV1yJ411v7er?from=search&amp;seid=12598203519866117819">https://www.bilibili.com/video/BV1yJ411v7er?from=search&amp;seid=12598203519866117819</a></p>
<h5 id="阻塞队列原理"><a href="#阻塞队列原理" class="headerlink" title="阻塞队列原理"></a>阻塞队列原理</h5><p><img src="https://s0.lgstatic.com/i/image3/M01/62/7D/Cgq2xl4le9SAL6enAAGpXZi8Wcg079.jpg"></p>
<p>阻塞功能:阻塞功能使得生产者和消费者两端的能力得以平衡，当有任何一端速度过快时，阻塞队列便会把过快的速度给降下来</p>
<p>是否有界</p>
<ul>
<li> LinkedBlockingQueue 的上限是 Integer.MAX_VALUE，约为 2 的 31 次方,</li>
<li>ArrayBlockingQueue 如果容量满了，也不会扩容，所以一旦满了就无法再往里放数据了。</li>
</ul>
]]></content>
      <tags>
        <tag>inter</tag>
      </tags>
  </entry>
  <entry>
    <title>INTERVIEW-JAVA</title>
    <url>/2018/05/24/INTERVIEW-JAVA/</url>
    <content><![CDATA[<p><a href="https://interview-q-a-1gdnkgkla15afdbe-1258598664.tcloudbaseapp.com/Java/HashMap%E5%8E%9F%E7%90%86-%E7%BE%8E%E5%9B%A2.html">https://interview-q-a-1gdnkgkla15afdbe-1258598664.tcloudbaseapp.com/Java/HashMap%E5%8E%9F%E7%90%86-%E7%BE%8E%E5%9B%A2.html</a></p>
<p><a href="https://www.cnblogs.com/huangjialin/p/12411842.html">面试题含答案</a></p>
<h3 id="java基础面试知识点"><a href="#java基础面试知识点" class="headerlink" title="java基础面试知识点"></a>java基础面试知识点</h3><h5 id="java中-和equals和hashCode的区别"><a href="#java中-和equals和hashCode的区别" class="headerlink" title="java中==和equals和hashCode的区别"></a>java中==和equals和hashCode的区别</h5><p>类型</p>
<ul>
<li>基本类型：比较的是值是否相同；</li>
<li>引用类型：如果是 类、接口、数组的话,当他们用双等号（==）进行比较的时候，比较的是他们的引用，如果要比较堆中对象是否相同，那么就要重写equals方法了；</li>
<li>默认情况下（没有覆写equals方法）的equals方法都是调用Object类的equals方法，而Object的equals方法主要是用于判断<strong>对象的内存地址引用是不是同一个地址</strong>（是不是同一个对象）。</li>
</ul>
<h5 id="int、char、long各占多少字节数"><a href="#int、char、long各占多少字节数" class="headerlink" title="int、char、long各占多少字节数"></a>int、char、long各占多少字节数</h5><p>   byte   1字节       short   2字节         int    4字节           long   8字节          </p>
<p>   char   2字节       float   4字节         double  8字节      boolean  false/true(理论上占用1bit,1/8字节，实际处理按1byte处理) </p>
<h5 id="int与integer的区别"><a href="#int与integer的区别" class="headerlink" title="int与integer的区别"></a>int与integer的区别</h5><p>​    Integer 是int的包装类；int是基本数据类型;</p>
<p>​    Integer实际是对象的引用，int是直接存储数据值</p>
<h5 id="谈谈对java多态-polymorphism-的理解-Java中实现多态的机制是什么"><a href="#谈谈对java多态-polymorphism-的理解-Java中实现多态的机制是什么" class="headerlink" title="谈谈对java多态(polymorphism)的理解,Java中实现多态的机制是什么"></a>谈谈对java多态(polymorphism)的理解,Java中实现多态的机制是什么</h5><p> 实现的机制是，父类或者接口定义的引用变量指向子类或者子类的实现， 执行期间判断所引用对象的实际类型，根据其实际的类型调用相应的方法。</p>
<ol>
<li><p>编译时多态(静态多态)==重载</p>
</li>
<li><p>运行时多态（动态多态）</p>
<p>无论哪种方法，核心之处在对父类方法的改写或对接口方法的实现，以取得运行时不同的执行效果.</p>
</li>
</ol>
<p><a href="https://docs.oracle.com/javase/tutorial/java/IandI/polymorphism.html">https://docs.oracle.com/javase/tutorial/java/IandI/polymorphism.html</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1447574">https://cloud.tencent.com/developer/article/1447574</a></p>
<h5 id="String、StringBuffer、StringBuilder区别"><a href="#String、StringBuffer、StringBuilder区别" class="headerlink" title="String、StringBuffer、StringBuilder区别"></a>String、StringBuffer、StringBuilder区别</h5><ul>
<li>都是fianl类，不能被继承,底层都是 char[] value实现</li>
<li>String类长度是不可变的，substring()、  concat(),最终实现都是通过  new String(buf, true)实现的,StringBuffer,StringBuilder是通过操作本类的value实现的</li>
<li>StringBuffer类是线程安全的，StringBuilder不是线程安全的</li>
<li>String：字符串常量。</li>
</ul>
<p>​    </p>
<h5 id="什么是内部类？内部类的作用"><a href="#什么是内部类？内部类的作用" class="headerlink" title="什么是内部类？内部类的作用"></a>什么是内部类？内部类的作用</h5><p>​    内部类:    一个类定义在另一个类的内部，就叫内部类</p>
<p>​    作用: </p>
<ul>
<li><p>内部类  拥有外部类的所有访问权限，包括被private修饰的私有数据</p>
</li>
<li><p>内部类可以很好的隐藏实现</p>
</li>
<li><p>内部类可以实现多重继承</p>
 <figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//类一</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassA</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;liutao&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">doSomeThing</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// doSomeThing</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//类二</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassB</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">25</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类三</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainExample</span></span>&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> <span class="keyword">extends</span> <span class="title">ClassA</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">super</span>.name();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span> <span class="keyword">extends</span> <span class="title">ClassB</span></span>&#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">super</span>.age();</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Test1().name();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">age</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Test2().age();</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123;</span><br><span class="line">       MainExample mi=<span class="keyword">new</span> MainExample();</span><br><span class="line">       System.out.println(<span class="string">&quot;姓名:&quot;</span>+mi.name());</span><br><span class="line">       System.out.println(<span class="string">&quot;年龄:&quot;</span>+mi.age());</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> MainExample 类通过内部类拥有了 ClassA 和 ClassB 的两个类的继承关系。 而无需关注 ClassA 中的 doSomeThing 方法的实现。这就是比接口实现更有戏的地方</p>
<p> <a href="https://juejin.cn/post/6844903566293860366">https://juejin.cn/post/6844903566293860366</a></p>
</li>
</ul>
<h5 id="抽象类和接口区别"><a href="#抽象类和接口区别" class="headerlink" title="抽象类和接口区别"></a>抽象类和接口区别</h5><table>
<thead>
<tr>
<th>Abstract class</th>
<th>Interface</th>
</tr>
</thead>
<tbody><tr>
<td>1) Abstract class can <strong>have abstract and non-abstract</strong> methods.</td>
<td>Interface can have <strong>only abstract</strong> methods. Since Java 8, it can have <strong>default and static methods</strong> also.</td>
</tr>
<tr>
<td>2) Abstract class <strong>doesn’t support multiple inheritance</strong>.</td>
<td>Interface <strong>supports multiple inheritance</strong>.</td>
</tr>
<tr>
<td>3) Abstract class <strong>can have final, non-final, static and non-static variables</strong>.</td>
<td>Interface has <strong>only static and final variables</strong>.</td>
</tr>
<tr>
<td>4) Abstract class <strong>can provide the implementation of interface</strong>.</td>
<td>Interface <strong>can’t provide the implementation of abstract class</strong>.</td>
</tr>
<tr>
<td>5) The <strong>abstract keyword</strong> is used to declare abstract class.</td>
<td>The <strong>interface keyword</strong> is used to declare interface.</td>
</tr>
<tr>
<td>6) An <strong>abstract class</strong> can extend another Java class and implement multiple Java interfaces.</td>
<td>An <strong>interface</strong> can extend another Java interface only.</td>
</tr>
<tr>
<td>7) An <strong>abstract class</strong> can be extended using keyword “extends”.</td>
<td>An <strong>interface</strong> can be implemented using keyword “implements”.</td>
</tr>
<tr>
<td>8) A Java <strong>abstract class</strong> can have class members like private, protected, etc.</td>
<td>Members of a Java interface are public by default.</td>
</tr>
<tr>
<td>9)<strong>Example:</strong>  public abstract class Shape{ public abstract void draw(); }</td>
<td><strong>Example:</strong>  public interface Drawable{ void draw(); }</td>
</tr>
</tbody></table>
<p><a href="https://www.javatpoint.com/difference-between-abstract-class-and-interface">https://www.javatpoint.com/difference-between-abstract-class-and-interface</a></p>
<h5 id="泛型中extends和super的区别"><a href="#泛型中extends和super的区别" class="headerlink" title="? 泛型中extends和super的区别"></a>? 泛型中extends和super的区别</h5><ul>
<li><p>上界&lt;? extends T&gt;不能往里存，只能往外取，适合频繁往外面读取内容的场景。</p>
</li>
<li><p>下界&lt;? super T&gt;不影响往里存，但往外取只能放在Object对象里，适合经常往里面插入数据的场景</p>
<p><a href="https://noteforme.github.io/2018/04/16/Generics/">https://noteforme.github.io/2018/04/16/Generics/</a></p>
</li>
</ul>
<h5 id="string-转换成-integer的方式及原理"><a href="#string-转换成-integer的方式及原理" class="headerlink" title="string 转换成 integer的方式及原理"></a>string 转换成 integer的方式及原理</h5><ol>
<li>判断是否null或””</li>
<li>判断第一位正负数，逐位获取值 ?</li>
</ol>
<p>  <a href="https://blog.csdn.net/nobody_1/article/details/91488686">https://blog.csdn.net/nobody_1/article/details/91488686</a></p>
<h5 id="静态内部类的设计意图"><a href="#静态内部类的设计意图" class="headerlink" title="静态内部类的设计意图"></a>静态内部类的设计意图</h5><p>​    非静态内部类编译后会隐含的保存着一个引用，改引用指向创建它的外围类，静态内部类没有，</p>
<p>​    它不能使用任何外围类的非static成员变量和方法.</p>
<h5 id="final，finally，finalize的区别"><a href="#final，finally，finalize的区别" class="headerlink" title="final，finally，finalize的区别"></a>final，finally，finalize的区别</h5><p>  Final : 用于申明属性，方法，类，表示属性不可变，方法不可以覆盖，类不能继承</p>
<ol>
<li><p>final数组</p>
<p><strong>Java 中数组也是对象</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> arr[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;  <span class="comment">//  注意，数组 arr 是 final 的</span></span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">         arr[i] = arr[i]*<span class="number">10</span>;</span><br><span class="line">         System.out.println(arr[i]);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>数组是对象的一种，现在数组是被 final 修饰的，所以它的意思是一旦被赋值之后，变量的引用不能修改。但是我们现在想证明的是，数组对象里面的内容可以修改</p>
</li>
<li><p>非数组对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123; </span><br><span class="line">    <span class="keyword">int</span> p = <span class="number">20</span>; </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span></span>&#123; </span><br><span class="line">       <span class="keyword">final</span> Test t = <span class="keyword">new</span> Test();</span><br><span class="line">       t.p = <span class="number">30</span>; </span><br><span class="line">       System.out.println(t.p);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把它用 final 修饰，然后去尝试改它里面成员变量 p 的值，并打印出结果，程序会打印出“30”。一开始 p 的值是 20，但是最后修改完毕变成了 30，说明这次修改是成功的。</p>
<p>以上我们就得出了一个结论，<strong>final 修饰一个指向对象的变量的时候，对象本身的内容依然是可以变化的</strong>。</p>
<p><a href="https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=311">https://kaiwu.lagou.com/course/courseInfo.htm?courseId=16#/detail/pc?id=311</a></p>
</li>
</ol>
<ul>
<li><p>Finally: 异常语句处理机构中，与try{}进行配合使用，不论try中的代码是否执行完，表示总是执行的部分</p>
</li>
<li><p>Finalize: Object类的一个方法，用于对象”消失”时，由JVM进行调用用于对对象进行垃圾回收，释放对象占用的资源.</p>
</li>
</ul>
<h5 id="Serializable-和Parcelable-的区别，如何将一个Java对象序列化到文件里？"><a href="#Serializable-和Parcelable-的区别，如何将一个Java对象序列化到文件里？" class="headerlink" title="Serializable 和Parcelable 的区别，如何将一个Java对象序列化到文件里？"></a>Serializable 和Parcelable 的区别，如何将一个Java对象序列化到文件里？</h5><ol>
<li><p>两者最大的区别在于 <strong>存储媒介的不同</strong>，<code>Serializable</code> 使用 <strong>I/O 读写存储在硬盘上</strong>，而 <code>Parcelable</code> 是直接 <strong>在内存中读写</strong>。很明显，内存的读写速度通常大于 IO 读写，所以在 Android 中传递数据优先选择 <code>Parcelable</code>。</p>
</li>
<li><p><code>Serializable</code> 会使用反射，序列化和反序列化过程需要大量 I/O 操作，也会创建很多临时对象， <code>Parcelable</code> 自已实现封送和解封（marshalled &amp;unmarshalled）操作不需要用反射，数据也存放在 Native 内存中，效率要快很多。</p>
<p> <a href="https://juejin.cn/post/6844903518826921991">https://juejin.cn/post/6844903518826921991</a></p>
</li>
</ol>
<p>父类的静态方法能否被子类重写</p>
<p> 不能，静态方法只和类有关,JVM加载后先初始化static相关属性方法,重写依赖于类的实例.</p>
<h5 id="成员内部类、局部内部类以及项目中的应用"><a href="#成员内部类、局部内部类以及项目中的应用" class="headerlink" title="成员内部类、局部内部类以及项目中的应用"></a>成员内部类、局部内部类以及项目中的应用</h5><p>成员内部类 : 普通的内部类，不存在任何static的变量和方法；</p>
<p>局部内部类： 嵌套于方法和作用域内</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parcel5</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Destionation <span class="title">destionation</span><span class="params">(String str)</span></span>&#123;</span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">PDestionation</span> <span class="keyword">implements</span> <span class="title">Destionation</span></span>&#123;</span><br><span class="line">            <span class="keyword">private</span> String label;</span><br><span class="line">            <span class="function"><span class="keyword">private</span> <span class="title">PDestionation</span><span class="params">(String whereTo)</span></span>&#123;</span><br><span class="line">                label = whereTo;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">readLabel</span><span class="params">()</span></span>&#123;</span><br><span class="line">                <span class="keyword">return</span> label;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PDestionation(str);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Parcel5 parcel5 = <span class="keyword">new</span> Parcel5();</span><br><span class="line">      Destionation d = parcel5.destionation(<span class="string">&quot;chenssy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>闭包和局部内部类的区别</p>
<h5 id="Java中对象的生命周期"><a href="#Java中对象的生命周期" class="headerlink" title="Java中对象的生命周期"></a>Java中对象的生命周期</h5><p>​    <strong>1、创建阶段(Created)</strong><br>  <code>检测类是否被加载没有加载的先加载</code>→<code>为新生对象分配内存</code>→<code>将分配到的内存空间都初始化为零值</code>→<code>对对象进行必要的设置</code>→<code>执行&lt;init&gt;方法把对象进行初始化</code><br> 对象的加载大小是类加载中就已经确定好了的，类加载过程就相当复杂了，如下图：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4345692-846543b5bed56265.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/452" alt="img"></p>
<p>类加载过程.png</p>
<p><strong>2、应用阶段(In Use)</strong><br>  至少有一个强引用使用着</p>
<p><strong>3、不可见阶段(Invisible)</strong><br>  程序的执行已经超出了该对象的作用域了</p>
<p><strong>4、不可达阶段(Unreachable)</strong><br>  程序不再持有该对象的任何强引用，这种情况下，该对象仍可能被JVM等系统下的某些已装载的静态变量或线程或JNI等强引用持有着，这些特殊的强引用被称为”GC root”</p>
<p><strong>5、收集阶段(Collected)</strong><br>  垃圾回收器发现该对象已经处于“不可达阶段”并且垃圾回收器已经对该对象的内存空间重新分配做好准备时，则对象进入了“收集阶段”。如果该对象已经重写了finalize()方法，则会去执行该方法的终端操作。</p>
<p><strong>6、终结阶段(Finalized)</strong><br>  当对象执行完finalize()方法后仍然处于不可达状态时，则该对象进入终结阶段。在该阶段是等待垃圾回收器对该对象空间进行回收。</p>
<p><strong>7、对象空间重分配阶段(De-allocated)</strong><br>  垃圾回收器对该对象的所占用的内存空间进行回收或者再分配了，则该对象彻底消失了，称之为“对象空间重新分配阶段”。</p>
<p>链接：<a href="https://www.jianshu.com/p/72f5017c6649">https://www.jianshu.com/p/72f5017c6649</a></p>
<h3 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h3><h5 id="String特性"><a href="#String特性" class="headerlink" title="String特性"></a>String特性</h5><p>Java虚拟机在内存中开辟出一块单独的区域</p>
<p><a href="https://zhuanlan.zhihu.com/p/60643031">https://zhuanlan.zhihu.com/p/60643031</a></p>
<p><a href="https://www.bilibili.com/video/BV1PJ411n7xZ?p=118">https://www.bilibili.com/video/BV1PJ411n7xZ?p=118</a>   几个视频讲到用法，最好能用图画出来</p>
<p><a href="https://www.iteye.com/blog/rednaxelafx-774673">https://www.iteye.com/blog/rednaxelafx-774673</a></p>
<h5 id="哪些情况下的对象会被垃圾回收机制处理掉？"><a href="#哪些情况下的对象会被垃圾回收机制处理掉？" class="headerlink" title="哪些情况下的对象会被垃圾回收机制处理掉？"></a>哪些情况下的对象会被垃圾回收机制处理掉？</h5><ol>
<li>可达性分析,GC Root向下搜索，产生一个reference chain 。当一个对象不能和任何GC Root产生关系时就被回收.</li>
<li><ul>
<li>强引用 ：那<strong>垃圾回收器</strong>绝不会回收</li>
<li>软引用: 内存溢出时候对象回收</li>
<li>弱引用:下一次GC时候对象回收</li>
<li>虚引用：随时可能被回收</li>
</ul>
</li>
<li>当前商业虚拟机的垃圾回收都采用分代收集算法，这种算法并没有什么新的思想，只是根据对象的存活周期将内存划分为几块。一般是把Java堆分为新生代和老年代，这样就可以根据各个年代的特点采用最适当的收集算法。在新生代中，每次垃圾回收都有大批对象死去，只有少量存活，那就选用复制算法，只要付出少量存活对象的复制成本就可以完成收集。而老年代中因为对象存活率高，没有额外的空间对它进行分配担保，那就使用标记清理或者标记整理算法来进行回收。</li>
</ol>
<p><a href="https://noteforme.github.io/2021/01/05/JVM-GC/">https://noteforme.github.io/2021/01/05/JVM-GC/</a></p>
<p><a href="https://noteforme.github.io/2020/04/18/JVM/">https://noteforme.github.io/2020/04/18/JVM/</a></p>
<h5 id="String为什么要设计成不可变的？"><a href="#String为什么要设计成不可变的？" class="headerlink" title="String为什么要设计成不可变的？"></a>String为什么要设计成不可变的？</h5><ol>
<li><p>便于实现字符串池</p>
<p>由于会大量的使用String常量，如果每一次声明一个String都创建一个String对象，那将会造成极大的空间资源的浪费。Java提出了String pool的概念，在堆中开辟一块存储空间String  pool，当初始化一个String变量时，如果该字符串已经存在了，就不会去创建一个新的字符串变量，而是会返回已经存在了的字符串的引用。</p>
<p>如果字符串是可变的，某一个字符串变量改变了其值，那么其指向的变量的值也会改变，String pool将不能够实现！</p>
<p><a href="https://www.cnblogs.com/wkfvawl/p/11693260.html">https://www.cnblogs.com/wkfvawl/p/11693260.html</a></p>
</li>
</ol>
<h3 id="java深入源码级的面试题"><a href="#java深入源码级的面试题" class="headerlink" title="java深入源码级的面试题"></a>java深入源码级的面试题</h3><h5 id="讲一下常见编码方式？"><a href="#讲一下常见编码方式？" class="headerlink" title="讲一下常见编码方式？"></a>讲一下常见编码方式？</h5><ol>
<li><p>ASCII码:  用一个字节的低7位表示，总共128个,0<del>31 是控制字符如换行回车删除等；32</del>126 是打印字符，可以通过键盘输入并且能够显示出来</p>
</li>
<li><p>UTF-16:  固定两个字节表示一个字符：说到 UTF 必须要提到 Unicode（Universal Code 统一码），ISO  试图想创建一个全新的超语言字典，世界上所有的语言都可以通过这本字典来相互翻译。可想而知这个字典是多么的复杂，关于 Unicode  的详细规范可以参考相应文档。Unicode 是 Java 和 XML 的基础，下面详细介绍 Unicode 在计算机中的存储形式。<br>UTF-16 具体定义了 Unicode 字符在计算机中存取方法。UTF-16 用两个字节来表示 Unicode  转化格式，这个是定长的表示方法，不论什么字符都可以用两个字节表示，两个字节是 16 个 bit，所以叫 UTF-16。UTF-16  表示字符非常方便，每两个字节表示一个字符，这个在字符串操作时就大大简化了操作，这也是 Java 以 UTF-16  作为内存的字符存储格式的一个很重要的原因。</p>
</li>
<li><p>UTF-8:  优化UTF-16,UTF-16  统一采用两个字节表示一个字符，虽然在表示上非常简单方便，但是也有其缺点，有很大一部分字符用一个字节就可以表示的现在要两个字节表示，存储空间放大了一倍，在现在的网络带宽还非常有限的今天，这样会增大网络传输的流量，而且也没必要。而 UTF-8 采用了一种变长技术，每个编码区域有不同的字码长度。不同类型的字符可以是由 1~6 个字节组成。<br>UTF-8 有以下编码规则：<br>如果一个字节，最高位（第 8 位）为 0，表示这是一个 ASCII 字符（00 - 7F）。可见，所有 ASCII 编码已经是 UTF-8 了。<br>如果一个字节，以 11 开头，连续的 1 的个数暗示这个字符的字节数，例如：110xxxxx 代表它是双字节 UTF-8 字符的首字节。<br>如果一个字节，以 10 开始，表示它不是首字节，需要向前查找才能得到当前字符的首字节 </p>
</li>
<li><p>GBK 、ISO-8859-1、GB2312</p>
<p><a href="https://www.cnblogs.com/mlan/p/7823375.html">https://www.cnblogs.com/mlan/p/7823375.html</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/mlan/p/7823375.html">https://www.cnblogs.com/mlan/p/7823375.html</a></p>
</li>
</ol>
<h5 id="utf-8编码中的中文占几个字节；int型几个字节？"><a href="#utf-8编码中的中文占几个字节；int型几个字节？" class="headerlink" title="utf-8编码中的中文占几个字节；int型几个字节？"></a>utf-8编码中的中文占几个字节；int型几个字节？</h5><p>​    少数是汉字每个占用3个字节，多数占用4个字节。</p>
<p>​    <a href="https://blog.csdn.net/hellokatewj/article/details/24325653">https://blog.csdn.net/hellokatewj/article/details/24325653</a></p>
<p>​    int类型 4个字节</p>
<h5 id="静态代理和动态代理的区别，什么场景使用？"><a href="#静态代理和动态代理的区别，什么场景使用？" class="headerlink" title="静态代理和动态代理的区别，什么场景使用？"></a>静态代理和动态代理的区别，什么场景使用？</h5><p>​    静态代理 :  编译的时候就已经存在，</p>
<p>​    动态代理 ： 通过反射机制生成的代理对象</p>
<p>​    <a href="https://noteforme.github.io/2021/01/14/DesignPattern-Proxy/">https://noteforme.github.io/2021/01/14/DesignPattern-Proxy/</a></p>
<p>​    <a href="https://www.jianshu.com/p/2f518a4a4c2b">https://www.jianshu.com/p/2f518a4a4c2b</a></p>
<h5 id="Java的异常体系"><a href="#Java的异常体系" class="headerlink" title="Java的异常体系"></a>Java的异常体系</h5><p>非运行时异常 :编译期间可以检查到的异常, 像IoException,DataFormatException,CertificateException</p>
<p>运行时异常 : NullPointerException, ClassCastException,IndexOutOfBoundsException</p>
<h5 id="谈谈你对解析与分派的认识。"><a href="#谈谈你对解析与分派的认识。" class="headerlink" title="? 谈谈你对解析与分派的认识。"></a>? 谈谈你对解析与分派的认识。</h5><h5 id="说说你对Java反射的理解"><a href="#说说你对Java反射的理解" class="headerlink" title="说说你对Java反射的理解"></a>说说你对Java反射的理解</h5><p>​    对于任何一个类都可以通过反射知道的它的属性和方法。</p>
<h5 id="说说你对Java注解的理解"><a href="#说说你对Java注解的理解" class="headerlink" title="说说你对Java注解的理解"></a>说说你对Java注解的理解</h5><p>​    注解，对代码进行注明。使得程序在编译或者运行时，读取到注解并加以处理，以间接的改变程序的运行。</p>
<h5 id="为什么Java里的匿名内部类只能访问final修饰的外部变量？"><a href="#为什么Java里的匿名内部类只能访问final修饰的外部变量？" class="headerlink" title="为什么Java里的匿名内部类只能访问final修饰的外部变量？"></a>为什么Java里的匿名内部类只能访问final修饰的外部变量？</h5><p>​    因为匿名内部类最终会被编译成一个单独的类，而被该类使用的变量会以构造函数参数的形式传递给该类。如果变量不定义为final的，参数在匿名内部类中可以被修改，进而造成和外部的变量不一致的问题，为了避免这种不一致的情况，规定匿名内部类只能访问final修饰的外部变量。</p>
<h5 id="说说你对依赖注入的理解"><a href="#说说你对依赖注入的理解" class="headerlink" title="说说你对依赖注入的理解?"></a>说说你对依赖注入的理解?</h5><p>​    给予调用方它所需要的对象</p>
<h4 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h4><h5 id="说一下泛型原理，并举例说明"><a href="#说一下泛型原理，并举例说明" class="headerlink" title="说一下泛型原理，并举例说明"></a>说一下泛型原理，并举例说明</h5><p>​    泛型实现了参数化类型的概念，使代码可以应用于多种类型。</p>
<p>​    在泛型代码内部，无法获得任何有关泛型参数类型的信息。    </p>
<h3 id="容器"><a href="#容器" class="headerlink" title="容器"></a>容器</h3><h5 id="常用数据结构简介"><a href="#常用数据结构简介" class="headerlink" title="常用数据结构简介"></a>常用数据结构简介</h5><p>数组 栈 队列  链表 图 树 哈希表</p>
<h5 id="并发集合了解哪些？"><a href="#并发集合了解哪些？" class="headerlink" title="并发集合了解哪些？"></a>并发集合了解哪些？</h5><p>ConcurrentHashMap  CopyOnWriteArrayList  CopyOnWriteArraySet  ArrayBlockingQueue  LinkedBlockingQueue</p>
<p><a href="https://blog.csdn.net/u010942020/article/details/73610121">https://blog.csdn.net/u010942020/article/details/73610121</a></p>
<h5 id="列举java的集合以及集合之间的继承关系"><a href="#列举java的集合以及集合之间的继承关系" class="headerlink" title="列举java的集合以及集合之间的继承关系"></a>列举java的集合以及集合之间的继承关系</h5><img src="/2018/05/24/INTERVIEW-JAVA/colltetcion_map.png">



<p><img src="https://images4.pianshen.com/887/c1/c1abbb330519fa244799ae0923a2f3cf.png"></p>
<h5 id="List-Set-Map的区别"><a href="#List-Set-Map的区别" class="headerlink" title="List,Set,Map的区别"></a>List,Set,Map的区别</h5><p>容器类介绍以及之间的区别（容器类估计很多人没听这个词，Java容器主要可以划分为4个部分：List列表、Set集合、Map映射、工具类（Iterator迭代器、Enumeration枚举类、Arrays和Collections），具体的可以看看这篇博文 <a href="http://alexyyek.github.io/2015/04/06/Collection/">Java容器类</a>）</p>
<ol>
<li>List是一个有序的队列，每一个元素都有它的索引。Set是一个不允许有重复元素的集合。</li>
<li>Map是一个映射接口，即key-value键值对。</li>
</ol>
<h5 id="List和Map的实现方式以及存储方式"><a href="#List和Map的实现方式以及存储方式" class="headerlink" title="List和Map的实现方式以及存储方式"></a>List和Map的实现方式以及存储方式</h5><ol>
<li><p>list</p>
<p>ArrayList    查询快 .  LinkedList  插入删除快</p>
</li>
</ol>
<p>修改对象A的equals方法的签名，那么使用HashMap存放这个对象实例的时候，会调用哪个equals方法？</p>
<h5 id="集合Set实现Hash怎么防止碰撞"><a href="#集合Set实现Hash怎么防止碰撞" class="headerlink" title="集合Set实现Hash怎么防止碰撞"></a>集合Set实现Hash怎么防止碰撞</h5><p>1，如果hash码值不相同，说明是一个新元素，存储；</p>
<p>如果没有元素和传入对象（也就是add的元素）的hash值相等，那么就认为这个元素在table中不存在，将其添加进table；</p>
<p>2.1，如果hash码值相同，且equles判断相等，说明元素已经存在，不存；</p>
<p>2.2，如果hash码值相同，且equles判断不相等，说明元素不存在，存；</p>
<p>原文链接：<a href="https://blog.csdn.net/github_37130188/article/details/96508272">https://blog.csdn.net/github_37130188/article/details/96508272</a></p>
<p>​                    <a href="https://noteforme.github.io/2018/05/31/HashMap/">https://noteforme.github.io/2018/05/31/HashMap/</a></p>
<h5 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h5><ol>
<li>对key的Dashcode()做hash运算，计算index.</li>
<li>如果没碰撞直接放到bucket⾥</li>
<li>如果碰撞了，以链表的形式存在buckets后</li>
<li>如果节点已经存在就替换old value(保证key的唯⼀性)</li>
<li>如果bucket满了(超过load factor*current capacity)，就要resize</li>
</ol>
<p>get数据</p>
<ol>
<li><p>对key的hashCode()做hash运算，计算index;</p>
</li>
<li><p>如果在bucket⾥的第⼀个节点⾥直接命中，则直接返回；</p>
</li>
<li><p>如果有冲突，则通过key.equals(k)去查找对应的Entry;分为下面两种方式.</p>
</li>
<li><p>若为树，则在树中通过key.equals(k)查找，O(logn)；</p>
</li>
<li><p>若为链表，则在链表中通过key.equals(k)查找，O(n)。</p>
</li>
</ol>
<h5 id="ArrayMap"><a href="#ArrayMap" class="headerlink" title="ArrayMap"></a>ArrayMap</h5><p>​    因为其会对key从小到大排序，使用<strong>二分法</strong>查询key对应在数组中的下标。<br> 在添加、删除、查找数据的时候都是<strong>先使用二分查找法得到相应的index</strong>，然后通过index来进行添加、查找、删除等操作。</p>
<ul>
<li><strong>数据量不大</strong></li>
<li><strong>空间</strong>比时间<strong>重要</strong></li>
<li>需要使用<code>Map</code></li>
<li>在Android平台，相对来说，内存容量更宝贵。而且数据量不大。所以当需要使用<code>key</code>是<code>Object</code>类型的<code>Map</code>时，可以考虑使用<code>ArrayMap</code>来替换<code>HashMap</code></li>
</ul>
<h5 id="hashmap-hashtable区别"><a href="#hashmap-hashtable区别" class="headerlink" title="hashmap hashtable区别"></a>hashmap hashtable区别</h5><p>堆的结构</p>
<p>​    堆分为两种：<em>最大堆</em>和<em>最小堆</em>，两者的差别在于节点的排序方式。</p>
<p>在最大堆中，父节点的值比每一个子节点的值都要大。在最小堆中，父节点的值比每一个子节点的值都要小。这就是所谓的“堆属性”，并且这个属性对堆中的每一个节点都成立。<br><a href="https://www.jianshu.com/p/6b526aa481b1">https://www.jianshu.com/p/6b526aa481b1</a></p>
<h5 id="堆和树的区别"><a href="#堆和树的区别" class="headerlink" title="堆和树的区别"></a>堆和树的区别</h5><p>​    左子节点必须比父节点小，右子节点必须必比父节点大。但是在堆中并非如此。在最大堆中两个子节点都必须比父节点小，而在最小堆中，它们都必须比父节点大。</p>
<p>堆和栈在内存中的区别是什么(解答提示：可以从数据结构方面以及实际实现方面两个方面去回答)？</p>
<h5 id="什么是深拷贝和浅拷贝"><a href="#什么是深拷贝和浅拷贝" class="headerlink" title="什么是深拷贝和浅拷贝"></a>什么是深拷贝和浅拷贝</h5><ul>
<li><p>浅拷贝</p>
<p>是一个传址,也就是把a的值赋给b的时候同时也把a的地址赋给了b，当b（a）的值改变的时候，a（b）的值同时也会改变</p>
</li>
<li><p>深拷贝</p>
<p>​    深拷贝是指，拷贝对象的具体内容，二内存地址是自主分配的，拷贝结束之后俩个对象虽然存的值是一样的，但是内存地址不一样，俩个对象页互相不影响，互不干涉</p>
</li>
</ul>
<p>手写链表逆序代码</p>
<p>讲一下对树，B+树的理解</p>
<p>讲一下对图的理解</p>
<p>判断单链表成环与否？</p>
<p>链表翻转（即：翻转一个单项链表）</p>
<p>合并多个单有序链表（假设都是递增的）</p>
]]></content>
      <tags>
        <tag>inter</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM_Overview</title>
    <url>/2020/01/03/JVM-Overview/</url>
    <content><![CDATA[<p>虚拟机是通过软件模拟的具有完整硬件系统功能的、运行在一个完全隔离环境中的完整计算机系统。</p>
<p>JVM分类</p>
<p><a href="https://www.zhihu.com/question/29265430/answer/43818804">https://www.zhihu.com/question/29265430/answer/43818804</a></p>
<p>元空间寸哪些数据?</p>
<p><a href="https://www.cnblogs.com/duanxz/p/3520829.html">https://www.cnblogs.com/duanxz/p/3520829.html</a></p>
<p>JVM整体结构</p>
<p><img src="/2020/01/03/JVM-Overview/image-20200704183436495.png"></p>
<p>Java代码执行流程</p>
<p><img src="/2020/01/03/JVM-Overview/image-20200704210429535.png"></p>
<p>​    详细图</p>
<p><img src="/2020/01/03/JVM-Overview/jvm0002.jpg"></p>
<h2 id="JVM的架构模型"><a href="#JVM的架构模型" class="headerlink" title="JVM的架构模型"></a>JVM的架构模型</h2><p>Java编译器输入的指令流基本上是一种基于栈的指令集架构，另外一种指令集架构则是基于寄存器的指令集架构。具体来说：这两种架构之间的区别：</p>
<p>基于栈式架构的特点</p>
<ul>
<li>设计和实现更简单，适用于资源受限的系统；</li>
<li>避开了寄存器的分配难题：使用零地址指令方式分配。</li>
<li>指令流中的指令大部分是零地址指令，其执行过程依赖于操作栈。指令集更小，编译器容易实现。</li>
<li>不需要硬件支持，可移植性更好，更好实现跨平台</li>
</ul>
<p>基于寄存器架构的特点</p>
<ul>
<li>典型的应用是x86的二进制指令集：比如传统的PC以及Android的Davlik虚拟机。</li>
<li>指令集架构则完全依赖硬件，可移植性差</li>
<li>性能优秀和执行更高效</li>
<li>花费更少的指令去完成一项操作。</li>
<li>在大部分情况下，基于寄存器架构的指令集往往都以一地址指令、二地址指令和三地址指令为主，而基于栈式架构的指令集却是以零地址指令为主方水洋</li>
</ul>
<p>总结</p>
<p>由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的。优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。</p>
<p>时至今日，尽管嵌入式平台已经不是Java程序的主流运行平台了（准确来说应该是HotSpotVM的宿主环境已经不局限于嵌入式平台了），那么为什么不将架构更换为基于寄存器的架构呢？</p>
<p>栈</p>
<ul>
<li>跨平台性</li>
<li>指令集小</li>
<li>指令多</li>
<li>执行性能比寄存器差</li>
</ul>
<h2 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B">类加载过程</a></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloLoader</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;谢谢ClassLoader加载我....&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;你的大恩大德，我下辈子再报！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>它的加载过程是怎么样的呢?</p>
<ul>
<li>执行 main() 方法（静态方法）就需要先加载main方法所在类 HelloLoader</li>
<li>加载成功，则进行链接、初始化等操作。完成后调用 HelloLoader 类中的静态方法 main</li>
<li>加载失败则抛出异常</li>
</ul>
<p><img src="/2020/01/03/JVM-Overview/jvm0006.png"></p>
<p>完整的流程图如下所示：</p>
<p><img src="/2020/01/03/JVM-Overview/0007.png"></p>
<h3 id="加载阶段"><a href="#加载阶段" class="headerlink" title="加载阶段"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%8A%A0%E8%BD%BD%E9%98%B6%E6%AE%B5">加载阶段</a></h3><p><strong>加载：</strong></p>
<ol>
<li>通过一个类的全限定名获取定义此类的二进制字节流</li>
<li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li>
<li><strong>在内存中生成一个代表这个类的java.lang.Class对象</strong>，作为方法区这个类的各种数据的访问入口</li>
</ol>
<p><strong>加载class文件的方式：</strong></p>
<ol>
<li>从本地系统中直接加载</li>
<li>通过网络获取，典型场景：Web Applet</li>
<li>从zip压缩包中读取，成为日后jar、war格式的基础</li>
<li>运行时计算生成，使用最多的是：动态代理技术</li>
<li>由其他文件生成，典型场景：JSP应用从专有数据库中提取.class文件，比较少见</li>
<li>从加密文件中获取，典型的防Class文件被反编译的保护措施</li>
</ol>
<h3 id="链接阶段"><a href="#链接阶段" class="headerlink" title="链接阶段"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E9%93%BE%E6%8E%A5%E9%98%B6%E6%AE%B5">链接阶段</a></h3><p>链接分为三个子阶段：验证 -&gt; 准备 -&gt; 解析</p>
<ol>
<li>目的在于确保Class文件的字节流中包含信息符合当前虚拟机要求，保证被加载类的正确性，不会危害虚拟机自身安全</li>
<li>主要包括四种验证，文件格式验证，元数据验证，字节码验证，符号引用验证。</li>
</ol>
<p><strong>举例</strong></p>
<p>使用 BinaryViewer软件查看字节码文件，其开头均为 CAFE BABE ，如果出现不合法的字节码文件，那么将会验证不通过。</p>
<h4 id="准备-Prepare"><a href="#准备-Prepare" class="headerlink" title="准备(Prepare)"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%87%86%E5%A4%87prepare">准备(Prepare)</a></h4><ol>
<li>为类变量（static变量）分配内存并且设置该类变量的默认初始值，即零值</li>
<li>这里不包含用final修饰的static，因为final在编译的时候就会分配好了默认值，准备阶段会显式初始化</li>
<li>注意：这里不会为实例变量分配初始化，类变量会分配在方法区中，而实例变量是会随着对象一起分配到Java堆中</li>
</ol>
<p>代码：变量a在准备阶段会赋初始值，但不是1，而是0，在初始化阶段会被赋值为 1</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloApp</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">1</span>;<span class="comment">//prepare：a = 0 ---&gt; initial : a = 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解析-Resolve"><a href="#解析-Resolve" class="headerlink" title="解析(Resolve)"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E8%A7%A3%E6%9E%90resolve">解析(Resolve)</a></h4><ol>
<li><strong>将常量池内的符号引用转换为直接引用的过程</strong></li>
<li>事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行</li>
<li>符号引用就是一组符号来描述所引用的目标。符号引用的字面量形式明确定义在《java虚拟机规范》的class文件格式中。直接引用就是直接指向目标的指针、相对偏移量或一个间接定位到目标的句柄</li>
<li>解析动作主要针对类或接口、字段、类方法、接口方法、方法类型等。对应常量池中的CONSTANT Class info、CONSTANT Fieldref info、CONSTANT Methodref info等</li>
</ol>
<p><strong>符号引用</strong></p>
<ul>
<li>反编译 class 文件后可以查看符号引用</li>
</ul>
<h3 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5">初始化阶段</a></h3><h4 id="类的初始化时机"><a href="#类的初始化时机" class="headerlink" title="类的初始化时机"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E7%B1%BB%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E6%97%B6%E6%9C%BA">类的初始化时机</a></h4><ol>
<li>创建类的实例</li>
<li>访问某个类或接口的静态变量，或者对该静态变量赋值</li>
<li>调用类的静态方法</li>
<li>反射（比如：Class.forName(“com.atguigu.Test”)）</li>
<li>初始化一个类的子类</li>
<li>Java虚拟机启动时被标明为启动类的类</li>
<li>JDK7开始提供的动态语言支持：java.lang.invoke.MethodHandle实例的解析结果REF_getStatic、REF putStatic、REF_invokeStatic句柄对应的类没有初始化，则初始化</li>
</ol>
<p>除了以上七种情况，其他使用Java类的方式都被看作是对类的被动使用，都不会导致类的初始化，即不会执行初始化阶段（不会调用 clinit() 方法和 init() 方法）</p>
<h3 id="clinit"><a href="#clinit" class="headerlink" title="clinit()"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=clinit">clinit()</a></h3><ol>
<li>初始化阶段就是执行类构造器方法<code>&lt;clinit&gt;()</code>的过程</li>
<li>此方法不需定义，是javac编译器自动收集类中的所有<strong>类变量</strong>的赋值动作和静态代码块中的语句合并而来。也就是说，当我们代码中包含static变量的时候，就会有clinit方法</li>
<li><code>&lt;clinit&gt;()</code>方法中的指令按语句在源文件中出现的顺序执行</li>
<li><code>&lt;clinit&gt;()</code>不同于类的构造器。（关联：构造器是虚拟机视角下的<code>&lt;init&gt;()</code>）</li>
<li>若该类具有父类，JVM会保证子类的<code>&lt;clinit&gt;()</code>执行前，父类的<code>&lt;clinit&gt;()</code>已经执行完毕</li>
<li>虚拟机必须保证一个类的<code>&lt;clinit&gt;()</code>方法在多线程下被同步加锁</li>
</ol>
<blockquote>
<p>IDEA 中安装 JClassLib Bytecode viewer 插件，可以很方便的看字节码。安装过程可以自行百度</p>
</blockquote>
<p><img src="/2020/01/03/JVM-Overview/0010.png"></p>
<h4 id="5说明"><a href="#5说明" class="headerlink" title="5说明"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=_5%E8%AF%B4%E6%98%8E">5说明</a></h4><p>若该类具有父类，JVM会保证子类的<code>&lt;clinit&gt;()</code>执行前，父类的<code>&lt;clinit&gt;()</code>已经执行完毕</p>
<p><img src="/2020/01/03/JVM-Overview/0013.png"></p>
<p>如上代码，加载流程如下：</p>
<ul>
<li>首先，执行 main() 方法需要加载 ClinitTest1 类</li>
<li>获取 Son.B 静态变量，需要加载 Son 类</li>
<li>Son 类的父类是 Father 类，所以需要先执行 Father 类的加载，再执行 Son 类的加载</li>
</ul>
<h4 id="6说明"><a href="#6说明" class="headerlink" title="6说明"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=_6%E8%AF%B4%E6%98%8E">6说明</a></h4><p>虚拟机必须保证一个类的<code>&lt;clinit&gt;()</code>方法在多线程下被同步加锁</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadThreadTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Runnable r = () -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;开始&quot;</span>);</span><br><span class="line">            DeadThread dead = <span class="keyword">new</span> DeadThread();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;结束&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(r,<span class="string">&quot;线程1&quot;</span>);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(r,<span class="string">&quot;线程2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DeadThread</span></span>&#123;</span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;初始化当前类&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">线程2开始</span><br><span class="line">线程1开始</span><br><span class="line">线程2初始化当前类</span><br><span class="line"></span><br><span class="line">&#x2F;然后程序卡死了</span><br></pre></td></tr></table></figure>

<p>程序卡死，分析原因：</p>
<ul>
<li>两个线程同时去加载 DeadThread 类，而 DeadThread 类中静态代码块中有一处死循环</li>
<li>先加载 DeadThread 类的线程抢到了同步锁，然后在类的静态代码块中执行死循环，而另一个线程在等待同步锁的释放</li>
<li>所以无论哪个线程先执行 DeadThread 类的加载，另外一个类也不会继续执行。（一个类只会被加载一次）</li>
</ul>
<h2 id="类加载器的分类"><a href="#类加载器的分类" class="headerlink" title="类加载器的分类"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%88%86%E7%B1%BB">类加载器的分类</a></h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E6%A6%82%E8%BF%B0-1">概述</a></h3><ol>
<li>JVM严格来讲支持两种类型的类加载器 。分别为引导类加载器（Bootstrap ClassLoader）和自定义类加载器（User-Defined ClassLoader）</li>
<li>从概念上来讲，自定义类加载器一般指的是程序中由开发人员自定义的一类类加载器，但是Java虚拟机规范却没有这么定义，而是<strong>将所有派生于抽象类ClassLoader的类加载器都划分为自定义类加载器</strong></li>
<li>无论类加载器的类型如何划分，在程序中我们最常见的类加载器始终只有3个，如下所示</li>
</ol>
<p><img src="/2020/01/03/JVM-Overview/0014.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取系统类加载器</span></span><br><span class="line">        ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader();</span><br><span class="line">        System.out.println(systemClassLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取其上层：扩展类加载器</span></span><br><span class="line">        ClassLoader extClassLoader = systemClassLoader.getParent();</span><br><span class="line">        System.out.println(extClassLoader);<span class="comment">//sun.misc.Launcher$ExtClassLoader@1540e19d</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取其上层：获取不到引导类加载器</span></span><br><span class="line">        ClassLoader bootstrapClassLoader = extClassLoader.getParent();</span><br><span class="line">        System.out.println(bootstrapClassLoader);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//对于用户自定义类来说：默认使用系统类加载器进行加载</span></span><br><span class="line">        ClassLoader classLoader = ClassLoaderTest.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader);<span class="comment">//sun.misc.Launcher$AppClassLoader@18b4aac2</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//String类使用引导类加载器进行加载的。---&gt; Java的核心类库都是使用引导类加载器进行加载的。</span></span><br><span class="line">        ClassLoader classLoader1 = String.class.getClassLoader();</span><br><span class="line">        System.out.println(classLoader1);<span class="comment">//null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>我们尝试获取引导类加载器，获取到的值为 null ，这并不代表引导类加载器不存在，<strong>因为引导类加载器右 C/C++ 语言，我们获取不到</strong></li>
<li>两次获取系统类加载器的值都相同：sun.misc.Launcher$AppClassLoader@18b4aac2 ，这说明<strong>系统类加载器是全局唯一的</strong></li>
</ul>
<h2 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6">双亲委派机制</a></h2><h3 id="双亲委派机制原理"><a href="#双亲委派机制原理" class="headerlink" title="双亲委派机制原理"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86">双亲委派机制原理</a></h3><p>ava虚拟机对class文件采用的是<strong>按需加载</strong>的方式，也就是说当需要使用该类时才会将它的class文件加载到内存生成class对象。而且加载某个类的class文件时，Java虚拟机采用的是双亲委派模式，即把请求交由父类处理，它是一种任务委派模式</p>
<ol>
<li><p>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</p>
</li>
<li><p>如果父类加载器还存在其父类加载器，则进一步向上委托，依次递归，请求最终将到达顶层的启动类加载器；</p>
</li>
<li><p>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派模式。</p>
</li>
<li><p>父类加载器一层一层往下分配任务，如果子类加载器能加载，则加载此类，如果将加载任务分配至系统类加载器也无法加载此类，则抛出异常</p>
<p><img src="/2020/01/03/JVM-Overview/0020.png"></p>
</li>
</ol>
<h3 id="双亲委派机制代码演示"><a href="#双亲委派机制代码演示" class="headerlink" title="双亲委派机制代码演示"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA">双亲委派机制代码演示</a></h3><h4 id="举例1"><a href="#举例1" class="headerlink" title="举例1"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E4%B8%BE%E4%BE%8B1">举例1</a></h4><p>1、我们自己建立一个 java.lang.String 类，写上 static 代码块</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是自定义的String类的静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、在另外的程序中加载 String 类，看看加载的 String 类是 JDK 自带的 String 类，还是我们自己编写的 String 类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        java.lang.String str = <span class="keyword">new</span> java.lang.String();</span><br><span class="line">        System.out.println(<span class="string">&quot;hello,atguigu.com&quot;</span>);</span><br><span class="line"></span><br><span class="line">        StringTest test = <span class="keyword">new</span> StringTest();</span><br><span class="line">        System.out.println(test.getClass().getClassLoader());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">hello</span>,atguigu.com</span><br><span class="line"><span class="attribute">sun</span>.misc.Launcher$AppClassLoader@<span class="number">18</span>b<span class="number">4</span>aac<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>程序并没有输出我们静态代码块中的内容，可见仍然加载的是 JDK 自带的 String 类。</p>
<p>把刚刚的类改一下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">String</span> </span>&#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">static</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;我是自定义的String类的静态代码块&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//错误: 在类 java.lang.String 中找不到 main 方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello,String&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/03/JVM-Overview/0021.png"></p>
<p>由于双亲委派机制一直找父类，所以最后找到了Bootstrap ClassLoader，Bootstrap ClassLoader找到的是 JDK 自带的 String 类，在那个String类中并没有 main() 方法，所以就报了上面的错误。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShkStart</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">java.lang.SecurityException: Prohibited <span class="keyword">package</span> name: java.lang</span><br><span class="line">    at java.lang.ClassLoader.preDefineClass(ClassLoader.java:<span class="number">662</span>)</span><br><span class="line">    at java.lang.ClassLoader.defineClass(ClassLoader.java:<span class="number">761</span>)</span><br><span class="line">    at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:<span class="number">142</span>)</span><br><span class="line">    at java.net.URLClassLoader.defineClass(URLClassLoader.java:<span class="number">467</span>)</span><br><span class="line">    at java.net.URLClassLoader.access$<span class="number">100</span>(URLClassLoader.java:<span class="number">73</span>)</span><br><span class="line">    at java.net.URLClassLoader$<span class="number">1.</span>run(URLClassLoader.java:<span class="number">368</span>)</span><br><span class="line">    at java.net.URLClassLoader$<span class="number">1.</span>run(URLClassLoader.java:<span class="number">362</span>)</span><br><span class="line">    at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">    at java.net.URLClassLoader.findClass(URLClassLoader.java:<span class="number">361</span>)</span><br><span class="line">    at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">424</span>)</span><br><span class="line">    at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:<span class="number">335</span>)</span><br><span class="line">    at java.lang.ClassLoader.loadClass(ClassLoader.java:<span class="number">357</span>)</span><br><span class="line">    at sun.launcher.LauncherHelper.checkAndLoadMain(LauncherHelper.java:<span class="number">495</span>)</span><br><span class="line">Error: A JNI error has occurred, please check your installation and <span class="keyword">try</span> again</span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> </span><br><span class="line">Process finished with exit code <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>即使类名没有重复，也禁止使用java.lang这种包名。这是一种保护机制</p>
<h4 id="举例3"><a href="#举例3" class="headerlink" title="举例3"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E4%B8%BE%E4%BE%8B3">举例3</a></h4><p>当我们加载jdbc.jar 用于实现数据库连接的时候</p>
<ol>
<li>我们现在程序中需要用到SPI接口，而SPI接口属于rt.jar包中Java核心api</li>
<li>然后使用双清委派机制，引导类加载器把rt.jar包加载进来，而rt.jar包中的SPI存在一些接口，接口我们就需要具体的实现类了</li>
<li>具体的实现类就涉及到了某些第三方的jar包了，比如我们加载SPI的实现类jdbc.jar包【首先我们需要知道的是 jdbc.jar是基于SPI接口进行实现的】</li>
<li>第三方的jar包中的类属于系统类加载器来加载</li>
<li>从这里面就可以看到SPI核心接口由引导类加载器来加载，SPI具体实现类由系统类加载器来加载</li>
</ol>
<p><img src="/2020/01/03/JVM-Overview/0022.png"></p>
<h3 id="双亲委派机制优势"><a href="#双亲委派机制优势" class="headerlink" title="双亲委派机制优势"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6%E4%BC%98%E5%8A%BF">双亲委派机制优势</a></h3><p>通过上面的例子，我们可以知道，双亲机制可以</p>
<ol>
<li><p>避免类的重复加载</p>
</li>
<li><p>保护程序安全，防止核心API被随意篡改</p>
<ul>
<li><p>自定义类：自定义java.lang.String 没有被加载。</p>
</li>
<li><p>自定义类：java.lang.ShkStart（报错：阻止创建 java.lang开头的类）</p>
</li>
</ul>
</li>
</ol>
<h2 id="沙箱安全机制"><a href="#沙箱安全机制" class="headerlink" title="沙箱安全机制"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E6%B2%99%E7%AE%B1%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6">沙箱安全机制</a></h2><ol>
<li>自定义String类时：在加载自定义String类的时候会率先使用引导类加载器加载，而引导类加载器在加载的过程中会先加载jdk自带的文件（rt.jar包中java.lang.String.class），报错信息说没有main方法，就是因为加载的是rt.jar包中的String类。</li>
<li>这样可以保证对java核心源代码的保护，这就是沙箱安全机制。</li>
</ol>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%85%B6%E4%BB%96">其他</a></h2><h3 id="如何判断两个class对象是否相同？"><a href="#如何判断两个class对象是否相同？" class="headerlink" title="如何判断两个class对象是否相同？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%A6%82%E4%BD%95%E5%88%A4%E6%96%AD%E4%B8%A4%E4%B8%AAclass%E5%AF%B9%E8%B1%A1%E6%98%AF%E5%90%A6%E7%9B%B8%E5%90%8C%EF%BC%9F">如何判断两个class对象是否相同？</a></h3><p>在JVM中表示两个class对象是否为同一个类存在两个必要条件：</p>
<ol>
<li>类的完整类名必须一致，包括包名</li>
<li><strong>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同</strong></li>
<li>换句话说，在JVM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载它们的ClassLoader实例对象不同，那么这两个类对象也是不相等的</li>
</ol>
<h3 id="对类加载器的引用"><a href="#对类加载器的引用" class="headerlink" title="对类加载器的引用"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC2%E7%AB%A0-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F?id=%E5%AF%B9%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E5%BC%95%E7%94%A8">对类加载器的引用</a></h3><ol>
<li>JVM必须知道一个类型是由启动加载器加载的还是由用户类加载器加载的</li>
<li><strong>如果一个类型是由用户类加载器加载的，那么JVM会将这个类加载器的一个引用作为类型信息的一部分保存在方法区中</strong></li>
<li>当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的（后面讲）</li>
</ol>
<p><a href="https://youthlql.gitee.io/javayouth/#/?id=java">https://youthlql.gitee.io/javayouth/#/?id=java</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>OS</title>
    <url>/2020/12/28/OS/</url>
    <content><![CDATA[<h4 id="学习计划"><a href="#学习计划" class="headerlink" title="学习计划"></a>学习计划</h4><p>MIT6.S081实验 + 操作系统导论</p>
<p><a href="https://github.com/woai3c/MIT6.828">https://github.com/woai3c/MIT6.828</a></p>
<p><a href="https://pdos.csail.mit.edu/6.828/2018/index.html">https://pdos.csail.mit.edu/6.828/2018/index.html</a></p>
<p><a href="https://www.zhihu.com/question/40973610">https://www.zhihu.com/question/40973610</a></p>
<p>RISC-V 微处理器</p>
<p>xv6</p>
<h5 id="实验环境配置"><a href="#实验环境配置" class="headerlink" title="实验环境配置"></a>实验环境配置</h5><p><a href="https://zhuanlan.zhihu.com/p/343655412">https://zhuanlan.zhihu.com/p/343655412</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/272199762">https://zhuanlan.zhihu.com/p/272199762</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/331492444">https://zhuanlan.zhihu.com/p/331492444</a></p>
<p><a href="https://www.bilibili.com/video/BV11K4y127Qk?from=search&amp;seid=8628043749223720261">https://www.bilibili.com/video/BV11K4y127Qk?from=search&amp;seid=8628043749223720261</a></p>
<p>错误1</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>glib<span class="string">-2</span>.48 gthread<span class="string">-2</span>.0 is required to compile QEMU</span><br><span class="line"></span><br><span class="line">处理</span><br><span class="line">sudo apt-get install libglib2.0-dev</span><br></pre></td></tr></table></figure>

<p>错误2</p>
<figure class="highlight subunit"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ERROR: </span>pixman &gt;= 0.21.8 not present.</span><br><span class="line">       Please install the pixman devel package.</span><br><span class="line">       </span><br><span class="line">处理</span><br><span class="line">sudo apt-get install libpixman<span class="string">-1</span>-dev</span><br></pre></td></tr></table></figure>



<h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><ol>
<li><p>在user目录下创建copy.c</p>
</li>
<li><p>在Makefile 152行添加配置</p>
<img src="/2020/12/28/OS/20200919151509556.png" style="zoom:50%;"></li>
<li><p>测试添加程序</p>
<p>启动xv6后，执行copy</p>
</li>
</ol>
<p><a href="https://blog.csdn.net/u013577996/article/details/108680888">https://blog.csdn.net/u013577996/article/details/108680888</a></p>
<h5 id="课程学习"><a href="#课程学习" class="headerlink" title="课程学习"></a>课程学习</h5><h5 id="3-4内核执行任何内核指令"><a href="#3-4内核执行任何内核指令" class="headerlink" title="3.4内核执行任何内核指令"></a>3.4内核执行任何内核指令</h5><p>3.4 之前提到，设置处理器中kernel mode的bit位的指令是一条特殊权限指令，那么一个用户程序怎么才能让内核执行任何内核指令？因为现在切换到kernel mode的指令都是一条特殊权限指令了，对于用户程序来说也没法修改那个bit位</p>
<p>用户程序会通过系统调用来切换到kernel mode。当用户程序执行系统调用，会通过ECALL触发一个软中断（software interrupt），软中断会查询操作系统预先设定的中断向量表，并执行中断向量表中包含的中断处理程序。中断处理程序在内核中，这样就完成了user mode到kernel mode的切换，并执行用户程序想要执行的特殊权限指令？ </p>
<p><strong>针对这个回答，我的疑问是，怎么确保恶意程序不走这种系统调用呢</strong></p>
<h5 id="3-9-断点调试"><a href="#3-9-断点调试" class="headerlink" title="3.9 断点调试"></a>3.9 断点调试</h5><figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">一个窗口</span><br><span class="line"></span><br><span class="line">make <span class="attribute">CPUS</span>=1 qemu-gdb</span><br><span class="line"></span><br><span class="line">新开窗口 </span><br><span class="line"></span><br><span class="line">gdb-multiarch kernel/kernel</span><br><span class="line">target remote localhost:26000</span><br></pre></td></tr></table></figure>

<p><a href="https://zhuanlan.zhihu.com/p/331492444">https://zhuanlan.zhihu.com/p/331492444</a></p>
<p>GDB简单使用</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line">ctrl x <span class="selector-tag">a</span> 显示代码</span><br><span class="line"> <span class="selector-tag">b</span> 断点</span><br><span class="line"> r运行</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2020/12/28/OS/GDB_2021-05-11_22-43-21.png"></p>
<p><a href="https://www.bilibili.com/video/BV1ei4y1V758?from=search&amp;seid=4972450432119771986">https://www.bilibili.com/video/BV1ei4y1V758?from=search&amp;seid=4972450432119771986</a></p>
<h5 id="4-3页表"><a href="#4-3页表" class="headerlink" title="4.3页表"></a>4.3页表</h5><p><img src="/2020/12/28/OS/2021-05-13_pagetable.png"></p>
<p>在最高级的page directory中的PPN，包含了下一级page directory的物理内存地址，  第二个9bit用来索引中间级的page directory，第三个9bit用来索引最低级的page directory。在最低级page directory，我们还是可以得到44bit的PPN，这里包含了我们实际上想要翻译的物理page地址，然后再加上虚拟内存地址的12bit offset，就得到了56bit物理内存地址。</p>
<p>第一个level1有了Level2页表的物理地址，Level2的 PPN就是页表的偏移量,指向Level3的物理地址.</p>
<p><a href="https://www.bilibili.com/video/BV1zt4y1U7rq?from=search&amp;seid=11572648099017443360">https://www.bilibili.com/video/BV1zt4y1U7rq?from=search&amp;seid=11572648099017443360</a></p>
<h4 id="启动概览"><a href="#启动概览" class="headerlink" title="启动概览"></a>启动概览</h4><p><img src="/2020/12/28/OS/2021-04-13at1.36.29PM.png"></p>
<p>​    </p>
<p>简单来说 就是加电后，1。启动主板BIOS  》 2. BIOS初始化从磁盘中把加载程序bootloader 加载到内存中 》3.把磁盘镜像操作系统加载到内存中运行</p>
<p><strong>为什么不在第二步直接加载操作系统呢?</strong>  1. 为了兼容不同的文件系统  2. bootloader只能存 512字节，系统远大于它。 </p>
<p><a href="https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html">https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html</a></p>
<h5 id="BIOS初始化"><a href="#BIOS初始化" class="headerlink" title="BIOS初始化"></a>BIOS初始化</h5><ol>
<li>硬件自检POST,检测系统中（内存和显卡，软盘 ，影片 光盘 USB)等关键部件的存在和工作状态查找并执行显卡等接口卡BIOS,并进行设备初始化；</li>
<li>加载上述设备的第一个扇区（主引导扇区，Master Boot Record,or MBR）的512字节的内容读到内存固定地址0x7c00，这个内容就是bootloader,等待对Ucore操作系统的加载.</li>
</ol>
<h5 id="bootloader做的事情"><a href="#bootloader做的事情" class="headerlink" title="bootloader做的事情"></a>bootloader做的事情</h5><ol>
<li>从实模式切换到保护模式(protection mdoe) ，为后续操作系统的执行做准备。</li>
<li>从硬盘上读取kernel in ELF格式的ucore kernel(就是系统代码，跟在MBR后面的扇区)并放到内存中固定位置。</li>
<li>跳转到ucore OS的入口点(entry point)执行，这时候控制器交给了 ucore.</li>
</ol>
<h5 id="第二部细节-加载程序"><a href="#第二部细节-加载程序" class="headerlink" title="第二部细节 加载程序"></a>第二部细节 加载程序</h5><p>![](OS\2021-04-13at1.36.29 PM.png)</p>
<p>​    计算机可能有不止一个分区，每个分区有不同的系统，主引导记录来确定去哪个文件系统读加载程序</p>
<ol>
<li><p>BIOS启动过程</p>
<p>当计算机加电后，一般不直接执行操作系统，而是执行系统初始化软件完成基本IO初始化和引导加载功能(BIOS)。简单地说，系统初始化软件就是在操作系统内核运行之前运行的一段小软件。通过这段小软件，我们可以初始化硬件设备、建立系统的内存空间映射图，从而将系统的软硬件环境带到一个合适的状态，以便为最终调用操作系统内核准备好正确的环境。最终引导加载程序把操作系统内核映像加载到RAM中，并将系统控制权传递给它。 </p>
<p>对于绝大多数计算机系统而言，操作系统和应用软件是存放在磁盘（硬盘/软盘）、光盘、EPROM、ROM、Flash等可在掉电后继续保存数据的存储介质上。计算机启动后，CPU一开始会到一个特定的地址开始执行指令，这个特定的地址存放了系统初始化软件，负责完成计算机基本的IO初始化，这是系统加电后运行的第一段软件代码。对于Intel 80386的体系结构而言，PC机中的系统初始化软件由BIOS (Basic Input Output  System，即基本输入/输出系统，<strong>其本质是一个固化在主板Flash/CMOS上的软件</strong>)和位于软盘/硬盘引导扇区中的OS Boot  Loader（在ucore中的bootasm.S和bootmain.c）一起组成。BIOS实际上是被固化在计算机ROM（只读存储器）芯片上的一个特殊的软件，为上层软件提供最底层的、最直接的硬件控制与支持。更形象地说，BIOS就是PC计算机硬件与上层软件程序之间的一个”桥梁”，负责访问和控制硬件。 </p>
<p>以Intel  80386为例，计算机加电后，CPU从物理地址0xFFFFFFF0（由初始化的CS：EIP确定，此时CS和IP的值分别是0xF000和0xFFF0)）开始执行。在0xFFFFFFF0这里只是存放了一条跳转指令，通过跳转指令跳到BIOS例行程序起始点。BIOS做完计算机硬件自检和初始化后，会选择一个启动设备（例如软盘、硬盘、光盘等），并且读取该设备的第一扇区(即主引导扇区或启动扇区)到内存一个特定的地址0x7c00处，然后CPU控制权会转移到那个地址继续执行。至此BIOS的初始化工作做完了，进一步的工作交给了ucore的bootloader。</p>
</li>
<li><p>bootloader启动过程</p>
<p>BIOS将通过读取硬盘主引导扇区到内存，并转跳到对应内存中的位置执行bootloader。bootloader完成的工作包括：</p>
<ul>
<li>切换到保护模式，启用分段机制</li>
<li>读磁盘中ELF执行文件格式的ucore操作系统到内存</li>
<li>显示字符串信息</li>
<li>把控制权交给ucore操作系统</li>
</ul>
<p>对应其工作的实现文件在lab1中的boot目录下的三个文件asm.h、bootasm.S和bootmain.c。下面从原理上介绍完成上述工作的计算机系统硬件和软件背景知识。</p>
</li>
<li><p>操作系统启动过程</p>
<p>当bootloader通过读取硬盘扇区把ucore在系统加载到内存后，就转跳到ucore操作系统在内存中的入口位置（kern/init.c中的kern_init函数的起始地址），这样ucore就接管了整个控制权。当前的ucore功能很简单，只完成基本的内存管理和外设中断管理。ucore主要完成的工作包括：</p>
<ul>
<li>初始化终端；</li>
<li>显示字符串；</li>
<li>显示堆栈中的多层函数调用关系；</li>
<li>切换到保护模式，启用分段机制；</li>
<li>初始化中断控制器，设置中断描述符表，初始化时钟中断，使能整个系统的中断机制；</li>
<li>执行while（1）死循环。</li>
</ul>
<p>以后的实验中会大量涉及各个函数直接的调用关系，以及由于中断处理导致的异步现象，可能对大家实现操作系统和改正其中的错误有很大影响。而理解好函数调用关系的建立机制和中断处理机制，对后续实验会有很大帮助。下面就练习5涉及的函数栈调用关系和练习6中的中断机制的建立进行阐述。</p>
</li>
</ol>
<p><a href="https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html">https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html</a></p>
<h4 id="系统调用"><a href="#系统调用" class="headerlink" title="系统调用"></a>系统调用</h4><h5 id="POSIX"><a href="#POSIX" class="headerlink" title="POSIX"></a>POSIX</h5><p>Portable Operating System Interface of Unix(IEEE制定的一个标准族)</p>
<p>操作系统给上层提供的接口，macos,Linux都遵循这个接口。</p>
<p>内核态 0 ， 用户态 3         </p>
<p>GDT表存了DPL为0，用户访问CPL为3， 3 &gt; 0 没法访问。 </p>
<p>0x80到内核中</p>
<h4 id="中断、异常和系统调用"><a href="#中断、异常和系统调用" class="headerlink" title="中断、异常和系统调用"></a>中断、异常和系统调用</h4><img src="/2020/12/28/OS/2021-04-12191642.png" style="zoom:75%;">

<p>中断</p>
<p>硬件设对操作系统备的处理请求（缓存区里有数据，需要内核读走。或者缓冲区里数据用完了，需要内核补充新的数据）</p>
<p>异常</p>
<p>非法指令或者其他原因导致当前指令执行失败（程序出错后的处理请求）</p>
<p>系统调用</p>
<p>应用程序主动向操作系统发出的服务请求</p>
<h4 id="物理内存管理：-连续内存分配"><a href="#物理内存管理：-连续内存分配" class="headerlink" title="物理内存管理： 连续内存分配"></a>物理内存管理： 连续内存分配</h4><p>最先匹配（First Fit Allocation）：</p>
<p>空闲分区列表按地址顺序排序</p>
<p>分配过程时，搜索第一个合适的分区，如果有剩下的空闲分区，继续把空闲分区切割出来，所以会产生碎片。</p>
<p>释放分区时，检查是否可与临近的空闲分区合并</p>
<p>最佳匹配（Best Fit Allocation）</p>
<p>空闲分区列表按照 小到大排序</p>
<p>分配时，查找比需要分区大的最小的分区，可避免大的空闲分区被拆分，减少碎片大小。</p>
<p>释放时，超找并且合并临近地址的空闲分区（如果找到）</p>
<p><img src="/2020/12/28/OS/2021-04-1514-27-29.png" style="zoom: 67%;">Screenshot from </p>
<p>最差匹配(WORST Fit Allocation)</p>
<p>空闲分区列表按大到小排序</p>
<p>分配时，选最大的分区，后续找大分区比较难。</p>
<p>释放时，检查是否可与临近的空闲分区合并，进行可能的合并并调整空闲分区列表顺序。</p>
<p>伙伴系统</p>
<h4 id="非连续内存分配"><a href="#非连续内存分配" class="headerlink" title="非连续内存分配"></a>非连续内存分配</h4><ol>
<li><p>虚拟地址和物理地址的转换</p>
<p>软件实现  硬件实现</p>
</li>
<li><p>非连续分配的硬件辅助记者</p>
<p>段式存储管理（segmentation）: 分的比较大</p>
<p><img src="/2020/12/28/OS/2021-04-1516-01-54.png"></p>
<p>页式存储管理 （paging）</p>
<p>把物理地址空间划分为大小相同的基本分配单位，2的n次方，如512,4096</p>
</li>
</ol>
<p>linux启动 </p>
<p><a href="http://c.biancheng.net/view/1013.html">http://c.biancheng.net/view/1013.html</a></p>
<h4 id="linux目录结构"><a href="#linux目录结构" class="headerlink" title="linux目录结构"></a>linux目录结构</h4><table>
<thead>
<tr>
<th>目录</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>/bin</td>
<td>存放二进制可执行文件(ls,cat,mkdir等)，常用命令一般都在这里</td>
</tr>
<tr>
<td>/etc</td>
<td>存放系统管理和配置文件</td>
</tr>
<tr>
<td>/home</td>
<td>存放所有用户文件的根目录，是用户主目录的基点，比如用户user的主目录就是 /home/user</td>
</tr>
<tr>
<td>/usr</td>
<td>用于存放系统应用程序，比较重要的目录/usr/local 本地系统管理员软件安装目录</td>
</tr>
<tr>
<td>/opt</td>
<td><code>额外安装的可选应用程序包所放置的位置 </code></td>
</tr>
<tr>
<td>/proc</td>
<td>虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息。</td>
</tr>
<tr>
<td>/root</td>
<td><code>超级用户(系统管理员)的主目录 </code></td>
</tr>
<tr>
<td>/sbin</td>
<td>存放二进制可执行文件，只有root才能访问</td>
</tr>
<tr>
<td>/dev</td>
<td>用于存放设备文件</td>
</tr>
<tr>
<td>/mnt</td>
<td>系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系 统。</td>
</tr>
<tr>
<td>/boot</td>
<td><code>存放用于系统引导时使用的各种文件 </code></td>
</tr>
<tr>
<td>/lib</td>
<td><code>存放跟文件系统中的程序运行所需要的共享库及内核模块 </code></td>
</tr>
<tr>
<td>/var</td>
<td><code>用于存放运行时需要改变数据的文件 </code></td>
</tr>
</tbody></table>
<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>进程调度 : FIFO , Priority</p>
<h5 id="进程切换"><a href="#进程切换" class="headerlink" title="进程切换"></a>进程切换</h5><p>进程当前的状态存放到PCB(Process Control Block)中，获取下一个需要执行进程的PCB信息，切换进程。</p>
<p><img src="/2020/12/28/OS/2021-04-1612-09-25.png"></p>
<h5 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h5><p><img src="/2020/12/28/OS/2021-04-1612-16-25.png"></p>
<p>线程 指令的切换，映射表不用切换    </p>
<h6 id="2个线程用一个栈的情况"><a href="#2个线程用一个栈的情况" class="headerlink" title="2个线程用一个栈的情况"></a>2个线程用一个栈的情况</h6><p><img src="/2020/12/28/OS/2021-04-1614-27-23.png"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第一个Yield</span></span><br><span class="line"><span class="keyword">void</span> <span class="function"><span class="title">Yield</span>(<span class="params"></span>)</span>&#123; </span><br><span class="line">	找到<span class="number">300</span>；</span><br><span class="line">	jmp <span class="number">300</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第二个Yield</span></span><br><span class="line"><span class="keyword">void</span> <span class="function"><span class="title">Yield</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	找到 ? ; <span class="number">204</span></span><br><span class="line">	jmp ? ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>按照    (1)  -&gt; (2) -&gt; (3)的顺序执行，执行玩D()中的Yield()回到B()中，到了 右括号ret 出栈，出去的是404,正确的情况时时出204</p>
<h6 id="两个线程-两个栈"><a href="#两个线程-两个栈" class="headerlink" title="两个线程 两个栈"></a>两个线程 两个栈</h6><p><img src="/2020/12/28/OS/2021-04-1615-11-08.png"></p>
<p>jmp 204去掉：否则会执行两次</p>
<h6 id="用户程序-内核程序调用"><a href="#用户程序-内核程序调用" class="headerlink" title="用户程序 内核程序调用"></a>用户程序 内核程序调用</h6><img src="/2020/12/28/OS/2021-04-1615-59-43.png" style="zoom:50%;">

<h6 id="多核处理"><a href="#多核处理" class="headerlink" title="多核处理"></a>多核处理</h6><img src="/2020/12/28/OS/2021-04-1616-01-19.png" style="zoom:80%;">

<img src="/2020/12/28/OS/2021-04-1616-01-07.png" style="zoom:50%;">



<p>多核情况共用一个MMU,减少切换资源调用。</p>
<p>进程线程区别</p>
<p>进程 : 有很大的独立性</p>
<p>线程 :  所有线程都有完全一样的地址空间,意味着它们也共享同样的全局变量。由于线程可以访问进程地址空间的每一个内存地址，所以一个线程可以读、写甚至清除另一个线程的堆栈。</p>
<p>每个进程中的内容 : 地址空间  全局变量 打开文件 子进程    即将发生的定时器    信号与信号处理程序</p>
<p>每个线程中的内容：程序计数器、寄存器、堆栈、状态.</p>
<h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><p>原子性</p>
<p>原子性是指一系列操作不可被中断的特性,这一系列操作要么全部执行完成，要么全部没有执行,不存在部分执行部分未执行的情况</p>
<h5 id="互斥量"><a href="#互斥量" class="headerlink" title="互斥量"></a>互斥量</h5><p>​            互斥量是最简单的线程同步的方法,处于两态之一的变量:解锁和加锁,两个状态可以保证资源访问的串行</p>
<h5 id="自旋锁与自适应自旋"><a href="#自旋锁与自适应自旋" class="headerlink" title="自旋锁与自适应自旋"></a>自旋锁与自适应自旋</h5><ul>
<li> 自旋锁</li>
</ul>
<p>​            自旋锁的线程会反复检查锁变量是否可用,自旋锁不会让出CPU，是一种忙等待状态,</p>
<p>​            自旋锁避免了进程或线程上下文切换的开销</p>
<p>​            自旋锁不适合在单核CPU使用</p>
<p>​            自旋锁的线程会反复检查锁变量是否可用</p>
<ul>
<li><p>自适应自旋</p>
<p>提到了互斥同步对性能最大的影响是阻塞的实现，挂起线程和恢 复线程的操作都需要转入内核态中完成，这些操作给Java虚拟机的并发性能带来了很大的压力。同 时，虚拟机的开发团队也注意到在许多应用上，共享数据的锁定状态只会持续很短的一段时间，为了 这段时间去挂起和恢复线程并不值得。现在绝大多数的个人电脑和服务器都是多路(核)处理器系 统，如果物理机器有一个以上的处理器或者处理器核心，能让两个或以上的线程同时并行执行，我们 就可以让后面请求锁的那个线程“稍等一会”，但不放弃处理器的执行时间，看看持有锁的线程是否很 快就会释放锁。为了让线程等待，我们只须让线程执行一个忙循环(自旋)，这项技术就是所谓的自 旋锁。</p>
<p>自旋锁在JDK 1.4.2中就已经引入，只不过默认是关闭的，可以使用-XX:+UseSpinning参数来开 启，在JDK 6中就已经改为默认开启了。自旋等待不能代替阻塞，且先不说对处理器数量的要求，自 旋等待本身虽然避免了线程切换的开销，但它是要占用处理器时间的，所以如果锁被占用的时间很 短，自旋等待的效果就会非常好，反之如果锁被占用的时间很长，那么自旋的线程只会白白消耗处理 器资源，而不会做任何有价值的工作，这就会带来性能的浪费。因此自旋等待的时间必须有一定的限 度，如果自旋超过了限定的次数仍然没有成功获得锁，就应当使用传统的方式去挂起线程。自旋次数 的默认值是十次，用户也可以使用参数-XX:PreBlockSp in来自行更改。</p>
<p>不过无论是默认值还是用户指定的自旋次数，对整个Java虚拟机中所有的锁来说都是相同的。在 JDK 6中对自旋锁的优化，引入了自适应的自旋。自适应意味着自旋的时间不再是固定的了，而是由 前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定的。如果在同一个锁对象上，自旋等待刚 刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也很有可能再次成 功，进而允许自旋等待持续相对更长的时间，比如持续100次忙循环。另一方面，如果对于某个锁，自 旋很少成功获得过锁，那在以后要获取这个锁时将有可能直接省略掉自旋过程，以避免浪费处理器资 源。有了自适应自旋，随着程序运行时间的增长及性能监控信息的不断完善，虚拟机对程序锁的状况 预测就会越来越精准，虚拟机就会变得越来越“聪明”了。</p>
</li>
</ul>
<h5 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h5><p>​            读写锁是一种特殊的自旋锁,</p>
<p>​            允许多个读者同时访问资源以提高读性能</p>
<p>​            对于写操作则是互斥的</p>
<h5 id="条件变量"><a href="#条件变量" class="headerlink" title="条件变量"></a>条件变量</h5><p>​            条件变量是一种相对复杂的线程同步方法    </p>
<p>​            条件变量允许线程睡眠，直到满足某种条件</p>
<p>​            当满足条件时，可以向该线程信号，通知唤醒</p>
<h4 id="mooc-os-lab"><a href="#mooc-os-lab" class="headerlink" title="mooc-os-lab"></a>mooc-os-lab</h4><p>[现代操作系统] 示例 p55</p>
<p>先学习(现代操作系统) 陈渝 向勇</p>
<p><a href="https://www.bilibili.com/video/BV1js411b7vg?from=search&amp;seid=2361361014547524697">https://www.bilibili.com/video/BV1js411b7vg?from=search&amp;seid=2361361014547524697</a></p>
<p>配套书： 操作系统概念(第七版) ， 操作系统-精髓与设计原理（第七版）william stallings</p>
<h5 id="实验环境配置-1"><a href="#实验环境配置-1" class="headerlink" title="实验环境配置"></a>实验环境配置</h5><p><a href="https://www.bilibili.com/video/BV1Zz4y1d7BK?from=search&amp;seid=14777231705696776183">https://www.bilibili.com/video/BV1Zz4y1d7BK?from=search&amp;seid=14777231705696776183</a></p>
<p><a href="http://os.cs.tsinghua.edu.cn/oscourse/OS2020spring">http://os.cs.tsinghua.edu.cn/oscourse/OS2020spring</a></p>
<p><a href="https://github.com/LearningOS/ucore_os_lab">ucore实验基准源代码</a></p>
<p><a href="https://www.bilibili.com/s/video/BV1Zz4y1d7BK">https://www.bilibili.com/s/video/BV1Zz4y1d7BK</a></p>
<p>ubuntu窗口调整</p>
<p>device -&gt; Insert Guest addtions CD Image</p>
<p><a href="https://blog.csdn.net/u012631731/article/details/79548621">https://blog.csdn.net/u012631731/article/details/79548621</a></p>
<p>修改Ubuntu硬盘大小</p>
<p><a href="https://my.oschina.net/u/4388335/blog/3321852">https://my.oschina.net/u/4388335/blog/3321852</a></p>
<p> windows ubuntu文件夹共享</p>
<p><a href="https://www.jianshu.com/p/4e73fd1c0c74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation">https://www.jianshu.com/p/4e73fd1c0c74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>
<p>并发 : 多个事件在分段被单个CPU分段执行。</p>
<p>并行： 多个CPU同时处理多个任务。</p>
<h4 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h4><h5 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h5><p><a href="https://fishc.com.cn/forum-39-1.html">https://fishc.com.cn/forum-39-1.html</a></p>
<p><a href="https://www.bilibili.com/video/av22872043/?p=2&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/av22872043/?p=2&amp;spm_id_from=pageDriver</a></p>
<h5 id="GCC内联汇编"><a href="#GCC内联汇编" class="headerlink" title="GCC内联汇编"></a>GCC内联汇编</h5><p>C语言中加入 汇编代码</p>
]]></content>
      <categories>
        <category>OS</category>
      </categories>
  </entry>
  <entry>
    <title>TouchEvent2</title>
    <url>/2017/08/13/TouchEvent2/</url>
    <content><![CDATA[<p> <strong>Android touch Event</strong></p>
<p> 事件分发其实就是对MotionEvent事件得分发过程,当MotionEvet产生后，系统需要把这个事件传递给一个具体得View,而这个传递得过程就是分发过程</p>
<p>概述</p>
<p><strong>为什么会有事件分发机制?</strong></p>
<p>Android得View是树形结构，绘制得时候遍历子View,他们必定是会重合分布，那么当我<br>们点击得时候，是应该谁来响应这个事件呢? 然后才有事件分发</p>
<blockquote>
<p>Activity －&gt; PhoneWindow －&gt; DecorView －&gt; ViewGroup －&gt; … －&gt; View</p>
</blockquote>
<p>整个分发的宏观过程,<em>Android群英传</em>　这本书描述的很清晰,然后配合　Android开发艺术探索，的源码分析，简直天作之合．</p>
<p>主要方法</p>
<h4 id="method"><a href="#method" class="headerlink" title="method"></a>method</h4><p>事件分发机制事由　Activity -&gt; ViewGroup -&gt; View　方向上得传递<br>通过三个很重要得方法共同完成 dispatchTouchEvent、onInterceptTouchEvent、onTouchEvent</p>
<ul>
<li>dispatchTouchEvent()</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>介绍</th>
</tr>
</thead>
<tbody><tr>
<td>使用对象</td>
<td>Activity、ViewGroup、View</td>
</tr>
<tr>
<td>作用</td>
<td>事件分发</td>
</tr>
</tbody></table>
<ul>
<li>onInterceptTouchEvent()</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>介绍</th>
</tr>
</thead>
<tbody><tr>
<td>作用</td>
<td>拦截事件</td>
</tr>
<tr>
<td>调用时刻</td>
<td>在ViewGroup的dispatchTouchEvent()内部调用</td>
</tr>
</tbody></table>
<ul>
<li>onTouchEvent()</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>介绍</th>
</tr>
</thead>
<tbody><tr>
<td>使用对象</td>
<td>Activity、ViewGroup、View</td>
</tr>
<tr>
<td>作用</td>
<td>事件消费</td>
</tr>
<tr>
<td>调用时刻</td>
<td>在dispatchTouchEvent()内部调用</td>
</tr>
</tbody></table>
<p>三个方法的关系</p>
<p>  可以用 singwhatiwanna 写的伪代码表示:</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public boolean dispatch<span class="constructor">TouchEvent(MotionEvent <span class="params">ev</span>)</span>&#123;</span><br><span class="line">    boolean consume = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(on<span class="constructor">InterceptTouchEvent(<span class="params">ev</span>)</span>)&#123;</span><br><span class="line">        	consume = on<span class="constructor">TouchEvent(<span class="params">ev</span>)</span>;	    </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">     	 consume = child.dispatch<span class="constructor">TouchEvent(<span class="params">ev</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    return consume;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>  dispatchTouchEvent　：对于ViewGroup，点击事件产生后首先会传递给它，</li>
<li>  onInterceptTouchEvent(ev）: 如果方法返回true,则拦截事件,事件就交给当前ViewGroup处理,接着调用当前<br>　　　　ViewGroup的onTouchEvent.如果返回flase,就交给它的子元素,子元素的dispatchTouchEvent就会调用</li>
<li> onTouchEvent : 如果返回false，那么父容器的onTouchEvent将会被调用.</li>
</ul>
<h4 id="Activity-ViewGroup-View"><a href="#Activity-ViewGroup-View" class="headerlink" title="Activity ViewGroup View"></a>Activity ViewGroup View</h4><h5 id="source-code"><a href="#source-code" class="headerlink" title="source code"></a>source code</h5><ul>
<li><p>Activity</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public boolean dispatch<span class="constructor">TouchEvent(MotionEvent <span class="params">ev</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ev.get<span class="constructor">Action()</span><span class="operator"> == </span>MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        on<span class="constructor">UserInteraction()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (get<span class="constructor">Window()</span>.super<span class="constructor">DispatchTouchEvent(<span class="params">ev</span>)</span>) &#123;</span><br><span class="line">        return <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    return on<span class="constructor">TouchEvent(<span class="params">ev</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>ViewGroup</p>
</li>
</ul>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">boolean</span> <span class="title">dispatchTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mInputEventConsistencyVerifier.onTouchEvent(ev, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// If the event targets the accessibility focused view and this is it, start</span></span><br><span class="line">        <span class="comment">// normal event dispatch. Maybe a descendant is what will handle the click.</span></span><br><span class="line">        <span class="keyword">if</span> (ev.isTargetAccessibilityFocus() &amp;&amp; isAccessibilityFocusedViewOrHost()) &#123;</span><br><span class="line">            ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> handled = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (onFilterTouchEventForSecurity(ev)) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> action = ev.getAction();</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> actionMasked = action &amp; MotionEvent.ACTION_MASK;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Handle an initial down.</span></span><br><span class="line">            <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">                <span class="comment">// Throw away all previous state when starting a new touch gesture.</span></span><br><span class="line">                <span class="comment">// The framework may have dropped the up or cancel event for the previous gesture</span></span><br><span class="line">                <span class="comment">// due to an app switch, ANR, or some other state change.</span></span><br><span class="line">                cancelAndClearTouchTargets(ev);</span><br><span class="line">                resetTouchState();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for interception.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> intercepted;</span><br><span class="line">            <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                    || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">boolean</span> disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (!disallowIntercept) &#123;</span><br><span class="line">                    intercepted = onInterceptTouchEvent(ev);</span><br><span class="line">                    ev.setAction(action); <span class="comment">// restore action in case it was changed</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    intercepted = <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// There are no touch targets and this action is not an initial down</span></span><br><span class="line">                <span class="comment">// so this view group continues to intercept touches.</span></span><br><span class="line">                intercepted = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// If intercepted, start normal event dispatch. Also if there is already</span></span><br><span class="line">            <span class="comment">// a view that is handling the gesture, do normal event dispatch.</span></span><br><span class="line">            <span class="keyword">if</span> (intercepted || mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for cancelation.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> canceled = resetCancelNextUpFlag(<span class="keyword">this</span>)</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_CANCEL;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update list of touch targets for pointer down, if needed.</span></span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">boolean</span> split = (mGroupFlags &amp; FLAG_SPLIT_MOTION_EVENTS) != <span class="number">0</span>;</span><br><span class="line">            TouchTarget newTouchTarget = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">boolean</span> alreadyDispatchedToNewTouchTarget = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (!canceled &amp;&amp; !intercepted) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// If the event is targeting accessibility focus we give it to the</span></span><br><span class="line">                <span class="comment">// view that has accessibility focus and if it does not handle it</span></span><br><span class="line">                <span class="comment">// we clear the flag and dispatch the event to all children as usual.</span></span><br><span class="line">                <span class="comment">// We are looking up the accessibility focused host to avoid keeping</span></span><br><span class="line">                <span class="comment">// state since these events are very rare.</span></span><br><span class="line">                View childWithAccessibilityFocus = ev.isTargetAccessibilityFocus()</span><br><span class="line">                        ? findChildWithAccessibilityFocus() : <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (actionMasked == MotionEvent.ACTION_DOWN</span><br><span class="line">                        || (split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_DOWN)</span><br><span class="line">                        || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex(); <span class="comment">// always 0 for down</span></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> idBitsToAssign = split ? <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex)</span><br><span class="line">                            : TouchTarget.ALL_POINTER_IDS;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// Clean up earlier touch targets for this pointer id in case they</span></span><br><span class="line">                    <span class="comment">// have become out of sync.</span></span><br><span class="line">                    removePointersFromTouchTargets(idBitsToAssign);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">final</span> <span class="keyword">int</span> childrenCount = mChildrenCount;</span><br><span class="line">                    <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; childrenCount != <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">float</span> x = ev.getX(actionIndex);</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">float</span> y = ev.getY(actionIndex);</span><br><span class="line">                        <span class="comment">// Find a child that can receive the event.</span></span><br><span class="line">                        <span class="comment">// Scan children from front to back.</span></span><br><span class="line">                        <span class="keyword">final</span> ArrayList&lt;View&gt; preorderedList = buildTouchDispatchChildList();</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">boolean</span> customOrder = preorderedList == <span class="keyword">null</span></span><br><span class="line">                                &amp;&amp; isChildrenDrawingOrderEnabled();</span><br><span class="line">                        <span class="keyword">final</span> View[] children = mChildren;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> i = childrenCount - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                            <span class="keyword">final</span> <span class="keyword">int</span> childIndex = getAndVerifyPreorderedIndex(</span><br><span class="line">                                    childrenCount, i, customOrder);</span><br><span class="line">                            <span class="keyword">final</span> View child = getAndVerifyPreorderedView(</span><br><span class="line">                                    preorderedList, children, childIndex);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// If there is a view that has accessibility focus we want it</span></span><br><span class="line">                            <span class="comment">// to get the event first and if not handled we will perform a</span></span><br><span class="line">                            <span class="comment">// normal dispatch. We may do a double iteration but this is</span></span><br><span class="line">                            <span class="comment">// safer given the timeframe.</span></span><br><span class="line">                            <span class="keyword">if</span> (childWithAccessibilityFocus != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (childWithAccessibilityFocus != child) &#123;</span><br><span class="line">                                    <span class="keyword">continue</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                childWithAccessibilityFocus = <span class="keyword">null</span>;</span><br><span class="line">                                i = childrenCount - <span class="number">1</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> (!child.canReceivePointerEvents()</span><br><span class="line">                                    || !isTransformedTouchPointInView(x, y, child, <span class="keyword">null</span>)) &#123;</span><br><span class="line">                                ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                                <span class="keyword">continue</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            newTouchTarget = getTouchTarget(child);</span><br><span class="line">                            <span class="keyword">if</span> (newTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                <span class="comment">// Child is already receiving touch within its bounds.</span></span><br><span class="line">                                <span class="comment">// Give it the new pointer in addition to the ones it is handling.</span></span><br><span class="line">                                newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            resetCancelNextUpFlag(child);</span><br><span class="line">                            <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, <span class="keyword">false</span>, child, idBitsToAssign)) &#123;</span><br><span class="line">                                <span class="comment">// Child wants to receive touch within its bounds.</span></span><br><span class="line">                                mLastTouchDownTime = ev.getDownTime();</span><br><span class="line">                                <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) &#123;</span><br><span class="line">                                    <span class="comment">// childIndex points into presorted list, find original index</span></span><br><span class="line">                                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; childrenCount; j++) &#123;</span><br><span class="line">                                        <span class="keyword">if</span> (children[childIndex] == mChildren[j]) &#123;</span><br><span class="line">                                            mLastTouchDownIndex = j;</span><br><span class="line">                                            <span class="keyword">break</span>;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                    mLastTouchDownIndex = childIndex;</span><br><span class="line">                                &#125;</span><br><span class="line">                                mLastTouchDownX = ev.getX();</span><br><span class="line">                                mLastTouchDownY = ev.getY();</span><br><span class="line">                                newTouchTarget = addTouchTarget(child, idBitsToAssign);</span><br><span class="line">                                alreadyDispatchedToNewTouchTarget = <span class="keyword">true</span>;</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// The accessibility focus didn&#x27;t handle the event, so clear</span></span><br><span class="line">                            <span class="comment">// the flag and do a normal dispatch to all children.</span></span><br><span class="line">                            ev.setTargetAccessibilityFocus(<span class="keyword">false</span>);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (preorderedList != <span class="keyword">null</span>) preorderedList.clear();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (newTouchTarget == <span class="keyword">null</span> &amp;&amp; mFirstTouchTarget != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// Did not find a child to receive the event.</span></span><br><span class="line">                        <span class="comment">// Assign the pointer to the least recently added target.</span></span><br><span class="line">                        newTouchTarget = mFirstTouchTarget;</span><br><span class="line">                        <span class="keyword">while</span> (newTouchTarget.next != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            newTouchTarget = newTouchTarget.next;</span><br><span class="line">                        &#125;</span><br><span class="line">                        newTouchTarget.pointerIdBits |= idBitsToAssign;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Dispatch to touch targets.</span></span><br><span class="line">            <span class="keyword">if</span> (mFirstTouchTarget == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// No touch targets so treat this as an ordinary view.</span></span><br><span class="line">                handled = dispatchTransformedTouchEvent(ev, canceled, <span class="keyword">null</span>,</span><br><span class="line">                        TouchTarget.ALL_POINTER_IDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// Dispatch to touch targets, excluding the new touch target if we already</span></span><br><span class="line">                <span class="comment">// dispatched to it.  Cancel touch targets if necessary.</span></span><br><span class="line">                TouchTarget predecessor = <span class="keyword">null</span>;</span><br><span class="line">                TouchTarget <span class="keyword">target</span> = mFirstTouchTarget;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">target</span> != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">final</span> TouchTarget next = <span class="keyword">target</span>.next;</span><br><span class="line">                    <span class="keyword">if</span> (alreadyDispatchedToNewTouchTarget &amp;&amp; <span class="keyword">target</span> == newTouchTarget) &#123;</span><br><span class="line">                        handled = <span class="keyword">true</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">final</span> <span class="keyword">boolean</span> cancelChild = resetCancelNextUpFlag(<span class="keyword">target</span>.child)</span><br><span class="line">                                || intercepted;</span><br><span class="line">                        <span class="keyword">if</span> (dispatchTransformedTouchEvent(ev, cancelChild,</span><br><span class="line">                                <span class="keyword">target</span>.child, <span class="keyword">target</span>.pointerIdBits)) &#123;</span><br><span class="line">                            handled = <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span> (cancelChild) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (predecessor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                                mFirstTouchTarget = next;</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                predecessor.next = next;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">target</span>.recycle();</span><br><span class="line">                            <span class="keyword">target</span> = next;</span><br><span class="line">                            <span class="keyword">continue</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    predecessor = <span class="keyword">target</span>;</span><br><span class="line">                    <span class="keyword">target</span> = next;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update list of touch targets for pointer up or cancel, if needed.</span></span><br><span class="line">            <span class="keyword">if</span> (canceled</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_UP</span><br><span class="line">                    || actionMasked == MotionEvent.ACTION_HOVER_MOVE) &#123;</span><br><span class="line">                resetTouchState();</span><br><span class="line">            &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(split &amp;&amp; actionMasked == MotionEvent.ACTION_POINTER_UP)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> actionIndex = ev.getActionIndex();</span><br><span class="line">                <span class="keyword">final</span> <span class="keyword">int</span> idBitsToRemove = <span class="number">1</span> &lt;&lt; ev.getPointerId(actionIndex);</span><br><span class="line">                removePointersFromTouchTargets(idBitsToRemove);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!handled &amp;&amp; mInputEventConsistencyVerifier != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mInputEventConsistencyVerifier.onUnhandledEvent(ev, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> handled;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>View</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public boolean dispatch<span class="constructor">TouchEvent(MotionEvent <span class="params">event</span>)</span> &#123;</span><br><span class="line">    <span class="comment">// If the event should be handled by accessibility focus first.</span></span><br><span class="line">    <span class="keyword">if</span> (event.is<span class="constructor">TargetAccessibilityFocus()</span>) &#123;</span><br><span class="line">        <span class="comment">// We don&#x27;t have focus or no virtual descendant has it, do not handle the event.</span></span><br><span class="line">        <span class="keyword">if</span> (!is<span class="constructor">AccessibilityFocusedViewOrHost()</span>) &#123;</span><br><span class="line">            return <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// We have focus and got the event, then use normal event dispatch.</span></span><br><span class="line">        event.set<span class="constructor">TargetAccessibilityFocus(<span class="params">false</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    boolean result = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (mInputEventConsistencyVerifier != null) &#123;</span><br><span class="line">        mInputEventConsistencyVerifier.on<span class="constructor">TouchEvent(<span class="params">event</span>, 0)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final <span class="built_in">int</span> actionMasked = event.get<span class="constructor">ActionMasked()</span>;</span><br><span class="line">    <span class="keyword">if</span> (actionMasked<span class="operator"> == </span>MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        <span class="comment">// Defensive cleanup for new gesture</span></span><br><span class="line">        stop<span class="constructor">NestedScroll()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (on<span class="constructor">FilterTouchEventForSecurity(<span class="params">event</span>)</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((mViewFlags &amp; ENABLED_MASK)<span class="operator"> == </span>ENABLED<span class="operator"> &amp;&amp; </span>handle<span class="constructor">ScrollBarDragging(<span class="params">event</span>)</span>) &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">        ListenerInfo li = mListenerInfo;</span><br><span class="line">        <span class="keyword">if</span> (li != null<span class="operator"> &amp;&amp; </span>li.mOnTouchListener != null</span><br><span class="line"><span class="operator">                &amp;&amp; </span>(mViewFlags &amp; ENABLED_MASK)<span class="operator"> == </span>ENABLED</span><br><span class="line"><span class="operator">                &amp;&amp; </span>li.mOnTouchListener.on<span class="constructor">Touch(<span class="params">this</span>, <span class="params">event</span>)</span>) &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!result<span class="operator"> &amp;&amp; </span>on<span class="constructor">TouchEvent(<span class="params">event</span>)</span>) &#123;</span><br><span class="line">            result = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!result<span class="operator"> &amp;&amp; </span>mInputEventConsistencyVerifier != null) &#123;</span><br><span class="line">        mInputEventConsistencyVerifier.on<span class="constructor">UnhandledEvent(<span class="params">event</span>, 0)</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Clean up after nested scrolls if this is the end of a gesture;</span></span><br><span class="line">    <span class="comment">// also cancel it if we tried an ACTION_DOWN but we didn&#x27;t want the rest</span></span><br><span class="line">    <span class="comment">// of the gesture.</span></span><br><span class="line">    <span class="keyword">if</span> (actionMasked<span class="operator"> == </span>MotionEvent.ACTION_UP <span class="pattern-match"><span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">            action<span class="constructor">Masked</span> <span class="operator">==</span> <span class="constructor">MotionEvent</span>.<span class="constructor">ACTION_CANCEL</span> <span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">            (action<span class="constructor">Masked</span> <span class="operator">==</span> <span class="constructor">MotionEvent</span>.<span class="constructor">ACTION_DOWN</span> <span class="operator">&amp;&amp;</span> !result)) &#123;</span></span><br><span class="line"><span class="pattern-match">        stop<span class="constructor">NestedScroll()</span>;</span></span><br><span class="line"><span class="pattern-match">    &#125;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">    return result;</span></span><br><span class="line"><span class="pattern-match">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="图ACTION-DOWN分析"><a href="#图ACTION-DOWN分析" class="headerlink" title="图ACTION_DOWN分析"></a>图ACTION_DOWN分析</h5><p>1.MotionEvent.ACTION_DOWN 都不拦截    </p>
<p> Activity              dispatchTouchEvent()    1 =&gt; 5</p>
<p> RootView       dispatchTouchEvent()    29 =&gt;     (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT)==0</p>
<p>​                            =&gt; 33 =&gt; 58 =&gt; 68 =&gt; 122 =&gt;    dispatchTransformedTouchEvent有子view重复上面流程  =&gt; dispatchTransformedTouchEvent没有子View =&gt;</p>
<p>View1                    dispatchTouchEvent() 36 =&gt; 54 result=false =&gt;事件开始往回传=&gt;</p>
<p>ViewGroupA        122=&gt;163=&gt; 164 dispatchTransformedTouchEvent child传null =&gt;开始调用View dispatchTouchEvent()=false =&gt;  事件继续回传=&gt; </p>
<p>RootView            =&gt;重复上面ViewGroupA的流程 =&gt; 164 handled=false =&gt;</p>
<p>Activity                    =&gt;5  getWindow().superDispatchTouchEvent(ev)   =&gt; onTouchEvent(ev);</p>
<h5 id="图ACTION-MOVE-UP分析-RootView-onInterceptTouchEvent-true"><a href="#图ACTION-MOVE-UP分析-RootView-onInterceptTouchEvent-true" class="headerlink" title="图ACTION_MOVE UP分析 RootView  onInterceptTouchEvent =true"></a>图ACTION_MOVE UP分析 RootView  onInterceptTouchEvent =true</h5><p> Activity              dispatchTouchEvent()    1 =&gt; 5</p>
<p> RootView       dispatchTouchEvent()    29 =&gt;     (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT)==0 =&gt; 164 &gt;handler = false =&gt;</p>
<p> Activity                    =&gt;5  getWindow().superDispatchTouchEvent(ev)   =&gt; onTouchEvent(ev);</p>
<h5 id="图ACTION-MOVE-UP分析-View-touchevent-true"><a href="#图ACTION-MOVE-UP分析-View-touchevent-true" class="headerlink" title="图ACTION_MOVE UP分析 View touchevent = true"></a>图ACTION_MOVE UP分析 View touchevent = true</h5><p> Activity              dispatchTouchEvent()    1 =&gt; 5</p>
<p> RootView       dispatchTouchEvent()    29 =&gt;    41 =&gt; 170 =&gt; 183 遍历查找消费event的View =&gt; handled = true</p>
<p> Activity                    =&gt;5  getWindow().superDispatchTouchEvent(ev)   =&gt; onTouchEvent(ev);</p>
<h2 id="View点击事件处理-不是ViewGroup"><a href="#View点击事件处理-不是ViewGroup" class="headerlink" title="View点击事件处理(不是ViewGroup)"></a>View点击事件处理(不是ViewGroup)</h2><ul>
<li>  onTouch返回false</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">button2.set<span class="constructor">OnTouchListener(<span class="params">new</span> View.OnTouchListener()</span> &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public boolean on<span class="constructor">Touch(View <span class="params">v</span>, MotionEvent <span class="params">event</span>)</span> &#123;</span><br><span class="line">          <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, <span class="string">&quot;执行 button2 onTouch() 动作&quot;</span> + event.get<span class="constructor">Action()</span>);</span><br><span class="line">          return <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  button2.set<span class="constructor">OnClickListener(<span class="params">new</span> View.OnClickListener()</span> &#123;</span><br><span class="line">      @Override</span><br><span class="line">      public void on<span class="constructor">Click(View <span class="params">v</span>)</span> &#123;</span><br><span class="line">          <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>d(TAG, <span class="string">&quot;you clicked button2&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>打印结果:</p>
<blockquote>
<p>D/DispatchActivity: 执行 button2 onTouch() 动作0<br> D/DispatchActivity: 执行 button2 onTouch() 动作1<br> D/DispatchActivity: you clicked button2</p>
</blockquote>
<ul>
<li>onTouch返回true<br>Log打印结果:<blockquote>
<p>D/DispatchActivity: 执行 button2 onTouch() 动作0<br>D/DispatchActivity: 执行 button2 onTouch() 动作1</p>
</blockquote>
</li>
</ul>
<p>不同得返回值,得到不同得结果　看下为什么<br>看下　View的dispatchTouchEvent（）　API  23 源码的事件分发流程<br>点击 Button寻找dispatchTouchEvent() <code>Button -&gt; dispatchTouchEvent() -&gt;  TextView-&gt;View </code><br> (点击Button后就会找 dispatchTouchEvent()，Button没有，然后就去父类TextView还是没找到，最后在View找到了)</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Pass the touch screen motion event down to the target view, or this</span></span><br><span class="line"><span class="comment">   * view if it is the target.</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * @param event The motion event to be dispatched.</span></span><br><span class="line"><span class="comment">   * @return True if the event was handled by the view, false otherwise.</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  public boolean dispatch<span class="constructor">TouchEvent(MotionEvent <span class="params">event</span>)</span> &#123;</span><br><span class="line">      <span class="comment">// If the event should be handled by accessibility focus first.</span></span><br><span class="line">      <span class="keyword">if</span> (event.is<span class="constructor">TargetAccessibilityFocus()</span>) &#123;</span><br><span class="line">          <span class="comment">// We don&#x27;t have focus or no virtual descendant has it, do not handle the event.</span></span><br><span class="line">          <span class="keyword">if</span> (!is<span class="constructor">AccessibilityFocusedViewOrHost()</span>) &#123;</span><br><span class="line">              return <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// We have focus and got the event, then use normal event dispatch.</span></span><br><span class="line">          event.set<span class="constructor">TargetAccessibilityFocus(<span class="params">false</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      boolean result = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (mInputEventConsistencyVerifier != null) &#123;</span><br><span class="line">          mInputEventConsistencyVerifier.on<span class="constructor">TouchEvent(<span class="params">event</span>, 0)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      final <span class="built_in">int</span> actionMasked = event.get<span class="constructor">ActionMasked()</span>;</span><br><span class="line">      <span class="keyword">if</span> (actionMasked<span class="operator"> == </span>MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">          <span class="comment">// Defensive cleanup for new gesture</span></span><br><span class="line">          stop<span class="constructor">NestedScroll()</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (on<span class="constructor">FilterTouchEventForSecurity(<span class="params">event</span>)</span>) &#123;</span><br><span class="line">          <span class="comment">//noinspection SimplifiableIfStatement</span></span><br><span class="line">          ListenerInfo li = mListenerInfo;</span><br><span class="line">          <span class="keyword">if</span> (li != null<span class="operator"> &amp;&amp; </span>li.mOnTouchListener != null</span><br><span class="line"><span class="operator">                  &amp;&amp; </span>(mViewFlags &amp; ENABLED_MASK)<span class="operator"> == </span>ENABLED</span><br><span class="line"><span class="operator">                  &amp;&amp; </span>li.mOnTouchListener.on<span class="constructor">Touch(<span class="params">this</span>, <span class="params">event</span>)</span>) &#123;</span><br><span class="line">              result = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (!result<span class="operator"> &amp;&amp; </span>on<span class="constructor">TouchEvent(<span class="params">event</span>)</span>) &#123;</span><br><span class="line">              result = <span class="literal">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!result<span class="operator"> &amp;&amp; </span>mInputEventConsistencyVerifier != null) &#123;</span><br><span class="line">          mInputEventConsistencyVerifier.on<span class="constructor">UnhandledEvent(<span class="params">event</span>, 0)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// Clean up after nested scrolls if this is the end of a gesture;</span></span><br><span class="line">      <span class="comment">// also cancel it if we tried an ACTION_DOWN but we didn&#x27;t want the rest</span></span><br><span class="line">      <span class="comment">// of the gesture.</span></span><br><span class="line">      <span class="keyword">if</span> (actionMasked<span class="operator"> == </span>MotionEvent.ACTION_UP <span class="pattern-match"><span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">              action<span class="constructor">Masked</span> <span class="operator">==</span> <span class="constructor">MotionEvent</span>.<span class="constructor">ACTION_CANCEL</span> <span class="operator">||</span></span></span><br><span class="line"><span class="pattern-match">              (action<span class="constructor">Masked</span> <span class="operator">==</span> <span class="constructor">MotionEvent</span>.<span class="constructor">ACTION_DOWN</span> <span class="operator">&amp;&amp;</span> !result)) &#123;</span></span><br><span class="line"><span class="pattern-match">          stop<span class="constructor">NestedScroll()</span>;</span></span><br><span class="line"><span class="pattern-match">      &#125;</span></span><br><span class="line"><span class="pattern-match"></span></span><br><span class="line"><span class="pattern-match">      return result;</span></span><br><span class="line"><span class="pattern-match">  &#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>分析<br>第34行,result默认为false,li.mOnTouchListener.onTouch(this, event))默认也是false,接着<br>第40行,onTouchEvent(event)) 方法也会得到执行 -&gt;  performClick()会给点击事件  一个回调;</li>
</ul>
<p><strong>以下内容参考</strong>: <a href="http://www.gcssloop.com/customview/dispatch-touchevent-theory">gcssloop</a><br>ViewGroup的　<a href="http://wangkuiwu.github.io/2015/01/04/TouchEvent-ViewGroup/">dispatchTouchEvent()解析</a><br><a href="http://blog.csdn.net/guolin_blog/article/details/9097463">http://blog.csdn.net/guolin_blog/article/details/9097463</a></p>
<p><a href="https://mp.weixin.qq.com/s/KU32XpwDFBOl8ueXIaA8Tw">https://mp.weixin.qq.com/s/KU32XpwDFBOl8ueXIaA8Tw</a></p>
]]></content>
      <categories>
        <category>VIEW</category>
      </categories>
      <tags>
        <tag>TouchEvent</tag>
      </tags>
  </entry>
  <entry>
    <title>Concurrency_Locking</title>
    <url>/2018/05/24/Concurrency_Locking/</url>
    <content><![CDATA[<h4 id="锁的7大类"><a href="#锁的7大类" class="headerlink" title="锁的7大类"></a>锁的7大类</h4><h5 id="偏向锁-轻量级锁-重量级锁；"><a href="#偏向锁-轻量级锁-重量级锁；" class="headerlink" title="偏向锁/轻量级锁/重量级锁；"></a>偏向锁/轻量级锁/重量级锁；</h5><p><img src="/2018/05/24/Concurrency_Locking/2021-07-06_12-19-34.png"></p>
<ul>
<li><p>偏向锁</p>
<p>​    如果自始至终，对于这把锁都不存在竞争，那么其实就没必要上锁，只需要打个标记就行了，这就是偏向锁的思想。</p>
</li>
<li><p>轻量级锁</p>
<p>​    JVM 开发者发现在很多情况下，synchronized 中的代码是被多个线程交替执行的，而不是同时执行的，也就是说并不存在实际的    竞争，或者是只有短时间的锁竞争，用 CAS 就可以解决，这种情况下，用完全互斥的重量级锁是没必要的。</p>
</li>
<li><p>重量级锁</p>
<p>​    重量级锁是互斥锁，它是利用操作系统的同步机制实现的，所以开销相对比较大。当多个线程直接有实际竞争，且锁竞争时间长的时候，轻量级锁不能满足需求，锁就会膨胀为重量级锁。重量级锁会让其他申请却拿不到锁的线程进入阻塞状态。</p>
<h5 id="锁升级"><a href="#锁升级" class="headerlink" title="锁升级"></a>锁升级</h5><p><img src="https://s0.lgstatic.com/i/image3/M01/58/E4/CgpOIF35yCGAGFBbAAAO9n9VgTQ034.png"></p>
<ul>
<li><p>synchronized锁升级</p>
<p>偏向锁： markword记录这个线程ID -》如果线程争用升级为自旋锁 -》10次以后升级为重量级锁</p>
</li>
</ul>
<h4 id="synchronized的monitor-锁"><a href="#synchronized的monitor-锁" class="headerlink" title="synchronized的monitor 锁"></a>synchronized的monitor 锁</h4><h5 id="同步代码块"><a href="#同步代码块" class="headerlink" title="同步代码块"></a>同步代码块</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SynTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synBlock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;lagou&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反编译后的字节码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">synBlock</span><span class="params">()</span></span>;</span><br><span class="line">   descriptor: ()V</span><br><span class="line">   flags: ACC_PUBLIC</span><br><span class="line">   Code:</span><br><span class="line">     stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">        <span class="number">0</span>: aload_0</span><br><span class="line">        <span class="number">1</span>: dup</span><br><span class="line">        <span class="number">2</span>: astore_1</span><br><span class="line">        <span class="number">3</span>: monitorenter</span><br><span class="line">        4: getstatic     #2                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">        7: ldc           #3                      // String lagou</span><br><span class="line">        9: invokevirtual #4               // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">       <span class="number">12</span>: aload_1</span><br><span class="line">       <span class="number">13</span>: monitorexit</span><br><span class="line">       <span class="number">14</span>: goto          <span class="number">22</span></span><br><span class="line">       <span class="number">17</span>: astore_2</span><br><span class="line">       <span class="number">18</span>: aload_1</span><br><span class="line">       <span class="number">19</span>: monitorexit</span><br><span class="line">       <span class="number">20</span>: aload_2</span><br><span class="line">       <span class="number">21</span>: athrow</span><br><span class="line">       <span class="number">22</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p>synchronized 代码块实际上多了 monitorenter 和 monitorexit 指令，标红的第3、13、19行指令分别对应的是 monitorenter 和 monitorexit.可以把执行 monitorenter 理解为加锁，执行 monitorexit 理解为释放锁，每个对象维护着一个记录着被锁次数的计数器。未被锁定的对象的该计数器为 0。</p>
<ol>
<li>monitorenter</li>
</ol>
<p>执行 monitorenter 的线程尝试获得 monitor 的所有权，会发生以下这三种情况之一：</p>
<p>a. 如果该 monitor 的计数为 0，则线程获得该 monitor 并将其计数设置为 1。然后，该线程就是这个 monitor 的所有者。</p>
<p>b. 如果线程已经拥有了这个 monitor ，则它将重新进入，并且累加计数。</p>
<p>c. 如果其他线程已经拥有了这个 monitor，那个这个线程就会被阻塞，直到这个 monitor 的计数变成为 0，代表这个 monitor 已经被释放了，于是当前这个线程就会再次尝试获取这个 monitor。</p>
<ol start="2">
<li>monitorexit<br>monitorexit 的作用是将 monitor 的计数器减 1，直到减为 0 为止。代表这个 monitor 已经被释放了，已经没有任何线程拥有它了，也就代表着解锁，所以，其他正在等待这个 monitor 的线程，此时便可以再次尝试获取这个 monitor 的所有权。</li>
</ol>
<p>从上面也可看到  <strong>synchronized是可重入锁</strong></p>
<h6 id="synchronized-方法"><a href="#synchronized-方法" class="headerlink" title="synchronized 方法"></a>synchronized 方法</h6><p>​        同步代码块是使用 monitorenter 和 monitorexit 指令实现的。而对于 synchronized 方法，并不是依靠 monitorenter 和 monitorexit 指令实现的，被 javap 反汇编后可以看到，synchronized 方法和普通方法大部分是一样的，不同在于，这个方法会有一个叫作 ACC_SYNCHRONIZED 的 flag 修饰符，来表明它是同步方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">method</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    method body</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反编译后的指令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">synMethod</span><span class="params">()</span></span>;</span><br><span class="line">   </span><br><span class="line">       descriptor: ()V</span><br><span class="line">   </span><br><span class="line">       flags: ACC_PUBLIC, ACC_SYNCHRONIZED</span><br><span class="line">   </span><br><span class="line">       Code:</span><br><span class="line">   </span><br><span class="line">         stack=<span class="number">0</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">   </span><br><span class="line">            <span class="number">0</span>: <span class="keyword">return</span></span><br><span class="line">   </span><br><span class="line">         LineNumberTable:</span><br><span class="line">   </span><br><span class="line">           line <span class="number">16</span>: <span class="number">0</span></span><br><span class="line">   </span><br></pre></td></tr></table></figure>



<p>被 synchronized 修饰的方法会有一个 ACC_SYNCHRONIZED 标志。当某个线程要访问某个方法的时候，会首先检查方法是否有 ACC_SYNCHRONIZED 标志，如果有则需要先获得 monitor 锁，然后才能开始执行方法，方法执行之后再释放 monitor 锁。其他方面， synchronized 方法和刚才的 synchronized 代码块是很类似的，例如这时如果其他线程来请求执行方法，也会因为无法获得 monitor 锁而被阻塞。</p>
<h6 id="synchronized-和-Lock选择"><a href="#synchronized-和-Lock选择" class="headerlink" title="synchronized 和 Lock选择"></a>synchronized 和 Lock选择</h6><ol>
<li><p>如果能不用最好既不使用 Lock 也不使用 synchronized。因为在许多情况下你可以使用 java.util.concurrent 包中的机制，它会为你处理所有的加锁和解锁操作，也就是推荐优先使用工具类来加解锁。</p>
</li>
<li><p>如果 synchronized 关键字适合你的程序， 那么请尽量使用它，这样可以减少编写代码的数量，减少出错的概率。因为一旦忘记在 finally 里 unlock，代码可能会出很大的问题，而使用 synchronized 更安全。</p>
</li>
<li><p>如果特别需要 Lock 的特殊功能，比如尝试获取锁、可中断、超时功能等，才使用 Lock。</p>
</li>
</ol>
<h6 id="Lock"><a href="#Lock" class="headerlink" title="Lock"></a>Lock</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Lock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">tryLock</span><span class="params">(<span class="keyword">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">Condition <span class="title">newCondition</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><p>lock() </p>
<p>lock() 是最基础的获取锁的方法,获取锁和释放锁都是显式的，不像 synchronized 那样是隐式的，所以 Lock 不会像 synchronized 一样在异常时自动释放锁（synchronized 即使不写对应的代码也可以释放）,使用 lock() 时必须由我们自己主动去释放锁，因此最佳实践是执行 lock() 后，首先在 try{} 中操作同步资源，如果有必要就用 catch{} 块捕获异常，然后在 finally{} 中释放锁，以保证发生异常时锁一定被释放.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lock lock = ...;</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">    <span class="comment">//获取到了被本锁保护的资源，处理任务</span></span><br><span class="line">    <span class="comment">//捕获异常</span></span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">    lock.unlock();   <span class="comment">//释放锁</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>tryLock()</p>
<p>​    尝试获取锁，如果当前锁没有被其他线程占用，则获取成功，返回 true，否则返回 false，代表获取锁失败。该方法会立即返回，即便在拿不到锁时也不会一直等待，所以通常情况下，我们用 if 语句判断 tryLock() 的返回结果.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lock lock = ...;</span><br><span class="line"><span class="keyword">if</span>(lock.tryLock()) &#123;</span><br><span class="line">     <span class="keyword">try</span>&#123;</span><br><span class="line">         <span class="comment">//处理任务</span></span><br><span class="line">     &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">         lock.unlock();   <span class="comment">//释放锁</span></span><br><span class="line">     &#125; </span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//如果不能获取锁，则做其他事情</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个方法可以方便的解决死锁问题</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tryLock</span><span class="params">(Lock lock1, Lock lock2)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">       <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">           <span class="keyword">if</span> (lock1.tryLock()) &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   <span class="keyword">if</span> (lock2.tryLock()) &#123;</span><br><span class="line">                       <span class="keyword">try</span> &#123;</span><br><span class="line">                           System.out.println(<span class="string">&quot;获取到了两把锁，完成业务逻辑&quot;</span>);</span><br><span class="line">                           <span class="keyword">return</span>;</span><br><span class="line">                       &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                           lock2.unlock();</span><br><span class="line">                       &#125;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                   lock1.unlock();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               Thread.sleep(<span class="keyword">new</span> Random().nextInt(<span class="number">1000</span>));</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>如果代码中我们不用 tryLock() 方法,比如有两个线程同时调用这个方法，传入的 lock1 和 lock2 恰好是相反的，那么如果第一个线程获取了 lock1 的同时，第二个线程获取了 lock2，它们接下来便会尝试获取对方持有的那把锁，但是又获取不到，于是便会陷入死锁，使用tryLock()后，如果获取到了 lock1 但没有获取到 lock2，那么也会释放掉 lock1</p>
</li>
<li><p>tryLock(long time, TimeUnit unit)</p>
<p>使用 tryLock(long time, TimeUnit unit) 时，在等待了一段指定的超时时间后，线程会主动放弃这把锁的获取，避免永久等待；在等待的期间，也可以随时中断线程，这就避免了死锁的发生。</p>
</li>
<li><p>lockInterruptibly()</p>
<p>如果这个锁当前是可以获得的，那么这个方法会立刻返回,，但是如果这个锁当前是不能获得的（被其他线程持有），那么当前线程便会开始等待，除非它等到了这把锁或者是在等待的过程中被Thread的interrupt()方法中断了，否则这个线程便会一直在这里执行这行代码。一直尝试获取直到获取到为止。</p>
<p>相比于不能响应中断的 synchronized 锁，lockInterruptibly() 可以让程序更灵活，可以在获取锁的同时，保持对中断的响应。我们可以把这个方法理解为超时时间是无穷长的 tryLock(long time, TimeUnit unit)，因为 tryLock(long time, TimeUnit unit) 和 lockInterruptibly() 都能响应中断，只不过 lockInterruptibly() 永远不会超时。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lockInterruptibly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           lock.lockInterruptibly();</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;操作资源&quot;</span>);</span><br><span class="line">           &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">               lock.unlock();</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">           e.printStackTrace();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>unlock()</p>
<p>最后要介绍的方法是 unlock() 方法，是用于解锁的，u方法比较简单，对于 ReentrantLock 而言，执行 unlock() 的时候，内部会把锁的“被持有计数器”减 1，直到减到 0 就代表当前这把锁已经完全释放了，如果减 1 后计数器不为 0，说明这把锁之前被“重入”了，那么锁并没有真正释放，仅仅是减少了持有的次数。</p>
</li>
</ol>
<p><a href="https://www.yinxiang.com/everhub/note/c27d346d-ed4d-4e7b-aef9-0b501a44deb7">https://www.yinxiang.com/everhub/note/c27d346d-ed4d-4e7b-aef9-0b501a44deb7</a></p>
<p><a href="https://www.bilibili.com/video/BV1NT4y1G7WE?p=5">https://www.bilibili.com/video/BV1NT4y1G7WE?p=5</a></p>
<p><a href="https://www.bilibili.com/video/BV1qE411q7fk?p=10">https://www.bilibili.com/video/BV1qE411q7fk?p=10</a></p>
<p><a href="https://www.cnblogs.com/aspirant/p/11470858.html">https://www.cnblogs.com/aspirant/p/11470858.html</a></p>
</li>
</ul>
<h5 id="可重入锁-非可重入锁；"><a href="#可重入锁-非可重入锁；" class="headerlink" title="可重入锁/非可重入锁；"></a>可重入锁/非可重入锁；</h5><p>​    可重入锁 ： 可重入锁指的是线程当前已经持有这把锁了，能在不释放这把锁的情况下，再次获取这把锁。    </p>
<p>​    synchronized是可冲入锁</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">T</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span>  <span class="title">m1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;m1 start&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        m2();</span><br><span class="line">        System.out.println(<span class="string">&quot;m1 end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">m2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;m2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> T().m1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line"><span class="name">m1</span> start</span><br><span class="line"><span class="name">m2</span></span><br><span class="line"><span class="name">m1</span> e<span class="symbol">nd</span></span><br></pre></td></tr></table></figure>

<p>如果synchronized不是可重入锁，执行m1()执行m2()会发生死锁,</p>
<p>为什么synchronized必须是可重入锁呢?</p>
<p>如果父类m2()是synchronized方法,子类重写m2()方法，调用子类m2(),接着调用super.m2()就会发生死锁</p>
<h5 id="共享锁-独占锁"><a href="#共享锁-独占锁" class="headerlink" title="共享锁/独占锁"></a>共享锁/独占锁</h5><ul>
<li><p>共享锁</p>
<p>共享锁指的是我们同一把锁可以被多个线程同时获得</p>
</li>
<li><p>独占锁 </p>
<p>这把锁只能同时被一个线程获得</p>
<p>读写锁就最好地诠释了共享锁和独占锁的理念。读写锁中的读锁，是共享锁，而写锁是独占锁。读锁可以被同时读，可以同时被多个线程持有，而写锁最多只能同时被一个线程持有。</p>
</li>
</ul>
<p>整体思路是它有两把锁，第 1 把锁是写锁，获得写锁之后，既可以读数据又可以修改数据，而第 2 把锁是读锁，获得读锁之后，只能查看数据，不能修改数据。读锁可以被多个线程同时持有，所以多个线程可以同时查看数据。</p>
<p>我们在使用读写锁时遵守下面的获取规则：</p>
<ol>
<li>如果有一个线程已经占用了读锁，则此时其他线程如果要申请读锁，可以申请成功。</li>
<li>如果有一个线程已经占用了读锁，则此时其他线程如果要申请写锁，则申请写锁的线程会一直等待释放读锁，因为读写不能同时操作。</li>
<li>如果有一个线程已经占用了写锁，则此时其他线程如果申请写锁或者读锁，都必须等待之前的线程释放写锁，同样也因为读写不能同时，并且两个线程不应该同时写。</li>
</ol>
<p>所以我们用一句话总结：要么是一个或多个线程同时有读锁，要么是一个线程有写锁，但是两者不会同时出现。也可以总结为：读读共享、其他都互斥（写写互斥、读写互斥、写读互斥）。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述：     演示读写锁用法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantReadWriteLock reentrantReadWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock(</span><br><span class="line">            <span class="keyword">false</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantReadWriteLock.ReadLock readLock = reentrantReadWriteLock</span><br><span class="line">            .readLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ReentrantReadWriteLock.WriteLock writeLock = reentrantReadWriteLock</span><br><span class="line">            .writeLock();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        readLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;得到读锁，正在读取&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;释放读锁&quot;</span>);</span><br><span class="line">            readLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        writeLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;得到写锁，正在写入&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;释放写锁&quot;</span>);</span><br><span class="line">            writeLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; read()).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; read()).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; write()).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; write()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Thread</span>-<span class="number">0</span>得到读锁，正在读取</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">1</span>得到读锁，正在读取</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">0</span>释放读锁</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">1</span>释放读锁</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">2</span>得到写锁，正在写入</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">2</span>释放写锁</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">3</span>得到写锁，正在写入</span><br><span class="line"><span class="attribute">Thread</span>-<span class="number">3</span>释放写锁</span><br></pre></td></tr></table></figure>

<p>读锁可以同时被多个线程获得，而写锁不能。</p>
<p>为什么要对读加锁 :  读本身是线程安全的，加读锁，主要是为了让写锁感知到，在有人读取的时候，不要同时写入。</p>
<p>ReentrantReadWriteLockTest.java</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> static ReentrantReadWriteLock reentrantLock = <span class="keyword">new</span> <span class="constructor">ReentrantReadWriteLock()</span>;</span><br><span class="line"><span class="keyword">private</span> static ReentrantReadWriteLock.ReadLock readLock = reentrantLock.read<span class="constructor">Lock()</span>;</span><br><span class="line"><span class="keyword">private</span> static ReentrantReadWriteLock.WriteLock writeLock = reentrantLock.write<span class="constructor">Lock()</span>;</span><br><span class="line"></span><br><span class="line">public static void read<span class="literal">()</span> &#123;</span><br><span class="line">    readLock.lock<span class="literal">()</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot;获取读锁，开始执行&quot;</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        readLock.unlock<span class="literal">()</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot;释放读锁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">public static void write<span class="literal">()</span> &#123;</span><br><span class="line">    writeLock.lock<span class="literal">()</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot;获取写锁，开始执行&quot;</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>sleep(<span class="number">2000</span>);</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        e.print<span class="constructor">StackTrace()</span>;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        writeLock.unlock<span class="literal">()</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="module-access"><span class="module"><span class="identifier">Thread</span>.</span></span>current<span class="constructor">Thread()</span>.get<span class="constructor">Name()</span> + <span class="string">&quot;释放写锁&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public static void main(String<span class="literal">[]</span> args) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="constructor">Thread(()</span> -&gt; read<span class="literal">()</span>, <span class="string">&quot;Thread1&quot;</span>).start<span class="literal">()</span>;</span><br><span class="line">    <span class="keyword">new</span> <span class="constructor">Thread(()</span> -&gt; read<span class="literal">()</span>, <span class="string">&quot;Thread2&quot;</span>).start<span class="literal">()</span>;</span><br><span class="line">    <span class="keyword">new</span> <span class="constructor">Thread(()</span> -&gt; write<span class="literal">()</span>, <span class="string">&quot;Thread3&quot;</span>).start<span class="literal">()</span>;</span><br><span class="line">    <span class="keyword">new</span> <span class="constructor">Thread(()</span> -&gt; write<span class="literal">()</span>, <span class="string">&quot;Thread4&quot;</span>).start<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果:</p>
<p><u>Thread1获取读锁，开始执行<br>Thread2获取读锁，开始执行<br>Thread1释放读锁<br>Thread2释放读锁<br>Thread3获取写锁，开始执行<br>Thread3释放写锁<br>Thread4获取写锁，开始执行<br>Thread4释放写锁</u></p>
<p>线程1和线程2可以同时获取读锁，而线程3和线程4只能依次获取写锁，因为线程4必须等待线程3释放写锁后才能获取到锁</p>
<p><a href="https://blog.csdn.net/fanrenxiang/article/details/104312606">https://blog.csdn.net/fanrenxiang/article/details/104312606</a></p>
<h5 id="公平锁-非公平锁；"><a href="#公平锁-非公平锁；" class="headerlink" title="公平锁/非公平锁；"></a>公平锁/非公平锁；</h5><ul>
<li><p>公平锁 </p>
<p>线程就都会进入等待，开始排队，在等待队列里等待时间长的线程会优先拿到这把锁，有先来先得的意思，公平锁指的是按照线程请求的顺序，来分配锁</p>
</li>
<li><p>非公平锁</p>
<p>它会在一定情况下，忽略掉已经在排队的线程，发生插队现象，而非公平锁指的是不完全按照请求的顺序，在一定情况下，可以允许插队</p>
<p>公平锁 <code>new ReentrantLock(false);</code></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FairAndUnfair</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        PrintQueue printQueue = <span class="keyword">new</span> PrintQueue();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        Thread thread[] = <span class="keyword">new</span> Thread[<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            thread[i] = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Job(printQueue), <span class="string">&quot;Thread &quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            thread[i].start();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Job</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> PrintQueue printQueue;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Job</span><span class="params">(PrintQueue printQueue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.printQueue = printQueue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s: Going to print a job\n&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">        printQueue.printJob(<span class="keyword">new</span> Object());</span><br><span class="line">        System.out.printf(<span class="string">&quot;%s: The document has been printed\n&quot;</span>, Thread.currentThread().getName());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintQueue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lock queueLock = <span class="keyword">new</span> ReentrantLock(<span class="keyword">false</span>); <span class="comment">//非公平锁</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printJob</span><span class="params">(Object document)</span> </span>&#123;</span><br><span class="line">        queueLock.lock();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long duration = (<span class="keyword">long</span>) (Math.random() * <span class="number">10000</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s: PrintQueue: Printing a Job during %d seconds\n&quot;</span>,</span><br><span class="line">                    Thread.currentThread().getName(), (duration / <span class="number">1000</span>));</span><br><span class="line">            Thread.sleep(duration);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            queueLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        queueLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long duration = (<span class="keyword">long</span>) (Math.random() * <span class="number">10000</span>);</span><br><span class="line">            System.out.printf(<span class="string">&quot;%s: PrintQueue: Printing a Job during %d seconds\n&quot;</span>,</span><br><span class="line">                    Thread.currentThread().getName(), (duration / <span class="number">1000</span>));</span><br><span class="line">            Thread.sleep(duration);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            queueLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>​        运行结果</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Thread</span> <span class="number">0</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">0</span>: PrintQueue: Printing a Job during <span class="number">8</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">1</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">2</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">3</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">4</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">5</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">6</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">7</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">8</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">9</span>: Going to print a job</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">0</span>: PrintQueue: Printing a Job during <span class="number">2</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">0</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">1</span>: PrintQueue: Printing a Job during <span class="number">8</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">1</span>: PrintQueue: Printing a Job during <span class="number">8</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">1</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">2</span>: PrintQueue: Printing a Job during <span class="number">7</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">2</span>: PrintQueue: Printing a Job during <span class="number">5</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">2</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">3</span>: PrintQueue: Printing a Job during <span class="number">5</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">3</span>: PrintQueue: Printing a Job during <span class="number">0</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">3</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">4</span>: PrintQueue: Printing a Job during <span class="number">5</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">4</span>: PrintQueue: Printing a Job during <span class="number">9</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">4</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">5</span>: PrintQueue: Printing a Job during <span class="number">6</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">5</span>: PrintQueue: Printing a Job during <span class="number">6</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">5</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">6</span>: PrintQueue: Printing a Job during <span class="number">1</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">6</span>: PrintQueue: Printing a Job during <span class="number">5</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">6</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">7</span>: PrintQueue: Printing a Job during <span class="number">1</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">7</span>: PrintQueue: Printing a Job during <span class="number">1</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">7</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">8</span>: PrintQueue: Printing a Job during <span class="number">6</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">8</span>: PrintQueue: Printing a Job during <span class="number">1</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">8</span>: The document has been printed</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">9</span>: PrintQueue: Printing a Job during <span class="number">1</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">9</span>: PrintQueue: Printing a Job during <span class="number">0</span> seconds</span><br><span class="line"><span class="attribute">Thread</span> <span class="number">9</span>: The document has been printed</span><br></pre></td></tr></table></figure>

<p>可以看到thread1释放锁后又重新获取到锁</p>
<p>​    ReentrantLockTest.java</p>
<figure class="highlight gradle"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="keyword">COUNT</span> = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> start = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">static</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">    Runnable <span class="keyword">task</span> = () -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (start &lt;= <span class="keyword">COUNT</span>) &#123;</span><br><span class="line">                    System.out.<span class="keyword">println</span>(Thread.currentThread().getName() + <span class="string">&quot;=&gt; &quot;</span> + start++);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    System.exit(<span class="number">0</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">task</span>).start();</span><br><span class="line">    <span class="keyword">new</span> Thread(<span class="keyword">task</span>).start();</span><br></pre></td></tr></table></figure>

<p>运行结果:</p>
<br>

<p>Thread-0=&gt; 1<br>Thread-1=&gt; 2<br>Thread-0=&gt; 3<br>Thread-1=&gt; 4<br>…<br>Thread-1=&gt; 36<br>Thread-1=&gt; 37<br>Thread-1=&gt; 38<br>Thread-1=&gt; 39</p>
<p>Thread-1=&gt; 40<br>Thread-1=&gt; 41<br>Thread-1=&gt; 42<br>Thread-1=&gt; 43<br>Thread-1=&gt; 44<br>Thread-1=&gt; 45<br>Thread-1=&gt; 46<br>Thread-1=&gt; 47<br>Thread-1=&gt; 48</p>
<br>

<p>Otherwise this lock does not guarantee any particular access order.可见公平锁不保证有序。</p>
<p><a href="https://juejin.cn/post/6844903983308341261">https://juejin.cn/post/6844903983308341261</a></p>
<p><a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReentrantLock.html">https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/locks/ReentrantLock.html</a></p>
<h5 id="悲观锁-乐观锁；"><a href="#悲观锁-乐观锁；" class="headerlink" title="悲观锁/乐观锁；"></a>悲观锁/乐观锁；</h5><ol>
<li><p>悲观锁</p>
<blockquote>
<p>必须先拿到锁，以便达到“独占”的状态，当前线程在操作资源的时候，其他线程由于不能拿到锁.</p>
<p>它认为如果不锁住这个资源，别的线程就会来争抢，就会造成数据结果错误，所以悲观锁为了确保结果的正确性，会在每次获取并修改数据时，都把数据锁住，让其他线程无法访问该数据，这样就可以确保数据内容万无一失。</p>
<p>Java 中悲观锁的实现包括 synchronized 关键字和 Lock 相关类等，我们以 Lock 接口为例，例如 Lock 的实现类 ReentrantLock，类中的 lock() 等方法就是执行加锁，而 unlock() 方法是执行解锁。处理资源之前必须要先加锁并拿到锁，等到处理完了之后再解开锁，这就是非常典型的悲观锁思想。</p>
</blockquote>
<p>synchronized 关键字和 Lock 接口</p>
<p>大喜大悲：数据库</p>
<blockquote>
<p>数据库中同时拥有悲观锁和乐观锁的思想。例如，我们如果在 MySQL 选择 select for update 语句，那就是悲观锁，在提交之前不允许第三方来修改该数据，这当然会造成一定的性能损耗，在高并发的情况下是不可取的</p>
<p>相反，我们可以利用一个版本 version 字段在数据库中实现乐观锁。在获取及修改数据时都不需要加锁，但是我们在获取完数据并计算完毕，准备更新数据时，会检查版本号和获取数据时的版本号是否一致，如果一致就直接更新，如果不一致，说明计算期间已经有其他线程修改过这个数据了，那我就可以选择重新获取数据，重新计算，然后再次尝试更新数据。</p>
</blockquote>
</li>
</ol>
<ol start="2">
<li>乐观锁</li>
</ol>
<p>利用 CAS 理念，在不独占资源的情况下，完成了对资源的修改。</p>
<p>为了确保数据正确性，在更新之前，会去对比在我修改数据期间，数据有没有被其他线程修改过：如果没被修改过，就说明真的只有我自己在操作，那我就可以正常的修改数据；如果发现数据和我一开始拿到的不一样了，说明其他线程在这段时间内修改过数据，那说明我迟了一步，所以我会放弃这次修改，并选择报错、重试等策略。</p>
<p>​    </p>
<h5 id="自旋锁-非自旋锁；"><a href="#自旋锁-非自旋锁；" class="headerlink" title="自旋锁/非自旋锁；"></a>自旋锁/非自旋锁；</h5><ul>
<li><p>自旋锁</p>
<p>自旋锁的理念是如果线程现在拿不到锁，并不直接陷入阻塞或者释放 CPU 资源，而是开始利用循环，不停地尝试获取锁，这个循环过程被形象地比喻为“自旋”</p>
<p>阻塞和唤醒线程都是需要高昂的开销的，如果同步代码块中的内容不复杂，那么可能转换线程带来的开销比实际业务代码执行的开销还要大。</p>
</li>
<li><p>非自旋锁</p>
<p>如果它发现此时获取不到锁，它就把自己的线程切换状态，让线程休眠，然后 CPU 就可以在这段时间去做很多其他的事情，直到之前持有这把锁的线程释放了锁，于是 CPU 再把之前的线程恢复回来，让这个线程再去尝试获取这把锁。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 持有锁的线程，null表示锁未被线程持有</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> AtomicReference&lt;Thread&gt; ref = <span class="keyword">new</span> AtomicReference&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Thread currentThread = Thread.currentThread();</span><br><span class="line">    <span class="keyword">while</span>(!ref.compareAndSet(<span class="keyword">null</span>, currentThread))&#123;</span><br><span class="line">        <span class="comment">//当ref为null的时候compareAndSet返回true，反之为false</span></span><br><span class="line">        <span class="comment">//通过循环不断的自旋判断锁是否被其他线程持有</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unLock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Thread cur = Thread.currentThread();</span><br><span class="line">    <span class="keyword">if</span>(ref.get() != cur)&#123;</span><br><span class="line">        <span class="comment">//exception ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    ref.set(<span class="keyword">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> count  = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    ExecutorService executorService = Executors.newFixedThreadPool(<span class="number">100</span>);</span><br><span class="line">    CountDownLatch countDownLatch = <span class="keyword">new</span> CountDownLatch(<span class="number">100</span>);</span><br><span class="line">    SimpleSpinningLock simpleSpinningLock = <span class="keyword">new</span> SimpleSpinningLock();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">100</span> ; i++)&#123;</span><br><span class="line">        executorService.execute(() -&gt; &#123;</span><br><span class="line">            simpleSpinningLock.lock();</span><br><span class="line">            ++count;</span><br><span class="line">            simpleSpinningLock.unLock();</span><br><span class="line">            countDownLatch.countDown();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    countDownLatch.await();</span><br><span class="line">    System.out.println(count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="可中断锁-不可中断锁。"><a href="#可中断锁-不可中断锁。" class="headerlink" title="可中断锁/不可中断锁。"></a>可中断锁/不可中断锁。</h5><p>第 7 种分类是可中断锁和不可中断锁。在 Java 中，synchronized 关键字修饰的锁代表的是不可中断锁，一旦线程申请了锁，就没有回头路了，只能等到拿到锁以后才能进行其他的逻辑处理。而我们的 ReentrantLock 是一种典型的可中断锁，例如使用 lockInterruptibly 方法在获取锁的过程中，突然不想获取了，那么也可以在中断之后去做其他的事情，不需要一直傻等到获取到锁才离开。</p>
<h4 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h4><ul>
<li>条件</li>
</ul>
<ol>
<li>互斥条件 :   任务使用的资源至少有一个是不能共享的；chopstick一次只能被一个Philosopher使用</li>
<li>请求保持条件:   至少有一个任务必须持有跟一个资源且正在等待获取一个当前被别的任务持有的资源</li>
<li>不可剥夺条件:  资源不能被任务抢占</li>
<li>环路等待条件:  必须有循环等待。一个任务等待其他任务所持有的资源，后者又等待另一个任务所持有的资源,使得大家都被锁住.</li>
</ol>
<p><strong>当两个（或多个）线程（或进程）相互持有对方所需要的资源，却又都不主动释放自己手中所持有的资源，导致大家都获取不到自己想要的资源</strong></p>
<p>那么为什么会产生死锁呢? 学过操作系统的朋友应该都知道，死锁的产生必须具备以<br>下四个条件 。</p>
<ol>
<li>互斥条件: 指线程对己经获取到的资源进行排它性使用 ，即该资源同时只由 一个线<br>程占用。如果 此时 还有其 他 线程请求获取该资源 ，则 请求者只能等待，直至占有资<br>源 的 线程释放该资源。</li>
<li>.请求并持有条件 : 指一个线程己经持有了至少一个资源，但又提出了新的资源请求，<br>而新资源己被其 他 线程占有，所 以 当前线程会被阻塞 ，但 阻塞 的同时 并不释放自 己<br>己经获取的资源。</li>
<li>不可剥夺条件 : 指线程获取到的资源在自己使用完之前不能被其他线程抢占 ， 只有在自己使用完 毕后才 由 自 己释放该资源。</li>
<li>环路等待条件 : 指在发生死锁时 ，必然存在一个线程→资源的环形链 ，即线程集合<br>{TO,TLT2，…，Tn}中的TO正在等待一个Tl占用的资源， Tl正在等待T2占 用的资源，……Tn正在等待己被 TO 占用的资源。</li>
</ol>
<h5 id="避免死锁"><a href="#避免死锁" class="headerlink" title="避免死锁"></a>避免死锁</h5><p>要想避免死锁，只需要破坏掉至少一个构造死锁的必要条件即可， 但是学过操作系统</p>
<p>的读者应该都知道，目前只有请求并持有和环路等待条件是可 以被破坏 的。<br>造成死锁的原因其实和申请资源的顺序有很大关系 ，</p>
<h4 id="经典的哲学家吃饭问题"><a href="#经典的哲学家吃饭问题" class="headerlink" title="经典的哲学家吃饭问题"></a>经典的哲学家吃饭问题</h4><p> 5位哲学家 ，5只筷子在他们之间.    </p>
<ul>
<li><p>筷子</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Chopstick</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> taken = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">take</span><span class="params">(<span class="keyword">int</span> numChop)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (taken) &#123;</span><br><span class="line">            Print.print(numChop+<span class="string">&quot;   wait&quot;</span>);</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        taken = <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">drop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        taken = <span class="keyword">false</span>;</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>哲学家 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Philosopher</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Chopstick left;</span><br><span class="line">    <span class="keyword">private</span> Chopstick right;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> ponderFactor;</span><br><span class="line">    <span class="keyword">private</span> Random rand = <span class="keyword">new</span> Random(<span class="number">47</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ponderFactor == <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">        TimeUnit.MILLISECONDS.sleep(rand.nextInt(ponderFactor * <span class="number">250</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Philosopher</span><span class="params">(Chopstick left, Chopstick right, <span class="keyword">int</span> id, <span class="keyword">int</span> ponderFactor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.ponderFactor = ponderFactor;</span><br><span class="line">        <span class="keyword">this</span>.left = left;</span><br><span class="line">        <span class="keyword">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.interrupted()) &#123;</span><br><span class="line">                Print.print(<span class="keyword">this</span> + <span class="string">&quot; &quot;</span> + <span class="string">&quot;need thinking &quot;</span> + ponderFactor + <span class="string">&quot;    毫秒&quot;</span>);</span><br><span class="line">                pause();</span><br><span class="line">                <span class="comment">//Philosopher becomes hungry</span></span><br><span class="line">                Print.print(<span class="keyword">this</span> + <span class="string">&quot;  &quot;</span> + <span class="string">&quot;grabbing right  第&quot;</span> + (id + <span class="number">1</span>) + <span class="string">&quot;  号筷子&quot;</span>);</span><br><span class="line">                right.take(id + <span class="number">1</span>);</span><br><span class="line"><span class="comment">//                if (id == 2) &#123;</span></span><br><span class="line"><span class="comment">//                    System.out.println(right.taken);</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line">                pause();            <span class="comment">//拿起右边的筷子进入等待状态</span></span><br><span class="line">                Print.print(<span class="keyword">this</span> + <span class="string">&quot; .&quot;</span> + <span class="string">&quot;try grabbing left   第  &quot;</span> + (id) + <span class="string">&quot;  号筷子&quot;</span>);  <span class="comment">//尝试拿起左边的筷子</span></span><br><span class="line">                left.take(id);</span><br><span class="line">                Print.print(<span class="keyword">this</span> + <span class="string">&quot; &quot;</span> + <span class="string">&quot;eating&quot;</span>);</span><br><span class="line">                pause();</span><br><span class="line">                right.drop();</span><br><span class="line">                left.drop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Print.print(<span class="keyword">this</span> + <span class="string">&quot; &quot;</span> + <span class="string">&quot;exiting via interrupt&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Philosopher&quot;</span> + id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>运行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DeadlockingDiningPhilosophers</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> ponder = <span class="number">5</span>; <span class="comment">//默认 Philosopher思考的时间</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>)</span><br><span class="line">            ponder = Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">int</span> size = <span class="number">5</span>;  <span class="comment">//默认筷子的个数</span></span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">1</span>)</span><br><span class="line">            size = Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">        ExecutorService exec = Executors.newCachedThreadPool();</span><br><span class="line">        Chopstick[] sticks = <span class="keyword">new</span> Chopstick[size];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            sticks[i] = <span class="keyword">new</span> Chopstick();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">            exec.execute(<span class="keyword">new</span> Philosopher(sticks[i], sticks[(i + <span class="number">1</span>) % size], i, ponder));</span><br><span class="line"></span><br><span class="line"><span class="comment">//        if (args.length == 3 &amp;&amp; args[2].equals(&quot;timeout&quot;))</span></span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">5</span>);</span><br><span class="line"><span class="comment">//        else &#123;</span></span><br><span class="line"><span class="comment">//            System.out.println(&quot;Press &#x27;&#x27;Enter to quit&quot;);</span></span><br><span class="line"><span class="comment">//            System.in.read();</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">        exec.shutdownNow();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>结果</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">Philosopher0</span> need thinking <span class="number">5</span>    毫秒</span><br><span class="line"><span class="attribute">Philosopher3</span> need thinking <span class="number">5</span>    毫秒</span><br><span class="line"><span class="attribute">Philosopher2</span> need thinking <span class="number">5</span>    毫秒</span><br><span class="line"><span class="attribute">Philosopher1</span> need thinking <span class="number">5</span>    毫秒</span><br><span class="line"><span class="attribute">Philosopher4</span> need thinking <span class="number">5</span>    毫秒</span><br><span class="line"><span class="attribute">Philosopher0</span>  grabbing right  第<span class="number">1</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher3</span>  grabbing right  第<span class="number">4</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher2</span>  grabbing right  第<span class="number">3</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher1</span>  grabbing right  第<span class="number">2</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher4</span>  grabbing right  第<span class="number">5</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher0</span> .try grabbing left   第  <span class="number">0</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher3</span> .try grabbing left   第  <span class="number">3</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher2</span> .try grabbing left   第  <span class="number">2</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher1</span> .try grabbing left   第  <span class="number">1</span>  号筷子</span><br><span class="line"><span class="attribute">Philosopher4</span> .try grabbing left   第  <span class="number">4</span>  号筷子</span><br><span class="line"><span class="attribute">2</span>   wait</span><br><span class="line"><span class="attribute">3</span>   wait</span><br><span class="line"><span class="attribute">4</span>   wait</span><br><span class="line"><span class="attribute">0</span>   wait</span><br><span class="line"><span class="attribute">1</span>   wait</span><br><span class="line"><span class="attribute">Philosopher1</span> exiting via interrupt</span><br><span class="line"><span class="attribute">Philosopher4</span> exiting via interrupt</span><br><span class="line"><span class="attribute">Philosopher0</span> exiting via interrupt</span><br><span class="line"><span class="attribute">Philosopher3</span> exiting via interrupt</span><br><span class="line"><span class="attribute">Philosopher2</span> exiting via interrupt</span><br></pre></td></tr></table></figure>



<h4 id="银行转账问题"><a href="#银行转账问题" class="headerlink" title="银行转账问题"></a>银行转账问题</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransferMoney</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> flag;</span><br><span class="line">    <span class="keyword">static</span> Account a = <span class="keyword">new</span> Account(<span class="number">800</span>);</span><br><span class="line">    <span class="keyword">static</span> Account b = <span class="keyword">new</span> Account(<span class="number">600</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Account</span><span class="params">(<span class="keyword">int</span> balance)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.balance = balance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">1</span>) &#123;</span><br><span class="line">            transferMoney(a, b, <span class="number">200</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">            transferMoney(b, a, <span class="number">200</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">transferMoney</span><span class="params">(Account from, Account to, <span class="keyword">int</span> amount)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//先获取两把锁，然后开始转账</span></span><br><span class="line">        <span class="keyword">int</span> fromHash = System.identityHashCode(from);</span><br><span class="line">        <span class="keyword">int</span> toHash = System.identityHashCode(to);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() +  <span class="string">&quot;  fromHash &lt; toHash &quot;</span>+(fromHash &lt; toHash));</span><br><span class="line">        <span class="keyword">if</span> (fromHash &lt; toHash) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (from) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 获得锁A    &quot;</span> + from.balance);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (to) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 获得锁B    &quot;</span> + to.balance);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (from.balance - amount &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 余额不足，转账失败。&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"><span class="comment">//                    from.balance -= amount;</span></span><br><span class="line"><span class="comment">//                    to.balance += amount;</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 成功转账&quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fromHash &gt; toHash) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (to) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 获得锁A    &quot;</span> + to.balance);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (from) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 获得锁B    &quot;</span> + from.balance);</span><br><span class="line">                    <span class="keyword">if</span> (from.balance - amount &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;  余额不足，转账失败。&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"><span class="comment">//                    from.balance -= amount;</span></span><br><span class="line"><span class="comment">//                    to.balance += amount;</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;   成功转账&quot;</span> + amount + <span class="string">&quot;元&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TransferMoney r1 = <span class="keyword">new</span> TransferMoney();</span><br><span class="line">        TransferMoney r2 = <span class="keyword">new</span> TransferMoney();</span><br><span class="line">        r1.flag = <span class="number">1</span>;</span><br><span class="line">        r2.flag = <span class="number">0</span>;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(r1, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(r2, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t1.join();</span><br><span class="line">        t2.join();</span><br><span class="line"><span class="comment">//        System.out.println(&quot;a的余额&quot; + a.balance);</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;b的余额&quot; + b.balance);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>打印结构</p>
<blockquote>
<p>t1 fromHash 1967932108 toHash 2072748565  fromHash &lt; toHash true<br>t2 fromHash 2072748565 toHash 1967932108  fromHash &lt; toHash false<br>t1 获得锁A<br>t1 获得锁B<br>t1 成功转账200元<br>t2 获得锁B<br>t2 获得锁A<br>t2   成功转账200元<br>a的余额500</p>
<h4 id="b的余额500"><a href="#b的余额500" class="headerlink" title="b的余额500"></a>b的余额500</h4></blockquote>
<ol>
<li><p><strong>使用 HashCode 的值来决定顺序</strong></p>
<p>主要思想是，两个线程都先获取 锁A,再获取锁B,这样就不会有死锁了</p>
</li>
<li><p><strong>主键 ID 具有唯一、不重复的特点</strong></p>
<p>由主键 ID 大小来决定获取锁的顺序，就可以确保避免死锁。</p>
</li>
</ol>
</li>
</ul>
<h5 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h5><p>AtomicStampedReference 在变量前面添加版本号，每次变量更新的时候都把版本号加1</p>
<h5 id="AQS"><a href="#AQS" class="headerlink" title="AQS"></a>AQS</h5><p><a href="https://www.cnblogs.com/dennyzhangdd/p/7218510.html">https://www.cnblogs.com/dennyzhangdd/p/7218510.html</a></p>
<h5 id="信号量"><a href="#信号量" class="headerlink" title="信号量"></a>信号量</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SemaphoreTestMain</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Semaphore sSemaphore = <span class="keyword">new</span> Semaphore(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">final</span> SemaphoreTestMain semaphoreTestMain = <span class="keyword">new</span> SemaphoreTestMain();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; <span class="number">1000</span>;i++)</span><br><span class="line">            &#123;</span><br><span class="line">               Thread myThread = <span class="keyword">new</span> Thread()</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">super</span>.run();</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            semaphoreTestMain.test();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;;</span><br><span class="line">               myThread.setName(<span class="string">&quot;threat index:&quot;</span> + i);</span><br><span class="line">                myThread.start();</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        sSemaphore.acquire();</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--in&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--out&quot;</span> );</span><br><span class="line">        sSemaphore.release();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.bilibili.com/video/BV1B7411L7tE">https://www.bilibili.com/video/BV1B7411L7tE</a></p>
<p><a href="https://tech.meituan.com/2018/11/15/java-lock.html">https://tech.meituan.com/2018/11/15/java-lock.html</a></p>
<p><a href="https://blog.csdn.net/javazejian/article/details/72828483#t2">https://blog.csdn.net/javazejian/article/details/72828483#t2</a></p>
<p><a href="https://tech.meituan.com/2018/11/15/java-lock.html">https://tech.meituan.com/2018/11/15/java-lock.html</a></p>
]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>concurrency</tag>
      </tags>
  </entry>
  <entry>
    <title>ActivityStart01</title>
    <url>/2020/01/18/ActivityStart01/</url>
    <content><![CDATA[<p>　Activity创建</p>
<p>​    生命周期方法调用</p>
<p>本篇文章将根据源码解剖Android的Activity的启动流程，需注意的是下列的分析均基于Android7.0, 7.0版本相较于之前几个版本做了许多改动和重构，但是整体的流程是变化不大。根据启动Activity时机的不同，可分为根Activity的启动流程和普通Activity启动流程，根Activity启动流程又可以称为应用程序启动流程，即在桌面上点击一个应用图标到进入到应用第一个Activity的流程。而普通Activity的启动流程就是在一个应用里开启另外一个Activity的流程。由于两种启动流程是有重叠的，而根Activity的启动流程更加复杂，所以接下来我们重点分析根Activity的启动流程，而普通Activity的启动流程在涉及的地方会稍微提一下。由于考虑到篇幅较长，这里将分为两篇来介绍。</p>
<p>这篇将分析启动流程中的应用进程的创建：</p>
<ul>
<li>Launcher进程请求AMS</li>
<li>AMS发送创建应用进程请求</li>
<li>Zygote进程接受请求并孵化应用进程</li>
<li>应用进程启动ActivityThread</li>
</ul>
<p>MainActivity组件是由Launcher 组件来启动的，而Launcher组件又是通过Activity管理服务ActivityManagerServ ice来启动Main Activity组件的’。MainActivity组件、Launcher组件和 ActivityManagerService是分别运行在不同的进程中的，因此，MainActivity组件的启动过程就涉及到了三个进程。这三个进程是通过Binder进程间通信机制来完成MainActivity组件的启动过程的。 Launcher组件启动MainActivity组件的过程如下所示。</p>
<p> (1)Launcher组件向ActivityManagerService发送一个启动MainActivity组件的进程间通信请求。</p>
<p> ( 2 ) ActivityManagerService首先将要启动的MainActivity组件的信息保存下来，然后再向Launcher 组件发送一个进入中止状态的进程间通信请求。</p>
<p> ( 3 ) Launcher组件进入到中止状态之后，就会向ActivityManagerService发送一个已进人中止状态 的进程间通信请求，以便ActivityManagerServ ice可以继续执行启动MainActivity组件的操作。</p>
<p> (4) ActivityManagerService发现用来运行MairiActivity组件的应用程序进程不存在，因此，它就会 先启动一个新的应用程序进程。</p>
<p> (5）新的应用程序进程启动完成之后，就会向ActivityManagerServi(e发送一个启动完成的进程间 通信请求，以便ActivityManagerService可以继续执行启动MainActivity组件的操作。</p>
<p> (6) ActivityManagerService将第2步保存下来的MainActivity组件的信息发送给第4步创建的应用程序进程，以便它可以将MainActivity组件启动起来。 </p>
<h1 id="一、Launcher进程请求AMS"><a href="#一、Launcher进程请求AMS" class="headerlink" title="一、Launcher进程请求AMS"></a>一、Launcher进程请求AMS</h1><p>上面我们提到根Activity的启动流程其实就是桌面上点击一个应用图标进入到应用的第一个Activity的流程，其实桌面也可以看成一个程序，即Launcher。当系统开机后，Launcher也随之被启动，然后将已经安装的应用程序图标显示到桌面上，所以当我们点击一个应用图标其实就是相当于点击Activity中的一个button,其相应事件就是Launcher进程请求AMS来启动该应用程序。</p>
<h2 id="1-时序图"><a href="#1-时序图" class="headerlink" title="1. 时序图"></a>1. 时序图</h2><p><img src="/2020/01/18/ActivityStart01/RootActivityStart01.png" alt="在这里插入图片描述"></p>
<h2 id="2-详细过程"><a href="#2-详细过程" class="headerlink" title="2. 详细过程"></a>2. 详细过程</h2><p>请求的入口就是Launcher的startActivitySafe方法，如下：</p>
<blockquote>
<p>packages/apps/Launcher3/src/com/android/launcher3/Launcher.java</p>
</blockquote>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">bool</span>ean startActivitySafely(View v, Intent <span class="built_in">int</span>ent, ItemInfo item) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// 根Activity会在新的任务栈中启动</span></span><br><span class="line">    <span class="built_in">int</span>ent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">if</span> (isShortcut) &#123;</span><br><span class="line">            <span class="comment">// Shortcuts need some special checks due to legacy reasons.</span></span><br><span class="line">            startShortcutIntentSafely(<span class="built_in">int</span>ent, optsBundle, item);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (user == <span class="literal">null</span> || user.equals(Process.myUserHandle())) &#123;</span><br><span class="line">            <span class="comment">// 调用startActivity</span></span><br><span class="line">            startActivity(<span class="built_in">int</span>ent, optsBundle);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LauncherAppsCompat.getInstance(<span class="keyword">this</span>).startActivityForProfile(</span><br><span class="line">                    <span class="built_in">int</span>ent.getComponent(), user, <span class="built_in">int</span>ent.getSourceBounds(), optsBundle);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ActivityNotFoundException|SecurityException e) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现该方法为根Activity设置了flag，即根Activity会在新的任务栈中启动。然后会调用我们熟悉的startActivity方法,而在Launcher并没有这个方法，所以我们自然想到了应该是父类的方法，然后让我们来看看Launcher继承了哪些类？</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Launcher</span> <span class="keyword">extends</span> <span class="title">BaseDraggingActivity</span> <span class="title">implements</span> <span class="title">LauncherExterns</span>,</span></span><br><span class="line"><span class="class">        <span class="title">LauncherModel</span>.<span class="title">Callbacks</span>, <span class="title">LauncherProviderChangeListener</span>, <span class="title">UserEventDelegate</span></span>&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">public <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDraggingActivity</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span></span></span><br><span class="line"><span class="class">        <span class="title">implements</span> <span class="title">WallpaperColorInfo</span>.<span class="title">OnChangeListener</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">public <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> <span class="title">implements</span> <span class="title">UserEventDelegate</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其实一直追踪下去，你就会发现其实Launcher调用的startActivity其实就是Activity中的startActivity。从这里也可以证明Launcher其实也是个Activity。所以在Launcher启动一个app，和我们平时在startActivity基本是一样的（基本一样，不代表完全一样，通过后文分析你就会明白！），于是我们来看看我们熟悉的Activity中的startActivity的源码是如何的：</p>
<blockquote>
<p>源码：frameworks/base/core/java/android/app/Activity.java</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">startActivity</span>(<span class="params">Intent intent, <span class="meta">@Nullable</span> Bundle options</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//第二个参数为-1表示Launcher不需要知道根Activity的启动结果</span></span><br><span class="line">    <span class="keyword">if</span> (options != <span class="literal">null</span>) &#123;</span><br><span class="line">        startActivityForResult(intent, -<span class="number">1</span>, options);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Note we want to go through this call for compatibility with</span></span><br><span class="line">        <span class="comment">// applications that may have overridden the method.</span></span><br><span class="line">        startActivityForResult(intent, -<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">startActivityForResult</span>(<span class="params"><span class="meta">@RequiresPermission</span> Intent intent, int requestCode</span>)</span> &#123;</span><br><span class="line">    startActivityForResult(intent, requestCode, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> startActivityForResult(<span class="meta">@RequiresPermission</span> Intent intent, int requestCode,</span><br><span class="line">        <span class="meta">@Nullable</span> Bundle options) &#123;</span><br><span class="line">    <span class="comment">//mParent表示当前Activity的父类，当根活动还没创建则mParent==null    </span></span><br><span class="line">    <span class="keyword">if</span> (mParent == <span class="literal">null</span>) &#123;</span><br><span class="line">        options = transferSpringboardActivityOptions(options);</span><br><span class="line">        Instrumentation.ActivityResult ar =</span><br><span class="line">            mInstrumentation.execStartActivity(</span><br><span class="line">                <span class="built_in">this</span>, mMainThread.getApplicationThread(), mToken, <span class="built_in">this</span>,</span><br><span class="line">                intent, requestCode, options);</span><br><span class="line">       ... </span><br><span class="line">    &#125; </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从上面代码可以发现startActivity的最终实现是startActivityForResult，startActivity()第二个参数为-1表示Launcher不需要知道根Activity的启动结果,然后在startActivityForResult中由于此时根Activity还没有创建，故mParent=null,所以我们只需要关注mParent=null的情况。在这种情况中会调用Instrumentation的execStartActivity。这时候也许你就会问这个Instrumentation是什么？为什么要交给它处理？其实Instrumentation这个类很重要，重要体现在对Activity生命周期的调用。每个Activity都持有Instrumentation对象的一个引用，但是整个进程只会存在一个Instrumentation对象。看看Instrumentation的execStartActivity这个方法。</p>
<blockquote>
<p>frameworks/base/core/java/android/app/Instrumentation.java</p>
</blockquote>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ActivityResult execStartActivity(</span><br><span class="line">        Context who, IBinder contextThread, IBinder token, Activity <span class="keyword">target</span>,</span><br><span class="line">        Intent intent, <span class="keyword">int</span> requestCode, Bundle options) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"> ...</span><br><span class="line">  <span class="comment">//获取AMS的代理对象</span></span><br><span class="line">        <span class="keyword">int</span> result = ActivityManager.getService()</span><br><span class="line">            .startActivity(whoThread, who.getBasePackageName(), intent,</span><br><span class="line">                    intent.resolveTypeIfNeeded(who.getContentResolver()),</span><br><span class="line">                    token, <span class="keyword">target</span> != <span class="keyword">null</span> ? <span class="keyword">target</span>.mEmbeddedID : <span class="keyword">null</span>,</span><br><span class="line">                    requestCode, 0, <span class="keyword">null</span>, options);</span><br><span class="line">        checkStartActivityResult(result, intent);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Failure from system&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在这个方法会调用ActivityManager的getService方法来得到AMS的代理对象，然后调用这个代理对象的</p>
<p>startActivity方法，那么这个代理对象是谁呢？让我们一探究竟</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">IActivityManager <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">return</span> IActivityManagerSingleton.<span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton&lt;IActivityManager&gt; IActivityManagerSingleton =</span><br><span class="line">        <span class="keyword">new</span> Singleton&lt;IActivityManager&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">protected</span> <span class="function">IActivityManager <span class="title">create</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                <span class="comment">//得到activity的service引用，即IBinder类型的AMS引用</span></span><br><span class="line">                <span class="keyword">final</span> IBinder b = ServiceManager.getService(Context.ACTIVITY_SERVICE);</span><br><span class="line">	<span class="comment">//转换成IActivityManager对象</span></span><br><span class="line">                <span class="keyword">final</span> IActivityManager am = IActivityManager.Stub.asInterface(b);</span><br><span class="line">                <span class="keyword">return</span> am;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现在Singleton中的create方法中由于b是AMS引用作为服务端处于SystemServer进程中，与当前Launcher进程作为客户端与服务端不在同一个进程，所以am返回的是IActivityManager.Stub的代理对象，此时如果要实现客户端与服务端进程间的通信，只需要在AMS继承了IActivityManager.Stub类并实现了相应的方法，而通过下面的代码可以发现AMS刚好是继承了IActivityManager.Stub类的，这样Launcher进程作为客户端就拥有了服务端AMS的代理对象，然后就可以调用AMS的方法来实现具体功能了，就这样Launcher的工作就交给AMS实现了。</p>
<figure class="highlight scala"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">ActivityManagerService</span> <span class="keyword">extends</span> <span class="title">IActivityManager</span>.<span class="title">Stub</span></span></span><br><span class="line"><span class="class">        <span class="title">implements</span> <span class="title">Watchdog</span>.<span class="title">Monitor</span>, <span class="title">BatteryStatsImpl</span>.<span class="title">BatteryCallback</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h1 id="二、AMS发送创建应用进程请求"><a href="#二、AMS发送创建应用进程请求" class="headerlink" title="二、AMS发送创建应用进程请求"></a>二、AMS发送创建应用进程请求</h1><p>通过上面的分析，我们已经知道现在任务已经交给了AMS，入口是AMS的startActivity。</p>
<h2 id="1-时序图-1"><a href="#1-时序图-1" class="headerlink" title="1. 时序图"></a>1. 时序图</h2><p><img src="/2020/01/18/ActivityStart01/RootActivityStart02.png" alt="在这里插入图片描述"></p>
<h2 id="2-详细过程-1"><a href="#2-详细过程-1" class="headerlink" title="2. 详细过程"></a>2. 详细过程</h2><h3 id="2-1-AMS将请求任务转移给Process"><a href="#2-1-AMS将请求任务转移给Process" class="headerlink" title="2.1 AMS将请求任务转移给Process"></a>2.1 AMS将请求任务转移给Process</h3><p>首先来看看在AMS中的startActivity方法：</p>
<blockquote>
<p>源码：frameworks/base/services/core/java/com/android/server/am/ActivityManagerService.java</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">@Override</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(IApplicationThread caller, <span class="keyword">String</span> callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        Intent intent, <span class="keyword">String</span> resolvedType, IBinder resultTo, <span class="keyword">String</span> resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">startActivityAsUser</span>(caller, callingPackage, intent, resolvedType, resultTo,</span><br><span class="line">            resultWho, requestCode, startFlags, profilerInfo, bOptions,</span><br><span class="line">            UserHandle.<span class="built_in">getCallingUserId</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, <span class="keyword">String</span> callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        Intent intent, <span class="keyword">String</span> resolvedType, IBinder resultTo, <span class="keyword">String</span> resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions, <span class="keyword">int</span> userId)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">startActivityAsUser</span>(caller, callingPackage, intent, resolvedType, resultTo,</span><br><span class="line">            resultWho, requestCode, startFlags, profilerInfo, bOptions, userId,</span><br><span class="line">            <span class="literal">true</span> <span class="comment">/*validateIncomingUser*/</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">startActivityAsUser</span><span class="params">(IApplicationThread caller, <span class="keyword">String</span> callingPackage,</span></span></span><br><span class="line"><span class="function"><span class="params">        Intent intent, <span class="keyword">String</span> resolvedType, IBinder resultTo, <span class="keyword">String</span> resultWho, <span class="keyword">int</span> requestCode,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">int</span> startFlags, ProfilerInfo profilerInfo, Bundle bOptions, <span class="keyword">int</span> userId,</span></span></span><br><span class="line"><span class="function"><span class="params">        <span class="keyword">boolean</span> validateIncomingUser)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">			</span><br><span class="line">    <span class="comment">//判断调用者的进程是否隔离</span></span><br><span class="line">    <span class="built_in">enforceNotIsolatedCaller</span>(<span class="string">&quot;startActivity&quot;</span>);</span><br><span class="line">    <span class="comment">//检查调用者权限</span></span><br><span class="line">    userId = mActivityStartController.<span class="built_in">checkTargetUser</span>(userId, validateIncomingUser,</span><br><span class="line">            Binder.<span class="built_in">getCallingPid</span>(), Binder.<span class="built_in">getCallingUid</span>(), <span class="string">&quot;startActivityAsUser&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Switch to user app stacks here.</span></span><br><span class="line">    <span class="keyword">return</span> mActivityStartController.<span class="built_in">obtainStarter</span>(intent, <span class="string">&quot;startActivityAsUser&quot;</span>)</span><br><span class="line">            .<span class="built_in">setCaller</span>(caller)</span><br><span class="line">            .<span class="built_in">setCallingPackage</span>(callingPackage)</span><br><span class="line">            .<span class="built_in">setResolvedType</span>(resolvedType)</span><br><span class="line">            .<span class="built_in">setResultTo</span>(resultTo)</span><br><span class="line">            .<span class="built_in">setResultWho</span>(resultWho)</span><br><span class="line">            .<span class="built_in">setRequestCode</span>(requestCode)</span><br><span class="line">            .<span class="built_in">setStartFlags</span>(startFlags)</span><br><span class="line">            .<span class="built_in">setProfilerInfo</span>(profilerInfo)</span><br><span class="line">            .<span class="built_in">setActivityOptions</span>(bOptions)</span><br><span class="line">            .<span class="built_in">setMayWait</span>(userId)</span><br><span class="line">            .<span class="built_in">execute</span>();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>startActivity方法经过多个方法调用会去执行startActivityAsUser方法，在startActivityAsUser方法最后会返回mActivityStartController的一长串链式调用方法，如果AlertDialog的话，应该不难看出这链式方法肯定都是返回一个类型的对象的，我们只需要看看obtainStarter的返回类型就可以知道这个对象是什么类型了。</p>
<blockquote>
<p>frameworks/base/services/core/java/com/android/server/am/ActivityStartController.java</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">ActivityStarter obtain<span class="constructor">Starter(Intent <span class="params">intent</span>, String <span class="params">reason</span>)</span> &#123;</span><br><span class="line">    return mFactory.obtain<span class="literal">()</span>.set<span class="constructor">Intent(<span class="params">intent</span>)</span>.set<span class="constructor">Reason(<span class="params">reason</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以发现这个obtainStarter返回的是ActivityStarter类型的，所以链式方法就是对ActivityStarter对象设置了要启动的活动的相关信息，最后再调用ActivityStarter对象execute方法。所以我们下一步所需要看的就是这个execute方法。</p>
<blockquote>
<p>frameworks/base/services/core/java/com/android/server/am/ActivityStarter.java</p>
</blockquote>
<figure class="highlight roboconf"><table><tr><td class="code"><pre><span class="line">int execute() &#123;</span><br><span class="line">    <span class="attribute">try &#123;</span></span><br><span class="line"><span class="attribute">        // TODO(b/64750076)</span>: Look into passing request directly to these methods to allow</span><br><span class="line">        // for transactional diffs and preprocessing.</span><br><span class="line">        if (mRequest<span class="variable">.mayWait</span>) &#123;</span><br><span class="line">            return startActivityMayWait(mRequest<span class="variable">.caller</span>, mRequest<span class="variable">.callingUid</span>,</span><br><span class="line">                    mRequest<span class="variable">.callingPackage</span>, mRequest<span class="variable">.intent</span>, mRequest<span class="variable">.resolvedType</span>,</span><br><span class="line">                    mRequest<span class="variable">.voiceSession</span>, mRequest<span class="variable">.voiceInteractor</span>, mRequest<span class="variable">.resultTo</span>,</span><br><span class="line">                    mRequest<span class="variable">.resultWho</span>, mRequest<span class="variable">.requestCode</span>, mRequest<span class="variable">.startFlags</span>,</span><br><span class="line">                    mRequest<span class="variable">.profilerInfo</span>, mRequest<span class="variable">.waitResult</span>, mRequest<span class="variable">.globalConfig</span>,</span><br><span class="line">                    mRequest<span class="variable">.activityOptions</span>, mRequest<span class="variable">.ignoreTargetSecurity</span>, mRequest<span class="variable">.userId</span>,</span><br><span class="line">                    mRequest<span class="variable">.inTask</span>, mRequest<span class="variable">.reason</span>,</span><br><span class="line">                    mRequest<span class="variable">.allowPendingRemoteAnimationRegistryLookup</span>,</span><br><span class="line">                    mRequest<span class="variable">.originatingPendingIntent</span>);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return startActivity(mRequest.caller, mRequest.intent, mRequest.ephemeralIntent,</span><br><span class="line">                    mRequest.resolvedType, mRequest.activityInfo, mRequest.resolveInfo,</span><br><span class="line">                    mRequest.voiceSession, mRequest.voiceInteractor, mRequest.resultTo,</span><br><span class="line">                    mRequest.resultWho, mRequest.requestCode, mRequest.callingPid,</span><br><span class="line">                    mRequest.callingUid, mRequest.callingPackage, mRequest.realCallingPid,</span><br><span class="line">                    mRequest.realCallingUid, mRequest.startFlags, mRequest.activityOptions,</span><br><span class="line">                    mRequest.ignoreTargetSecurity, mRequest.componentSpecified,</span><br><span class="line">                    mRequest.outActivity, mRequest.inTask, mRequest.reason,</span><br><span class="line">                    mRequest.allowPendingRemoteAnimationRegistryLookup,</span><br><span class="line">                    mRequest.originatingPendingIntent);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        onExecutionComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为在startActivityAsUser的链式方法中我们调用了setMayWait这个方法，所以这里的mRequest.mayWait为true，故会继续调用startActivityMayWait方法。</p>
<blockquote>
<p>ActivityStarter#startActivityMayWait</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">startActivityMayWait</span><span class="params">(IApplicationThread caller, <span class="keyword">int</span> callingUid,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">String</span> callingPackage, Intent intent, <span class="keyword">String</span> resolvedType,</span></span></span><br><span class="line"><span class="function"><span class="params">          IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="function"><span class="params">          IBinder resultTo, <span class="keyword">String</span> resultWho, <span class="keyword">int</span> requestCode, <span class="keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">          ProfilerInfo profilerInfo, WaitResult outResult,</span></span></span><br><span class="line"><span class="function"><span class="params">          Configuration globalConfig, SafeActivityOptions options, <span class="keyword">boolean</span> ignoreTargetSecurity,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">int</span> userId, TaskRecord inTask, <span class="keyword">String</span> reason,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">boolean</span> allowPendingRemoteAnimationRegistryLookup,</span></span></span><br><span class="line"><span class="function"><span class="params">          PendingIntentRecord originatingPendingIntent)</span> </span>&#123;</span><br><span class="line">      .....</span><br><span class="line">      <span class="comment">//根据intent在系统中找到合适的应用的activity，如果有多个activity可选择，</span></span><br><span class="line"><span class="comment">//则会弹出ResolverActivity让用户选择合适的应用。</span></span><br><span class="line">      ActivityInfo aInfo = mSupervisor.<span class="built_in">resolveActivity</span>(intent, rInfo, startFlags, profilerInfo);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="keyword">int</span> res = <span class="built_in">startActivity</span>(caller, intent, ephemeralIntent, resolvedType, aInfo, rInfo,</span><br><span class="line">                  voiceSession, voiceInteractor, resultTo, resultWho, requestCode, callingPid,</span><br><span class="line">                  callingUid, callingPackage, realCallingPid, realCallingUid, startFlags, options,</span><br><span class="line">                  ignoreTargetSecurity, componentSpecified, outRecord, inTask, reason,</span><br><span class="line">                  allowPendingRemoteAnimationRegistryLookup, originatingPendingIntent);</span><br><span class="line">      ....</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(IApplicationThread caller, Intent intent, Intent ephemeralIntent,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">String</span> resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">          IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="function"><span class="params">          IBinder resultTo, <span class="keyword">String</span> resultWho, <span class="keyword">int</span> requestCode, <span class="keyword">int</span> callingPid, <span class="keyword">int</span> callingUid,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">String</span> callingPackage, <span class="keyword">int</span> realCallingPid, <span class="keyword">int</span> realCallingUid, <span class="keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">          SafeActivityOptions options, <span class="keyword">boolean</span> ignoreTargetSecurity, <span class="keyword">boolean</span> componentSpecified,</span></span></span><br><span class="line"><span class="function"><span class="params">          ActivityRecord[] outActivity, TaskRecord inTask, <span class="keyword">String</span> reason,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">boolean</span> allowPendingRemoteAnimationRegistryLookup)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">      mLastStartActivityResult = <span class="built_in">startActivity</span>(caller, intent, ephemeralIntent, resolvedType,</span><br><span class="line">              aInfo, rInfo, voiceSession, voiceInteractor, resultTo, resultWho, requestCode,</span><br><span class="line">              callingPid, callingUid, callingPackage, realCallingPid, realCallingUid, startFlags,</span><br><span class="line">              options, ignoreTargetSecurity, componentSpecified, mLastStartActivityRecord,</span><br><span class="line">              inTask, allowPendingRemoteAnimationRegistryLookup);</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">getExternalResult</span>(mLastStartActivityResult);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(IApplicationThread caller, Intent intent, Intent ephemeralIntent,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">String</span> resolvedType, ActivityInfo aInfo, ResolveInfo rInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">          IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="function"><span class="params">          IBinder resultTo, <span class="keyword">String</span> resultWho, <span class="keyword">int</span> requestCode, <span class="keyword">int</span> callingPid, <span class="keyword">int</span> callingUid,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">String</span> callingPackage, <span class="keyword">int</span> realCallingPid, <span class="keyword">int</span> realCallingUid, <span class="keyword">int</span> startFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">          SafeActivityOptions options,</span></span></span><br><span class="line"><span class="function"><span class="params">          <span class="keyword">boolean</span> ignoreTargetSecurity, <span class="keyword">boolean</span> componentSpecified, ActivityRecord[] outActivity,</span></span></span><br><span class="line"><span class="function"><span class="params">          TaskRecord inTask, <span class="keyword">boolean</span> allowPendingRemoteAnimationRegistryLookup)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">startActivity</span>(r, sourceRecord, voiceSession, voiceInteractor, startFlags,</span><br><span class="line">              <span class="literal">true</span> <span class="comment">/* doResume */</span>, checkedOptions, inTask, outActivity);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">startActivity</span><span class="params">(<span class="keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,</span></span></span><br><span class="line"><span class="function"><span class="params">              IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span></span></span><br><span class="line"><span class="function"><span class="params">              <span class="keyword">int</span> startFlags, <span class="keyword">boolean</span> doResume, ActivityOptions options, TaskRecord inTask,</span></span></span><br><span class="line"><span class="function"><span class="params">              ActivityRecord[] outActivity)</span> </span>&#123;</span><br><span class="line">      ...</span><br><span class="line">          result = <span class="built_in">startActivityUnchecked</span>(r, sourceRecord, voiceSession, voiceInteractor,</span><br><span class="line">                  startFlags, doResume, options, inTask, outActivity);</span><br><span class="line">      ...</span><br><span class="line"></span><br><span class="line">      <span class="built_in">postStartActivityProcessing</span>(r, result, mTargetStack);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>startActivityMayWait方法经过调用多次的startActivity方法后会调用到startActivityUnchecked这个方法，那这个方法是干啥的呢？这个方法会根据启动标志位和Activity启动模式来决定如何启动一个Activity以及是否要调用deliverNewIntent方法通知Activity有一个Intent试图重新启动它。比如我们在一开始将活动设置了FLAG_ACTIVITY_NEW_TASK后将创建一个任务栈，其它的就自行看代码。</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> startActivityUnchecked(<span class="keyword">final</span> ActivityRecord r, ActivityRecord sourceRecord,</span><br><span class="line">            IVoiceInteractionSession voiceSession, IVoiceInteractor voiceInteractor,</span><br><span class="line">            <span class="keyword">int</span> startFlags, <span class="keyword">boolean</span> doResume, ActivityOptions options, TaskRecord inTask,</span><br><span class="line">            ActivityRecord[] outActivity) &#123;</span><br><span class="line">...</span><br><span class="line"> <span class="keyword">if</span> (mStartActivity.resultTo == <span class="keyword">null</span> &amp;&amp; mInTask == <span class="keyword">null</span> &amp;&amp; !mAddingToTask</span><br><span class="line">                &amp;&amp; (mLaunchFlags &amp; FLAG_ACTIVITY_NEW_TASK) != <span class="number">0</span>) &#123;</span><br><span class="line">            newTask = <span class="keyword">true</span>;</span><br><span class="line">            <span class="comment">//创建新的TaskRecord</span></span><br><span class="line">            result = setTaskFromReuseOrCreateNewTask(</span><br><span class="line">                    taskToAffiliate, preferredLaunchStackId, topStack);</span><br><span class="line">        &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(mSourceRecord != <span class="keyword">null</span>)</span> </span>&#123;</span><br><span class="line">            result = setTaskFromSourceRecord();</span><br><span class="line">        &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(mInTask != <span class="keyword">null</span>)</span> </span>&#123;</span><br><span class="line">            result = setTaskFromInTask();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setTaskToCurrentTopOrCreateNewTask();</span><br><span class="line">        &#125;</span><br><span class="line">       ...</span><br><span class="line"> <span class="keyword">if</span> (mDoResume) &#123;</span><br><span class="line">            <span class="keyword">final</span> ActivityRecord topTaskActivity =</span><br><span class="line">                    mStartActivity.getTask().topRunningActivityLocked();</span><br><span class="line">            <span class="keyword">if</span> (!mTargetStack.isFocusable()</span><br><span class="line">                    || (topTaskActivity != <span class="keyword">null</span> &amp;&amp; topTaskActivity.mTaskOverlay</span><br><span class="line">                    &amp;&amp; mStartActivity != topTaskActivity)) &#123;</span><br><span class="line">               ...</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (mTargetStack.isFocusable() &amp;&amp; !mSupervisor.isFocusedStack(mTargetStack)) &#123;</span><br><span class="line">                    mTargetStack.moveToFront(<span class="string">&quot;startActivityUnchecked&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                mSupervisor.resumeFocusedStackTopActivityLocked(mTargetStack, mStartActivity,</span><br><span class="line">                        mOptions);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            mTargetStack.addRecentActivityLocked(mStartActivity);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后无论以何种模式启动最终都会调用ActivityStackSupervisor.resumeFocusedStackTopActivityLocked方法。</p>
<blockquote>
<p>frameworks/base/services/core/java/com/android/server/am/ActivityStackSupervisor.java</p>
</blockquote>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">boolean</span> resumeFocusedStackTopActivityLocked(</span><br><span class="line">        ActivityStack targetStack, ActivityRecord <span class="keyword">target</span>, ActivityOptions targetOptions) &#123;</span><br><span class="line">    ....</span><br><span class="line">    <span class="keyword">if</span> (targetStack != <span class="keyword">null</span> &amp;&amp; isFocusedStack(targetStack)) &#123;</span><br><span class="line">        <span class="function"><span class="keyword">return</span> targetStack.<span class="title">resumeTopActivityUncheckedLocked</span><span class="params">(<span class="keyword">target</span>, targetOptions)</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ....</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>于是又调用了ActivityStack的resumeTopActivityUncheckedLocked</p>
<blockquote>
<p>frameworks/base/services/core/java/com/android/server/am/ActivityStack.java</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">    @<span class="constructor">GuardedBy(<span class="string">&quot;mService&quot;</span>)</span></span><br><span class="line">    boolean resume<span class="constructor">TopActivityUncheckedLocked(ActivityRecord <span class="params">prev</span>, ActivityOptions <span class="params">options</span>)</span> &#123;</span><br><span class="line">       ...</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Protect against recursion.</span></span><br><span class="line">            mStackSupervisor.inResumeTopActivity = <span class="literal">true</span>;</span><br><span class="line">            result = resume<span class="constructor">TopActivityInnerLocked(<span class="params">prev</span>, <span class="params">options</span>)</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       ...</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> boolean resume<span class="constructor">TopActivityInnerLocked(ActivityRecord <span class="params">prev</span>, ActivityOptions <span class="params">options</span>)</span> &#123;</span><br><span class="line">      ...</span><br><span class="line">           mStackSupervisor.start<span class="constructor">SpecificActivityLocked(<span class="params">next</span>, <span class="params">true</span>, <span class="params">true</span>)</span>;</span><br><span class="line">       &#125;</span><br><span class="line">        <span class="keyword">if</span> (DEBUG_STACK) mStackSupervisor.validate<span class="constructor">TopActivitiesLocked()</span>;</span><br><span class="line">       return <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>emmmm…..，看到这估计都懵逼了，几个类跳来跳去也不知道干了些什么，不慌，让我们坚持看下ActivityStackSupervisor.startSpecificActivityLocked,因为这个方法很重要。这个方法将是普通Activity和根Activity启动流程的分岔路口。</p>
<blockquote>
<p>ActivityStackSupervisor#startSpecificActivityLocked</p>
</blockquote>
<figure class="highlight lasso"><table><tr><td class="code"><pre><span class="line">  <span class="literal">void</span> startSpecificActivityLocked(ActivityRecord r,</span><br><span class="line">          <span class="built_in">boolean</span> andResume, <span class="built_in">boolean</span> checkConfig) &#123;</span><br><span class="line">      <span class="comment">//获取即将要启动的Activity的所在的应用程序进程</span></span><br><span class="line">      ProcessRecord app = mService.getProcessRecordLocked(r.processName,</span><br><span class="line">              r.info.applicationInfo.uid, <span class="literal">true</span>);</span><br><span class="line">      <span class="comment">//如果应用进程已经存在</span></span><br><span class="line">      <span class="keyword">if</span> (app != <span class="built_in">null</span> &amp;&amp; app.<span class="keyword">thread</span> != <span class="built_in">null</span>) &#123;</span><br><span class="line">          try &#123;</span><br><span class="line">              <span class="keyword">if</span> ((r.info.flags&amp;ActivityInfo.FLAG_MULTIPROCESS) == <span class="number">0</span></span><br><span class="line">                      || !<span class="string">&quot;android&quot;</span>.<span class="keyword">equals</span>(r.info.packageName)) &#123;</span><br><span class="line">                  <span class="comment">// Don&#x27;t add this if it is a platform component that is marked</span></span><br><span class="line">                  <span class="comment">// to run in multiple processes, because this is actually</span></span><br><span class="line">                  <span class="comment">// part of the framework so doesn&#x27;t make sense to track as a</span></span><br><span class="line">                  <span class="comment">// separate apk in the process.</span></span><br><span class="line">                  app.addPackage(r.info.packageName, r.info.applicationInfo.longVersionCode,</span><br><span class="line">                          mService.mProcessStats);</span><br><span class="line">              &#125;</span><br><span class="line">              realStartActivityLocked(r, app, andResume, checkConfig);</span><br><span class="line">              <span class="keyword">return</span>;</span><br><span class="line">          &#125; catch (RemoteException e) &#123;</span><br><span class="line">              Slog.w(<span class="built_in">TAG</span>, <span class="string">&quot;Exception when starting activity &quot;</span></span><br><span class="line">                      + r.intent.getComponent().flattenToShortString(), e);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// If a dead object exception was thrown -- fall through to</span></span><br><span class="line">          <span class="comment">// restart the application.</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="comment">//应用进程还未创建，则通过AMS调用startProcessLocked向Zygote进程发送请求</span></span><br><span class="line">      mService.startProcessLocked(r.processName, r.info.applicationInfo, <span class="literal">true</span>, <span class="number">0</span>,</span><br><span class="line">              <span class="string">&quot;activity&quot;</span>, r.intent.getComponent(), <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>阅读上面的代码我们可以知道在方法中首先获取到了即将要启动的Activity所在的应用进程，假如是普通的Activity的启动流程的活，这个进程肯定是存在的，所以将执行realStartActivityLocked的方法。但是我们现在讨论的是根Activity的启动流程，由于应用都还未启动，意味着根Activity所在的应用进程还未创建，而mService其实就是AMS，所以这里将调用AMS的startProcessLocked。于是我们又回到了最初的起点AMS。</p>
<blockquote>
<p>ActivityManagerService.java</p>
</blockquote>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> ProcessRecord startProcessLocked(<span class="keyword">String</span> processName,</span><br><span class="line">        ApplicationInfo info, <span class="built_in">boolean</span> knownToBeDead, <span class="built_in">int</span> intentFlags,</span><br><span class="line">        <span class="keyword">String</span> hostingType, ComponentName hostingName, <span class="built_in">boolean</span> allowWhileBooting,</span><br><span class="line">        <span class="built_in">boolean</span> isolated, <span class="built_in">boolean</span> keepIfLarge) &#123;</span><br><span class="line">    <span class="keyword">return</span> startProcessLocked(processName, info, knownToBeDead, intentFlags, hostingType,</span><br><span class="line">            hostingName, allowWhileBooting, isolated, <span class="number">0</span> <span class="comment">/* isolatedUid */</span>, keepIfLarge,</span><br><span class="line">            <span class="keyword">null</span> <span class="comment">/* ABI override */</span>, <span class="keyword">null</span> <span class="comment">/* entryPoint */</span>, <span class="keyword">null</span> <span class="comment">/* entryPointArgs */</span>,</span><br><span class="line">            <span class="keyword">null</span> <span class="comment">/* crashHandler */</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> ProcessRecord startProcessLocked(<span class="keyword">String</span> processName, ApplicationInfo info,</span><br><span class="line">        <span class="built_in">boolean</span> knownToBeDead, <span class="built_in">int</span> intentFlags, <span class="keyword">String</span> hostingType, ComponentName hostingName,</span><br><span class="line">        <span class="built_in">boolean</span> allowWhileBooting, <span class="built_in">boolean</span> isolated, <span class="built_in">int</span> isolatedUid, <span class="built_in">boolean</span> keepIfLarge,</span><br><span class="line">        <span class="keyword">String</span> abiOverride, <span class="keyword">String</span> entryPoint, <span class="keyword">String</span>[] entryPointArgs, Runnable crashHandler) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">final</span> <span class="built_in">boolean</span> success = startProcessLocked(app, hostingType, hostingNameStr, abiOverride);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@GuardedBy(<span class="string">&quot;this&quot;</span>)</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="built_in">boolean</span> startProcessLocked(ProcessRecord app,</span><br><span class="line">        <span class="keyword">String</span> hostingType, <span class="keyword">String</span> hostingNameStr, <span class="keyword">String</span> abiOverride) &#123;</span><br><span class="line">    <span class="keyword">return</span> startProcessLocked(app, hostingType, hostingNameStr,</span><br><span class="line">            <span class="keyword">false</span> <span class="comment">/* disableHiddenApiChecks */</span>, abiOverride);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="built_in">boolean</span> startProcessLocked(ProcessRecord app, <span class="keyword">String</span> hostingType,</span><br><span class="line">        <span class="keyword">String</span> hostingNameStr, <span class="built_in">boolean</span> disableHiddenApiChecks, <span class="keyword">String</span> abiOverride) &#123;</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">        <span class="built_in">int</span> uid = app.uid; <span class="comment">//创建应用进程的用户ID</span></span><br><span class="line">        <span class="built_in">int</span>[] gids = <span class="keyword">null</span>;</span><br><span class="line">        <span class="built_in">int</span> mountExternal = Zygote.MOUNT_EXTERNAL_NONE;</span><br><span class="line">        <span class="keyword">if</span> (!app.isolated) &#123;</span><br><span class="line">            <span class="built_in">int</span>[] permGids = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                checkTime(startTime, <span class="string">&quot;startProcess: getting gids from package manager&quot;</span>);</span><br><span class="line">                <span class="keyword">final</span> IPackageManager pm = AppGlobals.getPackageManager();</span><br><span class="line">                permGids = pm.getPackageGids(app.info.packageName,</span><br><span class="line">                        MATCH_DEBUG_TRIAGED_MISSING, app.userId);</span><br><span class="line">                StorageManagerInternal storageManagerInternal = LocalServices.getService(</span><br><span class="line">                        StorageManagerInternal.class);</span><br><span class="line">                mountExternal = storageManagerInternal.getExternalStorageMountMode(uid,</span><br><span class="line">                        app.info.packageName);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (RemoteException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> e.rethrowAsRuntimeException();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 对用户组进行创建和赋值</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (ArrayUtils.isEmpty(permGids)) &#123;</span><br><span class="line">                gids = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">3</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                gids = <span class="keyword">new</span> <span class="built_in">int</span>[permGids.length + <span class="number">3</span>];</span><br><span class="line">                System.arraycopy(permGids, <span class="number">0</span>, gids, <span class="number">3</span>, permGids.length);</span><br><span class="line">            &#125;</span><br><span class="line">            gids[<span class="number">0</span>] = UserHandle.getSharedAppGid(UserHandle.getAppId(uid));</span><br><span class="line">            gids[<span class="number">1</span>] = UserHandle.getCacheAppGid(UserHandle.getAppId(uid));</span><br><span class="line">            gids[<span class="number">2</span>] = UserHandle.getUserGid(UserHandle.getUserId(uid));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Replace any invalid GIDs</span></span><br><span class="line">            <span class="keyword">if</span> (gids[<span class="number">0</span>] == UserHandle.ERR_GID) gids[<span class="number">0</span>] = gids[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">if</span> (gids[<span class="number">1</span>] == UserHandle.ERR_GID) gids[<span class="number">1</span>] = gids[<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        <span class="comment">//这个参数后文会提到</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">String</span> entryPoint = <span class="string">&quot;android.app.ActivityThread&quot;</span>;    </span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> startProcessLocked(hostingType, hostingNameStr, entryPoint, app, uid, gids,</span><br><span class="line">                runtimeFlags, mountExternal, seInfo, requiredAbi, instructionSet, invokeWith,</span><br><span class="line">                startTime);        </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="built_in">boolean</span> startProcessLocked(<span class="keyword">String</span> hostingType, <span class="keyword">String</span> hostingNameStr, <span class="keyword">String</span> entryPoint,</span><br><span class="line">        ProcessRecord app, <span class="built_in">int</span> uid, <span class="built_in">int</span>[] gids, <span class="built_in">int</span> runtimeFlags, <span class="built_in">int</span> mountExternal,</span><br><span class="line">        <span class="keyword">String</span> seInfo, <span class="keyword">String</span> requiredAbi, <span class="keyword">String</span> instructionSet, <span class="keyword">String</span> invokeWith,</span><br><span class="line">        <span class="keyword">long</span> startTime) &#123;</span><br><span class="line">    ....</span><br><span class="line">	<span class="comment">//重点关注</span></span><br><span class="line">                <span class="keyword">final</span> ProcessStartResult startResult = startProcess(app.hostingType, entryPoint,</span><br><span class="line">                        app, app.startUid, gids, runtimeFlags, mountExternal, app.seInfo,</span><br><span class="line">                        requiredAbi, instructionSet, invokeWith, app.startTime);</span><br><span class="line">          </span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> ProcessStartResult startProcess(<span class="keyword">String</span> hostingType, <span class="keyword">String</span> entryPoint,</span><br><span class="line">        ProcessRecord app, <span class="built_in">int</span> uid, <span class="built_in">int</span>[] gids, <span class="built_in">int</span> runtimeFlags, <span class="built_in">int</span> mountExternal,</span><br><span class="line">        <span class="keyword">String</span> seInfo, <span class="keyword">String</span> requiredAbi, <span class="keyword">String</span> instructionSet, <span class="keyword">String</span> invokeWith,</span><br><span class="line">        <span class="keyword">long</span> startTime) &#123;</span><br><span class="line">        ....</span><br><span class="line">        <span class="keyword">if</span> (hostingType.equals(<span class="string">&quot;webview_service&quot;</span>)) &#123;</span><br><span class="line">            startResult = startWebView(entryPoint,</span><br><span class="line">                    app.processName, uid, uid, gids, runtimeFlags, mountExternal,</span><br><span class="line">                    app.info.targetSdkVersion, seInfo, requiredAbi, instructionSet,</span><br><span class="line">                    app.info.dataDir, <span class="keyword">null</span>,</span><br><span class="line">                    <span class="keyword">new</span> <span class="keyword">String</span>[] &#123;PROC_START_SEQ_IDENT + app.startSeq&#125;);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">			</span><br><span class="line"><span class="comment">//通过Process.start方法来为应用创建进程</span></span><br><span class="line">            startResult = Process.start(entryPoint,</span><br><span class="line">                    app.processName, uid, uid, gids, runtimeFlags, mountExternal,</span><br><span class="line">                    app.info.targetSdkVersion, seInfo, requiredAbi, instructionSet,</span><br><span class="line">                    app.info.dataDir, invokeWith,</span><br><span class="line">                    <span class="keyword">new</span> <span class="keyword">String</span>[] &#123;PROC_START_SEQ_IDENT + app.startSeq&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        checkTime(startTime, <span class="string">&quot;startProcess: returned from zygote!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> startResult;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        Trace.traceEnd(Trace.TRACE_TAG_ACTIVITY_MANAGER);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过调用多个startProcessLocked方法后最终将调用startProcess方法，不过需要重点看一下上面的第四个startProcessLocked，在该方法中有个entryPoint参数为 “android.app.ActivityThread”，这个参数将在后文讲到创建应用进程后启动ActivityThread会用到。然后在startProcess方法里将调用Process.start来发送应用创建进程的请求。这样AMS就将发送请求的事交给了Process</p>
<h3 id="2-2-Process向Zygote进程发送创建应用进程请求"><a href="#2-2-Process向Zygote进程发送创建应用进程请求" class="headerlink" title="2.2 Process向Zygote进程发送创建应用进程请求"></a>2.2 Process向Zygote进程发送创建应用进程请求</h3><blockquote>
<p>frameworks/base/core/java/android/os/Process.java</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> ProcessStartResult <span class="title">start</span><span class="params">(<span class="keyword">final</span> <span class="keyword">String</span> processClass,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">final</span> <span class="keyword">String</span> niceName,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> uid, <span class="keyword">int</span> gid, <span class="keyword">int</span>[] gids,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> runtimeFlags, <span class="keyword">int</span> mountExternal,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">int</span> targetSdkVersion,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">String</span> seInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">String</span> abi,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">String</span> instructionSet,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">String</span> appDataDir,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">String</span> invokeWith,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">String</span>[] zygoteArgs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ZYGOTE_PROCESS.<span class="built_in">start</span>(processClass, niceName, uid, gid, gids,</span><br><span class="line">                runtimeFlags, mountExternal, targetSdkVersion, seInfo,</span><br><span class="line">                abi, instructionSet, appDataDir, invokeWith,</span><br><span class="line">                <span class="comment">/*useBlastulaPool=*/</span> <span class="literal">true</span>, zygoteArgs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="built_in">Process</span>.<span class="function">ProcessStartResult <span class="title">start</span><span class="params">(<span class="keyword">final</span> <span class="keyword">String</span> processClass,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">final</span> <span class="keyword">String</span> niceName,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">int</span> uid, <span class="keyword">int</span> gid, <span class="keyword">int</span>[] gids,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">int</span> runtimeFlags, <span class="keyword">int</span> mountExternal,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">int</span> targetSdkVersion,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">String</span> seInfo,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">String</span> abi,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">String</span> instructionSet,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">String</span> appDataDir,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">String</span> invokeWith,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">boolean</span> useBlastulaPool,</span></span></span><br><span class="line"><span class="function"><span class="params">                                              <span class="keyword">String</span>[] zygoteArgs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//重点关注</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">startViaZygote</span>(processClass, niceName, uid, gid, gids,</span><br><span class="line">                runtimeFlags, mountExternal, targetSdkVersion, seInfo,</span><br><span class="line">                abi, instructionSet, appDataDir, invokeWith,</span><br><span class="line">                <span class="comment">/*startChildZygote=*/</span><span class="literal">false</span>,</span><br><span class="line">                useBlastulaPool, zygoteArgs);</span><br><span class="line">    &#125; <span class="built_in"><span class="keyword">catch</span></span> (ZygoteStartFailedEx ex) &#123;</span><br><span class="line">        Log.<span class="built_in">e</span>(LOG_TAG,</span><br><span class="line">                <span class="string">&quot;Starting VM process through Zygote failed&quot;</span>);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(</span><br><span class="line">                <span class="string">&quot;Starting VM process through Zygote failed&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从上面可以发现，Process中的start方法的实现是startViaZygote方法，所以我们重点观察下这个方法。</p>
<figure class="highlight processing"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Process.ProcessStartResult startViaZygote(<span class="keyword">final</span> <span class="keyword">String</span> processClass,</span><br><span class="line">                                                  <span class="keyword">final</span> <span class="keyword">String</span> niceName,</span><br><span class="line">                                                  <span class="keyword">final</span> <span class="built_in">int</span> uid, <span class="keyword">final</span> <span class="built_in">int</span> gid,</span><br><span class="line">                                                  <span class="keyword">final</span> <span class="built_in">int</span>[] gids,</span><br><span class="line">                                                  <span class="built_in">int</span> runtimeFlags, <span class="built_in">int</span> mountExternal,</span><br><span class="line">                                                  <span class="built_in">int</span> targetSdkVersion,</span><br><span class="line">                                                  <span class="keyword">String</span> seInfo,</span><br><span class="line">                                                  <span class="keyword">String</span> abi,</span><br><span class="line">                                                  <span class="keyword">String</span> instructionSet,</span><br><span class="line">                                                  <span class="keyword">String</span> appDataDir,</span><br><span class="line">                                                  <span class="keyword">String</span> invokeWith,</span><br><span class="line">                                                  <span class="built_in">boolean</span> startChildZygote,</span><br><span class="line">                                                  <span class="built_in">boolean</span> useBlastulaPool,</span><br><span class="line">                                                  <span class="keyword">String</span>[] extraArgs)</span><br><span class="line">                                                  <span class="keyword">throws</span> ZygoteStartFailedEx &#123;</span><br><span class="line">    ArrayList&lt;<span class="keyword">String</span>&gt; argsForZygote = <span class="keyword">new</span> ArrayList&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// --runtime-args, --setuid=, --setgid=,</span></span><br><span class="line">    <span class="comment">//创建字符串列表argsForZygote，并将启动应用进程的启动参数保存在这个列表中</span></span><br><span class="line">    argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--runtime-args&quot;</span>);</span><br><span class="line">    argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--setuid=&quot;</span> + uid);</span><br><span class="line">    argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--setgid=&quot;</span> + gid);</span><br><span class="line">    argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--runtime-flags=&quot;</span> + runtimeFlags);</span><br><span class="line">    <span class="keyword">if</span> (mountExternal == Zygote.MOUNT_EXTERNAL_DEFAULT) &#123;</span><br><span class="line">        argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--mount-external-default&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mountExternal == Zygote.MOUNT_EXTERNAL_READ) &#123;</span><br><span class="line">        argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--mount-external-read&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mountExternal == Zygote.MOUNT_EXTERNAL_WRITE) &#123;</span><br><span class="line">        argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--mount-external-write&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    argsForZygote.<span class="built_in">add</span>(<span class="string">&quot;--target-sdk-version=&quot;</span> + targetSdkVersion);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">synchronized</span>(mLock) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">//重点关注</span></span><br><span class="line">        <span class="keyword">return</span> zygoteSendArgsAndGetResult(openZygoteSocketIfNeeded(abi),</span><br><span class="line">                                          useBlastulaPool,</span><br><span class="line">                                          argsForZygote);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在startViaZygote中会创建字符串列表argsForZygote来保存将要创建的应用进程的启动参数，然后最后会调用zygoteSendArgsAndGetResult方法，而在这个方法中第一个参数会调用openZygoteSocketIfNeeded方法，第三个参数就是启动参数列表。所以我们先看看openZygoteSocketIfNeeded这个方法的实现。</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">private</span> ZygoteState <span class="keyword">open</span><span class="constructor">ZygoteSocketIfNeeded(String <span class="params">abi</span>)</span></span><br><span class="line">          throws ZygoteStartFailedEx &#123;</span><br><span class="line"></span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">Preconditions</span>.</span></span>check<span class="constructor">State(Thread.<span class="params">holdsLock</span>(<span class="params">mLock</span>)</span>, <span class="string">&quot;ZygoteProcess lock not held&quot;</span>);</span><br><span class="line"><span class="comment">//64位进程中的</span></span><br><span class="line">      <span class="keyword">if</span> (primaryZygoteState<span class="operator"> == </span>null<span class="operator"> || </span>primaryZygoteState.is<span class="constructor">Closed()</span>) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	    <span class="comment">//调用ZygoteState的connect函数与mZygoteSocketAddress建立连接，</span></span><br><span class="line">              <span class="comment">//这里mZygoteSocketAddress的值为“zygote”</span></span><br><span class="line">              primaryZygoteState =</span><br><span class="line">                  <span class="module-access"><span class="module"><span class="identifier">ZygoteState</span>.</span></span>connect(mZygoteSocketAddress, mBlastulaPoolSocketAddress);</span><br><span class="line">          &#125; catch (IOException ioe) &#123;</span><br><span class="line">              throw <span class="keyword">new</span> <span class="constructor">ZygoteStartFailedEx(<span class="string">&quot;Error connecting to primary zygote&quot;</span>, <span class="params">ioe</span>)</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          maybe<span class="constructor">SetApiBlacklistExemptions(<span class="params">primaryZygoteState</span>, <span class="params">false</span>)</span>;</span><br><span class="line">          maybe<span class="constructor">SetHiddenApiAccessLogSampleRate(<span class="params">primaryZygoteState</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (primaryZygoteState.matches(abi)) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Socket进行连接成功并匹配abi后会返回ZygoteState类型对象</span></span><br><span class="line">          return primaryZygoteState;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 32位Zygote进程中</span></span><br><span class="line">      <span class="keyword">if</span> (secondaryZygoteState<span class="operator"> == </span>null<span class="operator"> || </span>secondaryZygoteState.is<span class="constructor">Closed()</span>) &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">              secondaryZygoteState =</span><br><span class="line">                  <span class="module-access"><span class="module"><span class="identifier">ZygoteState</span>.</span></span>connect(mZygoteSecondarySocketAddress,</span><br><span class="line">                                      mBlastulaPoolSecondarySocketAddress);</span><br><span class="line">          &#125; catch (IOException ioe) &#123;</span><br><span class="line">              throw <span class="keyword">new</span> <span class="constructor">ZygoteStartFailedEx(<span class="string">&quot;Error connecting to secondary zygote&quot;</span>, <span class="params">ioe</span>)</span>;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          maybe<span class="constructor">SetApiBlacklistExemptions(<span class="params">secondaryZygoteState</span>, <span class="params">false</span>)</span>;</span><br><span class="line">          maybe<span class="constructor">SetHiddenApiAccessLogSampleRate(<span class="params">secondaryZygoteState</span>)</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (secondaryZygoteState.matches(abi)) &#123;</span><br><span class="line">          return secondaryZygoteState;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      throw <span class="keyword">new</span> <span class="constructor">ZygoteStartFailedEx(<span class="string">&quot;Unsupported zygote ABI: &quot;</span> + <span class="params">abi</span>)</span>;</span><br><span class="line">  &#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>openZygoteSocketIfNeeded这个方法从方法名就可以推测出这个方法的作用，大概就是与Zygote建立Socket连接。而从代码中也证实了这一点，在代码中会根据Zygote进程的位数来建立相应的Socket连接，然后返回ZygoteState类型的对象。既然与Zygote建立好Socket连接后，接下来当然是发送请求！我们来看看zygoteSendArgsAndGetResult这个方法中是如何发送请求的！</p>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将传入的应用进程的启动参数argsForZygote写入到ZygoteState</span></span><br><span class="line">   @<span class="built_in">GuardedBy</span>(<span class="string">&quot;mLock&quot;</span>)</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">Process</span>.<span class="function">ProcessStartResult <span class="title">zygoteSendArgsAndGetResult</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">           ZygoteState zygoteState, <span class="keyword">boolean</span> useBlastulaPool, ArrayList&lt;<span class="keyword">String</span>&gt; args)</span></span></span><br><span class="line"><span class="function">           throws ZygoteStartFailedEx </span>&#123;</span><br><span class="line">       <span class="keyword">String</span> msgStr = Integer.<span class="built_in">toString</span>(args.<span class="built_in">size</span>()) + <span class="string">&quot;\n&quot;</span></span><br><span class="line">                       + <span class="keyword">String</span>.<span class="built_in">join</span>(<span class="string">&quot;\n&quot;</span>, args) + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// Should there be a timeout on this?</span></span><br><span class="line">       <span class="built_in">Process</span>.ProcessStartResult result = <span class="keyword">new</span> <span class="built_in">Process</span>.<span class="built_in">ProcessStartResult</span>();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// TODO (chriswailes): Move branch body into separate function.</span></span><br><span class="line">       <span class="keyword">if</span> (useBlastulaPool &amp;&amp; Zygote.BLASTULA_POOL_ENABLED &amp;&amp; <span class="built_in">isValidBlastulaCommand</span>(args)) &#123;</span><br><span class="line">           LocalSocket blastulaSessionSocket = null;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">               blastulaSessionSocket = zygoteState.<span class="built_in">getBlastulaSessionSocket</span>();</span><br><span class="line"></span><br><span class="line">               <span class="keyword">final</span> BufferedWriter blastulaWriter =</span><br><span class="line">                       <span class="keyword">new</span> <span class="built_in">BufferedWriter</span>(</span><br><span class="line">                               <span class="keyword">new</span> <span class="built_in">OutputStreamWriter</span>(blastulaSessionSocket.<span class="built_in">getOutputStream</span>()),</span><br><span class="line">                               Zygote.SOCKET_BUFFER_SIZE);</span><br><span class="line">               <span class="keyword">final</span> DataInputStream blastulaReader =</span><br><span class="line">                       <span class="keyword">new</span> <span class="built_in">DataInputStream</span>(blastulaSessionSocket.<span class="built_in">getInputStream</span>());</span><br><span class="line"></span><br><span class="line">               blastulaWriter.<span class="built_in">write</span>(msgStr);</span><br><span class="line">               blastulaWriter.<span class="built_in">flush</span>();</span><br><span class="line"></span><br><span class="line">               result.pid = blastulaReader.<span class="built_in">readInt</span>();</span><br><span class="line">               <span class="comment">// Blastulas can&#x27;t be used to spawn processes that need wrappers.</span></span><br><span class="line">               result.usingWrapper = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">if</span> (result.pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                   <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ZygoteStartFailedEx</span>(<span class="string">&quot;Blastula specialization failed&quot;</span>);</span><br><span class="line">               &#125;</span><br><span class="line"></span><br><span class="line">               <span class="keyword">return</span> result;</span><br><span class="line">           &#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException ex) &#123;</span><br><span class="line">               <span class="comment">// If there was an IOException using the blastula pool we will log the error and</span></span><br><span class="line">               <span class="comment">// attempt to start the process through the Zygote.</span></span><br><span class="line">               Log.<span class="built_in">e</span>(LOG_TAG, <span class="string">&quot;IO Exception while communicating with blastula pool - &quot;</span></span><br><span class="line">                              + ex.<span class="built_in">toString</span>());</span><br><span class="line">           &#125; finally &#123;</span><br><span class="line">               <span class="keyword">try</span> &#123;</span><br><span class="line">                   blastulaSessionSocket.<span class="built_in">close</span>();</span><br><span class="line">               &#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException ex) &#123;</span><br><span class="line">                   Log.<span class="built_in">e</span>(LOG_TAG, <span class="string">&quot;Failed to close blastula session socket: &quot;</span> + ex.<span class="built_in">getMessage</span>());</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           <span class="keyword">final</span> BufferedWriter zygoteWriter = zygoteState.mZygoteOutputWriter;</span><br><span class="line">           <span class="keyword">final</span> DataInputStream zygoteInputStream = zygoteState.mZygoteInputStream;</span><br><span class="line"></span><br><span class="line">           zygoteWriter.<span class="built_in">write</span>(msgStr);</span><br><span class="line">           zygoteWriter.<span class="built_in">flush</span>();</span><br><span class="line"></span><br><span class="line">           <span class="comment">// Always read the entire result from the input stream to avoid leaving</span></span><br><span class="line">           <span class="comment">// bytes in the stream for future process starts to accidentally stumble</span></span><br><span class="line">           <span class="comment">// upon.</span></span><br><span class="line">           result.pid = zygoteInputStream.<span class="built_in">readInt</span>();</span><br><span class="line">           result.usingWrapper = zygoteInputStream.<span class="built_in">readBoolean</span>();</span><br><span class="line">       &#125; <span class="built_in"><span class="keyword">catch</span></span> (IOException ex) &#123;</span><br><span class="line">           zygoteState.<span class="built_in">close</span>();</span><br><span class="line">           Log.<span class="built_in">e</span>(LOG_TAG, <span class="string">&quot;IO Exception while communicating with Zygote - &quot;</span></span><br><span class="line">                   + ex.<span class="built_in">toString</span>());</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ZygoteStartFailedEx</span>(ex);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (result.pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ZygoteStartFailedEx</span>(<span class="string">&quot;fork() failed&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">return</span> result;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>因为在openZygoteSocketIfNeeded中我们已经与Zygote进程建立了Socket连接，所以在这个方法中将传入的应用进程的启动参数argsForZygote写入到ZygoteState。这样AMS就完成了向Zygote进程发送创建应用进程的请求的任务。</p>
<h1 id="三、Zygote进程接受请求并孵化应用进程"><a href="#三、Zygote进程接受请求并孵化应用进程" class="headerlink" title="三、Zygote进程接受请求并孵化应用进程"></a>三、Zygote进程接受请求并孵化应用进程</h1><p>从上面我们知道，AMS已经与Zygote进程建立Socket连接并发送了创建应用进程的请求，那么Zygote进程是在哪里收到请求，收到请求后又是怎么处理的呢？通过阅读后我们知道Zygote进程是在ZygoteInit的main方法中接受请求的。所以现在的入口就是ZygoteInit的main方法。</p>
<h2 id="1-时序图-2"><a href="#1-时序图-2" class="headerlink" title="1. 时序图"></a>1. 时序图</h2><p><img src="/2020/01/18/ActivityStart01/RootActivityStart02.png" alt="在这里插入图片描述"></p>
<h2 id="2-详细过程-2"><a href="#2-详细过程-2" class="headerlink" title="2. 详细过程"></a>2. 详细过程</h2><p>从时序图与上面的分析我们知道现在Zygote进程接受请求是在main方法，就让我们来看看这个main方法</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</p>
</blockquote>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">    @UnsupportedAppUsage</span><br><span class="line">    public static void main(String argv<span class="literal">[]</span>) &#123;</span><br><span class="line">        ZygoteServer zygoteServer = <span class="keyword">new</span> <span class="constructor">ZygoteServer()</span>;</span><br><span class="line">        Runnable caller;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">			<span class="comment">//创建名为zygote的Socket</span></span><br><span class="line">            zygoteServer.create<span class="constructor">ZygoteSocket(<span class="params">socketName</span>)</span>;</span><br><span class="line">            ....</span><br><span class="line">			<span class="comment">//由于在init.rc中设置了start-system-server参数,因此</span></span><br><span class="line">			<span class="comment">//这里将启动SystemServer,可见SystemServer由Zygote创建的第一个进程</span></span><br><span class="line">            <span class="keyword">if</span> (startSystemServer) &#123;</span><br><span class="line">                Runnable r = fork<span class="constructor">SystemServer(<span class="params">abiList</span>, <span class="params">socketName</span>, <span class="params">zygoteServer</span>)</span>;</span><br><span class="line">                <span class="keyword">if</span> (r != null) &#123;</span><br><span class="line">                    r.run<span class="literal">()</span>;</span><br><span class="line">                    return;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">            caller = <span class="module-access"><span class="module"><span class="identifier">Zygote</span>.</span></span>init<span class="constructor">BlastulaPool()</span>;</span><br><span class="line">            <span class="keyword">if</span> (caller<span class="operator"> == </span>null) &#123;</span><br><span class="line">                <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>i(TAG, <span class="string">&quot;Accepting command socket connections&quot;</span>);</span><br><span class="line">                <span class="comment">//等待AMS的请求</span></span><br><span class="line">                run<span class="constructor">SelectLoop(<span class="params">abiList</span>)</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Throwable ex) &#123;</span><br><span class="line">            <span class="module-access"><span class="module"><span class="identifier">Log</span>.</span></span>e(TAG, <span class="string">&quot;System zygote died with exception&quot;</span>, ex);</span><br><span class="line">            throw ex;</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            zygoteServer.close<span class="constructor">ServerSocket()</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// We&#x27;re in the child process and have exited the select loop. Proceed to execute the</span></span><br><span class="line">        <span class="comment">// command.</span></span><br><span class="line">        <span class="keyword">if</span> (caller != null) &#123;</span><br><span class="line">            caller.run<span class="literal">()</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>通过main方法，我们可以知道在这个main方法首先要创建一个Server端的Socket，这个name为”zygote”的Socket用来等待ActivityManagerService来请求Zygote来创建新的应用程序进程,在上面AMS请求的分析中我们也知道客户端将根据这个name来与Zygote的Socket建立连接。接下去会启动SystemServer进程，这个进程会启动各种系统服务，比如与Activity启动息息相关的AMS。最后会调用ZygoteServer.runSelectLoop(abiList)来使创建的Socket进入无限循环，等待AMS请求。让我们来看看这个runSelectLoop</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/ZygoteServer.java</p>
</blockquote>
<figure class="highlight haxe"><table><tr><td class="code"><pre><span class="line">    Runnable runSelectLoop(<span class="keyword">String</span> abiList) &#123;</span><br><span class="line">   </span><br><span class="line">        ArrayList&lt;ZygoteConnection&gt; peers = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;ZygoteConnection&gt;();</span><br><span class="line">        peers.add(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (--pollIndex &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((pollFDs[pollIndex].revents &amp; POLLIN) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (pollIndex == <span class="number">0</span>) &#123;</span><br><span class="line">				  <span class="comment">//监听Socket连接，充当服务端Socket</span></span><br><span class="line">                    ZygoteConnection <span class="keyword">new</span><span class="type">Peer</span> = acceptCommandPeer(abiList);</span><br><span class="line">                    peers.add(<span class="keyword">new</span><span class="type">Peer</span>);</span><br><span class="line">                    socketFDs.add(<span class="keyword">new</span><span class="type">Peer</span>.getFileDescriptor());</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pollIndex &lt; blastulaPoolEventFDIndex) &#123; </span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">						<span class="comment">//不断处理客户端的AMS的请求，然后交给processOneCommand</span></span><br><span class="line">                        ZygoteConnection connection = peers.<span class="keyword">get</span>(pollIndex);</span><br><span class="line">                        final Runnable command = connection.processOneCommand(<span class="built_in">this</span>);</span><br><span class="line">                    &#125; </span><br><span class="line">                    ....</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>可以发现这个方法是死循环表示不停的监听着Socket连接。acceptCommandPeer方法就是监听是否收到了请求，如果收到了请求就交给processOneCommand来实现</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/ZygoteConnection.java</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">    Runnable <span class="function"><span class="title">processOneCommand</span>(<span class="params">ZygoteServer zygoteServer</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">String</span> args[];</span><br><span class="line">        ZygoteArguments parsedArgs = <span class="literal">null</span>;</span><br><span class="line">        FileDescriptor[] descriptors;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">		    <span class="comment">//获取应用程序进程的启动参数</span></span><br><span class="line">            args = Zygote.readArgumentList(mSocketReader);</span><br><span class="line">            <span class="comment">// TODO (chriswailes): Remove this and add an assert.</span></span><br><span class="line">            descriptors = mSocket.getAncillaryFileDescriptors();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;IOException on command socket&quot;</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        ....</span><br><span class="line">        parsedArgs = <span class="keyword">new</span> ZygoteArguments(args);</span><br><span class="line">        ....</span><br><span class="line">		<span class="comment">//fork当前进程创建一个子进程</span></span><br><span class="line">        pid = Zygote.forkAndSpecialize(parsedArgs.mUid, parsedArgs.mGid, parsedArgs.mGids,</span><br><span class="line">                parsedArgs.mRuntimeFlags, rlimits, parsedArgs.mMountExternal, parsedArgs.mSeInfo,</span><br><span class="line">                parsedArgs.mNiceName, fdsToClose, fdsToIgnore, parsedArgs.mStartChildZygote,</span><br><span class="line">                parsedArgs.mInstructionSet, parsedArgs.mAppDataDir, parsedArgs.mTargetSdkVersion);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">		    <span class="comment">//pid为0则代表这个进程为子进程，即新创建的应用程序进程</span></span><br><span class="line">            <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">                zygoteServer.setForkChild();</span><br><span class="line">                zygoteServer.closeServerSocket();</span><br><span class="line">                IoUtils.closeQuietly(serverPipeFd);</span><br><span class="line">                serverPipeFd = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> handleChildProc(parsedArgs, descriptors, childPipeFd,</span><br><span class="line">                        parsedArgs.mStartChildZygote);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// In the parent. A pid &lt; 0 indicates a failure and will be handled in</span></span><br><span class="line">                <span class="comment">// handleParentProc.</span></span><br><span class="line">                IoUtils.closeQuietly(childPipeFd);</span><br><span class="line">                childPipeFd = <span class="literal">null</span>;</span><br><span class="line">                handleParentProc(pid, descriptors, serverPipeFd);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            IoUtils.closeQuietly(childPipeFd);</span><br><span class="line">            IoUtils.closeQuietly(serverPipeFd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在这个方法中将对请求进行处理，首先获取到将要启动的应用进程的启动参数，然后调用forkAndSpecialize来创建应用进程。</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/Zygote.java</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">forkAndSpecialize</span><span class="params">(<span class="keyword">int</span> uid, <span class="keyword">int</span> gid, <span class="keyword">int</span>[] gids, <span class="keyword">int</span> runtimeFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span>[][] rlimits, <span class="keyword">int</span> mountExternal, <span class="keyword">String</span> seInfo, <span class="keyword">String</span> niceName, <span class="keyword">int</span>[] fdsToClose,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span>[] fdsToIgnore, <span class="keyword">boolean</span> startChildZygote, <span class="keyword">String</span> instructionSet, <span class="keyword">String</span> appDataDir,</span></span></span><br><span class="line"><span class="function"><span class="params">            <span class="keyword">int</span> targetSdkVersion)</span> </span>&#123;</span><br><span class="line">        ZygoteHooks.<span class="built_in">preFork</span>();</span><br><span class="line">        <span class="comment">// Resets nice priority for zygote process.</span></span><br><span class="line">        <span class="built_in">resetNicePriority</span>();</span><br><span class="line">        <span class="keyword">int</span> pid = <span class="built_in">nativeForkAndSpecialize</span>(</span><br><span class="line">                uid, gid, gids, runtimeFlags, rlimits, mountExternal, seInfo, niceName, fdsToClose,</span><br><span class="line">                fdsToIgnore, startChildZygote, instructionSet, appDataDir);</span><br><span class="line">        <span class="comment">// Enable tracing as soon as possible for the child process.</span></span><br><span class="line">        <span class="keyword">if</span> (pid == <span class="number">0</span>) &#123;</span><br><span class="line">            Zygote.<span class="built_in">disableExecuteOnly</span>(targetSdkVersion);</span><br><span class="line">            Trace.<span class="built_in">setTracingEnabled</span>(<span class="literal">true</span>, runtimeFlags);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Note that this event ends at the end of handleChildProc,</span></span><br><span class="line">            Trace.<span class="built_in">traceBegin</span>(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">&quot;PostFork&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ZygoteHooks.<span class="built_in">postForkCommon</span>();</span><br><span class="line">        <span class="keyword">return</span> pid;</span><br><span class="line">    &#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在forkAndSpecialize中，最终将创建应用进程的任务交给nativeForkAndSpecialize，而这个方法可以看出来应该是本地方法，所以具体如何创建的我们就不深究了，在这里我们这需要知道nativeForkAndSpecialize最终是通过fork当前线程来创建一个子线程，而fork后会有返回值给pid:</p>
<ul>
<li>父进程中，fork返回新创建的子进程pid;</li>
<li>子进程中，fork返回0；</li>
<li>出现错误时，fork返回负数。</li>
</ul>
<p>于是到这里子线程也就是应用进程就被孵化出来了。你以为这样就结束了？其实还早呢！别忘了我们的最终使命是根Activity的启动，而现在只是有了根Activity所需要的应用进程，革命尚未成功，仍需要努力！</p>
<h1 id="四、应用进程启动ActivityThread"><a href="#四、应用进程启动ActivityThread" class="headerlink" title="四、应用进程启动ActivityThread"></a>四、应用进程启动ActivityThread</h1><h2 id="1-时序图-3"><a href="#1-时序图-3" class="headerlink" title="1. 时序图"></a>1. 时序图</h2><p><img src="/2020/01/18/ActivityStart01/RootActivityStart03.png" alt="在这里插入图片描述"></p>
<h2 id="2-详细过程-3"><a href="#2-详细过程-3" class="headerlink" title="2. 详细过程"></a>2. 详细过程</h2><p>从上面我们知道应用进程已经被创建，那创建后呢？这就需要我们回头看上面的processOneCommand方法，细心的你肯定会发现再孵化出应用进程后，还是有返回值的。</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/ZygoteConnection.java</p>
</blockquote>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">  Runnable processOneCommand<span class="params">(ZygoteServer zygoteServer)</span> &#123;</span><br><span class="line">      <span class="string">....</span></span><br><span class="line"><span class="string">//fork</span>当前进程创建一个子进程</span><br><span class="line">      pid = Zygote.forkAndSpecialize<span class="params">(parsedArgs.mUid, parsedArgs.mGid, parsedArgs.mGids,</span></span><br><span class="line"><span class="params">              parsedArgs.mRuntimeFlags, rlimits, parsedArgs.mMountExternal, parsedArgs.mSeInfo,</span></span><br><span class="line"><span class="params">              parsedArgs.mNiceName, fdsToClose, fdsToIgnore, parsedArgs.mStartChildZygote,</span></span><br><span class="line"><span class="params">              parsedArgs.mInstructionSet, parsedArgs.mAppDataDir, parsedArgs.mTargetSdkVersion)</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="string">//pid</span>为0则代表这个进程为子进程，即新创建的应用程序进程</span><br><span class="line">          <span class="keyword">if</span> <span class="params">(<span class="attr">pid</span> == 0)</span> &#123;</span><br><span class="line">              <span class="string">....</span></span><br><span class="line">              return handleChildProc<span class="params">(parsedArgs, descriptors, childPipeFd,</span></span><br><span class="line"><span class="params">                      parsedArgs.mStartChildZygote)</span>;</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">              <span class="string">...</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="string">....</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在上面我们分析了当pid=0的时候，则代表了当前进程已经是子进程了，即应用进程。所以下一步将执行handleChildProc方法。</p>
<figure class="highlight aspectj"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> Runnable handleChildProc(ZygoteArguments parsedArgs, FileDescriptor[] descriptors,</span><br><span class="line">        FileDescriptor pipeFd, <span class="keyword">boolean</span> isZygote) &#123;</span><br><span class="line">        .....</span><br><span class="line">        <span class="keyword">if</span> (!isZygote) &#123;</span><br><span class="line">            <span class="keyword">return</span> ZygoteInit.zygoteInit(parsedArgs.mTargetSdkVersion,</span><br><span class="line">                    parsedArgs.mRemainingArgs, <span class="keyword">null</span> <span class="comment">/* classLoader */</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           ....</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而handleChildProc最终又会调用ZygoteInit.zygoteInit方法。如下</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</p>
</blockquote>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line">  <span class="selector-tag">public</span> <span class="selector-tag">static</span> <span class="selector-tag">final</span> <span class="selector-tag">Runnable</span> <span class="selector-tag">zygoteInit</span>(int targetSdkVersion, String[] argv,</span><br><span class="line">          ClassLoader classLoader) &#123;</span><br><span class="line">      <span class="selector-tag">if</span> (RuntimeInit.DEBUG) &#123;</span><br><span class="line">          <span class="selector-tag">Slog</span><span class="selector-class">.d</span>(RuntimeInit.TAG, <span class="string">&quot;RuntimeInit: Starting application from zygote&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="selector-tag">Trace</span><span class="selector-class">.traceBegin</span>(Trace.TRACE_TAG_ACTIVITY_MANAGER, <span class="string">&quot;ZygoteInit&quot;</span>);</span><br><span class="line">      <span class="selector-tag">RuntimeInit</span><span class="selector-class">.redirectLogStreams</span>();</span><br><span class="line"><span class="comment">//为当前的VM设置未捕获异常器</span></span><br><span class="line">      <span class="selector-tag">RuntimeInit</span><span class="selector-class">.commonInit</span>();</span><br><span class="line"><span class="comment">//Binder驱动初始化，该方法完成后，可通过Binder进行进程通信</span></span><br><span class="line">      <span class="selector-tag">ZygoteInit</span><span class="selector-class">.nativeZygoteInit</span>();</span><br><span class="line"><span class="comment">//主要调用SystemServer的main方法</span></span><br><span class="line">      <span class="selector-tag">return</span> <span class="selector-tag">RuntimeInit</span><span class="selector-class">.applicationInit</span>(targetSdkVersion, argv, classLoader);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在这个方法里会创建当前进程的Binder线程池，便于后续与其它进程通信，然后调用了RuntimeInit的applicationInit方法，如下：</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/RuntimeInit.java</p>
</blockquote>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">static</span> Runnable <span class="title">applicationInit</span><span class="params">(<span class="keyword">int</span> targetSdkVersion, <span class="keyword">String</span>[] argv,</span></span></span><br><span class="line"><span class="function"><span class="params">         ClassLoader classLoader)</span> </span>&#123;</span><br><span class="line">     ...</span><br><span class="line">     <span class="keyword">final</span> Arguments args = <span class="keyword">new</span> <span class="built_in">Arguments</span>(argv);</span><br><span class="line">     <span class="comment">// Remaining arguments are passed to the start class&#x27;s static main</span></span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">findStaticMain</span>(args.startClass, args.startArgs, classLoader);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个方法最终会调用findStaticMain方法，不过需注意的是方法的第一个参数args.startClass其实就是我们上文AMS将请求任务转移给Process中在最后强调的那个参数：android.app.ActivityThread。然后我们看看findStaticMain的实现</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="built_in">static</span> Runnable findStaticMain(<span class="keyword">String</span> className, <span class="keyword">String</span>[] argv,</span><br><span class="line">        ClassLoader classLoader) &#123;</span><br><span class="line">    <span class="class"><span class="keyword">Class</span>&lt;?&gt; <span class="title">cl</span>;</span></span><br><span class="line"><span class="class">    <span class="title">try</span> </span>&#123;</span><br><span class="line">        cl = <span class="keyword">Class</span>.forName(className, <span class="literal">true</span>, classLoader);<span class="comment">//1</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</span><br><span class="line">       ....</span><br><span class="line">    &#125;</span><br><span class="line">    Method m;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        m = cl.getMethod(<span class="string">&quot;main&quot;</span>, <span class="keyword">new</span> <span class="class"><span class="keyword">Class</span>[] </span>&#123; <span class="keyword">String</span>[].<span class="keyword">class</span> &#125;);<span class="comment">//2</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException ex) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SecurityException ex) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MethodAndArgsCaller(m, argv);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在这个方法中首先在注释1通过反射获取到android.app.ActivityThread类，然后在注释2获取到ActivityThread的main方法，最后通过main方法来构造MethodAndArgsCaller。而这个MethodAndArgsCaller是什么呢？如下：</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/RuntimeInit.java</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="built_in">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MethodAndArgsCaller</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="comment">/** method to call */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Method mMethod;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** argument array */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">String</span>[] mArgs;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> MethodAndArgsCaller(Method method, <span class="keyword">String</span>[] args) &#123;</span><br><span class="line">            mMethod = method;</span><br><span class="line">            mArgs = args;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> run() &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                mMethod.invoke(<span class="literal">null</span>, <span class="keyword">new</span> <span class="keyword">Object</span>[] &#123; mArgs &#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(ex);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException ex) &#123;</span><br><span class="line">                <span class="built_in">Throwable</span> cause = ex.getCause();</span><br><span class="line">                <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> <span class="built_in">RuntimeException</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> (<span class="built_in">RuntimeException</span>) cause;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (cause <span class="keyword">instanceof</span> <span class="built_in">Error</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> (<span class="built_in">Error</span>) cause;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>追踪下去，MethodAndArgsCaller其实是RuntimeInit的一个内部类并且继承了Runnable,然后在run方法中会通过反射调用了mMethod方法，此时mMethod是ActivityThread的main方法，即run方法中将会执行ActivityThread的main方法，在这里你可能会有疑问了，那这个run方法什么时候执行呢？让我们来看看最开始的ZygoteInit的main方法。</p>
<blockquote>
<p>frameworks/base/core/java/com/android/internal/os/ZygoteInit.java</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="meta">@UnsupportedAppUsage</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span> argv[]</span>)</span> &#123;</span><br><span class="line">    Runnable caller;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">       ....</span><br><span class="line">        caller = Zygote.initBlastulaPool();</span><br><span class="line">        <span class="keyword">if</span> (caller == <span class="literal">null</span>) &#123;</span><br><span class="line">            Log.i(TAG, <span class="string">&quot;Accepting command socket connections&quot;</span>);</span><br><span class="line">            <span class="comment">//等待AMS的请求</span></span><br><span class="line">            caller = zygoteServer.runSelectLoop(abiList);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;System zygote died with exception&quot;</span>, ex);</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        zygoteServer.closeServerSocket();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (caller != <span class="literal">null</span>) &#123;</span><br><span class="line">        caller.run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>从分析Zygote进程接受请求并孵化应用进程的一开始，我们就是分析runSelectLoop(abiList)这个方法，而分析到最后findStaticMain方法将返回MethodAndArgsCaller对象（继承Runnable）,所以这时候在ZygoteInit的main方法caller会等于这个MethodAndArgsCaller对象，显然caller不等于null，故最后会执行caller.run方法，即执行ActivityThread的main方法。于是应用进程成功启动ActivityThread。</p>
<p><a href="https://juejin.im/post/5d9d948de51d45782c23fabc">https://juejin.im/post/5d9d948de51d45782c23fabc</a></p>
<p><a href="https://juejin.im/post/5a936c5a6fb9a0633229ca74">https://juejin.im/post/5a936c5a6fb9a0633229ca74</a></p>
<p><a href="http://codemx.cn/2018/01/26/AndroidOS008-Activity/">http://codemx.cn/2018/01/26/AndroidOS008-Activity/</a></p>
<p><a href="http://liuwangshu.cn/framework/booting/2-zygote.html">Android系统启动流程（二）解析Zygote进程启动过程</a></p>
<p><a href="https://juejin.im/post/6867744083809419277">https://juejin.im/post/6867744083809419277</a></p>
<p><a href="https://juejin.im/post/6887431834041483271">https://juejin.im/post/6887431834041483271</a></p>
<p>启动流程目的</p>
<p><a href="https://juejin.cn/post/6897892195483779080">https://juejin.cn/post/6897892195483779080</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
      <tags>
        <tag>AOSP</tag>
      </tags>
  </entry>
  <entry>
    <title>JVM_STACK</title>
    <url>/2020/01/04/JVM-STACK/</url>
    <content><![CDATA[<p>字节码指令运行</p>
<p><a href="https://www.bilibili.com/video/BV1PJ411n7xZ?p=49">https://www.bilibili.com/video/BV1PJ411n7xZ?p=49</a></p>
<h1 id="虚拟机栈"><a href="#虚拟机栈" class="headerlink" title="虚拟机栈"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88">虚拟机栈</a></h1><h3 id="虚拟机栈的出现背景"><a href="#虚拟机栈的出现背景" class="headerlink" title="虚拟机栈的出现背景"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E7%9A%84%E5%87%BA%E7%8E%B0%E8%83%8C%E6%99%AF">虚拟机栈的出现背景</a></h3><ol>
<li>由于跨平台性的设计，Java的指令都是根据栈来设计的。不同平台CPU架构不同，所以不能设计为基于寄存器的【如果设计成基于寄存器的，耦合度高，性能会有所提升，因为可以对具体的CPU架构进行优化，但是跨平台性大大降低】。</li>
<li>优点是跨平台，指令集小，编译器容易实现，缺点是性能下降，实现同样的功能需要更多的指令。</li>
</ol>
<h3 id="内存中的栈与堆"><a href="#内存中的栈与堆" class="headerlink" title="内存中的栈与堆"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%86%85%E5%AD%98%E4%B8%AD%E7%9A%84%E6%A0%88%E4%B8%8E%E5%A0%86">内存中的栈与堆</a></h3><ol>
<li><p>首先栈是运行时的单位，而堆是存储的单位。</p>
</li>
<li><p>即：栈解决程序的运行问题，即程序如何执行，或者说如何处理数据。堆解决的是数据存储的问题，即数据怎么放，放哪里</p>
</li>
</ol>
<h3 id="虚拟机栈基本内容"><a href="#虚拟机栈基本内容" class="headerlink" title="虚拟机栈基本内容"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%9F%BA%E6%9C%AC%E5%86%85%E5%AE%B9">虚拟机栈基本内容</a></h3><ul>
<li>Java虚拟机栈是什么？</li>
</ul>
<p>Java虚拟机栈（Java Virtual Machine Stack），早期也叫Java栈。每个线程在创建时都会创建一个虚拟机栈，其内部保存一个个的栈帧（Stack Frame），<strong>对应着一次次的Java方法调用</strong>，栈是线程私有的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StackTest test = <span class="keyword">new</span> StackTest();</span><br><span class="line">        test.methodA();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">        methodB();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> k = <span class="number">30</span>;</span><br><span class="line">        <span class="keyword">int</span> m = <span class="number">40</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/04/JVM-STACK/0002.png"></p>
<ul>
<li>虚拟机栈的生命周期</li>
</ul>
<ul>
<li>生命周期和线程一致，也就是线程结束了，该虚拟机栈也销毁了</li>
</ul>
<ul>
<li><p>虚拟机栈的作用</p>
<ul>
<li>主管Java程序的运行，它保存方法的局部变量（8 种基本数据类型、对象的引用地址）、部分结果，并参与方法的调用和返回。</li>
<li>局部变量，它是相比于成员变量来说的（或属性）</li>
<li>基本数据类型变量 VS 引用类型变量（类、数组、接口）</li>
</ul>
<p>​    </p>
</li>
</ul>
<h3 id="虚拟机栈的特点"><a href="#虚拟机栈的特点" class="headerlink" title="虚拟机栈的特点"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E7%9A%84%E7%89%B9%E7%82%B9">虚拟机栈的特点</a></h3><ul>
<li>栈是一种快速有效的分配存储方式，访问速度仅次于程序计数器。</li>
<li>JVM直接对Java栈的操作只有两个：<ul>
<li>每个方法执行，伴随着<strong>进栈</strong>（入栈、压栈）</li>
<li>执行结束后的<strong>出栈</strong>工作</li>
</ul>
</li>
<li>对于栈来说不存在垃圾回收问题<ul>
<li>栈不需要GC，但是可能存在OOM</li>
</ul>
</li>
</ul>
<p><img src="/2020/01/04/JVM-STACK/0003.png"></p>
<h3 id="虚拟机栈的异常"><a href="#虚拟机栈的异常" class="headerlink" title="虚拟机栈的异常"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E7%9A%84%E5%BC%82%E5%B8%B8">虚拟机栈的异常</a></h3><p><strong>面试题：栈中可能出现的异常？</strong></p>
<ul>
<li>Java 虚拟机规范允许Java栈的大小是动态的或者是固定不变的。<ul>
<li>如果采用固定大小的Java虚拟机栈，那每一个线程的Java虚拟机栈容量可以在线程创建的时候独立选定。如果线程请求分配的栈容量超过Java虚拟机栈允许的最大容量，Java虚拟机将会抛出一个<strong>StackoverflowError</strong> 异常。</li>
<li>如果Java虚拟机栈可以动态扩展，并且在尝试扩展的时候无法申请到足够的内存，或者在创建新的线程时没有足够的内存去创建对应的虚拟机栈，那Java虚拟机将会抛出一个 <strong>OutofMemoryError</strong> 异常。</li>
</ul>
</li>
</ul>
<h3 id="设置栈内存大小"><a href="#设置栈内存大小" class="headerlink" title="设置栈内存大小"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%AE%BE%E7%BD%AE%E6%A0%88%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F">设置栈内存大小</a></h3><p>我们可以使用参数 <strong>-Xss</strong> 选项来设置线程的最大栈空间，栈的大小直接决定了函数调用的最大可达深度。</p>
<blockquote>
<p>Sets the thread stack size (in bytes). Append the letter <code>k</code> or <code>K</code> to indicate KB, <code>m</code> or <code>M</code> to indicate MB, and <code>g</code> or <code>G</code> to indicate GB. The default value depends on the platform:</p>
<ul>
<li>Linux/x64 (64-bit): 1024 KB</li>
<li>macOS (64-bit): 1024 KB</li>
<li>Oracle Solaris/x64 (64-bit): 1024 KB</li>
<li>Windows: The default value depends on virtual memory</li>
</ul>
</blockquote>
<p>The following examples set the thread stack size to 1024 KB in different units:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">-Xss1m</span><br><span class="line">-Xss1024k</span><br><span class="line">-Xss1048576</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StackErrorTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> count = <span class="number">1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        count++;</span><br><span class="line">        main(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>没设置参数前</strong></p>
<p>部分输出结果：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">11404</span></span><br><span class="line"><span class="number">11405</span></span><br><span class="line"><span class="number">11406</span></span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.StackOverflowError</span><br><span class="line">    at sun.nio.cs.UTF_8$Encoder.encodeLoop(UTF_8.java:<span class="number">691</span>)</span><br></pre></td></tr></table></figure>

<p>说明栈在11406这个深度溢出了</p>
<p><img src="/2020/01/04/JVM-STACK/0004.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">2474</span></span><br><span class="line"><span class="number">2475</span></span><br><span class="line"><span class="number">2476</span></span><br><span class="line">Exception in thread <span class="string">&quot;main&quot;</span> java.lang.StackOverflowError</span><br><span class="line">    at sun.nio.cs.UTF_8.updatePositions(UTF_8.java:<span class="number">77</span>)</span><br></pre></td></tr></table></figure>

<h2 id="栈的存储单位"><a href="#栈的存储单位" class="headerlink" title="栈的存储单位"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%A0%88%E7%9A%84%E5%AD%98%E5%82%A8%E5%8D%95%E4%BD%8D">栈的存储单位</a></h2><h3 id="栈中存储什么？"><a href="#栈中存储什么？" class="headerlink" title="栈中存储什么？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%A0%88%E4%B8%AD%E5%AD%98%E5%82%A8%E4%BB%80%E4%B9%88%EF%BC%9F">栈中存储什么？</a></h3><ol>
<li>每个线程都有自己的栈，栈中的数据都是以<strong>栈帧</strong>（Stack Frame）的格式存在</li>
<li>在这个线程上正在执行的每个方法都各自对应一个栈帧（Stack Frame）。</li>
<li>栈帧是一个内存区块，是一个数据集，维系着方法执行过程中的各种数据信息。</li>
</ol>
<h3 id="栈运行原理"><a href="#栈运行原理" class="headerlink" title="栈运行原理"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%A0%88%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86">栈运行原理</a></h3><ol>
<li>JVM直接对Java栈的操作只有两个，就是对栈帧的<strong>压栈和出栈</strong>，遵循先进后出（后进先出）原则</li>
<li>在一条活动线程中，一个时间点上，只会有一个活动的栈帧。即只有当前正在执行的方法的栈帧（栈顶栈帧）是有效的。这个栈帧被称为<strong>当前栈帧（Current Frame）</strong>，与当前栈帧相对应的方法就是<strong>当前方法（Current Method）</strong>，定义这个方法的类就是<strong>当前类（Current Class）</strong></li>
<li>执行引擎运行的所有字节码指令只针对当前栈帧进行操作。</li>
<li>如果在该方法中调用了其他方法，对应的新的栈帧会被创建出来，放在栈的顶端，成为新的当前帧。</li>
</ol>
<p><img src="/2020/01/04/JVM-STACK/0005.png"></p>
<ol>
<li><strong>不同线程中所包含的栈帧是不允许存在相互引用的</strong>，即不可能在一个栈帧之中引用另外一个线程的栈帧。</li>
<li>如果当前方法调用了其他方法，方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧，接着，虚拟机会丢弃当前栈帧，使得前一个栈帧重新成为当前栈帧。</li>
<li>Java方法有两种返回函数的方式。<ul>
<li>一种是正常的函数返回，使用return指令。</li>
<li>另一种是方法执行中出现未捕获处理的异常，以抛出异常的方式结束。</li>
<li>但不管使用哪种方式，都会导致栈帧被弹出。</li>
</ul>
</li>
</ol>
<h3 id="栈帧的内部结构"><a href="#栈帧的内部结构" class="headerlink" title="栈帧的内部结构"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%A0%88%E5%B8%A7%E7%9A%84%E5%86%85%E9%83%A8%E7%BB%93%E6%9E%84">栈帧的内部结构</a></h3><p>每个栈帧中存储着：</p>
<ul>
<li><p>局部变量表（Local Variables）</p>
</li>
<li><p>操作数栈（Operand Stack）（或表达式栈）</p>
</li>
<li><p>动态链接（Dynamic Linking）（或指向运行时常量池的方法引用）</p>
</li>
<li><p>方法返回地址（Return Address）（或方法正常退出或者异常退出的定义）</p>
</li>
<li><p>一些附加信息</p>
</li>
</ul>
<p><img src="/2020/01/04/JVM-STACK/0006.png"></p>
<p>并行每个线程下的栈都是私有的，因此每个线程都有自己各自的栈，并且每个栈里面都有很多栈帧，栈帧的大小主要由局部变量表 和 操作数栈决定的</p>
<p><img src="/2020/01/04/JVM-STACK/0007.png"></p>
<h2 id="局部变量表"><a href="#局部变量表" class="headerlink" title="局部变量表"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E8%A1%A8">局部变量表</a></h2><ol>
<li>局部变量表也被称之为局部变量数组或本地变量表</li>
<li><strong>定义为一个数字数组，主要用于存储方法参数和定义在方法体内的局部变量</strong>，这些数据类型包括各类基本数据类型、对象引用（reference），以及returnAddress返回值类型。</li>
<li>由于局部变量表是建立在线程的栈上，是线程的私有数据，因此<strong>不存在数据安全问题</strong></li>
<li><strong>局部变量表所需的容量大小是在编译期确定下来的</strong>，并保存在方法的Code属性的<strong>maximum local variables</strong>数据项中。在方法运行期间是不会改变局部变量表的大小的。</li>
<li>方法嵌套调用的次数由栈的大小决定。一般来说，栈越大，方法嵌套调用次数越多。<ul>
<li>对一个函数而言，它的参数和局部变量越多，使得局部变量表膨胀，它的栈帧就越大，以满足方法调用所需传递的信息增大的需求。</li>
<li>进而函数调用就会占用更多的栈空间，导致其嵌套调用次数就会减少。</li>
</ul>
</li>
<li>局部变量表中的变量只在当前方法调用中有效。<ul>
<li>在方法执行时，虚拟机通过使用局部变量表完成参数值到参数变量列表的传递过程。</li>
<li>当方法调用结束后，随着方法栈帧的销毁，局部变量表也会随之销毁。</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalVariablesTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        LocalVariablesTest test = <span class="keyword">new</span> LocalVariablesTest();</span><br><span class="line">        <span class="keyword">int</span> num = <span class="number">10</span>;</span><br><span class="line">        test.test1();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//练习：</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testStatic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LocalVariablesTest test = <span class="keyword">new</span> LocalVariablesTest();</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        <span class="comment">//因为this变量不存在于当前方法的局部变量表中！！</span></span><br><span class="line"><span class="comment">//        System.out.println(this.count);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//关于Slot的使用的理解</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LocalVariablesTest</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        String name1 = <span class="string">&quot;atguigu.com&quot;</span>;</span><br><span class="line">        test2(date, name1);</span><br><span class="line">        System.out.println(date + name1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(Date dateP, String name2)</span> </span>&#123;</span><br><span class="line">        dateP = <span class="keyword">null</span>;</span><br><span class="line">        name2 = <span class="string">&quot;songhongkang&quot;</span>;</span><br><span class="line">        <span class="keyword">double</span> weight = <span class="number">130.5</span>;<span class="comment">//占据两个slot</span></span><br><span class="line">        <span class="keyword">char</span> gender = <span class="string">&#x27;男&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span> dateP + name2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">            b = a + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//变量c使用之前已经销毁的变量b占据的slot的位置</span></span><br><span class="line">        <span class="keyword">int</span> c = a + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/04/JVM-STACK/0008.png"></p>
<p>看完字节码后，可得结论：所以局部变量表所需的容量大小是在编译期确定下来的。</p>
<h4 id="部分详解"><a href="#部分详解" class="headerlink" title="部分详解"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E9%83%A8%E5%88%86%E8%AF%A6%E8%A7%A3">部分详解</a></h4><p>为了更好讲解，我们直接用jclasslib来看字节码，以main方法为例来讲解。一些一目了然的就不讲了</p>
<p>1、0-15  也就是有16行字节码</p>
<p><img src="/2020/01/04/JVM-STACK/0009.png"></p>
<p>2、方法异常信息表</p>
<p><img src="/2020/01/04/JVM-STACK/0010.png"></p>
<p>3、Misc</p>
<p><img src="/2020/01/04/JVM-STACK/0011.png"></p>
<p>4、行号表</p>
<p>​    Java代码的行号和字节码指令行号的对应关系</p>
<p><img src="/2020/01/04/JVM-STACK/0012.png"></p>
<p>5、注意：生效行数和剩余有效行数都是针对于字节码文件的行数</p>
<p><img src="/2020/01/04/JVM-STACK/0013.png"></p>
<p>1、图中圈的东西表示该局部变量的作用域</p>
<p>2、Start PC==11表示在字节码的11行开始生效，也就是Java代码对应的第15行。而声明int num在java代码的是第14行，说明是从声明的下一行开始生效</p>
<p>3、Length== 5表示局部变量剩余有效行数，main方法字节码指令总共有16行，从11行开始生效，那么剩下就是16-11 ==5。</p>
<p>4、<code>Ljava/lang/String</code>   前面的L表示引用类型</p>
<h3 id="关于Slot的理解"><a href="#关于Slot的理解" class="headerlink" title="关于Slot的理解"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%85%B3%E4%BA%8Eslot%E7%9A%84%E7%90%86%E8%A7%A3">关于Slot的理解</a></h3><ol>
<li><p>参数值的存放总是从局部变量数组索引 0 的位置开始，到数组长度-1的索引结束。</p>
</li>
<li><p>局部变量表，<strong>最基本的存储单元是Slot（变量槽）</strong>，局部变量表中存放编译期可知的各种基本数据类型（8种），引用类型（reference），returnAddress类型的变量。</p>
</li>
<li><p>在局部变量表里，</p>
<p>32位以内的类型只占用一个slot</p>
<p>（包括returnAddress类型），</p>
<p>64位的类型占用两个slot</p>
<p>（1ong和double）。</p>
<ul>
<li>byte、short、char在储存前辈转换为int，boolean也被转换为int，0表示false，非0表示true</li>
<li>long和double则占据两个slot</li>
</ul>
</li>
<li><p>JVM会为局部变量表中的每一个Slot都分配一个访问索引，通过这个索引即可成功访问到局部变量表中指定的局部变量值</p>
</li>
<li><p>当一个实例方法被调用的时候，它的方法参数和方法体内部定义的局部变量将会<strong>按照顺序被复制</strong>到局部变量表中的每一个slot上</p>
</li>
<li><p>如果需要访问局部变量表中一个64bit的局部变量值时，只需要使用前一个索引即可。（比如：访问long或double类型变量）</p>
</li>
<li><p>如果当前帧是由构造方法或者实例方法创建的，那么<strong>该对象引用this将会存放在index为0的slot处</strong>，其余的参数按照参数表顺序继续排列。（this也相当于一个变量）</p>
</li>
</ol>
<p><img src="/2020/01/04/JVM-STACK/0014.png"></p>
<h3 id="Slot代码示例"><a href="#Slot代码示例" class="headerlink" title="Slot代码示例"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=slot%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B">Slot代码示例</a></h3><p><strong>this 存放在 index = 0 的位置：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.count++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>局部变量表：this 存放在 index = 0 的位置</p>
<p><img src="/2020/01/04/JVM-STACK/0015.png"></p>
<p><strong>64位的类型（1ong和double）占用两个slot</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> String <span class="title">test2</span><span class="params">(Date dateP, String name2)</span> </span>&#123;</span><br><span class="line">    dateP = <span class="keyword">null</span>;</span><br><span class="line">    name2 = <span class="string">&quot;songhongkang&quot;</span>;</span><br><span class="line">    <span class="keyword">double</span> weight = <span class="number">130.5</span>;<span class="comment">//占据两个slot</span></span><br><span class="line">    <span class="keyword">char</span> gender = <span class="string">&#x27;男&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> dateP + name2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>weight 为 double 类型，index 直接从 3 蹦到了 5</p>
<p><img src="/2020/01/04/JVM-STACK/0016.png"></p>
<p><strong>static 无法调用 this</strong></p>
<p>this 不存在与 static 方法的局部变量表中，所以无法调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testStatic</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LocalVariablesTest test = <span class="keyword">new</span> LocalVariablesTest();</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">int</span> count = <span class="number">10</span>;</span><br><span class="line">        System.out.println(count);</span><br><span class="line">        <span class="comment">//因为this变量不存在于当前方法的局部变量表中！！</span></span><br><span class="line"><span class="comment">//        System.out.println(this.count);</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Slot的重复利用"><a href="#Slot的重复利用" class="headerlink" title="Slot的重复利用"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=slot%E7%9A%84%E9%87%8D%E5%A4%8D%E5%88%A9%E7%94%A8">Slot的重复利用</a></h3><p>栈帧中的局部变量表中的槽位是可以重用的，如果一个局部变量过了其作用域，那么在其作用域之后申明新的局部变量变就很有可能会复用过期局部变量的槽位，从而达到节省资源的目的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">        b = a + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//变量c使用之前已经销毁的变量b占据的slot的位置</span></span><br><span class="line">    <span class="keyword">int</span> c = a + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/04/JVM-STACK/0017.png"></p>
<h3 id="静态变量与局部变量的对比"><a href="#静态变量与局部变量的对比" class="headerlink" title="静态变量与局部变量的对比"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E9%9D%99%E6%80%81%E5%8F%98%E9%87%8F%E4%B8%8E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E5%AF%B9%E6%AF%94">静态变量与局部变量的对比</a></h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">变量的分类：</span><br><span class="line"><span class="number">1</span>、按照数据类型分：① 基本数据类型  ② 引用数据类型</span><br><span class="line"><span class="number">2</span>、按照在类中声明的位置分：</span><br><span class="line">  <span class="number">2</span>-<span class="number">1</span>、成员变量：在使用前，都经历过默认初始化赋值</span><br><span class="line">       <span class="number">2</span>-<span class="number">1</span>-<span class="number">1</span>、类变量: linking的prepare阶段：给类变量默认赋值</span><br><span class="line">              ---&gt; initial阶段：给类变量显式赋值即静态代码块赋值</span><br><span class="line">       <span class="number">2</span>-<span class="number">1</span>-<span class="number">2</span>、实例变量：随着对象的创建，会在堆空间中分配实例变量空间，并进行默认赋值</span><br><span class="line">  <span class="number">2</span>-<span class="number">2</span>、局部变量：在使用前，必须要进行显式赋值的！否则，编译不通过。</span><br></pre></td></tr></table></figure>

<ol>
<li>参数表分配完毕之后，再根据方法体内定义的变量的顺序和作用域分配。</li>
<li>我们知道成员变量有两次初始化的机会<strong>，</strong>第一次是在“准备阶段”，执行系统初始化，对类变量设置零值，另一次则是在“初始化”阶段，赋予程序员在代码中定义的初始值。</li>
<li>和类变量初始化不同的是，<strong>局部变量表不存在系统初始化的过程</strong>，这意味着一旦定义了局部变量则必须人为的初始化，否则无法使用。</li>
</ol>
<h3 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E">补充说明</a></h3><ol>
<li>在栈帧中，与性能调优关系最为密切的部分就是前面提到的局部变量表。在方法执行时，虚拟机使用局部变量表完成方法的传递。</li>
<li>局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收。</li>
</ol>
<h2 id="操作数栈"><a href="#操作数栈" class="headerlink" title="操作数栈"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88">操作数栈</a></h2><h3 id="操作数栈的特点"><a href="#操作数栈的特点" class="headerlink" title="操作数栈的特点"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E7%9A%84%E7%89%B9%E7%82%B9">操作数栈的特点</a></h3><ol>
<li>每一个独立的栈帧除了包含局部变量表以外，还包含一个后进先出（Last - In - First -Out）的 操作数栈，也可以称之为<strong>表达式栈</strong>（Expression Stack）</li>
<li>操作数栈，在方法执行过程中，<strong>根据字节码指令，往栈中写入数据或提取数据</strong>，即入栈（push）和 出栈（pop）<ul>
<li>某些字节码指令将值压入操作数栈，其余的字节码指令将操作数取出栈。使用它们后再把结果压入栈，</li>
<li>比如：执行复制、交换、求和等操作</li>
</ul>
</li>
</ol>
<p><img src="/2020/01/04/JVM-STACK/0018.png"></p>
<h3 id="操作数栈的作用"><a href="#操作数栈的作用" class="headerlink" title="操作数栈的作用"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E7%9A%84%E4%BD%9C%E7%94%A8">操作数栈的作用</a></h3><ol>
<li>操作数栈，<strong>主要用于保存计算过程的中间结果，同时作为计算过程中变量临时的存储空间</strong>。</li>
<li>操作数栈就是JVM执行引擎的一个工作区，当一个方法刚开始执行的时候，一个新的栈帧也会随之被创建出来，这时方法的操作数栈是空的。</li>
<li>每一个操作数栈都会拥有一个明确的栈深度用于存储数值，其所需的最大深度在编译期就定义好了，保存在方法的Code属性中，为<strong>maxstack</strong>的值。</li>
<li>栈中的任何一个元素都是可以任意的Java数据类型<ul>
<li>32bit的类型占用一个栈单位深度</li>
<li>64bit的类型占用两个栈单位深度</li>
</ul>
</li>
<li>操作数栈并非采用访问索引的方式来进行数据访问的，而是只能通过标准的入栈和出栈操作来完成一次数据访问。<strong>只不过操作数栈是用数组这个结构来实现的而已</strong></li>
<li>如果被调用的方法带有返回值的话，其返回值将会被压入当前栈帧的操作数栈中，并更新PC寄存器中下一条需要执行的字节码指令。</li>
<li>操作数栈中元素的数据类型必须与字节码指令的序列严格匹配，这由编译器在编译器期间进行验证，同时在类加载过程中的类检验阶段的数据流分析阶段要再次验证。</li>
<li>另外，<strong>我们说Java虚拟机的解释引擎是基于栈的执行引擎，其中的栈指的就是操作数栈</strong>。</li>
</ol>
<p><img src="/2020/01/04/JVM-STACK/0020.jpg"></p>
<p>局部变量表就相当于食材</p>
<p>操作数栈就相当于做法步骤</p>
<h2 id="操作数栈代码追踪"><a href="#操作数栈代码追踪" class="headerlink" title="操作数栈代码追踪"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%93%8D%E4%BD%9C%E6%95%B0%E6%A0%88%E4%BB%A3%E7%A0%81%E8%BF%BD%E8%B8%AA">操作数栈代码追踪</a></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddOperation</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//byte、short、char、boolean：都以int型来保存</span></span><br><span class="line">    <span class="keyword">byte</span> i = <span class="number">15</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">int</span> k = i + j;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// int m = 800;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应字节码指令</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="number">0</span> bipush <span class="number">15</span></span><br><span class="line"> <span class="number">2</span> istore_1</span><br><span class="line"> <span class="number">3</span> bipush <span class="number">8</span></span><br><span class="line"> <span class="number">5</span> istore_2</span><br><span class="line"> <span class="number">6</span> iload_1</span><br><span class="line"> <span class="number">7</span> iload_2</span><br><span class="line"> <span class="number">8</span> iadd</span><br><span class="line"> <span class="number">9</span> istore_3</span><br><span class="line"><span class="number">10</span> <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/04/JVM-STACK/0021.png"></p>
<h3 id="一步一步看流程"><a href="#一步一步看流程" class="headerlink" title="一步一步看流程"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E4%B8%80%E6%AD%A5%E4%B8%80%E6%AD%A5%E7%9C%8B%E6%B5%81%E7%A8%8B">一步一步看流程</a></h3><p>1、首先执行第一条语句，PC寄存器指向的是0，也就是指令地址为0，然后使用bipush让操作数15入操作数栈.</p>
<p><img src="/2020/01/04/JVM-STACK/0022.png"></p>
<p>2、执行完后，PC寄存器往下移，指向下一行代码，下一行代码就是将操作数栈的元素存储到局部变量表1的位置（istore_1），我们可以看到局部变量表的已经增加了一个元素。并且操作数栈为空了.</p>
<ul>
<li>解释为什么局部变量表索引从 1 开始，因为该方法为实例方法，局部变量表索引为 0 的位置存放的是 this</li>
</ul>
<p><img src="/2020/01/04/JVM-STACK/0023.png"></p>
<p>3、然后PC下移，指向的是下一行。让操作数8也入栈，同时执行store操作，存入局部变量表中</p>
<p><img src="/2020/01/04/JVM-STACK/0024.png"></p>
<p>4、然后从局部变量表中，依次将数据放在操作数栈中，等待执行 add 操作</p>
<p>iload_1：取出局部变量表中索引为1的数据入操作数栈</p>
<p><img src="/2020/01/04/JVM-STACK/0025.png"></p>
<p>5、然后将操作数栈中的两个元素执行相加操作，并存储在局部变量表3的位置</p>
<p><img src="/2020/01/04/JVM-STACK/0026.png"></p>
<p>5、然后将操作数栈中的两个元素执行相加操作，并存储在局部变量表3的位置</p>
<p><strong>关于类型转换的说明</strong></p>
<p><img src="/2020/01/04/JVM-STACK/0027.png"></p>
<ul>
<li>m改成800之后，byte存储不了，就成了short型，sipush 800</li>
</ul>
<p><strong>如果被调用的方法带有返回值，返回值入操作数栈</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSum</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">int</span> m = <span class="number">10</span>;</span><br><span class="line">      <span class="keyword">int</span> n = <span class="number">20</span>;</span><br><span class="line">      <span class="keyword">int</span> k = m + n;</span><br><span class="line">      <span class="keyword">return</span> k;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetSum</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">//获取上一个栈桢返回的结果，并保存在操作数栈中</span></span><br><span class="line">      <span class="keyword">int</span> i = getSum();</span><br><span class="line">      <span class="keyword">int</span> j = <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>getSum() 方法字节码指令：最后带着个 ireturn</p>
<p><img src="/2020/01/04/JVM-STACK/0029.png"></p>
<p>testGetSum() 方法字节码指令：一上来就加载 getSum() 方法的返回值()</p>
<p><img src="/2020/01/04/JVM-STACK/0030.png"></p>
<p>? testGetSum() 方法字节码指令：一上来就加载 getSum() 方法的返回值() </p>
<h2 id="栈顶缓存技术"><a href="#栈顶缓存技术" class="headerlink" title="栈顶缓存技术"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%A0%88%E9%A1%B6%E7%BC%93%E5%AD%98%E6%8A%80%E6%9C%AF">栈顶缓存技术</a></h2><p><strong>栈顶缓存技术：Top Of Stack Cashing</strong></p>
<ol>
<li>前面提过，基于栈式架构的虚拟机所使用的零地址指令更加紧凑，但完成一项操作的时候必然需要使用更多的入栈和出栈指令，这同时也就意味着将需要更多的指令分派（instruction dispatch）次数（也就是你会发现指令很多）和导致内存读/写次数多，效率不高。</li>
<li>由于操作数是存储在内存中的，因此频繁地执行内存读/写操作必然会影响执行速度。为了解决这个问题，HotSpot JVM的设计者们提出了栈顶缓存（Tos，Top-of-Stack Cashing）技术，<strong>将栈顶元素全部缓存在物理CPU的寄存器中，以此降低对内存的读/写次数，提升执行引擎的执行效率。</strong></li>
<li>寄存器的主要优点：指令更少，执行速度快，但是指令集（也就是指令种类）很多</li>
</ol>
<p><strong>动态链接（或指向运行时常量池的方法引用）</strong></p>
<ol>
<li><p>每一个栈帧内部都包含<strong>一个指向运行时常量池中该栈帧所属方法的引用</strong>。包含这个引用的目的就是<strong>为了支持当前方法的代码能够实现动态链接</strong>（Dynamic Linking），比如：invokedynamic指令</p>
</li>
<li><p>在Java源文件被编译到字节码文件中时，所有的变量和方法引用都作为符号引用（Symbolic Reference）保存在class文件的常量池里。比如：描述一个方法调用了另外的其他方法时，就是通过常量池中指向方法的符号引用来表示的，那么<strong>动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用</strong></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicLinkingTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;methodA()....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodB</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;methodB()....&quot;</span>);</span><br><span class="line"></span><br><span class="line">        methodA();</span><br><span class="line"></span><br><span class="line">        num++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对应字节码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Classfile /F:/IDEAWorkSpaceSourceCode/JVMDemo/out/production/chapter05/com/atguigu/java1/DynamicLinkingTest.class</span><br><span class="line">  Last modified <span class="number">2020</span>-<span class="number">11</span>-<span class="number">10</span>; size <span class="number">712</span> bytes</span><br><span class="line">  MD5 checksum e56913c945f897c7ee6c0a608629bca8</span><br><span class="line">  Compiled from <span class="string">&quot;DynamicLinkingTest.java&quot;</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">com</span>.<span class="title">atguigu</span>.<span class="title">java1</span>.<span class="title">DynamicLinkingTest</span></span></span><br><span class="line">  minor version: 0</span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line">  flags: ACC_PUBLIC, ACC_SUPER</span><br><span class="line">Constant pool:</span><br><span class="line">   #1 = Methodref          #9.#23         // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">   #2 = Fieldref           #8.#24         // com/atguigu/java1/DynamicLinkingTest.num:I</span><br><span class="line">   #3 = Fieldref           #25.#26        // java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">   #4 = String             #27            // methodA()....</span><br><span class="line">   #5 = Methodref          #28.#29        // java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">   #6 = String             #30            // methodB()....</span><br><span class="line">   #7 = Methodref          #8.#31         // com/atguigu/java1/DynamicLinkingTest.methodA:()V</span><br><span class="line">   #8 = Class              #32            // com/atguigu/java1/DynamicLinkingTest</span><br><span class="line">   #9 = Class              #33            // java/lang/Object</span><br><span class="line">  #10 = Utf8               num</span><br><span class="line">  #11 = Utf8               I</span><br><span class="line">  #12 = Utf8               &lt;init&gt;</span><br><span class="line">  #13 = Utf8               ()V</span><br><span class="line">  #14 = Utf8               Code</span><br><span class="line">  #15 = Utf8               LineNumberTable</span><br><span class="line">  #16 = Utf8               LocalVariableTable</span><br><span class="line">  #17 = Utf8               this</span><br><span class="line">  #18 = Utf8               Lcom/atguigu/java1/DynamicLinkingTest;</span><br><span class="line">  #19 = Utf8               methodA</span><br><span class="line">  #20 = Utf8               methodB</span><br><span class="line">  #21 = Utf8               SourceFile</span><br><span class="line">  #22 = Utf8               DynamicLinkingTest.java</span><br><span class="line">  #23 = NameAndType        #12:#13        // &quot;&lt;init&gt;&quot;:()V</span><br><span class="line">  #24 = NameAndType        #10:#11        // num:I</span><br><span class="line">  #25 = Class              #34            // java/lang/System</span><br><span class="line">  #26 = NameAndType        #35:#36        // out:Ljava/io/PrintStream;</span><br><span class="line">  #27 = Utf8               methodA()....</span><br><span class="line">  #28 = Class              #37            // java/io/PrintStream</span><br><span class="line">  #29 = NameAndType        #38:#39        // println:(Ljava/lang/String;)V</span><br><span class="line">  #30 = Utf8               methodB()....</span><br><span class="line">  #31 = NameAndType        #19:#13        // methodA:()V</span><br><span class="line">  #32 = Utf8               com/atguigu/java1/DynamicLinkingTest</span><br><span class="line">  #33 = Utf8               java/lang/Object</span><br><span class="line">  #34 = Utf8               java/lang/System</span><br><span class="line">  #35 = Utf8               out</span><br><span class="line">  #36 = Utf8               Ljava/io/PrintStream;</span><br><span class="line">  #37 = Utf8               java/io/PrintStream</span><br><span class="line">  #38 = Utf8               println</span><br><span class="line">  #39 = Utf8               (Ljava/lang/String;)V</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">int</span> num;</span><br><span class="line">    descriptor: I</span><br><span class="line">    flags:</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> com.atguigu.java1.DynamicLinkingTest();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         <span class="number">4</span>: aload_0</span><br><span class="line">         <span class="number">5</span>: bipush        <span class="number">10</span></span><br><span class="line">         7: putfield      #2                  // Field num:I</span><br><span class="line">        <span class="number">10</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">7</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">9</span>: <span class="number">4</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">11</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java1/DynamicLinkingTest;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodA</span><span class="params">()</span></span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         0: getstatic     #3                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #4                  // String methodA()....</span><br><span class="line">         5: invokevirtual #5                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         <span class="number">8</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">12</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">13</span>: <span class="number">8</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">9</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java1/DynamicLinkingTest;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">methodB</span><span class="params">()</span></span>;</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">3</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         0: getstatic     #3                  // Field java/lang/System.out:Ljava/io/PrintStream;</span><br><span class="line">         3: ldc           #6                  // String methodB()....</span><br><span class="line">         5: invokevirtual #5                  // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span><br><span class="line">         <span class="number">8</span>: aload_0</span><br><span class="line">         9: invokevirtual #7                  // Method methodA:()V</span><br><span class="line">        <span class="number">12</span>: aload_0</span><br><span class="line">        <span class="number">13</span>: dup</span><br><span class="line">        14: getfield      #2                  // Field num:I</span><br><span class="line">        <span class="number">17</span>: iconst_1</span><br><span class="line">        <span class="number">18</span>: iadd</span><br><span class="line">        19: putfield      #2                  // Field num:I</span><br><span class="line">        <span class="number">22</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">16</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">18</span>: <span class="number">8</span></span><br><span class="line">        line <span class="number">20</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">21</span>: <span class="number">22</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">23</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java1/DynamicLinkingTest;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;DynamicLinkingTest.java&quot;</span></span><br></pre></td></tr></table></figure>



<p>1、在字节码指令中，methodB() 方法中通过 invokevirtual #7 指令调用了方法 A ，那么 #7 是个啥呢？</p>
<p>2、往上面翻，找到常量池的定义：<code>#7 = Methodref #8.#31</code></p>
<ul>
<li>先找 #8 ：<ul>
<li><code>#8 = Class #32</code> ：去找 #32</li>
<li><code>#32 = Utf8 com/atguigu/java1/DynamicLinkingTest</code></li>
<li>结论：通过 #8 我们找到了 <code>DynamicLinkingTest</code> 这个类</li>
</ul>
</li>
<li>再来找 #31：<ul>
<li><code>#31 = NameAndType #19:#13</code> ：去找 #19 和 #13</li>
<li><code>#19 = Utf8 methodA</code> ：方法名为 methodA</li>
<li><code>#13 = Utf8 ()V</code> ：方法没有形参，返回值为 void</li>
</ul>
</li>
</ul>
<p>3、结论：通过 #7 我们就能找到需要调用的 methodA() 方法，并进行调用</p>
<p>4、在上面，其实还有很多符号引用，比如 Object、System、PrintStream 等等</p>
<p><img src="/2020/01/04/JVM-STACK/0031.png"></p>
<p><strong>为什么要用常量池呢？</strong></p>
<ol>
<li>因为在不同的方法，都可能调用常量或者方法，所以只需要存储一份即可，然后记录其引用即可，节省了空间。</li>
<li>常量池的作用：就是为了提供一些符号和常量，便于指令的识别</li>
</ol>
<h2 id="方法的调用"><a href="#方法的调用" class="headerlink" title="方法的调用"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%96%B9%E6%B3%95%E7%9A%84%E8%B0%83%E7%94%A8">方法的调用</a></h2><h3 id="静态链接与动态链接"><a href="#静态链接与动态链接" class="headerlink" title="静态链接与动态链接"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E4%B8%8E%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5">静态链接与动态链接</a></h3><p>在JVM中，将符号引用转换为调用方法的直接引用与方法的绑定机制相关</p>
<ul>
<li><strong>静态链接</strong>：</li>
</ul>
<p>当一个字节码文件被装载进JVM内部时，如果被调用的目标方法在编译期确定，且运行期保持不变时，这种情况下将调用方法的符号引用转换为直接引用的过程称之为静态链接</p>
<ul>
<li><strong>动态链接</strong>：</li>
</ul>
<p>如果被调用的方法在编译期无法被确定下来，也就是说，只能够在程序运行期将调用的方法的符号转换为直接引用，由于这种引用转换过程具备动态性，因此也被称之为动态链接。</p>
<h3 id="早期绑定与晚期绑定"><a href="#早期绑定与晚期绑定" class="headerlink" title="早期绑定与晚期绑定"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%97%A9%E6%9C%9F%E7%BB%91%E5%AE%9A%E4%B8%8E%E6%99%9A%E6%9C%9F%E7%BB%91%E5%AE%9A">早期绑定与晚期绑定</a></h3><blockquote>
<p>静态链接与动态链接针对的是方法。早期绑定和晚期绑定范围更广。早期绑定涵盖了静态链接，晚期绑定涵盖了动态链接。</p>
</blockquote>
<p>静态链接和动态链接对应的方法的绑定机制为：早期绑定（Early Binding）和晚期绑定（Late Binding）。<strong>绑定是一个字段、方法或者类在符号引用被替换为直接引用的过程</strong>，这仅仅发生一次。</p>
<ul>
<li><strong>早期绑定</strong></li>
</ul>
<p>早期绑定就是指被调用的目标方法如果在编译期可知，且运行期保持不变时，即可将这个方法与所属的类型进行绑定，这样一来，由于明确了被调用的目标方法究竟是哪一个，因此也就<strong>可以使用静态链接的方式将符号引用转换为直接引用</strong>。</p>
<ul>
<li><strong>晚期绑定</strong></li>
</ul>
<p>如果被调用的方法在编译期无法被确定下来，<strong>只能够在程序运行期根据实际的类型绑定相关的方法</strong>，这种绑定方式也就被称之为晚期绑定。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;动物进食&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Huntable</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">hunt</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> <span class="keyword">implements</span> <span class="title">Huntable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;狗吃骨头&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hunt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;捕食耗子，多管闲事&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> <span class="keyword">implements</span> <span class="title">Huntable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();<span class="comment">//表现为：早期绑定</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Cat</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>();<span class="comment">//表现为：早期绑定</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.eat();<span class="comment">//表现为：早期绑定</span></span><br><span class="line">        System.out.println(<span class="string">&quot;猫吃鱼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hunt</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;捕食耗子，天经地义&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnimalTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showAnimal</span><span class="params">(Animal animal)</span> </span>&#123;</span><br><span class="line">        animal.eat();<span class="comment">//表现为：晚期绑定</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showHunt</span><span class="params">(Huntable h)</span> </span>&#123;</span><br><span class="line">        h.hunt();<span class="comment">//表现为：晚期绑定</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>部分字节码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> com.atguigu.java2.AnimalTest();</span><br><span class="line">    descriptor: ()V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">1</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: aload_0</span><br><span class="line">         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">54</span>: <span class="number">0</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java2/AnimalTest;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showAnimal</span><span class="params">(com.atguigu.java2.Animal)</span></span>;</span><br><span class="line">    descriptor: (Lcom/atguigu/java2/Animal;)V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">2</span>, args_size=<span class="number">2</span></span><br><span class="line">         <span class="number">0</span>: aload_1</span><br><span class="line">         1: invokevirtual #2                  // Method com/atguigu/java2/Animal.eat:()V</span><br><span class="line">         <span class="number">4</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">56</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">57</span>: <span class="number">4</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java2/AnimalTest;</span><br><span class="line">            <span class="number">0</span>       <span class="number">5</span>     <span class="number">1</span> animal   Lcom/atguigu/java2/Animal;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showHunt</span><span class="params">(com.atguigu.java2.Huntable)</span></span>;</span><br><span class="line">    descriptor: (Lcom/atguigu/java2/Huntable;)V</span><br><span class="line">    flags: ACC_PUBLIC</span><br><span class="line">    Code:</span><br><span class="line">      stack=<span class="number">1</span>, locals=<span class="number">2</span>, args_size=<span class="number">2</span></span><br><span class="line">         <span class="number">0</span>: aload_1</span><br><span class="line">         1: invokeinterface #3,  1            // InterfaceMethod com/atguigu/java2/Huntable.hunt:()V</span><br><span class="line">         <span class="number">6</span>: <span class="keyword">return</span></span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">60</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">61</span>: <span class="number">6</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>       <span class="number">7</span>     <span class="number">0</span>  <span class="keyword">this</span>   Lcom/atguigu/java2/AnimalTest;</span><br><span class="line">            <span class="number">0</span>       <span class="number">7</span>     <span class="number">1</span>     h   Lcom/atguigu/java2/Huntable;</span><br><span class="line">&#125;</span><br><span class="line">SourceFile: <span class="string">&quot;AnimalTest.java&quot;</span></span><br></pre></td></tr></table></figure>

<p>invokevirtual 体现为晚期绑定</p>
<p>invokeinterface 也体现为晚期绑定</p>
<p>invokespecial 体现为早期绑定</p>
<h3 id="多态与绑定"><a href="#多态与绑定" class="headerlink" title="多态与绑定"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%A4%9A%E6%80%81%E4%B8%8E%E7%BB%91%E5%AE%9A">多态与绑定</a></h3><ol>
<li>随着高级语言的横空出世，类似于Java一样的基于面向对象的编程语言如今越来越多，尽管这类编程语言在语法风格上存在一定的差别，但是它们彼此之间始终保持着一个共性，那就是都支持封装、继承和多态等面向对象特性，既然这一类的编程语言具备多态特性，那么自然也就具备早期绑定和晚期绑定两种绑定方式。</li>
<li>Java中任何一个普通的方法其实都具备虚函数的特征，它们相当于C++语言中的虚函数（C++中则需要使用关键字virtual来显式定义）。如果在Java程序中不希望某个方法拥有虚函数的特征时，则可以使用关键字final来标记这个方法。</li>
</ol>
<h4 id="虚方法与非虚方法"><a href="#虚方法与非虚方法" class="headerlink" title="虚方法与非虚方法"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%96%B9%E6%B3%95%E4%B8%8E%E9%9D%9E%E8%99%9A%E6%96%B9%E6%B3%95">虚方法与非虚方法</a></h4><p><strong>虚方法与非虚方法的区别</strong></p>
<ol>
<li>如果方法在编译期就确定了具体的调用版本，这个版本在运行时是不可变的。这样的方法称为非虚方法。</li>
<li>静态方法、私有方法、final方法、实例构造器、父类方法都是非虚方法。</li>
<li>其他方法称为虚方法。</li>
</ol>
<p><strong>子类对象的多态的使用前提：</strong></p>
<ol>
<li>类的继承关系</li>
<li>方法的重写</li>
</ol>
<p><strong>虚拟机中调用方法的指令</strong></p>
<ul>
<li><strong>普通指令：</strong></li>
</ul>
<ol>
<li>invokestatic：调用静态方法，解析阶段确定唯一方法版本</li>
<li>invokespecial：调用<code>&lt;init&gt;</code>方法、私有及父类方法，解析阶段确定唯一方法版本</li>
<li>invokevirtual：调用所有虚方法</li>
<li>invokeinterface：调用接口方法</li>
</ol>
<ul>
<li><strong>动态调用指令</strong></li>
</ul>
<p>invokedynamic：动态解析出需要调用的方法，然后执行</p>
<p>前四条指令固化在虚拟机内部，方法的调用执行不可人为干预。而invokedynamic指令则支持由用户确定方法版本。其中invokestatic指令和invokespecial指令调用的方法称为非虚方法，其余的（final修饰的除外）称为虚方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Father</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father的构造器&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showStatic</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father &quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">showFinal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father show final&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showCommon</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;father 普通方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">extends</span> <span class="title">Father</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Son</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Son</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="keyword">this</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//不是重写的父类的静态方法，因为静态方法不能被重写！</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showStatic</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;son &quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">showPrivate</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;son private&quot;</span> + str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">show</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//invokestatic</span></span><br><span class="line">        showStatic(<span class="string">&quot;atguigu.com&quot;</span>);</span><br><span class="line">        <span class="comment">//invokestatic</span></span><br><span class="line">        <span class="keyword">super</span>.showStatic(<span class="string">&quot;good!&quot;</span>);</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        showPrivate(<span class="string">&quot;hello!&quot;</span>);</span><br><span class="line">        <span class="comment">//invokespecial</span></span><br><span class="line">        <span class="keyword">super</span>.showCommon();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//invokevirtual</span></span><br><span class="line">        showFinal();<span class="comment">//因为此方法声明有final，不能被子类重写，所以也认为此方法是非虚方法。</span></span><br><span class="line">        <span class="comment">//虚方法如下：</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        invokevirtual  你没有显示的加super.，编译器认为你可能调用子类的showCommon(即使son子类没有重写，也          会认为)，所以编译期间确定不下来，就是虚方法。</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        showCommon();</span><br><span class="line">        info();</span><br><span class="line"></span><br><span class="line">        MethodInterface in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//invokeinterface</span></span><br><span class="line">        in.methodA();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">display</span><span class="params">(Father f)</span> </span>&#123;</span><br><span class="line">        f.showCommon();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Son so = <span class="keyword">new</span> Son();</span><br><span class="line">        so.show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MethodInterface</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">methodA</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Son 类中 show() 方法的字节码指令如下</p>
<p><img src="/2020/01/04/JVM-STACK/0032.png"></p>
<h4 id="关于-invokedynamic-指令"><a href="#关于-invokedynamic-指令" class="headerlink" title="关于 invokedynamic 指令"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%85%B3%E4%BA%8E-invokedynamic-%E6%8C%87%E4%BB%A4">关于 invokedynamic 指令</a></h4><ol>
<li>JVM字节码指令集一直比较稳定，一直到Java7中才增加了一个invokedynamic指令，这是Java为了实现【动态类型语言】支持而做的一种改进。</li>
<li>但是在Java7中并没有提供直接生成invokedynamic指令的方法，需要借助ASM这种底层字节码工具来产生invokedynamic指令。直到Java8的Lambda表达式的出现，invokedynamic指令的生成，在Java中才有了直接的生成方式。</li>
<li>Java7中增加的动态语言类型支持的本质是对Java虚拟机规范的修改，而不是对Java语言规则的修改，这一块相对来讲比较复杂，增加了虚拟机中的方法调用，最直接的受益者就是运行在Java平台的动态语言的编译器。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Func</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">func</span><span class="params">(String str)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Lambda</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lambda</span><span class="params">(Func func)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Lambda lambda = <span class="keyword">new</span> Lambda();</span><br><span class="line"></span><br><span class="line">        Func func = s -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        lambda.lambda(func);</span><br><span class="line"></span><br><span class="line">        lambda.lambda(s -&gt; &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/01/04/JVM-STACK/0033.png"></p>
<h3 id="动态语言和静态语言"><a href="#动态语言和静态语言" class="headerlink" title="动态语言和静态语言"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%8A%A8%E6%80%81%E8%AF%AD%E8%A8%80%E5%92%8C%E9%9D%99%E6%80%81%E8%AF%AD%E8%A8%80">动态语言和静态语言</a></h3><ol>
<li>动态类型语言和静态类型语言两者的区别就在于<strong>对类型的检查是在编译期还是在运行期</strong>，满足前者就是静态类型语言，反之是动态类型语言。</li>
<li>说的再直白一点就是，静态类型语言是判断变量自身的类型信息；动态类型语言是判断变量值的类型信息，变量没有类型信息，变量值才有类型信息，这是动态语言的一个重要特征。</li>
</ol>
<p>Java：String info = “mogu blog”;             (Java是静态类型语言的，会先编译就进行类型检查)    JS：var name = “shkstart”;    var name = 10;    （运行时才进行检查）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Python: info = <span class="number">130.5</span> (运行时才检查)</span><br></pre></td></tr></table></figure>

<h3 id="Java语言中方法重写的本质"><a href="#Java语言中方法重写的本质" class="headerlink" title="Java语言中方法重写的本质"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=java%E8%AF%AD%E8%A8%80%E4%B8%AD%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99%E7%9A%84%E6%9C%AC%E8%B4%A8">Java语言中方法重写的本质</a></h3><ol>
<li>找到操作数栈顶的第一个元素所执行的对象的实际类型，记作C。</li>
<li>如果在类型C中找到与常量中的描述符合简单名称都相符的方法，则进行访问权限校验。<ul>
<li>如果通过则返回这个方法的直接引用，查找过程结束</li>
<li>如果不通过，则返回java.lang.IllegalAccessError 异常</li>
</ul>
</li>
<li>否则，按照继承关系从下往上依次对C的各个父类进行第2步的搜索和验证过程。</li>
<li>如果始终没有找到合适的方法，则抛出java.lang.AbstractMethodError异常。</li>
</ol>
<blockquote>
<p>上面这个过程称为<strong>动态分派</strong></p>
</blockquote>
<p><strong>IllegalAccessError介绍</strong></p>
<ol>
<li>程序试图访问或修改一个属性或调用一个方法，这个属性或方法，你没有权限访问。一般的，这个会引起编译器异常。这个错误如果发生在运行时，就说明一个类发生了不兼容的改变。</li>
<li>比如，你把应该有的jar包放从工程中拿走了，或者Maven中存在jar包冲</li>
</ol>
<h3 id="虚方法表"><a href="#虚方法表" class="headerlink" title="虚方法表"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%99%9A%E6%96%B9%E6%B3%95%E8%A1%A8">虚方法表</a></h3><ol>
<li>在面向对象的编程中，会很频繁的使用到<strong>动态分派</strong>，如果在每次动态分派的过程中都要重新在类的方法元数据中搜索合适的目标的话就可能影响到执行效率。因此，为了提高性能，<strong>JVM采用在类的方法区建立一个虚方法表（virtual method table）来实现</strong>，非虚方法不会出现在表中。使用索引表来代替查找。【上面动态分派的过程，我们可以看到如果子类找不到，还要从下往上找其父类，非常耗时】</li>
<li>每个类中都有一个虚方法表，表中存放着各个方法的实际入口。</li>
<li>虚方法表是什么时候被创建的呢？虚方法表会在类加载的链接阶段被创建并开始初始化，类的变量初始值准备完成之后，JVM会把该类的虚方法表也初始化完毕。</li>
</ol>
<p><strong>例子1</strong></p>
<p>如图所示：如果类中重写了方法，那么调用的时候，就会直接在该类的虚方法表中查找</p>
<p><img src="/2020/01/04/JVM-STACK/0034.png"></p>
<p>1、比如说son在调用toString的时候，Son没有重写过，Son的父类Father也没有重写过，那就直接调用Object类的toString。那么就直接在虚方法表里指明toString直接指向Object类。</p>
<p>2、下次Son对象再调用toString就直接去找Object，不用先找Son–&gt;再找Father–&gt;最后才到Object的这样的一个过程。</p>
<h2 id="方法返回地址"><a href="#方法返回地址" class="headerlink" title="方法返回地址"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%96%B9%E6%B3%95%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80">方法返回地址</a></h2><p><img src="/2020/01/04/JVM-STACK/0039.png"></p>
<blockquote>
<p>在一些帖子里，方法返回地址、动态链接、一些附加信息  也叫做帧数据区</p>
</blockquote>
<ol>
<li>存放调用该方法的pc寄存器的值。一个方法的结束，有两种方式：<ul>
<li>正常执行完成</li>
<li>出现未处理的异常，非正常退出</li>
</ul>
</li>
<li>无论通过哪种方式退出，在方法退出后都返回到该方法被调用的位置。方法正常退出时，<strong>调用者的pc计数器的值作为返回地址，即调用该方法的指令的下一条指令的地址</strong>。而通过异常退出的，返回地址是要通过异常表来确定，栈帧中一般不会保存这部分信息。</li>
<li>本质上，方法的退出就是当前栈帧出栈的过程。此时，需要恢复上层方法的局部变量表、操作数栈、将返回值压入调用者栈帧的操作数栈、设置PC寄存器值等，让调用者方法继续执行下去。</li>
<li>正常完成出口和异常完成出口的区别在于：通过异常完成出口退出的不会给他的上层调用者产生任何的返回值。</li>
</ol>
<p><strong>方法退出的两种方式</strong></p>
<p>当一个方法开始执行后，只有两种方式可以退出这个方法，</p>
<p><strong>正常退出：</strong></p>
<ol>
<li>执行引擎遇到任意一个方法返回的字节码指令（return），会有返回值传递给上层的方法调用者，简称<strong>正常完成出口</strong>；</li>
<li>一个方法在正常调用完成之后，究竟需要使用哪一个返回指令，还需要根据方法返回值的实际数据类型而定。</li>
<li>在字节码指令中，返回指令包含：<ul>
<li>ireturn：当返回值是boolean，byte，char，short和int类型时使用</li>
<li>lreturn：Long类型</li>
<li>freturn：Float类型</li>
<li>dreturn：Double类型</li>
<li>areturn：引用类型</li>
<li>return：返回值类型为void的方法、实例初始化方法、类和接口的初始化方法</li>
</ul>
</li>
</ol>
<p><strong>异常退出：</strong></p>
<ol>
<li>在方法执行过程中遇到异常（Exception），并且这个异常没有在方法内进行处理，也就是只要在本方法的异常表中没有搜索到匹配的异常处理器，就会导致方法退出，简称<strong>异常完成出口</strong>。</li>
<li>方法执行过程中，抛出异常时的异常处理，存储在一个异常处理表，方便在发生异常的时候找到处理异常的代码</li>
</ol>
<h2 id="一些附加信息"><a href="#一些附加信息" class="headerlink" title="一些附加信息"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E4%B8%80%E4%BA%9B%E9%99%84%E5%8A%A0%E4%BF%A1%E6%81%AF">一些附加信息</a></h2><p>栈帧中还允许携带与Java虚拟机实现相关的一些附加信息。例如：对程序调试提供支持的信息。</p>
<h2 id="栈相关面试题"><a href="#栈相关面试题" class="headerlink" title="栈相关面试题"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%A0%88%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98">栈相关面试题</a></h2><h3 id="举例栈溢出的情况？"><a href="#举例栈溢出的情况？" class="headerlink" title="举例栈溢出的情况？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E4%B8%BE%E4%BE%8B%E6%A0%88%E6%BA%A2%E5%87%BA%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9F">举例栈溢出的情况？</a></h3><p>SOF（StackOverflowError），栈大小分为固定的，和动态变化。如果是固定的就可能出现StackOverflowError。如果是动态变化的，内存不足时就可能出现OOM</p>
<h3 id="调整栈大小，就能保证不出现溢出么？"><a href="#调整栈大小，就能保证不出现溢出么？" class="headerlink" title="调整栈大小，就能保证不出现溢出么？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E8%B0%83%E6%95%B4%E6%A0%88%E5%A4%A7%E5%B0%8F%EF%BC%8C%E5%B0%B1%E8%83%BD%E4%BF%9D%E8%AF%81%E4%B8%8D%E5%87%BA%E7%8E%B0%E6%BA%A2%E5%87%BA%E4%B9%88%EF%BC%9F">调整栈大小，就能保证不出现溢出么？</a></h3><p>不能保证不溢出，只能保证SOF出现的几率小</p>
<h3 id="分配的栈内存越大越好么？"><a href="#分配的栈内存越大越好么？" class="headerlink" title="分配的栈内存越大越好么？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%88%86%E9%85%8D%E7%9A%84%E6%A0%88%E5%86%85%E5%AD%98%E8%B6%8A%E5%A4%A7%E8%B6%8A%E5%A5%BD%E4%B9%88%EF%BC%9F">分配的栈内存越大越好么？</a></h3><p>不是，一定时间内降低了OOM概率，但是会挤占其它的线程空间，因为整个虚拟机的内存空间是有限的</p>
<h3 id="垃圾回收是否涉及到虚拟机栈？"><a href="#垃圾回收是否涉及到虚拟机栈？" class="headerlink" title="垃圾回收是否涉及到虚拟机栈？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%98%AF%E5%90%A6%E6%B6%89%E5%8F%8A%E5%88%B0%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%EF%BC%9F">垃圾回收是否涉及到虚拟机栈？</a></h3><h3 id="方法中定义的局部变量是否线程安全？"><a href="#方法中定义的局部变量是否线程安全？" class="headerlink" title="方法中定义的局部变量是否线程安全？"></a><a href="https://youthlql.gitee.io/javayouth/#/docs/Java/JVM/JVM%E7%B3%BB%E5%88%97-%E7%AC%AC4%E7%AB%A0-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88?id=%E6%96%B9%E6%B3%95%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E6%98%AF%E5%90%A6%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%EF%BC%9F">方法中定义的局部变量是否线程安全？</a></h3><p>具体问题具体分析</p>
<ol>
<li>如果只有一个线程才可以操作此数据，则必是线程安全的。</li>
<li>如果有多个线程操作此数据，则此数据是共享数据。如果不考虑同步机制的话，会存在线程安全问题。</li>
</ol>
<p><strong>具体问题具体分析：</strong></p>
<ul>
<li>? 如果对象是在内部产生，并在内部消亡，没有返回到外部，那么它就是线程安全的，反之则是线程不安全的。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 面试题：</span></span><br><span class="line"><span class="comment"> * 方法中定义的局部变量是否线程安全？具体情况具体分析</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   何为线程安全？</span></span><br><span class="line"><span class="comment"> *      如果只有一个线程才可以操作此数据，则必是线程安全的。</span></span><br><span class="line"><span class="comment"> *      如果有多个线程操作此数据，则此数据是共享数据。如果不考虑同步机制的话，会存在线程安全问题。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilderTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> num = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//s1的声明方式是线程安全的（只在方法内部用了）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//StringBuilder:线程不安全</span></span><br><span class="line">        StringBuilder s1 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        s1.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        s1.append(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//sBuilder的操作过程：是线程不安全的（作为参数传进来，可能被其它线程操作）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">method2</span><span class="params">(StringBuilder sBuilder)</span></span>&#123;</span><br><span class="line">        sBuilder.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        sBuilder.append(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//s1的操作：是线程不安全的（有返回值，可能被其它线程操作）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> StringBuilder <span class="title">method3</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder s1 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        s1.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        s1.append(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//s1的操作：是线程安全的（s1自己消亡了，最后返回的智商s1.toString的一个新对象）</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">method4</span><span class="params">()</span></span>&#123;</span><br><span class="line">        StringBuilder s1 = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        s1.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">        s1.append(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> s1.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        StringBuilder s = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            s.append(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">            s.append(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        method2(s);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>JAVA</category>
      </categories>
      <tags>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title>INTERVIEW-ANSWER</title>
    <url>/2018/03/12/INTERVIEW-ANSWER/</url>
    <content><![CDATA[<h2 id="阿里面试题"><a href="#阿里面试题" class="headerlink" title="阿里面试题"></a><a href="https://www.jianshu.com/p/cf5092fa2694">阿里面试题</a></h2><h2 id="1-android事件分发机制，请详细说下整个流程"><a href="#1-android事件分发机制，请详细说下整个流程" class="headerlink" title="1.android事件分发机制，请详细说下整个流程"></a>1.android事件分发机制，请详细说下整个流程</h2><p><img src="https://upload-images.jianshu.io/upload_images/2911038-5349d6ebb32372da?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>事件分发（面试）.png</p>
<h2 id="2-android-view绘制机制和加载过程，请详细说下整个流程"><a href="#2-android-view绘制机制和加载过程，请详细说下整个流程" class="headerlink" title="2.android view绘制机制和加载过程，请详细说下整个流程"></a>2.android view绘制机制和加载过程，请详细说下整个流程</h2><ul>
<li><p>1.ViewRootImpl会调用performTraversals(),其内部会调用performMeasure()、performLayout、performDraw()。</p>
</li>
<li><p>2.performMeasure()会调用最外层的ViewGroup的measure()–&gt;onMeasure(),ViewGroup的onMeasure()是抽象方法，但其提供了measureChildren()，这之中会遍历子View然后循环调用measureChild()这之中会用getChildMeasureSpec()+父View的MeasureSpec+子View的LayoutParam一起获取本View的MeasureSpec，然后调用子View的measure()到View的onMeasure()–&gt;setMeasureDimension(getDefaultSize(),getDefaultSize()),getDefaultSize()默认返回measureSpec的测量数值，所以继承View进行自定义的wrap_content需要重写。</p>
</li>
<li><p>3.performLayout()会调用最外层的ViewGroup的layout(l,t,r,b),本View在其中使用setFrame()设置本View的四个顶点位置。在onLayout(抽象方法)中确定子View的位置，如LinearLayout会遍历子View，循环调用setChildFrame()–&gt;子View.layout()。</p>
</li>
<li><p>4.performDraw()会调用最外层ViewGroup的draw():其中会先后调用background.draw()(绘制背景)、onDraw()(绘制自己)、dispatchDraw()(绘制子View)、onDrawScrollBars()(绘制装饰)。</p>
</li>
<li><p>5.MeasureSpec由2位SpecMode(UNSPECIFIED、EXACTLY(对应精确值和match_parent)、AT_MOST(对应warp_content))和30位SpecSize组成一个int,DecorView的MeasureSpec由窗口大小和其LayoutParams决定，其他View由父View的MeasureSpec和本View的LayoutParams决定。ViewGroup中有getChildMeasureSpec()来获取子View的MeasureSpec。</p>
</li>
<li><p>6.三种方式获取measure()后的宽高：</p>
<ul>
<li>1.Activity#onWindowFocusChange()中调用获取</li>
<li>2.view.post(Runnable)将获取的代码投递到消息队列的尾部。</li>
<li>3.ViewTreeObservable.</li>
</ul>
<p>自定义 View 的绘制顺序</p>
</li>
</ul>
<h2 id="3-android四大组件的加载过程，请详细介绍下"><a href="#3-android四大组件的加载过程，请详细介绍下" class="headerlink" title="3.android四大组件的加载过程，请详细介绍下"></a>3.android四大组件的加载过程，请详细介绍下</h2><ul>
<li>1.<a href="https://www.jianshu.com/p/f499afd8d0ab">android四大组件的加载过程</a>:这是我总结的一篇博客</li>
</ul>
<h2 id="4-Activity的启动模式"><a href="#4-Activity的启动模式" class="headerlink" title="4.Activity的启动模式"></a>4.Activity的启动模式</h2><ul>
<li>1.standard:默认标准模式，每启动一个都会创建一个实例，</li>
<li>2.singleTop：栈顶复用，如果在栈顶就调用onNewIntent复用，从onResume()开始</li>
<li>3.singleTask：栈内复用，本栈内只要用该类型Activity就会将其顶部的activity出栈</li>
<li>4.singleInstance：单例模式，除了3中特性，系统会单独给该Activity创建一个栈，</li>
</ul>
<h2 id="5-A、B、C、D分别是四种Activity的启动模式，那么A-gt-B-gt-C-gt-D-gt-A-gt-B-gt-C-gt-D分别启动，最后的activity栈是怎么样的"><a href="#5-A、B、C、D分别是四种Activity的启动模式，那么A-gt-B-gt-C-gt-D-gt-A-gt-B-gt-C-gt-D分别启动，最后的activity栈是怎么样的" class="headerlink" title="5.A、B、C、D分别是四种Activity的启动模式，那么A-&gt;B-&gt;C-&gt;D-&gt;A-&gt;B-&gt;C-&gt;D分别启动，最后的activity栈是怎么样的"></a>5.A、B、C、D分别是四种Activity的启动模式，那么A-&gt;B-&gt;C-&gt;D-&gt;A-&gt;B-&gt;C-&gt;D分别启动，最后的activity栈是怎么样的</h2><ul>
<li>1.这个题目需要深入了解activity的启动模式</li>
<li>2.最后的答案是：两个栈，前台栈是只有D，后台栈从底至上是A、B、C</li>
</ul>
<h2 id="6-Activity缓存方法"><a href="#6-Activity缓存方法" class="headerlink" title="6.Activity缓存方法"></a>6.Activity缓存方法</h2><ul>
<li>1.配置改变导致Activity被杀死，横屏变竖屏：在onStop之前会调用onSaveInstanceState()保存数据在重建Activity之后，会在onStart()之后调用onRestoreInstanceState(),并把保存下来的Bundle传给onCreate()和它会默认重建Activity当前的视图，我们可以在onCreate()中，回复自己的数据。</li>
<li>2.内存不足杀掉Activity，优先级分别是：前台可见，可见非前台，后台。</li>
</ul>
<h2 id="7-Service的生命周期，两种启动方法，有什么区别"><a href="#7-Service的生命周期，两种启动方法，有什么区别" class="headerlink" title="7.Service的生命周期，两种启动方法，有什么区别"></a>7.Service的生命周期，两种启动方法，有什么区别</h2><ul>
<li>1.context.startService() -&gt;onCreate()- &gt;onStart()-&gt;Service running–&gt;(如果调用context.stopService() )-&gt;onDestroy() -&gt;Service shut down<ul>
<li>1.如果Service还没有运行，则调用onCreate()然后调用onStart()；</li>
<li>2.如果Service已经运行，则只调用onStart()，所以一个Service的onStart方法可能会重复调用多次。</li>
<li>3.调用stopService的时候直接onDestroy，</li>
<li>4.如果是调用者自己直接退出而没有调用stopService的话，Service会一直在后台运行。该Service的调用者再启动起来后可以通过stopService关闭Service。</li>
</ul>
</li>
<li>2.context.bindService()-&gt;onCreate()-&gt;onBind()-&gt;Service running–&gt;onUnbind() -&gt; onDestroy() -&gt;Service stop<ul>
<li>1.onBind将返回给客户端一个IBind接口实例，IBind允许客户端回调服务的方法，比如得到Service运行的状态或其他操作。</li>
<li>2.这个时候会把调用者和Service绑定在一起，Context退出了,Service就会调用onUnbind-&gt;onDestroy相应退出。</li>
<li>3.所以调用bindService的生命周期为：onCreate –&gt; onBind(只一次，不可多次绑定) –&gt; onUnbind –&gt; onDestory。</li>
</ul>
</li>
</ul>
<h2 id="8-怎么保证service不被杀死"><a href="#8-怎么保证service不被杀死" class="headerlink" title="8.怎么保证service不被杀死"></a>8.怎么保证service不被杀死</h2><ul>
<li>1.提升service优先级</li>
<li>2.提升service进程优先级</li>
<li>3.onDestroy方法里重启service</li>
</ul>
<h2 id="9-静态的Broadcast-和动态的有什么区别"><a href="#9-静态的Broadcast-和动态的有什么区别" class="headerlink" title="9.静态的Broadcast 和动态的有什么区别"></a>9.静态的Broadcast 和动态的有什么区别</h2><ul>
<li>1.动态的比静态的安全</li>
<li>2.静态在app启动的时候就初始化了 动态使用代码初始化</li>
<li>3.静态需要配置 动态不需要</li>
<li>4.生存期，静态广播的生存期可以比动态广播的长很多</li>
<li>5.优先级动态广播的优先级比静态广播高</li>
</ul>
<h2 id="10-Intent可以传递哪些数据类型"><a href="#10-Intent可以传递哪些数据类型" class="headerlink" title="10.Intent可以传递哪些数据类型"></a>10.Intent可以传递哪些数据类型</h2><ul>
<li>1.Serializable</li>
<li>2.charsequence: 主要用来传递String，char等</li>
<li>3.parcelable</li>
<li>4.Bundle</li>
</ul>
<h2 id="11-Json有什么优劣势、解析的原理"><a href="#11-Json有什么优劣势、解析的原理" class="headerlink" title="11.Json有什么优劣势、解析的原理"></a>11.Json有什么优劣势、解析的原理</h2><ul>
<li>1.JSON的速度要远远快于XML</li>
<li>2.JSON相对于XML来讲，数据的体积小</li>
<li>3.JSON对数据的描述性比XML较差</li>
<li>4.解析的基本原理是：词法分析</li>
</ul>
<h2 id="12-一个语言的编译过程"><a href="#12-一个语言的编译过程" class="headerlink" title="12.一个语言的编译过程"></a>12.一个语言的编译过程</h2><ul>
<li>1.词法分析：将一串文本按规则分割成最小的结构，关键字、标识符、运算符、界符和常量等。一般实现方法是自动机和正则表达式</li>
<li>2.语法分析：将一系列单词组合成语法树。一般实现方法有自顶向下和自底向上</li>
<li>3.语义分析：对结构上正确的源程序进行上下文有关性质的审查</li>
<li>4.目标代码生成</li>
<li>5.代码优化：优化生成的目标代码，</li>
</ul>
<h2 id="13-动画有哪几类，各有什么特点"><a href="#13-动画有哪几类，各有什么特点" class="headerlink" title="13.动画有哪几类，各有什么特点"></a>13.动画有哪几类，各有什么特点</h2><ul>
<li>1.动画的基本原理：其实就是利用插值器和估值器，来计算出各个时刻View的属性，然后通过改变View的属性来，实现View的动画效果。</li>
<li>2.View动画:只是影像变化，view的实际位置还在原来的地方。</li>
<li>3.帧动画是在xml中定义好一系列图片之后，使用AnimationDrawable来播放的动画。</li>
<li>4.View的属性动画：<ul>
<li>1.插值器：作用是根据时间的流逝的百分比来计算属性改变的百分比</li>
<li>2.估值器：在1的基础上由这个东西来计算出属性到底变化了多少数值的类</li>
</ul>
</li>
</ul>
<h2 id="14-Handler、Looper消息队列模型，各部分的作用"><a href="#14-Handler、Looper消息队列模型，各部分的作用" class="headerlink" title="14.Handler、Looper消息队列模型，各部分的作用"></a>14.Handler、Looper消息队列模型，各部分的作用</h2><ul>
<li>1.MessageQueue：读取会自动删除消息，单链表维护，在插入和删除上有优势。在其next()中会无限循环，不断判断是否有消息，有就返回这条消息并移除。</li>
<li>2.Looper：Looper创建的时候会创建一个MessageQueue，调用loop()方法的时候消息循环开始，loop()也是一个死循环，会不断调用messageQueue的next()，当有消息就处理，否则阻塞在messageQueue的next()中。当Looper的quit()被调用的时候会调用messageQueue的quit(),此时next()会返回null，然后loop()方法也跟着退出。</li>
<li>3.Handler：在主线程构造一个Handler，然后在其他线程调用sendMessage(),此时主线程的MessageQueue中会插入一条message，然后被Looper使用。</li>
<li>4.系统的主线程在ActivityThread的main()为入口开启主线程，其中定义了内部类Activity.H定义了一系列消息类型，包含四大组件的启动停止。</li>
<li>5.MessageQueue和Looper是一对一关系，Handler和Looper是多对一</li>
</ul>
<h2 id="15-怎样退出终止App"><a href="#15-怎样退出终止App" class="headerlink" title="15.怎样退出终止App"></a>15.怎样退出终止App</h2><ul>
<li>1.自己设置一个Activity的栈，然后一个个finish()</li>
</ul>
<h2 id="16-Android-IPC-Binder原理"><a href="#16-Android-IPC-Binder原理" class="headerlink" title="16.Android IPC:Binder原理"></a>16.Android IPC:Binder原理</h2><ul>
<li>1.在Activity和Service进行通讯的时候，用到了Binder。<ul>
<li>1.当属于同个进程我们可以继承Binder然后在Activity中对Service进行操作</li>
<li>2.当不属于同个进程，那么要用到AIDL让系统给我们创建一个Binder，然后在Activity中对远端的Service进行操作。</li>
</ul>
</li>
<li>2.系统给我们生成的Binder：<ul>
<li>1.Stub类中有:接口方法的id，有该Binder的标识，有asInterface(IBinder)(让我们在Activity中获取实现了Binder的接口，接口的实现在Service里，同进程时候返回Stub否则返回Proxy)，有onTransact()这个方法是在不同进程的时候让Proxy在Activity进行远端调用实现Activity操作Service</li>
<li>2.Proxy类是代理，在Activity端，其中有:IBinder mRemote(这就是远端的Binder)，两个接口的实现方法不过是代理最终还是要在远端的onTransact()中进行实际操作。</li>
</ul>
</li>
<li>3.哪一端的Binder是副本，该端就可以被另一端进行操作，因为Binder本体在定义的时候可以操作本端的东西。所以可以在Activity端传入本端的Binder，让Service端对其进行操作称为Listener，可以用RemoteCallbackList这个容器来装Listener，防止Listener因为经历过序列化而产生的问题。</li>
<li>4.当Activity端向远端进行调用的时候，当前线程会挂起，当方法处理完毕才会唤醒。</li>
<li>5.如果一个AIDL就用一个Service太奢侈，所以可以使用Binder池的方式，建立一个AIDL其中的方法是返回IBinder，然后根据方法中传入的参数返回具体的AIDL。</li>
<li>6.IPC的方式有：Bundle（在Intent启动的时候传入，不过是一次性的），文件共享(对于SharedPreference是特例，因为其在内存中会有缓存)，使用Messenger(其底层用的也是AIDL，同理要操作哪端，就在哪端定义Messenger)，AIDL，ContentProvider(在本进程中继承实现一个ContentProvider，在增删改查方法中调用本进程的SQLite，在其他进程中查询)，Socket</li>
</ul>
<h2 id="17-描述一次跨进程通讯"><a href="#17-描述一次跨进程通讯" class="headerlink" title="17.描述一次跨进程通讯"></a>17.描述一次跨进程通讯</h2><ul>
<li>1.client、proxy、serviceManager、BinderDriver、impl、service</li>
<li>2.client发起一个请求service信息的Binder请求到BinderDriver中，serviceManager发现BinderDiriver中有自己的请求 然后将clinet请求的service的数据返回给client这样完成了一次Binder通讯</li>
<li>3.clinet获取的service信息就是该service的proxy，此时调用proxy的方法，proxy将请求发送到BinderDriver中，此时service的 Binder线程池循环发现有自己的请求，然后用impl就处理这个请求最后返回，这样完成了第二次Binder通讯<br>4.中间client可挂起，也可以不挂起，有一个关键字oneway可以解决这个</li>
</ul>
<h2 id="18-android重要术语解释"><a href="#18-android重要术语解释" class="headerlink" title="18.android重要术语解释"></a>18.android重要术语解释</h2><ul>
<li>1.ActivityManagerServices，简称AMS，服务端对象，负责系统中所有Activity的生命周期</li>
<li>2.ActivityThread，App的真正入口。当开启App之后，会调用main()开始运行，开启消息循环队列，这就是传说中的UI线程或者叫主线程。与ActivityManagerServices配合，一起完成Activity的管理工作</li>
<li>3.ApplicationThread，用来实现ActivityManagerService与ActivityThread之间的交互。在ActivityManagerService需要管理相关Application中的Activity的生命周期时，通过ApplicationThread的代理对象与ActivityThread通讯。</li>
<li>4.ApplicationThreadProxy，是ApplicationThread在服务器端的代理，负责和客户端的ApplicationThread通讯。AMS就是通过该代理与ActivityThread进行通信的。</li>
<li>5.Instrumentation，每一个应用程序只有一个Instrumentation对象，每个Activity内都有一个对该对象的引用。Instrumentation可以理解为应用进程的管家，ActivityThread要创建或暂停某个Activity时，都需要通过Instrumentation来进行具体的操作。</li>
<li>6.ActivityStack，Activity在AMS的栈管理，用来记录已经启动的Activity的先后关系，状态信息等。通过ActivityStack决定是否需要启动新的进程。</li>
<li>7.ActivityRecord，ActivityStack的管理对象，每个Activity在AMS对应一个ActivityRecord，来记录Activity的状态以及其他的管理信息。其实就是服务器端的Activity对象的映像。</li>
<li>8.TaskRecord，AMS抽象出来的一个“任务”的概念，是记录ActivityRecord的栈，一个“Task”包含若干个ActivityRecord。AMS用TaskRecord确保Activity启动和退出的顺序。如果你清楚Activity的4种launchMode，那么对这个概念应该不陌生。</li>
</ul>
<h2 id="19-理解Window和WindowManager"><a href="#19-理解Window和WindowManager" class="headerlink" title="19.理解Window和WindowManager"></a>19.理解Window和WindowManager</h2><ul>
<li>1.Window用于显示View和接收各种事件，Window有三种类型：应用Window(每个Activity对应一个Window)、子Window(不能单独存在，附属于特定Window)、系统window(Toast和状态栏)</li>
<li>2.Window分层级，应用Window在1-99、子Window在1000-1999、系统Window在2000-2999.WindowManager提供了增删改View三个功能。</li>
<li>3.Window是个抽象概念：每一个Window对应着一个View和ViewRootImpl，Window通过ViewRootImpl来和View建立联系，View是Window存在的实体，只能通过WindowManager来访问Window。</li>
<li>4.WindowManager的实现是WindowManagerImpl其再委托给WindowManagerGlobal来对Window进行操作，其中有四个List分别储存对应的View、ViewRootImpl、WindowManger.LayoutParams和正在被删除的View</li>
<li>5.Window的实体是存在于远端的WindowMangerService中，所以增删改Window在本端是修改上面的几个List然后通过ViewRootImpl重绘View，通过WindowSession(每个应用一个)在远端修改Window。</li>
<li>6.Activity创建Window：Activity会在attach()中创建Window并设置其回调(onAttachedToWindow()、dispatchTouchEvent()),Activity的Window是由Policy类创建PhoneWindow实现的。然后通过Activity#setContentView()调用PhoneWindow的setContentView。</li>
</ul>
<h2 id="20-Bitmap的处理"><a href="#20-Bitmap的处理" class="headerlink" title="20.Bitmap的处理"></a>20.Bitmap的处理</h2><ul>
<li>1.当使用ImageView的时候，可能图片的像素大于ImageView，此时就可以通过BitmapFactory.Option来对图片进行压缩，inSampleSize表示缩小2^(inSampleSize-1)倍。</li>
<li>2.BitMap的缓存：<ul>
<li>1.使用LruCache进行内存缓存。</li>
<li>2.使用DiskLruCache进行硬盘缓存。</li>
<li>3.实现一个ImageLoader的流程：同步异步加载、图片压缩、内存硬盘缓存、网络拉取<ul>
<li>1.同步加载只创建一个线程然后按照顺序进行图片加载</li>
<li>2.异步加载使用线程池，让存在的加载任务都处于不同线程</li>
<li>3.为了不开启过多的异步任务，只在列表静止的时候开启图片加载</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="21-如何实现一个网络框架-参考Volley"><a href="#21-如何实现一个网络框架-参考Volley" class="headerlink" title="21.如何实现一个网络框架(参考Volley)"></a>21.如何实现一个网络框架(参考Volley)</h2><ul>
<li>1.缓存队列,以url为key缓存内容可以参考Bitmap的处理方式，这里单独开启一个线程。</li>
<li>2.网络请求队列，使用线程池进行请求。</li>
<li>3.提供各种不同类型的返回值的解析如String，Json，图片等等。</li>
</ul>
<h2 id="22-ClassLoader的基础知识"><a href="#22-ClassLoader的基础知识" class="headerlink" title="22.ClassLoader的基础知识"></a>22.ClassLoader的基础知识</h2><ul>
<li>1.双亲委托：一个ClassLoader类负责加载这个类所涉及的所有类，在加载的时候会判断该类是否已经被加载过，然后会递归去他父ClassLoader中找。</li>
<li>2.可以动态加载Jar通过URLClassLoader</li>
<li>3.ClassLoader 隔离问题 JVM识别一个类是由：ClassLoader id+PackageName+ClassName。</li>
<li>4.加载不同Jar包中的公共类：<ul>
<li>1.让父ClassLoader加载公共的Jar，子ClassLoader加载包含公共Jar的Jar，此时子ClassLoader在加载公共Jar的时候会先去父ClassLoader中找。(只适用Java)</li>
<li>2.重写加载包含公共Jar的Jar的ClassLoader，在loadClass中找到已经加载过公共Jar的ClassLoader，也就是把父ClassLoader替换掉。(只适用Java)</li>
<li>3.在生成包含公共Jar的Jar时候把公共Jar去掉。</li>
</ul>
</li>
</ul>
<h2 id="23-插件化框架描述：dynamicLoadApk为例子"><a href="#23-插件化框架描述：dynamicLoadApk为例子" class="headerlink" title="23.插件化框架描述：dynamicLoadApk为例子"></a>23.插件化框架描述：dynamicLoadApk为例子</h2><ul>
<li>1.可以通过DexClassLoader来对apk中的dex包进行加载访问</li>
<li>2.如何加载资源是个很大的问题，因为宿主程序中并没有apk中的资源，所以调用R资源会报错，所以这里使用了Activity中的实现ContextImpl的getAssets()和getResources()再加上反射来实现。</li>
<li>3.由于系统启动Activity有很多初始化动作要做，而我们手动反射很难完成，所以可以采用接口机制，将Activity的大部分生命周期提取成接口，然后通过代理Activity去调用插件Activity的生命周期。同时如果像增加一个新生命周期方法的时候，只需要在接口中和代理中声明一下就行。</li>
<li>4.缺点：<ul>
<li>1.慎用this，因为在apk中使用this并不代表宿主中的activity，当然如果this只是表示自己的接口还是可以的。除此之外可以使用that代替this。</li>
<li>2.不支持Service和静态注册的Broadcast</li>
<li>3.不支持LaunchMode和Apk中Activity的隐式调用。</li>
</ul>
</li>
</ul>
<h2 id="24-热修复：Andfix为例子"><a href="#24-热修复：Andfix为例子" class="headerlink" title="24.热修复：Andfix为例子"></a>24.热修复：Andfix为例子</h2><ul>
<li>1.大致原理：apkpatch将两个apk做一次对比，然后找出不同的部分。可以看到生成的apatch了文件，后缀改成zip再解压开，里面有一个dex文件。通过jadx查看一下源码，里面就是被修复的代码所在的类文件,这些更改过的类都加上了一个_CF的后缀，并且变动的方法都被加上了一个叫@MethodReplace的annotation，通过clazz和method指定了需要替换的方法。然后客户端sdk得到补丁文件后就会根据annotation来寻找需要替换的方法。最后由JNI层完成方法的替换。</li>
<li>2.无法添加新类和新的字段、补丁文件很容易被反编译、加固平台可能会使热补丁功能失效</li>
</ul>
<h2 id="25-线程同步的问题，常用的线程同步"><a href="#25-线程同步的问题，常用的线程同步" class="headerlink" title="25.线程同步的问题，常用的线程同步"></a>25.线程同步的问题，常用的线程同步</h2><ul>
<li>1.sycn：保证了原子性、可见性、有序性</li>
<li>2.锁：保证了原子性、可见性、有序性<ul>
<li>1.自旋锁:可以使线程在没有取得锁的时候，不被挂起，而转去执行一个空循环。<ul>
<li>1.优点:线程被挂起的几率减少，线程执行的连贯性加强。用于对于锁竞争不是很激烈，锁占用时间很短的并发线程。</li>
<li>2.缺点:过多浪费CPU时间，有一个线程连续两次试图获得自旋锁引起死锁</li>
</ul>
</li>
<li>2.阻塞锁:没得到锁的线程等待或者挂起，Sycn、Lock</li>
<li>3.可重入锁:一个线程可多次获取该锁，Sycn、Lock</li>
<li>4.悲观锁:每次去拿数据的时候都认为别人会修改，所以会阻塞全部其他线程 Sycn、Lock</li>
<li>5.乐观锁:每次去拿数据的时候都认为别人不会修改，所以不会上锁，但是在更新的时候会判断一下在此期间别人有没有去更新这个数据，可以使用版本号等机制。cas</li>
<li>6.显示锁和内置锁:显示锁用Lock来定义、内置锁用synchronized。</li>
<li>7.读-写锁:为了提高性能，Java提供了读</li>
</ul>
</li>
<li>3.volatile<ul>
<li>1.只能保证可见性，不能保证原子性</li>
<li>2.自增操作有三步，此时多线程写会出现问题</li>
</ul>
</li>
<li>4.cas<ul>
<li>1.操作:内存值V、旧的预期值A、要修改的值B，当且仅当预期值A和内存值V相同时，将内存值修改为B并返回true，否则什么都不做并返回false。</li>
<li>2.解释:本地副本为A，共享内存为V，线程A要把V修改成B。某个时刻线程A要把V修改成B，如果A和V不同那么就表示有其他线程在修改V，此时就表示修改失败，否则表示没有其他线程修改，那么把V改成B。</li>
<li>3.局限:如果V被修改成V1然后又被改成V，此时cas识别不出变化，还是认为没有其他线程在修改V，此时就会有问题</li>
<li>4.局限解决:将V带上版本。</li>
</ul>
</li>
<li>5.线程不安全到底是怎么回事：<ul>
<li>1.一个线程写，多个线程读的时候，会造成写了一半就去读</li>
<li>2.多线程写，会造成脏数据</li>
</ul>
</li>
</ul>
<h2 id="26-Asynctask和线程池，GC相关（怎么判断哪些内存该GC，GC算法）"><a href="#26-Asynctask和线程池，GC相关（怎么判断哪些内存该GC，GC算法）" class="headerlink" title="26.Asynctask和线程池，GC相关（怎么判断哪些内存该GC，GC算法）"></a>26.Asynctask和线程池，GC相关（怎么判断哪些内存该GC，GC算法）</h2><ul>
<li>1.Asynctask：异步任务类，单线程线程池+Handler</li>
<li>2.线程池：<ul>
<li>1.ThreadPoolExecutor：通过Executors可以构造单线程池、固定数目线程池、不固定数目线程池。</li>
<li>2.ScheduledThreadPoolExecutor：可以延时调用线程或者延时重复调度线程。</li>
</ul>
</li>
<li>3.GC相关：重要<ul>
<li>1.搜索算法：<ul>
<li>1.引用计数</li>
<li>2.图搜索，可达性分析</li>
</ul>
</li>
<li>2.回收算法：<ul>
<li>1.标记清除复制：用于青年代</li>
<li>2.标记整理：用于老年代</li>
</ul>
</li>
<li>3.堆分区：<ul>
<li>1.青年区eden 80%、survivor1 10%、survivor2 10%</li>
<li>2.老年区</li>
</ul>
</li>
<li>4.虚拟机栈分区：<ul>
<li>1.局部变量表</li>
<li>2.操作数栈</li>
<li>3.动态链接</li>
<li>4.方法返回地址</li>
</ul>
</li>
<li>5.GC Roots:<ul>
<li>1.虚拟机栈(栈桢中的本地变量表)中的引用的对象</li>
<li>2.方法区中的类静态属性引用的对象</li>
<li>3.方法区中的常量引用的对象</li>
<li>4.本地方法栈中JNI的引用的对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="27-网络"><a href="#27-网络" class="headerlink" title="27.网络"></a>27.网络</h2><ul>
<li>1.ARP协议:在IP以太网中，当一个上层协议要发包时，有了该节点的IP地址，ARP就能提供该节点的MAC地址。</li>
<li>2.HTTP HTTPS的区别:<ul>
<li>1.HTTPS使用TLS(SSL)进行加密</li>
<li>2.HTTPS缺省工作在TCP协议443端口</li>
<li>3.它的工作流程一般如以下方式:<ul>
<li>1.完成TCP三次同步握手</li>
<li>2.客户端验证服务器数字证书，通过，进入步骤3</li>
<li>3.DH算法协商对称加密算法的密钥、hash算法的密钥</li>
<li>4.SSL安全加密隧道协商完成</li>
<li>5.网页以加密的方式传输，用协商的对称加密算法和密钥加密，保证数据机密性；用协商的hash算法进行数据完整性保护，保证数据不被篡改</li>
</ul>
</li>
<li>3.http请求包结构，http返回码的分类，400和500的区别<ul>
<li>1.包结构：<ul>
<li>1.请求：请求行、头部、数据</li>
<li>2.返回：状态行、头部、数据</li>
</ul>
</li>
<li>2.http返回码分类：1到5分别是，消息、成功、重定向、客户端错误、服务端错误</li>
</ul>
</li>
<li>4.Tcp<ul>
<li>1.可靠连接，三次握手，四次挥手<ul>
<li>1.三次握手：防止了服务器端的一直等待而浪费资源，例如只是两次握手，如果s确认之后c就掉线了，那么s就会浪费资源<ul>
<li>1.syn-c = x，表示这消息是x序号</li>
<li>2.ack-s = x + 1，表示syn-c这个消息接收成功。syn-s = y，表示这消息是y序号。</li>
<li>3.ack-c = y + 1，表示syn-s这条消息接收成功</li>
</ul>
</li>
</ul>
</li>
<li>2.四次挥手：TCP是全双工模式<ul>
<li>1.fin-c = x , 表示现在需要关闭c到s了。ack-c = y,表示上一条s的消息已经接收完毕</li>
<li>2.ack-s = x + 1，表示需要关闭的fin-c消息已经接收到了，同意关闭</li>
<li>3.fin-s = y + 1，表示s已经准备好关闭了，就等c的最后一条命令</li>
<li>4.ack-c = y + 1，表示c已经关闭，让s也关闭</li>
</ul>
</li>
<li>3.滑动窗口，停止等待、后退N、选择重传</li>
<li>4.拥塞控制，慢启动、拥塞避免、加速递减、快重传快恢复</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="28-数据库性能优化：索引和事务，需要找本专门的书大概了解一下"><a href="#28-数据库性能优化：索引和事务，需要找本专门的书大概了解一下" class="headerlink" title="28.数据库性能优化：索引和事务，需要找本专门的书大概了解一下"></a>28.数据库性能优化：索引和事务，需要找本专门的书大概了解一下</h2><h2 id="29-13-APK打包流程和其内容"><a href="#29-13-APK打包流程和其内容" class="headerlink" title="29.13.APK打包流程和其内容"></a>29.13.APK打包流程和其内容</h2><ul>
<li>1.流程<ul>
<li>1.aapt生成R文件<ul>
<li>2.aidl生成java文件</li>
<li>3.将全部java文件编译成class文件</li>
<li>4.将全部class文件和第三方包合并成dex文件</li>
<li>5.将资源、so文件、dex文件整合成apk</li>
<li>6.apk签名</li>
<li>7.apk字节对齐</li>
</ul>
</li>
</ul>
</li>
<li>2.内容：so、dex、asset、资源文件</li>
</ul>
<h2 id="30-网络劫持的类型原理：可以百度一下了解一下具体概念"><a href="#30-网络劫持的类型原理：可以百度一下了解一下具体概念" class="headerlink" title="30.网络劫持的类型原理：可以百度一下了解一下具体概念"></a>30.网络劫持的类型原理：可以百度一下了解一下具体概念</h2><ul>
<li>1.DNS劫持、欺骗、污染</li>
<li>2.http劫持：重定向、注入js，http注入、报文扩展</li>
</ul>
<h2 id="31-java类加载过程："><a href="#31-java类加载过程：" class="headerlink" title="31.java类加载过程："></a>31.java类加载过程：</h2><ul>
<li>1.加载时机：创建实例、访问静态变量或方法、反射、加载子类之前</li>
<li>2.验证：验证文件格式、元数据、字节码、符号引用的正确性</li>
<li>3.加载：根据全类名获取文件字节流、将字节流转化为静态储存结构放入方法区、生成class对象</li>
<li>4.准备：在堆上为静态变量划分内存</li>
<li>5.解析：将常量池中的符号引用转换为直接引用</li>
<li>6.初始化：初始化静态变量</li>
<li>7.书籍推荐：<strong>深入理解java虚拟机</strong>，博客推荐：<a href="https://www.jianshu.com/p/bc6d1770d92c">Java/Android阿里面试JVM部分理解</a></li>
</ul>
<h2 id="32-retrofit的了解"><a href="#32-retrofit的了解" class="headerlink" title="32.retrofit的了解"></a>32.retrofit的了解</h2><ul>
<li>1.动态代理创建一个接口的代理类</li>
<li>2.通过反射解析每个接口的注解、入参构造http请求</li>
<li>3.获取到返回的http请求，使用Adapter解析成需要的返回值。</li>
</ul>
<h2 id="33-bundle的数据结构，如何存储"><a href="#33-bundle的数据结构，如何存储" class="headerlink" title="33.bundle的数据结构，如何存储"></a>33.bundle的数据结构，如何存储</h2><ul>
<li>1.键值对储存</li>
<li>2.传递的数据可以是boolean、byte、int、long、float、double、string等基本类型或它们对应的数组，也可以是对象或对象数组。</li>
<li>3.当Bundle传递的是对象或对象数组时，必须实现Serializable 或Parcelable接口</li>
</ul>
<h2 id="34-listview内点击buttom并移动的事件流完整拦截过程："><a href="#34-listview内点击buttom并移动的事件流完整拦截过程：" class="headerlink" title="34.listview内点击buttom并移动的事件流完整拦截过程："></a>34.listview内点击buttom并移动的事件流完整拦截过程：</h2><ul>
<li>1.点下按钮的时候：<ul>
<li>1.产生了一个down事件，activity–&gt;phoneWindow–&gt;ViewGroup–&gt;ListView–&gt;botton,中间如果有重写了拦截方法，则事件被该view拦截可能消耗。</li>
<li>2.没拦截，事件到达了button，这个过程中建立了一条事件传递的view链表</li>
<li>3.到button的dispatch方法–&gt;onTouch–&gt;view是否可用–&gt;Touch代理</li>
</ul>
</li>
<li>2.移动点击按钮的时候:<ul>
<li>1.产生move事件，listView中会对move事件做拦截</li>
<li>2.此时listView会将该滑动事件消费掉</li>
<li>3.后续的滑动事件都会被listView消费掉</li>
</ul>
</li>
<li>3.手指抬起来时候：前面建立了一个view链表，listView的父view在获取事件的时候，会直接取链表中的listView让其进行事件消耗。</li>
</ul>
<h2 id="35-service的意义：不需要界面，在后台执行的程序"><a href="#35-service的意义：不需要界面，在后台执行的程序" class="headerlink" title="35.service的意义：不需要界面，在后台执行的程序"></a>35.service的意义：不需要界面，在后台执行的程序</h2><h2 id="36-android的IPC通信方式，线程（进程间）通信机制有哪些"><a href="#36-android的IPC通信方式，线程（进程间）通信机制有哪些" class="headerlink" title="36.android的IPC通信方式，线程（进程间）通信机制有哪些"></a>36.android的IPC通信方式，线程（进程间）通信机制有哪些</h2><ul>
<li>1.ipc通信方式：binder、contentprovider、socket</li>
<li>2.操作系统进程通讯方式：共享内存、socket、管道</li>
</ul>
<h2 id="37-操作系统进程和线程的区别"><a href="#37-操作系统进程和线程的区别" class="headerlink" title="37.操作系统进程和线程的区别"></a>37.操作系统进程和线程的区别</h2><ul>
<li>1.简而言之,一个程序至少有一个进程,一个进程至少有一个线程.</li>
<li>2.线程的划分尺度小于进程，使得多线程程序的并发性高。</li>
<li>3.另外，进程在执行过程中拥有独立的内存单元，而多个线程共享内存，从而极大地提高了程序的运行效率。</li>
<li>4.多线程的意义在于一个应用程序中，有多个执行部分可以同时执行。有将多个线程看做多个独立的应用，来实现进程的调度和管理以及资源分配</li>
</ul>
<h2 id="38-HashMap的实现过程：Capacity就是buckets的数目，Load-factor就是buckets填满程度的最大比例。如果对迭代性能要求很高的话不要把capacity设置过大，也不要把load-factor设置过小。"><a href="#38-HashMap的实现过程：Capacity就是buckets的数目，Load-factor就是buckets填满程度的最大比例。如果对迭代性能要求很高的话不要把capacity设置过大，也不要把load-factor设置过小。" class="headerlink" title="38.HashMap的实现过程：Capacity就是buckets的数目，Load factor就是buckets填满程度的最大比例。如果对迭代性能要求很高的话不要把capacity设置过大，也不要把load factor设置过小。"></a>38.HashMap的实现过程：Capacity就是buckets的数目，Load factor就是buckets填满程度的最大比例。如果对迭代性能要求很高的话不要把capacity设置过大，也不要把load factor设置过小。</h2><ul>
<li>1.简单来说HashMap就是一个会自动扩容的<strong>数组链表</strong></li>
<li>2.put过程<ul>
<li>1.对key的hashCode()做hash，然后再计算index;</li>
<li>2.如果没碰撞直接放到bucket里；</li>
<li>3.如果碰撞了，以链表的形式存在buckets后；</li>
<li>4.如果碰撞导致链表过长(大于等于TREEIFY_THRESHOLD)，就把链表转换成红黑树；</li>
<li>5.如果节点已经存在就替换old value(保证key的唯一性)</li>
<li>6.如果bucket满了(超过load factor*current capacity)，就要resize。</li>
</ul>
</li>
<li>3.resize：当put时，如果发现目前的bucket占用程度已经超过了Load Factor所希望的比例，那么就会发生resize。在resize的过程，简单的说就是把bucket扩充为2倍，之后重新计算index，把节点再放到新的bucket中</li>
<li>4.get过程<ul>
<li>1.根据key的hash算出数组下表</li>
<li>2.使用equals遍历链表进行比较</li>
</ul>
</li>
</ul>
<h2 id="39-mvc、mvp、mvvm："><a href="#39-mvc、mvp、mvvm：" class="headerlink" title="39.mvc、mvp、mvvm："></a>39.mvc、mvp、mvvm：</h2><ul>
<li>1.mvc:数据、View、Activity，View将操作反馈给Activity，Activitiy去获取数据，数据通过观察者模式刷新给View。循环依赖<ul>
<li>1.Activity重，很难单元测试</li>
<li>2.View和Model耦合严重</li>
</ul>
</li>
<li>2.mvp:数据、View、Presenter，View将操作给Presenter，Presenter去获取数据，数据获取好了返回给Presenter，Presenter去刷新View。PV，PM双向依赖<ul>
<li>1.接口爆炸</li>
<li>2.Presenter很重</li>
</ul>
</li>
<li>3.mvvm:数据、View、ViewModel，View将操作给ViewModel，ViewModel去获取数据，数据和界面绑定了，数据更新界面更新。<ul>
<li>1.viewModel的业务逻辑可以单独拿来测试</li>
<li>2.一个view 对应一个 viewModel 业务逻辑可以分离，不会出现全能类</li>
<li>3.数据和界面绑定了，不用写垃圾代码，但是复用起来不舒服</li>
</ul>
</li>
</ul>
<h2 id="40-java的线程如何实现"><a href="#40-java的线程如何实现" class="headerlink" title="40.java的线程如何实现"></a>40.java的线程如何实现</h2><ul>
<li>1.Thread继承</li>
<li>2.Runnale</li>
<li>3.Future</li>
<li>4.线程池</li>
</ul>
<h2 id="41-ArrayList-如何删除重复的元素或者指定的元素；"><a href="#41-ArrayList-如何删除重复的元素或者指定的元素；" class="headerlink" title="41.ArrayList 如何删除重复的元素或者指定的元素；"></a>41.ArrayList 如何删除重复的元素或者指定的元素；</h2><ul>
<li>1.删除重复：Set</li>
<li>2.删除指定：迭代器</li>
</ul>
<h2 id="42-如何设计在-UDP-上层保证-UDP-的可靠性传输；"><a href="#42-如何设计在-UDP-上层保证-UDP-的可靠性传输；" class="headerlink" title="42.如何设计在 UDP 上层保证 UDP 的可靠性传输；"></a>42.如何设计在 UDP 上层保证 UDP 的可靠性传输；</h2><ul>
<li>1.简单来讲，要使用UDP来构建可靠的面向连接的数据传输，就要实现类似于TCP协议的超时重传，有序接受，应答确认，滑动窗口流量控制等机制,等于说要在传输层的上一层（或者直接在应用层）实现TCP协议的可靠数据传输机制。</li>
<li>2.比如使用UDP数据包+序列号，UDP数据包+时间戳等方法，在服务器端进行应答确认机制，这样就会保证不可靠的UDP协议进行可靠的数据传输。</li>
<li>3.基于udp的可靠传输协议有：RUDP、RTP、UDT</li>
</ul>
<h2 id="43-Java-中内部类为什么可以访问外部类"><a href="#43-Java-中内部类为什么可以访问外部类" class="headerlink" title="43.Java 中内部类为什么可以访问外部类"></a>43.Java 中内部类为什么可以访问外部类</h2><ul>
<li>1.因为内部类创建的时候，需要外部类的对象，在内部类对象创建的时候会把外部类的引用传递进去</li>
</ul>
<h2 id="44-设计移动端的联系人存储与查询的功能，要求快速搜索联系人，可以用到哪些数据结构？数据库索引，平衡二叉树-B树、红黑树"><a href="#44-设计移动端的联系人存储与查询的功能，要求快速搜索联系人，可以用到哪些数据结构？数据库索引，平衡二叉树-B树、红黑树" class="headerlink" title="44.设计移动端的联系人存储与查询的功能，要求快速搜索联系人，可以用到哪些数据结构？数据库索引，平衡二叉树(B树、红黑树)"></a>44.设计移动端的联系人存储与查询的功能，要求快速搜索联系人，可以用到哪些数据结构？数据库索引，平衡二叉树(B树、红黑树)</h2><h2 id="45-红黑树特点"><a href="#45-红黑树特点" class="headerlink" title="45.红黑树特点"></a>45.红黑树特点</h2><ul>
<li>1.root节点和叶子节点是黑色</li>
<li>2.红色节点后必须为黑色节点</li>
<li>3.从root到叶子每条路径的黑节点数量相同</li>
</ul>
<h2 id="46-linux异步和同步i-o"><a href="#46-linux异步和同步i-o" class="headerlink" title="46.linux异步和同步i/o:"></a>46.linux异步和同步i/o:</h2><ul>
<li>1.同步：对于client，client一直等待，但是client不挂起：主线程调用</li>
<li>2.异步：对于client，client发起请求，service好了再回调client：其他线程调用，调用完成之后进行回调</li>
<li>3.阻塞：对于service，在准备io的时候会将service端挂起，直至准备完成然后唤醒service：bio</li>
<li>3.非阻塞：对于service，在准备io的时候不会将service端挂起，而是service一直去轮询判断io是否准备完成，准备完成了就进行操作：nio、linux的select、poll、epoll</li>
<li>4.多路复用io：非阻塞io的一种优化，java nio，用一个线程去轮询多个 io端口是否可用，如果一个可用就通知对应的io请求，这使用一个线程轮询可以大大增强性能。<ul>
<li>1.我可以采用 多线程+ 阻塞IO 达到类似的效果，但是由于在多线程 + 阻塞IO 中，每个socket对应一个线程，这样会造成很大的资源占用。</li>
<li>2.而在多路复用IO中，轮询每个socket状态是内核在进行的，这个效率要比用户线程要高的多。</li>
</ul>
</li>
<li>5.异步io：aio，用户线程完全不感知io的进行，所有操作都交给内核，io完成之后内核通知用户线程。<ul>
<li>1.这种io才是异步的，2、3、4都是同步io，因为内核进行数据拷贝的过程都会让用户线程阻塞。</li>
<li>2.异步IO是需要操作系统的底层支持，也就是内核支持，Java 7中，提供了Asynchronous IO</li>
</ul>
</li>
</ul>
<h2 id="47-ConcurrentHashMap内部实现，HashTable的实现被废弃的原因"><a href="#47-ConcurrentHashMap内部实现，HashTable的实现被废弃的原因" class="headerlink" title="47.ConcurrentHashMap内部实现，HashTable的实现被废弃的原因:"></a>47.ConcurrentHashMap内部实现，HashTable的实现被废弃的原因:</h2><ul>
<li>1.HashTable容器在竞争激烈的并发环境下表现出效率低下的原因，是因为所有访问HashTable的线程都必须竞争同一把锁，那假如容器里有多把锁，每一把锁用于锁容器其中一部分数据，那么当多线程访问容器里不同数据段的数据时，线程间就不会存在锁竞争，从而可以有效的提高并发访问效率，这就是ConcurrentHashMap所使用的锁分段技术，首先将数据分成一段一段的存储，然后给每一段数据配一把锁，当一个线程占用锁访问其中一个段数据的时候，其他段的数据也能被其他线程访问。</li>
<li>2.ConcurrentHashMap是由Segment数组结构和HashEntry数组结构组成。Segment是一种可重入锁ReentrantLock，在ConcurrentHashMap里扮演锁的角色，HashEntry则用于存储键值对数据。一个ConcurrentHashMap里包含一个Segment数组，Segment的结构和HashMap类似，是一种数组和链表结构， 一个Segment里包含一个HashEntry数组，每个HashEntry是一个链表结构的元素，每个Segment守护者一个HashEntry数组里的元素,当对HashEntry数组的数据进行修改时，必须首先获得它对应的Segment锁。</li>
</ul>
<h2 id="48-HandlerThread是什么"><a href="#48-HandlerThread是什么" class="headerlink" title="48.HandlerThread是什么"></a>48.HandlerThread是什么</h2><ul>
<li>1.MessageQueue + Looper + Handler</li>
</ul>
<h2 id="49-IntentService是什么"><a href="#49-IntentService是什么" class="headerlink" title="49.IntentService是什么"></a>49.IntentService是什么</h2><ul>
<li>1.含有HandlerThread的Service，可以多次startService()来多次在子线程中进行 onHandlerIntent()的调用。</li>
</ul>
<h2 id="50-class和dex"><a href="#50-class和dex" class="headerlink" title="50.class和dex"></a>50.class和dex</h2><ul>
<li>1.dvm执行的是dex格式文件，jvm执行的是class文件，android程序编译完之后生产class文件。然后dex工具会把class文件处理成dex文件，然后把资源文件和.dex文件等打包成apk文件。</li>
<li>2.dvm是基于寄存器的虚拟机，而jvm执行是基于虚拟栈的虚拟机。寄存器存取速度比栈快的多，dvm可以根据硬件实现最大的优化，比较适合移动设备。</li>
<li>3.class文件存在很多的冗余信息，dex工具会去除冗余信息，并把所有的class文件整合到dex文件中。减少了I/O操作，提高了类的查找速度</li>
</ul>
<h2 id="51-内存泄漏"><a href="#51-内存泄漏" class="headerlink" title="51.内存泄漏"></a>51.内存泄漏</h2><ul>
<li>1.其他线程持有一个Listener，Listener操作activity。那么在线程么有完毕的时候，activity关闭了，原本是要被回收的但是，不能被回收。</li>
<li>2.例如Handler导致的内存泄漏，Handler就相当于Listener。</li>
<li>3.在activity关闭的时候注意停止线程，或者将Listener的注册取消</li>
<li>3.使用弱引用，这样即使Listener持有了activity，在GC的时候还是会被回收</li>
<li>4.工具:LeakCanary</li>
</ul>
<h2 id="52-过度绘制、卡顿优化"><a href="#52-过度绘制、卡顿优化" class="headerlink" title="52.过度绘制、卡顿优化:"></a>52.过度绘制、卡顿优化:</h2><ul>
<li>1.过度绘制：<ul>
<li>1.移除Window默认的Background：getWidow.setBackgroundDrawable(null);</li>
<li>2.移除XML布局文件中非必需的Background</li>
<li>3.减少布局嵌套(扁平化的一个体现，减少View数的深度，也就减少了View树的遍历时间，渲染的时候，前后期的工作，总是按View树结点来)</li>
<li>4.在引入布局文件里面，最外层可以用merge替代LinearLayout,RelativeLayout，这样把子UI元素直接衔接在include位置</li>
<li>5.工具：HierarchyViewer 查看视图层级</li>
</ul>
</li>
<li>2.卡顿优化：16ms数据更新</li>
</ul>
<h2 id="53-apk瘦身"><a href="#53-apk瘦身" class="headerlink" title="53.apk瘦身:"></a>53.apk瘦身:</h2><ul>
<li>1.classes.dex：通过代码混淆，删掉不必要的jar包和代码实现该文件的优化</li>
<li>2.资源文件：通过Lint工具扫描代码中没有使用到的静态资源</li>
<li>3.图片资源：使用tinypng和webP，下面详细介绍图片资源优化的方案,矢量图</li>
<li>4.SO文件将不用的去掉，目前主流app一般只放一个arm的so包</li>
</ul>
<h2 id="54-ANR的形成，各个组件上出现ARN的时间限制是多少"><a href="#54-ANR的形成，各个组件上出现ARN的时间限制是多少" class="headerlink" title="54.ANR的形成，各个组件上出现ARN的时间限制是多少"></a>54.ANR的形成，各个组件上出现ARN的时间限制是多少</h2><ul>
<li>1.只要是主线程耗时的操作就会ARN  如io</li>
<li>2.broadcast超时时间为10秒  按键无响应的超时时间为5秒 前台service无响应的超时时间为20秒，后台service为200秒</li>
</ul>
<h2 id="55-Serializable和Parcelable-的区别"><a href="#55-Serializable和Parcelable-的区别" class="headerlink" title="55.Serializable和Parcelable 的区别"></a>55.Serializable和Parcelable 的区别</h2><ul>
<li>1.P 消耗内存小</li>
<li>2.网络传输用S  程序内使用P</li>
<li>3.S将数据持久化方便</li>
<li>4.S使用了反射 容易触发垃圾回收 比较慢</li>
</ul>
<h2 id="56-Sharedpreferences源码简述"><a href="#56-Sharedpreferences源码简述" class="headerlink" title="56.Sharedpreferences源码简述"></a>56.Sharedpreferences源码简述</h2><ul>
<li>1.储存于硬盘上的xml键值对，数据多了会有性能问题</li>
<li>2.ContextImpl记录着SharedPreferences的重要数据，文件路径和实例的键值对</li>
<li>3.在xml文件全部内加载到内存中之前，读取操作是阻塞的，在xml文件全部内加载到内存中之后，是直接读取内存中的数据</li>
<li>4.apply因为是异步的没有返回值, commit是同步的有返回值能知道修改是否提交成功</li>
<li>5.多并发的提交commit时，需等待正在处理的commit数据更新到磁盘文件后才会继续往下执行，从而降低效率; 而apply只是原子更新到内存，后调用apply函数会直接覆盖前面内存数据，从一定程度上提高很多效率。 3.edit()每次都是创建新的EditorImpl对象.</li>
<li>6.博客推荐：**<a href="https://www.jianshu.com/p/102f25cf64e3">全面剖析SharedPreferences</a>**</li>
</ul>
<h2 id="57-操作系统如何管理内存的："><a href="#57-操作系统如何管理内存的：" class="headerlink" title="57.操作系统如何管理内存的："></a>57.操作系统如何管理内存的：</h2><ul>
<li>1.使用寄存器进行将进程地址和物理内存进行映射</li>
<li>2.虚拟内存进行内存映射到硬盘上增大内存</li>
<li>3.虚拟内存是进行内存分页管理</li>
<li>4.页表实现分页，就是 页+地址偏移。</li>
<li>5.如果程序的内存在硬盘上，那么就需要用页置换算法来将其调入内存中：先进先出、最近未使用最少等等</li>
<li>6.博客推荐：**<a href="https://www.jianshu.com/p/aecff59430fa">现代操作系统部分章节笔记</a>**</li>
</ul>
<h2 id="58-浏览器输入地址到返回结果发生了什么"><a href="#58-浏览器输入地址到返回结果发生了什么" class="headerlink" title="58.浏览器输入地址到返回结果发生了什么"></a>58.浏览器输入地址到返回结果发生了什么</h2><ul>
<li>1.DNS解析</li>
<li>2.TCP连接</li>
<li>3.发送HTTP请求</li>
<li>4.服务器处理请求并返回HTTP报文</li>
<li>5.浏览器解析渲染页面</li>
<li>6.连接结束</li>
</ul>
<h2 id="59-java泛型类型擦除发生在什么时候，通配符有什么需要注意的。"><a href="#59-java泛型类型擦除发生在什么时候，通配符有什么需要注意的。" class="headerlink" title="59.java泛型类型擦除发生在什么时候，通配符有什么需要注意的。"></a>59.java泛型类型擦除发生在什么时候，通配符有什么需要注意的。</h2><ul>
<li>1.发生在编译的时候</li>
<li>2.PECS，extends善于提供精确的对象 A是B的子集，Super善于插入精确的对象 A是B的超集</li>
<li>3.博客推荐：**<a href="https://www.jianshu.com/p/4e4751b5bbbb">Effective Java笔记（不含反序列化、并发、注解和枚举）</a><strong>、</strong><a href="https://www.jianshu.com/p/6006a3284f55">android阿里面试java基础锦集</a>**</li>
</ul>
<h2 id="60-activity的生命周期"><a href="#60-activity的生命周期" class="headerlink" title="60.activity的生命周期"></a>60.activity的生命周期</h2><ul>
<li>1.a启动b，后退键再到a的生命周期流程：a.create–&gt;a.start–&gt;a.resume–&gt;a.pause–&gt;b.create–&gt;b.start–&gt;b.resume–&gt;b界面绘制–&gt;a.stop–&gt;b.pause–&gt;b.stop–&gt;b.destroy–&gt;a.restart–&gt;a.start–&gt;a.resume</li>
<li>2.意外销毁会调用saveInstance，重新恢复的时候回调用restoreInstance。储存数据的时候使用了委托机制，从activity–&gt;window–&gt;viewGroup–&gt;view 会递归调用save来保持本view的数据，restore则是递归恢复本view数据。我们可以在里面做一些自己需要的数据操作。</li>
</ul>
<h2 id="61-面试常考的算法"><a href="#61-面试常考的算法" class="headerlink" title="61.面试常考的算法"></a>61.面试常考的算法</h2><ul>
<li>1.快排、堆排序为首的各种排序算法</li>
<li>2.链表的各种操作：判断成环、判断相交、合并链表、倒数K个节点、寻找成环节点</li>
<li>3.二叉树、红黑树、B树定义以及时间复杂度计算方式</li>
<li>4.动态规划、贪心算法、简单的图论</li>
<li>5.推荐书籍：<strong>算法导论</strong>，将图论之前的例子写一遍</li>
</ul>
<h2 id="62-Launcher进程启动另外一个进程的过程：启动一个app"><a href="#62-Launcher进程启动另外一个进程的过程：启动一个app" class="headerlink" title="62.Launcher进程启动另外一个进程的过程：启动一个app"></a>62.Launcher进程启动另外一个进程的过程：<a href="http://www.cnblogs.com/tiantianbyconan/p/5017056.html">启动一个app</a></h2><h2 id="63-开源框架源码"><a href="#63-开源框架源码" class="headerlink" title="63.开源框架源码"></a>63.开源框架源码</h2><ul>
<li>1.Fresco<ul>
<li>1.mvc框架：<ul>
<li>1.Controller控制数据显示在Hierarchy中的Drawable的显隐</li>
<li>2.ImagePipeline在Controller中负责进行数据获取，返回的数据是CloseableImage</li>
<li>3.Drawee把除了初始化之外的操作全部交给Holder去做，Holder持有Controller和Hierarchy</li>
</ul>
</li>
<li>2.Drawable层次以及绘制：<ul>
<li>1.如果要绘制一次Drawable就调用invalidateSelf()来触发onDraw()</li>
<li>2.Drawable分为：容器类(保存一些Drawable)、自我绘制类(进度条)、图形变换类(scale、rotate、矩阵变换)、动画类(内部不断刷新，进行webp和gif的帧绘制)</li>
<li>3.ImagePipeline返回的CloseableImage是由一个个DrawableFactory解析成Drawable的</li>
<li>4.webp和gif动画是由jni代码解析的，然后其他静态图片是根据不同的android平台使用BitmapFactory来解析的</li>
</ul>
</li>
<li>3.职责链模式：producer不做操作标n，表示只是提供一个consumer。获取图片–》解码图片缓存Producer–》后台线程Producer–》client图片处理producer(n)–》解码producer(n)–》旋转或剪裁producer(n)–》编码图片内存缓存producer–》读硬盘缓存producer–》写硬盘缓存producer(n)–》网络producer提供CloseableImage《–解码图片缓存consumer《–client图片处理consumer《–解码consumer《–旋转或剪裁consumer《–编码图片内存缓存consumer《–写硬盘缓存consumer《–图片数据</li>
<li>4.内存缓存：<ul>
<li>1.一个CountingLruMap保存已经没有被引用的缓存条目，一个CountingLruMap保存所有的条目包括没有引用的条目。每当缓存策略改变和一定时间缓存配置的更新的时候，就会将 待销毁条目Map中的条目一个个移除，直到缓存大小符合配置。</li>
<li>2.这里的引用计数是用Fresco组件实现的引用计数器。</li>
<li>3.缓存有一个代理类，用来追踪缓存的存取。</li>
<li>4.CountingLruMap是使用LinkedHashMap来储存数据的。</li>
</ul>
</li>
<li>5.硬盘缓存：<ul>
<li>1.DefaultDiskStorage使用Lru策略。</li>
<li>2.为了不让所有的文件集中在一个文件中，创建很多命名不同的文件夹，然后使用hash算法把缓存文件分散</li>
<li>3.DiskStorageCache封装了DefaultDiskStorage，不仅进行缓存存取追踪，并且其在内存里面维持着一个 &lt;key,value&gt; 的键值对，因为文件修改频繁，所有只是定时刷新，因此如果在内存中找不到，还要去硬盘中找一次。</li>
<li>4.删除硬盘的缓存只出现在硬盘数据大小超限的时候，此时同时也会删除缓存中的key，所以不会出现内存中有key，但是硬盘上没有的情况。</li>
<li>5.在插入硬盘数据的时候，采用的是插入器的形式。返回一个Inserter，在Inserter.writeData()中传入一个CallBack(里面封装了客户端插入数据的逻辑和文件引用)，让内部实现调用CallBack的逻辑来插入文件数据，前面写的文件后缀是.temp,只有调用commit()之后才会修改后缀，让文件对客户端可见。</li>
<li>6.使用了java提供的FileTreeVisitor来遍历文件</li>
</ul>
</li>
<li>6.对象池：<ul>
<li>1.使用数组来存储一个桶，桶内部是一个Queue。数组下标是数据申请内存的byte大小，桶内部的Queue存的是内存块的。所以数组使用的是稀疏数组</li>
<li>2.申请内存的方式有两种 1.java堆上开辟的内存 2.ashme 的本地内存中开辟的内存</li>
</ul>
</li>
<li>7.设计模式：Builder、职责链、观察者、代理、组合、享元、适配器、装饰者、策略、生产者消费者、提供者</li>
<li>8.自定义计数引用：类似c++智能指针<ul>
<li>1.使用一个静态IdentityHashMap &lt;储存需要被计数引用的对象,其被引用的次数&gt;</li>
<li>2.用SharedReference分装需要被计数引用的对象，提供一个销毁资源的销毁器，提供一个静态工厂方法来复制自己，复制一个引用计数加一。提供一个方法销毁自己，表示自己需要变成无人引用的对象了，此时引用计数减一。</li>
<li>3.引用计数归零，销毁器将销毁资源，如bitmap的recycle或者是jni内存调用jni方法归还内存。</li>
</ul>
</li>
<li>9.博客推荐：**<a href="https://www.jianshu.com/p/dbe01f9994d0">Android Fresco源码文档翻译</a><strong>、</strong><a href="https://www.jianshu.com/p/ab2124764438">从零开始撸一个Fresco之硬盘缓存</a><strong>、</strong><a href="https://www.jianshu.com/p/36663090b140">从零开始撸一个Fresco之gif和Webp动画</a><strong>、</strong><a href="https://www.jianshu.com/p/ba0de15ce667">从零开始撸一个Fresco之内存缓存</a><strong>、</strong><a href="https://www.jianshu.com/p/2dff47ae7666">从零开始撸一个Fresco之总结</a>**</li>
</ul>
</li>
<li>2.oKhttp：<ul>
<li>1.同步和异步：<ul>
<li>1.异步使用了Dispatcher来将存储在 Deque 中的请求分派给线程池中各个线程执行。</li>
<li>2.当任务执行完成后，无论是否有异常，finally代码段总会被执行，也就是会调用Dispatcher的finished函数，它将正在运行的任务Call从队列runningAsyncCalls中移除后，主动的把缓存队列向前走了一步。</li>
</ul>
</li>
<li>2.连接池：<ul>
<li>1.一个Connection封装了一个socket，ConnectionPool中储存s着所有的Connection，StreamAllocation是引用计数的一个单位</li>
<li>2.当一个请求获取一个Connection的时候要传入一个StreamAllocation，Connection中存着一个弱引用的StreamAllocation列表，每当上层应用引用一次Connection，StreamAllocation就会加一个。反之如果上层应用不使用了，就会删除一个。</li>
<li>3.ConnectionPool中会有一个后台任务定时清理StreamAllocation列表为空的Connection。5分钟时间，维持5个socket</li>
</ul>
</li>
<li>3.选择路线与建立连接<ul>
<li>1.选择路线有两种方式：<ul>
<li>1.无代理，那么在本地使用DNS查找到ip，注意结果是数组，即一个域名有多个IP，这就是自动重连的来源</li>
<li>2.有代理HTTP：设置socket的ip为代理地址的ip，设置socket的端口为代理地址的端口</li>
<li>3.代理好处：HTTP代理会帮你在远程服务器进行DNS查询，可以减少DNS劫持。</li>
</ul>
</li>
<li>2.建立连接<ul>
<li>1.连接池中已经存在连接，就从中取出(get)RealConnection，如果没有命中就进入下一步</li>
<li>2.根据选择的路线(Route)，调用Platform.get().connectSocket选择当前平台Runtime下最好的socket库进行握手</li>
<li>3.将建立成功的RealConnection放入(put)连接池缓存</li>
<li>4.如果存在TLS，就根据SSL版本与证书进行安全握手</li>
<li>5.构造HttpStream并维护刚刚的socket连接，管道建立完成</li>
</ul>
</li>
</ul>
</li>
<li>4.职责链模式：缓存、重试、建立连接等功能存在于拦截器中网络请求相关，主要是网络请求优化。网络请求的时候遇到的问题</li>
<li>5.博客推荐：**<a href="https://www.jianshu.com/p/60e5ebf0096a">Android数据层架构的实现 上篇</a><strong>、</strong><a href="https://www.jianshu.com/p/5def7b42d223">Android数据层架构的实现 下篇</a>**</li>
</ul>
</li>
<li>3.okio<ul>
<li>1.简介；<ul>
<li>1.sink：自己–》别人</li>
<li>2.source：别人–》自己</li>
<li>3.BufferSink：有缓存区域的sink</li>
<li>4.BufferSource：有缓存区域的source</li>
<li>5.Buffer：实现了3、4的缓存区域，内部有Segment的双向链表，在在转移数据的时候，只需要将指针转移指向就行</li>
</ul>
</li>
<li>2.比java io的好处：<ul>
<li>1.减少内存申请和数据拷贝</li>
<li>2.类少，功能齐全，开发效率高</li>
</ul>
</li>
<li>3.内部实现：<ul>
<li>1.Buffer的Segment双向链表，减少数据拷贝</li>
<li>2.Segment的内部byte数组的共享，减少数据拷贝</li>
<li>3.SegmentPool的共享和回收Segment</li>
<li>4.sink和source中被实际操作的其实是Buffer，Buffer可以充当sink和source</li>
<li>5.最终okio只是对java io的封装，所有操作都是基于java io 的</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>写在最后:能看到这里的人,我挺佩服你的.这篇文章是我在<strong>头条</strong>面试之前整理的,最后**80%**的题目都命中了,所以祝你好运.</p>
</blockquote>
<p>不贩卖焦虑，也不标题党。分享一些这个世界上有意思的事情。题材包括且不限于：科幻、科学、科技、互联网、程序员、计算机编程。下面是我的微信公众号：<strong>世界上有意思的事</strong>，干货多多等你来看。</p>
<p>作者：何时夕<br>链接：<a href="https://www.jianshu.com/p/cf5092fa2694">https://www.jianshu.com/p/cf5092fa2694</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h1 id="百度面试题"><a href="#百度面试题" class="headerlink" title="百度面试题"></a><a href="https://www.jianshu.com/p/f0d2ed1254a9">百度面试题</a></h1><p>电话面试</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="bullet">1.</span> 安卓View绘制流程</span><br><span class="line"><span class="bullet">2.</span> 事件分发机制</span><br><span class="line"><span class="bullet">3.</span> JAVA基础思想</span><br><span class="line"><span class="bullet">4.</span> 多线程和安全问题</span><br><span class="line"><span class="bullet">5.</span> 安卓性能优化和兼容问题</span><br><span class="line"><span class="bullet">6.</span> 再问一下常规的组件相关问题</span><br></pre></td></tr></table></figure>





<p>现场笔试</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>  请描述安卓四大组建之间的关系，并说下安卓MVC的设计模式。</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 线程中sleep()和wait()有和却别，各有什么含义                   </span><br><span class="line"></span><br><span class="line"><span class="number">3</span>  <span class="keyword">abstract</span>和<span class="class"><span class="keyword">interface</span>的区别?</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span> array,arrayList, List ,三者有何区别？</span><br><span class="line"></span><br><span class="line"><span class="number">5</span> hashtable和hashmap的区别,并简述Hashmap的实现原理</span><br><span class="line"></span><br><span class="line"><span class="number">6</span> StringBuilder和],String ,subString方法的细微差别</span><br><span class="line">          </span><br><span class="line"><span class="number">7</span> 请写出四种以上你知道的设计模式，并介绍下实现原理</span><br><span class="line">          </span><br><span class="line"><span class="number">8</span> 安卓子线程是否能更新UI，如果能请说明具体细节。</span><br><span class="line"></span><br><span class="line"><span class="number">9</span> ANR产生的原因和解决步骤</span><br><span class="line"></span><br><span class="line"><span class="number">10</span> JavaGC机制的原理和内存泄露</span><br><span class="line"></span><br><span class="line"><span class="number">11</span>  安卓布局优化方案，          </span><br><span class="line"></span><br><span class="line"><span class="number">12</span>  请在<span class="number">100</span>个电话号码找出<span class="number">135</span>的电话号码   注意 不能用正则，（类似怎么最好的遍历LogGat日志）</span><br><span class="line"><span class="number">13</span>  Handler机制，请写出一种更新UI的方法和代码</span><br><span class="line"></span><br><span class="line"><span class="number">14</span>  请解释安卓为啥要加签名机制。</span><br><span class="line"></span><br><span class="line"><span class="number">15</span>   你觉得安卓开发最关键的技术在哪里？</span><br><span class="line"><span class="number">13</span>  Handler机制，请写出一种更新UI的方法和代码</span><br><span class="line"></span><br><span class="line"><span class="number">14</span>  请解释安卓为啥要加签名机制。</span><br><span class="line"></span><br><span class="line"><span class="number">15</span>   你觉得安卓开发最关键的技术在哪里？</span><br></pre></td></tr></table></figure>

<p>一轮面试：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1  ANR 具体产生的类型有哪些，具体说下其产生的最大超时时间。</span><br><span class="line"></span><br><span class="line">2  多线程多点下载的过程</span><br><span class="line"></span><br><span class="line">3 http协议的理解和用法</span><br><span class="line"></span><br><span class="line">4 安卓解决线程并发问题</span><br><span class="line"></span><br><span class="line">5 你知道的数据结构有哪些，说下具体实现机制</span><br><span class="line"></span><br><span class="line">6 十六进制数据怎么和十进制和二进制之间转换</span><br><span class="line"></span><br><span class="line">7 谈下对Java OOP中多态的理解</span><br><span class="line"></span><br><span class="line">8  activty和Fragmengt之间怎么通信，Fragmengt和Fragmengt怎么通信</span><br><span class="line"></span><br><span class="line">9 怎么让自己的进程不被第三方应用杀掉，系统杀掉之后怎么能启动起来。</span><br><span class="line">10 说下平时开发中比较注意的一些问题，</span><br><span class="line">         </span><br><span class="line">答 ：可以熟说下svn和git的细节，和代码规范问题，和一些安全信息的问题等</span><br><span class="line"></span><br><span class="line">11 自定义view效率高于xml定义吗？说明理由。</span><br><span class="line"></span><br><span class="line">13 广播注册一般有几种，各有什么优缺点</span><br><span class="line"></span><br><span class="line">14 服务启动一般有几种，服务和activty之间怎么通信，服务和服务之间怎么通信</span><br><span class="line">15 布局优化主要哪些？具体优化？</span><br><span class="line"></span><br><span class="line">16 数据库的知识，包括本地数据库优化点。</span><br></pre></td></tr></table></figure>

<p>二轮面试</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span> 安卓事件分发机制，请详细说下整个流程</span><br><span class="line"></span><br><span class="line"><span class="number">2</span> 安卓view绘制机制和加载过程，请详细说下整个流程</span><br><span class="line"></span><br><span class="line"><span class="number">3</span> activty的加载过程 请详细介绍下（不是生命周期切记）</span><br><span class="line"></span><br><span class="line"><span class="number">4</span> 安卓采用自动垃圾回收机制，请说下安卓内存管理的原理</span><br><span class="line">     </span><br><span class="line"><span class="number">5</span>  说下安卓虚拟机和java虚拟机的原理和不同点 </span><br><span class="line"></span><br><span class="line"><span class="number">6</span> 多线程中的安全队列一般通过什么实现？线程池原理？（java）</span><br><span class="line"></span><br><span class="line"><span class="number">7</span> 安卓权限管理，为何在清单中注册权限，安卓APP就可以使用，反之不可以（操作系统）</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>  socket短线重连怎么实现，心跳机制又是怎样实现，四次握手步骤有哪些（网络通讯原理）</span><br><span class="line"></span><br><span class="line"><span class="number">9</span> http中TCP和UDP有啥区别，说下HTTP请求的IP报文结构（计算机网络）</span><br><span class="line"><span class="number">10</span> 你知道的安全加密有哪些？   （如果你说了一个加密，面试官就会接着跟进提问，所以之前你必须要会，不会的话背也要背下来）（安全加密）</span><br><span class="line"><span class="number">11</span>  你知道的数据存储结构？堆栈和链表内部机制。（数据结构）</span><br><span class="line"></span><br><span class="line"><span class="number">12</span> 说下Linux进程和线程的区别。进程调度优先级，和cpu调度进程关系。（操作系统）</span><br><span class="line"> </span><br><span class="line"><span class="number">13</span> 请你详细说下你知道的一种设计模式，并解释下java的高内聚和低耦合。</span><br><span class="line"></span><br><span class="line"><span class="number">14</span>  spring 的反射和代理，在安卓中应用场景（插件和ROM数据框架）</span><br><span class="line"></span><br><span class="line"><span class="number">15</span> JNI 调用过程中 混淆问题</span><br><span class="line"></span><br><span class="line"><span class="number">16</span> 看过安卓源码吗，请说出一个你看过的API或者组建内部原理。</span><br><span class="line"></span><br><span class="line"><span class="number">17</span> android <span class="number">5.0</span> <span class="number">6.0</span> 以及<span class="number">7.0</span>预测新特性</span><br><span class="line"></span><br><span class="line"><span class="number">18</span> hybrid混合开发，响应式编程等</span><br><span class="line"></span><br><span class="line"><span class="number">17</span>为啥离职呢  对待加班看法</span><br><span class="line"></span><br><span class="line"><span class="number">18</span> 你擅长什么，做了那些东西。</span><br></pre></td></tr></table></figure>



<h1 id="名企面试题"><a href="#名企面试题" class="headerlink" title="名企面试题"></a><a href="https://www.jianshu.com/p/735be5ece9e8">名企面试题</a></h1><h2 id="Android"><a href="#Android" class="headerlink" title="Android"></a><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/tree/master/android">Android</a></h2><h5 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h5><ul>
<li>[Android 源码中的设计模式(你需要知道的设计模式全在这里)](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 源码中的设计模式(你需要知道的设计模式全在这里).md)</li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/%E5%85%A8%E9%9D%A2%E4%BA%86%E8%A7%A3Activity.md">全面了解Activity</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Service%E5%85%A8%E9%9D%A2%E6%80%BB%E7%BB%93.md">Service全面总结</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/IntentService%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3%E5%92%8C%E5%AE%9E%E4%BE%8B%E4%BB%8B%E7%BB%8D.md">IntentService使用详解和实例介绍</a></li>
<li>[Fragment 全解析](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Fragment">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Fragment</a> 全解析.md)</li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/ContentProvider%E5%AE%9E%E4%BE%8B%E8%AF%A6%E8%A7%A3.md">ContentProvider实例详解</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/BroadcastReceiver%E4%BD%BF%E7%94%A8%E6%80%BB%E7%BB%93.md">BroadcastReceiver使用总结</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android%E5%BC%82%E6%AD%A5%E4%BB%BB%E5%8A%A1%E6%9C%BA%E5%88%B6%E4%B9%8BAsycTask.md">Android异步任务机制之AsycTask</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E5%9B%BE%E8%A7%A3.md">Android启动过程图解</a></li>
<li>[Android 自定义View入门](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 自定义View入门.md)</li>
<li>[Android 自定义ViewGroup入门实践](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 自定义ViewGroup入门实践.md)</li>
<li>[Android 缓存机制](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 缓存机制.md)</li>
<li>[Android 数据存储五种方式使用与总结](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 数据存储五种方式使用与总结.md)</li>
<li>[Android 异步消息处理机制源码解析](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 异步消息处理机制（Handler 、 Looper 、MessageQueue）源码解析.md)</li>
<li>[Android View事件分发机制源码分析](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> View事件分发机制源码分析.md)</li>
<li>[Android SQLite的使用入门](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> SQLite的使用入门.md)</li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/AIDL%E7%9A%84%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5%E5%92%8C%E5%AE%9E%E4%BE%8B%E4%BB%8B%E7%BB%8D.md">AIDL的使用情况和实例介绍</a></li>
<li>[Android 名企面试题及答案整理（一）](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android</a> 名企面试题及答案整理（一）.md)</li>
</ul>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><ul>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android5.0%E3%80%816.0%E3%80%817.0%E6%96%B0%E7%89%B9%E6%80%A7.md">Android5.0、6.0、7.0新特性</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android%E4%B8%AD%E5%BC%B1%E5%BC%95%E7%94%A8%E4%B8%8E%E8%BD%AF%E5%BC%95%E7%94%A8%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF.md">Android中弱引用与软引用的应用场景</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Android%E9%95%BF%E8%BF%9E%E6%8E%A5%EF%BC%8C%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6.md">Android长连接，怎么处理心跳机制</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Asset%E7%9B%AE%E5%BD%95%E4%B8%8Eres%E7%9B%AE%E5%BD%95%E7%9A%84%E5%8C%BA%E5%88%AB.md">Asset目录与res目录的区别</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Binder%E6%9C%BA%E5%88%B6%E5%8E%9F%E7%90%86%E5%92%8C%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0.md">Binder机制原理和底层实现</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/Json%E4%BC%98%E5%8A%A3%E5%8A%BF.md">Json优劣势</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/ListView%E4%BC%98%E5%8C%96.md">ListView优化</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/android%E4%B8%AD%E5%9B%BE%E7%89%87%E7%BC%93%E5%AD%98.md">android中图片缓存</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/%E4%B8%A4%E7%B1%BB%E5%8A%A8%E7%94%BB.md">两类动画</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/%E4%BA%94%E5%A4%A7%E5%B8%83%E5%B1%80%E6%98%93%E6%B7%B7%E6%B7%86%E7%9F%A5%E8%AF%86.md">五大布局易混淆知识</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/%E4%BF%9D%E8%AF%81service%E4%B8%8D%E8%A2%AB%E6%9D%80%E6%AD%BB.md">保证service不被杀死</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/%E5%8A%A0%E9%80%9F%E5%90%AF%E5%8A%A8activity.md">加速启动activity</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/%E6%80%8E%E6%A0%B7%E9%80%80%E5%87%BA%E7%BB%88%E6%AD%A2App.md">怎样退出终止App</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/android/activity%E5%88%87%E6%8D%A2%E5%8A%A8%E7%94%BB.md">activity切换动画</a></li>
</ul>
<h5 id="外链"><a href="#外链" class="headerlink" title="外链"></a>外链</h5><ul>
<li><a href="https://link.jianshu.com/?t=http://www.trinea.cn/android/layout-performance/">布局性能优化(include, viewstub, merge)</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.cnblogs.com/xiaoluo501395377/p/3444744.html">DOM、SAX、Pull解析XML</a></li>
</ul>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/tree/master/java">Java</a></h2><h5 id="基础-1"><a href="#基础-1" class="headerlink" title="基础"></a>基础</h5><ul>
<li>[ArrayList、LinkedList、Vector的区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> ArrayList、LinkedList、Vector的区别.md)</li>
<li>[Collection包结构，与Collections的区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Collection包结构，与Collections的区别.md)</li>
<li>[Excption与Error包结构,OOM和SOF](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Excption与Error包结构%2COOM和SOF.md)</li>
<li>[HashMap和HashTable的区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> HashMap和HashTable的区别.md)</li>
<li>[HashMap源码分析](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> HashMap源码分析.md)</li>
<li>[Hashcode的作用](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Hashcode的作用.md)</li>
<li>[Map、Set、List、Queue、Stack的特点与用法](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Map、Set、List、Queue、Stack的特点与用法.md)</li>
<li>[Object有哪些公用方法？](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Object有哪些公用方法？.md)</li>
<li>[Override和Overload的使用规则和区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Override和Overload的使用规则和区别.md)</li>
<li>[Switch能否用string做参数？](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> Switch能否用string做参数？.md)</li>
<li>[ThreadLocal的使用规则和源码分析](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> ThreadLocal的使用规则和源码分析.md)</li>
<li>[ThreadPool用法与示例](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> ThreadPool用法与示例.md)</li>
<li>[equals与==的区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> equals与%3D%3D的区别.md)</li>
<li>[try catch finally，try里有return，finally还执行么？](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> try catch finally，try里有return，finally还执行么？.md)</li>
<li>[九种基本数据类型的大小，以及他们的封装类](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 九种基本数据类型的大小，以及他们的封装类.md)</li>
<li>[从源码分析String、StringBuffer与StringBuilder区别和联系](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 从源码分析String、StringBuffer与StringBuilder区别和联系.md)</li>
<li>[多线程下生产者消费者问题的五种同步方法实现](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 多线程下生产者消费者问题的五种同步方法实现.md)</li>
<li>[实现多线程的两种方法](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 实现多线程的两种方法.md)</li>
<li>[接口（Interface）与 抽象类 （Abstract）使用规则和区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 接口（Interface）与 抽象类 （Abstract）使用规则和区别.md)</li>
<li>[方法锁、对象锁和类锁的意义和区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 方法锁、对象锁和类锁的意义和区别.md)</li>
<li>[四种引用，强弱软虚，用到的场景](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 的四种引用，强弱软虚，用到的场景.md)</li>
<li>[线程同步的方法：sychronized、lock、reentrantLock分析](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 线程同步的方法：sychronized、lock、reentrantLock分析.md)</li>
<li>[集合框架的层次结构和使用规则梳理](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 集合框架的层次结构和使用规则梳理.md)</li>
<li>[面向对象的三个特征与含义](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5BJava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[Java]</a> 面向对象的三个特征与含义.md)</li>
<li>[static的作用和意义](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5Bjava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[java]</a> static的作用和意义.md)</li>
<li>[多态实现的JVM调用过程](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/%5Bjava%5D">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/java/[java]</a> 多态实现的JVM调用过程.md)</li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/wait()%E5%92%8Csleep()%E7%9A%84%E5%8C%BA%E5%88%AB.md">wait()和sleep()的区别</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/git%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8.md">git命令使用</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/java/Java%E4%B8%8EC++%E5%AF%B9%E6%AF%94.md">Java与C++对比</a></li>
</ul>
<h5 id="外链-1"><a href="#外链-1" class="headerlink" title="外链"></a>外链</h5><ul>
<li><a href="https://link.jianshu.com/?t=http://762626559-qq-com.iteye.com/blog/395402">java反射</a></li>
<li><a href="https://link.jianshu.com/?t=http://blog.csdn.net/xiaanming/article/details/8703708/">java回调</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.weixueyuan.net/view/6321.html">Java泛型</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.cnblogs.com/langtianya/p/3757993.html">java 新特性</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.iteye.com/topic/834447">Java IO与NIO</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.xuebuyuan.com/780786.html">foreach与正常for循环效率对比</a></li>
</ul>
<h2 id="数据结构-https-link-jianshu-com-t-https-github-com-helen-x-AndroidInterview-tree-master-data-structure"><a href="#数据结构-https-link-jianshu-com-t-https-github-com-helen-x-AndroidInterview-tree-master-data-structure" class="headerlink" title="[数据结构](https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/tree/master/data structure)"></a>[数据结构](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/tree/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/tree/master/data</a> structure)</h2><h5 id="基础-2"><a href="#基础-2" class="headerlink" title="基础"></a>基础</h5><ul>
<li>[九大基础排序总结与对比(排序算法一网打尽)](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 九大基础排序总结与对比.md)</li>
<li>[AVL树和AVL旋转、哈夫曼树和哈夫曼编码](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] AVL树和AVL旋转、哈夫曼树和哈夫曼编码.md)</li>
<li>[B(B-)树、B+树、B树](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] B(B-)树、B%2B树、B树.md)</li>
<li>[Hash表、Hash函数及冲突解决](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] Hash表、Hash函数及冲突解决.md)</li>
<li>[KMP的一个简单解释](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] KMP的一个简单解释.md)</li>
<li>[二分查找与变种二分查找](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 二分查找与变种二分查找.md)</li>
<li>[二叉树前中后、层次遍历算法](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 二叉树前中后、层次遍历算法.md)</li>
<li>[图的BFS、DFS、prim、Dijkstra算法](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 图的BFS、DFS、prim、Dijkstra算法.md)</li>
<li>[字符串操作](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 字符串操作.md)</li>
<li>[数组与链表的优缺点和区别](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 数组与链表的优缺点和区别.md)</li>
<li>[红黑树](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 红黑树.md)</li>
<li>[队列和栈](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/data">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/data</a> structure/[数据结构] 队列和栈.md)</li>
</ul>
<h5 id="外链-2"><a href="#外链-2" class="headerlink" title="外链"></a>外链</h5><ul>
<li><a href="https://link.jianshu.com/?t=http://blog.csdn.net/zyq522376829/article/details/47686867">海量数据处理 </a></li>
</ul>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/tree/master/algorithm">算法</a></h2><h5 id="基础-3"><a href="#基础-3" class="headerlink" title="基础"></a>基础</h5><ul>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E4%B8%8E%E5%8F%8C%E5%90%91%E9%93%BE%E8%A1%A8.md">二叉搜索树与双向链表</a></li>
<li>[二叉树中 和为某值 的所有路径](<a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BA%8C%E5%8F%89%E6%A0%91%E4%B8%AD">https://link.jianshu.com?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/二叉树中</a> 和为某值 的所有路径.md)</li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%95%9C%E5%83%8F.md">二叉树的镜像</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BA%8C%E7%BB%B4%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E6%9F%A5%E6%89%BE.md">二维数组中的查找</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BA%8C%E8%BF%9B%E5%88%B6%E4%B8%AD1%E7%9A%84%E4%B8%AA%E6%95%B0.md">二进制中1的个数</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BB%8E%E4%B8%8A%E5%BE%80%E4%B8%8B%E6%89%93%E5%8D%B0%E4%BA%8C%E5%8F%89%E6%A0%91.md">从上往下打印二叉树</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E4%BB%8E%E5%B0%BE%E5%88%B0%E5%A4%B4%E6%89%93%E5%8D%B0%E9%93%BE%E8%A1%A8.md">从尾到头打印链表</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%88%A4%E6%96%AD%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%A0%91%E7%9A%84%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86%E5%BA%8F%E5%88%97.md">判断二叉搜索树的后序遍历序列</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%88%A4%E6%96%AD%E6%A0%88%E7%9A%84%E5%BC%B9%E5%87%BA%E5%BA%8F%E5%88%97.md">判断栈的弹出序列</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%88%A4%E6%96%AD%E6%A0%91B%E6%98%AF%E4%B8%8D%E6%98%AF%E6%A0%91A%E7%9A%84%E5%AD%90%E7%BB%93%E6%9E%84.md">判断树B是不是树A的子结构</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%8C%85%E5%90%ABmin%E5%87%BD%E6%95%B0%E7%9A%84%E6%A0%88.md">包含min函数的栈</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%8F%8D%E8%BD%AC%E9%93%BE%E8%A1%A8.md">反转链表</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%8F%98%E6%80%81%E8%B7%B3%E5%8F%B0%E9%98%B6.md">变态跳台阶</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%8E%92%E5%BA%8F%E9%93%BE%E8%A1%A8.md">合并两个排序链表</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%A4%8D%E6%9D%82%E9%93%BE%E8%A1%A8%E7%9A%84%E5%A4%8D%E5%88%B6.md">复杂链表的复制</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%A9%BA%E6%A0%BC%E6%9B%BF%E6%8D%A2.md">字符串中空格替换</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%A1%BA%E5%BA%8F%E5%85%A8%E6%8E%92%E5%88%97.md">字符串的顺序全排列</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E6%95%B0%E7%BB%84%E4%B8%AD%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0%E8%B6%85%E8%BF%87%E4%B8%80%E5%8D%8A%E7%9A%84%E6%95%B0%E5%AD%97.md">数组中出现次数超过一半的数字</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E6%96%90%E6%B3%A2%E9%82%A3%E5%A5%91%E6%95%B0%E5%88%97.md">斐波那契数列</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E6%95%B0%E5%AD%97.md">旋转数组的最小数字</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E6%B5%AE%E7%82%B9%E6%95%B0%E7%9A%84%E6%95%B4%E6%95%B0%E6%AC%A1%E6%96%B9.md">浮点数的整数次方</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E7%94%A8%E4%B8%A4%E4%B8%AA%E6%A0%88%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97.md">用两个栈实现队列</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E7%9F%A9%E5%BD%A2%E8%A6%86%E7%9B%96.md">矩形覆盖</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E8%B0%83%E6%95%B4%E6%95%B0%E7%BB%84%E9%A1%BA%E5%BA%8F%E4%BD%BF%E5%A5%87%E6%95%B0%E4%BD%8D%E4%BA%8E%E5%81%B6%E6%95%B0%E5%89%8D%E9%9D%A2.md">调整数组顺序使奇数位于偶数前面</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E8%B7%B3%E5%8F%B0%E9%98%B6.md">跳台阶</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E9%87%8D%E5%BB%BA%E4%BA%8C%E5%8F%89%E6%A0%91.md">重建二叉树</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E9%93%BE%E8%A1%A8%E4%B8%AD%E5%80%92%E6%95%B0%E7%AC%ACk%E4%B8%AA%E7%BB%93%E7%82%B9.md">链表中倒数第k个结点</a></li>
<li><a href="https://link.jianshu.com/?t=https://github.com/helen-x/AndroidInterview/blob/master/algorithm/swordForOffer/%E9%A1%BA%E6%97%B6%E9%92%88%E6%89%93%E5%8D%B0%E7%9F%A9%E9%98%B5.md">顺时针打印矩阵</a></li>
</ul>
<h5 id="外链-3"><a href="#外链-3" class="headerlink" title="外链"></a>外链</h5><ul>
<li><a href="https://link.jianshu.com/?t=http://www.cnblogs.com/steven_oyj/archive/2010/05/22/1741370.html">分治算法</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.cnblogs.com/steven_oyj/archive/2010/05/22/1741374.html">动态规划</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.cnblogs.com/steven_oyj/archive/2010/05/22/1741375.html">贪心算法</a></li>
<li><a href="https://link.jianshu.com/?t=http://www.cnblogs.com/steven_oyj/archive/2010/05/22/1741378.html">分支限界法</a></li>
</ul>
<p>作者：菜刀文<br>链接：<a href="https://www.jianshu.com/p/735be5ece9e8">https://www.jianshu.com/p/735be5ece9e8</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<h1 id="面试和必备的技能"><a href="#面试和必备的技能" class="headerlink" title="面试和必备的技能"></a>面试和必备的技能</h1><p>这里只简单列举一些东西，可能不是特别全，但是却特别适用，也不一定按照下面的流程，有可能是穿插的，也有可能都有，根据公司的规模以及面试官的心情而定（哈哈哈 ，你们就自求多福吧）。建议大家还是要将下面的东西全部掌握，没事写写代码，练练手，在项目中能用到的地方一定要用，有可能会遇到很多坑，一定要自己想办法填坑，之后回忆起这段经历，肯定可以敢理直气壮的跟别人讨论。如果你说的头头是道，那么对方会先输一层，然后在心里对你佩服。</p>
<ol>
<li><p>一般情况下第一轮都是基础面试，需要扎实的基础</p>
<ul>
<li>最常用的Android 基础知识</li>
<li>Java 基础知识</li>
<li>了解一些 常用东西的原理，例如：handler， thread 等</li>
<li>项目中的技术点</li>
</ul>
</li>
<li><p>第二轮的时候需要了解更深层次的东西</p>
<ul>
<li>Android 事件分发机制原理</li>
<li>Android 绘图机制原理</li>
<li>WindowManager 的相关知识</li>
<li>进程间传输方式</li>
<li>Java 内存管理机制</li>
<li>一些常用的 list,map 原理，以及子类之间的差别</li>
</ul>
</li>
<li><p>能进入第三轮基本没什么问题，但是要注意以下问题</p>
<ul>
<li><p>该轮一般是 老大或者部门负责人，问的问题一般都看 深度与广度</p>
</li>
<li><p>当问及薪水的时候，要说一个合适的，小公司随意，大公司一定要慎重，当心里没底的时候，可以告诉对方，让对方给一个合理的薪资。一般都是在原工资基础之上增长，听猎头说一般涨幅都在15%-30%，超 NB 的可以要30%及以上，如果感觉自己还不错的，挺厉害的，建议最高20%，一般人就定在15% 左右最靠谱。公司内部一般有一套机制，根据公司情况而定。</p>
</li>
<li><p>我们的面试原则就是拿到合理薪资，得到 offer</p>
</li>
<li><p>个人发展情况，这个问题很难回答，如果和公司方向不符合，极有可能和公司无缘。建议多试探性的问问公司缺少什么，你能否给予公司对应的东西。当然对于有自我追求的人，那可以放心大胆的提。我的方向就是架构师，哈哈哈，挺极端的，别学我哦。我感觉选择都是双向的，因此我知道自己需要的是什么。</p>
</li>
<li><p>你最擅长什么UI 还是其他什么？这个问题更不好回答。你要说你擅长 UI，是不是意味着你其他能力就不行？虽然我不知道面试官的用意，但是我能感觉到，这个问题不是那么好回答，我会回答说自己都行，来什么业务接什么需求。可能回答不太好，总之和公司的职位吻合就行，这样总不至于出错吧。</p>
</li>
</ul>
</li>
</ol>
<h2 id="Android-高级面试题及答案"><a href="#Android-高级面试题及答案" class="headerlink" title="Android 高级面试题及答案"></a><a href="https://www.cnblogs.com/deman/p/5860976.html">Android 高级面试题及答案</a></h2><ul>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label0">1.如何对 Android 应用进行性能分析</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label1">2.什么情况下会导致内存泄露</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label2">3.如何避免 OOM 异常</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label3">4.Android 中如何捕获未捕获的异常</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label4">5.ANR 是什么？怎样避免和解决 ANR（重要）</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label5">6.Android 线程间通信有哪几种方式</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label6">7.Devik 进程，linux 进程，线程的区别</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label7">8.描述一下 android 的系统架构</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label8">9.android 应用对内存是如何限制的?我们应该如何合理使用内存？</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label9">10. 简述 android 应用程序结构是哪些</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label10">11.请解释下 Android 程序运行时权限与文件系统权限的区别</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label11">12.Framework 工作方式及原理，Activity 是如何生成一个 view 的，机制是什么</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label12">13.多线程间通信和多进程之间通信有什么不同，分别怎么实现</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label13">14.Android 屏幕适配</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label14">15.什么是 AIDL 以及如何使用</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label15">16.Handler 机制</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label16">17.事件分发机制</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label17">18.子线程发消息到主线程进行更新 UI，除了 handler 和 AsyncTask，还有什么</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label18">19.子线程中能不能 new handler？为什么</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label19">20.Android 中的动画有哪几类，它们的特点和区别是什么</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label20">21.如何修改 Activity 进入和退出动画</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label21">22.SurfaceView &amp; View 的区别</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label22">23.开发中都使用过哪些框架、平台</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label23">24.使用过那些自定义View</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label24">25.自定义控件：绘制圆环的实现过程</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label25">26.自定义控件：摩天轮的实现过程</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label27">28.流式布局的实现过程</a></li>
<li><a href="https://www.cnblogs.com/deman/p/5860976.html#_label28">29.第三方登陆</a></li>
<li>[30.第三方支付](</li>
</ul>
]]></content>
      <tags>
        <tag>inter</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin_elementary</title>
    <url>/2021/08/19/kotlin-elementary/</url>
    <content><![CDATA[<p><a href="https://www.jianshu.com/p/8eb0623f08c6">https://www.jianshu.com/p/8eb0623f08c6</a></p>
<h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><h5 id="Kotlin内置数据类型"><a href="#Kotlin内置数据类型" class="headerlink" title="Kotlin内置数据类型"></a>Kotlin内置数据类型</h5><p><img src="/2021/08/19/kotlin-elementary/2021-08-19_datatype.png"></p>
<h5 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h5><p>对于已经声明并赋值的变量，它允许你省略类型定义.</p>
<h5 id="编译时常量"><a href="#编译时常量" class="headerlink" title="编译时常量"></a>编译时常量</h5><p>编译时常量只能再函数外定义，因为编译时常量必须在编译时赋值，而函数时在运行时才调用，函数内的变量也是在运行时赋值，编译时常量要在这些变量赋值前就已存在。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> MAX =<span class="number">200</span>;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123; </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">val</span> MAX =<span class="number">200</span>;<span class="comment">//报错 Modifier &#x27;const&#x27; is not applicable to &#x27;local variable&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="基本表达式"><a href="#基本表达式" class="headerlink" title="基本表达式"></a>基本表达式</h3><h5 id="age表达式"><a href="#age表达式" class="headerlink" title="age表达式"></a>age表达式</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> score = <span class="number">6</span>;</span><br><span class="line"><span class="keyword">if</span> (score <span class="keyword">in</span> <span class="number">9.</span><span class="number">.10</span>)&#123;</span><br><span class="line">    println(<span class="string">&quot;Big美女&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (score <span class="keyword">in</span> <span class="number">6.</span><span class="number">.8</span>)&#123;</span><br><span class="line">    println(<span class="string">&quot;美女&quot;</span>)</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    println(<span class="string">&quot;who knows&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(score !<span class="keyword">in</span> <span class="number">1.</span><span class="number">.5</span>)&#123;</span><br><span class="line">    println(<span class="string">&quot;good&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>美女<br>good</p>
</blockquote>
<h5 id="when"><a href="#when" class="headerlink" title="when"></a>when</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> school = <span class="string">&quot;0小学&quot;</span>;</span><br><span class="line"><span class="keyword">val</span> level = <span class="keyword">when</span> (school) &#123;</span><br><span class="line">    <span class="string">&quot;幼儿园&quot;</span> -&gt; <span class="string">&quot;幼儿&quot;</span></span><br><span class="line">    <span class="string">&quot;小学&quot;</span> -&gt; <span class="string">&quot;少儿&quot;</span></span><br><span class="line">    <span class="string">&quot;中学&quot;</span> -&gt; <span class="string">&quot;青少年&quot;</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; &#123;</span><br><span class="line">        <span class="string">&quot;未知&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>类似于 if else条件语句</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> osd = <span class="keyword">when</span> &#123;</span><br><span class="line">    isOdd() -&gt; print(<span class="string">&quot;x is odd&quot;</span>)</span><br><span class="line">    isEven() -&gt; print(<span class="string">&quot;y is even&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span> -&gt; print(<span class="string">&quot;x+y is odd&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(<span class="string">&quot;osd <span class="variable">$osd</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isOdd</span><span class="params">()</span></span>:<span class="built_in">Boolean</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isEven</span><span class="params">()</span></span>:<span class="built_in">Boolean</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="String模版"><a href="#String模版" class="headerlink" title="String模版"></a>String模版</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> flag = <span class="literal">false</span></span><br><span class="line">println(<span class="string">&quot;Answer is : <span class="subst">$&#123;if (flag) <span class="string">&quot;我可以&quot;</span> else <span class="string">&quot;I can play&quot;</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="函数-函数参数"><a href="#函数-函数参数" class="headerlink" title="函数,函数参数"></a>函数,函数参数</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">printUser(<span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">printUser(name = <span class="string">&quot;john&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">printUser</span><span class="params">(name:<span class="type">String</span>,age:<span class="type">Int</span>=<span class="number">2</span>)</span></span>&#123;</span><br><span class="line">    println(name+age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Nothing类型"><a href="#Nothing类型" class="headerlink" title="Nothing类型"></a>Nothing类型</h5><p>终止代码运行</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">TODO(<span class="string">&quot;nothing&quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="反引号"><a href="#反引号" class="headerlink" title="反引号 ``"></a>反引号 ``</h5><p>可以用来测试 某一段代码</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> `**~ special function with  test util ~**`<span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Kotlin和Java保留不同的关键字，使用反引号括住函数名能避免任何冲突</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyWordJava</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">is</span><span class="params">()</span></span>&#123; <span class="comment">//is时关键字</span></span><br><span class="line">        System.out.println(<span class="string">&quot;is invoked&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">KeyWordJava.`<span class="keyword">is</span>`()</span><br></pre></td></tr></table></figure>



<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><p>匿名函数可以当作变量赋值给函数类型变量。函数的类型，由传入的参数和返回值类型决定。</p>
<p>和具名函数不一样，除极少情况外，匿名函数不需要return关键字，来返回数据，匿名函数会隐式或自动返回函数体最后一行语句的结果。</p>
<p>通过匿名函数给标准函数 制定规则</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> total  = <span class="string">&quot;Mississippi&quot;</span>.count()</span><br><span class="line"><span class="comment">//通过匿名函数给标准函数 制定规则</span></span><br><span class="line"><span class="keyword">val</span> totalS = <span class="string">&quot;Mississippi&quot;</span>.count(&#123;letter-&gt; <span class="comment">//letter变量</span></span><br><span class="line">    letter ==<span class="string">&#x27;s&#x27;</span><span class="comment">//函数体</span></span><br><span class="line">&#125;)</span><br><span class="line">println(total)</span><br><span class="line">println(totalS)</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//变量的类型是一个匿名函数,一个函数类型的变量</span></span><br><span class="line"><span class="keyword">val</span> helloFunction:()-&gt;String <span class="comment">//任意函数 无传入参数，返回类型String ,都可以 =helloFunction</span></span><br><span class="line">helloFunction = &#123;</span><br><span class="line">    <span class="keyword">val</span> greet = <span class="string">&quot; how  is going. &quot;</span></span><br><span class="line">    <span class="string">&quot;hello girl , <span class="variable">$greet</span> &quot;</span>  <span class="comment">//默认返回这行语句的结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> helloFunction1:()-&gt;String = &#123;<span class="comment">//任意函数 无传入参数，返回类型String ,都可以 =helloFunction</span></span><br><span class="line">    <span class="keyword">val</span> greet = <span class="string">&quot; how is going. &quot;</span></span><br><span class="line">    <span class="keyword">val</span> hah = <span class="string">&quot;haha&quot;</span></span><br><span class="line">    <span class="string">&quot;hello beauty girl, <span class="variable">$greet</span> &quot;</span> <span class="comment">//默认返回这行语句的结果</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(helloFunction())</span><br><span class="line">println(helloFunction1())</span><br></pre></td></tr></table></figure>

<blockquote>
<p>hello girl ,  how  is going.<br>hello beauty girl,  how is going.  </p>
</blockquote>
<h5 id="匿名函数参数"><a href="#匿名函数参数" class="headerlink" title="匿名函数参数"></a>匿名函数参数</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> helloFunction2:(String)-&gt;String = &#123;name-&gt;   <span class="comment">// name传入参数,String参数类型</span></span><br><span class="line">    <span class="keyword">val</span> hah = <span class="string">&quot;haha&quot;</span></span><br><span class="line">    <span class="string">&quot;hello beauty girl, I am <span class="subst">$&#123;name&#125;</span> &quot;</span> <span class="comment">//默认返回这行语句的结果</span></span><br><span class="line">&#125;</span><br><span class="line">println(helloFunction2(<span class="string">&quot;Jon&quot;</span>))</span><br></pre></td></tr></table></figure>



<h5 id="it关键字"><a href="#it关键字" class="headerlink" title="it关键字"></a>it关键字</h5><p>定义只有一个参数的匿名函数时，可以用it来表示参数名。当需要传入两个值参，就不能用了。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> helloFunction3:(String)-&gt;String = &#123;   <span class="comment">// name传入参数,String参数类型, 只有一个参数name可以省略，用it替代</span></span><br><span class="line">    <span class="keyword">val</span> hah = <span class="string">&quot;haha&quot;</span></span><br><span class="line">    <span class="string">&quot;hello beauty girl, I am <span class="subst">$&#123;it&#125;</span> &quot;</span> <span class="comment">//默认返回这行语句的结果</span></span><br><span class="line">&#125;</span><br><span class="line">println(helloFunction3(<span class="string">&quot;John&quot;</span>))</span><br></pre></td></tr></table></figure>

<h5 id="类型推断-1"><a href="#类型推断-1" class="headerlink" title="类型推断"></a>类型推断</h5><p>定义一个变量时，如果已把匿名函数作为变量赋值给它, 就不需要显示指明变量类型了。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> helloFunction4 = &#123;</span><br><span class="line">    <span class="keyword">val</span> holiday = <span class="string">&quot;New Year&quot;</span></span><br><span class="line">    <span class="string">&quot;Happy <span class="variable">$holiday</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">println(helloFunction4())</span><br></pre></td></tr></table></figure>

<p>类型推断也支持带参数的匿名函数，但为了帮助编译器更准确的推断变量类型，匿名函数的参数名和参数类型必须有。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> helloFunction5:(String,<span class="built_in">Int</span>) -&gt; String = &#123;name,year -&gt;</span><br><span class="line">    <span class="keyword">val</span> holiday = <span class="string">&quot;New Year&quot;</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$name</span>  Happy <span class="variable">$holiday</span> <span class="variable">$year</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">println(helloFunction5(<span class="string">&quot;jon&quot;</span>,<span class="number">2023</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用类型推断</span></span><br><span class="line"><span class="keyword">val</span> helloFunction6  = &#123;name:String,year:<span class="built_in">Int</span> -&gt;</span><br><span class="line">    <span class="keyword">val</span> holiday = <span class="string">&quot;New Year&quot;</span></span><br><span class="line">    <span class="string">&quot;<span class="variable">$name</span>  Happy <span class="variable">$holiday</span> <span class="variable">$year</span>&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">println(helloFunction6(<span class="string">&quot;jon&quot;</span>,<span class="number">2023</span>))</span><br></pre></td></tr></table></figure>



<p>匿名函数成为lambda,将它的定义成为lambda表达式，它返回的数据成为lambda结果。</p>
<p>lambda由来：在定义匿名函数时，使用了lambda演算记法。</p>
<h5 id="一个函数作为另一个函数的参数"><a href="#一个函数作为另一个函数的参数" class="headerlink" title="一个函数作为另一个函数的参数"></a>一个函数作为另一个函数的参数</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//定义参数是函数 的函数</span></span><br><span class="line">    <span class="keyword">val</span> disCountWord = &#123; goodsName: String, hour: <span class="built_in">Int</span> -&gt;</span><br><span class="line">        <span class="keyword">val</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">        <span class="string">&quot;<span class="subst">$&#123;currentYear&#125;</span>年, 双11 <span class="subst">$&#123;goodsName&#125;</span>促销倒计时: <span class="variable">$hour</span> 小时&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    showOnBoard(<span class="string">&quot;小玩具&quot;</span>, disCountWord)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//getDiscountWord是第二个参数,类型时是(String, Int) -&gt; String 函数类型</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">showOnBoard</span><span class="params">(goodsName: <span class="type">String</span>, getDiscountWords: (<span class="type">String</span>, <span class="type">Int</span>) -&gt; <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hour = (<span class="number">1.</span><span class="number">.24</span>).shuffled().last();</span><br><span class="line">    print(getDiscountWords(goodsName, hour))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="java实现传递函数"><a href="#java实现传递函数" class="headerlink" title="java实现传递函数"></a>java实现传递函数</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    showOnBoard(<span class="string">&quot;牙膏&quot;</span>,((goodsName, hour) -&gt; &#123;</span><br><span class="line">        <span class="keyword">int</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;%s年，双11 %s 促销倒计时 %d小时 &quot;</span>,currentYear,goodsName,hour);</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DiscountWords</span></span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getDiscountWords</span><span class="params">(String goodsName,<span class="keyword">int</span> hour)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showOnBoard</span><span class="params">(String goodsName,DiscountWords discountWords)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> hour  = <span class="keyword">new</span> Random().nextInt(<span class="number">24</span>);</span><br><span class="line">    System.out.println(discountWords.getDiscountWords(goodsName,hour));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="简略写法"><a href="#简略写法" class="headerlink" title="简略写法"></a>简略写法</h5><p>如果一个函数的lambda函数排在最后，或者是唯一的参数，那么括住的lambda值参的一对圆括号就可以省略.</p>
<p>唯一的参数</p>
<p>AnonymousFunc2.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> totalS = <span class="string">&quot;Mississippi&quot;</span>.count(&#123;letter-&gt; <span class="comment">//letter变量</span></span><br><span class="line">    letter ==<span class="string">&#x27;s&#x27;</span><span class="comment">//函数体</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> totalS1 = <span class="string">&quot;Mississippi&quot;</span>.count&#123;letter-&gt; <span class="comment">//letter变量</span></span><br><span class="line">    letter ==<span class="string">&#x27;s&#x27;</span><span class="comment">//函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>AnonymousFunc2.kt</p>
<p>排在最后,一对圆括号就可以省略</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">showOnBoard(<span class="string">&quot;小玩具&quot;</span>, &#123; goodsName: String, hour: <span class="built_in">Int</span> -&gt;</span><br><span class="line">    <span class="keyword">val</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">    <span class="string">&quot;<span class="subst">$&#123;currentYear&#125;</span>年, 双11 <span class="subst">$&#123;goodsName&#125;</span>促销倒计时: <span class="variable">$hour</span> 小时&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">showOnBoard(<span class="string">&quot;小玩具&quot;</span>) &#123; goodsName: String, hour: <span class="built_in">Int</span> -&gt;</span><br><span class="line">    <span class="keyword">val</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">    <span class="string">&quot;<span class="subst">$&#123;currentYear&#125;</span>年, 双11 <span class="subst">$&#123;goodsName&#125;</span>促销倒计时: <span class="variable">$hour</span> 小时&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>内联函数</p>
<p><img src="/2021/08/19/kotlin-elementary/2021-08-20_lambda_inline.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//定义参数是函数 的函数</span></span><br><span class="line">    <span class="keyword">val</span> disCountWord = (&#123; goodsName: String, hour: <span class="built_in">Int</span> -&gt;</span><br><span class="line">        <span class="keyword">val</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">        <span class="string">&quot;<span class="subst">$&#123;currentYear&#125;</span>年, 双11 <span class="subst">$&#123;goodsName&#125;</span>促销倒计时: <span class="variable">$hour</span> 小时&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    showOnBoard(<span class="string">&quot;小玩具&quot;</span>, disCountWord)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//getDiscountWord是第二个参数,类型时是(String, Int) -&gt; String 函数类型</span></span><br><span class="line"> <span class="function"><span class="keyword">fun</span> <span class="title">showOnBoard</span><span class="params">(goodsName: <span class="type">String</span>, getDiscountWords: (<span class="type">String</span>, <span class="type">Int</span>) -&gt; <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hour = (<span class="number">1.</span><span class="number">.24</span>).shuffled().last();</span><br><span class="line">    println(getDiscountWords(goodsName, hour))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AnonymousFunc2Kt</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Function2 disCountWord = (Function2)<span class="keyword">null</span>.INSTANCE;</span><br><span class="line">      showOnBoard(<span class="string">&quot;小玩具&quot;</span>, disCountWord);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] var0)</span> </span>&#123;</span><br><span class="line">      main();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">showOnBoard</span><span class="params">(<span class="meta">@NotNull</span> String goodsName, <span class="meta">@NotNull</span> Function2 getDiscountWords)</span> </span>&#123;</span><br><span class="line">      Intrinsics.checkNotNullParameter(goodsName, <span class="string">&quot;goodsName&quot;</span>);</span><br><span class="line">      Intrinsics.checkNotNullParameter(getDiscountWords, <span class="string">&quot;getDiscountWords&quot;</span>);</span><br><span class="line">      <span class="keyword">byte</span> var3 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> hour = ((Number)CollectionsKt.last(CollectionsKt.shuffled((Iterable)(<span class="keyword">new</span> IntRange(var3, <span class="number">24</span>))))).intValue();</span><br><span class="line">      Object var5 = getDiscountWords.invoke(goodsName, hour);</span><br><span class="line">      <span class="keyword">boolean</span> var4 = <span class="keyword">false</span>;</span><br><span class="line">      System.out.println(var5);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>内联后，代码直接替换 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AnonymousFunc2Kt</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      Function2 disCountWord = (Function2)<span class="keyword">null</span>.INSTANCE;</span><br><span class="line">      String goodsName$iv = <span class="string">&quot;小玩具&quot;</span>;</span><br><span class="line">      <span class="keyword">int</span> $i$f$showOnBoard = <span class="keyword">false</span>;  </span><br><span class="line">      <span class="keyword">byte</span> var3 = <span class="number">1</span>;	<span class="comment">//这里开始 后面代码直接复制过来了</span></span><br><span class="line">      <span class="keyword">int</span> hour$iv = ((Number)CollectionsKt.last(CollectionsKt.shuffled((Iterable)(<span class="keyword">new</span> IntRange(var3, <span class="number">24</span>))))).intValue();</span><br><span class="line">      Object var6 = disCountWord.invoke(goodsName$iv, hour$iv);</span><br><span class="line">      <span class="keyword">boolean</span> var5 = <span class="keyword">false</span>;</span><br><span class="line">      System.out.println(var6);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// $FF: synthetic method</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] var0)</span> </span>&#123;</span><br><span class="line">      main();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">showOnBoard</span><span class="params">(<span class="meta">@NotNull</span> String goodsName, <span class="meta">@NotNull</span> Function2 getDiscountWords)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> $i$f$showOnBoard = <span class="number">0</span>;</span><br><span class="line">      Intrinsics.checkNotNullParameter(goodsName, <span class="string">&quot;goodsName&quot;</span>);</span><br><span class="line">      Intrinsics.checkNotNullParameter(getDiscountWords, <span class="string">&quot;getDiscountWords&quot;</span>);</span><br><span class="line">      <span class="keyword">byte</span> var4 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">int</span> hour = ((Number)CollectionsKt.last(CollectionsKt.shuffled((Iterable)(<span class="keyword">new</span> IntRange(var4, <span class="number">24</span>))))).intValue();</span><br><span class="line">      Object var6 = getDiscountWords.invoke(goodsName, hour);</span><br><span class="line">      <span class="keyword">boolean</span> var5 = <span class="keyword">false</span>;</span><br><span class="line">      System.out.println(var6);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="函数引用"><a href="#函数引用" class="headerlink" title="函数引用"></a>函数引用</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//函数引用</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    showOnBoard(<span class="string">&quot;小玩具&quot;</span>,::getDiscountWords)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//普通 具名函数</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">getDiscountWords</span><span class="params">(goodsName: <span class="type">String</span>, hour: <span class="type">Int</span>)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">val</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;<span class="subst">$&#123;currentYear&#125;</span>年, 双11 <span class="subst">$&#123;goodsName&#125;</span>促销倒计时: <span class="variable">$hour</span> 小时&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getDiscountWord是第二个参数,类型时是(String, Int) -&gt; String 函数类型</span></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">showOnBoard</span><span class="params">(goodsName: <span class="type">String</span>, getDiscountWords: (<span class="type">String</span>, <span class="type">Int</span>) -&gt; <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> hour = (<span class="number">1.</span><span class="number">.24</span>).shuffled().last();</span><br><span class="line">    println(getDiscountWords(goodsName, hour))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>函数类型作为返回类型</p>
<p>函数类型也是有效的返回类型，也就是说可以定义一个能返回函数的函数。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> getDiscountWords = configDiscountWords()</span><br><span class="line">    println(getDiscountWords(<span class="string">&quot;小玩具&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">configDiscountWords</span><span class="params">()</span></span>: (String) -&gt; String &#123;<span class="comment">//返回一个传入字符串 返回类型也是函数的字符串,的返回类型</span></span><br><span class="line">    <span class="keyword">val</span> currentYear = <span class="number">2023</span>;</span><br><span class="line">    <span class="keyword">val</span> hour = (<span class="number">1.</span><span class="number">.24</span>).shuffled().last();</span><br><span class="line">    <span class="keyword">return</span> &#123; goodsName: String -&gt;</span><br><span class="line">        <span class="string">&quot;<span class="subst">$&#123;currentYear&#125;</span>年, 双11 <span class="subst">$&#123;goodsName&#125;</span>促销倒计时: <span class="variable">$hour</span> 小时&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h5><p>作用: 控制作用域</p>
<p>匿名函数引用着定义自身函数里的变量</p>
<p>kotlin中的lambda就是闭包,上面</p>
<ol>
<li>currentYear,hour    在configDiscountWords()中定义</li>
<li>{ goodsName: String -&gt;  “${currentYear}年, 双11 ${goodsName}促销倒计时: $hour 小时}  也在configDiscountWords()定义</li>
<li> 2 引用了currentYear,hour变量. 所以形成闭包</li>
</ol>
<img src="/2021/08/19/kotlin-elementary/Users/m/Documents/noteforme.github.io/source/_posts/kotlin-elementary/2021-08-20_Closure.png" style="zoom:66%;">

<p><a href="https://www.bilibili.com/video/BV1wf4y1s7TG?p=34&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1wf4y1s7TG?p=34&amp;spm_id_from=pageDriver</a></p>
<h3 id="Null"><a href="#Null" class="headerlink" title="Null"></a>Null</h3><p>编译时出错的方式，提前在编译期强迫开发者重视起来，而不是等到运行时报错。</p>
<h5 id=""><a href="#" class="headerlink" title="?"></a>?</h5><p>变量为null，不会执行后面的方法</p>
<p>let匿名函数，返回lambda最后一行</p>
<p>可以支持函数链式调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">var</span> str:String? = <span class="string">&quot;butterfly&quot;</span></span><br><span class="line"><span class="comment">//    var str=&quot;&quot;</span></span><br><span class="line">    str = str?.let &#123;</span><br><span class="line">        <span class="keyword">if</span> (it.isNotBlank())&#123;</span><br><span class="line">            it.capitalize()</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="string">&quot;butterfly&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    println(str)</span><br></pre></td></tr></table></figure>



<h5 id="-1"><a href="#-1" class="headerlink" title="!!"></a>!!</h5><p>当变量为null,会抛出KotlinNullPointerException</p>
<h5 id="空合并操作符"><a href="#空合并操作符" class="headerlink" title="空合并操作符  ?:"></a>空合并操作符  ?:</h5><p>类似三目运算符</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">str=<span class="literal">null</span></span><br><span class="line">str=<span class="string">&quot;guy&quot;</span></span><br><span class="line">str = str?.let &#123; it.capitalize()&#125; ?:<span class="string">&quot;butterfly&quot;</span>	<span class="comment">//和let一起使用</span></span><br><span class="line">println(str ?: <span class="string">&quot;girl&quot;</span>) <span class="comment">// str=null,就是girl,不为null就是自己</span></span><br></pre></td></tr></table></figure>





<h5 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h5><p>执行之前，先进行检查，可以自定义异常</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> number: <span class="built_in">Int</span>? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        checkOperation(number)</span><br><span class="line">        number!!.plus(<span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e: Exception) &#123;</span><br><span class="line">        println(e)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">checkOperation</span><span class="params">(number: <span class="type">Int</span>?)</span></span> &#123;</span><br><span class="line">    number ?: <span class="keyword">throw</span>  UnskilledException()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//自定义异常</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnskilledException</span> : <span class="type">IllegalArgumentException</span></span>(<span class="string">&quot;操作不当&quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="先决条件函数"><a href="#先决条件函数" class="headerlink" title="先决条件函数"></a>先决条件函数</h5><p>kotlin标准库 提供了一些便利函数，使用这些内置函数，可以跑出带自定义信息的异常，这些便利函数叫做先决条件函数。也可以用它定义先决条件，条件必须满足，目标代码才能执行。</p>
<img src="/2021/08/19/kotlin-elementary/2021-08-21_kotlin_suggest.png" style="zoom:50%;">

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">checkOperation</span><span class="params">(number: <span class="type">Int</span>?)</span></span> &#123;</span><br><span class="line"><span class="comment">//    number ?: throw  UnskilledException()</span></span><br><span class="line">    checkNotNull(number,&#123;<span class="string">&quot;Something is no good.&quot;</span>&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>String.kt</p>
<h5 id="substring"><a href="#substring" class="headerlink" title="substring"></a>substring</h5><p>substring支持IntRange类型的参数，until创建的范围不包括上限值。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">val</span> NAME =<span class="string">&quot;Jimmy&#x27;s friend&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> index = NAME.indexOf(<span class="string">&#x27;\&#x27;&#x27;</span>) <span class="comment">// \转义 &#x27;</span></span><br><span class="line">    NAME.substring(<span class="number">0</span>,index) <span class="comment">// java写法</span></span><br><span class="line">    <span class="keyword">val</span> str = NAME.substring(<span class="number">0</span> until index)</span><br><span class="line">    println(str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="spilt"><a href="#spilt" class="headerlink" title="spilt"></a>spilt</h5><p>siilt返回的是List集合数据，List集合又支持解构语法特性，它允许你在一个表达式里给多个变量赋值，解构常用来简化变量的赋值。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="keyword">data</span> = NAMES.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> (girl1,girl2,girl3,girl4) = NAMES.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">println(<span class="string">&quot;<span class="variable">$girl1</span>  <span class="variable">$girl2</span>  <span class="variable">$girl3</span>  <span class="variable">$girl4</span> &quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="replcae"><a href="#replcae" class="headerlink" title="replcae"></a>replcae</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加密替换一个字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">val</span> str1  = <span class="string">&quot;The people&#x27;s Republic of China.&quot;</span></span><br><span class="line">    <span class="comment">//第一个参数是正则表达式，用来决定要替换哪些字符</span></span><br><span class="line">    <span class="comment">//第二个参数是匿名函数，用来确定如何替换正则表达式搜索到的字符</span></span><br><span class="line"><span class="keyword">val</span> str2 = str1.replace(Regex(<span class="string">&quot;[aeiou]&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">when</span> (it.value) &#123;</span><br><span class="line">        <span class="string">&quot;a&quot;</span> -&gt; <span class="string">&quot;8&quot;</span></span><br><span class="line">        <span class="string">&quot;e&quot;</span> -&gt; <span class="string">&quot;6&quot;</span></span><br><span class="line">        <span class="string">&quot;i&quot;</span> -&gt; <span class="string">&quot;9&quot;</span></span><br><span class="line">        <span class="string">&quot;o&quot;</span> -&gt; <span class="string">&quot;1&quot;</span></span><br><span class="line">        <span class="string">&quot;u&quot;</span> -&gt; <span class="string">&quot;3&quot;</span></span><br><span class="line">        <span class="keyword">else</span> -&gt; it.value</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">println(str1)</span><br><span class="line">println(str2)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>The people’s Republic of China.<br>Th6 p61pl6’s R6p3bl9c 1f Ch9n8.</p>
</blockquote>
<h5 id="字符串的比较"><a href="#字符串的比较" class="headerlink" title="字符串的比较"></a>字符串的比较</h5><p>用 == 检查两个字符串中的字符是否匹配， 用 === 检查两个变量是否指向内存堆上的同一对象， 而在Java中 ==做引用比较，做结构比较时用equals方法.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> str3 = <span class="string">&quot;Jason&quot;</span></span><br><span class="line"><span class="keyword">val</span> str4 = <span class="string">&quot;Jason&quot;</span></span><br><span class="line">println(str3==str4)</span><br><span class="line">println(str3===str4) <span class="comment">//相同字符串的字符串，使用字符串常量池中相同的对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> str5 = <span class="string">&quot;jason&quot;</span>.capitalize() <span class="comment">//这种情况会创建新的对象，why?</span></span><br><span class="line">println(str3===str5)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>true<br>true<br>false</p>
</blockquote>
<h5 id="字符串遍历"><a href="#字符串遍历" class="headerlink" title="字符串遍历"></a>字符串遍历</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">str1.forEach &#123;</span><br><span class="line">    print(<span class="string">&quot;<span class="variable">$it</span> &quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="数字类型"><a href="#数字类型" class="headerlink" title="数字类型"></a>数字类型</h3><p>kotlin所有的数字类型都是有符号的，也就是既可以表示正数，也可以表示负数。</p>
<p><img src="/2021/08/19/kotlin-elementary/2021-08-21_data_type.png"></p>
<h5 id="安全转换函数"><a href="#安全转换函数" class="headerlink" title="安全转换函数"></a>安全转换函数</h5><p>NumberConvert</p>
<p>toDoubleOrNull和toIntOrNull这样的安全转换函数，如果数值不能正确转换，与其触发异常不如干脆返回null值。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//    val number1 = &quot;6.66&quot;.toInt()</span></span><br><span class="line">    <span class="keyword">val</span> number1:<span class="built_in">Int</span>? = <span class="string">&quot;6.66&quot;</span>.toIntOrNull()</span><br><span class="line">    println(number1)</span><br><span class="line"></span><br><span class="line">    println(<span class="number">8.956765</span>.toInt())</span><br><span class="line">    println(<span class="number">8.956765</span>.roundToInt()) <span class="comment">//四舍五入</span></span><br><span class="line">    <span class="keyword">val</span> s = <span class="string">&quot;%.2f&quot;</span>.format(<span class="number">8.956765</span>)</span><br><span class="line">    println(s)</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>null<br>8<br>9<br>8.96</p>
</blockquote>
<h3 id="标准库函数"><a href="#标准库函数" class="headerlink" title="标准库函数"></a>标准库函数</h3><p>StandLibFunc.kt</p>
<h5 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h5><p>apply函数可看作一个配置函数，传入一个接收者，然后调用一系列的函数来配置它以便使用，如果提供lambda给apply函数执行，它会返回配置好的接收者。</p>
<p>配置file对象，传入file对象配置它，配置完file对象返回.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 配置一个File实例</span></span><br><span class="line"><span class="keyword">val</span> file = File(<span class="string">&quot;E// I have a dream.txt&quot;</span>)</span><br><span class="line">file.setReadable(<span class="literal">true</span>)</span><br><span class="line">file.setWritable(<span class="literal">true</span>)</span><br><span class="line">file.setExecutable(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用apply</span></span><br><span class="line"><span class="keyword">val</span> file1 = File(<span class="string">&quot;E// I have a dream.txt&quot;</span>).apply &#123;</span><br><span class="line">    setReadable(<span class="literal">true</span>)</span><br><span class="line">    setWritable(<span class="literal">true</span>)</span><br><span class="line">    setExecutable(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lambda表达式里，apply能让每个配置函数都作用于接收者，这种行为又叫相关作用于，因为lambda表达式里的所有函数调用都是针对接收者的，或者说他们是针对接收者的隐式调用。</p>
<h5 id="let"><a href="#let" class="headerlink" title="let"></a>let</h5><p>let函数能是某个便利作用于lambda表达式里，让it关键字能引用它。let与apply比较，let会把接收者传给lambda，而apply什么都不传，匿名函数执行完，apply会发挥当前接收者，而let会返回lambda的最后一行。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">var</span> result = listOf(<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>).first().let &#123; it * it &#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    val firstElement = listOf(3, 2, 1).first() //java 方式 </span></span><br><span class="line"><span class="comment">//    val result = firstElement * firstElement</span></span><br><span class="line"></span><br><span class="line">    println(formatGreeting(<span class="literal">null</span>))</span><br><span class="line">    println(formatGreeting(<span class="string">&quot;Jack&quot;</span>))</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">formatGreeting</span><span class="params">(guestNmae: <span class="type">String</span>?)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> guestNmae?.let &#123;</span><br><span class="line">        <span class="string">&quot;Welcom, <span class="variable">$it</span>&quot;</span></span><br><span class="line">    &#125; ?: <span class="string">&quot;What&#x27;s your name&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Java方式</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">formatGreeting2</span><span class="params">(guestNmae: <span class="type">String</span>?)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (guestNmae != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="string">&quot;Welcom, <span class="variable">$guestNmae</span>&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="string">&quot;What&#x27;s your name&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="run"><a href="#run" class="headerlink" title="run"></a>run</h5><ol>
<li>光看作用域行为， run和apply差不多，但与apply不同，run函数不返回接收者，run返回的是lambda结果.</li>
<li>run也能用来执行函数引用å</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> file = File(<span class="string">&quot;THINKKOTLIN/I have a dream.txt&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> result = file.run &#123;</span><br><span class="line">    readText().contains(<span class="string">&quot;great&quot;</span>) <span class="comment">//最后一行执行结果返回</span></span><br><span class="line">    <span class="string">&quot;xxx&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">println(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> result2 = <span class="string">&quot;The people&#x27;s Republic of china.&quot;</span>.run(::isLong)</span><br><span class="line">println(result2)</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;The people&#x27;s Republic of china.&quot;</span></span><br><span class="line">        .run(::isLong)</span><br><span class="line">        .run(::showMessage)</span><br><span class="line">        .run(::println)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">isLong</span><span class="params">(name: <span class="type">String</span>)</span></span> = name.length&gt;<span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">showMessage</span><span class="params">(isLong: <span class="type">Boolean</span>)</span></span>: String &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span>(isLong)&#123;</span><br><span class="line">        <span class="string">&quot;Name is too long.&quot;</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="string">&quot;Please rename.&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="with"><a href="#with" class="headerlink" title="with"></a>with</h5><p>with函数是run的变体，他们的功能行为是一样的，但with的调用方式不同，调用with时需要值参作为其第一个参数传入。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> result3 = <span class="string">&quot;The people&#x27;s Republic of china.&quot;</span>.run &#123; length &gt; <span class="number">10</span> &#125;</span><br><span class="line"><span class="keyword">val</span> result4 = with(<span class="string">&quot;The people&#x27;s Republic of china.&quot;</span>) &#123; length &gt;= <span class="number">10</span> &#125;</span><br></pre></td></tr></table></figure>



<h5 id="also"><a href="#also" class="headerlink" title="also"></a>also</h5><p>​    also和let类似，和let一样，also也是把接收者作为值参传给lambda,但是有点不同: also返回接收者对象，而let返回lambda结果。因此also适合针对<strong>同一原始对象</strong>，利用副作用做事，肌肉also返回的是接收者对象，就可以<strong>基于原始接收者对象执行额外的链式调用</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> fileContents: List&lt;String&gt;</span><br><span class="line">File(FILE_DREAM)</span><br><span class="line">        .also &#123;</span><br><span class="line">            println(it.name)</span><br><span class="line">        &#125;.also &#123;</span><br><span class="line">            fileContents = it.readLines()</span><br><span class="line">        &#125;</span><br><span class="line">println(fileContents)</span><br></pre></td></tr></table></figure>



<h5 id="takeif"><a href="#takeif" class="headerlink" title="takeif"></a>takeif</h5><p><img src="/2021/08/19/kotlin-elementary/2021-08-21_takeif.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//如果 it.exists() &amp;&amp; it.canRead() 返回true,返回file对象，接着执行后面语句。</span></span><br><span class="line"><span class="comment">// 如果为false，就返回null,就不会执行后面的语句。</span></span><br><span class="line"><span class="keyword">val</span> readText = File(FILE_DREAM)</span><br><span class="line">        .takeIf &#123; it.exists() &amp;&amp; it.canRead() &#125; </span><br><span class="line">        ?.readText()</span><br><span class="line">println(readText)</span><br></pre></td></tr></table></figure>



<h5 id="takeUnless"><a href="#takeUnless" class="headerlink" title="takeUnless"></a>takeUnless</h5><p>和takeif是反的</p>
<p>takeUnless, 只有判断你给定的条件结果是 false 时，takeUnless才会返回原始接收者对象。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> result5 = File(FILE_DREAM)</span><br><span class="line">        .takeUnless &#123; it.isHidden &#125; <span class="comment">//不是 不可见的，所以是false</span></span><br><span class="line">        ?.readText()</span><br><span class="line">println(result5)</span><br></pre></td></tr></table></figure>



<h5 id="flatmap"><a href="#flatmap" class="headerlink" title="flatmap"></a>flatmap</h5><blockquote>
<p> ArrayList<ServicesBean> 转成 ArrayList<CategoryEditService></CategoryEditService></ServicesBean></p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> flatMap = limitServiceList?.flatMap &#123;</span><br><span class="line">    mutableListOf(CategoryEditService(<span class="literal">false</span>, services = it))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">&#123; mutableListOf(CategoryEditService(<span class="literal">false</span>, services = <span class="literal">it</span>))&#125; 这个是一个方法，</span><br><span class="line">方法类型是transform: <span class="function"><span class="params">(T)</span> -&gt;</span> Iterable&lt;R&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Returns a single list of all elements yielded from results of [transform] function being invoked on each element of original collection.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@sample</span> samples.collections.Collections.Transformations.flatMap</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">flatMap</span><span class="params">(transform: (<span class="type">T</span>) -&gt; <span class="type">Iterable</span>&lt;<span class="type">R</span>&gt;)</span></span>: List&lt;R&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> flatMapTo(ArrayList&lt;R&gt;(), transform)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Appends all elements yielded from results of [transform] function being invoked on each element of original collection, to the given [destination].</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R, C : MutableCollection&lt;in R&gt;</span>&gt; Iterable<span class="type">&lt;T&gt;</span>.<span class="title">flatMapTo</span><span class="params">(destination: <span class="type">C</span>, transform: (<span class="type">T</span>) -&gt; <span class="type">Iterable</span>&lt;<span class="type">R</span>&gt;)</span></span>: C &#123;</span><br><span class="line">    <span class="keyword">for</span> (element <span class="keyword">in</span> <span class="keyword">this</span>) &#123;<span class="comment">//这里this是limitServiceList.</span></span><br><span class="line">        <span class="keyword">val</span> list = transform(element) <span class="comment">// 这里回调&#123;mutableListOf(CategoryEditService(false, services = it))&#125;方法</span></span><br><span class="line">      																<span class="comment">// 传入element值，返回list</span></span><br><span class="line">        destination.addAll(list)	<span class="comment">//添加新的对象,达到转换的目的</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin-medium</title>
    <url>/2021/08/21/kotlin-medium/</url>
    <content><![CDATA[<h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>List.kt</p>
<h5 id="List创建与元素获取"><a href="#List创建与元素获取" class="headerlink" title="List创建与元素获取"></a>List创建与元素获取</h5><p><img src="/2021/08/21/kotlin-medium/2021-08-21_getelseif.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> list = listOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>)</span><br><span class="line">println(list.getOrElse(<span class="number">3</span>) &#123; <span class="string">&quot;Unknown&quot;</span> &#125;)</span><br><span class="line">println(list.getOrNull(<span class="number">3</span>))</span><br><span class="line">println(list.getOrNull(<span class="number">3</span>) ?: <span class="string">&quot;Unknown&quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="可变列表"><a href="#可变列表" class="headerlink" title="可变列表"></a>可变列表</h5><p><img src="/2021/08/21/kotlin-medium/2021-08-21_16-57-45_mutable.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> mutableList = mutableListOf(<span class="string">&quot;Jason&quot;</span>, <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;girl1&quot;</span>)</span><br><span class="line">mutableList.add(<span class="string">&quot;Jimmy&quot;</span>)</span><br><span class="line">mutableList.remove(<span class="string">&quot;Jack&quot;</span>)</span><br><span class="line">println(mutableList)</span><br><span class="line"></span><br><span class="line">list.toMutableList() <span class="comment">// 不可变转可变</span></span><br><span class="line">mutableList.toList() <span class="comment">// 可变转不可变</span></span><br></pre></td></tr></table></figure>



<h5 id="mutator函数"><a href="#mutator函数" class="headerlink" title="mutator函数"></a>mutator函数</h5><p><img src="/2021/08/21/kotlin-medium/2021-08-21_17-01-19_mutaber.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">mutableList += <span class="string">&quot;John&quot;</span></span><br><span class="line">mutableList -= <span class="string">&quot;girl1&quot;</span></span><br><span class="line">mutableList.removeIf&#123;it.contains(<span class="string">&quot;Jack&quot;</span>)&#125; <span class="comment">//包含Jack就把 Jack移除</span></span><br><span class="line">println(mutableList)</span><br></pre></td></tr></table></figure>



<h5 id="集合遍历"><a href="#集合遍历" class="headerlink" title="集合遍历"></a>集合遍历</h5><ol>
<li>for in</li>
<li>forEach</li>
<li>forEachIndexed遍历时要获取索引</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (s <span class="keyword">in</span> list)&#123;</span><br><span class="line">    println(s)</span><br><span class="line">&#125;</span><br><span class="line">list.forEach&#123;</span><br><span class="line">    println(it)</span><br><span class="line">&#125;</span><br><span class="line">list.forEachIndexed&#123;index,item-&gt;</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$index</span>  <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h5><p>通过_符号过滤不想要的元素</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//    val(girl1,girl2,girl3) = list</span></span><br><span class="line">    <span class="keyword">val</span>(girl1,_,girl3) = list   <span class="comment">//如果不需要girl2,用_，这个字节码也不会取出</span></span><br></pre></td></tr></table></figure>



<h4 id="Set集合"><a href="#Set集合" class="headerlink" title="Set集合"></a>Set集合</h4><h5 id="elementAt获取元素"><a href="#elementAt获取元素" class="headerlink" title="elementAt获取元素"></a>elementAt获取元素</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="keyword">set</span> = setOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>)</span><br><span class="line">println(<span class="keyword">set</span>.elementAt(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> mutableSet = mutableSetOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>)</span><br><span class="line">mutableSet += <span class="string">&quot;girl5&quot;</span></span><br></pre></td></tr></table></figure>



<h5 id="List去重"><a href="#List去重" class="headerlink" title="List去重"></a>List去重</h5><p>通过toSet去重</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> list = mutableSetOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>).toSet().toList()</span><br><span class="line">println(list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> distinct = mutableSetOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>).distinct()</span><br><span class="line">println(distinct)</span><br></pre></td></tr></table></figure>



<h5 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h5><p> kotlin提供了各种Array,虽然是引用类型，但最终编译成Java基本数据类型</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> intArray = intArrayOf(<span class="number">10</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line">listOf(<span class="number">10</span>, <span class="number">30</span>, <span class="number">40</span>).toIntArray()</span><br><span class="line"><span class="keyword">val</span> array = arrayOf(File(<span class="string">&quot;xxx&quot;</span>), File(<span class="string">&quot;yyyy&quot;</span>))</span><br></pre></td></tr></table></figure>



<p><img src="/2021/08/21/kotlin-medium/2021-08-21_17-32-32_array.png"></p>
<h4 id="Map集合"><a href="#Map集合" class="headerlink" title="Map集合"></a>Map集合</h4><p><img src="/2021/08/21/kotlin-medium/2021-08-21_17-51-48_map_read.png"></p>
<h5 id="map获取"><a href="#map获取" class="headerlink" title="map获取"></a>map获取</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">println(map[<span class="string">&quot;lucy1&quot;</span>])</span><br><span class="line">println(map.getValue(<span class="string">&quot;lucy2&quot;</span>))</span><br><span class="line">println(map.getOrElse(<span class="string">&quot;Jon&quot;</span>)&#123;<span class="string">&quot;Unknown&quot;</span>&#125;) <span class="comment">//没有Jon，返回Unknown</span></span><br><span class="line">println(map.getOrDefault(<span class="string">&quot;Jon&quot;</span>,<span class="number">0</span>)) <span class="comment">//没有Jon，返回默认值0</span></span><br></pre></td></tr></table></figure>



<h5 id="map遍历"><a href="#map遍历" class="headerlink" title="map遍历"></a>map遍历</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">map.forEach&#123;</span><br><span class="line">    println(<span class="string">&quot;<span class="subst">$&#123;it.key&#125;</span>, <span class="subst">$&#123;it.value&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">map.forEach&#123;(key:String,value:<span class="built_in">Int</span>)-&gt;</span><br><span class="line">    println(<span class="string">&quot;<span class="subst">$&#123;key&#125;</span>, <span class="subst">$&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="mutableMap"><a href="#mutableMap" class="headerlink" title="mutableMap"></a>mutableMap</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> mutableMap = mutableMapOf(<span class="string">&quot;lucy1&quot;</span> to <span class="number">18</span>, <span class="string">&quot;lucy2&quot;</span> to <span class="number">19</span>, <span class="string">&quot;lucy3&quot;</span> to <span class="number">20</span>)</span><br><span class="line">mutableMap += <span class="string">&quot;jon&quot;</span> to <span class="number">22</span></span><br><span class="line">mutableMap.put(<span class="string">&quot;jon2&quot;</span>,<span class="number">35</span>)</span><br><span class="line">mutableMap.getOrPut(<span class="string">&quot;Rose&quot;</span>)&#123;<span class="number">30</span>&#125; <span class="comment">// 如果没有Rose,就添加进来</span></span><br><span class="line">println(mutableMap)</span><br></pre></td></tr></table></figure>



<h3 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h3><p><img src="/2021/08/21/kotlin-medium/2021-08-211_8-32-51_field_class.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">Class Player&#123;</span><br><span class="line">	<span class="keyword">var</span> name:String? = <span class="string">&quot;jack&quot;</span> <span class="comment">// 编译后生成了get. set方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = Player()</span><br><span class="line">  p.name = <span class="string">&quot;rose&quot;</span> <span class="comment">//编译生成了 setName方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: String = <span class="string">&quot;jack&quot;</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value.trim()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算属性是通过一个覆盖的get或set运算符来定义，这时field就不需要了。</span></span><br><span class="line">    <span class="keyword">val</span> rolledValue</span><br><span class="line">        <span class="keyword">get</span>() = (<span class="number">1.</span><span class="number">.6</span>).shuffled().first()</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="防范竞态条件"><a href="#防范竞态条件" class="headerlink" title="防范竞态条件"></a>防范竞态条件</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//    如果一个类属性即可空又可变，那么引用它之前必须保证它非空，一个办法是用also标准函数</span></span><br><span class="line">    <span class="keyword">var</span> words:String? = <span class="string">&quot;hello&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">saySomething</span><span class="params">()</span></span>&#123;</span><br><span class="line">        words?.also &#123; </span><br><span class="line">            println(<span class="string">&quot;Hello <span class="subst">$&#123;it.uppercase()&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        _age: <span class="built_in">Int</span>,</span><br><span class="line">        _isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">var</span> age = _age <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = age.absoluteValue</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value.absoluteValue</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">var</span> isNormal = _isNormal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Student(<span class="string">&quot;john&quot;</span>, <span class="number">19</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//    p.name = &quot;rose&quot; //Cannot assign to &#x27;name&#x27;: the setter is private in &#x27;Student&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="主构造函数里定义属性"><a href="#主构造函数里定义属性" class="headerlink" title="主构造函数里定义属性"></a>主构造函数里定义属性</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student2</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>,</span><br><span class="line">        <span class="keyword">val</span> isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Student2(<span class="string">&quot;john&quot;</span>, <span class="number">19</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//    p.name = &quot;rose&quot; //Cannot assign to &#x27;name&#x27;: the setter is private in &#x27;Student&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="次构造函数"><a href="#次构造函数" class="headerlink" title="次构造函数"></a>次构造函数</h5><p>Student2.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(_name:String):<span class="keyword">this</span>(_name,age=<span class="number">100</span>,isNormal = <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">constructor</span>(_name:String,age: <span class="built_in">Int</span>):<span class="keyword">this</span>(_name,age=<span class="number">100</span>,isNormal = <span class="literal">false</span>)&#123; <span class="comment">//定义初始化代码逻辑</span></span><br><span class="line">    <span class="keyword">this</span>.name = name.uppercase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> p2 = Student2(<span class="string">&quot;Rose&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> p3 = Student2(<span class="string">&quot;Rose&quot;</span>,<span class="number">20</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="构造函数给默认值"><a href="#构造函数给默认值" class="headerlink" title="构造函数给默认值"></a>构造函数给默认值</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student3</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">20</span>,</span><br><span class="line">        <span class="keyword">val</span> isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Student3(isNormal = <span class="literal">false</span>, _name = <span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="初始化块"><a href="#初始化块" class="headerlink" title="初始化块"></a>初始化块</h5><p>初始化块可以设置变量或值，以及执行有效性检查，如果检查传给某构造函数的值是否有效，<strong>初始化块代码会在构造类实例时执行</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student3</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">20</span>,</span><br><span class="line">        <span class="keyword">val</span> isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>&#123;</span><br><span class="line">        require(age&gt;<span class="number">0</span>)&#123;<span class="string">&quot;age must be positive&quot;</span>&#125;</span><br><span class="line">        require(name.isNotBlank())&#123;<span class="string">&quot;player must have a name.&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Student3(isNormal = <span class="literal">false</span>, _name = <span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">    Student3(isNormal = <span class="literal">false</span>, _name = <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="初始化顺序"><a href="#初始化顺序" class="headerlink" title="初始化顺序"></a>初始化顺序</h5><ol>
<li>主构造函数里声明的属性</li>
<li>类级别的属性赋值</li>
<li>Init初始化块里的属性赋值和函数调用</li>
<li>次构造函数里的属性赋值和函数调用</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student4</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>	 <span class="comment">//age 主构造函数里声明的属性</span></span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name	<span class="comment">//类级别的属性赋值 	name , score, hobby</span></span><br><span class="line">    <span class="keyword">var</span> score = <span class="number">10</span>;	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> hobby = <span class="string">&quot;music&quot;</span> </span><br><span class="line">    <span class="keyword">val</span> subject:String</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;initializing student&quot;</span>)	</span><br><span class="line">        subject = <span class="string">&quot;english&quot;</span>			<span class="comment">//Init初始化块里的属性赋值和函数调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(_name: String):<span class="keyword">this</span>(_name,<span class="number">10</span>)&#123;</span><br><span class="line">        score = <span class="number">20</span>		<span class="comment">//次构造函数里的属性赋值和函数调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Student4(<span class="string">&quot;jon&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>反编译字节码后</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student4</span><span class="params">(<span class="meta">@NotNull</span> String _name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">   Intrinsics.checkNotNullParameter(_name, <span class="string">&quot;_name&quot;</span>);</span><br><span class="line">   <span class="keyword">super</span>();</span><br><span class="line">   <span class="keyword">this</span>.age = age;			<span class="comment">//主构造函数里声明的属性</span></span><br><span class="line">   <span class="keyword">this</span>.name = _name;		<span class="comment">//类级别的属性赋值	name , score, hobby</span></span><br><span class="line">   <span class="keyword">this</span>.score = <span class="number">10</span>;			</span><br><span class="line">   <span class="keyword">this</span>.hobby = <span class="string">&quot;music&quot;</span>;</span><br><span class="line">   String var3 = <span class="string">&quot;initializing student&quot;</span>; 		<span class="comment">//Init初始化块里的属性赋值和函数调用</span></span><br><span class="line">   <span class="keyword">boolean</span> var4 = <span class="keyword">false</span>;</span><br><span class="line">   System.out.println(var3);</span><br><span class="line">   <span class="keyword">this</span>.subject = <span class="string">&quot;english&quot;</span>;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student4</span><span class="params">(<span class="meta">@NotNull</span> String _name)</span> </span>&#123;  <span class="comment">//调用这个构造方法</span></span><br><span class="line">   Intrinsics.checkNotNullParameter(_name, <span class="string">&quot;_name&quot;</span>);</span><br><span class="line">   <span class="keyword">this</span>(_name, <span class="number">10</span>); </span><br><span class="line">   <span class="keyword">this</span>.score = <span class="number">20</span>;			<span class="comment">//次构造函数里的属性赋值和函数调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/21/kotlin-medium/2021-08-21_20-07-53_class_init_order.png"></p>
<h5 id="延迟初始化"><a href="#延迟初始化" class="headerlink" title="延迟初始化"></a>延迟初始化</h5><p><img src="/2021/08/21/kotlin-medium/2021-08-21_8.18.35_lateinit.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> equipment:String</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">ready</span><span class="params">()</span></span>&#123;</span><br><span class="line">        equipment = <span class="string">&quot;sharp knife&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">battle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (::equipment.isInitialized) println(equipment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Player4()</span><br><span class="line">    p.ready()</span><br><span class="line">    p.battle()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="惰性初始化"><a href="#惰性初始化" class="headerlink" title="惰性初始化"></a>惰性初始化</h5><p>延迟初始化并不是推后初始化的唯一方式，也可以暂时不初始化某个变量，<strong>直到首次使用它才初始化</strong>，这个叫做惰性初始化。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player5</span></span>(_name: String) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> config <span class="keyword">by</span> lazy &#123; loadConfig() &#125; <span class="comment">// 懒汉式</span></span><br><span class="line"><span class="comment">//    val config = loadConfig()   //饿汉式</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadConfig</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        println(<span class="string">&quot;loading...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;beauty girl&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Player5(<span class="string">&quot;girl&quot;</span>)</span><br><span class="line">    Thread.sleep(<span class="number">5000</span>)</span><br><span class="line">    println(p.config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Java不会有这种陷阱</p>
<h5 id="初始化陷阱1"><a href="#初始化陷阱1" class="headerlink" title="初始化陷阱1"></a>初始化陷阱1</h5><p>顺序非常重要，必须保证块中的所有属性已完成初始化</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">init</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> bloodBonus = blood.times(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> blood  = <span class="number">100</span> <span class="comment">//必须保证块中的所有属性已完成初始化</span></span><br></pre></td></tr></table></figure>



<h5 id="初始化陷阱2"><a href="#初始化陷阱2" class="headerlink" title="初始化陷阱2"></a>初始化陷阱2</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player7</span> </span>&#123;</span><br><span class="line">   <span class="keyword">val</span> name:String <span class="comment">//类级别属性</span></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span>  <span class="title">firstLetter</span><span class="params">()</span></span> = name[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(firstLetter())</span><br><span class="line">        name= <span class="string">&quot;john&quot;</span>    <span class="comment">//初始化块代码排第三</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Player7()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="初始化陷阱3"><a href="#初始化陷阱3" class="headerlink" title="初始化陷阱3"></a>初始化陷阱3</h5><p>initPlayerName() 初始化 playerName时，name属性还未完初始化。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InitTrapTest3</span></span>(_name:String) &#123;</span><br><span class="line">    <span class="keyword">val</span> playerName:String = initPlayerName()</span><br><span class="line">    <span class="keyword">val</span> name:String = _name     <span class="comment">//这个要放第一句</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initPlayerName</span><span class="params">()</span></span> = name</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   println(InitTrapTest3(<span class="string">&quot;John&quot;</span>).playerName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin-object</title>
    <url>/2021/08/21/kotlin-object/</url>
    <content><![CDATA[<p>object目录下</p>
<h3 id="对象相关"><a href="#对象相关" class="headerlink" title="对象相关"></a>对象相关</h3><h5 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h5><p>类默认是封闭的，要让某个类开放继承，必须使用opem关键字修饰它</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>(<span class="keyword">val</span> name:String) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">description</span><span class="params">()</span></span> = <span class="string">&quot;Product: <span class="variable">$name</span>&quot;</span></span><br><span class="line">   <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">&quot;Nothing..&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LuxuryProduct</span> : <span class="type">Product</span></span>(<span class="string">&quot;Luxury&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> =<span class="string">&quot; LuxuryProduct loading&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p : Product = LuxuryProduct()</span><br><span class="line">    println(p.load())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="类型检测-智能类型转换"><a href="#类型检测-智能类型转换" class="headerlink" title="类型检测 智能类型转换"></a>类型检测 智能类型转换</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_9.11.39_convert.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">println(p <span class="keyword">is</span> Product)</span><br><span class="line">println(p <span class="keyword">is</span> LuxuryProduct)</span><br><span class="line">println(p <span class="keyword">is</span> File)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (p <span class="keyword">is</span> LuxuryProduct)&#123;</span><br><span class="line">    println((p <span class="keyword">as</span> LuxuryProduct).special())</span><br><span class="line">    println(p.special()) <span class="comment">//只要转换一次，后面就直接可以使用，不用转换</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Kotlin层次"><a href="#Kotlin层次" class="headerlink" title="Kotlin层次"></a>Kotlin层次</h5><p>无须在代码里显示指定，每一个类都会继承一个共同的叫做Any的超类。</p>
<h5 id="Object关键字"><a href="#Object关键字" class="headerlink" title="Object关键字"></a>Object关键字</h5><p>定义一个能产生一个实例的类- 单例</p>
<p>Object关键字有三种方式</p>
<ol>
<li><p>对象声明</p>
<p>有利于组织代码和管理状态，尤其是管理整个应用运行生命周期内的某些一致性状态</p>
</li>
<li><p>对象表达式</p>
<p><img src="/2021/08/21/kotlin-object/2021-08-21_9.30.54_expression.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">&quot;loading nothing..&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//匿名内部类，实例p对象</span></span><br><span class="line">    <span class="keyword">val</span> p = <span class="keyword">object</span> : Player()&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span>= <span class="string">&quot;anonymous nothing..&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(p.load())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>伴生对象</p>
<p><img src="/2021/08/21/kotlin-object/2021-08-21_9.40.03_companion.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 只要调用load() 或者实例化ConfigMap, 这个companion object才会被实例化</span></span><br><span class="line"><span class="comment"> * 而且也是单例的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigMap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> PATH = <span class="string">&quot;xxxx&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = File(PATH).readBytes()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//  类似于Java static</span></span><br><span class="line">    ConfigMap.load()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="类相关"><a href="#类相关" class="headerlink" title="类相关"></a>类相关</h3><h5 id="嵌套类"><a href="#嵌套类" class="headerlink" title="嵌套类"></a>嵌套类</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_9.47.48_innerclass.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InnerClassTest</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Equipment</span></span>(<span class="keyword">var</span> name:String)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">()</span></span> = println(<span class="string">&quot;equipment:<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">battle</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    InnerClassTest.Equipment(<span class="string">&quot;shap knife&quot;</span>).show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="数据类"><a href="#数据类" class="headerlink" title="数据类"></a>数据类</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_9.52.32_data.png"></p>
<h5 id="数据类使用条件"><a href="#数据类使用条件" class="headerlink" title="数据类使用条件"></a>数据类使用条件</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_11.01.56_data_condition.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x:<span class="built_in">Int</span>,<span class="keyword">var</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isInBounds = x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>))</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>)==Coordinate(<span class="number">10</span>,<span class="number">20</span>)) <span class="comment">//data默认重写equals方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>Coordinate(x=10, y=20) // 说明默认提供了toString方法</p>
</blockquote>
<p>重写了equals方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(<span class="meta">@Nullable</span> Object var1)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span> != var1) &#123;</span><br><span class="line">         <span class="keyword">if</span> (var1 <span class="keyword">instanceof</span> Coordinate) &#123;</span><br><span class="line">            Coordinate var2 = (Coordinate)var1;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.x == var2.x &amp;&amp; <span class="keyword">this</span>.y == var2.y) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_10.00_copy.png"></p>
<p>注意:次构造函数数据不会copy过来</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span>  <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(</span><br><span class="line">        <span class="keyword">var</span> name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>	 <span class="comment">//age 主构造函数里声明的属性</span></span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> hobby = <span class="string">&quot;music&quot;</span></span><br><span class="line">    <span class="keyword">val</span> subject:String</span><br><span class="line">    <span class="keyword">var</span> score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;initializing student&quot;</span>)</span><br><span class="line">        subject = <span class="string">&quot;english&quot;</span>			<span class="comment">//Init初始化块里的属性赋值和函数调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(_name: String):<span class="keyword">this</span>(_name,<span class="number">10</span>)&#123;</span><br><span class="line">        score = <span class="number">10</span>; <span class="comment">//次构造函数数据不会copy过来</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student(name=&#x27;<span class="variable">$name</span>&#x27;, age=<span class="variable">$age</span>, hobby=&#x27;<span class="variable">$hobby</span>&#x27;, subject=&#x27;<span class="variable">$subject</span>&#x27;, score=<span class="variable">$score</span>)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> s = Student(<span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> copy = s.copy(<span class="string">&quot;girl&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> s2 = s.copy(name = <span class="string">&quot;girl2&quot;</span>, age = <span class="number">18</span>)</span><br><span class="line">    println(s)</span><br><span class="line">    println(s2)</span><br><span class="line">    println(copy)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="解构声明"><a href="#解构声明" class="headerlink" title="解构声明"></a>解构声明</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_10.13.25_component.png"></p>
<ol>
<li><p>普通类</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayerScore</span></span>(<span class="keyword">val</span> experience:<span class="built_in">Int</span>,<span class="keyword">val</span> level:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">component1</span><span class="params">()</span></span> = experience</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">component2</span><span class="params">()</span></span> = level</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> (x,y) = PlayerScore(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$x</span>, <span class="variable">$y</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Data数据类</p>
<p>数据类自动生成解构语法</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x:<span class="built_in">Int</span>,<span class="keyword">var</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isInBounds = x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>))</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>)==Coordinate(<span class="number">10</span>,<span class="number">20</span>)) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span>(x,y) = Coordinate(<span class="number">10</span>,<span class="number">20</span>) <span class="comment">//数据类自动生成解构语法</span></span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$x</span> , <span class="variable">$y</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h5><p>如果要将内置运算符应用在自定义类身上，你必须重写运算符函数，告诉编译器该如何操作自定义类</p>
<p><img src="/2021/08/21/kotlin-object/2021-08-21_10.24.07_overload.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate2</span></span>(<span class="keyword">var</span> x:<span class="built_in">Int</span>,<span class="keyword">var</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isInBounds = x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">plus</span><span class="params">(other:<span class="type">Coordinate2</span>)</span></span> = Coordinate2(x + other.x,y+other.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">     <span class="keyword">val</span> c1=Coordinate2(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">     <span class="keyword">val</span> c2=Coordinate2(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">     println(c1 + c2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><p>用来定义常量集合特殊的类</p>
<p>枚举类是一个实例</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Direction</span> </span>&#123;</span><br><span class="line">    EAST,</span><br><span class="line">    WEST,</span><br><span class="line">    SOUTH,</span><br><span class="line">    NORTH</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Direction.EAST)</span><br><span class="line">    println(Direction.EAST <span class="keyword">is</span> Direction)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="枚举类定义函数"><a href="#枚举类定义函数" class="headerlink" title="枚举类定义函数"></a>枚举类定义函数</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Direction2</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> coordinate: Coordinate) &#123;</span><br><span class="line">    EAST(Coordinate(<span class="number">1</span>, <span class="number">0</span>)), <span class="comment">//EAST()是Direction2的实例</span></span><br><span class="line">    WEST(Coordinate(-<span class="number">1</span>, <span class="number">0</span>)),</span><br><span class="line">    SOUTH(Coordinate(-<span class="number">1</span>, <span class="number">0</span>)),</span><br><span class="line">    NORTH(Coordinate(<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义函数</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateCoordinate</span><span class="params">(playerCoordinate: <span class="type">Coordinate</span>)</span></span> =</span><br><span class="line">            Coordinate(playerCoordinate.x + coordinate.x, playerCoordinate.y + coordinate.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Direction2.EAST.updateCoordinate(Coordinate(<span class="number">10</span>, <span class="number">20</span>)))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="代数数据类型"><a href="#代数数据类型" class="headerlink" title="代数数据类型"></a>代数数据类型</h5><p>可以用来表示一组子类型的闭集，枚举类就是一种简单的ADT</p>
<p><img src="/2021/08/21/kotlin-object/2021-08-21_10.40.31_enum_data.png"></p>
<h5 id="密封类"><a href="#密封类" class="headerlink" title="密封类"></a>密封类</h5><p><img src="/2021/08/21/kotlin-object/2021-08-21_10.42.08_closure_sealed.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//密封类</span></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">LicenseStatus2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">object</span> UnQualified:LicenseStatus2()</span><br><span class="line">    <span class="keyword">object</span> Learning:LicenseStatus2()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Qualified</span></span>(<span class="keyword">val</span> licenseId:String):LicenseStatus2() <span class="comment">//用来保存数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Driver2</span></span>(<span class="keyword">var</span> status: LicenseStatus2)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">checkLicense</span><span class="params">()</span></span>:String&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">when</span>(status)&#123;</span><br><span class="line">            <span class="keyword">is</span> LicenseStatus2.UnQualified -&gt; <span class="string">&quot;没资格&quot;</span></span><br><span class="line">            <span class="keyword">is</span> LicenseStatus2.Learning -&gt; <span class="string">&quot;在学&quot;</span></span><br><span class="line">            <span class="keyword">is</span> LicenseStatus2.Qualified -&gt; <span class="string">&quot;有资格，驾驶证编号: <span class="subst">$&#123;((this.status as LicenseStatus2.Qualified).licenseId)&#125;</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> status1 = LicenseStatus2.Learning</span><br><span class="line">    <span class="keyword">val</span> status = LicenseStatus2.Qualified(<span class="string">&quot;2333003&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> driver = Driver2(status)</span><br><span class="line">    println(driver.checkLicense())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h5><p><img src="/2021/08/21/kotlin-object/Users/m/Documents/noteforme.github.io/source/_posts/kotlin-object/2021-08-22_9.59.22_interface.png"></p>
<p>InterfaceTest.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Movable</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> maxSpeed:<span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">var</span> wheels:<span class="built_in">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable:<span class="type">Movable</span>)</span></span>:String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>(_name:String,<span class="keyword">override</span>  <span class="keyword">var</span> wheels:<span class="built_in">Int</span>=<span class="number">4</span>):Movable&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> maxSpeed: <span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable: <span class="type">Movable</span>)</span></span>: String &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h5><p>可以在接口里提供默认属性getter方法和函数实现</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Movable</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> maxSpeed:<span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = (<span class="number">1.</span><span class="number">.500</span>).shuffled().last()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wheels:<span class="built_in">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable:<span class="type">Movable</span>)</span></span>:String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>(_name:String,<span class="keyword">override</span>  <span class="keyword">var</span> wheels:<span class="built_in">Int</span>=<span class="number">4</span>):Movable&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> maxSpeed: <span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = <span class="keyword">super</span>.maxSpeed</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable: <span class="type">Movable</span>)</span></span>: String &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象类</p>
<p><img src="/2021/08/21/kotlin-object/2021-08-22_10.13.48_abstract.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Gun</span></span>(<span class="keyword">val</span> range: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">pullTrigger</span><span class="params">()</span></span>: String</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;doSomething&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AK47</span></span>(<span class="keyword">val</span> price: <span class="built_in">Int</span>) : Gun(range = <span class="number">500</span>)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">pullTrigger</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        TODO()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><h5 id="定义泛型类"><a href="#定义泛型类" class="headerlink" title="定义泛型类"></a>定义泛型类</h5><p><img src="/2021/08/21/kotlin-object/2021-08-22_10.25.51_generics.png"></p>
<p>magicBox1.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T</span>&gt;</span>(item:T)&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject:T = item</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name:String,<span class="keyword">val</span> age:<span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight:<span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    <span class="keyword">val</span> box2 = MagicBox(Dog( <span class="number">20</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/21/kotlin-object/2021-08-22_20.30.09_notice.png"></p>
<h5 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h5><ol>
<li><p>泛型参数也可以用于函数。</p>
</li>
<li><p>定义一个函数用于获取元素，当且仅当MagicBox可用时，才能获取元素。</p>
<p>magicBox2.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T</span>&gt;</span>(item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: T = item</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject.takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    <span class="keyword">val</span> box2 = MagicBox(Dog(<span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch()?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="多泛型参数"><a href="#多泛型参数" class="headerlink" title="多泛型参数"></a>多泛型参数</h5><p>magicBox3.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T</span>&gt;</span>(item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: T = item</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject.takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    <span class="keyword">val</span> box2 = MagicBox(Dog(<span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch()?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="泛型类型约束"><a href="#泛型类型约束" class="headerlink" title="泛型类型约束"></a>泛型类型约束</h5><p>确保MagicBox只能装指定类型的物品， 如Human类型，咋弄?</p>
<p>magicBox4.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox4</span>&lt;<span class="type">T:Human</span>&gt;</span>(item: T) &#123;      <span class="comment">//这里添加约束</span></span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: T = item</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject.takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String,  age: <span class="built_in">Int</span>):Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox4(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line"><span class="comment">//    val box2 = MagicBox4(Dog(20)) //因为约束类型，导致这里会报错</span></span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch()?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="vararg关键字与get函数"><a href="#vararg关键字与get函数" class="headerlink" title="vararg关键字与get函数"></a>vararg关键字与get函数</h5><p>MagicBox能存放任何类型的Human实例，但一次只能放一个，如果要存放多个实例呢？</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T : Human</span>&gt;</span>(<span class="keyword">vararg</span> item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: Array&lt;<span class="keyword">out</span> T&gt; = item <span class="comment">//可变参数 必须写out</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>)</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject[index].takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>, subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject[index]).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jack&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jon&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch(<span class="number">1</span>)?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch(<span class="number">2</span>) &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="操作符"><a href="#操作符" class="headerlink" title="[]操作符"></a>[]操作符</h5><p>运算符重载</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T : Human</span>&gt;</span>(<span class="keyword">vararg</span> item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: Array&lt;<span class="keyword">out</span> T&gt; = item <span class="comment">//可变参数 必须写out</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>)</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject[index].takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>, subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject[index]).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">(index: <span class="type">Int</span>)</span></span>: T? = subject[index]?.takeIf &#123; available &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jack&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jon&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch(<span class="number">1</span>)?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch(<span class="number">2</span>) &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    box1[<span class="number">0</span>] <span class="comment">//重写get</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="Out-In"><a href="#Out-In" class="headerlink" title="Out In"></a>Out In<img src="/2021/08/21/kotlin-object/2021-08-22_11.08.36_out.png"></h5><p><img src="/2021/08/21/kotlin-object/2021-08-22_11.11.09_IN.png"></p>
<p>invariant（不变）</p>
<p>如果泛型类即将泛型类型作为函数参数，又将泛型类型作为函数的输出，那么即不用out也不用in.</p>
<p>为什么需要in out</p>
<p>如果泛型有继承关系，可以直接用,Java只能用具体类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTypeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        ArrayList&lt;CharSequence&gt; list = new ArrayList&lt;String&gt;();</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/21/kotlin-object/2021-08-22_11.37.32_why_inout.png"></p>
<ol>
<li>父类泛型对象可以赋值给子类泛型对象 ， 用in. 类似super</li>
<li>子类泛型对象可以赋值给父类泛型对象，  用out 类似extends</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// out</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Production</span>&lt;<span class="type">out T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="type">in T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//    fun consume(item:T):T //Type parameter T is declared as &#x27;in&#x27; but occurs in &#x27;out&#x27; position in type T</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//不变</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ProductionConsumer</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: T</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Food</span></span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">FastFood</span>:<span class="type">Food</span></span>()</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Burger</span> :<span class="type">FastFood</span></span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//生产者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FoodStore</span> : <span class="type">Production</span>&lt;<span class="type">Food</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: Food &#123;</span><br><span class="line">        println(<span class="string">&quot;Product food&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> Food()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastFoodStore</span> : <span class="type">Production</span>&lt;<span class="type">FastFood</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: FastFood &#123;</span><br><span class="line">        println(<span class="string">&quot;Product FastFood&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> FastFood()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BurgerFoodStore</span> : <span class="type">Production</span>&lt;<span class="type">Burger</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: Burger &#123;</span><br><span class="line">        println(<span class="string">&quot;Product Burger&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> Burger()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EveryBody</span> : <span class="type">Consumer</span>&lt;<span class="type">Food</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">Food</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Eat food.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModernPeople</span> : <span class="type">Consumer</span>&lt;<span class="type">FastFood</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">FastFood</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Eat fastFood&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmericanPeople</span> : <span class="type">Consumer</span>&lt;<span class="type">Burger</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">Burger</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Eat Burger&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> production1 : Production&lt;Food&gt; = FoodStore() <span class="comment">// 理解时，别看方法只看类就可以了，父子类关系</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//子类泛型对象可以复制给负累泛型对象，用out</span></span><br><span class="line">    <span class="keyword">val</span> production2 : Production&lt;Food&gt; = FastFoodStore() <span class="comment">// 就是因为有 out，out删除就报错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//父类泛型对象可以赋值给子类泛型对象 ， 用in</span></span><br><span class="line">    <span class="keyword">val</span> consumer1:Consumer&lt;Burger&gt; = EveryBody()</span><br><span class="line"><span class="comment">//    val consumer2:Consumer&lt;Food&gt; = ModernPeople()//Required:Consumer&lt;Food&gt; Found : ModernPeople</span></span><br><span class="line">    <span class="keyword">val</span> consumer2:Consumer&lt;Burger&gt; = ModernPeople()</span><br><span class="line">    consumer2.consume(Burger())</span><br><span class="line"><span class="comment">//    consumer2.consume(Food())</span></span><br><span class="line">    <span class="keyword">val</span> consumer3:Consumer&lt;Burger&gt; = AmericanPeople()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Reified"><a href="#Reified" class="headerlink" title="Reified"></a>Reified</h5><p><img src="/2021/08/21/kotlin-object/2021-08-22_reified.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T : Human</span>&gt;</span>() &#123;</span><br><span class="line">    <span class="comment">//随机产生一个对象，如果不是指定类型的对象，就通过backup函数生成一个指定类型的对象</span></span><br><span class="line">    <span class="comment">/*  fun &lt;T&gt; randomOrBackup(backup: () -&gt; T): T &#123;    // backup: ()-&gt;T 函数 和randomOrBackup返回的都是T类型</span></span><br><span class="line"><span class="comment">          val items = listOf(Boy(&quot;jocnk&quot;, 20), Man(&quot;john&quot;, 20))</span></span><br><span class="line"><span class="comment">          val random = items.shuffled().first()</span></span><br><span class="line"><span class="comment">          return if (random is T) &#123;</span></span><br><span class="line"><span class="comment">              random</span></span><br><span class="line"><span class="comment">          &#125; else &#123;</span></span><br><span class="line"><span class="comment">              backup()</span></span><br><span class="line"><span class="comment">          &#125;</span></span><br><span class="line"><span class="comment">      &#125; */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// backup: ()-&gt;T 函数 和randomOrBackup返回的都是T类型</span></span><br><span class="line">    <span class="comment">//inline  reified一起使用</span></span><br><span class="line">    <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">randomOrBackup</span><span class="params">(backup: () -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">val</span> items = listOf(Boy(<span class="string">&quot;jocnk&quot;</span>, <span class="number">20</span>), Man(<span class="string">&quot;john&quot;</span>, <span class="number">20</span>))</span><br><span class="line">        <span class="keyword">val</span> random = items.shuffled().first()</span><br><span class="line">        println(random)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (random <span class="keyword">is</span> T) &#123;</span><br><span class="line">            random</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            backup()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Boy(name=&#x27;<span class="variable">$name</span>&#x27;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Man(name=&#x27;<span class="variable">$name</span>&#x27;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1: MagicBox&lt;Man&gt; = MagicBox()</span><br><span class="line">    <span class="comment">// 由backup函数推断出来T的类型</span></span><br><span class="line">    <span class="keyword">val</span> subject = box1.randomOrBackup &#123; Man(<span class="string">&quot;Jimmy&quot;</span>, <span class="number">28</span>) &#125; <span class="comment">//Man推断T类型</span></span><br><span class="line">    println(subject)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin-senior</title>
    <url>/2021/08/22/kotlin-senior/</url>
    <content><![CDATA[<h3 id="拓展函数"><a href="#拓展函数" class="headerlink" title="拓展函数"></a>拓展函数</h3><p><img src="/2021/08/22/kotlin-senior/2021-08-22_1.26.04_expand.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//给字符串追加若干个 !</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">(amount:<span class="type">Int</span>=<span class="number">1</span>)</span></span>= <span class="keyword">this</span> + <span class="string">&quot; !&quot;</span>.repeat(amount)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Any.<span class="title">easyPrint</span><span class="params">()</span></span> = println(<span class="keyword">this</span>) <span class="comment">//默认是public</span></span><br><span class="line"><span class="comment">//fun Any.easyPrint() = println(this) //不能定义两次</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;abc&quot;</span>.addExt(<span class="number">2</span>))</span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.easyPrint()</span><br><span class="line">    <span class="number">15.</span>easyPrint()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="泛型拓展函数"><a href="#泛型拓展函数" class="headerlink" title="泛型拓展函数"></a>泛型拓展函数</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-22_1.42.27_generic_extends.png"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//给字符串追加若干个 !</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">(amount:<span class="type">Int</span>=<span class="number">1</span>)</span></span>= <span class="keyword">this</span> + <span class="string">&quot; !&quot;</span>.repeat(amount)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">easyPrint</span><span class="params">()</span></span>:T&#123;</span><br><span class="line">    println(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.addExt(<span class="number">2</span>).easyPrint()</span><br><span class="line">    <span class="number">15.</span>easyPrint()</span><br><span class="line">    <span class="number">15.</span>also &#123;  &#125;</span><br><span class="line">    <span class="keyword">val</span> let = <span class="string">&quot;abc&quot;</span>.let &#123; <span class="number">50</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Let源码"><a href="#Let源码" class="headerlink" title="Let源码"></a>Let源码</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// &quot;abc&quot;调用let，传进来参数就是&quot;abc&quot;类型T为String</span></span><br><span class="line"><span class="comment">// let返回lambda表达式执行的结果 50 类型R为Int</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">let</span><span class="params">(block: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="拓展属性"><a href="#拓展属性" class="headerlink" title="拓展属性"></a>拓展属性</h5><p>给String类添加一个拓展</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//给字符串追加若干个 !</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">(amount: <span class="type">Int</span> = <span class="number">1</span>)</span></span> = <span class="keyword">this</span> + <span class="string">&quot; !&quot;</span>.repeat(amount)</span><br><span class="line"><span class="keyword">val</span> String.numVowels</span><br><span class="line">    <span class="keyword">get</span>() = count &#123; <span class="string">&quot;aeiou&quot;</span>.contains(it) &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">easyPrint</span><span class="params">()</span></span>: T &#123;</span><br><span class="line">    println(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.addExt(<span class="number">2</span>).easyPrint()</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;The people&#x27;s Republic of China&quot;</span>.numVowels.easyPrint()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="可空类拓展"><a href="#可空类拓展" class="headerlink" title="可空类拓展"></a>可空类拓展</h5><p>可以定义拓展函数用于可空类型，在可空类型上定义拓展函数，你可以直接在拓展函数体内借鉴可能出现的空值问题。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> String?.<span class="title">printWithDefault</span><span class="params">(default:<span class="type">String</span>)</span></span> =print(<span class="keyword">this</span> ?: default) <span class="comment">//null打印默认值,不为null 打印自身</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//    val nullableString:String? = null</span></span><br><span class="line">    <span class="keyword">val</span> nullableString:String? = <span class="string">&quot;hehe&quot;</span></span><br><span class="line">    nullableString.printWithDefault(<span class="string">&quot;abc&quot;</span>) <span class="comment">// nullableString?就不会设置默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Infix"><a href="#Infix" class="headerlink" title="Infix"></a>Infix</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-22_2.48.05_infix.png" alt="2021-08-22_2.48.05_infix"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> String?.<span class="title">printWithDefault</span><span class="params">(default:<span class="type">String</span>)</span></span> =print(<span class="keyword">this</span> ?: default) <span class="comment">//null打印默认值,不为null 打印自身</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//    val nullableString:String? = null</span></span><br><span class="line">    <span class="keyword">val</span> nullableString:String? = <span class="string">&quot;hehe&quot;</span></span><br><span class="line">    nullableString.printWithDefault(<span class="string">&quot;abc&quot;</span>) <span class="comment">// nullableString?就不会设置默认值</span></span><br><span class="line">    nullableString printWithDefault <span class="string">&quot;abc&quot;</span></span><br><span class="line">    <span class="string">&quot;girl&quot;</span>.to(<span class="number">18</span>)</span><br><span class="line">    mapOf(<span class="string">&quot;girl&quot;</span> to <span class="number">18</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//to是拓展函数，返回 Pair&lt;A,B&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;A, B&gt;</span> A.<span class="title">to</span><span class="params">(that: <span class="type">B</span>)</span></span>: Pair&lt;A, B&gt; = Pair(<span class="keyword">this</span>, that)</span><br></pre></td></tr></table></figure>



<h5 id="定义拓展文件"><a href="#定义拓展文件" class="headerlink" title="定义拓展文件"></a>定义拓展文件</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.util.kotin.extension</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">randomTake</span><span class="params">()</span></span>: T = <span class="keyword">this</span>.shuffled().first()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> list = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">set</span> = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    list.shuffled().first()</span><br><span class="line"></span><br><span class="line">    list.randomTake()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="重命名拓展"><a href="#重命名拓展" class="headerlink" title="重命名拓展"></a>重命名拓展</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.util.kotin.extension.randomTake <span class="keyword">as</span> Randomizer</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> list = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">set</span> = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    list.shuffled().first()</span><br><span class="line"></span><br><span class="line"><span class="comment">//    list.randomTake()</span></span><br><span class="line">    list.Randomizer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.00.52_extent.png" alt="2021-08-22_3.00.52_extent"></p>
<h5 id="Apply源码"><a href="#Apply源码" class="headerlink" title="Apply源码"></a>Apply源码</h5><p>带接收者的函数字面量</p>
<p>apply函数是如何做到支持接收者对象的隐式调用</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span><br><span class="line">    block()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File</span><br><span class="line"></span><br><span class="line"><span class="comment">//fun String.addExt(amount: Int = 1) = this + &quot; !&quot;.repeat(amount)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">()</span></span> = <span class="string">&quot; !&quot;</span>.repeat(<span class="keyword">this</span>.count())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型的拓展函数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">easyPrint</span><span class="params">()</span></span>: <span class="built_in">Unit</span> = println(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// T.apply 返回的还是T</span></span><br><span class="line"><span class="comment">// T.() -&gt; Unit 传入拓展函数(泛型), 而不是普通的匿名函数 ???</span></span><br><span class="line"><span class="comment">// 拓展函数里自带了接收者对象的this隐式调用</span></span><br><span class="line"><span class="comment">// 匿名函数，也可以是 拓展函数</span></span><br><span class="line"><span class="comment">//普通的匿名函数 ()-&gt;Unit</span></span><br><span class="line"><span class="comment">//匿名函数内部this指向一个File对象,隐式调用，File.() -&gt; Unit</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span><br><span class="line">    block()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*public inline fun &lt;File&gt; File.apply(block: File.() -&gt; Unit): File &#123;</span></span><br><span class="line"><span class="comment">    block()</span></span><br><span class="line"><span class="comment">    return this</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> file = File(<span class="string">&quot;xx&quot;</span>).apply &#123;</span><br><span class="line">        <span class="keyword">this</span>.setReadable(<span class="literal">true</span>) <span class="comment">//默认又一个对象指向File</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里分解一下</span></span><br><span class="line">    <span class="comment">//1. 定义拓展函数</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> File.<span class="title">ext</span><span class="params">()</span></span>: <span class="built_in">Unit</span> &#123;</span><br><span class="line">        setReadable(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.给block变量赋值</span></span><br><span class="line">    <span class="keyword">val</span> block = File::ext</span><br><span class="line">    <span class="comment">//3.传入apply函数</span></span><br><span class="line">    File(<span class="string">&quot;xxx&quot;</span>).apply &#123; block &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    doSomething &#123;</span><br><span class="line">        goFix()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;abcefg&quot;</span>.addExt().easyPrint() <span class="comment">// &quot;abcefg&quot;调用addExt() ,addExt()有一个对象指向&quot;abcefg&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.apply &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">(fix: () -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    fix</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">goFix</span><span class="params">()</span></span>: <span class="built_in">Unit</span> &#123;</span><br><span class="line">    <span class="string">&quot;goFxi&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="案例LoginModel-kt"><a href="#案例LoginModel-kt" class="headerlink" title="案例LoginModel.kt"></a>案例LoginModel.kt</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">RpcExpress.pack &#123;</span><br><span class="line">    request.mobileNo = mobileNo</span><br><span class="line">    request.metaInfo = metaInfo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T : RpcRequest, <span class="keyword">reified</span> R : RpcResult, <span class="keyword">reified</span> E : RpcTask&gt;</span> <span class="title">pack</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        build: <span class="type">RpcPackage</span>&lt;<span class="type">T</span>, R, E&gt;.()</span></span> -&gt; <span class="built_in">Unit</span></span><br><span class="line">): RpcExecutor&lt;T, R, E&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> rpcPackage =</span><br><span class="line">        RpcPackage&lt;T, R, E&gt;(T::<span class="keyword">class</span>.java.newInstance(), R::<span class="keyword">class</span>.java, E::<span class="keyword">class</span>.java)</span><br><span class="line">    build(rpcPackage) <span class="comment">// 也可以写成 rpcPackage?.build() , 给rpcPackage赋值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pack(rpcPackage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h3><p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.34.23_DSL.png"></p>
<p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.39.01_math_func.png" alt="2021-08-22_3.39.01_math_func"></p>
<p>函数类别</p>
<p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.43.38_qualify.png" alt="2021-08-22_3.43.38_qualify"></p>
<h5 id="Map变换"><a href="#Map变换" class="headerlink" title="Map变换"></a>Map变换</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.49.42_convert.png" alt="2021-08-22_3.49.42_convert"></p>
<p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.50.14_map.png" alt="2021-08-22_3.50.14_map"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> animals = listOf(<span class="string">&quot;zebra&quot;</span>, <span class="string">&quot;giraffe&quot;</span>, <span class="string">&quot;elephant&quot;</span>, <span class="string">&quot;rat&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> banies = animals.map &#123; animal -&gt;</span><br><span class="line">    <span class="string">&quot;A baby <span class="variable">$animal</span>&quot;</span></span><br><span class="line">&#125;.map &#123;</span><br><span class="line">    baby -&gt; <span class="string">&quot;<span class="variable">$baby</span> , with the cutest little tail ever!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(animals)</span><br><span class="line">println(banies)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.59.20_map1.png" alt="2021-08-22_3.59.20_map1"></p>
<p><img src="/2021/08/22/kotlin-senior/2021-08-22_3.59.53_map2.png" alt="2021-08-22_3.59.53_map2"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> animalsLength = animals.map &#123; it.length &#125;</span><br><span class="line">println(animalsLength)</span><br></pre></td></tr></table></figure>



<h5 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h5><p>faltMap函数操作一个集合的集合，将其中多个<strong>集合中的元素的合并</strong>后返回一个包含所有元素的单一集合。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> result = listOf(listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), listOf(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)).flatMap &#123; it &#125;</span><br><span class="line">println(result)</span><br></pre></td></tr></table></figure>



<h5 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-22_4.07.58_filter.png" alt="2021-08-22_4.07.58_filter"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> result = listOf(<span class="string">&quot;Jack&quot;</span>,<span class="string">&quot;Jimmy&quot;</span>,<span class="string">&quot;Rose&quot;</span>,<span class="string">&quot;Tom&quot;</span>).filter &#123;</span><br><span class="line">    it.contains(<span class="string">&quot;J&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(result)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> items = listOf(</span><br><span class="line">        listOf(<span class="string">&quot;rea apple&quot;</span>, <span class="string">&quot;green apple&quot;</span>, <span class="string">&quot;blue apple&quot;</span>),</span><br><span class="line">        listOf(<span class="string">&quot;red fish&quot;</span>, <span class="string">&quot;blue fish&quot;</span>),</span><br><span class="line">        listOf(<span class="string">&quot;yellow banana&quot;</span>, <span class="string">&quot;teal banana&quot;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">val</span> redItems = items.flatMap &#123; it.filter &#123; it.contains(<span class="string">&quot;red&quot;</span>) &#125; &#125;</span><br><span class="line">println(redItems)</span><br></pre></td></tr></table></figure>



<p><img src="/2021/08/22/kotlin-senior/2021-08-22_4.56.png" alt="2021-08-22_4.56"></p>
<h5 id="找素数"><a href="#找素数" class="headerlink" title="找素数"></a>找素数</h5><p>找素数，除了1和它本身，不能被任何数整除的数。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 除了1和它本身， 不梦被任何数整除的数</span></span><br><span class="line"><span class="comment">// 取模等于0，说明能够整除，如果没有一个是等于0的，说明是素数。</span></span><br><span class="line"><span class="keyword">val</span> numbers = listOf(<span class="number">7</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">22</span>, <span class="number">18</span>, <span class="number">11</span>)</span><br><span class="line"><span class="keyword">val</span> primes = numbers.filter &#123; number -&gt;</span><br><span class="line">    (<span class="number">2</span> until number).map &#123; number % it &#125;.none &#123; it == <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">println(primes)</span><br></pre></td></tr></table></figure>

<h4 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h4><p>合并是函数式编程的第三大类函数，合并能将不同的集合合并成一个新的集合。这个接收者是包含集合的的集合的flatmap函数不同。</p>
<h5 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> list1 = listOf(<span class="string">&quot;jon&quot;</span>, <span class="string">&quot;john1&quot;</span>, <span class="string">&quot;john2&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> list2 = listOf(<span class="string">&quot;l1&quot;</span>, <span class="string">&quot;l2&quot;</span>, <span class="string">&quot;l3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> toMap = list1.zip(list2).toMap()</span><br><span class="line">println(toMap)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>{jon=l1, john1=l2, john2=l3}</p>
</blockquote>
<h5 id="Fold"><a href="#Fold" class="headerlink" title="Fold"></a>Fold</h5><p>可以用来合并值的合并函数是fold，这个合并函数接受一个初始累加器值，随后会<strong>根据匿名函数的结构更新</strong>。</p>
<p>fold(0)  accumulator从0开始</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//将每个元素值 乘以3后累加起来</span></span><br><span class="line"><span class="keyword">val</span> foldedValue = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).fold(<span class="number">0</span>) &#123; accumulator, number -&gt;</span><br><span class="line">    println(<span class="string">&quot;Accmulator value: <span class="variable">$accumulator</span>&quot;</span>)</span><br><span class="line">    accumulator + (number * <span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;Find value: <span class="variable">$foldedValue</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>Accmulator value: 0<br>Accmulator value: 3<br>Accmulator value: 9<br>Accmulator value: 18<br>Find value: 30</p>
</blockquote>
<h5 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-28_9.38.16_Sequence.png" alt="2021-08-28_9.38.16_Sequence"></p>
<p><img src="/2021/08/22/kotlin-senior/2021-08-28_9.56.02_generateSequence.png" alt="2021-08-28_9.56.02_generateSequence"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//判断是否是素数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="built_in">Int</span>.<span class="title">isPrime</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    (<span class="number">2</span> until <span class="keyword">this</span>).map &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> % it == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//产生头1000个元素</span></span><br><span class="line">    <span class="comment">//假定 0 - 5000之内，可以找到1000个元素</span></span><br><span class="line">    <span class="keyword">val</span> toList = (<span class="number">1.</span><span class="number">.5009</span>).toList().filter &#123; it.isPrime() &#125;.take(<span class="number">1000</span>)</span><br><span class="line">    println(toList.size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> oneThousandPrimes = generateSequence(<span class="number">2</span>) &#123; value -&gt;</span><br><span class="line">        value + <span class="number">1</span></span><br><span class="line">    &#125;.filter &#123; it.isPrime() &#125;.take(<span class="number">1000</span>)</span><br><span class="line">    println(oneThousandPrimes.toList().size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="互操作性与可空性"><a href="#互操作性与可空性" class="headerlink" title="互操作性与可空性"></a>互操作性与可空性</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-28_10.06.35_null.png" alt="2021-08-28_10.06.35_null"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jhava</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hitPoints = <span class="number">3232320</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHitPoints</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----hitPoints-----&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hitPoints;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">utterGreeting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HELLO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(HeroKt.makeProclamation());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">determineFriends</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> adversary = Jhava()</span><br><span class="line">    println(adversary.utterGreeting())</span><br><span class="line"></span><br><span class="line">    <span class="comment">// determineFriends String! 平台类型</span></span><br><span class="line"><span class="comment">//    val level = adversary.determineFriends().toLong()</span></span><br><span class="line"><span class="comment">//    level?.toLong()</span></span><br><span class="line">    println(adversary.hitPoints)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HELLO<br>—-hitPoints—–<br>3232320</p>
<h5 id="JvmName注解指定编译类的名字"><a href="#JvmName注解指定编译类的名字" class="headerlink" title="@JvmName注解指定编译类的名字"></a>@JvmName注解指定编译类的名字</h5><p>​    </p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@file:JvmName</span>(<span class="string">&quot;Hero&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> senior.Jhava</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">makeProclamation</span><span class="params">()</span></span> = <span class="string">&quot;Greetings , beast!&quot;</span></span><br></pre></td></tr></table></figure>



<h5 id="JvmField"><a href="#JvmField" class="headerlink" title="@JvmField"></a>@JvmField</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-28_10.54.47_field.png" alt="2021-08-28_10.54.47_field"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpellBook</span> </span>&#123;</span><br><span class="line">    val spells = listOf(<span class="string">&quot;Magic Ms . L&quot;</span>, <span class="string">&quot;Lay onHans&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmField</span></span><br><span class="line">    val spells1 = listOf(<span class="string">&quot;Magic Ms . L&quot;</span>, <span class="string">&quot;Lay onHans&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SpellBook spellBook = <span class="keyword">new</span> SpellBook();</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; spells = spellBook.getSpells();</span><br><span class="line">List&lt;String&gt; spells1 = spellBook.spells1; <span class="comment">// 直接用这个属性名，不用加get前缀</span></span><br></pre></td></tr></table></figure>



<h5 id="JvmOverloads"><a href="#JvmOverloads" class="headerlink" title="@JvmOverloads"></a>@JvmOverloads</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//调用者可以指定英雄左手或右手拿什么食物，或者使用默认的配置 - 左手拿浆果，右手拿牛肉</span></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">handoverFood</span><span class="params">(leftHand: <span class="type">String</span> = <span class="string">&quot;berries&quot;</span>, rightHand: <span class="type">String</span> = <span class="string">&quot;beef&quot;</span>)</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Mmmm... you hand over some delicious <span class="variable">$leftHand</span> and <span class="variable">$rightHand</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>可以看到编译器默认对类添加了重载</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="keyword">public</span> static <span class="keyword">final</span> void handoverFood(<span class="meta">@NotNull</span> String leftHand) &#123;</span><br><span class="line">   handoverFood$default(leftHand, (String)<span class="literal">null</span>, <span class="number">2</span>, (Object)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="keyword">public</span> static <span class="keyword">final</span> void handoverFood() &#123;</span><br><span class="line">   handoverFood$default((String)<span class="literal">null</span>, (String)<span class="literal">null</span>, <span class="number">3</span>, (Object)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>但是代码中我获取不到 Herokt 类。</p>
<p><a href="https://www.bilibili.com/video/BV1wf4y1s7TG?p=144&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1wf4y1s7TG?p=144&amp;spm_id_from=pageDriver</a></p>
<h5 id="JvmStatic"><a href="#JvmStatic" class="headerlink" title="@JvmStatic"></a>@JvmStatic</h5><p>@JvmField注解还能用来以静态方式提供伴生对象里定义的值</p>
<p>@JvmStatic注解的作用类似于@JvmField, 允许你直接调用伴生对象里的函数</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpellBook</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="meta">@JvmField</span></span><br><span class="line">        <span class="keyword">val</span> MAX_SPELL_COUNT = <span class="number">10</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getSpellbookGreeting</span><span class="params">()</span></span> = println(<span class="string">&quot;I am the Great man!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>加了@JvmField注解 就不用加 Companion调用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//伴生对象</span></span><br><span class="line">SpellBook.Companion.getSpellbookGreeting();</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加@JvmField  支持静态调用</span></span><br><span class="line"><span class="keyword">int</span> maxSpellCount = SpellBook.MAX_SPELL_COUNT;</span><br></pre></td></tr></table></figure>



<h5 id="Throws"><a href="#Throws" class="headerlink" title="@Throws"></a>@Throws</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-29_11.46.25_throwable.png" alt="2021-08-29_11.46.25_throwable"></p>
<p>​    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jhava</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendHandInFriendship</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Java异常-java处理"><a href="#Java异常-java处理" class="headerlink" title="Java异常 java处理"></a>Java异常 java处理</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//在java里面强制 在编译器处理的异常</span></span><br><span class="line">    <span class="keyword">new</span> Jhava().extendHandInFriendship();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Java异常-kotlin处理"><a href="#Java异常-kotlin处理" class="headerlink" title="Java异常 kotlin处理"></a>Java异常 kotlin处理</h6><p>Hero.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    adversary.extendHandInFriendship()</span><br><span class="line">&#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">    println(<span class="string">&quot;exception&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>kotlin异常Java处理</p>
<p>Hero.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">acceptApology</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> IOException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HeroKt.acceptApology();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;   <span class="comment">//报错 Exception &#x27;java.io.IOException&#x27; is never thrown in the corresponding try block</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器把kotlin转成了Throwable</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acceptApology</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">throw</span> (Throwable)(<span class="keyword">new</span> IOException());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以catch Throwable异常没问题</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HeroKt.acceptApology();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable e) &#123;   </span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="添加throws注解处理"><a href="#添加throws注解处理" class="headerlink" title="添加throws注解处理"></a>添加throws注解处理</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Throws(IOException::class)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">acceptApology1</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> IOException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HeroKt.acceptApology1();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h5><p><img src="/2021/08/22/kotlin-senior/2021-08-29_12.13.48_function.png" alt="2021-08-29_12.13.48_function"></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//添加一个translator的函数，接收一个字符串</span></span><br><span class="line"><span class="comment">//将其改为小写字面，再大写第一个字符，最后打印结构</span></span><br><span class="line"><span class="keyword">var</span> translator : (String)-&gt;<span class="built_in">Unit</span> = &#123; utterance: String -&gt;</span><br><span class="line">    println(utterance.toLowerCase().capitalize())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Function1&lt;String, Unit&gt; translator &#x3D; HeroKt.getTranslator();</span><br><span class="line">translator.invoke(&quot;TRUECE&quot;);</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
      <tags>
        <tag>Kotlin</tag>
      </tags>
  </entry>
  <entry>
    <title>Dagger</title>
    <url>/2021/08/29/Dagger/</url>
    <content><![CDATA[<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p><img src="/2021/08/29/Dagger/Users/m/Documents/noteforme.github.io/source/_posts/Dagger/2021-09-25_9.15.37_dagger_class.png" alt="2021-09-25_9.15.37_dagger_class"></p>
<h4 id="依赖注入"><a href="#依赖注入" class="headerlink" title="依赖注入"></a>依赖注入</h4><ol>
<li>构造方法注入</li>
<li>Setter注入(字段注入)</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    Engine engine;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法注入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// setter注入(字段注入)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        engine = <span class="keyword">new</span> Engine();</span><br><span class="line">        engine.start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engine</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="IOC框架"><a href="#IOC框架" class="headerlink" title="IOC框架"></a>IOC框架</h5><ol>
<li>基于反射的方式实现： Spring IOC(动态的进行依赖关系的建立)</li>
<li>静态方式 ： 程序在编译时就已经提供好了建立依赖关系的类。Dagger2</li>
</ol>
<p>两种注入方式</p>
<p><img src="/2021/08/29/Dagger/2021-08-29_8.43.22_type_dagger.png" alt="2021-08-29_8.43.22_type_dagger"></p>
<h4 id="Dagger注入"><a href="#Dagger注入" class="headerlink" title="Dagger注入"></a>Dagger注入</h4><h5 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h5><p>构造方法构造实例注入步骤</p>
<ol>
<li><p>使用 @Inject注解在构造方法上；就是告知Dagger可以通过构造方法来创建并获取到User的实例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 1.使用 @Inject注解在构造方法上；就是告知Dagger可以通过构造方法来创建并获取到User的实例</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span> </span>&#123; <span class="comment">//构造方法构造实例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>当作IOC容器,把对象注入到目标类中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定DaggerActivity作为要注入的目标类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>设置Inject注解</p>
<p>DaggerActivity.java</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">//<span class="number">3</span>.设置Inject注解</span><br><span class="line">@Inject</span><br><span class="line"><span class="keyword">User</span> <span class="title">user</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>执行注入动作</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//3.设置Inject注解</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">User user;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_dagger2);</span><br><span class="line"><span class="comment">//4.执行注入动作</span></span><br><span class="line">    DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);<span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类 </span></span><br><span class="line">    <span class="comment">// DaggerApplicationComponent.create()获取到实例,inject(this)注入到Activity中</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">      Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Module-Dagger模块注入"><a href="#Module-Dagger模块注入" class="headerlink" title="Module Dagger模块注入"></a>Module Dagger模块注入</h5><p>针对第三方库</p>
<p> 上面User是我们自己定义的类， 如果是第三方框架的类，怎么实现依赖注入？</p>
<ol>
<li><p>第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> User <span class="title">ProvideUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">   &#125;</span><br><span class="line">  </span><br><span class="line">	 </span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="2">
<li><p>compoent</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule.class&#125;)</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>DaggerActivity.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;DaggerActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置Inject注解</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Retrofit retrofit;</span><br><span class="line">  </span><br><span class="line">    Log.i(TAG, <span class="string">&quot;retrofit: &quot;</span> + retrofit);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Retrofit使用场景"><a href="#Retrofit使用场景" class="headerlink" title="Retrofit使用场景"></a>Retrofit使用场景</h5><p>​    </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET(&quot;/user/info&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;String&gt; <span class="title">requestInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line"><span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line"><span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line"><span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line">ApiService apiService;</span><br><span class="line"></span><br><span class="line">Log.i(TAG, <span class="string">&quot;apiService: &quot;</span> +apiService);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Module已经知道怎么获取retrofit实例<br>接着同一个Module中的方法，就可以作为参数直接传入 使用<br>// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例<br>// 然后从当前容器直接获取</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="局部单例实现"><a href="#局部单例实现" class="headerlink" title="局部单例实现"></a>局部单例实现</h4><p><img src="/2021/08/29/Dagger/2021-08-29_8.43.44_local.png" alt="2021-08-29_8.43.44_local"></p>
<p><img src="/2021/08/29/Dagger/2021-08-29_8.48.38_lifecycle.png" alt="2021-08-29_8.48.38_lifecycle"></p>
<p>3个对象实例指定了作用域是 @Singleton,这个作用域和使用了@Singleton组件的生命周期一致。</p>
<h5 id="局部实例1"><a href="#局部实例1" class="headerlink" title="局部实例1"></a>局部实例1</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Dagger模块</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">providerUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="comment">//@Provides</span></span><br><span class="line">    <span class="comment">//public Retrofit provideRetrofit() &#123;</span></span><br><span class="line">    <span class="comment">//    return new Retrofit.Builder()</span></span><br><span class="line">    <span class="comment">//        .baseUrl(&quot;http://www.google.com&quot;)</span></span><br><span class="line">    <span class="comment">//        .build();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">(OkHttpClient okHttpClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .client(okHttpClient)</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Singleton是Dagger提供的一种作用域</span></span><br><span class="line">    <span class="comment">// 作用域就是用来管理Component来获取对象实例的生命周期</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Singleton</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule1.class&#125;)</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;DaggerActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置Inject注解</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Retrofit retrofit;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_dagger2);</span><br><span class="line">        <span class="comment">//4.执行注入动作</span></span><br><span class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);<span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类</span></span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user2: &quot;</span> + user2);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;retrofit: &quot;</span> + retrofit);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService: &quot;</span> +apiService);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService2: &quot;</span> +apiService2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结构</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">2092</span>-<span class="number">2092</span>/com.comm.util I/DaggerActivity: user: com.comm.util.dagger.dn.di.User@<span class="number">2129</span>cef</span><br><span class="line"><span class="attribute">2092</span>-<span class="number">2092</span>/com.comm.util I/DaggerActivity: user<span class="number">2</span>: com.comm.util.dagger.dn.di.User@d<span class="number">97</span>d<span class="number">3</span>fc</span><br><span class="line"><span class="attribute">2092</span>-<span class="number">2092</span>/com.comm.util I/DaggerActivity: retrofit: retrofit<span class="number">2</span>.Retrofit@d<span class="number">243</span>a<span class="number">85</span></span><br><span class="line"><span class="attribute">2092</span>-<span class="number">2092</span>/com.comm.util I/DaggerActivity: apiService: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@a<span class="number">1</span>fa<span class="number">0</span>da</span><br><span class="line"><span class="attribute">2092</span>-<span class="number">2092</span>/com.comm.util I/DaggerActivity: apiService<span class="number">2</span>: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@a<span class="number">1</span>fa<span class="number">0</span>da</span><br></pre></td></tr></table></figure>

<p>可以看到 user 是2个实例</p>
<p>apiService用了同一个对象实例,所以可以看到和DaggerApplicationComponent组件生命周期一致。</p>
<h5 id="局部实例2"><a href="#局部实例2" class="headerlink" title="局部实例2"></a>局部实例2</h5><p>添加一个Activity</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;SecondActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService3;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_second2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类</span></span><br><span class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService3: &quot;</span> + apiService3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,SecondActivity.class));</span><br></pre></td></tr></table></figure>



<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">7410</span>-<span class="number">7410</span>/com.comm.util I/DaggerActivity: apiService: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@a<span class="number">1</span>fa<span class="number">0</span>da</span><br><span class="line"><span class="attribute">7410</span>-<span class="number">7410</span>/com.comm.util I/DaggerActivity: apiService<span class="number">2</span>: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@a<span class="number">1</span>fa<span class="number">0</span>da</span><br><span class="line"><span class="attribute">2021</span>-<span class="number">08</span>-<span class="number">29</span> <span class="number">22</span>:<span class="number">28</span>:<span class="number">35</span>.<span class="number">812</span> <span class="number">7410</span>-<span class="number">7410</span>/com.comm.util I/SecondActivity: apiService<span class="number">3</span>: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@<span class="number">84</span>eb<span class="number">79</span>a</span><br></pre></td></tr></table></figure>

<p>不同的DaggerApplicationComponent组件，不同的实例</p>
<h5 id="全局实例"><a href="#全局实例" class="headerlink" title="全局实例"></a>全局实例</h5><p>保证组件全局实例</p>
<p>Module作用域生命周期和 ApplicationComponent保持一致。</p>
<p>MyApplication.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> ApplicationComponent  applicationComponent = DaggerApplicationComponent.create();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationComponent <span class="title">getApplicationComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> applicationComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">MyApplication.getApplicationComponent().inject(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">8044</span>-<span class="number">8044</span>/com.comm.util I/DaggerActivity: apiService: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@<span class="number">516190</span>b</span><br><span class="line"><span class="attribute">8044</span>-<span class="number">8044</span>/com.comm.util I/DaggerActivity: apiService<span class="number">2</span>: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@<span class="number">516190</span>b</span><br><span class="line"><span class="attribute">8044</span>-<span class="number">8044</span>/com.comm.util I/SecondActivity: apiService<span class="number">3</span>: retrofit<span class="number">2</span>.Retrofit$<span class="number">1</span>@<span class="number">516190</span>b</span><br></pre></td></tr></table></figure>



<h5 id="使用作用域遵循的规则"><a href="#使用作用域遵循的规则" class="headerlink" title="使用作用域遵循的规则"></a>使用作用域遵循的规则</h5><p><img src="/2021/08/29/Dagger/2021-08-29_10.50.21_myscope.png" alt="2021-08-29_10.50.21_myscope"></p>
<p>组件ApplicationComponent指定了作用域,组件中的模块modules = {NetModule.class}，也要指定相同的作用域。</p>
<p>NetModule中的方法设置@Singleton 那么ApplicationComponent也必须设置@Singleton</p>
<p>NetModule中的方法设置@MyScope 那么ApplicationComponent也必须设置@MyScope</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Singleton</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="组件依赖"><a href="#组件依赖" class="headerlink" title="组件依赖"></a>组件依赖</h4><p>08 0 9组件依赖有问题</p>
<p><img src="/2021/08/29/Dagger/2021-09-25_6.53.12_dependency1.png"></p>
<p><img src="/2021/08/29/Dagger/2021-09-25_6.53.28_dependency2.png"></p>
<p><a href="https://www.bilibili.com/video/BV1Ki4y1A7hA?p=07">https://www.bilibili.com/video/BV1Ki4y1A7hA?p=07</a></p>
<h4 id="Dagger-3要素"><a href="#Dagger-3要素" class="headerlink" title="Dagger 3要素"></a>Dagger 3要素</h4><p><img src="/2021/08/29/Dagger/2021-09-25_7.49.39_dagger3.png"></p>
<h5 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h5><p><img src="/2021/08/29/Dagger/Users/m/Documents/noteforme.github.io/source/_posts/Dagger/2021-09-25_8.59.52_inject.png" alt="2021-09-25_8.59.52_inject"></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>TEST_UNIT</title>
    <url>/2019/11/17/TEST-UNIT/</url>
    <content><![CDATA[<p>Test Driven Development</p>
<p>MainPrinciple:Write the test case before the implementation of the function (only for unit tests)</p>
<ol>
<li>Write the function signature</li>
<li>Write the test cases for the function</li>
<li>Write the function logic so the tests pass</li>
</ol>
<p>You  should only have one assertion per test case.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">object</span> RegistrationUtil &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> exitingUsers = listOf(<span class="string">&quot;Peter&quot;</span>,<span class="string">&quot;Carl&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * the input is not valid if...</span></span><br><span class="line"><span class="comment">     * ...the username /password is empty</span></span><br><span class="line"><span class="comment">     * ...the username is already taken</span></span><br><span class="line"><span class="comment">     * ...the confirmed password is not the same as the real password</span></span><br><span class="line"><span class="comment">     * ...the pasword contains less than 2 digits</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">validateRegistrationInput</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        userName: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        password: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        confirmedPassword: <span class="type">String</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span>:<span class="built_in">Boolean</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userName.isEmpty()||password.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (userName <span class="keyword">in</span> exitingUsers)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (password!=confirmedPassword)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (password.count&#123;it.isDigit()&#125;&lt;<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RegistrationUtilTest.kt</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.truth.Truth.assertThat</span><br><span class="line"><span class="keyword">import</span> org.junit.Test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegistrationUtilTest</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `empty username returns <span class="literal">false</span>`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> result = RegistrationUtil.validateRegistrationInput(</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123&quot;</span></span><br><span class="line">        )</span><br><span class="line">        assertThat(result).isFalse()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `valid username and correctly repeated password returns <span class="literal">true</span>`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> result = RegistrationUtil.validateRegistrationInput(</span><br><span class="line">            <span class="string">&quot;Philipp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123&quot;</span></span><br><span class="line">        )</span><br><span class="line">        assertThat(result).isTrue()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `username already exists returns <span class="literal">false</span>`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> result = RegistrationUtil.validateRegistrationInput(</span><br><span class="line">            <span class="string">&quot;Carl&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123&quot;</span></span><br><span class="line">        )</span><br><span class="line">        assertThat(result).isFalse()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `incorrectly confirmed password returns <span class="literal">false</span>`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> result = RegistrationUtil.validateRegistrationInput(</span><br><span class="line">            <span class="string">&quot;Philipp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;123456&quot;</span>,</span><br><span class="line">            <span class="string">&quot;abcdefg&quot;</span></span><br><span class="line">        )</span><br><span class="line">        assertThat(result).isFalse()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `empty password returns <span class="literal">false</span>`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> result = RegistrationUtil.validateRegistrationInput(</span><br><span class="line">            <span class="string">&quot;Philipp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;&quot;</span></span><br><span class="line">        )</span><br><span class="line">        assertThat(result).isFalse()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `less than 2 digit password returns <span class="literal">false</span>`<span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> result = RegistrationUtil.validateRegistrationInput(</span><br><span class="line">            <span class="string">&quot;Philipp&quot;</span>,</span><br><span class="line">            <span class="string">&quot;abcdefg5&quot;</span>,</span><br><span class="line">            <span class="string">&quot;abcdefg5&quot;</span></span><br><span class="line">        )</span><br><span class="line">        assertThat(result).isFalse()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://www.youtube.com/watch?v=W0ag98EDhGc&amp;list=PLQkwcJG4YTCSYJ13G4kVIJ10X5zisB2Lq&amp;index=3">https://www.youtube.com/watch?v=W0ag98EDhGc&amp;list=PLQkwcJG4YTCSYJ13G4kVIJ10X5zisB2Lq&amp;index=3</a></p>
]]></content>
      <categories>
        <category>TEST</category>
      </categories>
      <tags>
        <tag>Test</tag>
      </tags>
  </entry>
  <entry>
    <title>TEST_Espresso</title>
    <url>/2018/01/22/TEST_Espresso/</url>
    <content><![CDATA[<h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><p><a href="https://developer.android.com/training/testing/espresso/setup">https://developer.android.com/training/testing/espresso/setup</a></p>
<ol>
<li><p>dependencies</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">androidTestImplementation</span> &#x27;androidx.test.espresso:espresso-core:<span class="number">3</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;</span><br><span class="line">  <span class="attribute">androidTestImplementation</span> &#x27;androidx.test:runner:<span class="number">1</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;</span><br><span class="line">  <span class="attribute">androidTestImplementation</span> &#x27;androidx.test:rules:<span class="number">1</span>.<span class="number">1</span>.<span class="number">0</span>&#x27;</span><br><span class="line">  <span class="attribute">androidTestImplementation</span> &#x27;androidx.test.ext:junit:<span class="number">1</span>.<span class="number">1</span>.<span class="number">1</span>&#x27;</span><br></pre></td></tr></table></figure></li>
<li><p>practice</p>
</li>
</ol>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@Rule</span><br><span class="line">@JvmField</span><br><span class="line"><span class="keyword">val</span> rule = <span class="constructor">ActivityTestRule(TestActivity::<span class="params">class</span>.<span class="params">java</span>)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="keyword">fun</span> use<span class="constructor">AppContext()</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> appContext = <span class="module-access"><span class="module"><span class="identifier">InstrumentationRegistry</span>.</span></span>get<span class="constructor">Instrumentation()</span>.targetContext</span><br><span class="line">    <span class="keyword">assert</span><span class="constructor">Equals(<span class="string">&quot;com.john.kot&quot;</span>, <span class="params">appContext</span>.<span class="params">packageName</span>)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="keyword">fun</span> user<span class="constructor">_can_enter_first_name()</span>&#123;</span><br><span class="line">    on<span class="constructor">View(<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">firstName</span>)</span>).perform(<span class="keyword">type</span><span class="constructor">Text(<span class="string">&quot;Daniel&quot;</span>)</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="keyword">fun</span> user<span class="constructor">_can_enter_last_name()</span>&#123;</span><br><span class="line">    on<span class="constructor">View(<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">lastName</span>)</span>).perform(<span class="keyword">type</span><span class="constructor">Text(<span class="string">&quot;Malone&quot;</span>)</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Test</span><br><span class="line"><span class="keyword">fun</span> <span class="keyword">when</span><span class="constructor">_user_enters_first_and_last_name_check_to_confirm_that_message_is_correct()</span>&#123;</span><br><span class="line">    on<span class="constructor">View(<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">firstName</span>)</span>).perform(<span class="keyword">type</span><span class="constructor">Text(<span class="string">&quot;Jake&quot;</span>)</span>)</span><br><span class="line">    on<span class="constructor">View(<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">lastName</span>)</span>).perform(<span class="keyword">type</span><span class="constructor">Text(<span class="string">&quot;Smith&quot;</span>)</span>)</span><br><span class="line">    on<span class="constructor">View(<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">button</span>)</span>).perform(click<span class="literal">()</span>)</span><br><span class="line">    on<span class="constructor">View(<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">message</span>)</span>).check(matches(<span class="keyword">with</span><span class="constructor">Text(<span class="string">&quot;Welcome,Jake Smith&quot;</span>)</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="junit"><a href="#junit" class="headerlink" title="junit"></a>junit</h4><p>Junit主要要做到Android.jar代码隔离，测试方式比较简单</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Calculator mCalculator;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        mCalculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSum</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//expected: 6, sum of 1 and 5</span></span><br><span class="line">        assertEquals(<span class="number">6d</span>, mCalculator.sum(<span class="number">1d</span>, <span class="number">5d</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSubstract</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">1d</span>, mCalculator.substract(<span class="number">5d</span>, <span class="number">4d</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDivide</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">4d</span>, mCalculator.divide(<span class="number">20d</span>, <span class="number">5d</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testMultiply</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        assertEquals(<span class="number">10d</span>, mCalculator.multiply(<span class="number">2d</span>, <span class="number">5d</span>), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Espresso测试</p>
<p>使用方式：<a href="https://developer.android.com/training/testing/espresso/setup.html#add-espresso-dependencieshttps://developer.android.com/training/testing/espresso/basics.html">https://developer.android.com/training/testing/espresso/setup.html#add-espresso-dependencieshttps://developer.android.com/training/testing/espresso/basics.html</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">android.support.constraint.ConstraintLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:app</span>=<span class="string">&quot;http://schemas.android.com/apk/res-auto&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.test.InstrumentActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    &lt;TextView</span><br><span class="line">        android:id=&quot;@+id/tv_name&quot;</span><br><span class="line">        android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;EditText</span><br><span class="line">        android:id=&quot;@+id/et_name&quot;</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginTop=&quot;@dimen/dimen_10&quot;</span><br><span class="line">        android:hint=&quot;输入姓名&quot;</span><br><span class="line">        app:layout_constraintTop_toBottomOf=&quot;@+id/tv_name&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;Button</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:layout_marginTop=&quot;@dimen/dimen_10&quot;</span><br><span class="line">        android:onClick=&quot;sayClick&quot;</span><br><span class="line">        android:text=&quot;Say HELLO&quot;</span><br><span class="line">        app:layout_constraintTop_toBottomOf=&quot;@+id/et_name&quot; /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">android.support.constraint.ConstraintLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">public void say<span class="constructor">Click(View <span class="params">v</span>)</span> &#123;</span><br><span class="line">    TextView textView = find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">tv_name</span>)</span>;</span><br><span class="line">    EditText editText = find<span class="constructor">ViewById(R.<span class="params">id</span>.<span class="params">et_name</span>)</span>;</span><br><span class="line">    textView.set<span class="constructor">Text(<span class="string">&quot;Say HELLO!&quot;</span> + <span class="params">editText</span>.<span class="params">getText</span>()</span>.<span class="keyword">to</span><span class="constructor">String()</span> + <span class="string">&quot;!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">@<span class="constructor">RunWith(AndroidJUnit4.<span class="params">class</span>)</span></span><br><span class="line">@LargeTest</span><br><span class="line">public <span class="keyword">class</span> InstrumentActivityTest &#123;</span><br><span class="line">    <span class="keyword">private</span> static final String STRING_TO_BE_TYPED = <span class="string">&quot;Jon&quot;</span>;</span><br><span class="line">    @Rule</span><br><span class="line">    public ActivityTestRule&lt;InstrumentActivity&gt; instrumentActivityTestRule = <span class="keyword">new</span> ActivityTestRule&lt;&gt;(<span class="module-access"><span class="module"><span class="identifier">InstrumentActivity</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void say<span class="constructor">HelloTest()</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Espresso</span>.</span></span>on<span class="constructor">View(ViewMatchers.<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">et_name</span>)</span>).perform(<span class="module-access"><span class="module"><span class="identifier">ViewActions</span>.</span></span><span class="keyword">type</span><span class="constructor">Text(STRING_TO_BE_TYPED)</span>, close<span class="constructor">SoftKeyboard()</span>);</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Espresso</span>.</span></span>on<span class="constructor">View(ViewMatchers.<span class="params">withText</span>(<span class="string">&quot;Say HELLO&quot;</span>)</span>).perform(click<span class="literal">()</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String expectedText = <span class="string">&quot;Say HELLO!&quot;</span> + STRING_TO_BE_TYPED + <span class="string">&quot;!&quot;</span>;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">Espresso</span>.</span></span>on<span class="constructor">View(ViewMatchers.<span class="params">withId</span>(R.<span class="params">id</span>.<span class="params">tv_name</span>)</span>).check(<span class="module-access"><span class="module"><span class="identifier">ViewAssertions</span>.</span></span>matches(<span class="module-access"><span class="module"><span class="identifier">ViewMatchers</span>.</span></span><span class="keyword">with</span><span class="constructor">Text(<span class="params">expectedText</span>)</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://testing.googleblog.com/2008/12/static-methods-are-death-to-testability.html">https://testing.googleblog.com/2008/12/static-methods-are-death-to-testability.html</a></p>
<p><a href="https://www.jianshu.com/p/dc30338a3e84">https://www.jianshu.com/p/dc30338a3e84</a></p>
<p><a href="https://www.jianshu.com/p/03118c11c199">https://www.jianshu.com/p/03118c11c199</a><br><a href="https://github.com/googlesamples/android-testing">https://github.com/googlesamples/android-testing</a></p>
<p><a href="https://developer.android.com/training/testing">https://developer.android.com/training/testing</a></p>
<h5 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h5><ul>
<li> class not found </li>
</ul>
  <img src="/2018/01/22/TEST_Espresso/2020-02-2.png" alt="问题1" style="zoom: 33%;">

<p>  <a href="https://blog.csdn.net/xiaoluoli88/article/details/78657364">https://blog.csdn.net/xiaoluoli88/article/details/78657364</a></p>
]]></content>
      <categories>
        <category>TEST</category>
      </categories>
      <tags>
        <tag>Test</tag>
      </tags>
  </entry>
  <entry>
    <title>TEST_Robolectric</title>
    <url>/2019/06/13/TEST_Robolectric/</url>
    <content><![CDATA[<p>robolectric</p>
<p><a href="https://github.com/robolectric/robolectric">https://github.com/robolectric/robolectric</a></p>
<p>google官方 Fragment测试方法</p>
<p><a href="https://developer.android.google.cn/training/basics/fragments/testing">https://developer.android.google.cn/training/basics/fragments/testing</a></p>
<p>谷歌官方推荐的开源测试框架 Robolectric就是这么一个工具，简单来说它实现了一套可以在JVM上运行的Android代码。 谷歌官方推荐的开源测试框架 Robolectric就是这么一个工具，它实现了一套可以在JVM上运行的Android代码。</p>
<p><a href="https://juejin.cn/post/6844904054192111623">https://juejin.cn/post/6844904054192111623</a></p>
<h5 id="robolectric-Dependency"><a href="#robolectric-Dependency" class="headerlink" title="robolectric Dependency"></a>robolectric Dependency</h5><p><a href="https://www.youtube.com/watch?v=AiTh0rGMdjs">https://www.youtube.com/watch?v=AiTh0rGMdjs</a></p>
]]></content>
      <categories>
        <category>TEST</category>
      </categories>
      <tags>
        <tag>Test</tag>
      </tags>
  </entry>
  <entry>
    <title>TEST_MockK</title>
    <url>/2018/01/22/TEST_MockK/</url>
    <content><![CDATA[<p><a href="https://mockk.io/">https://mockk.io/</a></p>
<p><a href="https://www.jianshu.com/p/899e80120071">https://www.jianshu.com/p/899e80120071</a></p>
<h3 id="Mockito"><a href="#Mockito" class="headerlink" title="Mockito"></a>Mockito</h3><p><a href="https://www.javadoc.io/doc/org.mockito/mockito-core/3.10.0/org/mockito/ArgumentMatcher.html">https://www.javadoc.io/doc/org.mockito/mockito-core/3.10.0/org/mockito/ArgumentMatcher.html</a></p>
<p>Mockito通过equals()方法，来对方法参数进行验证。但是有时候我们需要更加灵活的参数需求，比如，匹配任何的String类型的参数等等。参数匹配器就是一个能够满足这些需求的工具。</p>
<p>Mockito框架中的Matchers类内建了很多参数匹配器，我们常用的Mockito对象就是继承自Matchers。比如anyInt()匹配任何int类型的参数，anyString()匹配任何字符串…</p>
<p><strong>如果使用了参数匹配器，那么所有的参数需要由匹配器来提供，否则将会报错。假如我们使用参数匹配器stubbing了mock对象的方法，那么在verify的时候也需要使用它</strong></p>
<p>MatchersTest.java</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">argumentMatchersTest1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map mapMock = mock(Map.class);</span><br><span class="line">        when(mapMock.put(anyInt(), anyString())).thenReturn(<span class="string">&quot;world&quot;</span>);</span><br><span class="line">        mapMock.put(<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        verify(mapMock).put(anyInt(), eq(<span class="string">&quot;hello&quot;</span>));</span><br><span class="line"><span class="comment">//        verify(mapMock).put(anyInt(), &quot;hello&quot;);</span></span><br><span class="line"></span><br><span class="line">        verify(mapMock).put(anyInt(), anyString());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="自定义匹配器"><a href="#自定义匹配器" class="headerlink" title="自定义匹配器"></a>自定义匹配器</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">argumentMatchersTest2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List mock = mock(List.class);</span><br><span class="line">    when(mock.addAll(argThat(<span class="keyword">new</span> IsListOfTwoElements()))).thenReturn(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    mock.addAll(Arrays.asList(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>));</span><br><span class="line">    verify(mock).addAll(argThat(<span class="keyword">new</span> IsListOfTwoElements()));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    verify(mock).addAll(argThat(list -&gt; list.size() == <span class="number">2</span>));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IsListOfTwoElements</span> <span class="keyword">implements</span> <span class="title">ArgumentMatcher</span>&lt;<span class="title">List</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(List list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list.size() == <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//printed in verification errors</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[list of 2 elements]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<p> 作用就是创建一个虚假得对象，在测试环境代替真实对象</p>
<ul>
<li>验证这个对象的某些方法的调用情况，调用了多少次，参数是什么</li>
<li>指定这个对象的某些方法的行为，返回特定的值，或者是执行特定的动作</li>
</ul>
<blockquote>
<p>注意：Mockito不支持mock匿名类、final类、静态方法和private方法。</p>
</blockquote>
<p> 示例：<a href="https://static.javadoc.io/org.mockito/mockito-core/2.16.0/org/mockito/Mockito.html">https://static.javadoc.io/org.mockito/mockito-core/2.16.0/org/mockito/Mockito.html</a></p>
<h5 id="mock与spy的区别"><a href="#mock与spy的区别" class="headerlink" title="mock与spy的区别"></a>mock与spy的区别</h5><figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">  @Test</span><br><span class="line">public void mock<span class="constructor">DifSpy()</span> throws Exception &#123;</span><br><span class="line">   User userMock = mock(<span class="module-access"><span class="module"><span class="identifier">User</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">   userMock.set<span class="constructor">Number(2)</span>;</span><br><span class="line">   <span class="built_in">int</span> num = userMock.get<span class="constructor">Number()</span>;</span><br><span class="line">   <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;mock返回  &quot;</span>+num);</span><br><span class="line"></span><br><span class="line">   User userSpy = spy(<span class="module-access"><span class="module"><span class="identifier">User</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">   userSpy.set<span class="constructor">Number(5)</span>;</span><br><span class="line">   <span class="module-access"><span class="module"><span class="identifier">System</span>.</span></span>out.println(<span class="string">&quot;spy返回   &quot;</span>+userSpy.get<span class="constructor">Number()</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> mock返回  0<br> spy返回   5</p>
<p>mock  :  如果不指定mock方法的特定行为，一个mock对象的所有非void方法都将返回默认值：int、long类型方法将返回0，boolean方法将返回false，对象方法将返回null等等；而void方法将什么都不做。</p>
<p>spy :      spy对象的方法默认调用真实的逻辑，mock对象的方法默认什么都不做，或直接返回默认值。</p>
<p><a href="https://www.jianshu.com/p/0a8bbfe6cba2">https://www.jianshu.com/p/0a8bbfe6cba2</a></p>
<p>实例讲解</p>
<p> <a href="http://blog.csdn.net/qq_17766199/article/details/78450007">http://blog.csdn.net/qq_17766199/article/details/78450007</a><br> <a href="https://github.com/ChrisZou/android-unit-testing-tutorial">https://github.com/ChrisZou/android-unit-testing-tutorial</a><br><a href="https://github.com/qingmei2/Sample_AndroidTest">https://github.com/qingmei2/Sample_AndroidTest</a></p>
<p>一个Android项目搞定所有主流架 mvp生成模板<br><a href="https://www.diycode.cc/topics/309">https://www.diycode.cc/topics/309</a><br><a href="https://github.com/boredream/DesignResCollection">https://github.com/boredream/DesignResCollection</a></p>
<h3 id="powermock"><a href="#powermock" class="headerlink" title="powermock"></a>powermock</h3><p><a href="https://blog.csdn.net/qq_17766199/article/details/78573390">https://blog.csdn.net/qq_17766199/article/details/78573390</a></p>
<h3 id="Robolectric"><a href="#Robolectric" class="headerlink" title="Robolectric"></a>Robolectric</h3><p><a href="http://robolectric.org/getting-started/">http://robolectric.org/getting-started/</a></p>
<p><a href="https://blog.csdn.net/qq_17766199/article/category/7226691">Robolectric</a></p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">testImplementation</span> <span class="string">&quot;org.robolectric:robolectric:3.8&quot;</span></span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">  <span class="section">testOptions</span> &#123;</span><br><span class="line">    <span class="section">unitTests</span> &#123;</span><br><span class="line">      <span class="attribute">includeAndroidResources</span> = <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Mockk"><a href="#Mockk" class="headerlink" title="Mockk"></a>Mockk</h3><h5 id="Constructor-mocks"><a href="#Constructor-mocks" class="headerlink" title="Constructor mocks"></a>Constructor mocks</h5><p>verify失败</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">  <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `mock different constuctor`<span class="params">()</span></span>&#123;</span><br><span class="line">        mockkConstructor(MockCls::<span class="class"><span class="keyword">class</span>)</span></span><br><span class="line"></span><br><span class="line">        every &#123; constructedWith&lt;MockCls&gt;().add(<span class="number">1</span>) &#125; returns <span class="number">2</span></span><br><span class="line">        every &#123;</span><br><span class="line">            constructedWith&lt;MockCls&gt;(OfTypeMatcher&lt;String&gt;(String::<span class="class"><span class="keyword">class</span>)).<span class="title">add</span></span>(<span class="number">2</span>) <span class="comment">// Mocks the constructor which takes a String</span></span><br><span class="line">        &#125; returns <span class="number">3</span></span><br><span class="line">        every &#123;</span><br><span class="line">            constructedWith&lt;MockCls&gt;(EqMatcher(<span class="number">4</span>)).add(any()) <span class="comment">// Mocks the constructor which takes an Int</span></span><br><span class="line">        &#125; returns <span class="number">4</span></span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="number">1</span>, MockCls().add(<span class="number">1</span>))</span><br><span class="line">        assertEquals(<span class="number">3</span>, MockCls(<span class="string">&quot;2&quot;</span>).add(<span class="number">2</span>))</span><br><span class="line">        assertEquals(<span class="number">4</span>, MockCls(<span class="number">4</span>).add(<span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">        verify &#123;</span><br><span class="line">            constructedWith&lt;MockCls&gt;().add(<span class="number">1</span>) <span class="comment">//这里不通过 </span></span><br><span class="line"><span class="comment">//            constructedWith&lt;MockCls&gt;(&quot;2&quot;).add(2)</span></span><br><span class="line">            constructedWith&lt;MockCls&gt;(EqMatcher(<span class="number">4</span>)).add(<span class="number">7</span>)</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>



<h5 id="为无返回值的方法分配默认行为"><a href="#为无返回值的方法分配默认行为" class="headerlink" title="为无返回值的方法分配默认行为"></a>为无返回值的方法分配默认行为</h5><p>把 every {…} 后面的 Returns 换成 just Runs ，就可以让 MockK 为这个没有返回值的方法分配一个默认行为。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">testGetGoods</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> goods = presenter!!.getGoods(<span class="number">1</span>)</span><br><span class="line">    every &#123; view.showLoading() &#125; just Runs</span><br><span class="line">    verify &#123; view.showLoading() &#125;</span><br><span class="line">    assertEquals(goods.name, <span class="string">&quot;纸巾&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="为所有模拟对象的方法分配默认行为"><a href="#为所有模拟对象的方法分配默认行为" class="headerlink" title="为所有模拟对象的方法分配默认行为"></a>为所有模拟对象的方法分配默认行为</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</span><br><span class="line">    MockKAnnotations.<span class="keyword">init</span>(<span class="keyword">this</span>, relaxed = <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="Annotation"><a href="#Annotation" class="headerlink" title="Annotation"></a>Annotation</h5><p>只要在 <code>@Before</code> 方法裡面加上 <code>MockKAnnotations.init(this)</code> 就能在外面用 Annotation 的方式 Mock 物件。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KidAnnotationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MockK</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> mother: Mother</span><br><span class="line"></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> kid: Kid</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setUp</span><span class="params">()</span></span> &#123;</span><br><span class="line">   			<span class="keyword">val</span> mother = mockk&lt;Mother&gt;() <span class="comment">// 不使用Annotation的版本</span></span><br><span class="line">        </span><br><span class="line">        MockKAnnotations.<span class="keyword">init</span>(<span class="keyword">this</span>)</span><br><span class="line">        kid = Kid(mother)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">wantMoney</span><span class="params">()</span></span> &#123;</span><br><span class="line">        every &#123; mother.giveMoney() &#125; returns <span class="number">30</span></span><br><span class="line">        kid.wantMoney()</span><br><span class="line">        assertEquals(<span class="number">30</span>, kid.money)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://medium.com/joe-tsai/mockk-%E4%B8%80%E6%AC%BE%E5%BC%B7%E5%A4%A7%E7%9A%84-kotlin-mocking-library-part-2-4-4be059331110">https://medium.com/joe-tsai/mockk-%E4%B8%80%E6%AC%BE%E5%BC%B7%E5%A4%A7%E7%9A%84-kotlin-mocking-library-part-2-4-4be059331110</a></p>
]]></content>
      <categories>
        <category>TEST</category>
      </categories>
      <tags>
        <tag>Test</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin-senior2</title>
    <url>/2021/09/11/kotlin-senior2/</url>
    <content><![CDATA[<h3 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h3><p><strong>Lambda表达式、匿名函数、双冒号+函数名这三个东西，都是函数类型的对象，他们都能够赋值给变量以及当作函数的参数传递！</strong></p>
<h5 id="Lambda表达式的格式"><a href="#Lambda表达式的格式" class="headerlink" title="Lambda表达式的格式"></a>Lambda表达式的格式</h5><ul>
<li><p>Lambda表达式被大括号包围着</p>
</li>
<li><p>Lambda表达式的参数在<code>-&gt;</code>的左边，如果没有参数，则只保留函数体</p>
</li>
<li><p>Lambda表达式的函数体在<code>-&gt;</code>的后面</p>
</li>
<li><p>Lambda表达式的返回类型值总为函数体最后一行代码的返回值类型</p>
</li>
</ul>
<h5 id="无参数，无返回值的Lambda表达式"><a href="#无参数，无返回值的Lambda表达式" class="headerlink" title="无参数，无返回值的Lambda表达式"></a>无参数，无返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> test01Lambda = &#123;</span><br><span class="line">    print(<span class="string">&quot;无参数,无返回值&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们同样将Lambda表达式赋值给了变量，这个变量是函数类型（<code>() -&gt; Unit</code>）的对象。</p>
<h5 id="有参数，无返回值的Lambda表达式"><a href="#有参数，无返回值的Lambda表达式" class="headerlink" title="有参数，无返回值的Lambda表达式"></a>有参数，无返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda = &#123; name: String -&gt;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个变量是函数类型（<code>(String) -&gt; Unit</code>）的对象。</p>
<p>如果我们手动给这个变量指明了类型，那么Lambda的参数类型还可以不写：</p>
<p>注意这个name参数 是回调方法传过来的参数.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda: (String) -&gt; <span class="built_in">Unit</span> = &#123; name -&gt;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候，Kotlin可以自动为我们推断出Lambda中这个参数的类型是String类型。</p>
<p>如果Lambda表达式的参数只有一个，我们甚至连这个参数都可以省略不写，那…我想使用这个参数的时候怎么办呢？我们可以用<code>it</code>来代替：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda: (String) -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="有参数，有返回值的Lambda表达式"><a href="#有参数，有返回值的Lambda表达式" class="headerlink" title="有参数，有返回值的Lambda表达式"></a>有参数，有返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> test03Lambda = &#123; doubleValue: <span class="built_in">Double</span> -&gt;</span><br><span class="line">    print(<span class="string">&quot;parameter is Double,Value is:<span class="variable">$doubleValue</span>&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;now parse Double into String&quot;</span>)</span><br><span class="line">    doubleValue.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lambda表达式的最后一行代码将作为返回值，因此它对应的函数类型为：<code>(Double) -&gt; String</code>。同样，如果变量已经确切的指定了类型，则Lambda表达式的参数类型可以省略，又由于只有一个参数，所以连参数都可以省略，Kotlin将使用it代替这个参数名。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> method: (String, String) -&gt; <span class="built_in">Unit</span> = &#123; aStr, bStr -&gt; println(<span class="string">&quot;a : <span class="variable">$aStr</span>, b:<span class="variable">$bStr</span>&quot;</span>) &#125;</span><br><span class="line">method(<span class="string">&quot;john&quot;</span>,<span class="string">&quot;男&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> method02 = &#123; println(<span class="string">&quot;john&quot;</span>)&#125;</span><br><span class="line"><span class="keyword">val</span> method03:(String)-&gt;<span class="built_in">Unit</span>=&#123;</span><br><span class="line">    println(<span class="string">&quot;传入的是:<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method03(<span class="string">&quot;Jon&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> method04:(<span class="built_in">Int</span>)-&gt;<span class="built_in">Unit</span>=&#123;</span><br><span class="line">    <span class="keyword">when</span>(it)&#123;</span><br><span class="line">        <span class="number">1</span>-&gt; println(<span class="string">&quot;等于1&quot;</span>)</span><br><span class="line">        <span class="keyword">in</span> <span class="number">20.</span>. <span class="number">30</span> -&gt; println(<span class="string">&quot;20 - 30的数字&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span> -&gt; println(<span class="string">&quot;都不满足&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">method04(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> method05 : (<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt; <span class="built_in">Unit</span> = &#123;aNumber,bNumber-&gt;</span><br><span class="line">    println(<span class="string">&quot;第一个: <span class="variable">$aNumber</span>, 第二个 : <span class="variable">$bNumber</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method05(<span class="number">1</span>,<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> method06 : (<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt; <span class="built_in">Unit</span> = &#123;aNumber,_-&gt;</span><br><span class="line">    println(<span class="string">&quot;第一个: <span class="variable">$aNumber</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method06(<span class="number">99</span>,<span class="number">88</span>)</span><br><span class="line"><span class="keyword">val</span> method07 : (String)-&gt;String = &#123;str -&gt; str&#125;</span><br><span class="line">println(method07(<span class="string">&quot;Jon&quot;</span>))</span><br></pre></td></tr></table></figure>







<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><h5 id="函数类型的书写格式"><a href="#函数类型的书写格式" class="headerlink" title="函数类型的书写格式"></a>函数类型的书写格式</h5><p>所有函数类型都有一个圆括号括起来的参数类型列表，以及一个返回类型：<code>(A, B) -&gt; C</code> ，参数列表与返回值类型之间通过 -&gt; 符号连接。<code>(A, B) -&gt; C</code>表示接收类型分别为 <code>A</code> 与 <code>B</code> 两个参数并返回一个 <code>C</code> 类型值的函数类型。</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> f: (<span class="built_in">Int</span>) -&gt; String</span><br></pre></td></tr></table></figure>

<p><code>(Int) -&gt; String</code>这就是一个函数类型。另外需要注意的是，即使函数类型的参数列表为空，也必须保留小括号，例如<code>() -&gt; String</code>；即使函数类型的返回值类型为Unit，也不可省略Unit不写，例如：<code>(Int) -&gt; Unit</code>。</p>
<h5 id="函数类型的对象使用"><a href="#函数类型的对象使用" class="headerlink" title="函数类型的对象使用"></a>函数类型的对象使用</h5><p><code>sum(1, 2)</code>这我可以理解，毕竟sum是一个函数，但是<code>block(1, 2)</code>这样也行？block可是一个函数类型的对象啊，函数类型的对象后面可以加括号调用？</p>
<p>没错，只有函数类型的对象可以，其实这是Kotlin为我们提供的一个语法糖，它本质上还是会去调用invoke函数，也就是说</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> block: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = ::sum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sum</span><span class="params">(firstNumber: <span class="type">Int</span>, secondNumber: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> firstNumber + secondNumber</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> block: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = ::sum</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下调用都是有返回值的,因为(Int, Int) -&gt; Int这个函数类型是有返回值的</span></span><br><span class="line">block(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">block.invoke(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">(::sum)(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">(::sum).invoke(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>Kotlin使用这种（函数类型对象能够使用括号访问）语法让我们感觉，嗯，block就是sum函数的替身，而实际上它是一个对象，一个函数类型的对象。</p>
<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><h5 id="什么是高阶函数"><a href="#什么是高阶函数" class="headerlink" title="什么是高阶函数"></a>什么是高阶函数</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>有没有想过为什么需要传一个匿名类过去？因为Framework会在该View被点击的时候调用我们在匿名类中实现的那个onClick方法，以便于执行我们自己的处理逻辑。</p>
<p>要是我们能直接将方法传过去就好了…梦该醒了，这是Java，只能通过接口 + 匿名内部类这种折中的方案来实现这样的需求。</p>
<p>而Kotlin有了函数类型，又有了高阶函数，意味着我们可以传入一段代码给函数了，函数可以在适当的时候执行我们传入的那段代码，完美的解决了这一痛点。</p>
<h5 id="高阶函数的使用案例"><a href="#高阶函数的使用案例" class="headerlink" title="高阶函数的使用案例"></a>高阶函数的使用案例</h5><p>虽然都是过滤找出符合要求的苹果，但是条件是不一样的。这个怎么做呢？最简单的方法就是写三个循环，每个循环中针对不同的条件对苹果集合进行筛选。但是我们完全可以使用高阶函数和函数类型优雅的实现这个功能：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleBean</span></span>(<span class="keyword">val</span> color:<span class="built_in">Int</span>, <span class="keyword">val</span> weight:<span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean))&#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>，filterApple函数主要的功能只是遍历集合，以及把符合条件的苹果添加到新的集合中返回，至于筛选的条件，filterApple函数并不知道，而是完全取决于predicate这个函数类型的参数，只要predicate返回true，则符合条件。这样我们可以在调用函数时动态地传入不同的过滤规则</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    filterApple(appleList, ::filterColorPredicate)</span><br><span class="line">    filterApple(appleList, ::filterWeightPredicate)</span><br><span class="line">    filterApple(appleList, ::filterColorAndWeightPredicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterWeightPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.weight &gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorAndWeightPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span> &amp;&amp; appleBean.weight &gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean)) &#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这…太麻烦了吧，我每次调用高阶函数，传入函数类型的时候，还必须要先定义一个函数，然后再使用<code>::函数名</code>传入吗？其实不必这么麻烦的，现在我们学习的只不过是其中的一种方式而已。下面我们就要来学习更加简单的方式：匿名函数。</p>
<h3 id="Lambda表达式与高阶函数"><a href="#Lambda表达式与高阶函数" class="headerlink" title="Lambda表达式与高阶函数"></a>Lambda表达式与高阶函数</h3><p>现在大家已经对Lambda表达式的写法了如指掌了，现在是时候来看看Lambda表达式如何与高阶函数配合使用了。还记得之前的那个筛选苹果的例子吗？我们定义了一个高阶函数，它的名字叫：filterApple，代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean)) &#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个高阶函数的第二个参数接收了一个函数类型的参数，在之前，我们分别使用了两种方式进行调用：</p>
<ol>
<li><p>双冒号的方式：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    filterApple(appleList, ::filterColorPredicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span></span><br></pre></td></tr></table></figure></li>
<li><p>匿名函数的方式：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">filterApple(appleList, <span class="function"><span class="title">fun</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.weight &gt; <span class="number">6</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>完整的写法</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">filterApple(appleList, &#123; appleBean: AppleBean -&gt; appleBean.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>简化的写法</p>
<p>我们怎么知道哪个参数需要传入Lambda表达式呢？当然是看被调用的这个高阶函数的定义啊，还记的这个高阶函数的样子吗？</p>
<p>我们怎么知道哪个参数需要传入Lambda表达式呢？当然是看被调用的这个高阶函数的定义啊，还记的这个高阶函数的样子吗？</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然第二个形参是一个函数类型的参数，并且已经明确的指出了形参的函数类型：<code>(AppleBean) -&gt; Boolean</code>（实际上也必须明确指出，否则报错）。根据我们前面所学习的知识，这种情况下，我们可以直接省略Lambda表达式中的参数类型，Kotlin会根据上下文自动推断：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">filterApple(appleList, &#123; appleBean -&gt; appleBean.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>再简化的写法</p>
<p>由于这个函数类型只需要一个参数，因此我们还可以省略参数的名字，Kotlin会使用it代替，这在之前的Lambda讲解中，都是讲过的：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">filterApple(appleList, &#123; it.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>再再简化的写法</p>
<p>第一个是：如果Lambda表达式作为函数的最后一个参数传入，那么它可以单独放在调用函数的括号后面：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">filterApple(appleList) &#123; it.weight &gt; <span class="number">6</span> &#125;</span><br></pre></td></tr></table></figure>

<p>第二个是：如果函数只接收一个函数类型的参数，我们传入Lambda表达式时，连函数调用的括号都可以去掉：</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    test &#123; num1, num2 -&gt;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(block: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        作者：HurryYu_YZH<br>​        链接：<a href="https://www.jianshu.com/p/8eb0623f08c6">https://www.jianshu.com/p/8eb0623f08c6</a></p>
<h3 id="项目实例"><a href="#项目实例" class="headerlink" title="项目实例"></a>项目实例</h3><h5 id="Login01-kt"><a href="#Login01-kt" class="headerlink" title="Login01.kt"></a>Login01.kt</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//传入一个具名函数，被调用后，获取参数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(resModel: <span class="type">ResModel</span>)</span></span>&#123;</span><br><span class="line">    println(resModel.int)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginModelImpl</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">loginOptions</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        mobileNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        metaInfo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        block: (<span class="type">model</span>: <span class="type">ResModel</span>) -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> model = ResModel(<span class="number">8</span>)</span><br><span class="line">        block(model)</span><br><span class="line">      <span class="comment">//  block.invoke(model) 这样写也可以 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResModel</span></span>(<span class="keyword">val</span> int: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">val</span> loginModelImpl = LoginModelImpl()</span><br><span class="line">    <span class="keyword">val</span> responseModel = ResModel(<span class="number">0</span>)</span><br><span class="line">    loginModelImpl.loginOptions(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,::test) <span class="comment">// 可以看到 fun test(resModel: ResModel)也被调用,可以理解被回调</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;model: ResModel -&gt; model.toString() &#125;)</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;model -&gt; model.toString() &#125;)</span></span><br><span class="line">    loginModelImpl.loginOptions(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,&#123;println(it.int)&#125;) <span class="comment">//lambda只有一个参数，传入参数也可以省略,&#123;&#125;里面用it代替</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;&#125;) // it可以用也可以不用</span></span><br></pre></td></tr></table></figure>



<h5 id="Login02-kt"><a href="#Login02-kt" class="headerlink" title="Login02.kt"></a>Login02.kt</h5><figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    loginAction(<span class="string">&quot;Jo1n&quot;</span>, <span class="string">&quot;123456&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (it) &#123;</span><br><span class="line">            println(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            println(<span class="string">&quot;登录失败&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loginAction</span><span class="params">(userName: <span class="type">String</span>, pwd: <span class="type">String</span>, loginResponseResult: (<span class="type">Boolean</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (userName == <span class="literal">null</span> || pwd == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">    loginEngine(userName, pwd, loginResponseResult)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loginEngine</span><span class="params">(userName: <span class="type">String</span>, pwd: <span class="type">String</span>, loginResponseResult: (<span class="type">Boolean</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;Jon&quot;</span> == userName &amp;&amp; <span class="string">&quot;123456&quot;</span> == pwd) &#123;</span><br><span class="line">        loginResponseResult(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        loginResponseResult(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <a href="https://www.bilibili.com/video/BV1xv411k7Dd?p=3&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1xv411k7Dd?p=3&amp;spm_id_from=pageDriver</a></p>
<h5 id="updateFastClickTime"><a href="#updateFastClickTime" class="headerlink" title="updateFastClickTime"></a>updateFastClickTime</h5><p>这个方法很形象, 匿名函数的参数 ,是回调时候传的</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">updateFastClickTime</span><span class="params">(callback: ((<span class="type">currentTime</span>: <span class="type">Long</span>, <span class="type">lastClickTime</span>: <span class="type">Long</span>) -&gt; <span class="type">Unit</span>)? = <span class="literal">null</span>)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> curClickTime = System.currentTimeMillis()</span><br><span class="line">    callback?.invoke(</span><br><span class="line">        curClickTime,</span><br><span class="line">        lastClickTime</span><br><span class="line">    )</span><br><span class="line">    lastClickTime = curClickTime</span><br><span class="line">    <span class="keyword">return</span> curClickTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="getOrElse"><a href="#getOrElse" class="headerlink" title="getOrElse"></a>getOrElse</h5><p> 匿名函数的参数 ,是回调时候传的,返回T类型.</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">getOrElse</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    index: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    defaultValue:(<span class="type">Int</span>) -&gt; <span class="type">T</span>       <span class="comment">//这个 (Int) -&gt; T 看不明白</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Array<span class="type">&lt;out T&gt;</span>.<span class="title">getOrElse</span><span class="params">(index: <span class="type">Int</span>, defaultValue: (<span class="type">Int</span>) -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt;= lastIndex) <span class="keyword">get</span>(index) <span class="keyword">else</span> defaultValue(index)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a href="https://bbs.csdn.net/topics/399173319">https://bbs.csdn.net/topics/399173319</a></p>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
  </entry>
  <entry>
    <title>Leetcode_Linklist</title>
    <url>/2021/08/30/Leetcode/</url>
    <content><![CDATA[<h4 id="20-有效的括号"><a href="#20-有效的括号" class="headerlink" title="20. 有效的括号"></a><a href="https://leetcode-cn.com/problems/valid-parentheses">20. 有效的括号</a></h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//官方 HashMap 解法更好 更清晰</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String s)</span> </span>&#123;</span><br><span class="line">    Stack stack = <span class="keyword">new</span> Stack();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">char</span> c = s.charAt(i);</span><br><span class="line">        <span class="keyword">if</span> ((c == <span class="string">&#x27;(&#x27;</span>) || c == <span class="string">&#x27;[&#x27;</span> || c == <span class="string">&#x27;&#123;&#x27;</span>) &#123;</span><br><span class="line">            stack.push(c);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (stack.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">boolean</span> p1 = (c == <span class="string">&#x27;)&#x27;</span> &amp;&amp; (<span class="keyword">char</span>) stack.peek() == <span class="string">&#x27;(&#x27;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">boolean</span> p2 = (c == <span class="string">&#x27;]&#x27;</span> &amp;&amp; (<span class="keyword">char</span>) stack.peek() == <span class="string">&#x27;[&#x27;</span>);</span><br><span class="line">            <span class="keyword">boolean</span> p3 = (c == <span class="string">&#x27;&#125;&#x27;</span> &amp;&amp; (<span class="keyword">char</span>) stack.peek() == <span class="string">&#x27;&#123;&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (p1 || p2 || p3) &#123;</span><br><span class="line">                stack.pop();</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                stack.push(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="21-合并两个有序链表"><a href="#21-合并两个有序链表" class="headerlink" title="21. 合并两个有序链表"></a><a href="https://leetcode-cn.com/problems/merge-two-sorted-lists/">21. 合并两个有序链表</a></h4><h5 id="递归解法"><a href="#递归解法" class="headerlink" title="递归解法"></a>递归解法</h5><figure class="highlight q"><table><tr><td class="code"><pre><span class="line">public ListNode mergeTwoLists(ListNode l1, ListNode l2) &#123;</span><br><span class="line">    ListNode prevHead = new ListNode(<span class="number">-1</span>);</span><br><span class="line">    ListNode  <span class="built_in">prev</span> = prevHead;</span><br><span class="line">    <span class="keyword">while</span> (l1 != <span class="built_in">null</span> &amp;&amp; l2 != <span class="built_in">null</span>) &#123;</span><br><span class="line">        if (l1.val &lt; l2.val) &#123;</span><br><span class="line">            <span class="built_in">prev</span>.<span class="built_in">next</span> = l1;</span><br><span class="line">            l1 = l1.<span class="built_in">next</span>;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            <span class="built_in">prev</span>.<span class="built_in">next</span> = l2;</span><br><span class="line">            l2 = l2.<span class="built_in">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">prev</span> = <span class="built_in">prev</span>.<span class="built_in">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (l1 == <span class="built_in">null</span>) &#123;</span><br><span class="line">        <span class="built_in">prev</span>.<span class="built_in">next</span> = l2;</span><br><span class="line">    &#125;</span><br><span class="line">    if (l2 == <span class="built_in">null</span>) &#123;</span><br><span class="line">        <span class="built_in">prev</span>.<span class="built_in">next</span> = l1;</span><br><span class="line">    &#125;</span><br><span class="line">    return prevHead.<span class="built_in">next</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="迭代解法"><a href="#迭代解法" class="headerlink" title="迭代解法"></a>迭代解法</h5><p>待学习</p>
<h4 id="160-相交链表"><a href="#160-相交链表" class="headerlink" title="160. 相交链表"></a><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/">160. 相交链表</a></h4><p>给你两个单链表的头节点 headA 和 headB ，请你找出并返回两个单链表相交的起始节点。如果两个链表没有交点，返回 null 。</p>
<p>图示两个链表在节点 c1 开始相交：</p>
<p><img src="https://assets.leetcode-cn.com/aliyun-lc-upload/uploads/2018/12/14/160_statement.png"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution_160</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> ListNode <span class="title">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> </span>&#123;</span><br><span class="line">        ListNode la = headA;</span><br><span class="line">        ListNode lb = headB;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(la!=lb)&#123;</span><br><span class="line">            la = (la==<span class="keyword">null</span>) ? headB : la.next;</span><br><span class="line">            lb = (lb==<span class="keyword">null</span>) ? headA : lb.next ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> la;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p><strong>先走自己的路，再走对方的路，最终路程一样</strong></p>
<p>可以这么理解，a，b两个链表，变更为 a+b 和 b+a，长度就相等了，然后等步遍历判断是否相等就行了</p>
<p>原始的数据</p>
<p><img src="https://pic.leetcode-cn.com/1628662967-RLmciV-2.png"></p>
<p>修改后的数据示意图</p>
<p><img src="https://pic.leetcode-cn.com/1628662688-ZdSYRM-1.png" alt="1.png"></p>
<p>!(<img src="https://pic.leetcode-cn.com/e86e947c8b87ac723b9c858cd3834f9a93bcc6c5e884e41117ab803d205ef662-%E7%9B%B8%E4%BA%A4%E9%93%BE%E8%A1%A8.png" alt="相交链表.png">)</p>
<h4 id="101-对称二叉树"><a href="#101-对称二叉树" class="headerlink" title="101. 对称二叉树"></a><a href="https://leetcode-cn.com/problems/symmetric-tree/">101. 对称二叉树</a></h4><p>迭代法需要再写下 </p>
]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
  </entry>
  <entry>
    <title>Operators</title>
    <url>/2018/01/07/Operators/</url>
    <content><![CDATA[<p> JAVA运算符</p>
<h4 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h4><pre><code>＆=      按位与赋值运算符　    C＆= 2等价于C = C＆2

| =     按位或赋值操作符       C | = 2等价于C = C | 2
</code></pre>
<p><a href="http://www.runoob.com/java/java-operators.html">http://www.runoob.com/java/java-operators.html</a></p>
<h4 id="Java位运算符"><a href="#Java位运算符" class="headerlink" title="Java位运算符"></a>Java位运算符</h4><p>Java定义了位运算符，应用于整数类型(int)，长整型(long)，短整型(short)，字符型(char)，和字节型(byte)等类型。</p>
<p>位运算符作用在所有的位上，并且按位运算。假设a = 60，b = 13;它们的二进制格式表示将如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">A</span> <span class="string">=</span> <span class="number">0011 </span><span class="number">1100</span></span><br><span class="line"><span class="string">B</span> <span class="string">=</span> <span class="number">0000 </span><span class="number">1101</span></span><br><span class="line"><span class="string">-----------------</span></span><br><span class="line"><span class="string">A&amp;B</span> <span class="string">=</span> <span class="number">0000 </span><span class="number">1100</span></span><br><span class="line"><span class="string">A</span> <span class="string">|</span> <span class="string">B</span> <span class="string">=</span> <span class="number">0011 </span><span class="number">1101</span></span><br><span class="line"><span class="string">A</span> <span class="string">^</span> <span class="string">B</span> <span class="string">=</span> <span class="number">0011 </span><span class="number">0001</span></span><br><span class="line"><span class="string">~A=</span> <span class="number">1100 </span><span class="number">0011</span></span><br></pre></td></tr></table></figure>

<p>下表列出了位运算符的基本运算，假设整数变量 A 的值为 60 和变量 B 的值为 13：</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>描述</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>＆ 按位与</td>
<td>如果相对应位都是1，则结果为1，否则为0</td>
<td>（A＆B），得到12，即0000 1100</td>
</tr>
<tr>
<td>| 按位或</td>
<td>如果相对应位都是 0，则结果为 0，否则为 1</td>
<td>（A | B）得到61，即 0011 1101</td>
</tr>
<tr>
<td>^ 按位异或</td>
<td>如果相对应位值相同，则结果为0，否则为1</td>
<td>（A ^ B）得到49，即 0011 0001</td>
</tr>
<tr>
<td>〜</td>
<td>按位取反运算符翻转操作数的每一位，即0变成1，1变成0。</td>
<td>（〜A）得到-61，即1100 0011</td>
</tr>
<tr>
<td>&lt;&lt;</td>
<td>按位左移运算符。左操作数按位左移右操作数指定的位数。</td>
<td>A &lt;&lt; 2得到240，即 1111 0000</td>
</tr>
<tr>
<td>&gt;&gt;</td>
<td>按位右移运算符。左操作数按位右移右操作数指定的位数。</td>
<td>A &gt;&gt; 2得到15即 1111</td>
</tr>
<tr>
<td>&gt;&gt;&gt;</td>
<td>按位右移补零操作符。左操作数的值按右操作数指定的位数右移，移动得到的空位以零填充。</td>
<td>A&gt;&gt;&gt;2得到15即0000 1111</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> a = <span class="number">60</span>; <span class="comment">/* 60 = 0011 1100 */</span> </span><br><span class="line">     <span class="keyword">int</span> b = <span class="number">13</span>; <span class="comment">/* 13 = 0000 1101 */</span></span><br><span class="line">     <span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line">     c = a &amp; b;       <span class="comment">/* 12 = 0000 1100 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;a &amp; b = &quot;</span> + c );</span><br><span class="line"> </span><br><span class="line">     c = a | b;       <span class="comment">/* 61 = 0011 1101 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;a | b = &quot;</span> + c );</span><br><span class="line"> </span><br><span class="line">     c = a ^ b;       <span class="comment">/* 49 = 0011 0001 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;a ^ b = &quot;</span> + c );</span><br><span class="line"> </span><br><span class="line">     c = ~a;          <span class="comment">/*-61 = 1100 0011 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;~a = &quot;</span> + c );</span><br><span class="line"> </span><br><span class="line">     c = a &lt;&lt; <span class="number">2</span>;     <span class="comment">/* 240 = 1111 0000 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;a &lt;&lt; 2 = &quot;</span> + c );</span><br><span class="line"> </span><br><span class="line">     c = a &gt;&gt; <span class="number">2</span>;     <span class="comment">/* 15 = 1111 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;a &gt;&gt; 2  = &quot;</span> + c );</span><br><span class="line">  </span><br><span class="line">     c = a &gt;&gt;&gt; <span class="number">2</span>;     <span class="comment">/* 15 = 0000 1111 */</span></span><br><span class="line">     System.out.println(<span class="string">&quot;a &gt;&gt;&gt; 2 = &quot;</span> + c );</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">a <span class="built_in">&amp;</span> b = 12</span><br><span class="line">a | b = 61</span><br><span class="line">a <span class="built_in">^</span> b = 49</span><br><span class="line">~a = -61</span><br><span class="line">a &lt;&lt; 2 = 240</span><br><span class="line">a &gt;&gt; 2  = 15</span><br><span class="line">a &gt;&gt;&gt; 2 = 15</span><br></pre></td></tr></table></figure>



<h4 id="Kotlin-位运算"><a href="#Kotlin-位运算" class="headerlink" title="Kotlin 位运算"></a>Kotlin 位运算</h4><p>对于位运算，没有特殊字符来表示，而只可用中缀方式调用具名函数，例如:</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute">val</span> x = (<span class="number">1</span> shl <span class="number">2</span>) and <span class="number">0</span>x<span class="number">000</span>FF<span class="number">000</span></span><br></pre></td></tr></table></figure>

<p>这是完整的位运算列表（只用于 <code>Int</code> 与 <code>Long</code>）：</p>
<ul>
<li><code>shl(bits)</code> – 有符号左移</li>
<li><code>shr(bits)</code> – 有符号右移</li>
<li><code>ushr(bits)</code> – 无符号右移</li>
<li><code>and(bits)</code> – 位<strong>与</strong></li>
<li><code>or(bits)</code> – 位<strong>或</strong></li>
<li><code>xor(bits)</code> – 位<strong>异或</strong></li>
<li><code>inv()</code> – 位非</li>
</ul>
<p><a href="https://www.kotlincn.net/docs/reference/basic-types.html#%E8%BF%90%E7%AE%97">https://www.kotlincn.net/docs/reference/basic-types.html#%E8%BF%90%E7%AE%97</a></p>
<p><a href="https://juejin.cn/post/6844903841293402126">https://juejin.cn/post/6844903841293402126</a></p>
]]></content>
      <tags>
        <tag>Operators</tag>
      </tags>
  </entry>
  <entry>
    <title>kotlin_begin</title>
    <url>/2019/11/02/kotlin-begin/</url>
    <content><![CDATA[<h4 id="Kotlin-in-Action"><a href="#Kotlin-in-Action" class="headerlink" title="Kotlin in Action"></a>Kotlin in Action</h4><h5 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h5><figure class="highlight coffeescript"><table><tr><td class="code"><pre><span class="line">val d: <span class="function"><span class="params">(<span class="built_in">String</span>, Int)</span> -&gt;</span> Unit <span class="regexp">//</span> 函数类型 (<span class="built_in">String</span>,Int) 接收参数 ，  Unit 返回类型</span><br></pre></td></tr></table></figure>





<h5 id="kotlin-lambda"><a href="#kotlin-lambda" class="headerlink" title="kotlin lambda"></a>kotlin lambda</h5><p>![Screen Shot 2020-08-01 at 6.39.38 PM](/Users/m/Documents/noteforme.github.io/source/_posts/kotlin/Screen Shot 2020-08-01 at 6.39.38 PM.png)</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">    val list = listOf(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;watermelon&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>    val result = list.maxBy &#123; it.length &#125;</span><br><span class="line"></span><br><span class="line">    val lambda = &#123; fruit: String -&gt;</span><br><span class="line">        fruit.length</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span>推导<span class="number">1</span></span><br><span class="line"><span class="regexp">//</span>    val result = list.maxBy(lambda)</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span>推导<span class="number">2</span></span><br><span class="line"><span class="regexp">//</span>    val result = list.maxBy(&#123;fruit:String-&gt;</span><br><span class="line"><span class="regexp">//</span>        fruit.length</span><br><span class="line"><span class="regexp">//</span>    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span>推导<span class="number">3</span></span><br><span class="line"><span class="regexp">//</span>    val result = list.maxBy(&#123; fruit: String -&gt;</span><br><span class="line"><span class="regexp">//</span>        fruit.length</span><br><span class="line"><span class="regexp">//</span>    &#125;)           <span class="regexp">//</span>如果一个函数， 他接收的最后一个参数是lambda表达式，那么这最后一个参数可以移到括号外面</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span>推导<span class="number">4</span></span><br><span class="line"><span class="regexp">//</span>    val result = list.maxBy&#123; fruit: String -&gt;</span><br><span class="line"><span class="regexp">//</span>        fruit.length         <span class="regexp">//</span>如果一个函数 ,括号可以省略</span><br><span class="line"><span class="regexp">//</span>    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span>推导<span class="number">4</span></span><br><span class="line"><span class="regexp">//</span>    val result = list.maxBy&#123; fruit -&gt;</span><br><span class="line"><span class="regexp">//</span>        fruit.length         <span class="regexp">//</span>kotlin类型推导机制，参数类型可以省略</span><br><span class="line"><span class="regexp">//</span>    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="regexp">//</span>推导<span class="number">5</span></span><br><span class="line">    val result = list.maxBy&#123;</span><br><span class="line">        it.length         <span class="regexp">//</span> lmbda表达式只有一个参数，参数可以省略 改用it替代</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    println(result)</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T,R:Comparable&lt;R&gt;</span>&gt; List<span class="type">&lt;T&gt;</span>.<span class="title">findMax</span><span class="params">(block: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>:T?&#123;</span><br><span class="line">    <span class="keyword">if</span> (isEmpty()) <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">    <span class="keyword">var</span> maxElement =<span class="keyword">get</span>(<span class="number">0</span>) <span class="comment">//获取List上下文的 第一个元素</span></span><br><span class="line">    <span class="keyword">var</span> maxValue = block(maxElement) <span class="comment">//block() 走到了 lambda方法中</span></span><br><span class="line">    <span class="keyword">for</span>(element <span class="keyword">in</span> <span class="keyword">this</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> value = block(element)</span><br><span class="line">        <span class="keyword">if</span> (value&gt; maxValue)&#123;</span><br><span class="line">            maxElement = element</span><br><span class="line">            maxValue = value</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> maxElement</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="comment">//    val result = list.findMax(lambda)</span></span><br><span class="line">    <span class="variable">val</span> <span class="variable"><span class="class">result</span></span> = <span class="variable">list.findMax</span>&#123;<span class="variable">it.length</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">println</span>(<span class="variable"><span class="class">result</span></span>)</span></span><br></pre></td></tr></table></figure>

<p><a href="https://www.bilibili.com/s/video/BV1Ut4y127xM">https://www.bilibili.com/s/video/BV1Ut4y127xM</a></p>
<p>1.Java定义的接口</p>
<p>2.单抽象方法</p>
<h5 id="Defining-and-calling-functions"><a href="#Defining-and-calling-functions" class="headerlink" title="Defining and calling functions"></a>Defining and calling functions</h5><ul>
<li><em>3.2.3 Getting rid of static utility classes: top-level functions and properties</em></li>
</ul>
<figure class="highlight arduino"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JoinJava</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">johnToString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;johnToString java&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.kotlin3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">johnToString</span><span class="params">()</span></span>&#123;</span><br><span class="line">    println(<span class="string">&quot;johnToString kotlin&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    johnToString()</span><br><span class="line">    JoinJava.johnToString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p><em>3.3.3 extension functions</em></p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">lastChar</span><span class="params">()</span></span> = <span class="keyword">this</span>.<span class="keyword">get</span>(<span class="keyword">this</span>.length-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addName</span><span class="params">()</span></span> = <span class="keyword">this</span> + <span class="string">&quot; john&quot;</span>	<span class="comment">//this 获取到String类的上下文</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> String.lastLetter: <span class="built_in">Char</span> <span class="keyword">get</span>()= <span class="keyword">get</span>(length-<span class="number">1</span>)  <span class="comment">//拓展属性</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">hellowrod</span><span class="params">()</span></span>&#123;</span><br><span class="line">    println(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">cpaitalEnd</span><span class="params">()</span></span>:String&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.isEmpty()) <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">val</span> charArray = <span class="keyword">this</span>.toCharArray()</span><br><span class="line">    charArray[length-<span class="number">1</span>] = charArray[length-<span class="number">1</span>].toUpperCase()</span><br><span class="line">    <span class="keyword">return</span> String(charArray)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">import com<span class="selector-class">.kotlin3</span><span class="selector-class">.t3_3_2</span>.addName</span><br><span class="line">import com<span class="selector-class">.kotlin3</span><span class="selector-class">.t3_3_2</span>.lastChar</span><br><span class="line">import com<span class="selector-class">.kotlin3</span><span class="selector-class">.t3_3_2</span>.lastLetter</span><br><span class="line"></span><br><span class="line">fun <span class="selector-tag">main</span>(args: Array&lt;String&gt;) &#123;</span><br><span class="line">   println(<span class="string">&quot;kotlin&quot;</span><span class="selector-class">.lastChar</span>())</span><br><span class="line">    println(<span class="string">&quot;kotlin&quot;</span><span class="selector-class">.addName</span>())</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;kotlin&quot;</span>.lastLetter)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="selector-class">.hellowrod</span>() <span class="comment">//输出  hello world</span></span><br><span class="line">    println(<span class="string">&quot;code&quot;</span><span class="selector-class">.cpaitalEnd</span>())	<span class="comment">// codE</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="Conventions-used-7-3"><a href="#Conventions-used-7-3" class="headerlink" title="Conventions used  7.3"></a><em>Conventions used</em>  7.3</h5><blockquote>
<p> 如果用 10..20构建一个普通的 区间(闭区间)，该区间则包括10到20的所有数字， 包括20。开区间10 until 20 包括从 10 到凹的数字，但不包括 20。矩形类通常定义成这样，它的底部和右 侧坐标不是矩形的一部分，因此在这里使用开区 间是合适的 。</p>
</blockquote>
<ul>
<li><p>Delegated - classs</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//原文链接：https://blog.csdn.net/xlh1191860939/article/details/99641573</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ServiceApi</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">(userName: <span class="type">String</span>, password: <span class="type">String</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Retrofit</span> : <span class="type">ServiceApi &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">login</span><span class="params">(userName: <span class="type">String</span>, password: <span class="type">String</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;login successfully.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 不用委托</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//class RemoteRepository : ServiceApi, NewsApi &#123;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    private val serverApi: ServiceApi = Retrofit()</span></span><br><span class="line"><span class="comment">//    private val retrofitApi: NewsApi = NewsApiImpl()</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    override fun login(username: String, password: String) &#123;</span></span><br><span class="line"><span class="comment">//        serverApi.login(username, password)</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//    override fun getNewsList() &#123;</span></span><br><span class="line"><span class="comment">//        retrofitApi.getNewsList()</span></span><br><span class="line"><span class="comment">//    &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *  使用kotlin 委托用下面简化</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RemoteRepository</span></span>(): ServiceApi <span class="keyword">by</span> Retrofit() , NewsApi <span class="keyword">by</span> NewsApiImpl()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">NewsApi</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getNewsList</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NewsApiImpl</span> : <span class="type">NewsApi &#123;</span></span></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getNewsList</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;NewsApiImpl: getNewsList()&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> repository = RemoteRepository()</span><br><span class="line">    repository.login(<span class="string">&quot;David&quot;</span>, <span class="string">&quot;123456&quot;</span>) <span class="comment">//输出 login successfully.</span></span><br><span class="line"></span><br><span class="line">    repository.getNewsList()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>7.5.2 使用委托属性:惰性初始化和 “by lazy()”</p>
</li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">//class Person(val name: String) &#123;</span></span><br><span class="line"><span class="comment">//    private var _emails: List&lt;Email&gt;? = null</span></span><br><span class="line"><span class="comment">//    val emails: List&lt;Email&gt;</span></span><br><span class="line"><span class="comment">//        get() &#123;</span></span><br><span class="line"><span class="comment">//            if (_emails == null) &#123;</span></span><br><span class="line"><span class="comment">//                _emails = loadEmails(this)</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            return _emails!!</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//你有一个属性， emails，用来存储这个值， 而另一个 emails，用来提供对属性的读取访 问 。你需要使用两个属性 ，因为属性 具有不同的类型: emails 可以为空，而 emails 为非空。这种技术经常会使用到， 值得熟练掌握。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>(<span class="keyword">val</span> name:String)&#123;</span><br><span class="line">    <span class="keyword">val</span> emails <span class="keyword">by</span> lazy&#123;</span><br><span class="line">        loadEmails(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loadEmails</span><span class="params">(person: <span class="type">Person</span>)</span></span>: List&lt;Email&gt;? &#123;</span><br><span class="line">    println (<span class="string">&quot;load emails for <span class="subst">$&#123;person.name &#125;</span>&quot;</span> )</span><br><span class="line">    <span class="keyword">return</span> listOf()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Person(<span class="string">&quot;Alice&quot;</span>)</span><br><span class="line">    p.emails</span><br><span class="line">    p.emails</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.im/post/5e1288d86fb9a048217a19d9">https://juejin.im/post/5e1288d86fb9a048217a19d9</a></p>
<p><a href="https://zhuanlan.zhihu.com/p/65914552">https://zhuanlan.zhihu.com/p/65914552</a></p>
<h5 id="委托Shareprefernce实战"><a href="#委托Shareprefernce实战" class="headerlink" title="委托Shareprefernce实战"></a>委托Shareprefernce实战</h5><ul>
<li><p>简易版本</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DelegateSharedPreferencesUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">object</span> User : Delegates() &#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getSharedPreferencesName</span><span class="params">()</span></span>: String = <span class="keyword">this</span>.javaClass.simpleName</span><br><span class="line">        <span class="keyword">var</span> name <span class="keyword">by</span> string()</span><br><span class="line">        <span class="keyword">var</span> phone <span class="keyword">by</span> long()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Delegates</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">val</span> preferences: SharedPreferences <span class="keyword">by</span> lazy &#123;</span><br><span class="line">            AppUtil.getApp().applicationContext.getSharedPreferences(</span><br><span class="line">                getSharedPreferencesName(),</span><br><span class="line">                Context.MODE_PRIVATE</span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">getSharedPreferencesName</span><span class="params">()</span></span>: String</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">int</span><span class="params">(defaultValue: <span class="type">Int</span> = <span class="number">0</span>)</span></span> = <span class="keyword">object</span> : ReadWriteProperty&lt;Any, <span class="built_in">Int</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> preferences.getInt(property.name, defaultValue)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">                preferences.edit().putInt(property.name, value).apply()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">string</span><span class="params">(defaultValue: <span class="type">String</span>? = <span class="literal">null</span>)</span></span> = <span class="keyword">object</span> : ReadWriteProperty&lt;Any, String?&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: String? &#123;</span><br><span class="line">                <span class="keyword">return</span> preferences.getString(property.name, defaultValue)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">String</span>?)</span></span> &#123;</span><br><span class="line">                preferences.edit().putString(property.name, value).apply()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">long</span><span class="params">(defaultValue: <span class="type">Long</span> = <span class="number">0</span>L)</span></span> = <span class="keyword">object</span> : ReadWriteProperty&lt;Any, <span class="built_in">Long</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> preferences.getLong(property.name, defaultValue)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">Long</span>)</span></span> &#123;</span><br><span class="line">                preferences.edit().putLong(property.name, value).apply()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">boolean</span><span class="params">(defaultValue: <span class="type">Boolean</span> = <span class="literal">false</span>)</span></span> = <span class="keyword">object</span> : ReadWriteProperty&lt;Any, <span class="built_in">Boolean</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> preferences.getBoolean(property.name, defaultValue)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">Boolean</span>)</span></span> &#123;</span><br><span class="line">                preferences.edit().putBoolean(property.name, value).apply()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">float</span><span class="params">(defaultValue: <span class="type">Float</span> = <span class="number">0.0</span>f)</span></span> = <span class="keyword">object</span> : ReadWriteProperty&lt;Any, <span class="built_in">Float</span>&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: <span class="built_in">Float</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> preferences.getFloat(property.name, defaultValue)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">Float</span>)</span></span> &#123;</span><br><span class="line">                preferences.edit().putFloat(property.name, value).apply()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">setString</span><span class="params">(defaultValue: <span class="type">Set</span>&lt;<span class="type">String</span>&gt;? = <span class="literal">null</span>)</span></span> = <span class="keyword">object</span> :</span><br><span class="line">            ReadWriteProperty&lt;DelegateSharedPreferencesUtils, Set&lt;String&gt;?&gt; &#123;</span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                thisRef: <span class="type">DelegateSharedPreferencesUtils</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                property: <span class="type">KProperty</span>&lt;*&gt;</span></span></span><br><span class="line"><span class="function"><span class="params">            )</span></span>: Set&lt;String&gt;? &#123;</span><br><span class="line">                <span class="keyword">return</span> preferences.getStringSet(property.name, defaultValue)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">                thisRef: <span class="type">DelegateSharedPreferencesUtils</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">                property: <span class="type">KProperty</span>&lt;*&gt;,</span></span></span><br><span class="line"><span class="function"><span class="params">                value: <span class="type">Set</span>&lt;<span class="type">String</span>&gt;?</span></span></span><br><span class="line"><span class="function"><span class="params">            )</span></span> &#123;</span><br><span class="line">                preferences.edit().putStringSet(property.name, value).apply()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">clearAll</span><span class="params">()</span></span> &#123;</span><br><span class="line">            preferences.edit().clear().apply()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">DelegateSharedPreferencesUtils</span>.</span><span class="module"><span class="identifier">User</span>.</span></span>name = <span class="string">&quot;john&quot;</span> <span class="comment">//存</span></span><br><span class="line"></span><br><span class="line">bt_get.setOnClickListener &#123;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;bt_get    &quot;</span>+<span class="module-access"><span class="module"><span class="identifier">DelegateSharedPreferencesUtils</span>.</span><span class="module"><span class="identifier">User</span>.</span></span>name) <span class="comment">//取</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://wazing.github.io/2019/05/23/kotlin-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A7%94%E6%89%98%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0SharedPreferences/">https://wazing.github.io/2019/05/23/kotlin-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A7%94%E6%89%98%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0SharedPreferences/</a></p>
</li>
<li><p>Pro version</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">object</span> SpUtil &#123;</span><br><span class="line">    <span class="keyword">val</span> SP by <span class="keyword">lazy</span> &#123;</span><br><span class="line">        <span class="module-access"><span class="module"><span class="identifier">AppUtil</span>.</span></span>get<span class="constructor">App()</span>.get<span class="constructor">SharedPreferences(<span class="string">&quot;default&quot;</span>, Context.MODE_PRIVATE)</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读 SP 存储项</span></span><br><span class="line">    <span class="keyword">fun</span> &lt;T&gt; get<span class="constructor">Value(<span class="params">name</span>: String, <span class="params">default</span>: T)</span>: T = <span class="keyword">with</span>(SP) &#123;</span><br><span class="line">        <span class="keyword">val</span> res: Any = <span class="keyword">when</span> (default) &#123;</span><br><span class="line">            is Long -&gt; get<span class="constructor">Long(<span class="params">name</span>, <span class="params">default</span>)</span></span><br><span class="line">            is String -&gt; get<span class="constructor">String(<span class="params">name</span>, <span class="params">default</span>)</span> ?: <span class="string">&quot;&quot;</span></span><br><span class="line">            is Int -&gt; get<span class="constructor">Int(<span class="params">name</span>, <span class="params">default</span>)</span></span><br><span class="line">            is Boolean -&gt; get<span class="constructor">Boolean(<span class="params">name</span>, <span class="params">default</span>)</span></span><br><span class="line">            is Float -&gt; get<span class="constructor">Float(<span class="params">name</span>, <span class="params">default</span>)</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; throw java.lang.<span class="constructor">IllegalArgumentException()</span></span><br><span class="line">        &#125;</span><br><span class="line">        res <span class="keyword">as</span> T</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写 SP 存储项</span></span><br><span class="line">    <span class="keyword">fun</span> &lt;T&gt; put<span class="constructor">Value(<span class="params">name</span>: String, <span class="params">value</span>: T)</span> = <span class="keyword">with</span>(<span class="module-access"><span class="module"><span class="identifier">SP</span>.</span></span>edit<span class="literal">()</span>) &#123;</span><br><span class="line">        <span class="keyword">when</span> (value) &#123;</span><br><span class="line">            is Long -&gt; put<span class="constructor">Long(<span class="params">name</span>, <span class="params">value</span>)</span></span><br><span class="line">            is String -&gt; put<span class="constructor">String(<span class="params">name</span>, <span class="params">value</span>)</span></span><br><span class="line">            is Int -&gt; put<span class="constructor">Int(<span class="params">name</span>, <span class="params">value</span>)</span></span><br><span class="line">            is Boolean -&gt; put<span class="constructor">Boolean(<span class="params">name</span>, <span class="params">value</span>)</span></span><br><span class="line">            is Float -&gt; put<span class="constructor">Float(<span class="params">name</span>, <span class="params">value</span>)</span></span><br><span class="line">            <span class="keyword">else</span> -&gt; throw <span class="constructor">IllegalArgumentException(<span class="string">&quot;This type can&#x27;t be saved into Preferences&quot;</span>)</span></span><br><span class="line">        &#125;.apply<span class="literal">()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xiaofei_dev</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@desc</span> 定义的 SP 存储项</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">object</span> SpBase&#123;</span><br><span class="line">    <span class="comment">//SP 存储项的键</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> CONTENT_SOMETHING = <span class="string">&quot;CONTENT_SOMETHING&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这就定义了一个 SP 存储项</span></span><br><span class="line">    <span class="comment">// 把 SP 的读写操作委托给 SPDelegates 类的一个实例（使用 by 关键字，by 是 Kotlin 语言层面的一个原语），</span></span><br><span class="line">    <span class="comment">// 此时访问 SpBase 的 contentSomething (你可以简单把其看成 Java 里的一个静态变量)属性即是在读取 SP 的存储项，</span></span><br><span class="line">    <span class="comment">// 给 contentSomething 属性赋值即是写 SP 的操作，就这么简单</span></span><br><span class="line">    <span class="comment">// 这里用到的 SPDelegates 对象的 getValue 方法的 thisRef（见上文） 参数的类型正是外层的 SpBase</span></span><br><span class="line">    <span class="keyword">var</span> contentSomething: String <span class="keyword">by</span> SPDelegates(CONTENT_SOMETHING, <span class="string">&quot;我是一个 SP 存储项，点击编辑我&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SPDelegates</span>&lt;<span class="type">T</span>&gt;</span>(<span class="keyword">private</span> <span class="keyword">val</span> key: String, <span class="keyword">private</span> <span class="keyword">val</span> default: T) : ReadWriteProperty&lt;Any?, T&gt; &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">return</span> SpUtil.getValue(key, default)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">setValue</span><span class="params">(thisRef: <span class="type">Any</span>?, property: <span class="type">KProperty</span>&lt;*&gt;, value: <span class="type">T</span>)</span></span> &#123;</span><br><span class="line">        SpUtil.putValue(key, value)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="module-access"><span class="module"><span class="identifier">SpBase</span>.</span></span>contentSomething = <span class="string">&quot;显示&quot;</span></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">bt_get.setOnClickListener &#123;</span><br><span class="line">      <span class="module-access"><span class="module"><span class="identifier">Timber</span>.</span></span>i(<span class="string">&quot;bt_get    &quot;</span>+<span class="module-access"><span class="module"><span class="identifier">SpBase</span>.</span></span>contentSomething)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a href="https://juejin.im/post/5e1bbf396fb9a02ffe702610">https://juejin.im/post/5e1bbf396fb9a02ffe702610</a></p>
<h5 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h5><ul>
<li><p>FindViewById</p>
<p>​    Kotlin不用findViewById 注意在Fragmet中 需要在onViewCreated后使用</p>
<p>​     <a href="https://blog.csdn.net/hust_twj/article/details/80290362">https://blog.csdn.net/hust_twj/article/details/80290362</a> </p>
<ul>
<li><p>The reason why we ignore findviewbyId</p>
<p><a href="https://antonioleiva.com/kotlin-android-extensions/">https://antonioleiva.com/kotlin-android-extensions/</a> </p>
</li>
</ul>
</li>
</ul>
<p>?  </p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">//kotlin:</span></span><br><span class="line"><span class="selector-tag">a</span>?<span class="selector-class">.foo</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//相当于java:</span></span><br><span class="line"><span class="selector-tag">if</span>(a!=null)&#123;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.foo</span>();</span><br><span class="line">&#125;<span class="selector-tag">else</span>&#123;</span><br><span class="line">   <span class="selector-tag">null</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>!!</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="comment">//kotlin:</span></span><br><span class="line"><span class="selector-tag">a</span>!!<span class="selector-class">.foo</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//相当于java:  </span></span><br><span class="line"><span class="selector-tag">if</span>(a!=null)&#123;</span><br><span class="line">  <span class="selector-tag">a</span><span class="selector-class">.foo</span>();</span><br><span class="line">&#125;<span class="selector-tag">else</span>&#123;</span><br><span class="line">  <span class="selector-tag">throw</span> <span class="selector-tag">new</span> <span class="selector-tag">KotlinNullPointException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>null or empty</li>
</ul>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">data = <span class="string">&quot; &quot;</span> <span class="comment">// this is a text with blank space </span></span><br><span class="line"></span><br><span class="line">println(data.is<span class="constructor">NullOrBlank()</span>?.<span class="keyword">to</span><span class="constructor">String()</span>)  <span class="comment">//true</span></span><br><span class="line">println(data.is<span class="constructor">NullOrEmpty()</span>?.<span class="keyword">to</span><span class="constructor">String()</span>)  <span class="comment">//false</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Elvis</li>
</ul>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">val <span class="symbol">ss:</span>String?=null</span><br><span class="line">println(ss <span class="string">?:</span> <span class="string">&quot;1&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>







<p><a href="https://developer.android.com/samples/?language=kotlin">https://developer.android.com/samples/?language=kotlin</a></p>
<p><a href="https://developer.android.com/kotlin/get-started">https://developer.android.com/kotlin/get-started</a></p>
<p><a href="https://www.jianshu.com/p/9fb9a1ab6c31">https://www.jianshu.com/p/9fb9a1ab6c31</a></p>
<p><a href="https://juejin.im/post/5aa64556f265da238c3a51d3">https://juejin.im/post/5aa64556f265da238c3a51d3</a></p>
<h4 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h4><p><a href="https://www.cnblogs.com/Jetictors/p/9225557.html">https://www.cnblogs.com/Jetictors/p/9225557.html</a></p>
<h5 id="by"><a href="#by" class="headerlink" title="by"></a>by</h5><p><a href="https://blog.csdn.net/wzgiceman/article/details/82689135">https://blog.csdn.net/wzgiceman/article/details/82689135</a></p>
<p>oprator</p>
<p><a href="https://zhuanlan.zhihu.com/p/26546977">https://zhuanlan.zhihu.com/p/26546977</a></p>
<h4 id="kotlin细节"><a href="#kotlin细节" class="headerlink" title="kotlin细节"></a>kotlin细节</h4><p><a href="https://juejin.im/post/5eeffd73f265da02ec0bc42e">https://juejin.im/post/5eeffd73f265da02ec0bc42e</a></p>
<ol>
<li><p>apply </p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">val</span> mDialPaint = <span class="constructor">Paint(Paint.ANTI_ALIAS_FLAG)</span></span><br><span class="line">mDialPaint.apply &#123;</span><br><span class="line">            color = <span class="module-access"><span class="module"><span class="identifier">Color</span>.</span></span>parse<span class="constructor">Color(<span class="string">&quot;#3333333&quot;</span>)</span></span><br><span class="line">            strokeWidth = arcWidth*<span class="number">8</span></span><br><span class="line">            textSize = <span class="number">65</span>f</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="coroutines"><a href="#coroutines" class="headerlink" title="coroutines"></a>coroutines</h5><p><a href="https://www.kotlincn.net/docs/reference/coroutines/coroutines-guide.html">https://www.kotlincn.net/docs/reference/coroutines/coroutines-guide.html</a></p>
<p><a href="https://juejin.im/post/5eea757a51882565ae5cb287">https://juejin.im/post/5eea757a51882565ae5cb287</a></p>
<p><a href="https://blog.csdn.net/xlh1191860939/article/details/99641573">https://blog.csdn.net/xlh1191860939/article/details/99641573</a></p>
<p>Android kotlin计划</p>
<p>ktx不是重心，重心在kotlin库如协程,paging3.0和compose</p>
<p><a href="https://www.bilibili.com/video/BV1fV411r7Lw">https://www.bilibili.com/video/BV1fV411r7Lw</a></p>
]]></content>
      <categories>
        <category>Kotlin</category>
      </categories>
  </entry>
  <entry>
    <title>BinarySearch</title>
    <url>/2021/10/31/BinarySearch/</url>
    <content><![CDATA[<p>BinarySearch</p>
<p>已经有序</p>
<h4 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h4><p>1    2    3    4    7    9    10     find     2</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">9</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">Left</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Right</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center">Right</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p>[0,6]</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//解法1 [0,nums.length-1]</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch1</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (target == nums[middle]) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[middle]) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h4><p>[0,7)</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th>7</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">9</td>
<td align="center">10</td>
<td></td>
</tr>
<tr>
<td align="center">Left</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td>Right</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center">Right</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 解法2 [0,nums.length)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch2</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = nums.length;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (target == nums[middle]) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[middle]) &#123;</span><br><span class="line">            right = middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>感觉还是解法1 不会容易出错。</p>
<p><a href="https://www.youtube.com/watch?v=6ysjqCUv3K4">https://www.youtube.com/watch?v=6ysjqCUv3K4</a></p>
<p><a href="https://www.youtube.com/watch?v=KXJSjte_OAI">https://www.youtube.com/watch?v=KXJSjte_OAI</a></p>
<p><a href="https://programmercarl.com/0704.%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html#%E6%80%9D%E8%B7%AF">https://programmercarl.com/0704.%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html#%E6%80%9D%E8%B7%AF</a></p>
<h4 id="35-搜索插入位置"><a href="#35-搜索插入位置" class="headerlink" title="35. 搜索插入位置"></a><a href="https://leetcode-cn.com/problems/search-insert-position/">35. 搜索插入位置</a></h4><p>这题没想到是插入left位置，最后一步right是可以移到   left位置或超过left,</p>
<p><a href="https://leetcode-cn.com/problems/search-insert-position/solution/sou-suo-cha-ru-wei-zhi-by-leetcode-solution/">https://leetcode-cn.com/problems/search-insert-position/solution/sou-suo-cha-ru-wei-zhi-by-leetcode-solution/</a></p>
]]></content>
      <categories>
        <category>DataStructure</category>
      </categories>
  </entry>
  <entry>
    <title>Language</title>
    <url>/2021/11/06/Language/</url>
    <content><![CDATA[<h5 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h5><p>Android &lt; 7.0一下和以上不同, </p>
<ol>
<li>7.0以下只要设置一次语言就可以</li>
<li>7.0或以上，必须在BaseActivity设置</li>
</ol>
<h5 id="BaseActivity处理所有的"><a href="#BaseActivity处理所有的" class="headerlink" title="BaseActivity处理所有的"></a>BaseActivity处理所有的</h5><p>省事的做法，调用attachBaseContext,一起设置</p>
<figure class="highlight kotlin"><table><tr><td class="code"><pre><span class="line"><span class="keyword">object</span> LanguageUtil &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">attachBaseContext</span><span class="params">(context: <span class="type">Context</span>, language: <span class="type">String</span>?)</span></span>: Context? &#123;</span><br><span class="line">        <span class="keyword">val</span> resources = context.resources</span><br><span class="line">        <span class="keyword">val</span> configuration = resources.configuration</span><br><span class="line">        <span class="keyword">val</span> locale = getLocaleByLanguage(language!!)</span><br><span class="line">        configuration.setLocale(locale)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            configuration.setLocales(LocaleList(locale))</span><br><span class="line">            context.createConfigurationContext(configuration)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">            <span class="comment">// updateConfiguration</span></span><br><span class="line">            <span class="keyword">val</span> dm = resources.displayMetrics</span><br><span class="line">            resources.updateConfiguration(configuration, dm)</span><br><span class="line">            context</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getLocaleByLanguage</span><span class="params">(language: <span class="type">String</span>)</span></span>: Locale &#123;</span><br><span class="line">        <span class="keyword">var</span> locale: Locale</span><br><span class="line">        <span class="keyword">if</span> (language == TNGLanguageEnumType.CN.language) &#123;</span><br><span class="line">            locale = Locale.SIMPLIFIED_CHINESE</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language == TNGLanguageEnumType.MY.language) &#123;</span><br><span class="line">            locale = Locale.forLanguageTag(<span class="string">&quot;ms&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            locale = Locale.ENGLISH</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TargetApi(Build.VERSION_CODES.N)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateResources</span><span class="params">(context: <span class="type">Context</span>, language: <span class="type">String</span>)</span></span>: Context &#123;</span><br><span class="line">        <span class="keyword">val</span> resources = context.resources</span><br><span class="line">        <span class="keyword">val</span> locale = getLocaleByLanguage(language)</span><br><span class="line">        <span class="keyword">val</span> configuration = resources.configuration</span><br><span class="line">        configuration.setLocale(locale)</span><br><span class="line">        configuration.setLocales(LocaleList(locale))</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(configuration)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setFontScaleLimit</span><span class="params">(context: <span class="type">Context</span>)</span></span>: Context? &#123;</span><br><span class="line">        <span class="keyword">val</span> config = Configuration(context.resources.configuration)</span><br><span class="line">        <span class="keyword">if</span> (config.fontScale &gt; <span class="number">1.2f</span> || config.fontScale &lt; <span class="number">1.0f</span>) &#123;</span><br><span class="line">            config.setToDefaults()</span><br><span class="line">            config.fontScale = <span class="number">1.1f</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(config)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="小于7-0设置一次"><a href="#小于7-0设置一次" class="headerlink" title="小于7.0设置一次"></a>小于7.0设置一次</h5><p>changeAppLanguage() 调这个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LanguageUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;LanguageUtil&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newLanguage 想要切换的语言类型 比如 &quot;en&quot; ,&quot;zh&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeAppLanguage</span><span class="params">(Context context, String newLanguage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(newLanguage)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">        Locale locale = getLocaleByLanguage(newLanguage);</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        <span class="comment">// updateConfiguration</span></span><br><span class="line">        DisplayMetrics dm = resources.getDisplayMetrics();</span><br><span class="line">        resources.updateConfiguration(configuration, dm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Locale <span class="title">getLocaleByLanguage</span><span class="params">(String language)</span> </span>&#123;</span><br><span class="line">        Locale locale = Locale.ENGLISH;</span><br><span class="line">        <span class="keyword">if</span> (language.equals(LanguageType.CHINESE.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.SIMPLIFIED_CHINESE;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language.equals(LanguageType.ENGLISH.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.ENGLISH;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language.equals(LanguageType.MY.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.forLanguageTag(language);</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;getLocaleByLanguage: &quot;</span> + locale.getDisplayCountry());</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">attachBaseContext</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            <span class="keyword">return</span> updateResources(context, language);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> context;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresApi(api = VERSION_CODES.N)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Context <span class="title">updateResources</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Locale locale = LanguageUtil.getLocaleByLanguage(language);</span><br><span class="line"></span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        configuration.setLocales(<span class="keyword">new</span> LocaleList(locale));</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">updateBaseContext</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        Locale locale = LanguageUtil.getLocaleByLanguage(language);</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            configuration.setLocales(<span class="keyword">new</span> LocaleList(locale));</span><br><span class="line">            <span class="keyword">return</span> context.createConfigurationContext(configuration);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">            <span class="comment">// updateConfiguration</span></span><br><span class="line">            DisplayMetrics dm = resources.getDisplayMetrics();</span><br><span class="line">            resources.updateConfiguration(configuration, dm);</span><br><span class="line">            <span class="keyword">return</span> context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> <a href="https://github.com/wisnukurniawan/changelanguage.git">https://github.com/wisnukurniawan/changelanguage.git</a></p>
<p><a href="https://www.jianshu.com/p/4f9db19d9383">https://www.jianshu.com/p/4f9db19d9383</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
  <entry>
    <title>coroutine_begin</title>
    <url>/2021/11/08/coroutine-begin/</url>
    <content><![CDATA[<img src="/2021/11/08/coroutine-begin/Users/m/Documents/noteforme.github.io/source/_posts/coroutine-begin/2021-11-08_9.15.13_.png" alt="2021-11-08_9.15.13_">



<p><img src="/2021/11/08/coroutine-begin/Users/m/Documents/noteforme.github.io/source/_posts/coroutine-begin/2021-11-08_9.20.36_.png" alt="2021-11-08_9.20.36_"></p>
<p><img src="/2021/11/08/coroutine-begin/Users/m/Documents/noteforme.github.io/source/_posts/coroutine-begin/2021-11-08_9.34.44_.png" alt="2021-11-08_9.34.44_"></p>
]]></content>
      <categories>
        <category>coroutine</category>
      </categories>
  </entry>
  <entry>
    <title>Font</title>
    <url>/2021/11/23/Font/</url>
    <content><![CDATA[<p><a href="https://segmentfault.com/a/1190000011299402">https://segmentfault.com/a/1190000011299402</a></p>
<p><a href="https://www.jianshu.com/p/4f9db19d9383">https://www.jianshu.com/p/4f9db19d9383</a></p>
<p><a href="https://github.com/WaterYuanData/Camera2New/tree/SwitchLanguage/testlanguage">https://github.com/WaterYuanData/Camera2New/tree/SwitchLanguage/testlanguage</a></p>
<p><a href="https://www.jianshu.com/p/7a81e5ef268d">https://www.jianshu.com/p/7a81e5ef268d</a></p>
<p><a href="https://blog.csdn.net/jdfkldjlkjdl/article/details/106279151">https://blog.csdn.net/jdfkldjlkjdl/article/details/106279151</a></p>
]]></content>
      <categories>
        <category>ANDROID</category>
      </categories>
  </entry>
</search>
