<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Fragment | Jon&#39;s Blog</title>
  <meta name="author" content="Jon">
  
  <meta name="description" content="https://juejin.cn/post/6970998913754988552#heading-16
https://developer.android.com/reference/android/app/Fragment.html
https://developer.android.com/">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Fragment"/>
  <meta property="og:site_name" content="Jon&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Jon&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Jon&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> Fragment</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6970998913754988552#heading-16">https://juejin.cn/post/6970998913754988552#heading-16</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/app/Fragment.html">https://developer.android.com/reference/android/app/Fragment.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/fragments.html">https://developer.android.com/guide/components/fragments.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.51cto.com/article/672135.html">https://www.51cto.com/article/672135.html</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7021398731056480269">https://juejin.cn/post/7021398731056480269</a></p>
<p><img src="/2017/10/05/Fragment/cb7551f416f143d99aeb8223af3bd776~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.png" alt="cb7551f416f143d99aeb8223af3bd776~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0"></p>
<p><img src="/2017/10/05/Fragment/2023-08-26-71.png" alt="2023-08-26-71"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">static final int INVALID_STATE &#x3D; -1;   &#x2F;&#x2F; 为空时无效</span><br><span class="line">static final int INITIALIZING &#x3D; 0;     &#x2F;&#x2F; 未创建</span><br><span class="line">static final int CREATED &#x3D; 1;          &#x2F;&#x2F; 已创建，位于后台</span><br><span class="line">static final int ACTIVITY_CREATED &#x3D; 2; &#x2F;&#x2F; Activity已经创建，Fragment位于后台</span><br><span class="line">static final int STOPPED &#x3D; 3;          &#x2F;&#x2F; 创建完成，没有开始</span><br><span class="line">static final int STARTED &#x3D; 4;          &#x2F;&#x2F; 开始运行，但是位于后台</span><br><span class="line">static final int RESUMED &#x3D; 5;          &#x2F;&#x2F; 显示到前台</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>作者：小松漫步<br>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7021398731056480269">https://juejin.cn/post/7021398731056480269</a></p>
<p>下面的lifecycle也可以看到,fragment生命周期的状态转移。</p>
<h2 id="Lifecycle"><a href="#Lifecycle" class="headerlink" title="Lifecycle"></a>Lifecycle</h2><p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/fragments/lifecycle">https://developer.android.com/guide/fragments/lifecycle</a></p>
<ul>
<li>onViewCreated(View view, Bundle savedInstanceState)</li>
</ul>
<p>Called immediately after <code>onCreateView(android.view.LayoutInflater, android.view.ViewGroup, android.os.Bundle)</code> has returned, but before any saved state has been restored in to the view.</p>
<img src="/2017/10/05/Fragment/fragment-view-lifecycle.png" alt="ff" style="zoom:67%;">



<h4 id="状态转移"><a href="#状态转移" class="headerlink" title="状态转移"></a>状态转移</h4><p>Fragment</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> INITIALIZING = -<span class="number">1</span>;          <span class="comment">// Not yet attached.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ATTACHED = <span class="number">0</span>;               <span class="comment">// Attached to the host.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CREATED = <span class="number">1</span>;                <span class="comment">// Created.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> VIEW_CREATED = <span class="number">2</span>;           <span class="comment">// View Created.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AWAITING_EXIT_EFFECTS = <span class="number">3</span>;  <span class="comment">// Downward state, awaiting exit effects</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ACTIVITY_CREATED = <span class="number">4</span>;       <span class="comment">// Fully created, not started.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> STARTED = <span class="number">5</span>;                <span class="comment">// Created and started, not resumed.</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AWAITING_ENTER_EFFECTS = <span class="number">6</span>; <span class="comment">// Upward state, awaiting enter effects</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> RESUMED = <span class="number">7</span>;                <span class="comment">// Created started and resumed.</span></span><br></pre></td></tr></table></figure>

<p><img src="/2017/10/05/Fragment/63280ec450454d56b03be2dd6d48a7fa~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0.png" alt="63280ec450454d56b03be2dd6d48a7fa~tplv-k3u1fbpfcp-zoom-in-crop-mark_1512_0_0_0"></p>
<p>这个图和现在fragment状态有点不同，现在新增了一些状态，有必要的话，自己研究绘制一张。</p>
<h2 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">commit();</span><br><span class="line">commitAllowingStateLoss();</span><br><span class="line">commitNow();</span><br><span class="line">commitNowAllowingStateLoss();</span><br></pre></td></tr></table></figure>



<h4 id="commitAllowingStateLoss-VS-commit"><a href="#commitAllowingStateLoss-VS-commit" class="headerlink" title="commitAllowingStateLoss VS  commit()"></a>commitAllowingStateLoss VS  commit()</h4><p>可以看到 allowStateLoss 如果是false，mHost,mDestroyed=true,就会crash了,否则只是return了,所以从这里看，他们区别不大。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">enqueueAction</span><span class="params">(<span class="meta">@NonNull</span> OpGenerator action, <span class="keyword">boolean</span> allowStateLoss)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!allowStateLoss) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mHost == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (mDestroyed) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;FragmentManager has been destroyed&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;FragmentManager has not been attached to a &quot;</span></span><br><span class="line">                        + <span class="string">&quot;host.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        checkStateLoss();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">synchronized</span> (mPendingActions) &#123;</span><br><span class="line">        <span class="keyword">if</span> (mHost == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (allowStateLoss) &#123;</span><br><span class="line">                <span class="comment">// This FragmentManager isn&#x27;t attached, so drop the entire transaction.</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">&quot;Activity has been destroyed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        mPendingActions.add(action);</span><br><span class="line">        scheduleCommit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://huxian99.github.io/2016/08/28/cj3qymo360000owxk9zp17alo/">https://huxian99.github.io/2016/08/28/cj3qymo360000owxk9zp17alo/</a></p>
<h4 id="commitNow-VS-commit"><a href="#commitNow-VS-commit" class="headerlink" title="commitNow VS  commit()"></a>commitNow VS  commit()</h4><h2 id="Fragment"><a href="#Fragment" class="headerlink" title="Fragment"></a>Fragment</h2><h4 id="Fragment-tag"><a href="#Fragment-tag" class="headerlink" title="Fragment tag"></a>Fragment tag</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;Op&gt; mOps &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">void doAddOp(int containerViewId, Fragment fragment, @Nullable String tag, int opcmd) &#123;</span><br><span class="line">    if (tag !&#x3D; null) &#123;</span><br><span class="line">        if (fragment.mTag !&#x3D; null &amp;&amp; !tag.equals(fragment.mTag)) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Can&#39;t change tag of fragment &quot;</span><br><span class="line">                    + fragment + &quot;: was &quot; + fragment.mTag</span><br><span class="line">                    + &quot; now &quot; + tag);</span><br><span class="line">        &#125;</span><br><span class="line">        fragment.mTag &#x3D; tag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (containerViewId !&#x3D; 0) &#123;</span><br><span class="line">        if (fragment.mFragmentId !&#x3D; 0 &amp;&amp; fragment.mFragmentId !&#x3D; containerViewId) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;Can&#39;t change container ID of fragment &quot;</span><br><span class="line">                    + fragment + &quot;: was &quot; + fragment.mFragmentId</span><br><span class="line">                    + &quot; now &quot; + containerViewId);</span><br><span class="line">        &#125;</span><br><span class="line">        fragment.mContainerId &#x3D; fragment.mFragmentId &#x3D; containerViewId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    addOp(new Op(opcmd, fragment));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终是把 fragment加入到 mOps 中</p>
<p><strong>Fragment本质是View</strong></p>
<p>「当然了Fragment本质是View但是又不仅限于此，」 在真实的项目中，界面往往很复杂，业务逻辑也很复杂，往往需要处理各种UI状态变化，比如：增加一组View，替换一组View，删除一组View，还需要和Activity协作。总之，如果让开发者自己去实现这一套逻辑，恐怕比使用Fragment要麻烦的多吧。尽管Fragment看起来蛮复杂的，但是还是远比我们自己去实现相同功能简单的多。</p>
<p><strong>3.1.2 Fragment本质不仅限于View</strong></p>
<p>Fragment作为一个View可以被添加到Activity的布局中去。但是他更强大，还有以下几个特性：</p>
<ol>
<li>处理生命周期，比Activity生命周期还要复杂</li>
<li>通过FragmentTransaction操作多个Fragment</li>
<li>通过FragmentManager维护一个回退栈，回退到上一个FragmentTransaction操作的界面</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.51cto.com/article/672135.html">https://www.51cto.com/article/672135.html</a></p>
<p><strong>commit() vs commitAllowingStateLoss()</strong></p>
<p>commit()和commitAllowingStateLoss()在实现上唯一的不同就是当你调用commit()的时候, FragmentManger会检查mDestory, mHost 如果mHost ==null, 就抛出IllegalStateException.</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7063377212736536607">https://juejin.cn/post/7063377212736536607</a></p>
<p><strong>FragmentPagerAdapter与FragmentStatePagerAdapter的区别</strong></p>
<p>FragmentPagerAdapter适用于页面较少的情况，destroyItem方法中只是调用了fragmentransaction的detach方法</p>
<p>FragmentStatePagerAdapter适用于页面较多的情况，每次切换ViewPager的时候是回收内存的。destroyItem调用了fragmentransaction的remove方法</p>
<p><strong>Fragment 各个方法细节</strong></p>
<p><a target="_blank" rel="noopener" href="https://fuhongliang.gitbooks.io/android/content/di-shi-san-zhang-mian-shi-ti/mu-ke-wang-quan-mian-sheng-ji-android-mian-shi/fragmentmian-shi-ti.html"><strong>https://fuhongliang.gitbooks.io/android/content/di-shi-san-zhang-mian-shi-ti/mu-ke-wang-quan-mian-sheng-ji-android-mian-shi/fragmentmian-shi-ti.html</strong></a></p>
<p>onSaveInstanceState 方法啥时候调用。</p>
<p>但是为什么要这么做呢？</p>
<p>原因是在Android 11版本后的activity会管理fragment，也就是说在activity 在执行onSaveInstanceState()的时候会保存fragment的状态，用于在恢复activity的时候使用。那么在保存fragment的状态后，就不能再去改变fragment的状态，也就是不允许提交事务，这样才能保障activity恢复的时候，可以显示原来fragment的状态。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xx326664162/article/details/88379490">https://blog.csdn.net/xx326664162/article/details/88379490</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19560943/article/details/78112903">https://blog.csdn.net/qq_19560943/article/details/78112903</a></p>
<p> 横竖屏切换</p>
<p>被系统回收（复现 进入开发者选项 -》不保留活动）</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c12a98a36b2b">https://www.jianshu.com/p/c12a98a36b2b</a></p>
<h5 id="BottomNavigationView-error"><a href="#BottomNavigationView-error" class="headerlink" title="BottomNavigationView error"></a>BottomNavigationView error</h5><p>使用BottomNavigationView出现很严重的问题,很久才找到原因</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Caused by: android.view.InflateException: Binary XML file line #16: Binary XML file line #16: Error inflating class com.google.android.material.bottomnavigation.BottomNavigationView</span><br><span class="line">    Caused by: android.view.InflateException: Binary XML file line #16: Error inflating class com.google.android.material.bottomnavigation.BottomNavigationView</span><br></pre></td></tr></table></figure>

<p>因为 AndroidManifest.xml  application下的android:theme=”@style/AppTheme”多出了,把下面的删除了就好了.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;item name&#x3D;&quot;android:textColorSecondary&quot;&gt;#ffffff&lt;&#x2F;item&gt;</span><br><span class="line">&lt;item name&#x3D;&quot;android:actionOverflowButtonStyle&quot;&gt;@style&#x2F;OverflowMenuStyle&lt;&#x2F;item&gt;</span><br><span class="line">&lt;item name&#x3D;&quot;android:listDivider&quot;&gt;@drawable&#x2F;divider&lt;&#x2F;item&gt;</span><br></pre></td></tr></table></figure>

<h5 id="重叠原因"><a href="#重叠原因" class="headerlink" title="重叠原因"></a>重叠原因</h5><blockquote>
<p> 旋转屏幕时候，创建的homeFragment会被回收,在销毁前，执行了onSaveInstanceState(Bundle outState)这个方法。这个方法会保存activity的一些信息，其中就包括添加过的fragment，Activity重建后，再次初始化homeFragment，接着显示，导致了重叠的问题。</p>
</blockquote>
<h5 id="代码验证"><a href="#代码验证" class="headerlink" title="代码验证"></a>代码验证</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">private fun initFragment() &#123;</span><br><span class="line">    if (homeFragment &#x3D;&#x3D; null) &#123;</span><br><span class="line">        homeFragment &#x3D; HomeFragment()</span><br><span class="line">        addFragment(homeFragment!!)</span><br><span class="line">        showFragment(homeFragment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    Timber.d(&quot;onCreate() $homeFragment&quot;)</span><br><span class="line">    initFragment()</span><br><span class="line">    Timber.d(&quot;initFragment() $homeFragment&quot;)   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> override fun onDestroy() &#123;</span><br><span class="line">        super.onDestroy()</span><br><span class="line">        Timber.tag(TAG).d(&quot;onDestroy() homeFragment $homeFragment&quot;)</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>日志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  641</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() homeFragment null</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;1adc3fa&#125; (b0660244-39c4-4104-b558-f5384c7adb0d) id&#x3D;0x7f09010e&#125;</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;1adc3fa&#125; (d84f5956-fa2c-4cd2-8397-0904040d2a6f)&#125;</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  641</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() homeFragment null</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;ac076db&#125; (f8ee348b-6ff7-4b1e-ba27-6e47e848f623) id&#x3D;0x7f09010e&#125;</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onRestoreInstanceState()</span><br><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br></pre></td></tr></table></figure>

<p>从 initFragment（） 1adc3fa , ac076db 可以看到，HomeFrgment重新创建了.</p>
<h5 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h5><ol>
<li><p>onSaveInstanceState 不保存信息</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onSaveInstanceState</span><span class="params">(outState: <span class="type">Bundle</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">//        super.onSaveInstanceState(outState)</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这种方式的弊端就是，切换后总是回到首页.</p>
</li>
<li><p>onSaveInstanceState() 保存Fragment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line"></span><br><span class="line">    if (savedInstanceState !&#x3D; null) &#123;</span><br><span class="line">        &#x2F;*获取保存的fragment  没有的话返回null*&#x2F;</span><br><span class="line">        homeFragment &#x3D; supportFragmentManager.getFragment(savedInstanceState, HOME_FRAGMENT_KEY) as HomeFragment?</span><br><span class="line">        healthFragment &#x3D; supportFragmentManager.getFragment(savedInstanceState, DASHBOARD_FRAGMENT_KEY) as HealthFragment?</span><br><span class="line">        personFragment &#x3D; supportFragmentManager.getFragment(savedInstanceState, NOTICE_FRAGMENT_KEY) as PersonFragment?</span><br><span class="line">        addToList(homeFragment)</span><br><span class="line">        addToList(healthFragment)</span><br><span class="line">        addToList(personFragment)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        initFragment()</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> override fun onSaveInstanceState(outState: Bundle) &#123;</span><br><span class="line">        super.onSaveInstanceState(outState)</span><br><span class="line">        Timber.d(&quot;MainActivity onSaveInstanceState&quot;)</span><br><span class="line">        &#x2F;*fragment不为空时 保存*&#x2F;if (homeFragment !&#x3D; null) &#123;</span><br><span class="line">            supportFragmentManager.putFragment(outState!!, HOME_FRAGMENT_KEY, homeFragment!!)</span><br><span class="line">        &#125;</span><br><span class="line">        if (healthFragment !&#x3D; null) &#123;</span><br><span class="line">            supportFragmentManager.putFragment(outState!!, DASHBOARD_FRAGMENT_KEY, healthFragment!!)</span><br><span class="line">        &#125;</span><br><span class="line">        if (personFragment !&#x3D; null) &#123;</span><br><span class="line">            supportFragmentManager.putFragment(outState!!, NOTICE_FRAGMENT_KEY, personFragment!!)</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br></pre></td></tr></table></figure></li>
</ol>
<p>这种方式，可以解决问题，但是打印的日志HomeFragment还是不一样，是什么情况？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  4437</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;dc2914d&#125; (5f30b0dd-a8d2-4b3c-a27f-1d160a9da58e) id&#x3D;0x7f09010e&#125;</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"> D&#x2F;TabBottomActivity$onCreate: navigation_health</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"> D&#x2F;TabBottomActivity: MainActivity onSaveInstanceState</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;dc2914d&#125; (ab276ea2-5fa2-4d79-b6a6-af7143b114e8)&#125;</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onCreate() taskId  4437</span><br><span class="line"> D&#x2F;TabBottomActivity: fragmentList数量1</span><br><span class="line"> D&#x2F;TabBottomActivity: fragmentList数量2</span><br><span class="line"> D&#x2F;TabBottomActivity: fragmentList数量2</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: initFragment() homeFragment HomeFragment&#123;9139494&#125; (5f30b0dd-a8d2-4b3c-a27f-1d160a9da58e) id&#x3D;0x7f09010e&#125;</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStart()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onRestoreInstanceState()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onResume()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onPause()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onSaveInstanceState()</span><br><span class="line"> D&#x2F;TabBottomActivity: MainActivity onSaveInstanceState</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onStop()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy()</span><br><span class="line"> D&#x2F;TabBottomActivity LaunchModeActivity: onDestroy() homeFragment HomeFragment&#123;9139494&#125; (cadcb63f-8516-4d44-8f3c-75b0c8e9f27f)&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yuzhiqiang_1993/article/details/75014591">https://blog.csdn.net/yuzhiqiang_1993/article/details/75014591</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/78ec81b42f92">https://www.jianshu.com/p/78ec81b42f92</a></p>
<h5 id="下面这种方式没理解"><a href="#下面这种方式没理解" class="headerlink" title="下面这种方式没理解"></a>下面这种方式没理解</h5><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d9143a92ad94">https://www.jianshu.com/p/d9143a92ad94</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c12a98a36b2b">https://www.jianshu.com/p/c12a98a36b2b</a></p>
<h2 id="横竖屏切换，Fragment实例复用"><a href="#横竖屏切换，Fragment实例复用" class="headerlink" title="横竖屏切换，Fragment实例复用"></a>横竖屏切换，Fragment实例复用</h2><p>setRetainInstance=true</p>
<p><strong>retainInstance = true已经过期，改用ViewModel</strong></p>
<p>LifeFragment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">    super.onCreate(savedInstanceState)</span><br><span class="line">    retainInstance &#x3D; true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">private fun initFragment() &#123;</span><br><span class="line">    var lifeFragment &#x3D; supportFragmentManager.findFragmentById(R.id.fl_content)</span><br><span class="line">    if (lifeFragment &#x3D;&#x3D; null) &#123;</span><br><span class="line">        lifeFragment &#x3D; LifeFragment()</span><br><span class="line">        supportFragmentManager.beginTransaction().add(R.id.fl_content, lifeFragment).commit()</span><br><span class="line">    &#125;</span><br><span class="line">    Timber.d(&quot;LifeFragment $lifeFragment&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切换屏幕后 LifeFragment,ondestroy()没志行,后面的Oncreate()也没有创建.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">D&#x2F;LifeActivity LaunchModeActivity: onCreate() taskId  599</span><br><span class="line">D&#x2F;LifeActivity: LifeFragment LifeFragment&#123;6a86311&#125; (70133a14-6dcf-4f8b-beee-6cd31d6623ba) id&#x3D;0x7f090109&#125;</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onAttach(Context context)</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onCreate() savedInstanceState    null</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onCreateView()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onActivityCreated()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onStart()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onResume()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onPause() </span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onStop()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onDestroyView()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onDetach()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onAttach(Context context)</span><br><span class="line">D&#x2F;LifeActivity LaunchModeActivity: onCreate() taskId  599</span><br><span class="line">D&#x2F;LifeActivity: LifeFragment LifeFragment&#123;6a86311&#125; (70133a14-6dcf-4f8b-beee-6cd31d6623ba) id&#x3D;0x7f090109&#125;</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onCreateView()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onActivityCreated()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onStart()</span><br><span class="line">D&#x2F;LifeFragment LaunchModeFragment: onResume()</span><br></pre></td></tr></table></figure>



<h5 id="Fragment之间传递数据"><a href="#Fragment之间传递数据" class="headerlink" title="Fragment之间传递数据"></a>Fragment之间传递数据</h5><ol>
<li><p>Fragment.setArguments()方法传递bundle</p>
</li>
<li><p>findFragmentById()找到tag,然后直接操作Framgent</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onArticleSelected</span><span class="params">(<span class="keyword">int</span> position)</span> </span>&#123;</span><br><span class="line">      ArticleFragment articleFrag = (ArticleFragment)</span><br><span class="line">              getSupportFragmentManager().findFragmentById(R.id.article_fragment);</span><br><span class="line">   </span><br><span class="line">      <span class="keyword">if</span> (articleFrag != <span class="keyword">null</span>) &#123;</span><br><span class="line">          articleFrag.updateArticleView(position);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ArticleFragment newFragment = <span class="keyword">new</span> ArticleFragment();</span><br><span class="line">          Bundle args = <span class="keyword">new</span> Bundle();</span><br><span class="line">          args.putInt(ArticleFragment.ARG_POSITION, position);</span><br><span class="line">          newFragment.setArguments(args);</span><br><span class="line">   </span><br><span class="line">          FragmentTransaction transaction = getSupportFragmentManager().beginTransaction();</span><br><span class="line">          transaction.replace(R.id.fragment_container, newFragment);</span><br><span class="line">          transaction.addToBackStack(<span class="keyword">null</span>);</span><br><span class="line">          transaction.commit();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>接口回调</p>
</li>
<li><p>ViewModel Livedata</p>
</li>
</ol>
<h5 id="给已经创建frament传递数据"><a href="#给已经创建frament传递数据" class="headerlink" title="给已经创建frament传递数据"></a>给已经创建frament传递数据</h5><p>也是直接 Fragment.refresh(),第一行代码第三版P227，也是这样做的。</p>
<h5 id="fragment回退栈"><a href="#fragment回退栈" class="headerlink" title="fragment回退栈"></a>fragment回退栈</h5><p>tx.addToBackStack(null); 添加回退功能，类似Activity压栈的过程</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fe16553ca2ca">https://www.jianshu.com/p/fe16553ca2ca</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zhiyuan0932/article/details/52593039">https://blog.csdn.net/zhiyuan0932/article/details/52593039</a></p>
<p>Fragment控制父Fragment展示</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/39491655/communication-between-nested-fragments-in-android">Communication between nested fragments in Android</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u011481547/article/details/71552720">https://blog.csdn.net/u011481547/article/details/71552720</a></p>
<p>Fragmet全局流程图</p>
<p><a target="_blank" rel="noopener" href="https://kotlintc.com/articles/5693">https://kotlintc.com/articles/5693</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/MOWdbI5IREjQP1Px-WJY1Q">https://mp.weixin.qq.com/s/MOWdbI5IREjQP1Px-WJY1Q</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5bcd58b6e51d45404c71d23f">https://juejin.im/post/5bcd58b6e51d45404c71d23f</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/_hdbMOA2TVvX4jFnMu15bg">https://mp.weixin.qq.com/s/_hdbMOA2TVvX4jFnMu15bg</a></p>

	  <div class="article-footer-copyright">

    本博客采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议(CC BY-NC-SA 4.0) 发布.</a>
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2017/10/07/DesignPattern_Builder/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2017/09/26/onActivityResult/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2017-10-05 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/ANDROID/">ANDROID<span>58</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Fragment/">Fragment<span>2</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 Jon's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
