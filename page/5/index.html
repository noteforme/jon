<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Jon&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
  
    <link rel="alternate" href="/atom.xml" title="Jon's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jon&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Cease to struggle and you cease to live. - Thomas Carlyle</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-coroutie-start2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/12/14/coroutie-start2/">coroutie-start2</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-12-14T00:05:39.000Z" itemprop="datePublished">2021年12月14日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Kotlin/">Kotlin</a>
  </div>

      
      
<a href="/2021/12/14/coroutie-start2/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>runblocking会等待子协程执行完成.</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1uo4y1y7ZF?p=24&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1uo4y1y7ZF?p=24&amp;spm_id_from=pageDriver</a></p>
<h5 id="P20-launch-async"><a href="#P20-launch-async" class="headerlink" title="P20 launch async"></a>P20 launch async</h5><p>Laugh 返回一个Job</p>
<p>Async , 返回Deffrred.</p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-13_1.04.30.png" alt="2021-12-13_1.04.30"></p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-13_1.12.31.png"></p>
<p>Async  返回执行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Job1 finished.</span><br><span class="line"></span><br><span class="line">Job2 finished</span><br><span class="line"></span><br><span class="line">Job2 finished</span><br></pre></td></tr></table></figure>





<h5 id="P21-join与await等待协程的作业"><a href="#P21-join与await等待协程的作业" class="headerlink" title="P21 join与await等待协程的作业"></a>P21 join与await等待协程的作业</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test coroutine join`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = launch() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;One&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    job1.join() <span class="comment">// job1执行完，再执行job2 job3</span></span><br><span class="line">    <span class="keyword">val</span> job2 = launch() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Two&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job3 = launch() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Three&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test coroutine await`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="comment">// 刷新界面，拿到执行结果后，再执行其他的。</span></span><br><span class="line">    <span class="keyword">val</span> job1 = async() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;One&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    job1.await() <span class="comment">// job1执行完，再执行job2 job3</span></span><br><span class="line">    <span class="keyword">val</span> job2 = async() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Two&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job3 = async() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Three&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>区别是await可以拿到执行结果，</p>
<p>接口1请求成功，拿到接口，再请求其他接口。</p>
<p>launch启动用 join()</p>
<p>async启动用 await()</p>
<h5 id="P22-async组合并发"><a href="#P22-async组合并发" class="headerlink" title="P22 async组合并发"></a>P22 async组合并发</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test sync`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = doOne()  <span class="comment">// 同步，串行任务</span></span><br><span class="line">        <span class="keyword">val</span> two = doTwo()</span><br><span class="line">        println(<span class="string">&quot;The result : <span class="subst">$&#123;one + two&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;completed in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test combine async`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = async&#123;doOne()&#125; <span class="comment">// 并发的两个异步任务</span></span><br><span class="line">        <span class="keyword">val</span> two = async&#123;doTwo()&#125;</span><br><span class="line">        println(<span class="string">&quot;The result : <span class="subst">$&#123;one.await() + two.await()&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;completed in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doOne</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">14</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doTwo</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>执行的结果相加</p>
<h5 id="协程的启动模式"><a href="#协程的启动模式" class="headerlink" title="协程的启动模式"></a>协程的启动模式</h5><p><img src="/2021/12/14/coroutie-start2/2021-12-14_9.17.33.png" alt="coroutie-start2"></p>
<p>CoroutineStart.DEFAULT</p>
<h5 id="p24-协程的作用域构建器"><a href="#p24-协程的作用域构建器" class="headerlink" title="p24 协程的作用域构建器"></a>p24 协程的作用域构建器</h5><p>runBlocking阻塞当前线程等待</p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-14_9.49.35.png" alt="coroutie-start2"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job1 finished.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job2 = async &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job2 finished.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>coroutineScope 也需要等待子协程执行结束，和 runBlocking很像.</p>
<p>区别coroutineScope是挂起函数.</p>
<p>coroutineScope与supervisorScope</p>
<p>还有SupervisorJob</p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-14_10.22.41.png" alt="coroutie-start2"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = launch &#123;</span><br><span class="line">        delay(<span class="number">400</span>)</span><br><span class="line">        println(<span class="string">&quot;Job1 finished.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job2 = async &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Job2 finished.&quot;</span>)</span><br><span class="line">        <span class="string">&quot;job2 result&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Job2 finished.<br>Job1 finished.</p>
<p>job2中断 job1也中断</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test coroutineScope scope builder`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        <span class="keyword">val</span> job1 = launch &#123;</span><br><span class="line">            delay(<span class="number">400</span>)</span><br><span class="line">            println(<span class="string">&quot;job1 finished.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> job2 = launch &#123;</span><br><span class="line">            delay(<span class="number">200</span>)</span><br><span class="line">            println(<span class="string">&quot;job2 finished.&quot;</span>)</span><br><span class="line">            <span class="string">&quot;job2 result&quot;</span></span><br><span class="line">            <span class="keyword">throw</span>  IllegalArgumentException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>job2 finished.</p>
<p>java.lang.IllegalArgumentException</p>
<p>两个协程都退出</p>
<p>job2中断 job1继续</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">fun &#96;test supervisorScope scope builder&#96;() &#x3D; runBlocking &#123;</span><br><span class="line">    supervisorScope &#123;</span><br><span class="line">        val job1 &#x3D; launch &#123;</span><br><span class="line">            delay(400)</span><br><span class="line">            println(&quot;job1 finished.&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        val job2 &#x3D; launch &#123;</span><br><span class="line">            delay(200)</span><br><span class="line">            println(&quot;job2 finished.&quot;)</span><br><span class="line">            &quot;job2 result&quot;</span><br><span class="line">            throw  IllegalArgumentException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>job2 finished.<br>Exception in thread “Test worker @coroutine#3”</p>
<p>Job1 finished.</p>
<h5 id="25-Job的生命周期"><a href="#25-Job的生命周期" class="headerlink" title="25 Job的生命周期"></a>25 Job的生命周期</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_10.46.51.png" alt="2022-03-20_10.46.51" style="zoom:67%;">



<img src="/2021/12/14/coroutie-start2/2022-03-20_10.47.57.png" alt="2022-03-20_10.47.57" style="zoom:67%;">





<h3 id="协程的取消"><a href="#协程的取消" class="headerlink" title="协程的取消"></a>协程的取消</h3><img src="/2021/12/14/coroutie-start2/2022-03-20_10.58.25.png" alt="2022-03-20_10.58.25" style="zoom:67%;">





<h5 id="26-取消作用域"><a href="#26-取消作用域" class="headerlink" title="26-取消作用域"></a>26-取消作用域</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `test scope cancel`<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">        scope.launch &#123;</span><br><span class="line">            delay(<span class="number">1000</span>)</span><br><span class="line">            println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        scope.launch &#123;</span><br><span class="line">            delay(<span class="number">1000</span>)</span><br><span class="line">            println(<span class="string">&quot;Job 2.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        delay(2000)  //需要加这个才能看到 打印,CoroutineScope没有继承runBlocking的上下文</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test scope cancel`<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">    scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 2.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)  <span class="comment">//需要加这个才能看到 打印</span></span><br><span class="line">    scope.cancel()</span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>CorountineScope和corountineScope的区别(大小写的区别，大写的可以取消)</p>
<img src="/2021/12/14/coroutie-start2/2022-03-20_11.14.10.png" alt="2022-03-20_11.14.10" style="zoom:67%;">



<h5 id="P27-取消兄弟协程"><a href="#P27-取消兄弟协程" class="headerlink" title="P27-取消兄弟协程"></a>P27-取消兄弟协程</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test scope cancel`<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">    <span class="keyword">val</span> job1 = scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> job2=scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 2.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)  <span class="comment">//需要加这个才能看到 打印</span></span><br><span class="line">    job1.cancel()</span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>被取消的协程，不会影响其余的兄弟协程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Job 2.</span><br></pre></td></tr></table></figure>





<h5 id="28-协程取消的异常"><a href="#28-协程取消的异常" class="headerlink" title="28-协程取消的异常"></a>28-协程取消的异常</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test CancellationException `<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = GlobalScope.launch &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            delay(<span class="number">1000</span>)</span><br><span class="line">            println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    job1.cancel(CancellationException(<span class="string">&quot;取消&quot;</span>))</span><br><span class="line">    job1.join() <span class="comment">// 否则不会打印GlobalScope不在runBlocking上下文</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>java.util.concurrent.CancellationException: 取消</p>
<h3 id="cpu密集型任务取消"><a href="#cpu密集型任务取消" class="headerlink" title="cpu密集型任务取消"></a>cpu密集型任务取消</h3><h5 id="29cpu密集型任务取消-isActive"><a href="#29cpu密集型任务取消-isActive" class="headerlink" title="29cpu密集型任务取消 isActive"></a>29cpu密集型任务取消 isActive</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_11.31.18.png" alt="2022-03-20_11.31.18" style="zoom:67%;">

<p>isActive判断取消，否则还是计算5次,这个和线程while操作很像</p>
<h5 id="p30-cpu密集型任务取消-ensureActive"><a href="#p30-cpu密集型任务取消-ensureActive" class="headerlink" title="p30- cpu密集型任务取消 - ensureActive"></a>p30- cpu密集型任务取消 - ensureActive</h5><p> 退出循环</p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.17.26.png" alt="2022-03-20_12.17.26"></p>
<h5 id="p31-yiled取消"><a href="#p31-yiled取消" class="headerlink" title="p31-yiled取消"></a>p31-yiled取消</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_12.18.27.png" alt="2022-03-20_12.18.27" style="zoom:67%;">

<img src="/2021/12/14/coroutie-start2/2022-03-20_12.19.29.png" alt="2022-03-20_12.19.29" style="zoom:50%;">





<h5 id="p32-coroutine取消副作用"><a href="#p32-coroutine取消副作用" class="headerlink" title="p32-coroutine取消副作用"></a>p32-coroutine取消副作用</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_12.26.32.png" alt="2022-03-20_12.26.32" style="zoom:67%;">

<img src="/2021/12/14/coroutie-start2/2022-03-20_12.27.16.png" alt="2022-03-20_12.27.16" style="zoom:67%;">

<h5 id="p33-标准函数use"><a href="#p33-标准函数use" class="headerlink" title="p33 标准函数use"></a>p33 标准函数use</h5><p>自动关闭文件对象</p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.29.38.png" alt="2022-03-20_12.29.38"></p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.30.36.png" alt="2022-03-20_12.30.36"></p>
<h5 id="34不能取消的任务"><a href="#34不能取消的任务" class="headerlink" title="34不能取消的任务"></a>34不能取消的任务</h5><p>NonCancellable </p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.32.18.png" alt="2022-03-20_12.32.18"></p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.34.23.png" alt="2022-03-20_12.34.23"></p>
<h5 id="35超时任务"><a href="#35超时任务" class="headerlink" title="35超时任务"></a>35超时任务</h5><p>网络请求超时</p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.38.56.png" alt="2022-03-20_12.38.56"></p>
<p>超时1300后的处理</p>
<p><img src="https://static001.geekbang.org/infoq/77/777b03f91e0335db9f67506ed186e143.png" alt="图片"></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coroutie/" rel="tag">coroutie</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Font" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/23/Font/">Font</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-11-23T14:15:14.000Z" itemprop="datePublished">2021年11月23日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2021/11/23/Font/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011299402">https://segmentfault.com/a/1190000011299402</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4f9db19d9383">https://www.jianshu.com/p/4f9db19d9383</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/WaterYuanData/Camera2New/tree/SwitchLanguage/testlanguage">https://github.com/WaterYuanData/Camera2New/tree/SwitchLanguage/testlanguage</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7a81e5ef268d">https://www.jianshu.com/p/7a81e5ef268d</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jdfkldjlkjdl/article/details/106279151">https://blog.csdn.net/jdfkldjlkjdl/article/details/106279151</a></p>
<p><a target="_blank" rel="noopener" href="https://proandroiddev.com/change-language-programmatically-at-runtime-on-android-5e6bc15c758">https://proandroiddev.com/change-language-programmatically-at-runtime-on-android-5e6bc15c758</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-coroutine-begin1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/08/coroutine-begin1/">coroutine_begin1</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-11-08T13:18:20.000Z" itemprop="datePublished">2021年11月08日</time>
</span>
      
      
      
<a href="/2021/11/08/coroutine-begin1/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h5 id="协程是什么-03"><a href="#协程是什么-03" class="headerlink" title="协程是什么 03"></a>协程是什么 03</h5><img src="/2021/11/08/coroutine-begin1/2021-11-08_9_15_13.png" style="zoom:67%;">





<h5 id="协程的挂起与恢复-08"><a href="#协程的挂起与恢复-08" class="headerlink" title="协程的挂起与恢复 08"></a>协程的挂起与恢复 08</h5><img src="/2021/11/08/coroutine-begin1/2021-11-08_9.20.36.png" style="zoom:67%;">

<img src="/2021/11/08/coroutine-begin1/2021-11-08_9.34.44.png" style="zoom:67%;">



<h5 id="挂起阻塞的区别-09"><a href="#挂起阻塞的区别-09" class="headerlink" title="挂起阻塞的区别 09"></a>挂起阻塞的区别 09</h5><img src="/2021/11/08/coroutine-begin1/2021-12-13_9.23.31_.png" style="zoom:67%;">

<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_9.53.43_.png" alt="2021-12-13_9.41.35_"></p>
<h5 id="协程的调度器-P13"><a href="#协程的调度器-P13" class="headerlink" title="协程的调度器 P13"></a>协程的调度器 P13</h5><ol>
<li><p>Dispatchers.Main</p>
</li>
<li><p>Dispatchers.IO</p>
</li>
<li><p>Dispatchers.Default</p>
</li>
</ol>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_9.57.42_.png"></p>
<h5 id="任务泄漏-P14"><a href="#任务泄漏-P14" class="headerlink" title="任务泄漏 P14"></a>任务泄漏 P14</h5><p><img src="/2021/11/08/coroutine-begin1/20220727203824.jpg" alt="20220727203824"></p>
<h5 id="结构化并发-p15"><a href="#结构化并发-p15" class="headerlink" title="结构化并发 p15"></a>结构化并发 p15</h5><p>使用结构化并发可以做到</p>
<p><img src="/2021/11/08/coroutine-begin1/20220727204523.jpg"></p>
<h5 id="CoutineScope-P16"><a href="#CoutineScope-P16" class="headerlink" title="CoutineScope P16"></a>CoutineScope P16</h5><p>GlobalScope</p>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_10.09.47_.png"></p>
<p>mainscope协程 可以通过抛出异常取消.</p>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_10.09.47_.png"></p>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_10.18.50_.png" alt="2021-12-13_10.18.50_"></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/coroutie/" rel="tag">coroutie</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Language" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/11/06/Language/">Language</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-11-06T08:06:32.000Z" itemprop="datePublished">2021年11月06日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2021/11/06/Language/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h5 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h5><p>Android &lt; 7.0一下和以上不同, </p>
<ol>
<li>7.0以下只要设置一次语言就可以</li>
<li>7.0或以上，必须在BaseActivity设置</li>
</ol>
<h5 id="BaseActivity处理所有的"><a href="#BaseActivity处理所有的" class="headerlink" title="BaseActivity处理所有的"></a>BaseActivity处理所有的</h5><p>省事的做法，调用attachBaseContext,一起设置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> LanguageUtil &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">attachBaseContext</span><span class="params">(context: <span class="type">Context</span>, language: <span class="type">String</span>?)</span></span>: Context? &#123;</span><br><span class="line">        <span class="keyword">val</span> resources = context.resources</span><br><span class="line">        <span class="keyword">val</span> configuration = resources.configuration</span><br><span class="line">        <span class="keyword">val</span> locale = getLocaleByLanguage(language!!)</span><br><span class="line">        configuration.setLocale(locale)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            configuration.setLocales(LocaleList(locale))</span><br><span class="line">            context.createConfigurationContext(configuration)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">            <span class="comment">// updateConfiguration</span></span><br><span class="line">            <span class="keyword">val</span> dm = resources.displayMetrics</span><br><span class="line">            resources.updateConfiguration(configuration, dm)</span><br><span class="line">            context</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getLocaleByLanguage</span><span class="params">(language: <span class="type">String</span>)</span></span>: Locale &#123;</span><br><span class="line">        <span class="keyword">var</span> locale: Locale</span><br><span class="line">        <span class="keyword">if</span> (language == TNGLanguageEnumType.CN.language) &#123;</span><br><span class="line">            locale = Locale.SIMPLIFIED_CHINESE</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language == TNGLanguageEnumType.MY.language) &#123;</span><br><span class="line">            locale = Locale.forLanguageTag(<span class="string">&quot;ms&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            locale = Locale.ENGLISH</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TargetApi(Build.VERSION_CODES.N)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateResources</span><span class="params">(context: <span class="type">Context</span>, language: <span class="type">String</span>)</span></span>: Context &#123;</span><br><span class="line">        <span class="keyword">val</span> resources = context.resources</span><br><span class="line">        <span class="keyword">val</span> locale = getLocaleByLanguage(language)</span><br><span class="line">        <span class="keyword">val</span> configuration = resources.configuration</span><br><span class="line">        configuration.setLocale(locale)</span><br><span class="line">        configuration.setLocales(LocaleList(locale))</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(configuration)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setFontScaleLimit</span><span class="params">(context: <span class="type">Context</span>)</span></span>: Context? &#123;</span><br><span class="line">        <span class="keyword">val</span> config = Configuration(context.resources.configuration)</span><br><span class="line">        <span class="keyword">if</span> (config.fontScale &gt; <span class="number">1.2f</span> || config.fontScale &lt; <span class="number">1.0f</span>) &#123;</span><br><span class="line">            config.setToDefaults()</span><br><span class="line">            config.fontScale = <span class="number">1.1f</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(config)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="小于7-0设置一次"><a href="#小于7-0设置一次" class="headerlink" title="小于7.0设置一次"></a>小于7.0设置一次</h5><p>changeAppLanguage() 调这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LanguageUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;LanguageUtil&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newLanguage 想要切换的语言类型 比如 &quot;en&quot; ,&quot;zh&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeAppLanguage</span><span class="params">(Context context, String newLanguage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(newLanguage)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">        Locale locale = getLocaleByLanguage(newLanguage);</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        <span class="comment">// updateConfiguration</span></span><br><span class="line">        DisplayMetrics dm = resources.getDisplayMetrics();</span><br><span class="line">        resources.updateConfiguration(configuration, dm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Locale <span class="title">getLocaleByLanguage</span><span class="params">(String language)</span> </span>&#123;</span><br><span class="line">        Locale locale = Locale.ENGLISH;</span><br><span class="line">        <span class="keyword">if</span> (language.equals(LanguageType.CHINESE.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.SIMPLIFIED_CHINESE;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language.equals(LanguageType.ENGLISH.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.ENGLISH;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language.equals(LanguageType.MY.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.forLanguageTag(language);</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;getLocaleByLanguage: &quot;</span> + locale.getDisplayCountry());</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">attachBaseContext</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            <span class="keyword">return</span> updateResources(context, language);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> context;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresApi(api = VERSION_CODES.N)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Context <span class="title">updateResources</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Locale locale = LanguageUtil.getLocaleByLanguage(language);</span><br><span class="line"></span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        configuration.setLocales(<span class="keyword">new</span> LocaleList(locale));</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">updateBaseContext</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        Locale locale = LanguageUtil.getLocaleByLanguage(language);</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            configuration.setLocales(<span class="keyword">new</span> LocaleList(locale));</span><br><span class="line">            <span class="keyword">return</span> context.createConfigurationContext(configuration);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">            <span class="comment">// updateConfiguration</span></span><br><span class="line">            DisplayMetrics dm = resources.getDisplayMetrics();</span><br><span class="line">            resources.updateConfiguration(configuration, dm);</span><br><span class="line">            <span class="keyword">return</span> context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> <a target="_blank" rel="noopener" href="https://github.com/wisnukurniawan/changelanguage.git">https://github.com/wisnukurniawan/changelanguage.git</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4f9db19d9383">https://www.jianshu.com/p/4f9db19d9383</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-LC_BinarySearch" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/31/LC_BinarySearch/">ArrayBinarySearch_2</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-10-31T09:01:21.000Z" itemprop="datePublished">2021年10月31日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/DataStructure/">DataStructure</a>
  </div>

      
      
<a href="/2021/10/31/LC_BinarySearch/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>BinarySearch</p>
<p>已经有序</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6ysjqCUv3K4">https://www.youtube.com/watch?v=6ysjqCUv3K4</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=KXJSjte_OAI">https://www.youtube.com/watch?v=KXJSjte_OAI</a></p>
<p>注意是 left 不是val mid = left + (right - left) / 2 而不是  val mid = right - (right - left) / 2 </p>
<h3 id="边界"><a href="#边界" class="headerlink" title="边界"></a>边界</h3><p>leetcode收藏了</p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-xiang-jie-by-labuladong/">https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-xiang-jie-by-labuladong/</a></p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-de-xun-huan-bu-bian-liang-zhi-yao-/">https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-de-xun-huan-bu-bian-liang-zhi-yao-/</a></p>
<p><a target="_blank" rel="noopener" href="https://programmercarl.com/0704.%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html#%E6%80%9D%E8%B7%AF">https://programmercarl.com/0704.%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html#%E6%80%9D%E8%B7%AF</a></p>
<h5 id="防止溢出"><a href="#防止溢出" class="headerlink" title="防止溢出"></a>防止溢出</h5><p>计算 mid 时需要防止溢出，代码中 left + (right - left) / 2 就和 (left + right) / 2 的结果相同，但是有效防止了 left 和 right 太大直接相加导致溢出。</p>
<h4 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h4><p>1    2    3    4    7    9    10     find     2</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">9</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">Left</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Right</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center">Right</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p>[0,6]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解法1 [0,nums.length-1]</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch1</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (target == nums[middle]) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[middle]) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h4><p>[0,7)</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th>7</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">9</td>
<td align="center">10</td>
<td></td>
</tr>
<tr>
<td align="center">Left</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td>Right</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center">Right</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解法2 [0,nums.length)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">binarySearch2</span><span class="params">(<span class="keyword">int</span>[] nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> right = nums.length;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">int</span> middle = (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (target == nums[middle]) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[middle]) &#123;</span><br><span class="line">            right = middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>感觉还是解法1 不会容易出错。</p>
<h4 id="34-在排序数组中查找元素的第一个和最后一个位置-opens-new-window"><a href="#34-在排序数组中查找元素的第一个和最后一个位置-opens-new-window" class="headerlink" title="34.在排序数组中查找元素的第一个和最后一个位置(opens new window)"></a><a target="_blank" rel="noopener" href="https://programmercarl.com/0034.%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E4%BD%8D%E7%BD%AE.html">34.在排序数组中查找元素的第一个和最后一个位置(opens new window)</a></h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/solution/zai-pai-xu-shu-zu-zhong-cha-zhao-yuan-su-de-di-3-4/">https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/solution/zai-pai-xu-shu-zu-zhong-cha-zhao-yuan-su-de-di-3-4/</a></p>
<p>有符号 无符号的区别</p>
<ul>
<li>对于<strong>有</strong>符号整数，每一次右移操作，高位补充的是<strong>1</strong>；</li>
<li>对于<strong>无</strong>符号整数，每一次右移操作，高位补充的则是<strong>0</strong>；</li>
</ul>
<p>0x80000000</p>
<p>0xc0000000</p>
<p>0x40000000</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903969915944973">https://juejin.cn/post/6844903969915944973</a></p>
<h4 id="35-搜索插入位置"><a href="#35-搜索插入位置" class="headerlink" title="35. 搜索插入位置"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-insert-position/">35. 搜索插入位置</a></h4><p>(right - left) / 2   如果用  ((right - left) shr  2) 那么(right - left)要括起来，否则会符号优先级有问题.</p>
<p>这题没想到是插入left位置，最后一步right是可以移到   left位置或超过left,</p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-insert-position/solution/sou-suo-cha-ru-wei-zhi-by-leetcode-solution/">https://leetcode-cn.com/problems/search-insert-position/solution/sou-suo-cha-ru-wei-zhi-by-leetcode-solution/</a></p>
<h4 id="69-x-的平方根"><a href="#69-x-的平方根" class="headerlink" title="69.x 的平方根"></a><del>69.x 的平方根</del></h4><p>​    这题我的解法是这样的，但是还有问题 没通过</p>
<ol>
<li>mid * mid.toLong() ,为什么</li>
<li>right - left + 1 即使退出循环</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    fun mySqrt(x: Int): Int &#123;</span><br><span class="line">        var left &#x3D; 0</span><br><span class="line">        var right &#x3D; x</span><br><span class="line">        while (left &lt; right) &#123;</span><br><span class="line">            val mid &#x3D; left + (right - left + 1) &#x2F; 2</span><br><span class="line">            &#x2F;&#x2F; 调试语句开始</span><br><span class="line">&#x2F;&#x2F;            try &#123;</span><br><span class="line">&#x2F;&#x2F;                Thread.sleep(1000);</span><br><span class="line">&#x2F;&#x2F;            &#125; catch (e: InterruptedException) &#123;</span><br><span class="line">&#x2F;&#x2F;                e.printStackTrace()</span><br><span class="line">&#x2F;&#x2F;            &#125;</span><br><span class="line">&#x2F;&#x2F;            println(&quot;left &#x3D; $left, right &#x3D; $right, mid &#x3D; $mid&quot;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;            链接：https:&#x2F;&#x2F;leetcode-cn.com&#x2F;problems&#x2F;sqrtx&#x2F;solution&#x2F;er-fen-cha-zhao-niu-dun-fa-python-dai-ma-by-liweiw&#x2F;</span><br><span class="line">            if (mid * mid &#x3D;&#x3D; x) &#123;</span><br><span class="line">                return mid</span><br><span class="line">            &#125; else if (mid * mid.toLong() &lt; x) &#123;</span><br><span class="line">                left &#x3D; mid</span><br><span class="line">            &#125; else if (mid * mid.toLong() &gt; x) &#123;</span><br><span class="line">                right &#x3D; mid - 1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return left;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sqrtx/solution/er-fen-cha-zhao-niu-dun-fa-python-dai-ma-by-liweiw/">https://leetcode-cn.com/problems/sqrtx/solution/er-fen-cha-zhao-niu-dun-fa-python-dai-ma-by-liweiw/</a></p>
<p>有为什么产生死循环的讲解</p>
<p>367.有效的完全平方数</p>
<ol>
<li><p>解答</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LC367</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">isPerfectSquare</span><span class="params">(num: <span class="type">Int</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> left = <span class="number">1</span></span><br><span class="line">        <span class="keyword">var</span> right = num</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">var</span> mid = left + (right - left) / <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> (mid * mid == num) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mid * mid &gt; num) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mid * mid &lt; num) &#123;</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        测试用例超出限制 2147483647. , 因为mid *mid 超出int</p>
<p>​    </p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-kotlin-senior2" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/11/kotlin-senior2/">kotlin-senior2</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-09-11T10:04:06.000Z" itemprop="datePublished">2021年09月11日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Kotlin/">Kotlin</a>
  </div>

      
      
<a href="/2021/09/11/kotlin-senior2/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h3><p><strong>Lambda表达式、匿名函数、双冒号+函数名这三个东西，都是函数类型的对象，他们都能够赋值给变量以及当作函数的参数传递！</strong></p>
<h5 id="Lambda表达式的格式"><a href="#Lambda表达式的格式" class="headerlink" title="Lambda表达式的格式"></a>Lambda表达式的格式</h5><ul>
<li><p>Lambda表达式被大括号包围着</p>
</li>
<li><p>Lambda表达式的参数在<code>-&gt;</code>的左边，如果没有参数，则只保留函数体</p>
</li>
<li><p>Lambda表达式的函数体在<code>-&gt;</code>的后面</p>
</li>
<li><p>Lambda表达式的返回类型值总为函数体最后一行代码的返回值类型</p>
</li>
</ul>
<h5 id="无参数，无返回值的Lambda表达式"><a href="#无参数，无返回值的Lambda表达式" class="headerlink" title="无参数，无返回值的Lambda表达式"></a>无参数，无返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test01Lambda = &#123;</span><br><span class="line">    print(<span class="string">&quot;无参数,无返回值&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们同样将Lambda表达式赋值给了变量，这个变量是函数类型（<code>() -&gt; Unit</code>）的对象。</p>
<h5 id="有参数，无返回值的Lambda表达式"><a href="#有参数，无返回值的Lambda表达式" class="headerlink" title="有参数，无返回值的Lambda表达式"></a>有参数，无返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda = &#123; name: String -&gt;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个变量是函数类型（<code>(String) -&gt; Unit</code>）的对象。</p>
<p>如果我们手动给这个变量指明了类型，那么Lambda的参数类型还可以不写：</p>
<p>注意这个name参数 是回调方法传过来的参数.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda: (String) -&gt; <span class="built_in">Unit</span> = &#123; name -&gt;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候，Kotlin可以自动为我们推断出Lambda中这个参数的类型是String类型。</p>
<p>如果Lambda表达式的参数只有一个，我们甚至连这个参数都可以省略不写，那…我想使用这个参数的时候怎么办呢？我们可以用<code>it</code>来代替：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda: (String) -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="有参数，有返回值的Lambda表达式"><a href="#有参数，有返回值的Lambda表达式" class="headerlink" title="有参数，有返回值的Lambda表达式"></a>有参数，有返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test03Lambda = &#123; doubleValue: <span class="built_in">Double</span> -&gt;</span><br><span class="line">    print(<span class="string">&quot;parameter is Double,Value is:<span class="variable">$doubleValue</span>&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;now parse Double into String&quot;</span>)</span><br><span class="line">    doubleValue.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lambda表达式的最后一行代码将作为返回值，因此它对应的函数类型为：<code>(Double) -&gt; String</code>。同样，如果变量已经确切的指定了类型，则Lambda表达式的参数类型可以省略，又由于只有一个参数，所以连参数都可以省略，Kotlin将使用it代替这个参数名。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> method: (String, String) -&gt; <span class="built_in">Unit</span> = &#123; aStr, bStr -&gt; println(<span class="string">&quot;a : <span class="variable">$aStr</span>, b:<span class="variable">$bStr</span>&quot;</span>) &#125;</span><br><span class="line">method(<span class="string">&quot;john&quot;</span>,<span class="string">&quot;男&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> method02 = &#123; println(<span class="string">&quot;john&quot;</span>)&#125;</span><br><span class="line"><span class="keyword">val</span> method03:(String)-&gt;<span class="built_in">Unit</span>=&#123;</span><br><span class="line">    println(<span class="string">&quot;传入的是:<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method03(<span class="string">&quot;Jon&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> method04:(<span class="built_in">Int</span>)-&gt;<span class="built_in">Unit</span>=&#123;</span><br><span class="line">    <span class="keyword">when</span>(it)&#123;</span><br><span class="line">        <span class="number">1</span>-&gt; println(<span class="string">&quot;等于1&quot;</span>)</span><br><span class="line">        <span class="keyword">in</span> <span class="number">20.</span>. <span class="number">30</span> -&gt; println(<span class="string">&quot;20 - 30的数字&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span> -&gt; println(<span class="string">&quot;都不满足&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">method04(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> method05 : (<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt; <span class="built_in">Unit</span> = &#123;aNumber,bNumber-&gt;</span><br><span class="line">    println(<span class="string">&quot;第一个: <span class="variable">$aNumber</span>, 第二个 : <span class="variable">$bNumber</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method05(<span class="number">1</span>,<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> method06 : (<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt; <span class="built_in">Unit</span> = &#123;aNumber,_-&gt;</span><br><span class="line">    println(<span class="string">&quot;第一个: <span class="variable">$aNumber</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method06(<span class="number">99</span>,<span class="number">88</span>)</span><br><span class="line"><span class="keyword">val</span> method07 : (String)-&gt;String = &#123;str -&gt; str&#125;</span><br><span class="line">println(method07(<span class="string">&quot;Jon&quot;</span>))</span><br></pre></td></tr></table></figure>







<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><h5 id="函数类型的书写格式"><a href="#函数类型的书写格式" class="headerlink" title="函数类型的书写格式"></a>函数类型的书写格式</h5><p>所有函数类型都有一个圆括号括起来的参数类型列表，以及一个返回类型：<code>(A, B) -&gt; C</code> ，参数列表与返回值类型之间通过 -&gt; 符号连接。<code>(A, B) -&gt; C</code>表示接收类型分别为 <code>A</code> 与 <code>B</code> 两个参数并返回一个 <code>C</code> 类型值的函数类型。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f: (<span class="built_in">Int</span>) -&gt; String</span><br></pre></td></tr></table></figure>

<p><code>(Int) -&gt; String</code>这就是一个函数类型。另外需要注意的是，即使函数类型的参数列表为空，也必须保留小括号，例如<code>() -&gt; String</code>；即使函数类型的返回值类型为Unit，也不可省略Unit不写，例如：<code>(Int) -&gt; Unit</code>。</p>
<h5 id="函数类型的对象使用"><a href="#函数类型的对象使用" class="headerlink" title="函数类型的对象使用"></a>函数类型的对象使用</h5><p><code>sum(1, 2)</code>这我可以理解，毕竟sum是一个函数，但是<code>block(1, 2)</code>这样也行？block可是一个函数类型的对象啊，函数类型的对象后面可以加括号调用？</p>
<p>没错，只有函数类型的对象可以，其实这是Kotlin为我们提供的一个语法糖，它本质上还是会去调用invoke函数，也就是说</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> block: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = ::sum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sum</span><span class="params">(firstNumber: <span class="type">Int</span>, secondNumber: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> firstNumber + secondNumber</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> block: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = ::sum</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下调用都是有返回值的,因为(Int, Int) -&gt; Int这个函数类型是有返回值的</span></span><br><span class="line">block(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">block.invoke(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">(::sum)(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">(::sum).invoke(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>Kotlin使用这种（函数类型对象能够使用括号访问）语法让我们感觉，嗯，block就是sum函数的替身，而实际上它是一个对象，一个函数类型的对象。</p>
<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><h5 id="什么是高阶函数"><a href="#什么是高阶函数" class="headerlink" title="什么是高阶函数"></a>什么是高阶函数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>有没有想过为什么需要传一个匿名类过去？因为Framework会在该View被点击的时候调用我们在匿名类中实现的那个onClick方法，以便于执行我们自己的处理逻辑。</p>
<p>要是我们能直接将方法传过去就好了…梦该醒了，这是Java，只能通过接口 + 匿名内部类这种折中的方案来实现这样的需求。</p>
<p>而Kotlin有了函数类型，又有了高阶函数，意味着我们可以传入一段代码给函数了，函数可以在适当的时候执行我们传入的那段代码，完美的解决了这一痛点。</p>
<h5 id="高阶函数的使用案例"><a href="#高阶函数的使用案例" class="headerlink" title="高阶函数的使用案例"></a>高阶函数的使用案例</h5><p>虽然都是过滤找出符合要求的苹果，但是条件是不一样的。这个怎么做呢？最简单的方法就是写三个循环，每个循环中针对不同的条件对苹果集合进行筛选。但是我们完全可以使用高阶函数和函数类型优雅的实现这个功能：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleBean</span></span>(<span class="keyword">val</span> color:<span class="built_in">Int</span>, <span class="keyword">val</span> weight:<span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean))&#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>，filterApple函数主要的功能只是遍历集合，以及把符合条件的苹果添加到新的集合中返回，至于筛选的条件，filterApple函数并不知道，而是完全取决于predicate这个函数类型的参数，只要predicate返回true，则符合条件。这样我们可以在调用函数时动态地传入不同的过滤规则</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    filterApple(appleList, ::filterColorPredicate)</span><br><span class="line">    filterApple(appleList, ::filterWeightPredicate)</span><br><span class="line">    filterApple(appleList, ::filterColorAndWeightPredicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterWeightPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.weight &gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorAndWeightPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span> &amp;&amp; appleBean.weight &gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean)) &#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这…太麻烦了吧，我每次调用高阶函数，传入函数类型的时候，还必须要先定义一个函数，然后再使用<code>::函数名</code>传入吗？其实不必这么麻烦的，现在我们学习的只不过是其中的一种方式而已。下面我们就要来学习更加简单的方式：匿名函数。</p>
<h3 id="Lambda表达式与高阶函数"><a href="#Lambda表达式与高阶函数" class="headerlink" title="Lambda表达式与高阶函数"></a>Lambda表达式与高阶函数</h3><p>现在大家已经对Lambda表达式的写法了如指掌了，现在是时候来看看Lambda表达式如何与高阶函数配合使用了。还记得之前的那个筛选苹果的例子吗？我们定义了一个高阶函数，它的名字叫：filterApple，代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean)) &#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个高阶函数的第二个参数接收了一个函数类型的参数，在之前，我们分别使用了两种方式进行调用：</p>
<ol>
<li><p>双冒号的方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    filterApple(appleList, ::filterColorPredicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span></span><br></pre></td></tr></table></figure></li>
<li><p>匿名函数的方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, <span class="function"><span class="title">fun</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.weight &gt; <span class="number">6</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>完整的写法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, &#123; appleBean: AppleBean -&gt; appleBean.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>简化的写法</p>
<p>我们怎么知道哪个参数需要传入Lambda表达式呢？当然是看被调用的这个高阶函数的定义啊，还记的这个高阶函数的样子吗？</p>
<p>我们怎么知道哪个参数需要传入Lambda表达式呢？当然是看被调用的这个高阶函数的定义啊，还记的这个高阶函数的样子吗？</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然第二个形参是一个函数类型的参数，并且已经明确的指出了形参的函数类型：<code>(AppleBean) -&gt; Boolean</code>（实际上也必须明确指出，否则报错）。根据我们前面所学习的知识，这种情况下，我们可以直接省略Lambda表达式中的参数类型，Kotlin会根据上下文自动推断：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, &#123; appleBean -&gt; appleBean.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>再简化的写法</p>
<p>由于这个函数类型只需要一个参数，因此我们还可以省略参数的名字，Kotlin会使用it代替，这在之前的Lambda讲解中，都是讲过的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, &#123; it.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>再再简化的写法</p>
<p>第一个是：如果Lambda表达式作为函数的最后一个参数传入，那么它可以单独放在调用函数的括号后面：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList) &#123; it.weight &gt; <span class="number">6</span> &#125;</span><br></pre></td></tr></table></figure>

<p>第二个是：如果函数只接收一个函数类型的参数，我们传入Lambda表达式时，连函数调用的括号都可以去掉：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    test &#123; num1, num2 -&gt;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(block: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        作者：HurryYu_YZH<br>​        链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8eb0623f08c6">https://www.jianshu.com/p/8eb0623f08c6</a></p>
<h3 id="项目实例"><a href="#项目实例" class="headerlink" title="项目实例"></a>项目实例</h3><h5 id="Login01-kt"><a href="#Login01-kt" class="headerlink" title="Login01.kt"></a>Login01.kt</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入一个具名函数，被调用后，获取参数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(resModel: <span class="type">ResModel</span>)</span></span>&#123;</span><br><span class="line">    println(resModel.int)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginModelImpl</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">loginOptions</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        mobileNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        metaInfo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        block: (<span class="type">model</span>: <span class="type">ResModel</span>) -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> model = ResModel(<span class="number">8</span>)</span><br><span class="line">        block(model)</span><br><span class="line">      <span class="comment">//  block.invoke(model) 这样写也可以 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResModel</span></span>(<span class="keyword">val</span> int: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> loginModelImpl = LoginModelImpl()</span><br><span class="line">    <span class="keyword">val</span> responseModel = ResModel(<span class="number">0</span>)</span><br><span class="line">    loginModelImpl.loginOptions(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,::test) <span class="comment">// 可以看到 fun test(resModel: ResModel)也被调用,可以理解被回调</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;model: ResModel -&gt; model.toString() &#125;)</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;model -&gt; model.toString() &#125;)</span></span><br><span class="line">    loginModelImpl.loginOptions(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,&#123;println(it.int)&#125;) <span class="comment">//lambda只有一个参数，传入参数也可以省略,&#123;&#125;里面用it代替</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;&#125;) // it可以用也可以不用</span></span><br></pre></td></tr></table></figure>



<h5 id="Login02-kt"><a href="#Login02-kt" class="headerlink" title="Login02.kt"></a>Login02.kt</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    loginAction(<span class="string">&quot;Jo1n&quot;</span>, <span class="string">&quot;123456&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (it) &#123;</span><br><span class="line">            println(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            println(<span class="string">&quot;登录失败&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loginAction</span><span class="params">(userName: <span class="type">String</span>, pwd: <span class="type">String</span>, loginResponseResult: (<span class="type">Boolean</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (userName == <span class="literal">null</span> || pwd == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">    loginEngine(userName, pwd, loginResponseResult)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loginEngine</span><span class="params">(userName: <span class="type">String</span>, pwd: <span class="type">String</span>, loginResponseResult: (<span class="type">Boolean</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;Jon&quot;</span> == userName &amp;&amp; <span class="string">&quot;123456&quot;</span> == pwd) &#123;</span><br><span class="line">        loginResponseResult(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        loginResponseResult(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1xv411k7Dd?p=3&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1xv411k7Dd?p=3&amp;spm_id_from=pageDriver</a></p>
<h5 id="updateFastClickTime"><a href="#updateFastClickTime" class="headerlink" title="updateFastClickTime"></a>updateFastClickTime</h5><p>这个方法很形象, 匿名函数的参数 ,是回调时候传的</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">updateFastClickTime</span><span class="params">(callback: ((<span class="type">currentTime</span>: <span class="type">Long</span>, <span class="type">lastClickTime</span>: <span class="type">Long</span>) -&gt; <span class="type">Unit</span>)? = <span class="literal">null</span>)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> curClickTime = System.currentTimeMillis()</span><br><span class="line">    callback?.invoke(</span><br><span class="line">        curClickTime,</span><br><span class="line">        lastClickTime</span><br><span class="line">    )</span><br><span class="line">    lastClickTime = curClickTime</span><br><span class="line">    <span class="keyword">return</span> curClickTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="getOrElse"><a href="#getOrElse" class="headerlink" title="getOrElse"></a>getOrElse</h5><p> 匿名函数的参数 ,是回调时候传的,返回T类型.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">getOrElse</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    index: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    defaultValue:(<span class="type">Int</span>) -&gt; <span class="type">T</span>       <span class="comment">//这个 (Int) -&gt; T 看不明白</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Array<span class="type">&lt;out T&gt;</span>.<span class="title">getOrElse</span><span class="params">(index: <span class="type">Int</span>, defaultValue: (<span class="type">Int</span>) -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt;= lastIndex) <span class="keyword">get</span>(index) <span class="keyword">else</span> defaultValue(index)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/399173319">https://bbs.csdn.net/topics/399173319</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-Dagger" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/29/Dagger/">Dagger</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-08-29T12:45:53.000Z" itemprop="datePublished">2021年08月29日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/ANDROID/">ANDROID</a>
  </div>

      
      
<a href="/2021/08/29/Dagger/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection/dagger-basics">https://developer.android.google.cn/training/dependency-injection/dagger-basics</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1hF411W7aj">https://www.bilibili.com/video/BV1hF411W7aj</a> 动脑</p>
<h3 id="注入3要素"><a href="#注入3要素" class="headerlink" title="注入3要素"></a>注入3要素</h3><p><img src="/2021/08/29/Dagger/2021-09-25_7.49.39_dagger3.png"></p>
<h5 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h5><p><img src="/2021/08/29/Dagger/2021-09-25_8.59.52_inject.png" alt="2021-09-25_8.59.52_inject"></p>
<h5 id="构造方法对象注入"><a href="#构造方法对象注入" class="headerlink" title="构造方法对象注入"></a>构造方法对象注入</h5><ol>
<li><p>创建User4对象 </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User4</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span></span>()</span><br></pre></td></tr></table></figure></li>
<li><p>创建ApplicationComponent4</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent4</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(mainActivity: <span class="type">MainActivity4</span>?)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>执行注入.</p>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user:User4</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main3)</span><br><span class="line">        DaggerApplicationComponent4.create().inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onCreate: user= <span class="variable">$user</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="第三方对象注入-一"><a href="#第三方对象注入-一" class="headerlink" title="第三方对象注入(一)"></a>第三方对象注入(一)</h5><p>Module :Module可以提供多个对象，返回类型要不一样 。</p>
<p>Component  :IOC容器, 用来注入对象,module集成到component身上,再由Component把对象注入到平时用的Activity或者目的类身上。</p>
<blockquote>
<p> 依赖的查找顺序为：先找@Module，如果找到了就停止，如果找不到就去找@Inject</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpObject</span> // 也可直接在这里提供对象,<span class="type">不用Module</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideHttpObject</span><span class="params">()</span></span>:HttpObject&#123; <span class="comment">// 针对第三方sdk的对象，可以灵活提供</span></span><br><span class="line">        <span class="keyword">return</span> HttpObject()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(modules = [HttpModule::class, DataBaseModule::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入点</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerxxActivity</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerxxActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding <span class="keyword">by</span> lazy &#123; ActivityDaggerXxBinding.inflate(layoutInflater) &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG = <span class="string">&quot;DaggerxxActivity&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> httpObject: HttpObject</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> databaseObject: DatabaseObject</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        DaggerMyComponent.create().inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onCreate: httpObject <span class="variable">$httpObject</span>  databaseObject  <span class="variable">$databaseObject</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903850319544328">https://juejin.cn/post/6844903850319544328</a></p>
<p><img src="/2021/08/29/Dagger/2021-09-25_9.15.37_dagger_class.png"></p>
<h5 id="第三方对象注入-一-1"><a href="#第三方对象注入-一-1" class="headerlink" title="第三方对象注入(一)"></a>第三方对象注入(一)</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User6</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppModule6</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideUser</span><span class="params">()</span></span>: User6 &#123;</span><br><span class="line">        <span class="keyword">return</span> User6()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(modules = [AppModule6::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(mainActivity: <span class="type">MainActivity6</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity6</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user: User6</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        DaggerApplicationComponent6.create().inject(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="依赖注入概念"><a href="#依赖注入概念" class="headerlink" title="依赖注入概念"></a>依赖注入概念</h3><ol>
<li>构造方法注入</li>
<li>Setter注入(字段注入)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    Engine engine;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法注入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// setter注入(字段注入)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        engine = <span class="keyword">new</span> Engine();</span><br><span class="line">        engine.start();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engine</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="IOC框架"><a href="#IOC框架" class="headerlink" title="IOC框架"></a>IOC框架</h5><ol>
<li>基于反射的方式实现： Spring IOC(动态的进行依赖关系的建立)</li>
<li>静态方式 ： 程序在编译时就已经提供好了建立依赖关系的类。Dagger2</li>
</ol>
<p>两种注入方式</p>
<p><img src="/2021/08/29/Dagger/2021-08-29_8.43.22_type_dagger.png" alt="2021-08-29_8.43.22_type_dagger"></p>
<h3 id="Dagger注入"><a href="#Dagger注入" class="headerlink" title="Dagger注入"></a>Dagger注入</h3><h5 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h5><p>构造方法构造实例注入步骤</p>
<ol>
<li><p>使用 @Inject注解在构造方法上；就是告知Dagger可以通过构造方法来创建并获取到User的实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.使用 @Inject注解在构造方法上；就是告知Dagger可以通过构造方法来创建并获取到User的实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span></span>()</span><br></pre></td></tr></table></figure></li>
<li><p>当作IOC容器,把对象注入到目标类中</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. Component可以当作IOC容器,然后把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerActivity</span>?)</span></span> <span class="comment">//指定DaggerActivity作为要注入的目标类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>设置Inject注解</p>
<p>DaggerActivity.java</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.设置Inject注解</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">User user;</span><br></pre></td></tr></table></figure></li>
<li><p>执行注入动作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//3.设置Inject注解</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">User user;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_dagger2);</span><br><span class="line"><span class="comment">//4.执行注入动作</span></span><br><span class="line">    DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);<span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类 </span></span><br><span class="line">    <span class="comment">// DaggerApplicationComponent.create()获取到实例,inject(this)注入到Activity中</span></span><br><span class="line">      Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Dagger-Module注入"><a href="#Dagger-Module注入" class="headerlink" title="Dagger Module注入"></a>Dagger Module注入</h5><p>第三方框架的类，实现依赖注入， 上面User是我们自己定义的类， </p>
<ol>
<li><p>第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providerUser</span><span class="params">()</span></span>: User &#123;</span><br><span class="line">        <span class="keyword">return</span> User()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideRetrofit</span><span class="params">()</span></span>: Retrofit &#123;</span><br><span class="line">        <span class="keyword">return</span> Retrofit.Builder()</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="2">
<li><p>compoent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 2. Component可以当作IOC容器,然后把对象注入到目标类中</span><br><span class="line">&#x2F;&#x2F; 设置作用域和ApplicationComponent组件的生命周期一致</span><br><span class="line">@Component(modules &#x3D; [NetModule::class]) &#x2F;&#x2F;模块装载到组件上去</span><br><span class="line">interface ApplicationComponent &#123;</span><br><span class="line">    fun inject(daggerActivity: DaggerActivity?) &#x2F;&#x2F;指定DaggerActivity作为要注入的目标类</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>DaggerActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;DaggerActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置Inject注解</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Retrofit retrofit;</span><br><span class="line">  </span><br><span class="line">    Log.i(TAG, <span class="string">&quot;retrofit: &quot;</span> + retrofit);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Retrofit注入"><a href="#Retrofit注入" class="headerlink" title="Retrofit注入"></a>Retrofit注入</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET(&quot;/user/info&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;String&gt; <span class="title">requestInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line"><span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line"><span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line"><span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line">ApiService apiService;</span><br><span class="line"></span><br><span class="line">Log.i(TAG, <span class="string">&quot;apiService: &quot;</span> +apiService);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Module已经知道怎么获取retrofit实例<br>接着同一个Module中的方法，就可以作为参数直接传入 使用<br>// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例<br>// 然后从当前容器直接获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="局部单例实现"><a href="#局部单例实现" class="headerlink" title="局部单例实现"></a>局部单例实现</h3><p><img src="/2021/08/29/Dagger/2021-08-29_8.43.44_local.png" alt="2021-08-29_8.43.44_local"></p>
<h5 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h5><p><img src="/2021/08/29/Dagger/2021-08-29_8.48.38_lifecycle.png" alt="2021-08-29_8.48.38_lifecycle"></p>
<p><strong>将某个对象的生命周期限定为其组件的生命周期。</strong></p>
<p>下面User，Retrofit ,ApiService, OkHttpClient对象实例指定了作用域是Singleton,那么载入这些对象的组建ApplicationComponent1也必须用作用域是Singleton.</p>
<p>要么不使用 作用域 即默认的作用域， 如果使用的话，就必须保证他们的作用域一致。</p>
<h5 id="局部实例1"><a href="#局部实例1" class="headerlink" title="局部实例1"></a>局部实例1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Dagger模块</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">providerUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="comment">//@Provides</span></span><br><span class="line">    <span class="comment">//public Retrofit provideRetrofit() &#123;</span></span><br><span class="line">    <span class="comment">//    return new Retrofit.Builder()</span></span><br><span class="line">    <span class="comment">//        .baseUrl(&quot;http://www.google.com&quot;)</span></span><br><span class="line">    <span class="comment">//        .build();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">(OkHttpClient okHttpClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .client(okHttpClient)</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Singleton是Dagger提供的一种作用域</span></span><br><span class="line">    <span class="comment">// 作用域就是用来管理Component来获取对象实例的生命周期</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Singleton</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule1.class&#125;)</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;DaggerActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置Inject注解</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Retrofit retrofit;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_dagger2);</span><br><span class="line">        <span class="comment">//4.执行注入动作</span></span><br><span class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);<span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类</span></span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user2: &quot;</span> + user2);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;retrofit: &quot;</span> + retrofit);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService: &quot;</span> +apiService);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService2: &quot;</span> +apiService2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: user: com.comm.util.dagger.dn.di.User@2129cef</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: user2: com.comm.util.dagger.dn.di.User@d97d3fc</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: retrofit: retrofit2.Retrofit@d243a85</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService: retrofit2.Retrofit$1@a1fa0da</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService2: retrofit2.Retrofit$1@a1fa0da</span><br></pre></td></tr></table></figure>

<p>可以看到 user 是2个实例</p>
<p>apiService用了同一个对象实例,所以可以看到和DaggerApplicationComponent组件生命周期一致。</p>
<h5 id="局部实例2"><a href="#局部实例2" class="headerlink" title="局部实例2"></a>局部实例2</h5><p>添加一个Activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;SecondActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService3;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_second2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类</span></span><br><span class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService3: &quot;</span> + apiService3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,SecondActivity.class));</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">7410-7410&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService: retrofit2.Retrofit$1@a1fa0da</span><br><span class="line">7410-7410&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService2: retrofit2.Retrofit$1@a1fa0da</span><br><span class="line">2021-08-29 22:28:35.812 7410-7410&#x2F;com.comm.util I&#x2F;SecondActivity: apiService3: retrofit2.Retrofit$1@84eb79a</span><br></pre></td></tr></table></figure>

<p>不同的DaggerApplicationComponent组件，不同的实例</p>
<h5 id="全局实例"><a href="#全局实例" class="headerlink" title="全局实例"></a>全局实例</h5><p>保证组件全局实例</p>
<p>Module作用域生命周期和 ApplicationComponent保持一致。</p>
<p>MyApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> ApplicationComponent  applicationComponent = DaggerApplicationComponent.create();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationComponent <span class="title">getApplicationComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> applicationComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyApplication.getApplicationComponent().inject(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">8044-8044&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService: retrofit2.Retrofit$1@516190b</span><br><span class="line">8044-8044&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService2: retrofit2.Retrofit$1@516190b</span><br><span class="line">8044-8044&#x2F;com.comm.util I&#x2F;SecondActivity: apiService3: retrofit2.Retrofit$1@516190b</span><br></pre></td></tr></table></figure>



<h5 id="使用作用域遵循的规则"><a href="#使用作用域遵循的规则" class="headerlink" title="使用作用域遵循的规则"></a>使用作用域遵循的规则</h5><p><img src="/2021/08/29/Dagger/2021-08-29_10.50.21_myscope.png" alt="2021-08-29_10.50.21_myscope"></p>
<p>组件ApplicationComponent指定了作用域,组件中的模块modules = {NetModule.class}，也要指定相同的作用域。</p>
<p>NetModule中的方法设置@Singleton 那么ApplicationComponent也必须设置@Singleton</p>
<p>NetModule中的方法设置@MyScope 那么ApplicationComponent也必须设置@MyScope</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="组件依赖"><a href="#组件依赖" class="headerlink" title="组件依赖"></a>组件依赖</h3><p>因为,一个Acitivty不能有两个组件直接注入,不如ApplicationComponent 和UserComponent.</p>
<p>组建依赖与子组建主要解决了不同作用域时组建之间复用问题.</p>
<ul>
<li>在一个组件置顶作用域后，就已经确定了该组建创建对象的生命周期。 但是<strong>有些对象的实例可能生命周期更短</strong>。这个时候就需要定义新的组建。</li>
<li>新组件需要使用原组建的部分资源</li>
</ul>
<p>两种实现方式</p>
<ol>
<li>为@Component添加dependencies参数,指定该组建依赖新的组件。</li>
<li>直接使用@Subcomponent注解创建新的组件，并装载到父组件中。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ki4y1A7hA?p=07">https://www.bilibili.com/video/BV1Ki4y1A7hA?p=07</a></p>
<p>来看方式一</p>
<h5 id="实例部分全局"><a href="#实例部分全局" class="headerlink" title="实例部分全局"></a>实例部分全局</h5><p>实现 Retrofit ,ApiService 进程下全局, User2类 Activity全局</p>
<p>MyScope是自定义的作用域，用Singleton也可以，主要是保证组建作用域全局单例，感觉和hilt有点不同</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致,如果ApplicationComponent是全局的，那么就是全局的</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule2.class&#125;)</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    void inject(DaggerUserActivity daggerActivity);<span class="comment">//指定目标类 //dependencies = &#123;ApplicationComponent1.class&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Retrofit retrofit();</span><br><span class="line">    ApiService apiService();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UserScope</span></span><br><span class="line"><span class="meta">@Component(modules = [UserModule2::class], dependencies = [ApplicationComponent2::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserComponent2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerUserActivity2</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity2</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetModule2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providerUser</span><span class="params">()</span></span>: User2 &#123;</span><br><span class="line">        <span class="keyword">return</span> User2()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="comment">//@Provides</span></span><br><span class="line">    <span class="comment">//public Retrofit provideRetrofit() &#123;</span></span><br><span class="line">    <span class="comment">//    return new Retrofit.Builder()</span></span><br><span class="line">    <span class="comment">//        .baseUrl(&quot;http://www.google.com&quot;)</span></span><br><span class="line">    <span class="comment">//        .build();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="meta">@MyScope</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideRetrofit</span><span class="params">(okHttpClient: <span class="type">OkHttpClient</span>?)</span></span>: Retrofit &#123;</span><br><span class="line">        <span class="keyword">return</span> Retrofit.Builder()</span><br><span class="line">            .client(okHttpClient)</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@MyScope</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideApiService</span><span class="params">(retrofit: <span class="type">Retrofit</span>)</span></span>: ApiService &#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Singleton是Dagger提供的一种作用域</span></span><br><span class="line">    <span class="comment">// 作用域就是用来管理Component来获取对象实例的生命周期</span></span><br><span class="line">    <span class="meta">@MyScope</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideOkHttpClient</span><span class="params">()</span></span>: OkHttpClient &#123;</span><br><span class="line">        <span class="keyword">return</span> OkHttpClient.Builder().build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意ApplicationComponent2要提供对应Module的方法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，NetModule设置@Singleton 那么ApplicationComponent也必须设置</span></span><br><span class="line"><span class="meta">@Component(modules = [NetModule2::class])</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerUserActivity</span>)</span></span> <span class="comment">//指定目标类 //dependencies = &#123;ApplicationComponent1.class&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">retrofit</span><span class="params">()</span></span>: Retrofit</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">apiService</span><span class="params">()</span></span>: ApiService</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideContext</span><span class="params">()</span></span>: Context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> ApplicationComponent2 applicationComponent = DaggerApplicationComponent2.create();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyApplication app;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationComponent2 <span class="title">getApplicationComponent2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationComponent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Dagger</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyApplication <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> app;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerUserActivity2</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user1: User2</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user2: User2</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> apiService1: ApiService</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> apiService2: ApiService</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> userComponent: UserComponent2? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_dagger_user)</span><br><span class="line">        userComponent = DaggerUserComponent2.builder().applicationComponent2(</span><br><span class="line">            MyApplication.getApplicationComponent2()</span><br><span class="line">        ).build()</span><br><span class="line">        userComponent?.inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user1: <span class="variable">$user1</span>&quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user2: <span class="variable">$user2</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService1: <span class="variable">$apiService1</span>&quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService2: <span class="variable">$apiService2</span>&quot;</span>)</span><br><span class="line">        startActivity(Intent(<span class="keyword">this</span>, DaggerSecondActivity2::<span class="keyword">class</span>.java))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>从结果上, Retrofit 是全局单例，User2对象是Activity单例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: user1: com.comm.util.dagger.dn.di.User2@1da0e9b</span><br><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: user2: com.comm.util.dagger.dn.di.User2@1da0e9b</span><br><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: apiService1: retrofit2.Retrofit$1@12da238</span><br><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: apiService2: retrofit2.Retrofit$1@12da238</span><br><span class="line">438 10821-10821&#x2F;com.comm.util I&#x2F;DaggerSecondActivity2: user3: com.comm.util.dagger.dn.di.User2@8233396</span><br><span class="line">438 10821-10821&#x2F;com.comm.util I&#x2F;DaggerSecondActivity2: apiService3: retrofit2.Retrofit$1@12da238</span><br></pre></td></tr></table></figure>



<h5 id="提供全局Application"><a href="#提供全局Application" class="headerlink" title="提供全局Application"></a>提供全局Application</h5><p>demo代码有问题 NPR</p>
<h5 id="子组件方式"><a href="#子组件方式" class="headerlink" title="子组件方式"></a>子组件方式</h5><p>优势</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">下面的interface ApplicationComponent3 </span><br><span class="line"> 父组件不用定义 这些方法</span><br><span class="line">  fun retrofit(): Retrofit</span><br><span class="line">  fun apiService(): ApiService</span><br><span class="line">  fun context(): Context</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，NetModule设置@Singleton 那么ApplicationComponent也必须设置</span></span><br><span class="line"><span class="meta">@Component(modules = [SubComponentModule::class])</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerUserActivity</span>)</span></span> <span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">studentComponent</span><span class="params">()</span></span>:StudentComponent.Factory</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module(subcomponents = [StudentComponent::class])</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubComponentModule</span> </span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subcomponent(modules = [StudentModule::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">StudentComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subcomponent</span>.Factory</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span>: StudentComponent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity3</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class DaggerSecondActivity3 : AppCompatActivity() &#123;</span><br><span class="line">    var TAG &#x3D; javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    lateinit var student: Student</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line"></span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(this)</span><br><span class="line">        Log.i(TAG, &quot;student: $student &quot;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>结果同样注入成功</p>
<blockquote>
<p>/com.comm.util I/DaggerSecondActivity3: student: com.comm.util.dagger.dn.di.Student@6c29d80 </p>
</blockquote>
<h3 id="Binds注入接口实例"><a href="#Binds注入接口实例" class="headerlink" title="Binds注入接口实例"></a>Binds注入接口实例</h3><p>之前用的是 module总 provide对象提供方式 ,想下面这种的。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>通过这种方式注入的优势是,直接使用接口，不需要具体的实现, AInterfaceImpl01改成AInterfaceImpl02就能改注入实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> aInterface: AInterface</span><br></pre></td></tr></table></figure>



<p>还一个优势是子组件StudentComponent也可以用来处理注入</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subcomponent(modules = [StudentModule::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">StudentComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subcomponent</span>.Factory</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span>: StudentComponent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity3</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity4</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AInterfaceImpl01</span> : <span class="type">AInterface</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AInterfaceImpl02</span> : <span class="type">AInterface</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TestModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">bindAInterface</span><span class="params">(impl: <span class="type">AInterfaceImpl01</span>)</span></span>: AInterface <span class="comment">// AInterfaceImpl01改成AInterfaceImpl02就能改注入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="meta">@Provides</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">provideAInterfaceImpl01</span><span class="params">()</span></span>: AInterfaceImpl01 &#123;</span><br><span class="line">            <span class="keyword">return</span> AInterfaceImpl01()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="meta">@Provides</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">provideAInterfaceImpl02</span><span class="params">()</span></span>: AInterfaceImpl02 &#123;</span><br><span class="line">            <span class="keyword">return</span> AInterfaceImpl02()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致</span></span><br><span class="line"><span class="meta">@Component(modules = [SubComponentModule::class,TestModule::class])</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerUserActivity</span>)</span></span> <span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">studentComponent</span><span class="params">()</span></span>:StudentComponent.Factory</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerSecondActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> student: Student</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> aInterface: AInterface</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line"></span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;student: <span class="variable">$student</span> &quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;aInterface: <span class="variable">$aInterface</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="相同类创建不同的对象"><a href="#相同类创建不同的对象" class="headerlink" title="相同类创建不同的对象"></a>相同类创建不同的对象</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student1&quot;</span>)</span> <span class="comment">//  @Named 是Qualifier的实现</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student2&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent2</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student(<span class="string">&quot;John&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerSecondActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student1&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> student1: Student</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student2&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> student2: Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line"></span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier1: <span class="variable">$StudentQualifier1</span> &quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier2: <span class="variable">$StudentQualifier2</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>也可以自定义标识,注解标识，通过标识找到对象</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> StudentQualifier1 &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent1</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student1&quot;</span>)</span> <span class="comment">//  @Named 是Qualifier的实现</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student2&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent2</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student(<span class="string">&quot;John&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier1</span> <span class="comment">//  @Named 是Qualifier的实现</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideQualifierStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier2</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideQualifierStudent2</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student(<span class="string">&quot;Qualifier2 John&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerSecondActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier1</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> StudentQualifier1: Student</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier2</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> StudentQualifier2: Student</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier1: <span class="variable">$StudentQualifier1</span> &quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier2: <span class="variable">$StudentQualifier2</span> &quot;</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;aInterface: <span class="variable">$aInterface</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-kotlin-ext-func" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/22/kotlin-ext-func/">kotlin-ext-func</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-08-22T05:27:15.000Z" itemprop="datePublished">2021年08月22日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Kotlin/">Kotlin</a>
  </div>

      
      
<a href="/2021/08/22/kotlin-ext-func/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="拓展函数"><a href="#拓展函数" class="headerlink" title="拓展函数"></a>拓展函数</h3><p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_1.26.04_expand.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给字符串追加若干个 !</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">(amount:<span class="type">Int</span>=<span class="number">1</span>)</span></span>= <span class="keyword">this</span> + <span class="string">&quot; !&quot;</span>.repeat(amount)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> Any.<span class="title">easyPrint</span><span class="params">()</span></span> = println(<span class="keyword">this</span>) <span class="comment">//默认是public</span></span><br><span class="line"><span class="comment">//fun Any.easyPrint() = println(this) //不能定义两次</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;abc&quot;</span>.addExt(<span class="number">2</span>))</span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.easyPrint()</span><br><span class="line">    <span class="number">15.</span>easyPrint()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="类型别名-typealias"><a href="#类型别名-typealias" class="headerlink" title="类型别名 typealias"></a>类型别名 typealias</h5><p> 如果类型名称太长，你可以另外引入较短的名称，并使用新的名称替代原类型名。</p>
<p><a target="_blank" rel="noopener" href="https://www.kotlincn.net/docs/reference/type-aliases.html">https://www.kotlincn.net/docs/reference/type-aliases.html</a></p>
<h5 id="泛型拓展函数"><a href="#泛型拓展函数" class="headerlink" title="泛型拓展函数"></a>泛型拓展函数</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_1.42.27_generic_extends.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给字符串追加若干个 !</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">(amount:<span class="type">Int</span>=<span class="number">1</span>)</span></span>= <span class="keyword">this</span> + <span class="string">&quot; !&quot;</span>.repeat(amount)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">easyPrint</span><span class="params">()</span></span>:T&#123;</span><br><span class="line">    println(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.addExt(<span class="number">2</span>).easyPrint()</span><br><span class="line">    <span class="number">15.</span>easyPrint()</span><br><span class="line">    <span class="number">15.</span>also &#123;  &#125;</span><br><span class="line">    <span class="keyword">val</span> let = <span class="string">&quot;abc&quot;</span>.let &#123; <span class="number">50</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Let源码"><a href="#Let源码" class="headerlink" title="Let源码"></a>Let源码</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// &quot;abc&quot;调用let，传进来参数就是&quot;abc&quot;类型T为String</span></span><br><span class="line"><span class="comment">// let返回lambda表达式执行的结果 50 类型R为Int</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T, R&gt;</span> T.<span class="title">let</span><span class="params">(block: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R &#123;</span><br><span class="line">    contract &#123;</span><br><span class="line">        callsInPlace(block, InvocationKind.EXACTLY_ONCE)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> block(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="拓展属性"><a href="#拓展属性" class="headerlink" title="拓展属性"></a>拓展属性</h5><p>给String类添加一个拓展</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//给字符串追加若干个 !</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">(amount: <span class="type">Int</span> = <span class="number">1</span>)</span></span> = <span class="keyword">this</span> + <span class="string">&quot; !&quot;</span>.repeat(amount)</span><br><span class="line"><span class="keyword">val</span> String.numVowels</span><br><span class="line">    <span class="keyword">get</span>() = count &#123; <span class="string">&quot;aeiou&quot;</span>.contains(it) &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">easyPrint</span><span class="params">()</span></span>: T &#123;</span><br><span class="line">    println(<span class="keyword">this</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.addExt(<span class="number">2</span>).easyPrint()</span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;The people&#x27;s Republic of China&quot;</span>.numVowels.easyPrint()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="可空类拓展"><a href="#可空类拓展" class="headerlink" title="可空类拓展"></a>可空类拓展</h5><p>可以定义拓展函数用于可空类型，在可空类型上定义拓展函数，你可以直接在拓展函数体内借鉴可能出现的空值问题。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//就是String后加?</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String?.<span class="title">printWithDefault</span><span class="params">(default:<span class="type">String</span>)</span></span> =print(<span class="keyword">this</span> ?: default) <span class="comment">//null打印默认值,不为null 打印自身</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//    val nullableString:String? = null</span></span><br><span class="line">    <span class="keyword">val</span> nullableString:String? = <span class="string">&quot;hehe&quot;</span></span><br><span class="line">    nullableString.printWithDefault(<span class="string">&quot;abc&quot;</span>) <span class="comment">// nullableString?就不会设置默认值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Infix"><a href="#Infix" class="headerlink" title="Infix"></a>Infix</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_2.48.05_infix.png" alt="2021-08-22_2.48.05_infix"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> String?.<span class="title">printWithDefault</span><span class="params">(default:<span class="type">String</span>)</span></span> =print(<span class="keyword">this</span> ?: default) <span class="comment">//null打印默认值,不为null 打印自身</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">//    val nullableString:String? = null</span></span><br><span class="line">    <span class="keyword">val</span> nullableString:String? = <span class="string">&quot;hehe&quot;</span></span><br><span class="line">    nullableString.printWithDefault(<span class="string">&quot;abc&quot;</span>) <span class="comment">// nullableString?就不会设置默认值</span></span><br><span class="line">    nullableString printWithDefault <span class="string">&quot;abc&quot;</span>  <span class="comment">// 加了infix可以简化成这样</span></span><br><span class="line">    <span class="string">&quot;girl&quot;</span>.to(<span class="number">18</span>)</span><br><span class="line">    mapOf(<span class="string">&quot;girl&quot;</span> to <span class="number">18</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//to是拓展函数，返回 Pair&lt;A,B&gt;</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">infix</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;A, B&gt;</span> A.<span class="title">to</span><span class="params">(that: <span class="type">B</span>)</span></span>: Pair&lt;A, B&gt; = Pair(<span class="keyword">this</span>, that)</span><br></pre></td></tr></table></figure>



<h5 id="定义拓展文件"><a href="#定义拓展文件" class="headerlink" title="定义拓展文件"></a>定义拓展文件</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.util.kotin.extension</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Iterable<span class="type">&lt;T&gt;</span>.<span class="title">randomTake</span><span class="params">()</span></span>: T = <span class="keyword">this</span>.shuffled().first()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> list = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">set</span> = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    list.shuffled().first()</span><br><span class="line"></span><br><span class="line">    list.randomTake()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="重命名拓展"><a href="#重命名拓展" class="headerlink" title="重命名拓展"></a>重命名拓展</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.util.kotin.extension.randomTake <span class="keyword">as</span> Randomizer</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> list = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> <span class="keyword">set</span> = listOf(<span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;Json&quot;</span>, <span class="string">&quot;John&quot;</span>)</span><br><span class="line">    list.shuffled().first()</span><br><span class="line"></span><br><span class="line"><span class="comment">//    list.randomTake()</span></span><br><span class="line">    list.Randomizer()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.00.52_extent.png" alt="2021-08-22_3.00.52_extent"></p>
<h5 id="Apply源码"><a href="#Apply源码" class="headerlink" title="Apply源码"></a>Apply源码</h5><p><strong>T.()什么意思</strong></p>
<p>这个就是 带接收者的函数字面量，拓展函数里自带了接收者对象的this隐式调用</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span><br><span class="line">    block()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">T.() -&gt; <span class="built_in">Unit</span> <span class="comment">//T.() 表示 任何类型无参数的拓展函数，匿名函数也可以是拓展函数</span></span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.File</span><br><span class="line"></span><br><span class="line"><span class="comment">//fun String.addExt(amount: Int = 1) = this + &quot; !&quot;.repeat(amount)</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> String.<span class="title">addExt</span><span class="params">()</span></span> = <span class="string">&quot; !&quot;</span>.repeat(<span class="keyword">this</span>.count())</span><br><span class="line"></span><br><span class="line"><span class="comment">// 泛型的拓展函数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">easyPrint</span><span class="params">()</span></span>: <span class="built_in">Unit</span> = println(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// T.apply 返回的还是T</span></span><br><span class="line"><span class="comment">// T.() -&gt; Unit 传入拓展函数(泛型), 而不是普通的匿名函数() -&gt; Unit ,没用泛型T就会报错,T表示可以用任意类型</span></span><br><span class="line"><span class="comment">// 拓展函数里自带了接收者对象的this隐式调用</span></span><br><span class="line"><span class="comment">// 匿名函数，也可以是 拓展函数</span></span><br><span class="line"><span class="comment">//普通的匿名函数 ()-&gt;Unit</span></span><br><span class="line"><span class="comment">//匿名函数内部this指向一个File对象,隐式调用，File.() -&gt; Unit</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> T.<span class="title">apply</span><span class="params">(block: <span class="type">T</span>.() -&gt; <span class="type">Unit</span>)</span></span>: T &#123;</span><br><span class="line">    block()</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*public inline fun &lt;File&gt; File.apply(block: File.() -&gt; Unit): File &#123;</span></span><br><span class="line"><span class="comment">    block()</span></span><br><span class="line"><span class="comment">    return this</span></span><br><span class="line"><span class="comment">&#125;*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> file = File(<span class="string">&quot;xx&quot;</span>).apply &#123;</span><br><span class="line">        <span class="keyword">this</span>.setReadable(<span class="literal">true</span>) <span class="comment">//默认又一个对象指向File</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="keyword">val</span> file = File(<span class="string">&quot;xx&quot;</span>).apply &#123;</span><br><span class="line">        <span class="keyword">this</span>.setReadable(<span class="literal">true</span>) <span class="comment">//如果是 () -&gt; Unit这样，这里就会报错，没有File类型了</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//这里分解一下</span></span><br><span class="line">    <span class="comment">//1. 定义拓展函数</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> File.<span class="title">ext</span><span class="params">()</span></span>: <span class="built_in">Unit</span> &#123;</span><br><span class="line">        setReadable(<span class="literal">true</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//2.给block变量赋值</span></span><br><span class="line">    <span class="keyword">val</span> block = File::ext</span><br><span class="line">    <span class="comment">//3.传入apply函数</span></span><br><span class="line">    File(<span class="string">&quot;xxx&quot;</span>).apply &#123; block &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    doSomething &#123;</span><br><span class="line">        goFix()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="string">&quot;abcefg&quot;</span>.addExt().easyPrint() <span class="comment">// &quot;abcefg&quot;调用addExt() ,addExt()有一个对象指向&quot;abcefg&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;abc&quot;</span>.apply &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">(fix: () -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    fix</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">goFix</span><span class="params">()</span></span>: <span class="built_in">Unit</span> &#123;</span><br><span class="line">    <span class="string">&quot;goFxi&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="案例LoginModel-kt"><a href="#案例LoginModel-kt" class="headerlink" title="案例LoginModel.kt"></a>案例LoginModel.kt</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RpcExpress.pack &#123;</span><br><span class="line">    request.mobileNo = mobileNo</span><br><span class="line">    request.metaInfo = metaInfo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T : RpcRequest, <span class="keyword">reified</span> R : RpcResult, <span class="keyword">reified</span> E : RpcTask&gt;</span> <span class="title">pack</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        build: <span class="type">RpcPackage</span>&lt;<span class="type">T</span>, R, E&gt;.()</span></span> -&gt; <span class="built_in">Unit</span></span><br><span class="line">): RpcExecutor&lt;T, R, E&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> rpcPackage =</span><br><span class="line">        RpcPackage&lt;T, R, E&gt;(T::<span class="keyword">class</span>.java.newInstance(), R::<span class="keyword">class</span>.java, E::<span class="keyword">class</span>.java)</span><br><span class="line">    build(rpcPackage) <span class="comment">// 也可以写成 rpcPackage?.build() , 给rpcPackage赋值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.pack(rpcPackage)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="函数式编程"><a href="#函数式编程" class="headerlink" title="函数式编程"></a>函数式编程</h3><p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.34.23_DSL.png"></p>
<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.39.01_math_func.png" alt="2021-08-22_3.39.01_math_func"></p>
<p>函数类别</p>
<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.43.38_qualify.png" alt="2021-08-22_3.43.38_qualify"></p>
<h5 id="Map变换"><a href="#Map变换" class="headerlink" title="Map变换"></a>Map变换</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.49.42_convert.png" alt="2021-08-22_3.49.42_convert"></p>
<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.50.14_map.png" alt="2021-08-22_3.50.14_map"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> animals = listOf(<span class="string">&quot;zebra&quot;</span>, <span class="string">&quot;giraffe&quot;</span>, <span class="string">&quot;elephant&quot;</span>, <span class="string">&quot;rat&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> banies = animals.map &#123; animal -&gt;</span><br><span class="line">    <span class="string">&quot;A baby <span class="variable">$animal</span>&quot;</span></span><br><span class="line">&#125;.map &#123;</span><br><span class="line">    baby -&gt; <span class="string">&quot;<span class="variable">$baby</span> , with the cutest little tail ever!&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">println(animals)</span><br><span class="line">println(banies)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.59.20_map1.png" alt="2021-08-22_3.59.20_map1"></p>
<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_3.59.53_map2.png" alt="2021-08-22_3.59.53_map2"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> animalsLength = animals.map &#123; it.length &#125;</span><br><span class="line">println(animalsLength)</span><br></pre></td></tr></table></figure>



<h5 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h5><p>faltMap函数操作一个集合的集合，将其中多个<strong>集合中的元素的合并</strong>后返回一个包含所有元素的单一集合。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = listOf(listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>), listOf(<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>)).flatMap &#123; it &#125;</span><br><span class="line">println(result)</span><br></pre></td></tr></table></figure>



<h5 id="过滤"><a href="#过滤" class="headerlink" title="过滤"></a>过滤</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_4.07.58_filter.png" alt="2021-08-22_4.07.58_filter"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> result = listOf(<span class="string">&quot;Jack&quot;</span>,<span class="string">&quot;Jimmy&quot;</span>,<span class="string">&quot;Rose&quot;</span>,<span class="string">&quot;Tom&quot;</span>).filter &#123;</span><br><span class="line">    it.contains(<span class="string">&quot;J&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(result)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> items = listOf(</span><br><span class="line">        listOf(<span class="string">&quot;rea apple&quot;</span>, <span class="string">&quot;green apple&quot;</span>, <span class="string">&quot;blue apple&quot;</span>),</span><br><span class="line">        listOf(<span class="string">&quot;red fish&quot;</span>, <span class="string">&quot;blue fish&quot;</span>),</span><br><span class="line">        listOf(<span class="string">&quot;yellow banana&quot;</span>, <span class="string">&quot;teal banana&quot;</span>)</span><br><span class="line">)</span><br><span class="line"><span class="keyword">val</span> redItems = items.flatMap &#123; it.filter &#123; it.contains(<span class="string">&quot;red&quot;</span>) &#125; &#125;</span><br><span class="line">println(redItems)</span><br></pre></td></tr></table></figure>



<p><img src="/2021/08/22/kotlin-ext-func/2021-08-22_4.56.png" alt="2021-08-22_4.56"></p>
<h5 id="找素数"><a href="#找素数" class="headerlink" title="找素数"></a>找素数</h5><p>找素数，除了1和它本身，不能被任何数整除的数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 除了1和它本身， 不梦被任何数整除的数</span></span><br><span class="line"><span class="comment">// 取模等于0，说明能够整除，如果没有一个是等于0的，说明是素数。</span></span><br><span class="line"><span class="keyword">val</span> numbers = listOf(<span class="number">7</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">22</span>, <span class="number">18</span>, <span class="number">11</span>)</span><br><span class="line"><span class="keyword">val</span> primes = numbers.filter &#123; number -&gt;</span><br><span class="line">    (<span class="number">2</span> until number).map &#123; number % it &#125;.none &#123; it == <span class="number">0</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line">println(primes)</span><br></pre></td></tr></table></figure>

<h4 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h4><p>合并是函数式编程的第三大类函数，合并能将不同的集合合并成一个新的集合。这个接收者是包含集合的的集合的flatmap函数不同。</p>
<h5 id="zip"><a href="#zip" class="headerlink" title="zip"></a>zip</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list1 = listOf(<span class="string">&quot;jon&quot;</span>, <span class="string">&quot;john1&quot;</span>, <span class="string">&quot;john2&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> list2 = listOf(<span class="string">&quot;l1&quot;</span>, <span class="string">&quot;l2&quot;</span>, <span class="string">&quot;l3&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> toMap = list1.zip(list2).toMap()</span><br><span class="line">println(toMap)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>{jon=l1, john1=l2, john2=l3}</p>
</blockquote>
<h5 id="Fold"><a href="#Fold" class="headerlink" title="Fold"></a>Fold</h5><p>可以用来合并值的合并函数是fold，这个合并函数接受一个初始累加器值，随后会<strong>根据匿名函数的结构更新</strong>。</p>
<p>fold(0)  accumulator从0开始</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将每个元素值 乘以3后累加起来</span></span><br><span class="line"><span class="keyword">val</span> foldedValue = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>).fold(<span class="number">0</span>) &#123; accumulator, number -&gt;</span><br><span class="line">    println(<span class="string">&quot;Accmulator value: <span class="variable">$accumulator</span>&quot;</span>)</span><br><span class="line">    accumulator + (number * <span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line">println(<span class="string">&quot;Find value: <span class="variable">$foldedValue</span>&quot;</span>)</span><br></pre></td></tr></table></figure>



<blockquote>
<p>Accmulator value: 0<br>Accmulator value: 3<br>Accmulator value: 9<br>Accmulator value: 18<br>Find value: 30</p>
</blockquote>
<h5 id="序列"><a href="#序列" class="headerlink" title="序列"></a>序列</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-28_9.38.16_Sequence.png" alt="2021-08-28_9.38.16_Sequence"></p>
<p><img src="/2021/08/22/kotlin-ext-func/2021-08-28_9.56.02_generateSequence.png" alt="2021-08-28_9.56.02_generateSequence"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//判断是否是素数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="built_in">Int</span>.<span class="title">isPrime</span><span class="params">()</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">    (<span class="number">2</span> until <span class="keyword">this</span>).map &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> % it == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//产生头1000个元素</span></span><br><span class="line">    <span class="comment">//假定 0 - 5000之内，可以找到1000个元素</span></span><br><span class="line">    <span class="keyword">val</span> toList = (<span class="number">1.</span><span class="number">.5009</span>).toList().filter &#123; it.isPrime() &#125;.take(<span class="number">1000</span>)</span><br><span class="line">    println(toList.size)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> oneThousandPrimes = generateSequence(<span class="number">2</span>) &#123; value -&gt;</span><br><span class="line">        value + <span class="number">1</span></span><br><span class="line">    &#125;.filter &#123; it.isPrime() &#125;.take(<span class="number">1000</span>)</span><br><span class="line">    println(oneThousandPrimes.toList().size)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="互操作性与可空性"><a href="#互操作性与可空性" class="headerlink" title="互操作性与可空性"></a>互操作性与可空性</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-28_10.06.35_null.png" alt="2021-08-28_10.06.35_null"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jhava</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> hitPoints = <span class="number">3232320</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHitPoints</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;----hitPoints-----&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> hitPoints;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">utterGreeting</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;HELLO&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(HeroKt.makeProclamation());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">determineFriends</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> adversary = Jhava()</span><br><span class="line">    println(adversary.utterGreeting())</span><br><span class="line"></span><br><span class="line">    <span class="comment">// determineFriends String! 平台类型</span></span><br><span class="line"><span class="comment">//    val level = adversary.determineFriends().toLong()</span></span><br><span class="line"><span class="comment">//    level?.toLong()</span></span><br><span class="line">    println(adversary.hitPoints)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>HELLO<br>—-hitPoints—–<br>3232320</p>
<h5 id="JvmName注解指定编译类的名字"><a href="#JvmName注解指定编译类的名字" class="headerlink" title="@JvmName注解指定编译类的名字"></a>@JvmName注解指定编译类的名字</h5><p>​    </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@file:JvmName</span>(<span class="string">&quot;Hero&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> senior.Jhava</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">makeProclamation</span><span class="params">()</span></span> = <span class="string">&quot;Greetings , beast!&quot;</span></span><br></pre></td></tr></table></figure>



<h5 id="JvmField"><a href="#JvmField" class="headerlink" title="@JvmField"></a>@JvmField</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-28_10.54.47_field.png" alt="2021-08-28_10.54.47_field"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpellBook</span> </span>&#123;</span><br><span class="line">    val spells = listOf(<span class="string">&quot;Magic Ms . L&quot;</span>, <span class="string">&quot;Lay onHans&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmField</span></span><br><span class="line">    val spells1 = listOf(<span class="string">&quot;Magic Ms . L&quot;</span>, <span class="string">&quot;Lay onHans&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SpellBook spellBook = <span class="keyword">new</span> SpellBook();</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; spells = spellBook.getSpells();</span><br><span class="line">List&lt;String&gt; spells1 = spellBook.spells1; <span class="comment">// 直接用这个属性名，不用加get前缀</span></span><br></pre></td></tr></table></figure>



<h5 id="JvmOverloads"><a href="#JvmOverloads" class="headerlink" title="@JvmOverloads"></a>@JvmOverloads</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//调用者可以指定英雄左手或右手拿什么食物，或者使用默认的配置 - 左手拿浆果，右手拿牛肉</span></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">handoverFood</span><span class="params">(leftHand: <span class="type">String</span> = <span class="string">&quot;berries&quot;</span>, rightHand: <span class="type">String</span> = <span class="string">&quot;beef&quot;</span>)</span></span> &#123;</span><br><span class="line">    println(<span class="string">&quot;Mmmm... you hand over some delicious <span class="variable">$leftHand</span> and <span class="variable">$rightHand</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>可以看到编译器默认对类添加了重载</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="keyword">public</span> static <span class="keyword">final</span> void handoverFood(<span class="meta">@NotNull</span> String leftHand) &#123;</span><br><span class="line">   handoverFood$default(leftHand, (String)<span class="literal">null</span>, <span class="number">2</span>, (Object)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@JvmOverloads</span></span><br><span class="line"><span class="keyword">public</span> static <span class="keyword">final</span> void handoverFood() &#123;</span><br><span class="line">   handoverFood$default((String)<span class="literal">null</span>, (String)<span class="literal">null</span>, <span class="number">3</span>, (Object)<span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>但是代码中我获取不到 Herokt 类。</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1wf4y1s7TG?p=144&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1wf4y1s7TG?p=144&amp;spm_id_from=pageDriver</a></p>
<h5 id="JvmStatic"><a href="#JvmStatic" class="headerlink" title="@JvmStatic"></a>@JvmStatic</h5><p>@JvmField注解还能用来以静态方式提供伴生对象里定义的值</p>
<p>@JvmStatic注解的作用类似于@JvmField, 允许你直接调用伴生对象里的函数</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpellBook</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="meta">@JvmField</span></span><br><span class="line">        <span class="keyword">val</span> MAX_SPELL_COUNT = <span class="number">10</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getSpellbookGreeting</span><span class="params">()</span></span> = println(<span class="string">&quot;I am the Great man!&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>加了@JvmField注解 就不用加 Companion调用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//伴生对象</span></span><br><span class="line">SpellBook.Companion.getSpellbookGreeting();</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加@JvmField  支持静态调用</span></span><br><span class="line"><span class="keyword">int</span> maxSpellCount = SpellBook.MAX_SPELL_COUNT;</span><br></pre></td></tr></table></figure>



<h5 id="Throws"><a href="#Throws" class="headerlink" title="@Throws"></a>@Throws</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-29_11.46.25_throwable.png" alt="2021-08-29_11.46.25_throwable"></p>
<p>​    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Jhava</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">extendHandInFriendship</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="Java异常-java处理"><a href="#Java异常-java处理" class="headerlink" title="Java异常 java处理"></a>Java异常 java处理</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//在java里面强制 在编译器处理的异常</span></span><br><span class="line">    <span class="keyword">new</span> Jhava().extendHandInFriendship();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="Java异常-kotlin处理"><a href="#Java异常-kotlin处理" class="headerlink" title="Java异常 kotlin处理"></a>Java异常 kotlin处理</h6><p>Hero.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    adversary.extendHandInFriendship()</span><br><span class="line">&#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">    println(<span class="string">&quot;exception&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>kotlin异常Java处理</p>
<p>Hero.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">acceptApology</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> IOException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HeroKt.acceptApology();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;   <span class="comment">//报错 Exception &#x27;java.io.IOException&#x27; is never thrown in the corresponding try block</span></span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器把kotlin转成了Throwable</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">acceptApology</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">throw</span> (Throwable)(<span class="keyword">new</span> IOException());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以catch Throwable异常没问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HeroKt.acceptApology();</span><br><span class="line">&#125; <span class="keyword">catch</span> (Throwable e) &#123;   </span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="添加throws注解处理"><a href="#添加throws注解处理" class="headerlink" title="添加throws注解处理"></a>添加throws注解处理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Throws(IOException::class)</span><br><span class="line">fun acceptApology1() &#123;</span><br><span class="line">    throw IOException()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    HeroKt.acceptApology1();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h5><p><img src="/2021/08/22/kotlin-ext-func/2021-08-29_12.13.48_function.png" alt="2021-08-29_12.13.48_function"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加一个translator的函数，接收一个字符串</span></span><br><span class="line"><span class="comment">//将其改为小写字面，再大写第一个字符，最后打印结构</span></span><br><span class="line"><span class="keyword">var</span> translator : (String)-&gt;<span class="built_in">Unit</span> = &#123; utterance: String -&gt;</span><br><span class="line">    println(utterance.toLowerCase().capitalize())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Function1&lt;String, Unit&gt; translator &#x3D; HeroKt.getTranslator();</span><br><span class="line">translator.invoke(&quot;TRUECE&quot;);</span><br></pre></td></tr></table></figure>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-kotlin-object-generic" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/21/kotlin-object-generic/">kotlin-object-generic</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-08-21T13:02:57.000Z" itemprop="datePublished">2021年08月21日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Kotlin/">Kotlin</a>
  </div>

      
      
<a href="/2021/08/21/kotlin-object-generic/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1wf4y1s7TG?p=95">https://www.bilibili.com/video/BV1wf4y1s7TG?p=95</a></p>
<p>generic</p>
<p>object目录下</p>
<h3 id="对象相关"><a href="#对象相关" class="headerlink" title="对象相关"></a>对象相关</h3><h5 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h5><p>类默认是封闭的，要让某个类开放继承，必须使用opem关键字修饰它</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>(<span class="keyword">val</span> name:String) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">description</span><span class="params">()</span></span> = <span class="string">&quot;Product: <span class="variable">$name</span>&quot;</span></span><br><span class="line">   <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">&quot;Nothing..&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LuxuryProduct</span> : <span class="type">Product</span></span>(<span class="string">&quot;Luxury&quot;</span>)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> =<span class="string">&quot; LuxuryProduct loading&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p : Product = LuxuryProduct()</span><br><span class="line">    println(p.load())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="类型检测-智能类型转换"><a href="#类型检测-智能类型转换" class="headerlink" title="类型检测 智能类型转换"></a>类型检测 智能类型转换</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_9.11.39_convert.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">println(p <span class="keyword">is</span> Product)</span><br><span class="line">println(p <span class="keyword">is</span> LuxuryProduct)</span><br><span class="line">println(p <span class="keyword">is</span> File)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (p <span class="keyword">is</span> LuxuryProduct)&#123;</span><br><span class="line">    println((p <span class="keyword">as</span> LuxuryProduct).special())</span><br><span class="line">    println(p.special()) <span class="comment">//只要转换一次，后面就直接可以使用，不用转换</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Kotlin层次"><a href="#Kotlin层次" class="headerlink" title="Kotlin层次"></a>Kotlin层次</h5><p>无须在代码里显示指定，每一个类都会继承一个共同的叫做Any的超类。</p>
<h5 id="Object关键字"><a href="#Object关键字" class="headerlink" title="Object关键字"></a>Object关键字</h5><p>定义一个能产生一个实例的类- 单例</p>
<p>Object关键字有三种方式</p>
<ol>
<li><p>对象声明</p>
<p>有利于组织代码和管理状态，尤其是管理整个应用运行生命周期内的某些一致性状态</p>
</li>
<li><p>对象表达式</p>
<p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_9.30.54_expression.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="keyword">open</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = <span class="string">&quot;loading nothing..&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//匿名内部类，实例p对象</span></span><br><span class="line">    <span class="keyword">val</span> p = <span class="keyword">object</span> : Player()&#123;</span><br><span class="line">        <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span>= <span class="string">&quot;anonymous nothing..&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    println(p.load())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>伴生对象</p>
<p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_9.40.03_companion.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 只要调用load() 或者实例化ConfigMap, 这个companion object才会被实例化</span></span><br><span class="line"><span class="comment"> * 而且也是单例的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigMap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> PATH = <span class="string">&quot;xxxx&quot;</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">load</span><span class="params">()</span></span> = File(PATH).readBytes()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">//  类似于Java static</span></span><br><span class="line">    ConfigMap.load()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="类相关"><a href="#类相关" class="headerlink" title="类相关"></a>类相关</h3><h5 id="嵌套类"><a href="#嵌套类" class="headerlink" title="嵌套类"></a>嵌套类</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_9.47.48_innerclass.png"></p>
<p>在Java中，当你在另一个类中声明一个类时，它会默认变成<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%86%85%E9%83%A8%E7%B1%BB&spm=1001.2101.3001.7020">内部类</a>。而在Kotlin中，没有显式修饰符的嵌套类与Java中的static嵌套类是一样的。要把它变成一个内部类来持有一个外部类的引用的话需要使用inner修饰符。</p>
<p>嵌套类和内部类在Java与Kotlin中的对应关系</p>
<table>
<thead>
<tr>
<th>类A在另一个类B中声明</th>
<th>在Java中</th>
<th>在Kotlin中</th>
</tr>
</thead>
<tbody><tr>
<td>嵌套类（不存储外部类的引用）</td>
<td>static class A</td>
<td>class A</td>
</tr>
<tr>
<td>内部类（存储外部类的引用）</td>
<td>class A</td>
<td>inner class A</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41953808/article/details/112450204">https://blog.csdn.net/weixin_41953808/article/details/112450204</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903910084182030">https://juejin.cn/post/6844903910084182030</a></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InnerClassTest</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Equipment</span></span>(<span class="keyword">var</span> name:String)&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">show</span><span class="params">()</span></span> = println(<span class="string">&quot;equipment:<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">battle</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    InnerClassTest.Equipment(<span class="string">&quot;shap knife&quot;</span>).show()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>在Kotlin中引用<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E5%A4%96%E9%83%A8%E7%B1%BB&spm=1001.2101.3001.7020">外部类</a>实例的语法，需要使用this@Outer从Inner类去访问Outer类：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">inner</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getOuterReference</span><span class="params">()</span></span>:Outer = <span class="keyword">this</span><span class="symbol">@Outer</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h5 id="数据类"><a href="#数据类" class="headerlink" title="数据类"></a>数据类</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_9.52.32_data.png"></p>
<h5 id="数据类使用条件"><a href="#数据类使用条件" class="headerlink" title="数据类使用条件"></a>数据类使用条件</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_11.01.56_data_condition.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x:<span class="built_in">Int</span>,<span class="keyword">var</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isInBounds = x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>))</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>)==Coordinate(<span class="number">10</span>,<span class="number">20</span>)) <span class="comment">//data默认重写equals方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>Coordinate(x=10, y=20) // 说明默认提供了toString方法</p>
</blockquote>
<p>重写了equals方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(<span class="meta">@Nullable</span> Object var1)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span> != var1) &#123;</span><br><span class="line">         <span class="keyword">if</span> (var1 <span class="keyword">instanceof</span> Coordinate) &#123;</span><br><span class="line">            Coordinate var2 = (Coordinate)var1;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.x == var2.x &amp;&amp; <span class="keyword">this</span>.y == var2.y) &#123;</span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Copy"><a href="#Copy" class="headerlink" title="Copy"></a>Copy</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_10.00_copy.png"></p>
<p>注意:次构造函数数据不会copy过来</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span>  <span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(</span><br><span class="line">        <span class="keyword">var</span> name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>	 <span class="comment">//age 主构造函数里声明的属性</span></span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> hobby = <span class="string">&quot;music&quot;</span></span><br><span class="line">    <span class="keyword">val</span> subject:String</span><br><span class="line">    <span class="keyword">var</span> score = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;initializing student&quot;</span>)</span><br><span class="line">        subject = <span class="string">&quot;english&quot;</span>			<span class="comment">//Init初始化块里的属性赋值和函数调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(_name: String):<span class="keyword">this</span>(_name,<span class="number">10</span>)&#123;</span><br><span class="line">        score = <span class="number">10</span>; <span class="comment">//次构造函数数据不会copy过来</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Student(name=&#x27;<span class="variable">$name</span>&#x27;, age=<span class="variable">$age</span>, hobby=&#x27;<span class="variable">$hobby</span>&#x27;, subject=&#x27;<span class="variable">$subject</span>&#x27;, score=<span class="variable">$score</span>)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> s = Student(<span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> copy = s.copy(<span class="string">&quot;girl&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> s2 = s.copy(name = <span class="string">&quot;girl2&quot;</span>, age = <span class="number">18</span>)</span><br><span class="line">    println(s)</span><br><span class="line">    println(s2)</span><br><span class="line">    println(copy)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="解构声明"><a href="#解构声明" class="headerlink" title="解构声明"></a>解构声明</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_10.13.25_component.png"></p>
<ol>
<li><p>普通类</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayerScore</span></span>(<span class="keyword">val</span> experience:<span class="built_in">Int</span>,<span class="keyword">val</span> level:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">component1</span><span class="params">()</span></span> = experience</span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">component2</span><span class="params">()</span></span> = level</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> (x,y) = PlayerScore(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$x</span>, <span class="variable">$y</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Data数据类</p>
<p>数据类自动生成解构语法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate</span></span>(<span class="keyword">var</span> x:<span class="built_in">Int</span>,<span class="keyword">var</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isInBounds = x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>))</span><br><span class="line">    println(Coordinate(<span class="number">10</span>,<span class="number">20</span>)==Coordinate(<span class="number">10</span>,<span class="number">20</span>)) </span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span>(x,y) = Coordinate(<span class="number">10</span>,<span class="number">20</span>) <span class="comment">//数据类自动生成解构语法</span></span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$x</span> , <span class="variable">$y</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="运算符重载"><a href="#运算符重载" class="headerlink" title="运算符重载"></a>运算符重载</h5><p>如果要将内置运算符应用在自定义类身上，你必须重写运算符函数，告诉编译器该如何操作自定义类</p>
<p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_10.24.07_overload.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Coordinate2</span></span>(<span class="keyword">var</span> x:<span class="built_in">Int</span>,<span class="keyword">var</span> y:<span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">val</span> isInBounds = x &gt; <span class="number">0</span> &amp;&amp; y &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">plus</span><span class="params">(other:<span class="type">Coordinate2</span>)</span></span> = Coordinate2(x + other.x,y+other.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">     <span class="keyword">val</span> c1=Coordinate2(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">     <span class="keyword">val</span> c2=Coordinate2(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">     println(c1 + c2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><p>用来定义常量集合特殊的类</p>
<p>枚举类是一个实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Direction</span> </span>&#123;</span><br><span class="line">    EAST,</span><br><span class="line">    WEST,</span><br><span class="line">    SOUTH,</span><br><span class="line">    NORTH</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Direction.EAST)</span><br><span class="line">    println(Direction.EAST <span class="keyword">is</span> Direction)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="枚举类定义函数"><a href="#枚举类定义函数" class="headerlink" title="枚举类定义函数"></a>枚举类定义函数</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="class"><span class="keyword">class</span> <span class="title">Direction2</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> coordinate: Coordinate) &#123; <span class="comment">// 枚举里可以有属性</span></span><br><span class="line">    EAST(Coordinate(<span class="number">1</span>, <span class="number">0</span>)), <span class="comment">//EAST()是Direction2的实例</span></span><br><span class="line">    WEST(Coordinate(-<span class="number">1</span>, <span class="number">0</span>)),</span><br><span class="line">    SOUTH(Coordinate(-<span class="number">1</span>, <span class="number">0</span>)),</span><br><span class="line">    NORTH(Coordinate(<span class="number">1</span>, <span class="number">0</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//枚举里可以定义函数</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">updateCoordinate</span><span class="params">(playerCoordinate: <span class="type">Coordinate</span>)</span></span> =</span><br><span class="line">            Coordinate(playerCoordinate.x + coordinate.x, playerCoordinate.y + coordinate.y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    println(Direction2.EAST.updateCoordinate(Coordinate(<span class="number">10</span>, <span class="number">20</span>)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//打印 11 20</span></span><br></pre></td></tr></table></figure>



<h5 id="代数数据类型"><a href="#代数数据类型" class="headerlink" title="代数数据类型"></a>代数数据类型</h5><p>可以用来表示一组子类型的闭集，枚举类就是一种简单的ADT</p>
<p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_10.40.31_enum_data.png"></p>
<h5 id="密封类"><a href="#密封类" class="headerlink" title="密封类"></a>密封类</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-21_10.42.08_closure_sealed.png"></p>
<p>  class Qualified(val licenseId:String):LicenseStatus2() 保存数据，如果用emum类 会很麻烦</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//密封类</span></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">LicenseStatus2</span> </span>&#123;</span><br><span class="line">  <span class="comment">//下面3个类都是 密封类的子类</span></span><br><span class="line">    <span class="keyword">object</span> UnQualified:LicenseStatus2() <span class="comment">// 没有属性 用单例，否则每次够构建新的对象</span></span><br><span class="line">    <span class="keyword">object</span> Learning:LicenseStatus2()</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Qualified</span></span>(<span class="keyword">val</span> licenseId:String):LicenseStatus2() <span class="comment">//密封类的特性 用来保存数据,可能licenseId不一样，所以用class</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Driver2</span></span>(<span class="keyword">var</span> status: LicenseStatus2)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">checkLicense</span><span class="params">()</span></span>:String&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">when</span>(status)&#123;</span><br><span class="line">            <span class="keyword">is</span> LicenseStatus2.UnQualified -&gt; <span class="string">&quot;没资格&quot;</span></span><br><span class="line">            <span class="keyword">is</span> LicenseStatus2.Learning -&gt; <span class="string">&quot;在学&quot;</span></span><br><span class="line">            <span class="keyword">is</span> LicenseStatus2.Qualified -&gt; <span class="string">&quot;有资格，驾驶证编号: <span class="subst">$&#123;((this.status as LicenseStatus2.Qualified).licenseId)&#125;</span>&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> status1 = LicenseStatus2.Learning</span><br><span class="line">    <span class="keyword">val</span> status = LicenseStatus2.Qualified(<span class="string">&quot;2333003&quot;</span>) <span class="comment">// 可以直接传驾驶证编号</span></span><br><span class="line">    <span class="keyword">val</span> driver = Driver2(status)</span><br><span class="line">    println(driver.checkLicense())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_9.59.22_interface.png"></p>
<p>InterfaceTest.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Movable</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> maxSpeed:<span class="built_in">Int</span></span><br><span class="line">    <span class="keyword">var</span> wheels:<span class="built_in">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable:<span class="type">Movable</span>)</span></span>:String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>(_name:String,<span class="keyword">override</span>  <span class="keyword">var</span> wheels:<span class="built_in">Int</span>=<span class="number">4</span>):Movable&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> maxSpeed: <span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable: <span class="type">Movable</span>)</span></span>: String &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="默认实现"><a href="#默认实现" class="headerlink" title="默认实现"></a>默认实现</h5><p>可以在接口里提供默认属性getter方法和函数实现</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Movable</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> maxSpeed:<span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = (<span class="number">1.</span><span class="number">.500</span>).shuffled().last()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> wheels:<span class="built_in">Int</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable:<span class="type">Movable</span>)</span></span>:String</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span></span>(_name:String,<span class="keyword">override</span>  <span class="keyword">var</span> wheels:<span class="built_in">Int</span>=<span class="number">4</span>):Movable&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="keyword">var</span> maxSpeed: <span class="built_in">Int</span></span><br><span class="line">        <span class="keyword">get</span>() = <span class="keyword">super</span>.maxSpeed</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">move</span><span class="params">(movable: <span class="type">Movable</span>)</span></span>: String &#123;</span><br><span class="line">        TODO(<span class="string">&quot;Not yet implemented&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>抽象类</p>
<p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_10.13.48_abstract.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Gun</span></span>(<span class="keyword">val</span> range: <span class="built_in">Int</span>) &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">pullTrigger</span><span class="params">()</span></span>: String</span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">()</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;doSomething&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AK47</span></span>(<span class="keyword">val</span> price: <span class="built_in">Int</span>) : Gun(range = <span class="number">500</span>)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">pullTrigger</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        TODO()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h3><h5 id="定义泛型类"><a href="#定义泛型类" class="headerlink" title="定义泛型类"></a>定义泛型类</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_10.25.51_generics.png"></p>
<p>magicBox1.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T</span>&gt;</span>(item:T)&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject:T = item</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name:String,<span class="keyword">val</span> age:<span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight:<span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    <span class="keyword">val</span> box2 = MagicBox(Dog( <span class="number">20</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_20.30.09_notice.png"></p>
<h5 id="泛型函数"><a href="#泛型函数" class="headerlink" title="泛型函数"></a>泛型函数</h5><ol>
<li><p>泛型参数也可以用于函数。</p>
</li>
<li><p>定义一个函数用于获取元素，当且仅当MagicBox可用时，才能获取元素。</p>
<p>magicBox2.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T</span>&gt;</span>(item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: T = item</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">()</span></span>: T? &#123; <span class="comment">// 泛型函数</span></span><br><span class="line">        <span class="keyword">return</span> subject.takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    <span class="keyword">val</span> box2 = MagicBox(Dog(<span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch()?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="多泛型参数"><a href="#多泛型参数" class="headerlink" title="多泛型参数"></a>多泛型参数</h5><p>magicBox3.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T</span>&gt;</span>(item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: T = item</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject.takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    <span class="keyword">val</span> box2 = MagicBox(Dog(<span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch()?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>)) <span class="comment">// Boy 转成Man了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="泛型类型约束"><a href="#泛型类型约束" class="headerlink" title="泛型类型约束"></a>泛型类型约束</h5><p>确保MagicBox只能装指定类型的物品， 如Human类型，咋弄?</p>
<p>magicBox4.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox4</span>&lt;<span class="type">T:Human</span>&gt;</span>(item: T) &#123;      <span class="comment">//这里添加约束</span></span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: T = item</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">()</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject.takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String,  age: <span class="built_in">Int</span>):Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox4(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>))</span><br><span class="line"><span class="comment">//    val box2 = MagicBox4(Dog(20)) //因为约束类型，导致这里会报错</span></span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch()?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="vararg关键字与get函数"><a href="#vararg关键字与get函数" class="headerlink" title="vararg关键字与get函数"></a>vararg关键字与get函数</h5><p>MagicBox能存放任何类型的Human实例，但一次只能放一个，如果要存放多个实例呢？</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T : Human</span>&gt;</span>(<span class="keyword">vararg</span> item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: Array&lt;<span class="keyword">out</span> T&gt; = item <span class="comment">//可变参数 必须写out</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>)</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject[index].takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>, subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject[index]).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jack&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jon&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch(<span class="number">1</span>)?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch(<span class="number">2</span>) &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="操作符"><a href="#操作符" class="headerlink" title="[]操作符"></a>[]操作符</h5><p>运算符重载</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T : Human</span>&gt;</span>(<span class="keyword">vararg</span> item: T) &#123;</span><br><span class="line">    <span class="keyword">var</span> available = <span class="literal">false</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">var</span> subject: Array&lt;<span class="keyword">out</span> T&gt; = item <span class="comment">//可变参数 必须写out</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>)</span></span>: T? &#123;</span><br><span class="line">        <span class="keyword">return</span> subject[index].takeIf &#123; available &#125; <span class="comment">//当available =true，返回接收者对象</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// return R缩写</span></span><br><span class="line">    <span class="comment">// 业务，把元素进行修改，魔盒里放的是男孩，取出来，变成男人</span></span><br><span class="line">    <span class="comment">//传入subjectModfunction是匿名函数类型 (T)-&gt;(R), 这个匿名函数传入的是 T 返回的是R,fetch执行返回的是R类型</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="type">&lt;R&gt;</span> <span class="title">fetch</span><span class="params">(index: <span class="type">Int</span>, subjectModFunction: (<span class="type">T</span>) -&gt; <span class="type">R</span>)</span></span>: R? &#123;</span><br><span class="line">        <span class="keyword">return</span> subjectModFunction(subject[index]).takeIf &#123; available &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">operator</span> <span class="function"><span class="keyword">fun</span> <span class="title">get</span><span class="params">(index: <span class="type">Int</span>)</span></span>: T? = subject[index]?.takeIf &#123; available &#125; <span class="comment">//运算符重载</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>(<span class="keyword">val</span> weight: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1 = MagicBox(Boy(<span class="string">&quot;John&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jack&quot;</span>, <span class="number">20</span>), Boy(<span class="string">&quot;Jon&quot;</span>, <span class="number">20</span>))</span><br><span class="line">    box1.available = <span class="literal">true</span></span><br><span class="line">    box1.fetch(<span class="number">1</span>)?.run &#123;</span><br><span class="line">        println(<span class="string">&quot;you find <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> fetch = box1.fetch(<span class="number">2</span>) &#123;</span><br><span class="line">        Man(it.name, it.age.plus(<span class="number">15</span>))</span><br><span class="line">    &#125;</span><br><span class="line">    box1[<span class="number">0</span>] <span class="comment">//运算符重载后 重写get，就能这样操作了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="invariant-不变"><a href="#invariant-不变" class="headerlink" title="invariant 不变"></a>invariant 不变</h5><p>如果泛型类即将泛型类型作为函数参数，又将泛型类型作为函数的输出，那么即不用out也不用in.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ProductionConsumer</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: T</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// out</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Production</span>&lt;<span class="type">out T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: T</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// in</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="type">in T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//    fun consume(item:T):T //Type parameter T is declared as &#x27;in&#x27; but occurs in &#x27;out&#x27; position in type T</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//不变</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ProductionConsumer</span>&lt;<span class="type">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: T</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Food</span></span></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">FastFood</span>:<span class="type">Food</span></span>()</span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Burger</span> :<span class="type">FastFood</span></span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//生产者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FoodStore</span> : <span class="type">Production</span>&lt;<span class="type">Food</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: Food &#123;</span><br><span class="line">        println(<span class="string">&quot;Product food&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> Food()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FastFoodStore</span> : <span class="type">Production</span>&lt;<span class="type">FastFood</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: FastFood &#123;</span><br><span class="line">        println(<span class="string">&quot;Product FastFood&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> FastFood()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BurgerFoodStore</span> : <span class="type">Production</span>&lt;<span class="type">Burger</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: Burger &#123;</span><br><span class="line">        println(<span class="string">&quot;Product Burger&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> Burger()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EveryBody</span> : <span class="type">Consumer</span>&lt;<span class="type">Food</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">Food</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Eat food.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ModernPeople</span> : <span class="type">Consumer</span>&lt;<span class="type">FastFood</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">FastFood</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Eat fastFood&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmericanPeople</span> : <span class="type">Consumer</span>&lt;<span class="type">Burger</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">Burger</span>)</span></span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Eat Burger&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="Out生产"><a href="#Out生产" class="headerlink" title="Out生产"></a>Out生产</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="/2021/08/21/kotlin-object-generic/2021-08-22_11.08.36_out.png"></h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Production</span>&lt;<span class="type">out T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">product</span><span class="params">()</span></span>: T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li><p>子类泛型对象可以赋值给父类泛型对象 如 下面production2</p>
</li>
<li><p>java. T extends Food  等于kotlin   T : Food</p>
</li>
<li><p>泛型有继承关系，可以直接赋值，java做不到,只能强转</p>
</li>
<li><p>ArrayList<CharSequence> list = new ArrayList<String>(); // java里面这种写法报错</String></CharSequence></p>
</li>
</ol>
<p><strong>java只有 ? super Food 和 ? extends Food , 没有对泛型T , in out这种操作</strong> </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> production1 : Production&lt;Food&gt; = FoodStore() <span class="comment">// 理解时，别看方法只看类就可以了，父子类关系</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//子类泛型对象可以赋值给父类泛型对象，用out</span></span><br><span class="line">    <span class="keyword">val</span> production2 : Production&lt;Food&gt; = FastFoodStore() <span class="comment">// 就是因为有 out，out删除就报错, java这种写法直接报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>为什么需要 out</p>
<p>如果泛型有继承关系，可以直接赋值, Java只能用具体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericTypeTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//String是CharSequence的子类</span></span><br><span class="line"><span class="comment">//        ArrayList&lt;CharSequence&gt; list = new ArrayList&lt;String&gt;(); // java里面这种写法报错</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_11.37.32_why_inout.png"></p>
<h5 id="In-输入"><a href="#In-输入" class="headerlink" title="In 输入"></a>In 输入</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_11.11.09_IN.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Consumer</span>&lt;<span class="type">in T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//    fun consume(item:T):T //Type parameter T is declared as &#x27;in&#x27; but occurs in &#x27;out&#x27; position in type T</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">consume</span><span class="params">(item: <span class="type">T</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li>父类泛型对象可以赋值给子类泛型对象 ， 用in</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	    <span class="comment">//父类泛型对象可以赋值给子类泛型对象 ， 用in</span></span><br><span class="line">    <span class="keyword">val</span> consumer1:Consumer&lt;Burger&gt; = EveryBody()</span><br><span class="line"><span class="comment">//    val consumer2:Consumer&lt;Food&gt; = ModernPeople()//Required:Consumer&lt;Food&gt; Found : ModernPeople java里面必须要具体的类型,像上面的ArrayList</span></span><br><span class="line">  </span><br><span class="line">    <span class="keyword">val</span> consumer2:Consumer&lt;Burger&gt; = ModernPeople()</span><br><span class="line">    consumer2.consume(Burger())</span><br><span class="line"><span class="comment">//    consumer2.consume(Food())</span></span><br><span class="line">    <span class="keyword">val</span> consumer3:Consumer&lt;Burger&gt; = AmericanPeople()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h5 id="Reified"><a href="#Reified" class="headerlink" title="Reified"></a>Reified</h5><p><img src="/2021/08/21/kotlin-object-generic/2021-08-22_reified.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MagicBox</span>&lt;<span class="type">T : Human</span>&gt;</span>() &#123; <span class="comment">// 这里的T类型没用</span></span><br><span class="line">    <span class="comment">//随机产生一个对象，如果不是指定类型的对象，就通过backup函数生成一个指定类型的对象</span></span><br><span class="line"><span class="comment">//    fun &lt;T&gt; randomOrBackup(backup: () -&gt; T): T &#123;    // backup: ()-&gt;T 函数 和randomOrBackup返回的都是T类型</span></span><br><span class="line"><span class="comment">//          val items = listOf(Boy(&quot;jocnk&quot;, 20), Man(&quot;john&quot;, 20))</span></span><br><span class="line"><span class="comment">//          val random = items.shuffled().first()</span></span><br><span class="line"><span class="comment">//          return if (random is T) &#123;</span></span><br><span class="line"><span class="comment">//              random</span></span><br><span class="line"><span class="comment">//          &#125; else &#123;</span></span><br><span class="line"><span class="comment">//              backup()</span></span><br><span class="line"><span class="comment">//          &#125;</span></span><br><span class="line"><span class="comment">//      &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//随机产生一个对象，如果不是指定类型T的对象，就通过backup函数生成一个指定类型T的对象</span></span><br><span class="line">    <span class="comment">// 根据传进来的Man对象类型，推断T类型为Man</span></span><br><span class="line">    <span class="comment">// backup: ()-&gt;T 函数 和randomOrBackup返回的都是T类型</span></span><br><span class="line">    <span class="comment">//inline  reified一起使用</span></span><br><span class="line">    <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">randomOrBackup</span><span class="params">(backup: () -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">        <span class="keyword">val</span> items = listOf(Boy(<span class="string">&quot;jocnk&quot;</span>, <span class="number">20</span>), Man(<span class="string">&quot;john&quot;</span>, <span class="number">20</span>))</span><br><span class="line">        <span class="keyword">val</span> random = items.shuffled().first()</span><br><span class="line">        println(random)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (random <span class="keyword">is</span> T) &#123;</span><br><span class="line">            random</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            backup()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> box1: MagicBox&lt;Man&gt; = MagicBox() <span class="comment">// 这里T类型不起作用</span></span><br><span class="line">    <span class="comment">// 由backup函数推断出来T的类型</span></span><br><span class="line">    <span class="keyword">val</span> subject = box1.randomOrBackup &#123; Man(<span class="string">&quot;Jimmy&quot;</span>, <span class="number">28</span>) &#125;  <span class="comment">//根据传进来的Man对象类型，推断T类型为Man</span></span><br><span class="line">    println(subject)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Human</span></span>(<span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boy</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Boy(name=&#x27;<span class="variable">$name</span>&#x27;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span></span>(<span class="keyword">val</span> name: String, age: <span class="built_in">Int</span>) : Human(age)&#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">toString</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Man(name=&#x27;<span class="variable">$name</span>&#x27;)&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-kotlin-collection-class" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/08/21/kotlin-collection-class/">kotlin-collection-class</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2021-08-21T08:48:52.000Z" itemprop="datePublished">2021年08月21日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Kotlin/">Kotlin</a>
  </div>

      
      
<a href="/2021/08/21/kotlin-collection-class/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h3><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>List.kt</p>
<h5 id="List创建与元素获取"><a href="#List创建与元素获取" class="headerlink" title="List创建与元素获取"></a>List创建与元素获取</h5><p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_getelseif.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list = listOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>)</span><br><span class="line">println(list.getOrElse(<span class="number">3</span>) &#123; <span class="string">&quot;Unknown&quot;</span> &#125;)</span><br><span class="line">println(list.getOrNull(<span class="number">3</span>))</span><br><span class="line">println(list.getOrNull(<span class="number">3</span>) ?: <span class="string">&quot;Unknown&quot;</span>)</span><br></pre></td></tr></table></figure>



<h5 id="可变列表"><a href="#可变列表" class="headerlink" title="可变列表"></a>可变列表</h5><p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_16-57-45_mutable.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> mutableList = mutableListOf(<span class="string">&quot;Jason&quot;</span>, <span class="string">&quot;Jack&quot;</span>, <span class="string">&quot;girl1&quot;</span>)</span><br><span class="line">mutableList.add(<span class="string">&quot;Jimmy&quot;</span>)</span><br><span class="line">mutableList.remove(<span class="string">&quot;Jack&quot;</span>)</span><br><span class="line">println(mutableList)</span><br><span class="line"></span><br><span class="line">list.toMutableList() <span class="comment">// 不可变转可变</span></span><br><span class="line">mutableList.toList() <span class="comment">// 可变转不可变</span></span><br></pre></td></tr></table></figure>



<h5 id="mutator函数"><a href="#mutator函数" class="headerlink" title="mutator函数"></a>mutator函数</h5><p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_17-01-19_mutaber.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutableList += <span class="string">&quot;John&quot;</span></span><br><span class="line">mutableList -= <span class="string">&quot;girl1&quot;</span></span><br><span class="line">mutableList.removeIf&#123;it.contains(<span class="string">&quot;Jack&quot;</span>)&#125; <span class="comment">//包含Jack就把 Jack移除</span></span><br><span class="line">println(mutableList)</span><br></pre></td></tr></table></figure>



<h5 id="集合遍历"><a href="#集合遍历" class="headerlink" title="集合遍历"></a>集合遍历</h5><ol>
<li>for in</li>
<li>forEach</li>
<li>forEachIndexed遍历时要获取索引</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (s <span class="keyword">in</span> list)&#123;</span><br><span class="line">    println(s)</span><br><span class="line">&#125;</span><br><span class="line">list.forEach&#123;</span><br><span class="line">    println(it)</span><br><span class="line">&#125;</span><br><span class="line">list.forEachIndexed&#123;index,item-&gt;</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$index</span>  <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h5><p>通过_符号过滤不想要的元素</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    val(girl1,girl2,girl3) = list</span></span><br><span class="line">    <span class="keyword">val</span>(girl1,_,girl3) = list   <span class="comment">//如果不需要girl2,用_，这个字节码也不会取出</span></span><br></pre></td></tr></table></figure>



<h4 id="Set集合"><a href="#Set集合" class="headerlink" title="Set集合"></a>Set集合</h4><h5 id="elementAt获取元素"><a href="#elementAt获取元素" class="headerlink" title="elementAt获取元素"></a>elementAt获取元素</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> <span class="keyword">set</span> = setOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>)</span><br><span class="line">println(<span class="keyword">set</span>.elementAt(<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> mutableSet = mutableSetOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>)</span><br><span class="line">mutableSet += <span class="string">&quot;girl5&quot;</span></span><br></pre></td></tr></table></figure>



<h5 id="List去重"><a href="#List去重" class="headerlink" title="List去重"></a>List去重</h5><p>通过toSet去重</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> list = mutableSetOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>).toSet().toList()</span><br><span class="line">println(list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> distinct = mutableSetOf(<span class="string">&quot;girl1&quot;</span>, <span class="string">&quot;girl2&quot;</span>, <span class="string">&quot;girl3&quot;</span>, <span class="string">&quot;girl1&quot;</span>).distinct()</span><br><span class="line">println(distinct)</span><br></pre></td></tr></table></figure>



<h5 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h5><p> kotlin提供了各种Array,虽然是引用类型，但最终编译成Java基本数据类型</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> intArray = intArrayOf(<span class="number">10</span>, <span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line">listOf(<span class="number">10</span>, <span class="number">30</span>, <span class="number">40</span>).toIntArray()</span><br><span class="line"><span class="keyword">val</span> array = arrayOf(File(<span class="string">&quot;xxx&quot;</span>), File(<span class="string">&quot;yyyy&quot;</span>))</span><br></pre></td></tr></table></figure>



<p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_17-32-32_array.png"></p>
<h4 id="Map集合"><a href="#Map集合" class="headerlink" title="Map集合"></a>Map集合</h4><p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_17-51-48_map_read.png"></p>
<h5 id="map获取"><a href="#map获取" class="headerlink" title="map获取"></a>map获取</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">println(map[<span class="string">&quot;lucy1&quot;</span>])</span><br><span class="line">println(map.getValue(<span class="string">&quot;lucy2&quot;</span>))</span><br><span class="line">println(map.getOrElse(<span class="string">&quot;Jon&quot;</span>)&#123;<span class="string">&quot;Unknown&quot;</span>&#125;) <span class="comment">//没有Jon，返回Unknown</span></span><br><span class="line">println(map.getOrDefault(<span class="string">&quot;Jon&quot;</span>,<span class="number">0</span>)) <span class="comment">//没有Jon，返回默认值0</span></span><br></pre></td></tr></table></figure>



<h5 id="map遍历"><a href="#map遍历" class="headerlink" title="map遍历"></a>map遍历</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">map.forEach&#123;</span><br><span class="line">    println(<span class="string">&quot;<span class="subst">$&#123;it.key&#125;</span>, <span class="subst">$&#123;it.value&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">map.forEach&#123;(key:String,value:<span class="built_in">Int</span>)-&gt;</span><br><span class="line">    println(<span class="string">&quot;<span class="subst">$&#123;key&#125;</span>, <span class="subst">$&#123;value&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="mutableMap"><a href="#mutableMap" class="headerlink" title="mutableMap"></a>mutableMap</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> mutableMap = mutableMapOf(<span class="string">&quot;lucy1&quot;</span> to <span class="number">18</span>, <span class="string">&quot;lucy2&quot;</span> to <span class="number">19</span>, <span class="string">&quot;lucy3&quot;</span> to <span class="number">20</span>)</span><br><span class="line">mutableMap += <span class="string">&quot;jon&quot;</span> to <span class="number">22</span></span><br><span class="line">mutableMap.put(<span class="string">&quot;jon2&quot;</span>,<span class="number">35</span>)</span><br><span class="line">mutableMap.getOrPut(<span class="string">&quot;Rose&quot;</span>)&#123;<span class="number">30</span>&#125; <span class="comment">// 如果没有Rose,就添加进来</span></span><br><span class="line">println(mutableMap)</span><br></pre></td></tr></table></figure>



<h3 id="定义类"><a href="#定义类" class="headerlink" title="定义类"></a>定义类</h3><p><img src="/2021/08/21/kotlin-collection-class/2021-08-211_8-32-51_field_class.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Class Player&#123;</span><br><span class="line">	<span class="keyword">var</span> name:String? = <span class="string">&quot;jack&quot;</span> <span class="comment">// 编译后生成了get. set方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">  <span class="keyword">var</span> p = Player()</span><br><span class="line">  p.name = <span class="string">&quot;rose&quot;</span> <span class="comment">//编译生成了 setName方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="计算属性"><a href="#计算属性" class="headerlink" title="计算属性"></a>计算属性</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> name: String = <span class="string">&quot;jack&quot;</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value.trim()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//计算属性是通过一个覆盖的get或set运算符来定义，这时field就不需要了。</span></span><br><span class="line">    <span class="keyword">val</span> rolledValue</span><br><span class="line">        <span class="keyword">get</span>() = (<span class="number">1.</span><span class="number">.6</span>).shuffled().first()</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="防范竞态条件"><a href="#防范竞态条件" class="headerlink" title="防范竞态条件"></a>防范竞态条件</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    如果一个类属性即可空又可变，那么引用它之前必须保证它非空，一个办法是用also标准函数</span></span><br><span class="line">    <span class="keyword">var</span> words:String? = <span class="string">&quot;hello&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">saySomething</span><span class="params">()</span></span>&#123;</span><br><span class="line">        words?.also &#123; </span><br><span class="line">            println(<span class="string">&quot;Hello <span class="subst">$&#123;it.uppercase()&#125;</span>&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h5 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        _age: <span class="built_in">Int</span>,</span><br><span class="line">        _isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">var</span> age = _age <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = age.absoluteValue</span><br><span class="line">        <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            field = value.absoluteValue</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">var</span> isNormal = _isNormal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Student(<span class="string">&quot;john&quot;</span>, <span class="number">19</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//    p.name = &quot;rose&quot; //Cannot assign to &#x27;name&#x27;: the setter is private in &#x27;Student&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="主构造函数里定义属性"><a href="#主构造函数里定义属性" class="headerlink" title="主构造函数里定义属性"></a>主构造函数里定义属性</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student2</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>,</span><br><span class="line">        <span class="keyword">val</span> isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Student2(<span class="string">&quot;john&quot;</span>, <span class="number">19</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="comment">//    p.name = &quot;rose&quot; //Cannot assign to &#x27;name&#x27;: the setter is private in &#x27;Student&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="次构造函数"><a href="#次构造函数" class="headerlink" title="次构造函数"></a>次构造函数</h5><p>Student2.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(_name:String):<span class="keyword">this</span>(_name,age=<span class="number">100</span>,isNormal = <span class="literal">false</span>)</span><br><span class="line"><span class="keyword">constructor</span>(_name:String,age: <span class="built_in">Int</span>):<span class="keyword">this</span>(_name,age=<span class="number">100</span>,isNormal = <span class="literal">false</span>)&#123; <span class="comment">//定义初始化代码逻辑</span></span><br><span class="line">    <span class="keyword">this</span>.name = name.uppercase()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">val</span> p2 = Student2(<span class="string">&quot;Rose&quot;</span>)</span><br><span class="line">    <span class="keyword">val</span> p3 = Student2(<span class="string">&quot;Rose&quot;</span>,<span class="number">20</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="构造函数给默认值"><a href="#构造函数给默认值" class="headerlink" title="构造函数给默认值"></a>构造函数给默认值</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student3</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">20</span>,</span><br><span class="line">        <span class="keyword">val</span> isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Student3(isNormal = <span class="literal">false</span>, _name = <span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="初始化块"><a href="#初始化块" class="headerlink" title="初始化块"></a>初始化块</h5><p>初始化块可以设置变量或值，以及执行有效性检查，如果检查传给某构造函数的值是否有效，<strong>初始化块代码会在构造类实例时执行</strong>。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student3</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span> = <span class="number">20</span>,</span><br><span class="line">        <span class="keyword">val</span> isNormal: <span class="built_in">Boolean</span></span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name <span class="comment">//临时变量用 _表示 只用一次</span></span><br><span class="line">        <span class="keyword">get</span>() = field.capitalize()</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">set</span>(value) &#123;</span><br><span class="line">            value.trim()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>&#123;</span><br><span class="line">        require(age&gt;<span class="number">0</span>)&#123;<span class="string">&quot;age must be positive&quot;</span>&#125;</span><br><span class="line">        require(name.isNotBlank())&#123;<span class="string">&quot;player must have a name.&quot;</span>&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Student3(isNormal = <span class="literal">false</span>, _name = <span class="string">&quot;Jon&quot;</span>)</span><br><span class="line">    Student3(isNormal = <span class="literal">false</span>, _name = <span class="string">&quot;&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="初始化顺序"><a href="#初始化顺序" class="headerlink" title="初始化顺序"></a>初始化顺序</h5><ol>
<li>主构造函数里声明的属性</li>
<li>类级别的属性赋值</li>
<li>Init初始化块里的属性赋值和函数调用</li>
<li>次构造函数里的属性赋值和函数调用</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student4</span></span>(</span><br><span class="line">        _name: String,</span><br><span class="line">        <span class="keyword">val</span> age: <span class="built_in">Int</span>	 <span class="comment">//age 主构造函数里声明的属性</span></span><br><span class="line">)&#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name	<span class="comment">//类级别的属性赋值 	name , score, hobby</span></span><br><span class="line">    <span class="keyword">var</span> score = <span class="number">10</span>;	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> hobby = <span class="string">&quot;music&quot;</span> </span><br><span class="line">    <span class="keyword">val</span> subject:String</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;initializing student&quot;</span>)	</span><br><span class="line">        subject = <span class="string">&quot;english&quot;</span>			<span class="comment">//Init初始化块里的属性赋值和函数调用</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(_name: String):<span class="keyword">this</span>(_name,<span class="number">10</span>)&#123;</span><br><span class="line">        score = <span class="number">20</span>		<span class="comment">//次构造函数里的属性赋值和函数调用</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Student4(<span class="string">&quot;jon&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>反编译字节码后</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student4</span><span class="params">(<span class="meta">@NotNull</span> String _name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">   Intrinsics.checkNotNullParameter(_name, <span class="string">&quot;_name&quot;</span>);</span><br><span class="line">   <span class="keyword">super</span>();</span><br><span class="line">   <span class="keyword">this</span>.age = age;			<span class="comment">//主构造函数里声明的属性</span></span><br><span class="line">   <span class="keyword">this</span>.name = _name;		<span class="comment">//类级别的属性赋值	name , score, hobby</span></span><br><span class="line">   <span class="keyword">this</span>.score = <span class="number">10</span>;			</span><br><span class="line">   <span class="keyword">this</span>.hobby = <span class="string">&quot;music&quot;</span>;</span><br><span class="line">   String var3 = <span class="string">&quot;initializing student&quot;</span>; 		<span class="comment">//Init初始化块里的属性赋值和函数调用</span></span><br><span class="line">   <span class="keyword">boolean</span> var4 = <span class="keyword">false</span>;</span><br><span class="line">   System.out.println(var3);</span><br><span class="line">   <span class="keyword">this</span>.subject = <span class="string">&quot;english&quot;</span>;		</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Student4</span><span class="params">(<span class="meta">@NotNull</span> String _name)</span> </span>&#123;  <span class="comment">//调用这个构造方法</span></span><br><span class="line">   Intrinsics.checkNotNullParameter(_name, <span class="string">&quot;_name&quot;</span>);</span><br><span class="line">   <span class="keyword">this</span>(_name, <span class="number">10</span>); </span><br><span class="line">   <span class="keyword">this</span>.score = <span class="number">20</span>;			<span class="comment">//次构造函数里的属性赋值和函数调用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_20-07-53_class_init_order.png"></p>
<h5 id="延迟初始化"><a href="#延迟初始化" class="headerlink" title="延迟初始化"></a>延迟初始化</h5><p><img src="/2021/08/21/kotlin-collection-class/2021-08-21_8.18.35_lateinit.png"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player4</span> </span>&#123;</span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> equipment:String</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">ready</span><span class="params">()</span></span>&#123;</span><br><span class="line">        equipment = <span class="string">&quot;sharp knife&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">battle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (::equipment.isInitialized) println(equipment)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Player4()</span><br><span class="line">    p.ready()</span><br><span class="line">    p.battle()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="惰性初始化"><a href="#惰性初始化" class="headerlink" title="惰性初始化"></a>惰性初始化</h5><p>延迟初始化并不是推后初始化的唯一方式，也可以暂时不初始化某个变量，<strong>直到首次使用它才初始化</strong>，这个叫做惰性初始化。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player5</span></span>(_name: String) &#123;</span><br><span class="line">    <span class="keyword">var</span> name = _name</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> config <span class="keyword">by</span> lazy &#123; loadConfig() &#125; <span class="comment">// 懒汉式</span></span><br><span class="line"><span class="comment">//    val config = loadConfig()   //饿汉式</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">loadConfig</span><span class="params">()</span></span>: String &#123;</span><br><span class="line">        println(<span class="string">&quot;loading...&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;beauty girl&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> p = Player5(<span class="string">&quot;girl&quot;</span>)</span><br><span class="line">    Thread.sleep(<span class="number">5000</span>)</span><br><span class="line">    println(p.config)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Java不会有这种陷阱</p>
<h5 id="初始化陷阱1"><a href="#初始化陷阱1" class="headerlink" title="初始化陷阱1"></a>初始化陷阱1</h5><p>顺序非常重要，必须保证块中的所有属性已完成初始化</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">init</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> bloodBonus = blood.times(<span class="number">4</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> blood  = <span class="number">100</span> <span class="comment">//必须保证块中的所有属性已完成初始化</span></span><br></pre></td></tr></table></figure>



<h5 id="初始化陷阱2"><a href="#初始化陷阱2" class="headerlink" title="初始化陷阱2"></a>初始化陷阱2</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player7</span> </span>&#123;</span><br><span class="line">   <span class="keyword">val</span> name:String <span class="comment">//类级别属性</span></span><br><span class="line">   <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span>  <span class="title">firstLetter</span><span class="params">()</span></span> = name[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(firstLetter())</span><br><span class="line">        name= <span class="string">&quot;john&quot;</span>    <span class="comment">//初始化块代码排第三</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    Player7()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="初始化陷阱3"><a href="#初始化陷阱3" class="headerlink" title="初始化陷阱3"></a>初始化陷阱3</h5><p>initPlayerName() 初始化 playerName时，name属性还未完初始化。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InitTrapTest3</span></span>(_name:String) &#123;</span><br><span class="line">    <span class="keyword">val</span> playerName:String = initPlayerName()</span><br><span class="line">    <span class="keyword">val</span> name:String = _name     <span class="comment">//这个要放第一句</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">initPlayerName</span><span class="params">()</span></span> = name</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">   println(InitTrapTest3(<span class="string">&quot;John&quot;</span>).playerName)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/5/index.html">https://noteforme.github.io/page/5/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<a class="extend prev" rel="prev" href="/page/4/">Previous</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/6/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/08/20/compose-layout/">compose_layout</a>
          </li>
        
          <li>
            <a href="/2023/08/19/compose/">compose</a>
          </li>
        
          <li>
            <a href="/2023/08/09/LC-DP-BAG/">LC_DP_BAG</a>
          </li>
        
          <li>
            <a href="/2023/04/02/LC-DP/">LC-DP</a>
          </li>
        
          <li>
            <a href="/2023/01/10/RecyclerView-padding/">RecyclerView-padding</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ANDROID/" style="font-size: 12.86px;">ANDROID</a> <a href="/tags/AOSP/" style="font-size: 18.57px;">AOSP</a> <a href="/tags/Activity/" style="font-size: 10px;">Activity</a> <a href="/tags/AndroidNewFeatures/" style="font-size: 10px;">AndroidNewFeatures</a> <a href="/tags/Assembly/" style="font-size: 10px;">Assembly</a> <a href="/tags/BLOG/" style="font-size: 10px;">BLOG</a> <a href="/tags/ConstraintLayout/" style="font-size: 10px;">ConstraintLayout</a> <a href="/tags/DB/" style="font-size: 11.43px;">DB</a> <a href="/tags/Drawer/" style="font-size: 10px;">Drawer</a> <a href="/tags/Fragment/" style="font-size: 11.43px;">Fragment</a> <a href="/tags/Git/" style="font-size: 11.43px;">Git</a> <a href="/tags/JVM/" style="font-size: 18.57px;">JVM</a> <a href="/tags/LEETCODE/" style="font-size: 20px;">LEETCODE</a> <a href="/tags/Operators/" style="font-size: 10px;">Operators</a> <a href="/tags/Performance/" style="font-size: 14.29px;">Performance</a> <a href="/tags/RecyclerView/" style="font-size: 11.43px;">RecyclerView</a> <a href="/tags/RxJava/" style="font-size: 14.29px;">RxJava</a> <a href="/tags/THINK/" style="font-size: 10px;">THINK</a> <a href="/tags/TOOL/" style="font-size: 11.43px;">TOOL</a> <a href="/tags/TabLayout/" style="font-size: 10px;">TabLayout</a> <a href="/tags/Test/" style="font-size: 14.29px;">Test</a> <a href="/tags/TouchEvent/" style="font-size: 12.86px;">TouchEvent</a> <a href="/tags/VIEW/" style="font-size: 11.43px;">VIEW</a> <a href="/tags/anim/" style="font-size: 10px;">anim</a> <a href="/tags/compose/" style="font-size: 11.43px;">compose</a> <a href="/tags/concurrency/" style="font-size: 14.29px;">concurrency</a> <a href="/tags/coroutie/" style="font-size: 17.14px;">coroutie</a> <a href="/tags/inter/" style="font-size: 15.71px;">inter</a> <a href="/tags/keyboard/" style="font-size: 10px;">keyboard</a> <a href="/tags/proguard/" style="font-size: 10px;">proguard</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ANDROID/">ANDROID</a><span class="category-list-count">59</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/BLE/">BLE</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DataStructure/">DataStructure</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DesignPatterns/">DesignPatterns</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ENGLISH/">ENGLISH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jetpack/">Jetpack</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LINUX/">LINUX</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mathematics/">Mathematics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Organization/">Organization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SOURCE/">SOURCE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TEST/">TEST</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/">TOOL</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIEW/">VIEW</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/anim/">anim</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023年08月</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022年12月</a><span class="archive-list-count">33</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年12月</a><span class="archive-list-count">23</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年12月</a><span class="archive-list-count">45</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019年12月</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018年11月</a><span class="archive-list-count">32</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017年12月</a><span class="archive-list-count">57</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ANDROID/" rel="tag">ANDROID</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOSP/" rel="tag">AOSP</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/" rel="tag">Activity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AndroidNewFeatures/" rel="tag">AndroidNewFeatures</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Assembly/" rel="tag">Assembly</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BLOG/" rel="tag">BLOG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ConstraintLayout/" rel="tag">ConstraintLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drawer/" rel="tag">Drawer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fragment/" rel="tag">Fragment</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/" rel="tag">Git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEETCODE/" rel="tag">LEETCODE</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Operators/" rel="tag">Operators</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RecyclerView/" rel="tag">RecyclerView</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/" rel="tag">RxJava</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/THINK/" rel="tag">THINK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TOOL/" rel="tag">TOOL</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TabLayout/" rel="tag">TabLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Test/" rel="tag">Test</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TouchEvent/" rel="tag">TouchEvent</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VIEW/" rel="tag">VIEW</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anim/" rel="tag">anim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compose/" rel="tag">compose</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coroutie/" rel="tag">coroutie</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inter/" rel="tag">inter</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keyboard/" rel="tag">keyboard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proguard/" rel="tag">proguard</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example1.com/">site-name1</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example2.com/">site-name2</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example3.com/">site-name3</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">Site Map</a>
        <span> | </span><a href="/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2023 Jon.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        
            <span>Count by <a href="http://busuanzi.ibruce.info/" target="_blank">busuanzi.</a></span>
        
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
    
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



  
<script src="/localshare/js/social-share.js"></script>

  
<script src="/localshare/js/qrcode.js"></script>




















  </div>
</body>
</html>