<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Hexo</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hexo"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hexo"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Hexo"><meta property="og:url" content="http://example.com/"><meta property="og:site_name" content="Hexo"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://example.com/img/og_image.png"><meta property="article:author" content="John Doe"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://example.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://example.com"},"headline":"Hexo","image":["http://example.com/img/og_image.png"],"author":{"@type":"Person","name":"John Doe"},"publisher":{"@type":"Organization","name":"Hexo","logo":{"@type":"ImageObject","url":"http://example.com/img/logo.svg"}},"description":""}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-02-23T05:50:10.000Z" title="2/23/2022, 1:50:10 PM">2022-02-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-06-12T03:17:58.729Z" title="6/12/2022, 11:17:58 AM">2022-06-12</time></span><span class="level-item">13 minutes read (About 1896 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/02/23/battery/">battery</a></p><div class="content"><h3 id="性能与功耗"><a href="#性能与功耗" class="headerlink" title="性能与功耗"></a>性能与功耗</h3><p><a target="_blank" rel="noopener" href="https://github.com/JsonChao/Awesome-Android-Performance">https://github.com/JsonChao/Awesome-Android-Performance</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/performance">https://developer.android.google.cn/topic/performance</a></p>
<h4 id="battery-history"><a href="#battery-history" class="headerlink" title="battery history"></a>battery history</h4><p><a target="_blank" rel="noopener" href="https://developer.android.com/topic/performance/power/setup-battery-historian?hl=zh-cn">https://developer.android.com/topic/performance/power/setup-battery-historian?hl=zh-cn</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb shell dumpsys batterystats &gt; &#x2F;Users&#x2F;m&#x2F;Documents&#x2F;BATTELY&#x2F;batterystats.txt</span><br><span class="line"></span><br><span class="line">adb bugreport &#x2F;Users&#x2F;m&#x2F;Documents&#x2F;BATTELY&#x2F;bugreport.zip</span><br></pre></td></tr></table></figure>



<p>指标查看</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903779268034574">https://juejin.cn/post/6844903779268034574</a></p>
<h3 id="三种情况"><a href="#三种情况" class="headerlink" title="三种情况"></a>三种情况</h3><ul>
<li>省电模式</li>
<li>应用待机分组</li>
<li>后台限制</li>
</ul>
<p>这三种情况，开发者都需要对App进行测试，保证正常运行</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ut411d7U3/">https://www.bilibili.com/video/BV1Ut411d7U3/</a></p>
<img src="/2022/02/23/battery/Users/m/Documents/BLOG/source/_posts/battery/Screen Shot 2022-03-08 at 2.29.40 PM.png" alt="Screen Shot 2022-03-08 at 2.29.40 PM" style="zoom:50%;">



<h4 id="应用分组"><a href="#应用分组" class="headerlink" title="应用分组"></a>应用分组</h4><img src="/2022/02/23/battery/Users/m/Documents/BLOG/source/_posts/battery/Screen Shot 2022-03-08 at 2.16.10 PM.png" alt="Screen Shot 2022-03-08 at 2.16.10 PM" style="zoom:50%;">



<h4 id="开发者保证无论哪个分组-App都没问题"><a href="#开发者保证无论哪个分组-App都没问题" class="headerlink" title="开发者保证无论哪个分组 App都没问题"></a>开发者保证无论哪个分组 App都没问题</h4><ol>
<li>测试通知是否发送</li>
<li>Api接口： 获取运行时应用所在的分组</li>
</ol>
<img src="/2022/02/23/battery/Users/m/Documents/BLOG/source/_posts/battery/Screen Shot 2022-03-08 at 2.17.59 PM.png" alt="Screen Shot 2022-03-08 at 2.17.59 PM" style="zoom:50%;">

<h4 id="省电模式"><a href="#省电模式" class="headerlink" title="省电模式"></a>省电模式</h4><p>该模式App正常运行</p>
<p>![Screen Shot 2022-03-08 at 2.27.35 PM](/Users/m/Documents/BLOG/source/_posts/battery/Screen Shot 2022-03-08 at 2.27.35 PM.png)</p>
<h3 id="原则"><a href="#原则" class="headerlink" title="原则"></a>原则</h3><p>减少 :  减少后台运行</p>
<p>延迟  : 延迟到合适的时间，例如设备充上电</p>
<p>合并: 尽量合并后台操作</p>
<p>WorkManager : 后台操作的首选</p>
<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><h4 id="Android-Vitals"><a href="#Android-Vitals" class="headerlink" title="Android Vitals"></a>Android Vitals</h4><p>根据描述的不良行为来优化分组</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/performance/vitals">https://developer.android.google.cn/topic/performance/vitals</a></p>
<h4 id="Energy-profiler"><a href="#Energy-profiler" class="headerlink" title="Energy profiler"></a>Energy profiler</h4><img src="/2022/02/23/battery/Users/m/Documents/BLOG/source/_posts/battery/Screen Shot 2022-03-08 at 2.36.21 PM.png" alt="Screen Shot 2022-03-08 at 2.36.21 PM" style="zoom:50%;">









<h3 id="场景操作"><a href="#场景操作" class="headerlink" title="场景操作"></a>场景操作</h3><h4 id="监听手机充电状态"><a href="#监听手机充电状态" class="headerlink" title="监听手机充电状态"></a>监听手机充电状态</h4><p>这里我们就需要思考，根据具体的业务，考虑将一些不需要及时地和用户交互的操作放到充电 的时候去做。比如：360 手机助手，当充上电的时候，才会自动清理手机垃圾，自动备份上传图片、联系人 等到云端，从而避免当用户手机低电量时，任然继续进行耗电操作。</p>
<h4 id="屏幕唤醒-继续研究我们App细节"><a href="#屏幕唤醒-继续研究我们App细节" class="headerlink" title="屏幕唤醒 (继续研究我们App细节)"></a>屏幕唤醒 (继续研究我们App细节)</h4><p>当 Android 设备空闲时，屏幕会变暗，然后关闭屏幕，最后会停止 CPU 的运行，这样可以防 止电池电量掉的快。但有些时候我们需要改变 Android 系统默认的这种状态:比如玩游戏时我 们需要保持屏幕常亮，比如一些下载操作不需要屏幕常亮但需要 CPU 一直运行直到任务完成。</p>
<p>保持屏幕常亮比较好的方式是在 Activity 中使用 FLAG_KEEP_SCREEN_ON 的 Flag。</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/2/19/16904495558a8e3a~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="在这里插入图片描述"></p>
<p>这个方法的好处是不像唤醒锁(wake locks)，需要一些特定的权限(permission)。并且能 正确管理不同 app 之间的切换，不用担心无用资源的释放问题。</p>
<p>另一个方式是在布局文件中使用 android:keepScreenOn 属性:</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/2/19/16904495828e4789~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="在这里插入图片描述"></p>
<p>android:keepScreenOn = “true”的作用和 FLAG_KEEP_SCREEN_ON 一样，使用代码的好 处是你允许你在需要的地方关闭屏幕。</p>
<p>注意:一般不需要人为的去掉 FLAG_KEEP_SCREEN_ON 的 flag，windowManager 会管理好程序进入 后台回到前台的的操作。如果确实需要手动清掉常亮的 flag，使用</p>
<p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/2/19/169044957b65ed32~tplv-t2oaga2asx-zoom-in-crop-mark:1304:0:0:0.awebp" alt="在这里插入图片描述"></p>
<p>所以这里我们需要根据自己的 APP 实际情况，根据业务来控制好是否保持屏幕常量。比如 APP 需要支持视频播放。那么在播放的界面需要控制好不熄屏，当退出播放时，当然就没有了 这个设置。</p>
<h4 id="JobScheduler-现在应该用WorkManger"><a href="#JobScheduler-现在应该用WorkManger" class="headerlink" title="JobScheduler (现在应该用WorkManger)"></a>JobScheduler (现在应该用WorkManger)</h4><p>自 Android 5.0 发布以来，JobScheduler 已成为执行后台工作的很好的方式，其工作方式有 利于用户在适当的时机执行正确的事情。应用可以在安排作业的同时允许系统基于内存、电源 和连接情况进行优化。JobSchedule 的宗旨就是把一些不是特别紧急的任务放到更合适的时机 批量处理。这样做有两个好处:</p>
<ul>
<li>避免频繁的唤醒硬件模块，造成不必要的电量消耗。</li>
<li>避免在不合适的时间(例如低电量情况下、弱网络或者移动网络情况下的)执行过多的 任务消耗电量。</li>
</ul>
<h4 id="GPS"><a href="#GPS" class="headerlink" title="GPS"></a>GPS</h4><p>Android 系统支持多个 Location Provider:</p>
<ul>
<li><strong>GPS_PROVIDER:</strong> GPS 定位，利用 GPS 芯片通过卫星获得自己的位置信息。定位精准度高，一般在 10 米左右， 耗电量大;但是在室内，GPS 定位基本没用。</li>
<li><strong>NETWORK_PROVIDER:</strong> 网络定位，利用手机基站和 WIFI 节点的地址来大致定位位置，这种定位方式取决于服务器， 即取决于将基站或 WIF 节点信息翻译成位置信息的服务器的能力。</li>
<li><strong>PASSIVE_PROVIDER:</strong> 被动定位，就是用现成的，当其他应用使用定位更新了定位信息，系统会保存下来，该应用接 收到消息后直接读取就可以了。</li>
</ul>
<p>如果 App 只是需要一个粗略的定位那么就不需要使用 GPS 进行定位，既耗费电量，定位的耗 时也久。</p>
<p><strong>及时注销定位监听</strong> (怎么注销定位)</p>
<p>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903779268034574">https://juejin.cn/post/6844903779268034574</a></p>
<p>电量分析</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/performance/vitals">https://developer.android.google.cn/topic/performance/vitals</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=dx6LBaFqEHU&amp;t=3s">https://www.youtube.com/watch?v=dx6LBaFqEHU&amp;t=3s</a></p>
<p><a target="_blank" rel="noopener" href="https://tech.meituan.com/2018/03/11/dianping-shortvideo-battery-testcase.html">https://tech.meituan.com/2018/03/11/dianping-shortvideo-battery-testcase.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3dc2ea40ed5a">https://www.jianshu.com/p/3dc2ea40ed5a</a></p>
<p>docker – run -p 1234:9999 gcr.io/android-battery-historian/stable:3.0 –port 9999</p>
<h3 id="YouTuBe-Video"><a href="#YouTuBe-Video" class="headerlink" title="YouTuBe Video"></a>YouTuBe Video</h3><h4 id="Battery-Historian"><a href="#Battery-Historian" class="headerlink" title="Battery Historian"></a>Battery Historian</h4><p>Battery Historian Part 1: Basics and Installation Using Docker Tool-box</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6NQwtj0GZRo">https://www.youtube.com/watch?v=6NQwtj0GZRo</a></p>
<p>Battery Historian Part 2: Steps to Collect BatteryStat logs and Creating Report on Console</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=ZTzdrvYO8sM">https://www.youtube.com/watch?v=ZTzdrvYO8sM</a></p>
<p>Battery Historian Part 3: Report Analysis and Error Checks</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=d_VFXzBhuuc">https://www.youtube.com/watch?v=d_VFXzBhuuc</a></p>
<h4 id="Battery-Historian-Part"><a href="#Battery-Historian-Part" class="headerlink" title="Battery Historian Part"></a>Battery Historian Part</h4><p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=11aJfiqqBAk">https://www.youtube.com/watch?v=11aJfiqqBAk</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=PK2VBuMMkn8">https://www.youtube.com/watch?v=PK2VBuMMkn8</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6LuPsbwH3HE">https://www.youtube.com/watch?v=6LuPsbwH3HE</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=-v4NL5oqBq0">https://www.youtube.com/watch?v=-v4NL5oqBq0</a></p>
<h4 id="耗电优化建议（实用）"><a href="#耗电优化建议（实用）" class="headerlink" title="耗电优化建议（实用）"></a>耗电优化建议（实用）</h4><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7034751791866576904">https://juejin.cn/post/7034751791866576904</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/JsonChao/Awesome-Android-Notebook/blob/master/notes/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.md#APP%E7%94%B5%E9%87%8F%E4%BC%98%E5%8C%96">https://github.com/JsonChao/Awesome-Android-Notebook/blob/master/notes/Android%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.md#APP%E7%94%B5%E9%87%8F%E4%BC%98%E5%8C%96</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ut411d7U3/">https://www.bilibili.com/video/BV1Ut411d7U3/</a></p>
<h4 id="具体处理"><a href="#具体处理" class="headerlink" title="具体处理"></a>具体处理</h4><p>主要是优化后台：Alarm 一定时间内的启动次数，WakeLock 一定时间内的时间/次数，Sensor，Wifi Scans ，Bluetooth , GPS，Camera，NetWork，CPU ，退到后台监控次数和时间，定义一个阀值超过提醒输出</p>
<p>其次是监控优化前台：监控线程 Cpu 时间，Gpu 绘制，拿到所有线程的 cpu 耗时时间 ANR dump</p>
<p>微信：优化，异步加载（比较长）1 分钟，io 读取 ANR （子线程）极端情况下死循环</p>
<p>耗电量是怎么计算的？</p>
<p>如果 app 需要监控应该怎么监控？</p>
<p>怎么监控异常耗电并且输出方便排查的信息？</p>
<h3 id="监控工具"><a href="#监控工具" class="headerlink" title="监控工具"></a>监控工具</h3><h4 id="wechat-matrix"><a href="#wechat-matrix" class="headerlink" title="wechat matrix"></a>wechat <strong><a target="_blank" rel="noopener" href="https://github.com/Tencent/matrix">matrix</a></strong></h4><p><a target="_blank" rel="noopener" href="https://kaedea.com/2021/08/14/android-apm-battery-stats-opt/">https://kaedea.com/2021/08/14/android-apm-battery-stats-opt/</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/chuyouyinghe/article/details/117223373">https://blog.csdn.net/chuyouyinghe/article/details/117223373</a></p>
<p>分享做业务怎么脱颖而出？道理都是一样，最后进来的，项目基本完工了，不考核的三流业务，绩效业务。</p>
<p>尽最大的努力去支持他，1200条+，邮箱 WXG ，推荐了我，尽可能积极乐观主动。</p>
<p>熬，低调厚积薄发，做别人不愿意做的事情，摆正好心态</p>
<p><a target="_blank" rel="noopener" href="http://www.moyck.com/articles/2019/10/14/1571046711964.html">http://www.moyck.com/articles/2019/10/14/1571046711964.html</a></p>
<p><a target="_blank" rel="noopener" href="http://www.woshipm.com/it/855066.html">http://www.woshipm.com/it/855066.html</a></p>
<p><a target="_blank" rel="noopener" href="https://xiaojianchen.gitbook.io/performance-optimization/android-xing-neng-you-hua-zhi-dian-liang">https://xiaojianchen.gitbook.io/performance-optimization/android-xing-neng-you-hua-zhi-dian-liang</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904195523346439">https://juejin.cn/post/6844904195523346439</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1st411N7cC?p=5">https://www.bilibili.com/video/BV1st411N7cC?p=5</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-01-23T14:56:05.000Z" title="1/23/2022, 10:56:05 PM">2022-01-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2022-01-23T15:05:11.747Z" title="1/23/2022, 11:05:11 PM">2022-01-23</time></span><span class="level-item"><a class="link-muted" href="/categories/ANDROID/">ANDROID</a></span><span class="level-item">a few seconds read (About 0 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/01/23/DateTime/">DateTime</a></p><div class="content"></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-12-19T13:12:53.000Z" title="12/19/2021, 9:12:53 PM">2021-12-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-02-23T14:17:11.782Z" title="2/23/2023, 10:17:11 PM">2023-02-23</time></span><span class="level-item"><a class="link-muted" href="/categories/ANDROID/">ANDROID</a></span><span class="level-item">4 minutes read (About 608 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/19/RecyclerView-Divider/">RecyclerView_Divider</a></p><div class="content"><p>RecyclerView</p>
<h4 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h4><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6998712972856000543">https://juejin.cn/post/6998712972856000543</a></p>
<h4 id="ItemDecoration"><a href="#ItemDecoration" class="headerlink" title="ItemDecoration"></a>ItemDecoration</h4><h5 id="onDraw"><a href="#onDraw" class="headerlink" title="onDraw"></a>onDraw</h5><p>void onDraw(Canvas c, RecyclerView parent, State state)</p>
<p>参数的含义：</p>
<ul>
<li>Canvas c 》 canvas 绘制对象</li>
<li>RecyclerView 》 parent RecyclerView 对象本身</li>
<li>State state 》 当前 RecyclerView 的状态</li>
</ul>
<p>作用就是绘制，可以在任何位置绘制，如果只是想绘制到每一项里面，那么就需要计算出对应的位置。</p>
<p>void onDrawOver(Canvas c, RecyclerView parent, State state)</p>
<p>跟上面一样，不同的地方在于绘制的总是在最上面，也就是绘制出来的不会被遮挡。</p>
<h5 id="getItemOffsets"><a href="#getItemOffsets" class="headerlink" title="getItemOffsets"></a>getItemOffsets</h5><p>void getItemOffsets(Rect outRect, View view, RecyclerView parent, State state)</p>
<p>参数的含义：</p>
<ul>
<li>Rect outRect 》item 四周的距离对象</li>
<li>View view 》 当前 view</li>
<li>RecyclerView 》 parent RecyclerView 本身</li>
<li>State state 》 RecyclerView 状态</li>
</ul>
<p>这里可以设置 <code>item</code> 到 <code>RecyclerView</code> 各边的距离。这里需要说明一下，我这里说的到各边的距离指的是啥？</p>
<p><img src="/2021/12/19/RecyclerView-Divider/bcf2be90db23474cb14a963d6dde14f3~tplv-k3u1fbpfcp-watermark.image.png" alt="bcf2be90db23474cb14a963d6dde14f3~tplv-k3u1fbpfcp-watermark.image"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SimpleItemDecoration</span> : <span class="type">RecyclerView.ItemDecoration</span></span>() &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outRect   全为0的rect，用来指定偏移区域</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> view      指RecyclerView中的Item</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parent    指RecyclerView本身</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> state     状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">        <span class="keyword">if</span> (parent.getChildAdapterPosition(view) == <span class="number">0</span>) &#123;</span><br><span class="line">            outRect.top = <span class="number">10</span></span><br><span class="line">            outRect.left = <span class="number">30</span></span><br><span class="line">            outRect.right = <span class="number">60</span></span><br><span class="line">            outRect.bottom = <span class="number">90</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">biding.recyclerView.addItemDecoration(<span class="keyword">object</span> : RecyclerView.ItemDecoration() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDraw(c, parent, state)</span><br><span class="line">        paint.color = (Color.BLUE)</span><br><span class="line">        c.drawRect(<span class="number">0F</span>, <span class="number">0f</span>, <span class="number">400f</span>, <span class="number">200f</span>, paint)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDrawOver</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onDrawOver(c, parent, state)</span><br><span class="line">        paint.color = Color.RED</span><br><span class="line">        c.drawRect(<span class="number">0F</span>, <span class="number">0f</span>, <span class="number">200f</span>, <span class="number">100f</span>, paint)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.getItemOffsets(outRect, view, parent, state)</span><br><span class="line">        outRect.<span class="keyword">set</span>(<span class="number">20</span>, <span class="number">100</span>, <span class="number">0</span>, <span class="number">20</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/w855227/article/details/80973321">https://blog.csdn.net/w855227/article/details/80973321</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4eff036360da">https://www.jianshu.com/p/4eff036360da</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/b2ef4f8e859f">https://www.jianshu.com/p/b2ef4f8e859f</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/YoKeyword/IndexableRecyclerView">https://github.com/YoKeyword/IndexableRecyclerView</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5eae33a26fb9a043586c7f19">https://juejin.im/post/5eae33a26fb9a043586c7f19</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903855335931911">https://juejin.cn/post/6844903855335931911</a></p>
<h4 id="分割线高度和颜色"><a href="#分割线高度和颜色" class="headerlink" title="分割线高度和颜色"></a>分割线高度和颜色</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:shape</span>=<span class="string">&quot;rectangle&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">size</span> <span class="attr">android:height</span>=<span class="string">&quot;1dp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">solid</span> <span class="attr">android:color</span>=<span class="string">&quot;@color/color_FFE4E7EA&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>ItemDividerRfid.kt</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ItemDividerRfid</span></span>(<span class="keyword">var</span> context: Context, <span class="keyword">val</span> orientation: <span class="built_in">Int</span> = VERTICAL_LIST) :</span><br><span class="line">    RecyclerView.ItemDecoration() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> HORIZONTAL_LIST = LinearLayoutManager.HORIZONTAL</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">val</span> VERTICAL_LIST = LinearLayoutManager.VERTICAL</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mDivider: Drawable? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        mDivider = context.getDrawable(R.drawable.transportation_divider_item_color)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onDraw</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>, state: <span class="type">RecyclerView</span>.<span class="type">State</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (orientation == VERTICAL_LIST) &#123;</span><br><span class="line">            drawVertical(c, parent)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">drawVertical</span><span class="params">(c: <span class="type">Canvas</span>, parent: <span class="type">RecyclerView</span>)</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> left = parent.paddingLeft</span><br><span class="line">        <span class="keyword">val</span> right = parent.width - parent.paddingRight</span><br><span class="line">        <span class="keyword">val</span> childCount = parent.childCount</span><br><span class="line">        <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">0</span> until childCount) &#123;</span><br><span class="line">            <span class="keyword">val</span> child = parent.getChildAt(i)</span><br><span class="line">            <span class="keyword">val</span> params = child.layoutParams <span class="keyword">as</span> RecyclerView.LayoutParams</span><br><span class="line">            <span class="keyword">val</span> top = child.bottom + params.bottomMargin</span><br><span class="line">            <span class="keyword">val</span> bottom = top + (mDivider?.intrinsicHeight ?: <span class="number">0</span>)</span><br><span class="line">            mDivider?.setBounds(left +ITEM_DIVIDER_HEIGHT_16, top, right-ITEM_DIVIDER_HEIGHT_16, bottom)</span><br><span class="line">            mDivider?.draw(c)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemOffsets</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        outRect: <span class="type">Rect</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        view: <span class="type">View</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        parent: <span class="type">RecyclerView</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        state: <span class="type">RecyclerView</span>.<span class="type">State</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (orientation == VERTICAL_LIST) &#123;</span><br><span class="line">            outRect.<span class="keyword">set</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, mDivider?.intrinsicHeight ?: <span class="number">0</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/zhaoyanjun/3814502#3_453">https://blog.51cto.com/zhaoyanjun/3814502#3_453</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-12-14T00:05:39.000Z" title="12/14/2021, 8:05:39 AM">2021-12-14</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-01-02T03:31:39.122Z" title="1/2/2023, 11:31:39 AM">2023-01-02</time></span><span class="level-item"><a class="link-muted" href="/categories/Kotlin/">Kotlin</a></span><span class="level-item">6 minutes read (About 876 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/12/14/coroutie-start2/">coroutie-start2</a></p><div class="content"><p>runblocking会等待子协程执行完成.</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1uo4y1y7ZF?p=24&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1uo4y1y7ZF?p=24&amp;spm_id_from=pageDriver</a></p>
<h5 id="P20-launch-async"><a href="#P20-launch-async" class="headerlink" title="P20 launch async"></a>P20 launch async</h5><p>Laugh 返回一个Job</p>
<p>Async , 返回Deffrred.</p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-13_1.04.30.png" alt="2021-12-13_1.04.30"></p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-13_1.12.31.png"></p>
<p>Async  返回执行结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Job1 finished.</span><br><span class="line"></span><br><span class="line">Job2 finished</span><br><span class="line"></span><br><span class="line">Job2 finished</span><br></pre></td></tr></table></figure>





<h5 id="P21-join与await等待协程的作业"><a href="#P21-join与await等待协程的作业" class="headerlink" title="P21 join与await等待协程的作业"></a>P21 join与await等待协程的作业</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test coroutine join`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = launch() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;One&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    job1.join() <span class="comment">// job1执行完，再执行job2 job3</span></span><br><span class="line">    <span class="keyword">val</span> job2 = launch() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Two&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job3 = launch() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Three&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test coroutine await`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="comment">// 刷新界面，拿到执行结果后，再执行其他的。</span></span><br><span class="line">    <span class="keyword">val</span> job1 = async() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;One&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    job1.await() <span class="comment">// job1执行完，再执行job2 job3</span></span><br><span class="line">    <span class="keyword">val</span> job2 = async() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Two&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job3 = async() &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Three&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>区别是await可以拿到执行结果，</p>
<p>接口1请求成功，拿到接口，再请求其他接口。</p>
<p>launch启动用 join()</p>
<p>async启动用 await()</p>
<h5 id="P22-async组合并发"><a href="#P22-async组合并发" class="headerlink" title="P22 async组合并发"></a>P22 async组合并发</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test sync`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = doOne()  <span class="comment">// 同步，串行任务</span></span><br><span class="line">        <span class="keyword">val</span> two = doTwo()</span><br><span class="line">        println(<span class="string">&quot;The result : <span class="subst">$&#123;one + two&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;completed in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test combine async`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    <span class="keyword">val</span> time = measureTimeMillis &#123;</span><br><span class="line">        <span class="keyword">val</span> one = async&#123;doOne()&#125; <span class="comment">// 并发的两个异步任务</span></span><br><span class="line">        <span class="keyword">val</span> two = async&#123;doTwo()&#125;</span><br><span class="line">        println(<span class="string">&quot;The result : <span class="subst">$&#123;one.await() + two.await()&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    println(<span class="string">&quot;completed in <span class="variable">$time</span> ms&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doOne</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">14</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">doTwo</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    delay(<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">25</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>执行的结果相加</p>
<h5 id="协程的启动模式"><a href="#协程的启动模式" class="headerlink" title="协程的启动模式"></a>协程的启动模式</h5><p><img src="/2021/12/14/coroutie-start2/2021-12-14_9.17.33.png" alt="coroutie-start2"></p>
<p>CoroutineStart.DEFAULT</p>
<h5 id="p24-协程的作用域构建器"><a href="#p24-协程的作用域构建器" class="headerlink" title="p24 协程的作用域构建器"></a>p24 协程的作用域构建器</h5><p>runBlocking阻塞当前线程等待</p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-14_9.49.35.png" alt="coroutie-start2"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job1 finished.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job2 = async &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job2 finished.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>coroutineScope 也需要等待子协程执行结束，和 runBlocking很像.</p>
<p>区别coroutineScope是挂起函数.</p>
<p>coroutineScope与supervisorScope</p>
<p>还有SupervisorJob</p>
<p><img src="/2021/12/14/coroutie-start2/2021-12-14_10.22.41.png" alt="coroutie-start2"></p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">coroutineScope &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = launch &#123;</span><br><span class="line">        delay(<span class="number">400</span>)</span><br><span class="line">        println(<span class="string">&quot;Job1 finished.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">val</span> job2 = async &#123;</span><br><span class="line">        delay(<span class="number">200</span>)</span><br><span class="line">        println(<span class="string">&quot;Job2 finished.&quot;</span>)</span><br><span class="line">        <span class="string">&quot;job2 result&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Job2 finished.<br>Job1 finished.</p>
<p>job2中断 job1也中断</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test coroutineScope scope builder`<span class="params">()</span></span> = runBlocking &#123;</span><br><span class="line">    coroutineScope &#123;</span><br><span class="line">        <span class="keyword">val</span> job1 = launch &#123;</span><br><span class="line">            delay(<span class="number">400</span>)</span><br><span class="line">            println(<span class="string">&quot;job1 finished.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">val</span> job2 = launch &#123;</span><br><span class="line">            delay(<span class="number">200</span>)</span><br><span class="line">            println(<span class="string">&quot;job2 finished.&quot;</span>)</span><br><span class="line">            <span class="string">&quot;job2 result&quot;</span></span><br><span class="line">            <span class="keyword">throw</span>  IllegalArgumentException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>job2 finished.</p>
<p>java.lang.IllegalArgumentException</p>
<p>两个协程都退出</p>
<p>job2中断 job1继续</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">fun &#96;test supervisorScope scope builder&#96;() &#x3D; runBlocking &#123;</span><br><span class="line">    supervisorScope &#123;</span><br><span class="line">        val job1 &#x3D; launch &#123;</span><br><span class="line">            delay(400)</span><br><span class="line">            println(&quot;job1 finished.&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">        val job2 &#x3D; launch &#123;</span><br><span class="line">            delay(200)</span><br><span class="line">            println(&quot;job2 finished.&quot;)</span><br><span class="line">            &quot;job2 result&quot;</span><br><span class="line">            throw  IllegalArgumentException()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>job2 finished.<br>Exception in thread “Test worker @coroutine#3”</p>
<p>Job1 finished.</p>
<h5 id="25-Job的生命周期"><a href="#25-Job的生命周期" class="headerlink" title="25 Job的生命周期"></a>25 Job的生命周期</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_10.46.51.png" alt="2022-03-20_10.46.51" style="zoom:67%;">



<img src="/2021/12/14/coroutie-start2/2022-03-20_10.47.57.png" alt="2022-03-20_10.47.57" style="zoom:67%;">





<h3 id="协程的取消"><a href="#协程的取消" class="headerlink" title="协程的取消"></a>协程的取消</h3><img src="/2021/12/14/coroutie-start2/2022-03-20_10.58.25.png" alt="2022-03-20_10.58.25" style="zoom:67%;">





<h5 id="26-取消作用域"><a href="#26-取消作用域" class="headerlink" title="26-取消作用域"></a>26-取消作用域</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> `test scope cancel`<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">        scope.launch &#123;</span><br><span class="line">            delay(<span class="number">1000</span>)</span><br><span class="line">            println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        scope.launch &#123;</span><br><span class="line">            delay(<span class="number">1000</span>)</span><br><span class="line">            println(<span class="string">&quot;Job 2.&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        delay(2000)  //需要加这个才能看到 打印,CoroutineScope没有继承runBlocking的上下文</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>







<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test scope cancel`<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">    scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 2.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)  <span class="comment">//需要加这个才能看到 打印</span></span><br><span class="line">    scope.cancel()</span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>CorountineScope和corountineScope的区别(大小写的区别，大写的可以取消)</p>
<img src="/2021/12/14/coroutie-start2/2022-03-20_11.14.10.png" alt="2022-03-20_11.14.10" style="zoom:67%;">



<h5 id="P27-取消兄弟协程"><a href="#P27-取消兄弟协程" class="headerlink" title="P27-取消兄弟协程"></a>P27-取消兄弟协程</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test scope cancel`<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> scope = CoroutineScope(Dispatchers.Default)</span><br><span class="line">    <span class="keyword">val</span> job1 = scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> job2=scope.launch &#123;</span><br><span class="line">        delay(<span class="number">1000</span>)</span><br><span class="line">        println(<span class="string">&quot;Job 2.&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)  <span class="comment">//需要加这个才能看到 打印</span></span><br><span class="line">    job1.cancel()</span><br><span class="line">    delay(<span class="number">2000</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>被取消的协程，不会影响其余的兄弟协程</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Job 2.</span><br></pre></td></tr></table></figure>





<h5 id="28-协程取消的异常"><a href="#28-协程取消的异常" class="headerlink" title="28-协程取消的异常"></a>28-协程取消的异常</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> `test CancellationException `<span class="params">()</span></span> = runBlocking&lt;<span class="built_in">Unit</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> job1 = GlobalScope.launch &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            delay(<span class="number">1000</span>)</span><br><span class="line">            println(<span class="string">&quot;Job 1.&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">catch</span> (e:Exception)&#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    delay(<span class="number">100</span>)</span><br><span class="line">    job1.cancel(CancellationException(<span class="string">&quot;取消&quot;</span>))</span><br><span class="line">    job1.join() <span class="comment">// 否则不会打印GlobalScope不在runBlocking上下文</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>java.util.concurrent.CancellationException: 取消</p>
<h3 id="cpu密集型任务取消"><a href="#cpu密集型任务取消" class="headerlink" title="cpu密集型任务取消"></a>cpu密集型任务取消</h3><h5 id="29cpu密集型任务取消-isActive"><a href="#29cpu密集型任务取消-isActive" class="headerlink" title="29cpu密集型任务取消 isActive"></a>29cpu密集型任务取消 isActive</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_11.31.18.png" alt="2022-03-20_11.31.18" style="zoom:67%;">

<p>isActive判断取消，否则还是计算5次,这个和线程while操作很像</p>
<h5 id="p30-cpu密集型任务取消-ensureActive"><a href="#p30-cpu密集型任务取消-ensureActive" class="headerlink" title="p30- cpu密集型任务取消 - ensureActive"></a>p30- cpu密集型任务取消 - ensureActive</h5><p> 退出循环</p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.17.26.png" alt="2022-03-20_12.17.26"></p>
<h5 id="p31-yiled取消"><a href="#p31-yiled取消" class="headerlink" title="p31-yiled取消"></a>p31-yiled取消</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_12.18.27.png" alt="2022-03-20_12.18.27" style="zoom:67%;">

<img src="/2021/12/14/coroutie-start2/2022-03-20_12.19.29.png" alt="2022-03-20_12.19.29" style="zoom:50%;">





<h5 id="p32-coroutine取消副作用"><a href="#p32-coroutine取消副作用" class="headerlink" title="p32-coroutine取消副作用"></a>p32-coroutine取消副作用</h5><img src="/2021/12/14/coroutie-start2/2022-03-20_12.26.32.png" alt="2022-03-20_12.26.32" style="zoom:67%;">

<img src="/2021/12/14/coroutie-start2/2022-03-20_12.27.16.png" alt="2022-03-20_12.27.16" style="zoom:67%;">

<h5 id="p33-标准函数use"><a href="#p33-标准函数use" class="headerlink" title="p33 标准函数use"></a>p33 标准函数use</h5><p>自动关闭文件对象</p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.29.38.png" alt="2022-03-20_12.29.38"></p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.30.36.png" alt="2022-03-20_12.30.36"></p>
<h5 id="34不能取消的任务"><a href="#34不能取消的任务" class="headerlink" title="34不能取消的任务"></a>34不能取消的任务</h5><p>NonCancellable </p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.32.18.png" alt="2022-03-20_12.32.18"></p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.34.23.png" alt="2022-03-20_12.34.23"></p>
<h5 id="35超时任务"><a href="#35超时任务" class="headerlink" title="35超时任务"></a>35超时任务</h5><p>网络请求超时</p>
<p><img src="/2021/12/14/coroutie-start2/2022-03-20_12.38.56.png" alt="2022-03-20_12.38.56"></p>
<p>超时1300后的处理</p>
<p><img src="https://static001.geekbang.org/infoq/77/777b03f91e0335db9f67506ed186e143.png" alt="图片"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-23T14:15:14.000Z" title="11/23/2021, 10:15:14 PM">2021-11-23</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-12-05T12:11:41.185Z" title="12/5/2021, 8:11:41 PM">2021-12-05</time></span><span class="level-item"><a class="link-muted" href="/categories/ANDROID/">ANDROID</a></span><span class="level-item">a few seconds read (About 50 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/23/Font/">Font</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000011299402">https://segmentfault.com/a/1190000011299402</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4f9db19d9383">https://www.jianshu.com/p/4f9db19d9383</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/WaterYuanData/Camera2New/tree/SwitchLanguage/testlanguage">https://github.com/WaterYuanData/Camera2New/tree/SwitchLanguage/testlanguage</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7a81e5ef268d">https://www.jianshu.com/p/7a81e5ef268d</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jdfkldjlkjdl/article/details/106279151">https://blog.csdn.net/jdfkldjlkjdl/article/details/106279151</a></p>
<p><a target="_blank" rel="noopener" href="https://proandroiddev.com/change-language-programmatically-at-runtime-on-android-5e6bc15c758">https://proandroiddev.com/change-language-programmatically-at-runtime-on-android-5e6bc15c758</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-08T13:18:20.000Z" title="11/8/2021, 9:18:20 PM">2021-11-08</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-01-02T03:31:39.184Z" title="1/2/2023, 11:31:39 AM">2023-01-02</time></span><span class="level-item">a few seconds read (About 92 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/08/coroutine-begin1/">coroutine_begin1</a></p><div class="content"><h5 id="协程是什么-03"><a href="#协程是什么-03" class="headerlink" title="协程是什么 03"></a>协程是什么 03</h5><img src="/2021/11/08/coroutine-begin1/2021-11-08_9_15_13.png" style="zoom:67%;">





<h5 id="协程的挂起与恢复-08"><a href="#协程的挂起与恢复-08" class="headerlink" title="协程的挂起与恢复 08"></a>协程的挂起与恢复 08</h5><img src="/2021/11/08/coroutine-begin1/2021-11-08_9.20.36.png" style="zoom:67%;">

<img src="/2021/11/08/coroutine-begin1/2021-11-08_9.34.44.png" style="zoom:67%;">



<h5 id="挂起阻塞的区别-09"><a href="#挂起阻塞的区别-09" class="headerlink" title="挂起阻塞的区别 09"></a>挂起阻塞的区别 09</h5><img src="/2021/11/08/coroutine-begin1/2021-12-13_9.23.31_.png" style="zoom:67%;">

<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_9.53.43_.png" alt="2021-12-13_9.41.35_"></p>
<h5 id="协程的调度器-P13"><a href="#协程的调度器-P13" class="headerlink" title="协程的调度器 P13"></a>协程的调度器 P13</h5><ol>
<li><p>Dispatchers.Main</p>
</li>
<li><p>Dispatchers.IO</p>
</li>
<li><p>Dispatchers.Default</p>
</li>
</ol>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_9.57.42_.png"></p>
<h5 id="任务泄漏-P14"><a href="#任务泄漏-P14" class="headerlink" title="任务泄漏 P14"></a>任务泄漏 P14</h5><p><img src="/2021/11/08/coroutine-begin1/20220727203824.jpg" alt="20220727203824"></p>
<h5 id="结构化并发-p15"><a href="#结构化并发-p15" class="headerlink" title="结构化并发 p15"></a>结构化并发 p15</h5><p>使用结构化并发可以做到</p>
<p><img src="/2021/11/08/coroutine-begin1/20220727204523.jpg"></p>
<h5 id="CoutineScope-P16"><a href="#CoutineScope-P16" class="headerlink" title="CoutineScope P16"></a>CoutineScope P16</h5><p>GlobalScope</p>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_10.09.47_.png"></p>
<p>mainscope协程 可以通过抛出异常取消.</p>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_10.09.47_.png"></p>
<p><img src="/2021/11/08/coroutine-begin1/2021-12-13_10.18.50_.png" alt="2021-12-13_10.18.50_"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-11-06T08:06:32.000Z" title="11/6/2021, 4:06:32 PM">2021-11-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-07T08:19:37.360Z" title="11/7/2021, 4:19:37 PM">2021-11-07</time></span><span class="level-item"><a class="link-muted" href="/categories/ANDROID/">ANDROID</a></span><span class="level-item">3 minutes read (About 493 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/11/06/Language/">Language</a></p><div class="content"><h5 id="方式"><a href="#方式" class="headerlink" title="方式"></a>方式</h5><p>Android &lt; 7.0一下和以上不同, </p>
<ol>
<li>7.0以下只要设置一次语言就可以</li>
<li>7.0或以上，必须在BaseActivity设置</li>
</ol>
<h5 id="BaseActivity处理所有的"><a href="#BaseActivity处理所有的" class="headerlink" title="BaseActivity处理所有的"></a>BaseActivity处理所有的</h5><p>省事的做法，调用attachBaseContext,一起设置</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">object</span> LanguageUtil &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">attachBaseContext</span><span class="params">(context: <span class="type">Context</span>, language: <span class="type">String</span>?)</span></span>: Context? &#123;</span><br><span class="line">        <span class="keyword">val</span> resources = context.resources</span><br><span class="line">        <span class="keyword">val</span> configuration = resources.configuration</span><br><span class="line">        <span class="keyword">val</span> locale = getLocaleByLanguage(language!!)</span><br><span class="line">        configuration.setLocale(locale)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            configuration.setLocales(LocaleList(locale))</span><br><span class="line">            context.createConfigurationContext(configuration)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">            <span class="comment">// updateConfiguration</span></span><br><span class="line">            <span class="keyword">val</span> dm = resources.displayMetrics</span><br><span class="line">            resources.updateConfiguration(configuration, dm)</span><br><span class="line">            context</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getLocaleByLanguage</span><span class="params">(language: <span class="type">String</span>)</span></span>: Locale &#123;</span><br><span class="line">        <span class="keyword">var</span> locale: Locale</span><br><span class="line">        <span class="keyword">if</span> (language == TNGLanguageEnumType.CN.language) &#123;</span><br><span class="line">            locale = Locale.SIMPLIFIED_CHINESE</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language == TNGLanguageEnumType.MY.language) &#123;</span><br><span class="line">            locale = Locale.forLanguageTag(<span class="string">&quot;ms&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            locale = Locale.ENGLISH</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@TargetApi(Build.VERSION_CODES.N)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">updateResources</span><span class="params">(context: <span class="type">Context</span>, language: <span class="type">String</span>)</span></span>: Context &#123;</span><br><span class="line">        <span class="keyword">val</span> resources = context.resources</span><br><span class="line">        <span class="keyword">val</span> locale = getLocaleByLanguage(language)</span><br><span class="line">        <span class="keyword">val</span> configuration = resources.configuration</span><br><span class="line">        configuration.setLocale(locale)</span><br><span class="line">        configuration.setLocales(LocaleList(locale))</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(configuration)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@JvmStatic</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">setFontScaleLimit</span><span class="params">(context: <span class="type">Context</span>)</span></span>: Context? &#123;</span><br><span class="line">        <span class="keyword">val</span> config = Configuration(context.resources.configuration)</span><br><span class="line">        <span class="keyword">if</span> (config.fontScale &gt; <span class="number">1.2f</span> || config.fontScale &lt; <span class="number">1.0f</span>) &#123;</span><br><span class="line">            config.setToDefaults()</span><br><span class="line">            config.fontScale = <span class="number">1.1f</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(config)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="小于7-0设置一次"><a href="#小于7-0设置一次" class="headerlink" title="小于7.0设置一次"></a>小于7.0设置一次</h5><p>changeAppLanguage() 调这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LanguageUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">&quot;LanguageUtil&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> newLanguage 想要切换的语言类型 比如 &quot;en&quot; ,&quot;zh&quot;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;deprecation&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">changeAppLanguage</span><span class="params">(Context context, String newLanguage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (TextUtils.isEmpty(newLanguage)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">        Locale locale = getLocaleByLanguage(newLanguage);</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        <span class="comment">// updateConfiguration</span></span><br><span class="line">        DisplayMetrics dm = resources.getDisplayMetrics();</span><br><span class="line">        resources.updateConfiguration(configuration, dm);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Locale <span class="title">getLocaleByLanguage</span><span class="params">(String language)</span> </span>&#123;</span><br><span class="line">        Locale locale = Locale.ENGLISH;</span><br><span class="line">        <span class="keyword">if</span> (language.equals(LanguageType.CHINESE.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.SIMPLIFIED_CHINESE;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language.equals(LanguageType.ENGLISH.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.ENGLISH;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (language.equals(LanguageType.MY.getLanguage())) &#123;</span><br><span class="line">            locale = Locale.forLanguageTag(language);</span><br><span class="line">        &#125;</span><br><span class="line">        Log.d(TAG, <span class="string">&quot;getLocaleByLanguage: &quot;</span> + locale.getDisplayCountry());</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">attachBaseContext</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            <span class="keyword">return</span> updateResources(context, language);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> context;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequiresApi(api = VERSION_CODES.N)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Context <span class="title">updateResources</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Locale locale = LanguageUtil.getLocaleByLanguage(language);</span><br><span class="line"></span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        configuration.setLocales(<span class="keyword">new</span> LocaleList(locale));</span><br><span class="line">        <span class="keyword">return</span> context.createConfigurationContext(configuration);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Context <span class="title">updateBaseContext</span><span class="params">(Context context, String language)</span> </span>&#123;</span><br><span class="line">        Resources resources = context.getResources();</span><br><span class="line">        Configuration configuration = resources.getConfiguration();</span><br><span class="line">        Locale locale = LanguageUtil.getLocaleByLanguage(language);</span><br><span class="line">        configuration.setLocale(locale);</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) &#123;</span><br><span class="line">            configuration.setLocales(<span class="keyword">new</span> LocaleList(locale));</span><br><span class="line">            <span class="keyword">return</span> context.createConfigurationContext(configuration);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//获取想要切换的语言类型</span></span><br><span class="line">            <span class="comment">// updateConfiguration</span></span><br><span class="line">            DisplayMetrics dm = resources.getDisplayMetrics();</span><br><span class="line">            resources.updateConfiguration(configuration, dm);</span><br><span class="line">            <span class="keyword">return</span> context;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p> <a target="_blank" rel="noopener" href="https://github.com/wisnukurniawan/changelanguage.git">https://github.com/wisnukurniawan/changelanguage.git</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4f9db19d9383">https://www.jianshu.com/p/4f9db19d9383</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-10-31T09:01:21.000Z" title="10/31/2021, 5:01:21 PM">2021-10-31</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-10-23T00:42:30.546Z" title="10/23/2023, 8:42:30 AM">2023-10-23</time></span><span class="level-item"><a class="link-muted" href="/categories/DataStructure/">DataStructure</a></span><span class="level-item">6 minutes read (About 853 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/10/31/LC_binary_search_1/">LC_binary_search_1</a></p><div class="content"><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h3 id="704-Binary-Search"><a href="#704-Binary-Search" class="headerlink" title="704. Binary Search"></a><a target="_blank" rel="noopener" href="https://leetcode.com/problems/binary-search/">704. Binary Search</a></h3><p>First, solve the problem, and then review the one below.</p>
<p>BinarySearch</p>
<p>已经有序</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=6ysjqCUv3K4">https://www.youtube.com/watch?v=6ysjqCUv3K4</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=KXJSjte_OAI">https://www.youtube.com/watch?v=KXJSjte_OAI</a></p>
<p>考虑到边界情况，注意是 mid 是val mid = left + (right - left) / 2 , 而不是 val mid = right - (right - left) / 2 </p>
<h5 id="first-idea"><a href="#first-idea" class="headerlink" title="first idea"></a>first idea</h5><table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody><tr>
<td>-1</td>
<td>0</td>
<td>3</td>
<td>5</td>
<td>9</td>
<td>12</td>
</tr>
<tr>
<td>left</td>
<td></td>
<td>mid</td>
<td></td>
<td></td>
<td>right</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>In my opinion, when the target is not equal to the midpoint, it’s better to understand left and right as open intervals.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fun search(nums: IntArray, target: Int): Int &#123;</span><br><span class="line">    var left = 0</span><br><span class="line">    var right = nums.size -1</span><br><span class="line">    while (left &lt;= right) &#123;</span><br><span class="line">        val mid = left + (right - left) / 2 // consider left right border</span><br><span class="line">        if (target == nums[mid]) &#123;</span><br><span class="line">            return mid</span><br><span class="line">        &#125; else if (target &gt; mid) &#123;</span><br><span class="line">            left = mid + 1</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            right = mid - 1</span><br><span class="line">        &#125;</span><br><span class="line">        println(&quot;mid $mid  left $left  right $right&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">    return -1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>I was thinking about the above answer, but if left = 0 and right = 1, if (1 == target), you will never get the right answer because (left + right) / 2 equals 0,</p>
<p>so right cannot use nums.size -1.</p>
<h3 id="边界"><a href="#边界" class="headerlink" title="边界"></a>边界</h3><p>leetcode收藏了</p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-xiang-jie-by-labuladong/">https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-xiang-jie-by-labuladong/</a></p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-de-xun-huan-bu-bian-liang-zhi-yao-/">https://leetcode-cn.com/problems/binary-search/solution/er-fen-cha-zhao-de-xun-huan-bu-bian-liang-zhi-yao-/</a></p>
<p><a target="_blank" rel="noopener" href="https://programmercarl.com/0704.%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html#%E6%80%9D%E8%B7%AF">https://programmercarl.com/0704.%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE.html#%E6%80%9D%E8%B7%AF</a></p>
<h5 id="防止溢出"><a href="#防止溢出" class="headerlink" title="防止溢出"></a>防止溢出</h5><p>计算 mid 时需要防止溢出，代码中 left + (right - left) / 2 就和 (left + right) / 2 的结果相同，但是有效防止了 left 和 right 太大直接相加导致溢出。</p>
<h4 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h4><p>1    2    3    4    7    9    10     find     2</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">9</td>
<td align="center">10</td>
</tr>
<tr>
<td align="center">Left</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Right</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center">Right</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<p>[0,6]</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//解法1 [0,nums.length-1]</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">binarySearch1</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">middle</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (target == nums[middle]) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[middle]) &#123;</span><br><span class="line">            right = middle - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h4><p>[0,7)</p>
<table>
<thead>
<tr>
<th align="center">0</th>
<th align="center">1</th>
<th align="center">2</th>
<th align="center">3</th>
<th align="center">4</th>
<th align="center">5</th>
<th align="center">6</th>
<th>7</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">3</td>
<td align="center">4</td>
<td align="center">7</td>
<td align="center">9</td>
<td align="center">10</td>
<td></td>
</tr>
<tr>
<td align="center">Left</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td>Right</td>
</tr>
<tr>
<td align="center"></td>
<td align="center">Middle</td>
<td align="center"></td>
<td align="center">Right</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解法2 [0,nums.length)</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">binarySearch2</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">middle</span> <span class="operator">=</span> (left + right) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (target == nums[middle]) &#123;</span><br><span class="line">            <span class="keyword">return</span> middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; nums[middle]) &#123;</span><br><span class="line">            right = middle;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            left = middle + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>感觉还是解法1 不会容易出错。</p>
<h4 id="34-在排序数组中查找元素的第一个和最后一个位置-opens-new-window"><a href="#34-在排序数组中查找元素的第一个和最后一个位置-opens-new-window" class="headerlink" title="34.在排序数组中查找元素的第一个和最后一个位置(opens new window)"></a><a target="_blank" rel="noopener" href="https://programmercarl.com/0034.%E5%9C%A8%E6%8E%92%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0%E7%9A%84%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%92%8C%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E4%BD%8D%E7%BD%AE.html">34.在排序数组中查找元素的第一个和最后一个位置(opens new window)</a></h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/solution/zai-pai-xu-shu-zu-zhong-cha-zhao-yuan-su-de-di-3-4/">https://leetcode-cn.com/problems/find-first-and-last-position-of-element-in-sorted-array/solution/zai-pai-xu-shu-zu-zhong-cha-zhao-yuan-su-de-di-3-4/</a></p>
<p>有符号 无符号的区别</p>
<ul>
<li>对于<strong>有</strong>符号整数，每一次右移操作，高位补充的是<strong>1</strong>；</li>
<li>对于<strong>无</strong>符号整数，每一次右移操作，高位补充的则是<strong>0</strong>；</li>
</ul>
<p>0x80000000</p>
<p>0xc0000000</p>
<p>0x40000000</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903969915944973">https://juejin.cn/post/6844903969915944973</a></p>
<h4 id="35-搜索插入位置"><a href="#35-搜索插入位置" class="headerlink" title="35. 搜索插入位置"></a><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-insert-position/">35. 搜索插入位置</a></h4><p>(right - left) / 2   如果用  ((right - left) shr  2) 那么(right - left)要括起来，否则会符号优先级有问题.</p>
<p>这题没想到是插入left位置，最后一步right是可以移到   left位置或超过left,</p>
<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/search-insert-position/solution/sou-suo-cha-ru-wei-zhi-by-leetcode-solution/">https://leetcode-cn.com/problems/search-insert-position/solution/sou-suo-cha-ru-wei-zhi-by-leetcode-solution/</a></p>
<h4 id="69-x-的平方根"><a href="#69-x-的平方根" class="headerlink" title="69.x 的平方根"></a><del>69.x 的平方根</del></h4><p>​    这题我的解法是这样的，但是还有问题 没通过</p>
<ol>
<li>mid * mid.toLong() ,为什么</li>
<li>right - left + 1 即使退出循环</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    fun mySqrt(x: Int): Int &#123;</span><br><span class="line">        var left = 0</span><br><span class="line">        var right = x</span><br><span class="line">        while (left &lt; right) &#123;</span><br><span class="line">            val mid = left + (right - left + 1) / 2</span><br><span class="line">            // 调试语句开始</span><br><span class="line">//            try &#123;</span><br><span class="line">//                Thread.sleep(1000);</span><br><span class="line">//            &#125; catch (e: InterruptedException) &#123;</span><br><span class="line">//                e.printStackTrace()</span><br><span class="line">//            &#125;</span><br><span class="line">//            println(&quot;left = $left, right = $right, mid = $mid&quot;)</span><br><span class="line"></span><br><span class="line">//            链接：https://leetcode-cn.com/problems/sqrtx/solution/er-fen-cha-zhao-niu-dun-fa-python-dai-ma-by-liweiw/</span><br><span class="line">            if (mid * mid == x) &#123;</span><br><span class="line">                return mid</span><br><span class="line">            &#125; else if (mid * mid.toLong() &lt; x) &#123;</span><br><span class="line">                left = mid</span><br><span class="line">            &#125; else if (mid * mid.toLong() &gt; x) &#123;</span><br><span class="line">                right = mid - 1</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return left;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sqrtx/solution/er-fen-cha-zhao-niu-dun-fa-python-dai-ma-by-liweiw/">https://leetcode-cn.com/problems/sqrtx/solution/er-fen-cha-zhao-niu-dun-fa-python-dai-ma-by-liweiw/</a></p>
<p>有为什么产生死循环的讲解</p>
<p>367.有效的完全平方数</p>
<ol>
<li>解答<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LC367</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">isPerfectSquare</span><span class="params">(num: <span class="type">Int</span>)</span></span>: <span class="built_in">Boolean</span> &#123;</span><br><span class="line">        <span class="keyword">var</span> left = <span class="number">1</span></span><br><span class="line">        <span class="keyword">var</span> right = num</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">var</span> mid = left + (right - left) / <span class="number">2</span></span><br><span class="line">            <span class="keyword">if</span> (mid * mid == num) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mid * mid &gt; num) &#123;</span><br><span class="line">                right = mid - <span class="number">1</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mid * mid &lt; num) &#123;</span><br><span class="line">                left = mid + <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        测试用例超出限制 2147483647. , 因为mid *mid 超出int</p>
<p>​    </p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-09-11T10:04:06.000Z" title="9/11/2021, 6:04:06 PM">2021-09-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2021-11-30T01:40:14.920Z" title="11/30/2021, 9:40:14 AM">2021-11-30</time></span><span class="level-item"><a class="link-muted" href="/categories/Kotlin/">Kotlin</a></span><span class="level-item">18 minutes read (About 2682 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/09/11/kotlin-senior2/">kotlin-senior2</a></p><div class="content"><h3 id="Lambda表达式"><a href="#Lambda表达式" class="headerlink" title="Lambda表达式"></a>Lambda表达式</h3><p><strong>Lambda表达式、匿名函数、双冒号+函数名这三个东西，都是函数类型的对象，他们都能够赋值给变量以及当作函数的参数传递！</strong></p>
<h5 id="Lambda表达式的格式"><a href="#Lambda表达式的格式" class="headerlink" title="Lambda表达式的格式"></a>Lambda表达式的格式</h5><ul>
<li><p>Lambda表达式被大括号包围着</p>
</li>
<li><p>Lambda表达式的参数在<code>-&gt;</code>的左边，如果没有参数，则只保留函数体</p>
</li>
<li><p>Lambda表达式的函数体在<code>-&gt;</code>的后面</p>
</li>
<li><p>Lambda表达式的返回类型值总为函数体最后一行代码的返回值类型</p>
</li>
</ul>
<h5 id="无参数，无返回值的Lambda表达式"><a href="#无参数，无返回值的Lambda表达式" class="headerlink" title="无参数，无返回值的Lambda表达式"></a>无参数，无返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test01Lambda = &#123;</span><br><span class="line">    print(<span class="string">&quot;无参数,无返回值&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们同样将Lambda表达式赋值给了变量，这个变量是函数类型（<code>() -&gt; Unit</code>）的对象。</p>
<h5 id="有参数，无返回值的Lambda表达式"><a href="#有参数，无返回值的Lambda表达式" class="headerlink" title="有参数，无返回值的Lambda表达式"></a>有参数，无返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda = &#123; name: String -&gt;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个变量是函数类型（<code>(String) -&gt; Unit</code>）的对象。</p>
<p>如果我们手动给这个变量指明了类型，那么Lambda的参数类型还可以不写：</p>
<p>注意这个name参数 是回调方法传过来的参数.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda: (String) -&gt; <span class="built_in">Unit</span> = &#123; name -&gt;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$name</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个时候，Kotlin可以自动为我们推断出Lambda中这个参数的类型是String类型。</p>
<p>如果Lambda表达式的参数只有一个，我们甚至连这个参数都可以省略不写，那…我想使用这个参数的时候怎么办呢？我们可以用<code>it</code>来代替：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test02Lambda: (String) -&gt; <span class="built_in">Unit</span> = &#123;</span><br><span class="line">    print(<span class="string">&quot;有参数,无返回值，参数值为：<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="有参数，有返回值的Lambda表达式"><a href="#有参数，有返回值的Lambda表达式" class="headerlink" title="有参数，有返回值的Lambda表达式"></a>有参数，有返回值的Lambda表达式</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> test03Lambda = &#123; doubleValue: <span class="built_in">Double</span> -&gt;</span><br><span class="line">    print(<span class="string">&quot;parameter is Double,Value is:<span class="variable">$doubleValue</span>&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;now parse Double into String&quot;</span>)</span><br><span class="line">    doubleValue.toString()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Lambda表达式的最后一行代码将作为返回值，因此它对应的函数类型为：<code>(Double) -&gt; String</code>。同样，如果变量已经确切的指定了类型，则Lambda表达式的参数类型可以省略，又由于只有一个参数，所以连参数都可以省略，Kotlin将使用it代替这个参数名。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> method: (String, String) -&gt; <span class="built_in">Unit</span> = &#123; aStr, bStr -&gt; println(<span class="string">&quot;a : <span class="variable">$aStr</span>, b:<span class="variable">$bStr</span>&quot;</span>) &#125;</span><br><span class="line">method(<span class="string">&quot;john&quot;</span>,<span class="string">&quot;男&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> method02 = &#123; println(<span class="string">&quot;john&quot;</span>)&#125;</span><br><span class="line"><span class="keyword">val</span> method03:(String)-&gt;<span class="built_in">Unit</span>=&#123;</span><br><span class="line">    println(<span class="string">&quot;传入的是:<span class="variable">$it</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method03(<span class="string">&quot;Jon&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> method04:(<span class="built_in">Int</span>)-&gt;<span class="built_in">Unit</span>=&#123;</span><br><span class="line">    <span class="keyword">when</span>(it)&#123;</span><br><span class="line">        <span class="number">1</span>-&gt; println(<span class="string">&quot;等于1&quot;</span>)</span><br><span class="line">        <span class="keyword">in</span> <span class="number">20.</span>. <span class="number">30</span> -&gt; println(<span class="string">&quot;20 - 30的数字&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span> -&gt; println(<span class="string">&quot;都不满足&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">method04(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">val</span> method05 : (<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt; <span class="built_in">Unit</span> = &#123;aNumber,bNumber-&gt;</span><br><span class="line">    println(<span class="string">&quot;第一个: <span class="variable">$aNumber</span>, 第二个 : <span class="variable">$bNumber</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method05(<span class="number">1</span>,<span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> method06 : (<span class="built_in">Int</span>,<span class="built_in">Int</span>)-&gt; <span class="built_in">Unit</span> = &#123;aNumber,_-&gt;</span><br><span class="line">    println(<span class="string">&quot;第一个: <span class="variable">$aNumber</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">method06(<span class="number">99</span>,<span class="number">88</span>)</span><br><span class="line"><span class="keyword">val</span> method07 : (String)-&gt;String = &#123;str -&gt; str&#125;</span><br><span class="line">println(method07(<span class="string">&quot;Jon&quot;</span>))</span><br></pre></td></tr></table></figure>







<h3 id="函数类型"><a href="#函数类型" class="headerlink" title="函数类型"></a>函数类型</h3><h5 id="函数类型的书写格式"><a href="#函数类型的书写格式" class="headerlink" title="函数类型的书写格式"></a>函数类型的书写格式</h5><p>所有函数类型都有一个圆括号括起来的参数类型列表，以及一个返回类型：<code>(A, B) -&gt; C</code> ，参数列表与返回值类型之间通过 -&gt; 符号连接。<code>(A, B) -&gt; C</code>表示接收类型分别为 <code>A</code> 与 <code>B</code> 两个参数并返回一个 <code>C</code> 类型值的函数类型。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> f: (<span class="built_in">Int</span>) -&gt; String</span><br></pre></td></tr></table></figure>

<p><code>(Int) -&gt; String</code>这就是一个函数类型。另外需要注意的是，即使函数类型的参数列表为空，也必须保留小括号，例如<code>() -&gt; String</code>；即使函数类型的返回值类型为Unit，也不可省略Unit不写，例如：<code>(Int) -&gt; Unit</code>。</p>
<h5 id="函数类型的对象使用"><a href="#函数类型的对象使用" class="headerlink" title="函数类型的对象使用"></a>函数类型的对象使用</h5><p><code>sum(1, 2)</code>这我可以理解，毕竟sum是一个函数，但是<code>block(1, 2)</code>这样也行？block可是一个函数类型的对象啊，函数类型的对象后面可以加括号调用？</p>
<p>没错，只有函数类型的对象可以，其实这是Kotlin为我们提供的一个语法糖，它本质上还是会去调用invoke函数，也就是说</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> block: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = ::sum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">sum</span><span class="params">(firstNumber: <span class="type">Int</span>, secondNumber: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> firstNumber + secondNumber</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> block: (<span class="built_in">Int</span>, <span class="built_in">Int</span>) -&gt; <span class="built_in">Int</span> = ::sum</span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下调用都是有返回值的,因为(Int, Int) -&gt; Int这个函数类型是有返回值的</span></span><br><span class="line">block(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">block.invoke(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">(::sum)(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line">(::sum).invoke(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>Kotlin使用这种（函数类型对象能够使用括号访问）语法让我们感觉，嗯，block就是sum函数的替身，而实际上它是一个对象，一个函数类型的对象。</p>
<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><h5 id="什么是高阶函数"><a href="#什么是高阶函数" class="headerlink" title="什么是高阶函数"></a>什么是高阶函数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">btn.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>有没有想过为什么需要传一个匿名类过去？因为Framework会在该View被点击的时候调用我们在匿名类中实现的那个onClick方法，以便于执行我们自己的处理逻辑。</p>
<p>要是我们能直接将方法传过去就好了…梦该醒了，这是Java，只能通过接口 + 匿名内部类这种折中的方案来实现这样的需求。</p>
<p>而Kotlin有了函数类型，又有了高阶函数，意味着我们可以传入一段代码给函数了，函数可以在适当的时候执行我们传入的那段代码，完美的解决了这一痛点。</p>
<h5 id="高阶函数的使用案例"><a href="#高阶函数的使用案例" class="headerlink" title="高阶函数的使用案例"></a>高阶函数的使用案例</h5><p>虽然都是过滤找出符合要求的苹果，但是条件是不一样的。这个怎么做呢？最简单的方法就是写三个循环，每个循环中针对不同的条件对苹果集合进行筛选。但是我们完全可以使用高阶函数和函数类型优雅的实现这个功能：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">AppleBean</span></span>(<span class="keyword">val</span> color:<span class="built_in">Int</span>, <span class="keyword">val</span> weight:<span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean))&#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>，filterApple函数主要的功能只是遍历集合，以及把符合条件的苹果添加到新的集合中返回，至于筛选的条件，filterApple函数并不知道，而是完全取决于predicate这个函数类型的参数，只要predicate返回true，则符合条件。这样我们可以在调用函数时动态地传入不同的过滤规则</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    filterApple(appleList, ::filterColorPredicate)</span><br><span class="line">    filterApple(appleList, ::filterWeightPredicate)</span><br><span class="line">    filterApple(appleList, ::filterColorAndWeightPredicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterWeightPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.weight &gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorAndWeightPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span> &amp;&amp; appleBean.weight &gt; <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean)) &#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这…太麻烦了吧，我每次调用高阶函数，传入函数类型的时候，还必须要先定义一个函数，然后再使用<code>::函数名</code>传入吗？其实不必这么麻烦的，现在我们学习的只不过是其中的一种方式而已。下面我们就要来学习更加简单的方式：匿名函数。</p>
<h3 id="Lambda表达式与高阶函数"><a href="#Lambda表达式与高阶函数" class="headerlink" title="Lambda表达式与高阶函数"></a>Lambda表达式与高阶函数</h3><p>现在大家已经对Lambda表达式的写法了如指掌了，现在是时候来看看Lambda表达式如何与高阶函数配合使用了。还记得之前的那个筛选苹果的例子吗？我们定义了一个高阶函数，它的名字叫：filterApple，代码如下：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> destination = mutableListOf&lt;AppleBean&gt;()</span><br><span class="line">    <span class="keyword">for</span> (appleBean <span class="keyword">in</span> appleList) &#123;</span><br><span class="line">        <span class="keyword">if</span> (predicate(appleBean)) &#123;</span><br><span class="line">            destination.add(appleBean)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> destination</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个高阶函数的第二个参数接收了一个函数类型的参数，在之前，我们分别使用了两种方式进行调用：</p>
<ol>
<li><p>双冒号的方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    filterApple(appleList, ::filterColorPredicate)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterColorPredicate</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.color == <span class="number">0xFF0000</span></span><br></pre></td></tr></table></figure></li>
<li><p>匿名函数的方式：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, <span class="function"><span class="title">fun</span><span class="params">(appleBean: <span class="type">AppleBean</span>)</span></span>: <span class="built_in">Boolean</span> = appleBean.weight &gt; <span class="number">6</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>完整的写法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, &#123; appleBean: AppleBean -&gt; appleBean.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>简化的写法</p>
<p>我们怎么知道哪个参数需要传入Lambda表达式呢？当然是看被调用的这个高阶函数的定义啊，还记的这个高阶函数的样子吗？</p>
<p>我们怎么知道哪个参数需要传入Lambda表达式呢？当然是看被调用的这个高阶函数的定义啊，还记的这个高阶函数的样子吗？</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">filterApple</span><span class="params">(appleList: <span class="type">List</span>&lt;<span class="type">AppleBean</span>&gt;, predicate: (<span class="type">AppleBean</span>) -&gt; <span class="type">Boolean</span>)</span></span>: List&lt;AppleBean&gt; &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然第二个形参是一个函数类型的参数，并且已经明确的指出了形参的函数类型：<code>(AppleBean) -&gt; Boolean</code>（实际上也必须明确指出，否则报错）。根据我们前面所学习的知识，这种情况下，我们可以直接省略Lambda表达式中的参数类型，Kotlin会根据上下文自动推断：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, &#123; appleBean -&gt; appleBean.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>再简化的写法</p>
<p>由于这个函数类型只需要一个参数，因此我们还可以省略参数的名字，Kotlin会使用it代替，这在之前的Lambda讲解中，都是讲过的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList, &#123; it.weight &gt; <span class="number">6</span> &#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>再再简化的写法</p>
<p>第一个是：如果Lambda表达式作为函数的最后一个参数传入，那么它可以单独放在调用函数的括号后面：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filterApple(appleList) &#123; it.weight &gt; <span class="number">6</span> &#125;</span><br></pre></td></tr></table></figure>

<p>第二个是：如果函数只接收一个函数类型的参数，我们传入Lambda表达式时，连函数调用的括号都可以去掉：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    test &#123; num1, num2 -&gt;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(block: (<span class="type">Int</span>, <span class="type">Int</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>​        作者：HurryYu_YZH<br>​        链接：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8eb0623f08c6">https://www.jianshu.com/p/8eb0623f08c6</a></p>
<h3 id="项目实例"><a href="#项目实例" class="headerlink" title="项目实例"></a>项目实例</h3><h5 id="Login01-kt"><a href="#Login01-kt" class="headerlink" title="Login01.kt"></a>Login01.kt</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传入一个具名函数，被调用后，获取参数</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">test</span><span class="params">(resModel: <span class="type">ResModel</span>)</span></span>&#123;</span><br><span class="line">    println(resModel.int)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginModelImpl</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">loginOptions</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        mobileNo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        metaInfo: <span class="type">String</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        block: (<span class="type">model</span>: <span class="type">ResModel</span>) -&gt; <span class="type">Unit</span></span></span></span><br><span class="line"><span class="function"><span class="params">    )</span></span> &#123;</span><br><span class="line">        <span class="keyword">val</span> model = ResModel(<span class="number">8</span>)</span><br><span class="line">        block(model)</span><br><span class="line">      <span class="comment">//  block.invoke(model) 这样写也可以 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResModel</span></span>(<span class="keyword">val</span> int: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">val</span> loginModelImpl = LoginModelImpl()</span><br><span class="line">    <span class="keyword">val</span> responseModel = ResModel(<span class="number">0</span>)</span><br><span class="line">    loginModelImpl.loginOptions(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,::test) <span class="comment">// 可以看到 fun test(resModel: ResModel)也被调用,可以理解被回调</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;model: ResModel -&gt; model.toString() &#125;)</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;model -&gt; model.toString() &#125;)</span></span><br><span class="line">    loginModelImpl.loginOptions(<span class="string">&quot;&quot;</span>,<span class="string">&quot;&quot;</span>,&#123;println(it.int)&#125;) <span class="comment">//lambda只有一个参数，传入参数也可以省略,&#123;&#125;里面用it代替</span></span><br><span class="line"><span class="comment">//    loginModelImpl.loginOptions(&quot;&quot;,&quot;&quot;,&#123;&#125;) // it可以用也可以不用</span></span><br></pre></td></tr></table></figure>



<h5 id="Login02-kt"><a href="#Login02-kt" class="headerlink" title="Login02.kt"></a>Login02.kt</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    loginAction(<span class="string">&quot;Jo1n&quot;</span>, <span class="string">&quot;123456&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (it) &#123;</span><br><span class="line">            println(<span class="string">&quot;登录成功&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            println(<span class="string">&quot;登录失败&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loginAction</span><span class="params">(userName: <span class="type">String</span>, pwd: <span class="type">String</span>, loginResponseResult: (<span class="type">Boolean</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (userName == <span class="literal">null</span> || pwd == <span class="literal">null</span>) <span class="keyword">return</span></span><br><span class="line">    loginEngine(userName, pwd, loginResponseResult)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">loginEngine</span><span class="params">(userName: <span class="type">String</span>, pwd: <span class="type">String</span>, loginResponseResult: (<span class="type">Boolean</span>) -&gt; <span class="type">Unit</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;Jon&quot;</span> == userName &amp;&amp; <span class="string">&quot;123456&quot;</span> == pwd) &#123;</span><br><span class="line">        loginResponseResult(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        loginResponseResult(<span class="literal">false</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1xv411k7Dd?p=3&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1xv411k7Dd?p=3&amp;spm_id_from=pageDriver</a></p>
<h5 id="updateFastClickTime"><a href="#updateFastClickTime" class="headerlink" title="updateFastClickTime"></a>updateFastClickTime</h5><p>这个方法很形象, 匿名函数的参数 ,是回调时候传的</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">updateFastClickTime</span><span class="params">(callback: ((<span class="type">currentTime</span>: <span class="type">Long</span>, <span class="type">lastClickTime</span>: <span class="type">Long</span>) -&gt; <span class="type">Unit</span>)? = <span class="literal">null</span>)</span></span>: <span class="built_in">Long</span> &#123;</span><br><span class="line">    <span class="keyword">val</span> curClickTime = System.currentTimeMillis()</span><br><span class="line">    callback?.invoke(</span><br><span class="line">        curClickTime,</span><br><span class="line">        lastClickTime</span><br><span class="line">    )</span><br><span class="line">    lastClickTime = curClickTime</span><br><span class="line">    <span class="keyword">return</span> curClickTime</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="getOrElse"><a href="#getOrElse" class="headerlink" title="getOrElse"></a>getOrElse</h5><p> 匿名函数的参数 ,是回调时候传的,返回T类型.</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> List<span class="type">&lt;T&gt;</span>.<span class="title">getOrElse</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    index: <span class="type">Int</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    defaultValue:(<span class="type">Int</span>) -&gt; <span class="type">T</span>       <span class="comment">//这个 (Int) -&gt; T 看不明白</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">)</span></span>: T</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;T&gt;</span> Array<span class="type">&lt;out T&gt;</span>.<span class="title">getOrElse</span><span class="params">(index: <span class="type">Int</span>, defaultValue: (<span class="type">Int</span>) -&gt; <span class="type">T</span>)</span></span>: T &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">if</span> (index &gt;= <span class="number">0</span> &amp;&amp; index &lt;= lastIndex) <span class="keyword">get</span>(index) <span class="keyword">else</span> defaultValue(index)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://bbs.csdn.net/topics/399173319">https://bbs.csdn.net/topics/399173319</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2021-08-29T12:45:53.000Z" title="8/29/2021, 8:45:53 PM">2021-08-29</time></span><span class="level-item">Updated&nbsp;<time dateTime="2023-01-02T03:31:39.066Z" title="1/2/2023, 11:31:39 AM">2023-01-02</time></span><span class="level-item"><a class="link-muted" href="/categories/ANDROID/">ANDROID</a></span><span class="level-item">24 minutes read (About 3639 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/08/29/Dagger/">Dagger</a></p><div class="content"><p><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection/dagger-basics">https://developer.android.google.cn/training/dependency-injection/dagger-basics</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1hF411W7aj">https://www.bilibili.com/video/BV1hF411W7aj</a> 动脑</p>
<h3 id="注入3要素"><a href="#注入3要素" class="headerlink" title="注入3要素"></a>注入3要素</h3><p><img src="/2021/08/29/Dagger/2021-09-25_7.49.39_dagger3.png"></p>
<h5 id="注入流程"><a href="#注入流程" class="headerlink" title="注入流程"></a>注入流程</h5><p><img src="/2021/08/29/Dagger/2021-09-25_8.59.52_inject.png" alt="2021-09-25_8.59.52_inject"></p>
<h5 id="构造方法对象注入"><a href="#构造方法对象注入" class="headerlink" title="构造方法对象注入"></a>构造方法对象注入</h5><ol>
<li><p>创建User4对象 </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User4</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span></span>()</span><br></pre></td></tr></table></figure></li>
<li><p>创建ApplicationComponent4</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent4</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(mainActivity: <span class="type">MainActivity4</span>?)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>执行注入.</p>
</li>
</ol>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user:User4</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main3)</span><br><span class="line">        DaggerApplicationComponent4.create().inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onCreate: user= <span class="variable">$user</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="第三方对象注入-一"><a href="#第三方对象注入-一" class="headerlink" title="第三方对象注入(一)"></a>第三方对象注入(一)</h5><p>Module :Module可以提供多个对象，返回类型要不一样 。</p>
<p>Component  :IOC容器, 用来注入对象,module集成到component身上,再由Component把对象注入到平时用的Activity或者目的类身上。</p>
<blockquote>
<p> 依赖的查找顺序为：先找@Module，如果找到了就停止，如果找不到就去找@Inject</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpObject</span> // 也可直接在这里提供对象,<span class="type">不用Module</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideHttpObject</span><span class="params">()</span></span>:HttpObject&#123; <span class="comment">// 针对第三方sdk的对象，可以灵活提供</span></span><br><span class="line">        <span class="keyword">return</span> HttpObject()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component(modules = [HttpModule::class, DataBaseModule::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">MyComponent</span> </span>&#123;</span><br><span class="line">    <span class="comment">//注入点</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerxxActivity</span>)</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerxxActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> binding <span class="keyword">by</span> lazy &#123; ActivityDaggerXxBinding.inflate(layoutInflater) &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> TAG = <span class="string">&quot;DaggerxxActivity&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> httpObject: HttpObject</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> databaseObject: DatabaseObject</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(binding.root)</span><br><span class="line">        DaggerMyComponent.create().inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;onCreate: httpObject <span class="variable">$httpObject</span>  databaseObject  <span class="variable">$databaseObject</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903850319544328">https://juejin.cn/post/6844903850319544328</a></p>
<p><img src="/2021/08/29/Dagger/2021-09-25_9.15.37_dagger_class.png"></p>
<h5 id="第三方对象注入-一-1"><a href="#第三方对象注入-一-1" class="headerlink" title="第三方对象注入(一)"></a>第三方对象注入(一)</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User6</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppModule6</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideUser</span><span class="params">()</span></span>: User6 &#123;</span><br><span class="line">        <span class="keyword">return</span> User6()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="meta">@Component(modules = [AppModule6::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent6</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(mainActivity: <span class="type">MainActivity6</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity6</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user: User6</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        DaggerApplicationComponent6.create().inject(<span class="keyword">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="依赖注入概念"><a href="#依赖注入概念" class="headerlink" title="依赖注入概念"></a>依赖注入概念</h3><ol>
<li>构造方法注入</li>
<li>Setter注入(字段注入)</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    Engine engine;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法注入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// setter注入(字段注入)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;</span><br><span class="line">        engine = <span class="keyword">new</span> Engine();</span><br><span class="line">        engine.start();</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engine</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="IOC框架"><a href="#IOC框架" class="headerlink" title="IOC框架"></a>IOC框架</h5><ol>
<li>基于反射的方式实现： Spring IOC(动态的进行依赖关系的建立)</li>
<li>静态方式 ： 程序在编译时就已经提供好了建立依赖关系的类。Dagger2</li>
</ol>
<p>两种注入方式</p>
<p><img src="/2021/08/29/Dagger/2021-08-29_8.43.22_type_dagger.png" alt="2021-08-29_8.43.22_type_dagger"></p>
<h3 id="Dagger注入"><a href="#Dagger注入" class="headerlink" title="Dagger注入"></a>Dagger注入</h3><h5 id="构造方法注入"><a href="#构造方法注入" class="headerlink" title="构造方法注入"></a>构造方法注入</h5><p>构造方法构造实例注入步骤</p>
<ol>
<li><p>使用 @Inject注解在构造方法上；就是告知Dagger可以通过构造方法来创建并获取到User的实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.使用 @Inject注解在构造方法上；就是告知Dagger可以通过构造方法来创建并获取到User的实例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span></span>()</span><br></pre></td></tr></table></figure></li>
<li><p>当作IOC容器,把对象注入到目标类中</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. Component可以当作IOC容器,然后把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerActivity</span>?)</span></span> <span class="comment">//指定DaggerActivity作为要注入的目标类</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>设置Inject注解</p>
<p>DaggerActivity.java</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//3.设置Inject注解</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">User user;</span><br></pre></td></tr></table></figure></li>
<li><p>执行注入动作</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">//3.设置Inject注解</span></span><br><span class="line"><span class="meta">@Inject</span></span><br><span class="line">User user;</span><br><span class="line">   </span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">      setContentView(R.layout.activity_dagger2);</span><br><span class="line"><span class="comment">//4.执行注入动作</span></span><br><span class="line">    DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);<span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类 </span></span><br><span class="line">    <span class="comment">// DaggerApplicationComponent.create()获取到实例,inject(this)注入到Activity中</span></span><br><span class="line">      Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Dagger-Module注入"><a href="#Dagger-Module注入" class="headerlink" title="Dagger Module注入"></a>Dagger Module注入</h5><p>第三方框架的类，实现依赖注入， 上面User是我们自己定义的类， </p>
<ol>
<li><p>第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providerUser</span><span class="params">()</span></span>: User &#123;</span><br><span class="line">        <span class="keyword">return</span> User()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideRetrofit</span><span class="params">()</span></span>: Retrofit &#123;</span><br><span class="line">        <span class="keyword">return</span> Retrofit.Builder()</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<ol start="2">
<li><p>compoent</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 2. Component可以当作IOC容器,然后把对象注入到目标类中</span><br><span class="line">&#x2F;&#x2F; 设置作用域和ApplicationComponent组件的生命周期一致</span><br><span class="line">@Component(modules &#x3D; [NetModule::class]) &#x2F;&#x2F;模块装载到组件上去</span><br><span class="line">interface ApplicationComponent &#123;</span><br><span class="line">    fun inject(daggerActivity: DaggerActivity?) &#x2F;&#x2F;指定DaggerActivity作为要注入的目标类</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>DaggerActivity.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;DaggerActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置Inject注解</span></span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Retrofit retrofit;</span><br><span class="line">  </span><br><span class="line">    Log.i(TAG, <span class="string">&quot;retrofit: &quot;</span> + retrofit);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="Retrofit注入"><a href="#Retrofit注入" class="headerlink" title="Retrofit注入"></a>Retrofit注入</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApiService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GET(&quot;/user/info&quot;)</span></span><br><span class="line">    <span class="function">Call&lt;String&gt; <span class="title">requestInfo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line"><span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line"><span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line"><span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line"><span class="meta">@Provides</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line">ApiService apiService;</span><br><span class="line"></span><br><span class="line">Log.i(TAG, <span class="string">&quot;apiService: &quot;</span> +apiService);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Module已经知道怎么获取retrofit实例<br>接着同一个Module中的方法，就可以作为参数直接传入 使用<br>// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例<br>// 然后从当前容器直接获取</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="局部单例实现"><a href="#局部单例实现" class="headerlink" title="局部单例实现"></a>局部单例实现</h3><p><img src="/2021/08/29/Dagger/2021-08-29_8.43.44_local.png" alt="2021-08-29_8.43.44_local"></p>
<h5 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h5><p><img src="/2021/08/29/Dagger/2021-08-29_8.48.38_lifecycle.png" alt="2021-08-29_8.48.38_lifecycle"></p>
<p><strong>将某个对象的生命周期限定为其组件的生命周期。</strong></p>
<p>下面User，Retrofit ,ApiService, OkHttpClient对象实例指定了作用域是Singleton,那么载入这些对象的组建ApplicationComponent1也必须用作用域是Singleton.</p>
<p>要么不使用 作用域 即默认的作用域， 如果使用的话，就必须保证他们的作用域一致。</p>
<h5 id="局部实例1"><a href="#局部实例1" class="headerlink" title="局部实例1"></a>局部实例1</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Dagger模块</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NetModule1</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">providerUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="comment">//@Provides</span></span><br><span class="line">    <span class="comment">//public Retrofit provideRetrofit() &#123;</span></span><br><span class="line">    <span class="comment">//    return new Retrofit.Builder()</span></span><br><span class="line">    <span class="comment">//        .baseUrl(&quot;http://www.google.com&quot;)</span></span><br><span class="line">    <span class="comment">//        .build();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Retrofit <span class="title">provideRetrofit</span><span class="params">(OkHttpClient okHttpClient)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Retrofit.Builder()</span><br><span class="line">            .client(okHttpClient)</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ApiService <span class="title">provideApiService</span><span class="params">(Retrofit retrofit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Singleton是Dagger提供的一种作用域</span></span><br><span class="line">    <span class="comment">// 作用域就是用来管理Component来获取对象实例的生命周期</span></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OkHttpClient <span class="title">provideOkHttpClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OkHttpClient.Builder().build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@Singleton</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule1.class&#125;)</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaggerActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;DaggerActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.设置Inject注解</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    User user2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    Retrofit retrofit;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_dagger2);</span><br><span class="line">        <span class="comment">//4.执行注入动作</span></span><br><span class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);<span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类</span></span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user: &quot;</span> + user);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user2: &quot;</span> + user2);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;retrofit: &quot;</span> + retrofit);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService: &quot;</span> +apiService);</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService2: &quot;</span> +apiService2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: user: com.comm.util.dagger.dn.di.User@2129cef</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: user2: com.comm.util.dagger.dn.di.User@d97d3fc</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: retrofit: retrofit2.Retrofit@d243a85</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService: retrofit2.Retrofit$1@a1fa0da</span><br><span class="line">2092-2092&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService2: retrofit2.Retrofit$1@a1fa0da</span><br></pre></td></tr></table></figure>

<p>可以看到 user 是2个实例</p>
<p>apiService用了同一个对象实例,所以可以看到和DaggerApplicationComponent组件生命周期一致。</p>
<h5 id="局部实例2"><a href="#局部实例2" class="headerlink" title="局部实例2"></a>局部实例2</h5><p>添加一个Activity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SecondActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</span><br><span class="line">    String TAG = <span class="string">&quot;SecondActivity&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    ApiService apiService3;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_second2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//DaggerApplicationComponent相当于DaggerApplication的实现类</span></span><br><span class="line">        DaggerApplicationComponent.create().inject(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService3: &quot;</span> + apiService3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startActivity(<span class="keyword">new</span> Intent(<span class="keyword">this</span>,SecondActivity.class));</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">7410-7410&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService: retrofit2.Retrofit$1@a1fa0da</span><br><span class="line">7410-7410&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService2: retrofit2.Retrofit$1@a1fa0da</span><br><span class="line">2021-08-29 22:28:35.812 7410-7410&#x2F;com.comm.util I&#x2F;SecondActivity: apiService3: retrofit2.Retrofit$1@84eb79a</span><br></pre></td></tr></table></figure>

<p>不同的DaggerApplicationComponent组件，不同的实例</p>
<h5 id="全局实例"><a href="#全局实例" class="headerlink" title="全局实例"></a>全局实例</h5><p>保证组件全局实例</p>
<p>Module作用域生命周期和 ApplicationComponent保持一致。</p>
<p>MyApplication.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> ApplicationComponent  applicationComponent = DaggerApplicationComponent.create();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationComponent <span class="title">getApplicationComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> applicationComponent;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyApplication.getApplicationComponent().inject(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">8044-8044&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService: retrofit2.Retrofit$1@516190b</span><br><span class="line">8044-8044&#x2F;com.comm.util I&#x2F;DaggerActivity: apiService2: retrofit2.Retrofit$1@516190b</span><br><span class="line">8044-8044&#x2F;com.comm.util I&#x2F;SecondActivity: apiService3: retrofit2.Retrofit$1@516190b</span><br></pre></td></tr></table></figure>



<h5 id="使用作用域遵循的规则"><a href="#使用作用域遵循的规则" class="headerlink" title="使用作用域遵循的规则"></a>使用作用域遵循的规则</h5><p><img src="/2021/08/29/Dagger/2021-08-29_10.50.21_myscope.png" alt="2021-08-29_10.50.21_myscope"></p>
<p>组件ApplicationComponent指定了作用域,组件中的模块modules = {NetModule.class}，也要指定相同的作用域。</p>
<p>NetModule中的方法设置@Singleton 那么ApplicationComponent也必须设置@Singleton</p>
<p>NetModule中的方法设置@MyScope 那么ApplicationComponent也必须设置@MyScope</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(DaggerActivity daggerActivity)</span></span>;<span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">inject</span><span class="params">(SecondActivity secondActivity)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="组件依赖"><a href="#组件依赖" class="headerlink" title="组件依赖"></a>组件依赖</h3><p>因为,一个Acitivty不能有两个组件直接注入,不如ApplicationComponent 和UserComponent.</p>
<p>组建依赖与子组建主要解决了不同作用域时组建之间复用问题.</p>
<ul>
<li>在一个组件置顶作用域后，就已经确定了该组建创建对象的生命周期。 但是<strong>有些对象的实例可能生命周期更短</strong>。这个时候就需要定义新的组建。</li>
<li>新组件需要使用原组建的部分资源</li>
</ul>
<p>两种实现方式</p>
<ol>
<li>为@Component添加dependencies参数,指定该组建依赖新的组件。</li>
<li>直接使用@Subcomponent注解创建新的组件，并装载到父组件中。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ki4y1A7hA?p=07">https://www.bilibili.com/video/BV1Ki4y1A7hA?p=07</a></p>
<p>来看方式一</p>
<h5 id="实例部分全局"><a href="#实例部分全局" class="headerlink" title="实例部分全局"></a>实例部分全局</h5><p>实现 Retrofit ,ApiService 进程下全局, User2类 Activity全局</p>
<p>MyScope是自定义的作用域，用Singleton也可以，主要是保证组建作用域全局单例，感觉和hilt有点不同</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致,如果ApplicationComponent是全局的，那么就是全局的</span></span><br><span class="line"><span class="meta">@Component(modules = &#123;NetModule2.class&#125;)</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    void inject(DaggerUserActivity daggerActivity);<span class="comment">//指定目标类 //dependencies = &#123;ApplicationComponent1.class&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Retrofit retrofit();</span><br><span class="line">    ApiService apiService();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UserScope</span></span><br><span class="line"><span class="meta">@Component(modules = [UserModule2::class], dependencies = [ApplicationComponent2::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UserComponent2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerUserActivity2</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity2</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NetModule2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">providerUser</span><span class="params">()</span></span>: User2 &#123;</span><br><span class="line">        <span class="keyword">return</span> User2()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第二种方式告知Dagger,可以通过调用该方法来获取到注入对象的实例</span></span><br><span class="line">    <span class="comment">//@Provides</span></span><br><span class="line">    <span class="comment">//public Retrofit provideRetrofit() &#123;</span></span><br><span class="line">    <span class="comment">//    return new Retrofit.Builder()</span></span><br><span class="line">    <span class="comment">//        .baseUrl(&quot;http://www.google.com&quot;)</span></span><br><span class="line">    <span class="comment">//        .build();</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line">    <span class="meta">@MyScope</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideRetrofit</span><span class="params">(okHttpClient: <span class="type">OkHttpClient</span>?)</span></span>: Retrofit &#123;</span><br><span class="line">        <span class="keyword">return</span> Retrofit.Builder()</span><br><span class="line">            .client(okHttpClient)</span><br><span class="line">            .baseUrl(<span class="string">&quot;http://www.google.com&quot;</span>)</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Module已经知道怎么获取retrofit实例</span></span><br><span class="line">    <span class="comment">//接着同一个Module中的方法，就可以作为参数直接传入 使用</span></span><br><span class="line">    <span class="comment">// 比如provideApiService需要Retrofit实例，会从当前容器查找是否已经有Retrofit实例</span></span><br><span class="line">    <span class="comment">// 然后从当前容器直接获取</span></span><br><span class="line">    <span class="meta">@MyScope</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideApiService</span><span class="params">(retrofit: <span class="type">Retrofit</span>)</span></span>: ApiService &#123;</span><br><span class="line">        <span class="keyword">return</span> retrofit.create(ApiService::<span class="keyword">class</span>.java)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@Singleton是Dagger提供的一种作用域</span></span><br><span class="line">    <span class="comment">// 作用域就是用来管理Component来获取对象实例的生命周期</span></span><br><span class="line">    <span class="meta">@MyScope</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideOkHttpClient</span><span class="params">()</span></span>: OkHttpClient &#123;</span><br><span class="line">        <span class="keyword">return</span> OkHttpClient.Builder().build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意ApplicationComponent2要提供对应Module的方法</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，NetModule设置@Singleton 那么ApplicationComponent也必须设置</span></span><br><span class="line"><span class="meta">@Component(modules = [NetModule2::class])</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerUserActivity</span>)</span></span> <span class="comment">//指定目标类 //dependencies = &#123;ApplicationComponent1.class&#125;</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">retrofit</span><span class="params">()</span></span>: Retrofit</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">apiService</span><span class="params">()</span></span>: ApiService</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideContext</span><span class="params">()</span></span>: Context</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> ApplicationComponent2 applicationComponent = DaggerApplicationComponent2.create();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyApplication app;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ApplicationComponent2 <span class="title">getApplicationComponent2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> applicationComponent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Dagger</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyApplication <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> app;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerUserActivity2</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user1: User2</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> user2: User2</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> apiService1: ApiService</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> apiService2: ApiService</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> userComponent: UserComponent2? = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_dagger_user)</span><br><span class="line">        userComponent = DaggerUserComponent2.builder().applicationComponent2(</span><br><span class="line">            MyApplication.getApplicationComponent2()</span><br><span class="line">        ).build()</span><br><span class="line">        userComponent?.inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user1: <span class="variable">$user1</span>&quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;user2: <span class="variable">$user2</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService1: <span class="variable">$apiService1</span>&quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;apiService2: <span class="variable">$apiService2</span>&quot;</span>)</span><br><span class="line">        startActivity(Intent(<span class="keyword">this</span>, DaggerSecondActivity2::<span class="keyword">class</span>.java))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>从结果上, Retrofit 是全局单例，User2对象是Activity单例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: user1: com.comm.util.dagger.dn.di.User2@1da0e9b</span><br><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: user2: com.comm.util.dagger.dn.di.User2@1da0e9b</span><br><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: apiService1: retrofit2.Retrofit$1@12da238</span><br><span class="line">399 10821-10821&#x2F;com.comm.util I&#x2F;DaggerUserActivity2: apiService2: retrofit2.Retrofit$1@12da238</span><br><span class="line">438 10821-10821&#x2F;com.comm.util I&#x2F;DaggerSecondActivity2: user3: com.comm.util.dagger.dn.di.User2@8233396</span><br><span class="line">438 10821-10821&#x2F;com.comm.util I&#x2F;DaggerSecondActivity2: apiService3: retrofit2.Retrofit$1@12da238</span><br></pre></td></tr></table></figure>



<h5 id="提供全局Application"><a href="#提供全局Application" class="headerlink" title="提供全局Application"></a>提供全局Application</h5><p>demo代码有问题 NPR</p>
<h5 id="子组件方式"><a href="#子组件方式" class="headerlink" title="子组件方式"></a>子组件方式</h5><p>优势</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">下面的interface ApplicationComponent3 </span><br><span class="line"> 父组件不用定义 这些方法</span><br><span class="line">  fun retrofit(): Retrofit</span><br><span class="line">  fun apiService(): ApiService</span><br><span class="line">  fun context(): Context</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2. 当作IOC容器,把对象注入到目标类中</span></span><br><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致，NetModule设置@Singleton 那么ApplicationComponent也必须设置</span></span><br><span class="line"><span class="meta">@Component(modules = [SubComponentModule::class])</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerUserActivity</span>)</span></span> <span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">studentComponent</span><span class="params">()</span></span>:StudentComponent.Factory</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module(subcomponents = [StudentComponent::class])</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubComponentModule</span> </span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subcomponent(modules = [StudentModule::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">StudentComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subcomponent</span>.Factory</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span>: StudentComponent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity3</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class DaggerSecondActivity3 : AppCompatActivity() &#123;</span><br><span class="line">    var TAG &#x3D; javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    lateinit var student: Student</span><br><span class="line"></span><br><span class="line">    override fun onCreate(savedInstanceState: Bundle?) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line"></span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(this)</span><br><span class="line">        Log.i(TAG, &quot;student: $student &quot;)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>结果同样注入成功</p>
<blockquote>
<p>/com.comm.util I/DaggerSecondActivity3: student: com.comm.util.dagger.dn.di.Student@6c29d80 </p>
</blockquote>
<h3 id="Binds注入接口实例"><a href="#Binds注入接口实例" class="headerlink" title="Binds注入接口实例"></a>Binds注入接口实例</h3><p>之前用的是 module总 provide对象提供方式 ,想下面这种的。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>通过这种方式注入的优势是,直接使用接口，不需要具体的实现, AInterfaceImpl01改成AInterfaceImpl02就能改注入实例</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="keyword">lateinit</span> <span class="keyword">var</span> aInterface: AInterface</span><br></pre></td></tr></table></figure>



<p>还一个优势是子组件StudentComponent也可以用来处理注入</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subcomponent(modules = [StudentModule::class])</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">StudentComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Subcomponent</span>.Factory</span><br><span class="line">    <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">create</span><span class="params">()</span></span>: StudentComponent</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity3</span>)</span></span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(activity: <span class="type">DaggerSecondActivity4</span>)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AInterfaceImpl01</span> : <span class="type">AInterface</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AInterfaceImpl02</span> : <span class="type">AInterface</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">TestModule</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Binds</span></span><br><span class="line">    <span class="keyword">abstract</span> <span class="function"><span class="keyword">fun</span> <span class="title">bindAInterface</span><span class="params">(impl: <span class="type">AInterfaceImpl01</span>)</span></span>: AInterface <span class="comment">// AInterfaceImpl01改成AInterfaceImpl02就能改注入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="meta">@Provides</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">provideAInterfaceImpl01</span><span class="params">()</span></span>: AInterfaceImpl01 &#123;</span><br><span class="line">            <span class="keyword">return</span> AInterfaceImpl01()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@JvmStatic</span></span><br><span class="line">        <span class="meta">@Provides</span></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">provideAInterfaceImpl02</span><span class="params">()</span></span>: AInterfaceImpl02 &#123;</span><br><span class="line">            <span class="keyword">return</span> AInterfaceImpl02()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyScope</span> <span class="comment">// 设置作用域和ApplicationComponent组件的生命周期一致</span></span><br><span class="line"><span class="meta">@Component(modules = [SubComponentModule::class,TestModule::class])</span> <span class="comment">//模块装载到组件上去</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ApplicationComponent3</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">inject</span><span class="params">(daggerActivity: <span class="type">DaggerUserActivity</span>)</span></span> <span class="comment">//指定目标类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">studentComponent</span><span class="params">()</span></span>:StudentComponent.Factory</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerSecondActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> student: Student</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> aInterface: AInterface</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line"></span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(<span class="keyword">this</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;student: <span class="variable">$student</span> &quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;aInterface: <span class="variable">$aInterface</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="相同类创建不同的对象"><a href="#相同类创建不同的对象" class="headerlink" title="相同类创建不同的对象"></a>相同类创建不同的对象</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student1&quot;</span>)</span> <span class="comment">//  @Named 是Qualifier的实现</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student2&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent2</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student(<span class="string">&quot;John&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerSecondActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student1&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> student1: Student</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student2&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> student2: Student</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line"></span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier1: <span class="variable">$StudentQualifier1</span> &quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier2: <span class="variable">$StudentQualifier2</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>也可以自定义标识,注解标识，通过标识找到对象</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Qualifier</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> StudentQualifier1 &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StudentModule</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent1</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student1&quot;</span>)</span> <span class="comment">//  @Named 是Qualifier的实现</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Named(<span class="meta-string">&quot;student2&quot;</span>)</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideStudent2</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student(<span class="string">&quot;John&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier1</span> <span class="comment">//  @Named 是Qualifier的实现</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideQualifierStudent</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier2</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">provideQualifierStudent2</span><span class="params">()</span></span>: Student &#123;</span><br><span class="line">        <span class="keyword">return</span> Student(<span class="string">&quot;Qualifier2 John&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DaggerSecondActivity4</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">var</span> TAG = javaClass.simpleName</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier1</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> StudentQualifier1: Student</span><br><span class="line"></span><br><span class="line">    <span class="meta">@StudentQualifier2</span></span><br><span class="line">    <span class="meta">@Inject</span></span><br><span class="line">    <span class="keyword">lateinit</span> <span class="keyword">var</span> StudentQualifier2: Student</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_second2)</span><br><span class="line">        DaggerApplicationComponent3.create().studentComponent().create().inject(<span class="keyword">this</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier1: <span class="variable">$StudentQualifier1</span> &quot;</span>)</span><br><span class="line">        Log.i(TAG, <span class="string">&quot;StudentQualifier2: <span class="variable">$StudentQualifier2</span> &quot;</span>)</span><br><span class="line"></span><br><span class="line">        Log.i(TAG, <span class="string">&quot;aInterface: <span class="variable">$aInterface</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/4/">Previous</a></div><div class="pagination-next"><a href="/page/6/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/4/">4</a></li><li><a class="pagination-link is-current" href="/page/5/">5</a></li><li><a class="pagination-link" href="/page/6/">6</a></li><li><span class="pagination-ellipsis">&hellip;</span></li><li><a class="pagination-link" href="/page/23/">23</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Your name"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Your name</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Your location</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">221</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">18</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">31</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/ANDROID/"><span class="level-start"><span class="level-item">ANDROID</span></span><span class="level-end"><span class="level-item tag">58</span></span></a></li><li><a class="level is-mobile" href="/categories/BLE/"><span class="level-start"><span class="level-item">BLE</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/DataStructure/"><span class="level-start"><span class="level-item">DataStructure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/DesignPatterns/"><span class="level-start"><span class="level-item">DesignPatterns</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/categories/ENGLISH/"><span class="level-start"><span class="level-item">ENGLISH</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/JAVA/"><span class="level-start"><span class="level-item">JAVA</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile" href="/categories/Jetpack/"><span class="level-start"><span class="level-item">Jetpack</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/LINUX/"><span class="level-start"><span class="level-item">LINUX</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Mathematics/"><span class="level-start"><span class="level-item">Mathematics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Organization/"><span class="level-start"><span class="level-item">Organization</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/SOURCE/"><span class="level-start"><span class="level-item">SOURCE</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/TEST/"><span class="level-start"><span class="level-item">TEST</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/TOOL/"><span class="level-start"><span class="level-item">TOOL</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/VIEW/"><span class="level-start"><span class="level-item">VIEW</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/anim/"><span class="level-start"><span class="level-item">anim</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/flutter/"><span class="level-start"><span class="level-item">flutter</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-10-21T15:18:58.000Z">2023-10-21</time></p><p class="title"><a href="/2023/10/21/proxy/">proxy</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-09-04T07:54:57.000Z">2023-09-04</time></p><p class="title"><a href="/2023/09/04/Android_interview%20organize/">Android_itnerview_organize</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-09-03T07:54:57.000Z">2023-09-03</time></p><p class="title"><a href="/2023/09/03/Android-itnerview-algorithm/">Android_itnerview_algorithm</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-20T13:41:06.000Z">2023-08-20</time></p><p class="title"><a href="/2023/08/20/compose-layout/">compose_layout</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2023-08-19T09:16:56.000Z">2023-08-19</time></p><p class="title"><a href="/2023/08/19/compose/">compose</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2023/"><span class="level-start"><span class="level-item">2023</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/"><span class="level-start"><span class="level-item">2022</span></span><span class="level-end"><span class="level-item tag">33</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/"><span class="level-start"><span class="level-item">2021</span></span><span class="level-end"><span class="level-item tag">23</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/"><span class="level-start"><span class="level-item">2020</span></span><span class="level-end"><span class="level-item tag">46</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/"><span class="level-start"><span class="level-item">2019</span></span><span class="level-end"><span class="level-item tag">21</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/"><span class="level-start"><span class="level-item">2018</span></span><span class="level-end"><span class="level-item tag">32</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/"><span class="level-start"><span class="level-item">2017</span></span><span class="level-end"><span class="level-item tag">57</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ANDROID/"><span class="tag">ANDROID</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AOSP/"><span class="tag">AOSP</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Activity/"><span class="tag">Activity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AndroidNewFeatures/"><span class="tag">AndroidNewFeatures</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BLOG/"><span class="tag">BLOG</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ConstraintLayout/"><span class="tag">ConstraintLayout</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DB/"><span class="tag">DB</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Drawer/"><span class="tag">Drawer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fragment/"><span class="tag">Fragment</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEETCODE/"><span class="tag">LEETCODE</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operators/"><span class="tag">Operators</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Performance/"><span class="tag">Performance</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RecyclerView/"><span class="tag">RecyclerView</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RxJava/"><span class="tag">RxJava</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/THINK/"><span class="tag">THINK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TOOL/"><span class="tag">TOOL</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TabLayout/"><span class="tag">TabLayout</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Test/"><span class="tag">Test</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TouchEvent/"><span class="tag">TouchEvent</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VIEW/"><span class="tag">VIEW</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XML/"><span class="tag">XML</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/anim/"><span class="tag">anim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compose/"><span class="tag">compose</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/concurrency/"><span class="tag">concurrency</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/coroutie/"><span class="tag">coroutie</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inter/"><span class="tag">inter</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/keyboard/"><span class="tag">keyboard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proguard/"><span class="tag">proguard</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Hexo" height="28"></a><p class="is-size-7"><span>&copy; 2023 John Doe</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>