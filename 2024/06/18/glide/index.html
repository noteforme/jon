<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Glide - Jon&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Jon&#039;s Blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Jon&#039;s Blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Table of Contents  Toggle- Question  Glide Flow sequenceDiagram Status.WAITING_FOR_SIZE   Bind lifecycle Old lifecycle architecture new lifecycle architecture Advantages of the New Approach LifeCycle"><meta property="og:type" content="blog"><meta property="og:title" content="Glide"><meta property="og:url" content="https://noteforme.github.io/2024/06/18/glide/"><meta property="og:site_name" content="Jon&#039;s Blog"><meta property="og:description" content="Table of Contents  Toggle- Question  Glide Flow sequenceDiagram Status.WAITING_FOR_SIZE   Bind lifecycle Old lifecycle architecture new lifecycle architecture Advantages of the New Approach LifeCycle"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.51_glideflow.png"><meta property="og:image" content="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.52_lifecycle.png"><meta property="og:image" content="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/glide/Screenshot%202024-06-19%20at%2009.58.55.png"><meta property="og:image" content="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.4_lrucache.png"><meta property="og:image" content="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Retrofit/20240618162126.jpg"><meta property="article:published_time" content="2024-06-18T05:50:06.000Z"><meta property="article:modified_time" content="2024-09-13T21:02:22.000Z"><meta property="article:author" content="Jon"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.51_glideflow.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://noteforme.github.io/2024/06/18/glide/"},"headline":"Glide","image":["https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.51_glideflow.png","https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.52_lifecycle.png","https://raw.githubusercontent.com/BlogForMe/ImageServer/main/glide/Screenshot%202024-06-19%20at%2009.58.55.png","https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.4_lrucache.png","https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Retrofit/20240618162126.jpg"],"datePublished":"2024-06-18T05:50:06.000Z","dateModified":"2024-09-13T21:02:22.000Z","author":{"@type":"Person","name":"Jon"},"publisher":{"@type":"Organization","name":"Jon's Blog","logo":{"@type":"ImageObject","url":"https://noteforme.github.io/img/logo.svg"}},"description":"Table of Contents  Toggle- Question  Glide Flow sequenceDiagram Status.WAITING_FOR_SIZE   Bind lifecycle Old lifecycle architecture new lifecycle architecture Advantages of the New Approach LifeCycle"}</script><link rel="canonical" href="https://noteforme.github.io/2024/06/18/glide/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="Jon&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-06-18T05:50:06.000Z" title="6/18/2024, 1:50:06 PM">2024-06-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-09-13T21:02:22.000Z" title="9/14/2024, 5:02:22 AM">2024-09-14</time></span><span class="level-item"> Jon </span><span class="level-item"><a class="link-muted" href="/categories/Library/">Library</a></span><span class="level-item">21 minutes read (About 3092 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Glide</h1><div class="content"><div class="ez-toc-v2_0_66_1 ez-toc-wrap-right counter-hierarchy ez-toc-counter ez-toc-grey ez-toc-container-direction" id="ez-toc-container"><div class="ez-toc-title-container">Table of Contents

<p><span class="ez-toc-title-toggle"><a href="#"><span class="ez-toc-js-icon-con"><span class><span class="eztoc-hide" style="display:none;">Toggle</span><span class="ez-toc-icon-toggle-span"><svg class="list-377408" fill="none" height="20px" style="fill: #999;color:#999" viewbox="0 0 24 24" width="20px" xmlns="http://www.w3.org/2000/svg"><path d="M6 6H4v2h2V6zm14 0H8v2h12V6zM4 11h2v2H4v-2zm16 0H8v2h12v-2zM4 16h2v2H4v-2zm16 0H8v2h12v-2z" fill="currentColor"/></svg><svg baseprofile="tiny" class="arrow-unsorted-368013" height="10px" style="fill: #999;color:#999" version="1.2" viewbox="0 0 24 24" width="10px" xmlns="http://www.w3.org/2000/svg"><path d="M18.2 9.3l-6.2-6.3-6.2 6.3c-.2.2-.3.4-.3.7s.1.5.3.7c.2.2.4.3.7.3h11c.3 0 .5-.1.7-.3.2-.2.3-.5.3-.7s-.1-.5-.3-.7zM5.8 14.7l6.2 6.3 6.2-6.3c.2-.2.3-.5.3-.7s-.1-.5-.3-.7c-.2-.2-.4-.3-.7-.3h-11c-.3 0-.5.1-.7.3-.2.2-.3.5-.3.7s.1.5.3.7z"/></svg></span></span></span></a></span></p></div><nav>- <a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Question" title="Question">Question</a><p></p>
<ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Glide_Flow" title="Glide Flow">Glide Flow</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#sequenceDiagram_StatusWAITING_FOR_SIZE" title="sequenceDiagram   Status.WAITING_FOR_SIZE">sequenceDiagram Status.WAITING_FOR_SIZE</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Bind_lifecycle" title="Bind lifecycle">Bind lifecycle</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Old_lifecycle_architecture" title="Old lifecycle architecture">Old lifecycle architecture</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#new_lifecycle_architecture" title="new lifecycle architecture">new lifecycle architecture</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Advantages_of_the_New_Approach" title="Advantages of the New Approach">Advantages of the New Approach</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#LifeCycle_flow_UML" title="LifeCycle flow UML">LifeCycle flow UML</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#connective_lifecycle_UML" title="connective lifecycle UML">connective lifecycle UML</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Glide_caching_strategy" title="Glide caching strategy">Glide caching strategy</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Concept" title="Concept">Concept</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Cache_Levels" title="Cache Levels">Cache Levels</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Caching_Keys" title="Caching Keys">Caching Keys</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Image_Requests" title="Image Requests">Image Requests</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Cache_Invalidation" title="Cache Invalidation">Cache Invalidation</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Disk_Cache" title="Disk Cache">Disk Cache</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#KEY" title="KEY">KEY</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Identifying_an_Object" title="Identifying an Object">Identifying an Object</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Example_Implementation" title="Example Implementation">Example Implementation</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Key_Points" title="Key Points">Key Points</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#equal_objects_cannot_have_different_hash_codes" title="equal objects cannot have different hash codes">equal objects cannot have different hash codes</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Key_Points-2" title="Key Points">Key Points</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Active_recyle" title="Active recyle">Active recyle</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#LruCache" title="LruCache">LruCache</a><ul>
<li><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#How_Glide_Uses_LruCache" title="How Glide Uses LruCache">How Glide Uses LruCache</a></li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Bitmap_Reuse" title="Bitmap Reuse">Bitmap Reuse</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#botain_bitmap" title="botain bitmap">botain bitmap</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#save_bitmap" title="save bitmap">save bitmap</a><ul>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#bitmap_save_condition" title="bitmap save condition">bitmap save condition</a></li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#decoded_VS_without_decode" title="decoded VS without decode">decoded VS without decode</a><br>- <a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Decoded_Cache" title="Decoded Cache">Decoded Cache</a><br>- <a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#Without_Decode_Encoded_Cache" title="Without Decode (Encoded Cache)">Without Decode (Encoded Cache)</a></li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://jonblog.site/2024/06/18/glide/#BUILD_PROJECT" title="BUILD PROJECT">BUILD PROJECT</a></li>
</ul>
</nav></div># <span class="ez-toc-section" id="Question"></span>Question<span class="ez-toc-section-end"></span>

<p>This article has many <strong>flowcharts</strong> to introduce the principles<br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/ZjKkTJ5GpP8e2BnttiJEiA">https://mp.weixin.qq.com/s/ZjKkTJ5GpP8e2BnttiJEiA</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6882536990400020494">https://juejin.cn/post/6882536990400020494</a></p>
<p>Glide使用什么缓存机制<br>LRUcache底层实现</p>
<p>glide和OkHttp的任务调度是怎么实现的（比如同时发起很多请求）<br>自己去实现图片库，怎么做？<br>Glide内存缓存如何控制大小？</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6956090846470995975">https://juejin.cn/post/6956090846470995975</a></p>
<p>bitmap decode<br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904161327185927">https://juejin.cn/post/6844904161327185927</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6994669144490639368#heading-4">https://juejin.cn/post/6994669144490639368#heading-4</a></p>
<h1 id="Glide-Flow"><a href="#Glide-Flow" class="headerlink" title="Glide Flow"></a><span class="ez-toc-section" id="Glide_Flow"></span>Glide Flow<span class="ez-toc-section-end"></span></h1><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/oSXDYhc_t4xhAVCfADxXfg">https://mp.weixin.qq.com/s/oSXDYhc_t4xhAVCfADxXfg</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7083367492810686472">https://juejin.cn/post/7083367492810686472</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43298955/article/details/118661784">https://blog.csdn.net/weixin_43298955&#x2F;article&#x2F;details&#x2F;118661784</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gq4y1n7wq?p=4">https://www.bilibili.com/video/BV1gq4y1n7wq?p=4</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/48d9e4d5d75d">https://www.jianshu.com/p/48d9e4d5d75d</a></p>
<p><img src="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.51_glideflow.png"></p>
<p>According to this picture, the image acquisition process is first from Active Resource, then from Memory cache, and then from Disk cache.</p>
<h2 id="sequenceDiagram-Status-WAITING-FOR-SIZE"><a href="#sequenceDiagram-Status-WAITING-FOR-SIZE" class="headerlink" title="sequenceDiagram Status.WAITING_FOR_SIZE"></a><span class="ez-toc-section" id="sequenceDiagram_StatusWAITING_FOR_SIZE"></span>sequenceDiagram Status.WAITING_FOR_SIZE<span class="ez-toc-section-end"></span></h2><p>Loading an image flow for the first time from the network</p>
<div class="mermaid">
  sequenceDiagram
  RequestBuilder ->> RequestManager : track()
  RequestBuilder ->> RequestTracker : runRequest()
  RequestBuilder ->> SingleRequest : begin()
alt status.WAITING_FOR_SIZE
  SingleRequest ->> SingleRequest : onSizeReady()
  SingleRequest ->> Engine : load()

 alt  no memoryResource 
  Engine ->> Engine : waitForExistingOrStartNewJob()
  Engine ->> Engine : build()
  Engine ->> DecodeJob : run()
  DecodeJob ->> DecodeJob : runWrapped() INITIALIZE
  DecodeJob ->> DecodeJob : getNextStage(INITIALIZE) 
  DecodeJob ->> DecodeJob : getNextGenerator(),runGenerators()
  DecodeJob ->> ResourceCacheGenerator : startNext()
  loop stage == Stage.SOURCE
  DecodeJob ->> DecodeJob :  reschedule(SWITCH_TO_SOURCE_SERVICE)
  end
  DecodeJob ->> DecodeJob : run()
  DecodeJob ->> DecodeJob : runWrapped(),runGenerators()
  DecodeJob ->> SourceGenerator : startNext()
  SourceGenerator ->> SourceGenerator : startNextLoad(loadData)
  SourceGenerator ->> MultiModelLoader : loadData(loadData)
  MultiModelLoader ->> HttpUrlFetcher : loadData(loadData)
  HttpUrlFetcher -->> MultiModelLoader :  callback.onDataReady(data)
  MultiModelLoader -->> SourceGenerator :  callback.onDataReady(data)
  SourceGenerator -->> SourceGenerator :  onDataReadyInternal()
  SourceGenerator -->> DecodeJob :  reschedule(SWITCH_TO_SOURCE_SERVICE)
  DecodeJob ->> DecodeJob : run()
  DecodeJob ->> DecodeJob : runWrapped(),runGenerators()
  DecodeJob ->> DecodeJob : startNext()
  DecodeJob ->> SourceGenerator : startNext()
  SourceGenerator ->> SourceGenerator : startNextLoad(loadData)

  SourceGenerator ->> DataCacheGenerator : sourceCacheGenerator.startNext()
  DataCacheGenerator ->> ByteBufferFileLoader : loadData(helper.getPriority(), this)
  ByteBufferFileLoader -->> DataCacheGenerator : onDataReady(result)
  DataCacheGenerator -->> SourceGenerator : onDataFetcherReady()
  SourceGenerator -->> DecodeJob : onDataFetcherReady()
  DecodeJob ->> DecodeJob : decodeFromRetrievedData()
  DecodeJob ->> DecodeJob : decodeFromData(),notifyEncodeAndRelease()
  DecodeJob ->> DecodeJob : notifyComplete()
  DecodeJob ->> EngineJob : onResourceReady(),notifyCallbacksOfResult()
  EngineJob ->> CallResourceReady : run(),notifyCallbacksOfResult(cb)
  CallResourceReady -->> EngineJob : callCallbackOnResourceReady(cb)
  EngineJob -->> SingleRequest : onResourceReady(cb)
  SingleRequest ->> ImageViewTarget : target.onResourceReady(result)
  ImageViewTarget ->> ImageViewTarget : setResourceInternal()
  ImageViewTarget ->> DrawableImageViewTarget : setResource()
 end
end
</div>


<p>What should be noted here is that I looked at the source code. After getting the image from the Internet, it will not go directly to the active resource, nor will it be displayed directly on the ImageView. Instead, <strong>it will be saved to the disk and then read from the disk</strong>. I saw this</p>
<h1 id="Bind-lifecycle"><a href="#Bind-lifecycle" class="headerlink" title="Bind lifecycle"></a><span class="ez-toc-section" id="Bind_lifecycle"></span>Bind lifecycle<span class="ez-toc-section-end"></span></h1><h2 id="Old-lifecycle-architecture"><a href="#Old-lifecycle-architecture" class="headerlink" title="Old lifecycle architecture"></a><span class="ez-toc-section" id="Old_lifecycle_architecture"></span>Old lifecycle architecture<span class="ez-toc-section-end"></span></h2><p><img src="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.52_lifecycle.png"></p>
<h2 id="new-lifecycle-architecture"><a href="#new-lifecycle-architecture" class="headerlink" title="new lifecycle architecture"></a><span class="ez-toc-section" id="new_lifecycle_architecture"></span>new lifecycle architecture<span class="ez-toc-section-end"></span></h2><p>The Glide library for Android indeed underwent significant changes in its architecture. As of Glide version 4.x, Glide has moved away from using <del>RequestManagerFragment</del> for lifecycle management. Instead, Glide now uses <strong>LifecycleListener</strong> interfaces and <strong>RequestManagerRetriever</strong> to more efficiently manage the lifecycle of requests.</p>
<p>Here is a brief overview of the changes:</p>
<p>Glide 4.x and Lifecycle Management</p>
<ol>
<li>Lifecycle Integration:<br>  Glide now directly integrates with Android’s lifecycle components (Activity, Fragment, Application), which simplifies the lifecycle management of requests. Glide automatically pauses and resumes requests based on the lifecycle events.</li>
<li>LifecycleListeners:<br>  Glide uses LifecycleListener interfaces to handle lifecycle events. These listeners are registered with the Android components (Activities and Fragments), and they notify Glide when to start, stop, or recycle requests.</li>
</ol>
<h2 id="Advantages-of-the-New-Approach"><a href="#Advantages-of-the-New-Approach" class="headerlink" title="Advantages of the New Approach"></a><span class="ez-toc-section" id="Advantages_of_the_New_Approach"></span>Advantages of the New Approach<span class="ez-toc-section-end"></span></h2><ul>
<li>Improved Lifecycle Handling: Glide now more accurately handles the lifecycle of requests, reducing the chances of memory leaks or unnecessary work.</li>
<li>Simplified API: The new API is more intuitive and easier to use, thanks to the integration with Android’s lifecycle components.</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Qy4y1s7Gh?p=15">https://www.bilibili.com/video/BV1Qy4y1s7Gh?p=15</a></p>
<h2 id="LifeCycle-flow-UML"><a href="#LifeCycle-flow-UML" class="headerlink" title="LifeCycle flow UML"></a><span class="ez-toc-section" id="LifeCycle_flow_UML"></span>LifeCycle flow UML<span class="ez-toc-section-end"></span></h2><div class="mermaid">
  sequenceDiagram
autonumber
Glide ->> RequestManagerRetriever : get(FragmentActivity)
RequestManagerRetriever ->> LifecycleRequestManagerRetriever : getOrCreate(getLifecycle())

LifecycleRequestManagerRetriever ->> LifecycleLifecycle:  constructor(lifecycle)
LifecycleLifecycle ->> LifecycleRegistry : lifecycle.addObserver(this)

LifecycleRequestManagerRetriever ->> RequestManager : build(getLifecycle)
RequestManager ->> DefaultConnectivityMonitor : ConnectivityMonitor
Note over RequestManager , DefaultConnectivityMonitor : network connection monitor

LifecycleRegistry -->> LifecycleLifecycle : onStart()
LifecycleRegistry -->> LifecycleLifecycle : onStop()
LifecycleRegistry -->> LifecycleLifecycle : onDestroy()
LifecycleLifecycle ->> RequestManager :  onStart()
Note right of RequestManager : resumeRequests()
LifecycleLifecycle ->> RequestManager :  onStop()
Note right of RequestManager : pauseRequests()
LifecycleLifecycle ->> RequestManager :  onDestroy()
</div>


<h2 id="connective-lifecycle-UML"><a href="#connective-lifecycle-UML" class="headerlink" title="connective lifecycle UML"></a><span class="ez-toc-section" id="connective_lifecycle_UML"></span>connective lifecycle UML<span class="ez-toc-section-end"></span></h2><div class="mermaid">
  classDiagram
%% Creator
  class ConnectivityMonitorFactory {
    + someOperation()
    + factoryMethod(): ConnectivityMonitor
  }

%% concreate factory
  class DefaultConnectivityMonitorFactory {
    +createProduct(): Product
  }

  class ConnectivityMonitor {
     interface
    +operation(): void
  }

%% concreate product
  class DefaultConnectivityMonitor 

%% concreate product
  class NullConnectivityMonitor 

  ConnectivityMonitor <|-- defaultconnectivitymonitor : inheritance connectivitymonitor <|-- nullconnectivitymonitor connectivitymonitorfactory <|.. defaultconnectivitymonitorfactory realization ..> ConnectivityMonitor
</|--></div>


<h1 id="Glide-caching-strategy"><a href="#Glide-caching-strategy" class="headerlink" title="Glide caching strategy"></a><span class="ez-toc-section" id="Glide_caching_strategy"></span>Glide caching strategy<span class="ez-toc-section-end"></span></h1><p>Glide使用什么缓存机制<br>LRUcache底层实现</p>
<p><img src="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/glide/Screenshot%202024-06-19%20at%2009.58.55.png"></p>
<h2 id="Concept"><a href="#Concept" class="headerlink" title="Concept"></a><span class="ez-toc-section" id="Concept"></span>Concept<span class="ez-toc-section-end"></span></h2><h3 id="Cache-Levels"><a href="#Cache-Levels" class="headerlink" title="Cache Levels"></a><span class="ez-toc-section" id="Cache_Levels"></span>Cache Levels<span class="ez-toc-section-end"></span></h3><ul>
<li><strong>Active Resources</strong>: These are images currently being displayed. They are kept in memory for immediate access.</li>
<li><strong>Memory Cache</strong>: Once images are no longer in the active resources, they move to the memory cache if there is enough space.</li>
<li><strong>Disk Cache</strong> : If images are no longer in the memory cache, they are still stored in the disk cache. This allows for retrieval without needing to download the image again.</li>
</ul>
<h3 id="Caching-Keys"><a href="#Caching-Keys" class="headerlink" title="Caching Keys"></a><span class="ez-toc-section" id="Caching_Keys"></span>Caching Keys<span class="ez-toc-section-end"></span></h3><ul>
<li>Glide generates unique keys for caching images. These keys are based on the image URL and any transformation or resizing options applied to the image.</li>
<li>Custom keys can be provided by the developer to manage cache more effectively, especially when dealing with dynamic content.</li>
</ul>
<h3 id="Image-Requests"><a href="#Image-Requests" class="headerlink" title="Image Requests"></a><span class="ez-toc-section" id="Image_Requests"></span>Image Requests<span class="ez-toc-section-end"></span></h3><ul>
<li>When a request for an image is made, Glide first checks the active resources, then the memory cache, and finally the disk cache.</li>
<li>If the image is not found in any of these caches, it is fetched from the network or local storage.</li>
</ul>
<h3 id="Cache-Invalidation"><a href="#Cache-Invalidation" class="headerlink" title="Cache Invalidation"></a><span class="ez-toc-section" id="Cache_Invalidation"></span>Cache Invalidation<span class="ez-toc-section-end"></span></h3><ul>
<li>Cache invalidation is necessary to ensure outdated images are not served. Glide allows developers to clear specific entries or entire caches.</li>
<li>It supports automatic cache invalidation based on configurable time intervals.</li>
<li>If the image does not exist in the memory cache, it is read from the disk cache and then placed into the active resources.</li>
<li>If the image does not exist in the memory cache, it will be requested from the network. and then what ???</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dba296118f35">https://www.jianshu.com/p/dba296118f35</a><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mT4y1R7F4/?p=37">https://www.bilibili.com/video/BV1mT4y1R7F4/?p=37</a></p>
<h2 id="Disk-Cache"><a href="#Disk-Cache" class="headerlink" title="Disk Cache"></a><span class="ez-toc-section" id="Disk_Cache"></span>Disk Cache<span class="ez-toc-section-end"></span></h2><div class="mermaid">
  sequenceDiagram
  autonumber
  RequestBuilder ->> RequestBuilder : into()
  RequestBuilder ->> RequestManager : track()
  RequestBuilder ->> RequestTracker : runRequest()
  RequestTracker ->> SingleRequest : begin()
  SingleRequest ->> SingleRequest : onSizeReady(overrideWidth, overrideHeight)
  SingleRequest ->> Engine : load()
  Engine ->> Engine : loadFromMemory()
  Engine ->> Engine : loadFromActiveResources(key) 
  Note right of Engine : Active Resource
  Engine ->> Engine : loadFromCache(key)
  Note right of Engine : Memory Cache
  Engine ->> DecodeJob : runWrapped(),runGenerators()
  Engine ->> DataCacheGenerator : currentGenerator.startNext()
  DataCacheGenerator ->> ByteBufferFileLoader : loadData(helper.getPriority(), this)
  ByteBufferFileLoader -->> DataCacheGenerator : onDataReady(result)
  DataCacheGenerator -->> SourceGenerator : onDataFetcherReady()
  SourceGenerator -->> DecodeJob : onDataFetcherReady()
  DecodeJob ->> DecodeJob : decodeFromRetrievedData()
  DecodeJob ->> DecodeJob : decodeFromData(),notifyEncodeAndRelease()
  DecodeJob ->> DecodeJob : notifyComplete()
  DecodeJob ->> EngineJob : onResourceReady(),notifyCallbacksOfResult()
  EngineJob -->> Engine : onEngineJobComplete()
  Note right of Engine : activeResources.activate()

  EngineJob ->> CallResourceReady : run(),notifyCallbacksOfResult(cb)
  CallResourceReady -->> EngineJob : callCallbackOnResourceReady(cb)
  EngineJob -->> SingleRequest : onResourceReady(cb)
  SingleRequest ->> ImageViewTarget : target.onResourceReady(result)
  ImageViewTarget ->> ImageViewTarget : setResourceInternal()
  ImageViewTarget ->> DrawableImageViewTarget : setResource()
</div>


<p>step8 : get Active Resources<br>step9 : get Memery Cache<br>step20 : Read from disk cache and then put into active resources.</p>
<h1 id="KEY"><a href="#KEY" class="headerlink" title="KEY"></a><span class="ez-toc-section" id="KEY"></span>KEY<span class="ez-toc-section-end"></span></h1><p>In Java, the equals and hashCode methods are used to compare objects and manage how objects are stored in certain collections like HashMap and HashSet.</p>
<ul>
<li>equals Method<br>The equals method determines whether two objects are equal. By default, the equals method in the Object class compares the memory addresses of the objects (i.e., whether they are the same instance). However, it is common to override this method to provide a meaningful equality check based on the object’s state (i.e., its fields).</li>
<li>hashCode Method<br>The hashCode method returns an integer hash code representation of the object. The contract between equals and hashCode is that if two objects are equal according to the equals method, they must have the same hash code. However, two objects with the same hash code do not necessarily have to be equal.</li>
</ul>
<h2 id="Identifying-an-Object"><a href="#Identifying-an-Object" class="headerlink" title="Identifying an Object"></a><span class="ez-toc-section" id="Identifying_an_Object"></span>Identifying an Object<span class="ez-toc-section-end"></span></h2><p>When you override the equals and hashCode methods properly, they can be used to uniquely identify an object in certain collections. Here’s how:</p>
<ol>
<li>Equality Check: When you use collections like HashSet or keys in HashMap, the equals method is used to check if an object already exists in the collection.</li>
<li>Hash Code: The hashCode method is used by hash-based collections (like HashMap and HashSet) to efficiently locate a bucket in which the object might be stored. Proper implementation of hashCode ensures that objects are distributed evenly across the buckets, reducing the number of collisions and improving performance.</li>
</ol>
<h2 id="Example-Implementation"><a href="#Example-Implementation" class="headerlink" title="Example Implementation"></a><span class="ez-toc-section" id="Example_Implementation"></span>Example Implementation<span class="ez-toc-section-end"></span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Constructor, getters, and setters</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object obj)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == obj) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (obj == <span class="literal">null</span> || getClass() != obj.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> (Person) obj;</span><br><span class="line">        <span class="keyword">return</span> age == person.age &amp;&amp; Objects.equals(name, person.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(name, age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Key-Points"><a href="#Key-Points" class="headerlink" title="Key Points"></a><span class="ez-toc-section" id="Key_Points"></span>Key Points<span class="ez-toc-section-end"></span></h2><ol>
<li>Consistency: Ensure that equals and hashCode are consistent. If equals returns true for two objects, hashCode must return the same value for both.</li>
<li>Non-Equal Objects: It is acceptable for non-equal objects to have the same hash code, though this can degrade the performance of hash-based collections.</li>
</ol>
<h3 id="equal-objects-cannot-have-different-hash-codes"><a href="#equal-objects-cannot-have-different-hash-codes" class="headerlink" title="equal objects cannot have different hash codes"></a><span class="ez-toc-section" id="equal_objects_cannot_have_different_hash_codes"></span>equal objects cannot have different hash codes<span class="ez-toc-section-end"></span></h3><ol>
<li>Consistent with equals: If two objects are equal according to the equals method, they must have the same hash code.</li>
<li>Self-Consistency: If an object is compared to itself, the equals method must return true, and the hashCode method must consistently return the same integer, provided no information used in equals comparisons on the object is modified.</li>
<li>Non-Equal Objects: If two objects are not equal according to the equals method, it is not required that they have different hash codes. However, different hash codes for non-equal objects can improve the performance of hash-based collections.</li>
</ol>
<p>  if two Person objects have the same name and age, they are considered equal. Consequently, their hash codes will also be the same because the hashCode method uses these fields to compute the hash code.</p>
<h3 id="Key-Points-1"><a href="#Key-Points-1" class="headerlink" title="Key Points"></a><span class="ez-toc-section" id="Key_Points-2"></span>Key Points<span class="ez-toc-section-end"></span></h3><ul>
<li>Consistency Requirement: Equal objects must have the same hash code to ensure that hash-based collections (like HashMap and HashSet) function correctly.</li>
<li>Implementation: The hashCode method should use the same fields that are used in the equals method to ensure consistency.</li>
<li>Efficiency: While it is not required for unequal objects to have different hash codes, it is beneficial for the performance of hash-based collections.</li>
</ul>
<p>Violating this contract by allowing equal objects to have different hash codes can lead to unexpected behavior in collections like HashMap and HashSet, resulting in problems such as missing entries or increased lookup times.</p>
<h2 id="Active-recyle"><a href="#Active-recyle" class="headerlink" title="Active recyle"></a><span class="ez-toc-section" id="Active_recyle"></span>Active recyle<span class="ez-toc-section-end"></span></h2><p>After onDestroy() or recycling the bitmap, the active resource is put into memory cache.</p>
<p>ActiveResources.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">void</span> <span class="title function_">cleanupActiveReference</span><span class="params">(<span class="meta">@NonNull</span> ResourceWeakReference ref)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">      activeEngineResources.remove(ref.key);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!ref.isCacheable || ref.resource == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    EngineResource&lt;?&gt; newResource =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">EngineResource</span>&lt;&gt;(</span><br><span class="line">            ref.resource,</span><br><span class="line">            <span class="comment">/* isMemoryCacheable= */</span> <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">/* isRecyclable= */</span> <span class="literal">false</span>,</span><br><span class="line">            ref.key,</span><br><span class="line">            listener);</span><br><span class="line">    listener.onResourceReleased(ref.key, newResource); <span class="comment">// 这里存储进内存缓存</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">Engine.java</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onResourceReleased</span><span class="params">(Key cacheKey, EngineResource&lt;?&gt; resource)</span> &#123;</span><br><span class="line">    activeResources.deactivate(cacheKey);</span><br><span class="line">    <span class="keyword">if</span> (resource.isMemoryCacheable()) &#123;</span><br><span class="line">      cache.put(cacheKey, resource);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      resourceRecycler.recycle(resource, <span class="comment">/* forceNextFrame= */</span> <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h1 id="LruCache"><a href="#LruCache" class="headerlink" title="LruCache"></a><span class="ez-toc-section" id="LruCache"></span>LruCache<span class="ez-toc-section-end"></span></h1><p><code>LruCache</code> stands for Least Recently Used Cache. It’s a cache mechanism that keeps track of the most recently used items and evicts the least recently used items when the cache reaches its maximum size. This helps in maintaining a balance between memory usage and access speed.</p>
<h3 id="How-Glide-Uses-LruCache"><a href="#How-Glide-Uses-LruCache" class="headerlink" title="How Glide Uses LruCache"></a><span class="ez-toc-section" id="How_Glide_Uses_LruCache"></span>How Glide Uses LruCache<span class="ez-toc-section-end"></span></h3><p>Glide uses <code>LruCache</code> to store decoded images (<code>Bitmap</code> objects) in memory. When an image is requested:</p>
<ol>
<li><strong>Check Cache</strong>: Glide first checks the memory cache for the image.</li>
<li><strong>Load from Cache</strong>: If the image is found in the cache, it is loaded from there, making the process very fast.</li>
<li><strong>Fetch and Decode</strong>: If the image is not in the cache, Glide fetches it from the source (e.g., network, disk), decodes it, and adds it to the cache.</li>
<li></li>
</ol>
<p><img src="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Architecture/2021-08-09_4.4_lrucache.png"></p>
<p>LinkedHashMap参数含义</p>
<p>initialCapacity : 最大容量</p>
<p>loadFactor : 负载因子</p>
<p>accessOrder : 排序方式, true 按照访问顺序排序， false 按照插入顺序排序</p>
<p>访问顺序排序</p>
<p>accessOrder : true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;(<span class="number">0</span>, <span class="number">0.75f</span>, <span class="literal">true</span>);</span><br><span class="line">map.put(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;A&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;B&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;c&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;d&quot;</span>, <span class="string">&quot;D&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;e&quot;</span>, <span class="string">&quot;E&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;f&quot;</span>, <span class="string">&quot;F&quot;</span>);</span><br><span class="line"></span><br><span class="line">map.get(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">map.put(<span class="string">&quot;n&quot;</span>,<span class="string">&quot;N&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    Log.d(<span class="string">&quot;LruCacheTest&quot;</span>, <span class="string">&quot;testLinkedHashMap : &quot;</span>+ entry.getKey()+<span class="string">&quot; : &quot;</span> + entry.getValue());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<blockquote>
<p>D LruCacheTest: testLinkedHashMap : b : B<br>D LruCacheTest: testLinkedHashMap : c : C<br>D LruCacheTest: testLinkedHashMap : d : D<br>D LruCacheTest: testLinkedHashMap : e : E<br>D LruCacheTest: testLinkedHashMap : f : F<br>D LruCacheTest: testLinkedHashMap : a : A<br>D LruCacheTest: testLinkedHashMap : n : N</p>
</blockquote>
<p>可以看到 先访问a ,在插入n,把最新最近使用和访问的 A N,放到链表后面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LinkedHashMap&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;(<span class="number">100</span>, <span class="number">0.75f</span>, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>D LruCacheTest: testLinkedHashMap : a : A<br>D LruCacheTest: testLinkedHashMap : b : B<br>D LruCacheTest: testLinkedHashMap : c : C<br>D LruCacheTest: testLinkedHashMap : d : D<br>D LruCacheTest: testLinkedHashMap : e : E<br>D LruCacheTest: testLinkedHashMap : f : F<br>D LruCacheTest: testLinkedHashMap : n : N</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/JakeWharton/DiskLruCache">https://github.com/JakeWharton/DiskLruCache</a></p>
<h1 id="Bitmap-Reuse"><a href="#Bitmap-Reuse" class="headerlink" title="Bitmap Reuse"></a><span class="ez-toc-section" id="Bitmap_Reuse"></span>Bitmap Reuse<span class="ez-toc-section-end"></span></h1><h2 id="botain-bitmap"><a href="#botain-bitmap" class="headerlink" title="botain bitmap"></a><span class="ez-toc-section" id="botain_bitmap"></span>botain bitmap<span class="ez-toc-section-end"></span></h2><div class="mermaid">
  sequenceDiagram
LruBitmapPool ->> LruBitmapPool : get()
LruBitmapPool ->> LruBitmapPool : getDirtyOrNull()
LruBitmapPool ->> SizeStrategy : strategy.get()
Note  right of SizeStrategy : possibleSize <= size * max_size_multiple(8) < div>


<p>LruBitmapPool</p>
<p>此步骤用于查找 entries 中最合适用来复用的 bitmap<br>先找到 sizes 中大于 size 且和 size 最接近的 key，如果 key 存在且其大小不超出 size 的四倍，则使用该 key，否则直接使用 size<br>即找到最接近 size 但又不超出 size 太多的 bitmap，否则如果拿来复用的 bitmap 太大的话也比较浪费</p>
<p>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6956090846470995975">https://juejin.cn/post/6956090846470995975</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7133243966052368392">肢解Glide：LruBitmapPool如何具体操作Bitmap复用？ - 掘金</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">SizeStrategy</span> <span class="keyword">implements</span> <span class="title class_">LruPoolStrategy</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_SIZE_MULTIPLE</span> <span class="operator">=</span> <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> Bitmap <span class="title function_">get</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, Bitmap.Config config)</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> Util.getBitmapByteSize(width, height, config);</span><br><span class="line">    <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> keyPool.get(size);</span><br><span class="line"></span><br><span class="line">    <span class="type">Integer</span> <span class="variable">possibleSize</span> <span class="operator">=</span> sortedSizes.ceilingKey(size);</span><br><span class="line">    <span class="keyword">if</span> (possibleSize != <span class="literal">null</span> &amp;&amp; possibleSize != size &amp;&amp; possibleSize &lt;= size * MAX_SIZE_MULTIPLE) &#123;</span><br><span class="line">      keyPool.offer(key);</span><br><span class="line">      key = keyPool.get(possibleSize);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h2 id="save-bitmap"><a href="#save-bitmap" class="headerlink" title="save bitmap"></a><span class="ez-toc-section" id="save_bitmap"></span>save bitmap<span class="ez-toc-section-end"></span></h2><div class="mermaid">
  sequenceDiagram
BitmapPool ->> LruBitmapPool : put(bitmap)
LruBitmapPool ->> SizeConfigStrategy : strategy.put(bitmap)
SizeConfigStrategy ->> KeyPool : get(size, bitmap.getConfig())
Note  over SizeConfigStrategy, KeyPool : groupedMap.put(key, bitmap);
</div>


<h3 id="bitmap-save-condition"><a href="#bitmap-save-condition" class="headerlink" title="bitmap save condition"></a><span class="ez-toc-section" id="bitmap_save_condition"></span>bitmap save condition<span class="ez-toc-section-end"></span></h3><ul>
<li>is mutable</li>
<li>less than maxSize</li>
<li>allowedConfigs</li>
</ul>
<p>LruBitmapPool.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(Bitmap bitmap)</span> &#123;</span><br><span class="line">   <span class="keyword">if</span> (!bitmap.isMutable()</span><br><span class="line">       || strategy.getSize(bitmap) &gt; maxSize</span><br><span class="line">       || !allowedConfigs.contains(bitmap.getConfig())) &#123;</span><br><span class="line">     bitmap.recycle();</span><br><span class="line">     <span class="keyword">return</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">final</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> strategy.getSize(bitmap);</span><br><span class="line">   strategy.put(bitmap);</span><br><span class="line">   tracker.add(bitmap);</span><br><span class="line"></span><br><span class="line">   puts++;</span><br><span class="line">   currentSize += size;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>SizeConfigStrategy.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Key</span> <span class="keyword">implements</span> <span class="title class_">Poolable</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Key) &#123;</span><br><span class="line">      <span class="type">Key</span> <span class="variable">other</span> <span class="operator">=</span> (Key) o;</span><br><span class="line">      <span class="keyword">return</span> size == other.size &amp;&amp; Util.bothNullOrEqual(config, other.config);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> size;</span><br><span class="line">    result = <span class="number">31</span> * result + (config != <span class="literal">null</span> ? config.hashCode() : <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The key is judged based on bitmap size and Config format.</p>
<h3 id="decoded-VS-without-decode"><a href="#decoded-VS-without-decode" class="headerlink" title="decoded VS without decode"></a><span class="ez-toc-section" id="decoded_VS_without_decode"></span>decoded VS without decode<span class="ez-toc-section-end"></span></h3><p>In the context of using the Glide library in Android for image loading, the terms “decoded cache” and “without decode” refer to different stages and aspects of the image loading process. Here’s a detailed explanation:</p>
<h4 id="Decoded-Cache"><a href="#Decoded-Cache" class="headerlink" title="Decoded Cache"></a><span class="ez-toc-section" id="Decoded_Cache"></span>Decoded Cache<span class="ez-toc-section-end"></span></h4><p><strong>Decoded Cache</strong> refers to the cache that stores images that have already been decoded into <code>Bitmap</code> objects. This means the images are stored in a format that can be directly used by the UI without needing further decoding. The benefits of using the decoded cache include:</p>
<ol>
<li><strong>Faster Loading:</strong> Since the images are already decoded, they can be quickly retrieved and displayed, reducing the load time and improving the user experience.</li>
<li><strong>Reduced CPU Usage:</strong> Decoding an image is a CPU-intensive process. By caching decoded images, you avoid repeatedly decoding the same image, which saves CPU resources.</li>
<li><strong>Efficient Memory Usage:</strong> Decoded images are stored in memory, which allows for quick access, but this also means that the memory usage can be higher, especially if you are caching many large images.</li>
</ol>
<h4 id="Without-Decode-Encoded-Cache"><a href="#Without-Decode-Encoded-Cache" class="headerlink" title="Without Decode (Encoded Cache)"></a><span class="ez-toc-section" id="Without_Decode_Encoded_Cache"></span>Without Decode (Encoded Cache)<span class="ez-toc-section-end"></span></h4><p><strong>Without Decode</strong> or <strong>Encoded Cache</strong> refers to the cache that stores the raw, compressed image files (such as JPEG, PNG, or WebP) without decoding them into <code>Bitmap</code> objects. This cache stores the images in their original, encoded format. The benefits of using the encoded cache include:</p>
<h1 id="BUILD-PROJECT"><a href="#BUILD-PROJECT" class="headerlink" title="BUILD PROJECT"></a><span class="ez-toc-section" id="BUILD_PROJECT"></span>BUILD PROJECT<span class="ez-toc-section-end"></span></h1><p><img src="https://raw.githubusercontent.com/BlogForMe/ImageServer/main/Retrofit/20240618162126.jpg"></p>
<p>监控大图<br><a target="_blank" rel="noopener" href="https://juejin.im/post/6844904136266219534">https://juejin.im/post/6844904136266219534</a></p>
<p><a target="_blank" rel="noopener" href="https://bumptech.github.io/glide/">https://bumptech.github.io/glide/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/xfhy/Android-Notes/blob/master/Blogs/Android/%E4%B8%89%E6%96%B9%E5%BA%93%E5%8E%9F%E7%90%86/Glide%E4%B8%BB%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md">https://github.com/xfhy/Android-Notes/blob/master/Blogs/Android/%E4%B8%89%E6%96%B9%E5%BA%93%E5%8E%9F%E7%90%86/Glide%E4%B8%BB%E6%B5%81%E7%A8%8B%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90.md</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/pAazRD9NaLPvBseG51ZOLw">https://mp.weixin.qq.com/s/pAazRD9NaLPvBseG51ZOLw</a></p>
</=></div></div><div class="article-licensing box"><div class="licensing-title"><p>Glide</p><p><a href="https://noteforme.github.io/2024/06/18/glide/">https://noteforme.github.io/2024/06/18/glide/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Jon</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-06-18</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-09-14</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/06/19/android-safe/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Android Safe</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/06/18/design-pattern-strategy/"><span class="level-item">Design Pattern Strategy</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.png" alt="Your name"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Your name</p><p class="is-size-6 is-block">Your title</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Your location</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">243</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">30</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">33</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/ppoffice" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/ppoffice"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li><li><a class="level is-mobile" href="https://bulma.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Bulma</span></span><span class="level-right"><span class="level-item tag">bulma.io</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/ANDROID/"><span class="level-start"><span class="level-item">ANDROID</span></span><span class="level-end"><span class="level-item tag">54</span></span></a></li><li><a class="level is-mobile" href="/categories/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/Architecture/DesignPattern/"><span class="level-start"><span class="level-item">DesignPattern</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/BLE/"><span class="level-start"><span class="level-item">BLE</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/C/"><span class="level-start"><span class="level-item">C++</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/COROUTINE/"><span class="level-start"><span class="level-item">COROUTINE</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/Computer-Composition-principles/"><span class="level-start"><span class="level-item">Computer Composition principles</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/DataStructure/"><span class="level-start"><span class="level-item">DataStructure</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/categories/DesignPattern/"><span class="level-start"><span class="level-item">DesignPattern</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/DesignPatterns/"><span class="level-start"><span class="level-item">DesignPatterns</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/ENGLISH/"><span class="level-start"><span class="level-item">ENGLISH</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/INTERVIEW/"><span class="level-start"><span class="level-item">INTERVIEW</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/INTERVIEW/NETWORK/"><span class="level-start"><span class="level-item">NETWORK</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/JAVA/"><span class="level-start"><span class="level-item">JAVA</span></span><span class="level-end"><span class="level-item tag">27</span></span></a></li><li><a class="level is-mobile" href="/categories/JETPACK/"><span class="level-start"><span class="level-item">JETPACK</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Jetpack/"><span class="level-start"><span class="level-item">Jetpack</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">11</span></span></a></li><li><a class="level is-mobile" href="/categories/LIFE/"><span class="level-start"><span class="level-item">LIFE</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/LINUX/"><span class="level-start"><span class="level-item">LINUX</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/categories/Library/"><span class="level-start"><span class="level-item">Library</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/Mathematics/"><span class="level-start"><span class="level-item">Mathematics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/NETWORK/"><span class="level-start"><span class="level-item">NETWORK</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/OS/"><span class="level-start"><span class="level-item">OS</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/Organization/"><span class="level-start"><span class="level-item">Organization</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/SOURCE/"><span class="level-start"><span class="level-item">SOURCE</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/TEST/"><span class="level-start"><span class="level-item">TEST</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/TOOL/"><span class="level-start"><span class="level-item">TOOL</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/categories/VIEW/"><span class="level-start"><span class="level-item">VIEW</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/categories/anim/"><span class="level-start"><span class="level-item">anim</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/flutter/"><span class="level-start"><span class="level-item">flutter</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-04T07:57:26.000Z">2024-07-04</time></p><p class="title"><a href="/2024/07/04/DesignPatterns-State/">DesignPatterns_State</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-03T05:51:25.000Z">2024-07-03</time></p><p class="title"><a href="/2024/07/03/glide/">glide</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-28T09:37:49.000Z">2024-06-28</time></p><p class="title"><a href="/2024/06/28/bitmap/">Bitmap</a></p><p class="categories"><a href="/categories/Computer-Composition-principles/">Computer Composition principles</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-28T08:04:14.000Z">2024-06-28</time></p><p class="title"><a href="/2024/06/28/bits-and-bytes/">Bits and Bytes</a></p><p class="categories"><a href="/categories/Computer-Composition-principles/">Computer Composition principles</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-26T06:45:50.000Z">2024-06-26</time></p><p class="title"><a href="/2024/06/26/lifecycle/">LifeCycle</a></p><p class="categories"><a href="/categories/JETPACK/">JETPACK</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">16</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">May 2024</span></span><span class="level-end"><span class="level-item tag">28</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/11/"><span class="level-start"><span class="level-item">November 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/08/"><span class="level-start"><span class="level-item">August 2023</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/04/"><span class="level-start"><span class="level-item">April 2023</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2023/01/"><span class="level-start"><span class="level-item">January 2023</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/12/"><span class="level-start"><span class="level-item">December 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/10/"><span class="level-start"><span class="level-item">October 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/09/"><span class="level-start"><span class="level-item">September 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">August 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/07/"><span class="level-start"><span class="level-item">July 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/06/"><span class="level-start"><span class="level-item">June 2022</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">May 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/02/"><span class="level-start"><span class="level-item">February 2022</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/01/"><span class="level-start"><span class="level-item">January 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/12/"><span class="level-start"><span class="level-item">December 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/11/"><span class="level-start"><span class="level-item">November 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/10/"><span class="level-start"><span class="level-item">October 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/09/"><span class="level-start"><span class="level-item">September 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/08/"><span class="level-start"><span class="level-item">August 2021</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">June 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/05/"><span class="level-start"><span class="level-item">May 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/04/"><span class="level-start"><span class="level-item">April 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">March 2021</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/02/"><span class="level-start"><span class="level-item">February 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">January 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/12/"><span class="level-start"><span class="level-item">December 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">November 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">October 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/09/"><span class="level-start"><span class="level-item">September 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/08/"><span class="level-start"><span class="level-item">August 2020</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/07/"><span class="level-start"><span class="level-item">July 2020</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">June 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/05/"><span class="level-start"><span class="level-item">May 2020</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/04/"><span class="level-start"><span class="level-item">April 2020</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">March 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/01/"><span class="level-start"><span class="level-item">January 2020</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">December 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">November 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">September 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">August 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">July 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">June 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">April 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">March 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">January 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">November 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">August 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/07/"><span class="level-start"><span class="level-item">July 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">June 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">May 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">April 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">March 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">February 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">January 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">December 2017</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">November 2017</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/10/"><span class="level-start"><span class="level-item">October 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">September 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/08/"><span class="level-start"><span class="level-item">August 2017</span></span><span class="level-end"><span class="level-item tag">12</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">July 2017</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ANDROID/"><span class="tag">ANDROID</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AOSP/"><span class="tag">AOSP</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Activity/"><span class="tag">Activity</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/AndroidNewFeatures/"><span class="tag">AndroidNewFeatures</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Assembly/"><span class="tag">Assembly</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/BLOG/"><span class="tag">BLOG</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ConstraintLayout/"><span class="tag">ConstraintLayout</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DB/"><span class="tag">DB</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/DesignPattern/"><span class="tag">DesignPattern</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Drawer/"><span class="tag">Drawer</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Fragment/"><span class="tag">Fragment</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JVM/"><span class="tag">JVM</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/LEETCODE/"><span class="tag">LEETCODE</span><span class="tag">12</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Library/"><span class="tag">Library</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Operators/"><span class="tag">Operators</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Performance/"><span class="tag">Performance</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RecyclerView/"><span class="tag">RecyclerView</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/RxJava/"><span class="tag">RxJava</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/THINK/"><span class="tag">THINK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TOOL/"><span class="tag">TOOL</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TabLayout/"><span class="tag">TabLayout</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Test/"><span class="tag">Test</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/TouchEvent/"><span class="tag">TouchEvent</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VIEW/"><span class="tag">VIEW</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/XML/"><span class="tag">XML</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/anim/"><span class="tag">anim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/compose/"><span class="tag">compose</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/concurrency/"><span class="tag">concurrency</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/coroutie/"><span class="tag">coroutie</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/inter/"><span class="tag">inter</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/keyboard/"><span class="tag">keyboard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/permission/"><span class="tag">permission</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/proguard/"><span class="tag">proguard</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="Jon&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Jon</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2019</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>