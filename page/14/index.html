<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Page 14 | Jon&#39;s Blog</title>
  <meta name="author" content="Jon">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jon&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Jon&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Jon&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>Cease to struggle and you cease to live. - Thomas Carlyle<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		wubba lubba dub dub.

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2019/01/01/View_Practice/" >View_Practice</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2019-01-01  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>绘制心电图</p>
<p><a target="_blank" rel="noopener" href="https://github.com/SeekerFighter/LuckyEcgDemo">https://github.com/SeekerFighter/LuckyEcgDemo</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/16301de41a18">https://www.jianshu.com/p/16301de41a18</a></p>
<h5 id="表单输入"><a href="#表单输入" class="headerlink" title="表单输入"></a>表单输入</h5><p><img src="/2019/01/01/View_Practice/CustomView2018-05-12_09-42-16.png" alt="CustomView2018-05-12 09-42-16"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * EditText文字固定在右边</span><br><span class="line"> *&#x2F;</span><br><span class="line">public class EditTextRight extends AppCompatEditText &#123;</span><br><span class="line">    private String txtRight;</span><br><span class="line">    private Paint mPaint;</span><br><span class="line"></span><br><span class="line">    public EditTextRight(Context context) &#123;</span><br><span class="line">        super(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public EditTextRight(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        super(context, attrs);</span><br><span class="line"></span><br><span class="line">        initAttrs(context, attrs);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initAttrs(Context context, AttributeSet attrs) &#123;</span><br><span class="line">        TypedArray ta &#x3D; context.obtainStyledAttributes(attrs, R.styleable.EditTextRight);</span><br><span class="line">        mPaint &#x3D; new Paint(Paint.ANTI_ALIAS_FLAG);</span><br><span class="line">        txtRight &#x3D; ta.getString(R.styleable.EditTextRight_textright);</span><br><span class="line">&#x2F;&#x2F;        Timber.d(&quot;text&quot; + txtRight);</span><br><span class="line">        ta.recycle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        float txtSize &#x3D; getTextSize();</span><br><span class="line">        if (!TextUtils.isEmpty(txtRight)) &#123;</span><br><span class="line">            float yrig &#x3D; getWidth() - txtSize * txtRight.length() - 10; &#x2F;&#x2F;getWidth() 控件宽度</span><br><span class="line">            Timber.d(&quot;txt &quot; + txtRight + &quot;   getRight &quot; + yrig);</span><br><span class="line">            canvas.drawText(txtRight, yrig, getBaseline(), getPaint());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;com.jonzhou.mineutils.ui.customview.EditTextRight</span><br><span class="line">      android:layout_width&#x3D;&quot;100dp&quot;</span><br><span class="line">      android:layout_height&#x3D;&quot;wrap_content&quot;</span><br><span class="line">      mineutils:textright&#x3D;&quot;幢&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>







<h5 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h5><p>画正方形</p>
<ul>
<li><p>```<br>&lt;com.jonzhou.cusomview.view.MyView</p>
<pre><code>android:layout_width=&quot;wrap_content&quot;
android:layout_height=&quot;100dp&quot;
android:background=&quot;@android:color/holo_blue_bright&quot; /&gt;
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>public class MyView extends View {<br>  public MyView(Context context) {</p>
<pre><code>  super(context);
</code></pre>
<p>  }</p>
<p>  public MyView(Context context, AttributeSet attrs) {</p>
<pre><code>  super(context, attrs);
  Timber.i(&quot; MyView(Context context, AttributeSet attrs)&quot;);
</code></pre>
<p>  }</p>
<p>  public MyView(Context context, AttributeSet attrs, int defStyleAttr) {</p>
<pre><code>  super(context, attrs, defStyleAttr);
</code></pre>
<p>  }</p>
</li>
</ul>
<pre><code>@Override
protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;
    super.onMeasure(widthMeasureSpec, heightMeasureSpec);

    Timber.i(&quot;onMeasure(int widthMeasureSpec, int heightMeasureSpec)&quot;);
    int width = getMySize(100, widthMeasureSpec);
    int height = getMySize(100, heightMeasureSpec);
    if (width &lt; height) &#123;
        height = width;
    &#125; else &#123;
        width = height;
    &#125;
    Timber.i(&quot;width &quot; + width + &quot;   height  &quot; + height);
    setMeasuredDimension(width,height);
&#125;

private int getMySize(int defaultSize, int measureSpec) &#123;
    int mySize = defaultSize;
    int mode = MeasureSpec.getMode(measureSpec);
    int size = MeasureSpec.getSize(measureSpec);
    switch (mode) &#123;
        case MeasureSpec.UNSPECIFIED: //如果没有指定大小，就设置为默认大小
            mySize = defaultSize;
            break;
        case MeasureSpec.AT_MOST://如果测量模式是最大取值为size
            //我们将大小取最大值,你也可以取其他值
            mySize = size;
            break;
        case MeasureSpec.EXACTLY:
            mySize = size;
            break;
    &#125;
    return mySize;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">设置 match_parent不是正方形?</span><br><span class="line"></span><br><span class="line">关于自定义属性不提示 declare-styleable name要和自定义类名相同，然后重启Ide就好了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">那么获取到的mode和size又代表了什么呢？ </span><br><span class="line">mode代表了我们当前控件的父控件告诉我们控件，你应该按怎样的方式来布局。 </span><br><span class="line">mode有三个可选值：EXACTLY, AT_MOST, UNSPECIFIED。它们的含义是：</span><br><span class="line"></span><br><span class="line">EXACTLY：父控件告诉我们子控件了一个确定的大小，你就按这个大小来布局。比如我们指定了确定的dp值和macth_parent的情况。 </span><br><span class="line">AT_MOST：当前控件不能超过一个固定的最大值，一般是wrap_content的情况。 UNSPECIFIED:当前控件没有限制，要多大就有多大，这种情况很少出现。</span><br><span class="line"></span><br><span class="line">下面是一个重写onMeasure的固定伪代码写法：</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>if mode is EXACTLY{<br>     父布局已经告诉了我们当前布局应该是多大的宽高, 所以我们直接返回从measureSpec中获取到的size<br>}else{<br>     计算出希望的desiredSize<br>     if mode is AT_MOST<br>          返回desireSize和specSize当中的最小值<br>     else:<br>          返回计算出的desireSize<br>   }</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  原文：https:&#x2F;&#x2F;blog.csdn.net&#x2F;yissan&#x2F;article&#x2F;details&#x2F;51136088 </span><br><span class="line"></span><br><span class="line">##### 自定义属性不提示 </span><br><span class="line"></span><br><span class="line">  按照如图两名称一致，重启AndroidStudio</span><br><span class="line"></span><br><span class="line">![](View_Practice&#x2F;customview_2018-05-17_01.png)</span><br><span class="line"></span><br><span class="line">![customview_2018-05-17_02](View_Practice\customview_2018-05-17_02.png)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> https:&#x2F;&#x2F;blog.csdn.net&#x2F;skysmile_&#x2F;article&#x2F;details&#x2F;78833438</span><br><span class="line"></span><br><span class="line"> https:&#x2F;&#x2F;developer.android.com&#x2F;guide&#x2F;topics&#x2F;ui&#x2F;custom-components</span><br><span class="line"></span><br><span class="line"> https:&#x2F;&#x2F;developer.android.com&#x2F;training&#x2F;custom-views&#x2F;custom-drawing</span><br><span class="line"></span><br><span class="line">绘图</span><br><span class="line">http:&#x2F;&#x2F;blog.csdn.net&#x2F;huaiyiheyuan&#x2F;article&#x2F;details&#x2F;52205969</span><br><span class="line"></span><br><span class="line">画圆</span><br><span class="line">http:&#x2F;&#x2F;www.jianshu.com&#x2F;p&#x2F;d891fe636898</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">##### Scroll 滑动</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;juejin.im&#x2F;post&#x2F;5c7f4f0351882562ed516ab6#heading-17</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;guolin_blog&#x2F;article&#x2F;details&#x2F;48719871</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### Kotlin</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>class TermRoundView @JvmOverloads constructor(<br>        context: Context?, attrs: AttributeSet?,<br>        defStyleAttr: Int = 0<br>) : View(context, attrs, defStyleAttr) {<br>    init{<br>      val a = context?.theme?.obtainStyledAttributes(attrs, R.styleable.TermRoundView, 0, 0)<br>        try {<br>            isRulerInput = a!!.getBoolean(R.styleable.TermRoundView_isRulerInput, false)<br>        } finally {<br>            a?.recycle()<br>        }<br>    }<br>}</p>
<p>```</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903909320835080">https://juejin.im/post/6844903909320835080</a></p>

	
	</div>
  <a type="button" href="/2019/01/01/View_Practice/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/11/18/MediaPlayer/" >MediaPlayer</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-11-18  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/media/MediaPlayer">https://developer.android.com/reference/android/media/MediaPlayer</a></p>
<p><a target="_blank" rel="noopener" href="http://www.runoob.com/w3cnote/android-tutorial-mediaplayer.html">http://www.runoob.com/w3cnote/android-tutorial-mediaplayer.html</a></p>
<p><img src="/2018/11/18/MediaPlayer/MediaPlayer%5Cmediaplayer_state_diagram.gif" alt="mediaplayer_state_diagram"></p>
<p>这张状态转换图清晰的描述了MediaPlayer的各个状态，也列举了主要的方法的调用时序，每种方法只能在一些特定的状态下使用，如果使用时MediaPlayer的状态不正确则会引发IllegalStateException异常。</p>
<p>Idle 状态：当使用new()方法创建一个MediaPlayer对象或者调用了其reset()方法时，该MediaPlayer对象处于idle状态。这两种方法的一个重要差别就是：如果在这个状态下调用了getDuration()等方法（相当于调用时机不正确），通过reset()方法进入idle状态的话会触发OnErrorListener.onError()，并且MediaPlayer会进入Error状态；如果是新创建的MediaPlayer对象，则并不会触发onError(),也不会进入Error状态。</p>
<p>End 状态：通过release()方法可以进入End状态，只要MediaPlayer对象不再被使用，就应当尽快将其通过release()方法释放掉，以释放相关的软硬件组件资源，这其中有些资源是只有一份的（相当于临界资源）。如果MediaPlayer对象进入了End状态，则不会在进入任何其他状态了。</p>
<p>Initialized 状态：这个状态比较简单，MediaPlayer调用setDataSource()方法就进入Initialized状态，表示此时要播放的文件已经设置好了。</p>
<p>Prepared 状态：初始化完成之后还需要通过调用prepare()或prepareAsync()方法，这两个方法一个是同步的一个是异步的，只有进入Prepared状态，才表明MediaPlayer到目前为止都没有错误，可以进行文件播放。</p>
<p>Preparing 状态：这个状态比较好理解，主要是和prepareAsync()配合，如果异步准备完成，会触发OnPreparedListener.onPrepared()，进而进入Prepared状态。</p>
<p>Started 状态：显然，MediaPlayer一旦准备好，就可以调用start()方法，这样MediaPlayer就处于Started状态，这表明MediaPlayer正在播放文件过程中。可以使用isPlaying()测试MediaPlayer是否处于了Started状态。如果播放完毕，而又设置了循环播放，则MediaPlayer仍然会处于Started状态，类似的，如果在该状态下MediaPlayer调用了seekTo()或者start()方法均可以让MediaPlayer停留在Started状态。</p>
<p>Paused 状态：Started状态下MediaPlayer调用pause()方法可以暂停MediaPlayer，从而进入Paused状态，MediaPlayer暂停后再次调用start()则可以继续MediaPlayer的播放，转到Started状态，暂停状态时可以调用seekTo()方法，这是不会改变状态的。</p>
<p>Stop 状态：Started或者Paused状态下均可调用stop()停止MediaPlayer，而处于Stop状态的MediaPlayer要想重新播放，需要通过prepareAsync()和prepare()回到先前的Prepared状态重新开始才可以。</p>
<p>PlaybackCompleted状态：文件正常播放完毕，而又没有设置循环播放的话就进入该状态，并会触发OnCompletionListener的onCompletion()方法。此时可以调用start()方法重新从头播放文件，也可以stop()停止MediaPlayer，或者也可以seekTo()来重新定位播放位置。</p>
<p>Error状态：如果由于某种原因MediaPlayer出现了错误，会触发OnErrorListener.onError()事件，此时MediaPlayer即进入Error状态，及时捕捉并妥善处理这些错误是很重要的，可以帮助我们及时释放相关的软硬件资源，也可以改善用户体验。通过setOnErrorListener(android.media.MediaPlayer.OnErrorListener)可以设置该监听器。如果MediaPlayer进入了Error状态，可以通过调用reset()来恢复，使得MediaPlayer重新返回到Idle状态。</p>
<p>原文：<a target="_blank" rel="noopener" href="https://blog.csdn.net/ddna/article/details/5178864">https://blog.csdn.net/ddna/article/details/5178864</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/biaobiao1217/article/details/51557733">https://blog.csdn.net/biaobiao1217/article/details/51557733</a></p>

	
	</div>
  <a type="button" href="/2018/11/18/MediaPlayer/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/11/03/mina/" >mina</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-11-03  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>MINA配置</p>
<ul>
<li>下载 <a target="_blank" rel="noopener" href="http://mina.apache.org/mina-project/downloads.html">http://mina.apache.org/mina-project/downloads.html</a>   <a target="_blank" rel="noopener" href="http://mirrors.shu.edu.cn/apache/mina/mina/2.0.19/apache-mina-2.0.19-bin.zip"><strong>apache-mina-2.0.19-bin.zip</strong></a> 解压</li>
<li>下载 <a target="_blank" rel="noopener" href="https://www.slf4j.org/download.html">https://www.slf4j.org/download.html</a>   slf4j-1.7.25.zip解压</li>
</ul>
<p>在MineUtil项目中有demo实现</p>
<p>IM键盘</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5ef850c9f265da231019f6e4">https://juejin.im/post/5ef850c9f265da231019f6e4</a></p>

	
	</div>
  <a type="button" href="/2018/11/03/mina/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/08/13/GestureDetector/" >GestureDetector</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-08-13  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>GestureDetector总结</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/harvic880925/article/details/39520901">https://blog.csdn.net/harvic880925/article/details/39520901</a></p>
<p>切换动画</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013309870/article/details/52873515">https://blog.csdn.net/u013309870/article/details/52873515</a></p>
<p><a target="_blank" rel="noopener" href="http://www.jcodecraeer.com/a/basictutorial/2016/1014/6672.html">http://www.jcodecraeer.com/a/basictutorial/2016/1014/6672.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a06e4f215f49">https://www.jianshu.com/p/a06e4f215f49</a></p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">e1</span>, MotionEvent e<span class="number">2</span>坐标滑动距离</span><br></pre></td></tr></table></figure>

<p>速度判断:velocityX：X轴上的移动速度，像素/秒   </p>
<p>velocityY：Y轴上的移动速度，像素/秒 </p>

	
	</div>
  <a type="button" href="/2018/08/13/GestureDetector/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/25/AndroidSource/" >AndroidSource</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-25  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15W411L7Lc?p=9">https://www.bilibili.com/video/BV15W411L7Lc?p=9</a></p>
<h5 id="源码调试"><a href="#源码调试" class="headerlink" title="源码调试"></a>源码调试</h5><p>要学习Android源码需要编译一份，然后安装要求导入AndroidStudio,可以参考:<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/huaiyiheyuan/article/details/52069122">http://blog.csdn.net/huaiyiheyuan/article/details/52069122</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public class Application extends ContextWrapper implements ComponentCallbacks2 &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>当我点开父类ContextWrapper后，发现引用的是jar立面的class文件，既然有源码这肯定不是我所需要的，<br>可以这要操作:Project Structure-&gt;Dependencies(可以看到很多jar依赖删掉)-&gt;　＋JARS And Dierctories -&gt;添加源码要关联的frameworks 、packages…</p>
<ol>
<li>新建JDK1.8　选择openjdk8</li>
</ol>
<p>　<img src="/2018/07/25/AndroidSource/DeepinScrot_aosp1.png"></p>
<ol start="2">
<li><p>删除依赖</p>
<p>　<img src="/2018/07/25/AndroidSource/DeepinScrot_aosp5.png"></p>
</li>
</ol>
<p>3.　选择需要的包</p>
<p><img src="/2018/07/25/AndroidSource/DeepinScrot_aosp.png"></p>
<p>4.　这一步要衡量一下，转为gradle项目后，project structure下面就没有moudles了<br> <img src="/2018/07/25/AndroidSource/DeepinScrot_aosp2.png"><br>    这个设置后麻烦可以大了，后面不得不删除了android.ipr、android.iws、android.iml这三个文件重新生成</p>
<p>５.　跳转到源码<br>　　找到pacages-&gt; apps-&gt;Settings　<code>public class SettingsDrawerActivity extends Activity &#123;</code></p>
<p>  点开Activity发现还是跳转到jar的内容  </p>
<ol start="6">
<li>最主要的是这一步,直接添加aosp最外层路径导入源码就可以了</li>
</ol>
<img src="/2018/07/25/AndroidSource/aosp6.png" alt="aosp6" style="zoom:50%;">



<p>  终于成功了</p>
<p>然后就可以愉快的调试源码了</p>
<p>/home/jon/noteforme.github.io/public/2017/08/10/DesignParrerns</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/news/277549">https://cloud.tencent.com/developer/news/277549</a></p>
<ul>
<li>Activity启动过程</li>
</ul>
<p> 对应用程序Activity进行编译和打包</p>
<pre><code>  /home/jon/桌面/LaoLuo/chapter-7/src/packages/experimental/Activity
  make snod
  emulator
</code></pre>
<p>然后查看activity信息，在这里通过源码里面的 adb</p>
<pre><code>cd  /home/jon/AOSP/out/host/linux-x86/bin
adb shell dumpsys activity
</code></pre>
<blockquote>
</blockquote>
<img src="https://img-blog.csdn.net/20170123173332254?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaXRhY2hpODU=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" style="zoom: 67%;">



<p>1.Android系统架构<br>Android系统架构分为五层，从上到下依次是应用层、应用框架层、系统运行库层、硬件抽象层和Linux内核层。</p>
<p>应用层<br>系统内置的应用程序以及非系统级的应用程序都是属于应用层。负责与用户进行直接交互，通常都是用Java进行开发的。</p>
<p>应用框架层（Java Framework)<br>应用框架层为开发人员提供了可以开发应用程序所需要的API，我们平常开发应用程序都是调用的这一层所提供的API，当然也包括系统的应用。这一层的是由Java代码编写的，可以称为Java Framework。下面来看这一层所提供的主要的组件。</p>
<p>名称    功能描述<br>Activity Manager(活动管理器)    管理各个应用程序生命周期以及通常的导航回退功能<br>Location Manager(位置管理器)    提供地理位置以及定位功能服务<br>Package Manager(包管理器)    管理所有安装在Android系统中的应用程序<br>Notification Manager(通知管理器)    使得应用程序可以在状态栏中显示自定义的提示信息<br>Resource Manager（资源管理器）    提供应用程序使用的各种非代码资源，如本地化字符串、图片、布局文件、颜色文件等<br>Telephony Manager(电话管理器)    管理所有的移动设备功能<br>Window Manager（窗口管理器）    管理所有开启的窗口程序<br>Content Providers（内容提供器）    使得不同应用程序之间可以共享数据<br>View System（视图系统）    构建应用程序的基本组件<br>表1<br>系统运行库层（Native)<br>系统运行库层分为两部分，分别是C/C++程序库和Android运行时库。下面分别来介绍它们。</p>
<p>1.C/C++程序库<br>C/C++程序库能被Android系统中的不同组件所使用，并通过应用程序框架为开发者提供服务，主要的C/C++程序库如下表2所示。</p>
<p>名称    功能描述<br>OpenGL ES    3D绘图函数库<br>Libc    从BSD继承来的标准C系统函数库，专门为基于嵌入式Linux的设备定制<br>Media Framework    多媒体库，支持多种常用的音频、视频格式录制和回放。<br>SQLite    轻型的关系型数据库引擎<br>SGL    底层的2D图形渲染引擎<br>SSL    安全套接层，是为网络通信提供安全及数据完整性的一种安全协议<br>FreeType    可移植的字体引擎，它提供统一的接口来访问多种字体格式文件<br>表2<br>2.Android运行时库<br>运行时库又分为核心库和ART(5.0系统之后，Dalvik虚拟机被ART取代)。核心库提供了Java语言核心库的大多数功能，这样开发者可以使用Java语言来编写Android应用。相较于JVM，Dalvik虚拟机是专门为移动设备定制的，允许在有限的内存中同时运行多个虚拟机的实例，并且每一个Dalvik 应用作为一个独立的Linux 进程执行。独立的进程可以防止在虚拟机崩溃的时候所有程序都被关闭。而替代Dalvik虚拟机的ART 的机制与Dalvik 不同。在Dalvik下，应用每次运行的时候，字节码都需要通过即时编译器转换为机器码，这会拖慢应用的运行效率，而在ART 环境中，应用在第一次安装的时候，字节码就会预先编译成机器码，使其成为真正的本地应用。</p>
<p>硬件抽象层（HAL)<br>硬件抽象层是位于操作系统内核与硬件电路之间的接口层，其目的在于将硬件抽象化，为了保护硬件厂商的知识产权，它隐藏了特定平台的硬件接口细节，为操作系统提供虚拟硬件平台，使其具有硬件无关性，可在多种平台上进行移植。 从软硬件测试的角度来看，软硬件的测试工作都可分别基于硬件抽象层来完成，使得软硬件测试工作的并行进行成为可能。通俗来讲，就是将控制硬件的动作放在硬件抽象层中。</p>
<p>Linux内核层<br>Android 的核心系统服务基于Linux 内核，在此基础上添加了部分Android专用的驱动。系统的安全性、内存管理、进程管理、网络协议栈和驱动模型等都依赖于该内核。<br>Android系统的五层架构就讲到这，了解以上的知识对以后分析系统源码有很大的帮助。</p>
<p>2.Android系统源码目录<br>我们要先了解Android系统源码目录，为后期源码学习打下基础。关于源码的阅读，你可以访问<a target="_blank" rel="noopener" href="http://androidxref.com/%E6%9D%A5%E9%98%85%E8%AF%BB%E7%B3%BB%E7%BB%9F%E6%BA%90%E7%A0%81%E3%80%82%E5%BD%93%E7%84%B6%EF%BC%8C%E6%9C%80%E5%A5%BD%E6%98%AF%E5%B0%86%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E4%B8%8B%E6%9D%A5%E3%80%82%E4%B8%8B%E8%BD%BD%E6%BA%90%E7%A0%81%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E6%B8%85%E5%8D%8E%E5%A4%A7%E5%AD%A6%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6%E9%95%9C%E5%83%8F%E7%AB%99%E6%8F%90%E4%BE%9B%E7%9A%84Android">http://androidxref.com/来阅读系统源码。当然，最好是将源码下载下来。下载源码可以使用清华大学开源软件镜像站提供的Android</a> 镜像：<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/">https://mirrors.tuna.tsinghua.edu.cn/help/AOSP/</a> 。如果觉得麻烦也可以查找国内的网盘进行下载，推荐使用该百度网盘地址下载：<a target="_blank" rel="noopener" href="http://pan.baidu.com/s/1ngsZs%EF%BC%8C%E5%AE%83%E6%8F%90%E4%BE%9B%E4%BA%86%E5%A4%9A%E4%B8%AAAndroid%E7%89%88%E6%9C%AC%E7%9A%84%E7%9A%84%E6%BA%90%E7%A0%81%E4%B8%8B%E8%BD%BD%E3%80%82">http://pan.baidu.com/s/1ngsZs，它提供了多个Android版本的的源码下载。</a></p>
<p>整体结构<br>各个版本的源码目录基本是类似，如果是编译后的源码目录会多增加一个out文件夹，用来存储编译产生的文件。Android7.0的根目录结构说明如下表所示。</p>
<p>从表3可以看出，系统源码分类清晰，并且内容庞大且复杂。接下来分析packages中的内容，也就是应用层部分。<br>应用层部分<br>应用层位于整个Android系统的最上层，开发者开发的应用程序以及系统内置的应用程序都是在应用层。源码根目录中的packages目录对应着系统应用层。它的目录结构如表4所示。</p>
<h5 id="Android-open-source-project"><a href="#Android-open-source-project" class="headerlink" title="Android open source project"></a>Android open source project</h5><h5 id=""><a href="#" class="headerlink" title=""></a></h5><p>Android Architecture</p>
<p><img src="/2018/07/25/AndroidSource/android_stack_720.png" style="zoom:50%;">         <img src="/2018/07/25/AndroidSource/ape_fwk_all.png" style="zoom: 67%;"></p>
<p><a target="_blank" rel="noopener" href="https://source.android.com/">https://source.android.com/</a>                            </p>
<p> <a target="_blank" rel="noopener" href="https://source.android.com/devices/architecture">https://source.android.com/devices/architecture</a></p>
<blockquote>
<pre><code>    Android源码根目录    描述
               
abi    应用程序二进制接口
art    全新的ART运行环境
bionic    系统C库
bootable    启动引导相关代码
build    存放系统编译规则及generic等基础开发包配置
cts    Android兼容性测试套件标准
dalvik art    虚拟机
developers    开发者目录
development    应用程序开发相关
device    设备相关配置
docs    参考文档目录
external    开源模组相关文件
frameworks    应用程序框架，Android系统核心部分，由Java和C++编写
hardware    主要是硬件抽象层的代码
libcore    核心库相关文件
libnativehelper    动态库，实现JNI库的基础
ndk    NDK相关代码，帮助开发人员在应用程序中嵌入C/C++代码
out    编译完成后代码输出在此目录
packages    应用程序包
pdk    Plug Development Kit 的缩写，本地开发套件
platform_testing    平台测试
prebuilts    x86和arm架构下预编译的一些资源
sdk    sdk和模拟器
system    底层文件系统库、应用和组件
toolchain    工具链文件
tools    工具文件
Makefile    全局Makefile文件，用来定义编译规则
————————————————
               
https://blog.csdn.net/wenzhi20102321/article/details/80739649
               
https://blog.csdn.net/wen0006/article/details/5804639
</code></pre>
</blockquote>
<h5 id="源码关联阅读"><a href="#源码关联阅读" class="headerlink" title="源码关联阅读"></a>源码关联阅读</h5><p>也可以选择对应的文件的 .class文件后，再选择源码后再建立关联。</p>
<p><img src="/2018/07/25/AndroidSource/20220527125047.jpg" alt="20220527125047"></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/8012d5d38b01">https://www.jianshu.com/p/8012d5d38b01</a></p>

	
	</div>
  <a type="button" href="/2018/07/25/AndroidSource/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/17/ViewDynamic/" >ViewDynamic</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-17  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="动态添加布局"><a href="#动态添加布局" class="headerlink" title="动态添加布局"></a>动态添加布局</h4><h5 id="LinearLayout添加"><a href="#LinearLayout添加" class="headerlink" title="LinearLayout添加"></a>LinearLayout添加</h5><ul>
<li><p>父容器</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;LinearLayout</span><br><span class="line">    android:id=&quot;@+id/ll_plan_one&quot;</span><br><span class="line">    android:layout_width=&quot;match_parent&quot;</span><br><span class="line">    android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">    android:orientation=&quot;vertical&quot;&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>子布局</p>
<figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">View</span> view1 = inflate.inflate(R.layout.layout_animation, <span class="built_in">null</span>);</span><br><span class="line"><span class="built_in">View</span> view2 = inflate.inflate(R.layout.ic_hpan_suger_press_y, <span class="built_in">null</span>);</span><br><span class="line"><span class="built_in">View</span> view3 = inflate.inflate(R.layout.ic_hpan_suger_press_y, <span class="built_in">null</span>);</span><br></pre></td></tr></table></figure></li>
<li><p>添加进容器</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">llVertical.add<span class="constructor">View(<span class="params">view1</span>)</span>;</span><br><span class="line">llVertical.add<span class="constructor">View(<span class="params">view2</span>)</span>;</span><br><span class="line">llVertical.add<span class="constructor">View(<span class="params">view3</span>)</span>;</span><br></pre></td></tr></table></figure></li>
<li><p>添加同一个子布局会<strong>报错</strong></p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">llVertical.add<span class="constructor">View(<span class="params">view1</span>)</span>;</span><br><span class="line">llVertical.add<span class="constructor">View(<span class="params">view1</span>)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>​    Caused by: java.lang.IllegalStateException: The specified child already has a parent. You must call removeView() on the child’s parent first.</p>
</blockquote>
</li>
</ul>

	
	</div>
  <a type="button" href="/2018/07/17/ViewDynamic/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/11/Lambda/" >Lambda</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-11  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="http://blog.oneapm.com/apm-tech/226.html">http://blog.oneapm.com/apm-tech/226.html</a></p>
<p>android </p>
<p><a target="_blank" rel="noopener" href="https://maxwell-nc.github.io/android/retrolambda.html">https://maxwell-nc.github.io/android/retrolambda.html</a></p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1526621">https://cloud.tencent.com/developer/article/1526621</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903668592934925">https://juejin.im/post/6844903668592934925</a></p>
<p>kotlin  lambda</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6844903604613021703">https://juejin.im/post/6844903604613021703</a></p>
<p>Video</p>
<h4 id="Java-lambda"><a href="#Java-lambda" class="headerlink" title="Java lambda"></a>Java lambda</h4><p>函数式编程</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av54941486/">https://www.bilibili.com/video/av54941486/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.chilangedu.com/sectionq/2132352424">http://www.chilangedu.com/sectionq/2132352424</a></p>
<h5 id="map"><a href="#map" class="headerlink" title="map"></a>map</h5><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;R&gt; Stream&lt;R&gt; <span class="keyword">map</span>(<span class="built_in">Function</span>&lt;? <span class="built_in">super</span> T, ? <span class="keyword">extends</span> R&gt; mapper);</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="symbol">Function</span>&lt;<span class="symbol">T</span>, <span class="symbol">R</span>&gt; &#123;</span><br><span class="line">	    R apply(T t); <span class="comment">//将T类型转为R</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




	
	</div>
  <a type="button" href="/2018/07/11/Lambda/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/11/EventBus/" >EventBus</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-11  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<ol>
<li><p>定义事件类</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEvent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  <span class="built_in">String</span> message;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">MessageEvent</span>(<span class="params"><span class="built_in">String</span> message</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">String</span> <span class="function"><span class="title">getMessage</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p> EventBusActivity</p>
</li>
</ol>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Subscribe</span>(threadMode = ThreadMode.MAIN)</span><br><span class="line"><span class="keyword">public</span>  <span class="built_in">void</span>  <span class="function"><span class="title">onMessageEvent</span>(<span class="params">MessageEvent messageEvent</span>)</span>&#123;</span><br><span class="line">    btEventRecieve.setText(messageEvent.getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onStart</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">super</span>.onStart();</span><br><span class="line">     EventBus.getDefault().register(<span class="built_in">this</span>);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line"> <span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">onStop</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">     <span class="built_in">super</span>.onStop();</span><br><span class="line">     EventBus.getDefault().unregister(<span class="built_in">this</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>GoalEventActivity </li>
</ol>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">findViewById(R.id.bt_message_send).setOnClickListener(v-&gt;&#123;</span><br><span class="line">    <span class="keyword">new</span> Thread<span class="function"><span class="params">(()-&gt;&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">        EventBus.getDefault().post(<span class="keyword">new</span> MessageEvent(<span class="string">&quot;我是 GoalEventActivity&quot;</span>));</span></span></span><br><span class="line"><span class="function"><span class="params">    &#125;)</span>.<span class="title">start</span><span class="params">()</span>;</span></span><br><span class="line"><span class="function">&#125;);</span></span><br></pre></td></tr></table></figure>





<h5 id="类别"><a href="#类别" class="headerlink" title="类别"></a>类别</h5><p>在上面的例子中，我们再注解<code>@Subscribe(threadMode = ThreadMode.MAIN)</code>中使用了ThreadMode.MAIN这个模式，表示该函数在主线程即UI线程中执行，实际上EventBus总共有四种线程模式，分别是： </p>
<ul>
<li>ThreadMode.MAIN：表示无论事件是在哪个线程发布出来的，该事件订阅方法onEvent都会在UI线程中执行，这个在Android中是非常有用的，因为在Android中只能在UI线程中更新UI，所有在此模式下的方法是不能执行耗时操作的。</li>
<li>ThreadMode.POSTING：表示事件在哪个线程中发布出来的，事件订阅函数onEvent就会在这个线程中运行，也就是说发布事件和接收事件在同一个线程。使用这个方法时，在onEvent方法中不能执行耗时操作，如果执行耗时操作容易导致事件分发延迟。</li>
<li>ThreadMode.BACKGROUND：表示如果事件在UI线程中发布出来的，那么订阅函数onEvent就会在子线程中运行，如果事件本来就是在子线程中发布出来的，那么订阅函数直接在该子线程中执行。</li>
<li>ThreadMode.AYSNC：使用这个模式的订阅函数，那么无论事件在哪个线程发布，都会创建新的子线程来执行订阅函数。</li>
</ul>
<p> <a target="_blank" rel="noopener" href="https://github.com/greenrobot/EventBus">https://github.com/greenrobot/EventBus</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a040955194fc">https://www.jianshu.com/p/a040955194fc</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000004279679">https://segmentfault.com/a/1190000004279679</a></p>

	
	</div>
  <a type="button" href="/2018/07/11/EventBus/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/05/Bluetooth02/" >Bluetooth02</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-05  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="BLE-stack-蓝牙协议栈"><a href="#BLE-stack-蓝牙协议栈" class="headerlink" title="BLE stack(蓝牙协议栈)"></a>BLE stack(蓝牙协议栈)</h4><img src="/2018/07/05/Bluetooth02/bluetooth_20180706093223.png" alt="bluetooth_20180706093223" style="zoom: 80%;">



<p> 作为 Android 开发者，我们不必理解 BLE 的协议栈每个细节，这里大概介绍一下协议架构。 协议一般都是分层设计的。BLE 协议栈也不例外。我们来看一下这个图。整个协议栈大致分为三部分，从下到上分别为，控制器    （Controller）→主机（Host）→应用（Applications）。 </p>
<ul>
<li>Controller :  它是协议栈的底层的实现，直接与硬件相关，一般直接集成在 SoC 中，由芯片厂商实现，包括物理层和链路层。 </li>
<li>HOST : 这是协议栈的上层实现，是硬件的抽象，与具体的硬件和厂家无关 </li>
<li>应用层： 就是使用 Host 层提供的 API，开发的应用。 </li>
</ul>
<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><ul>
<li><p>PhysicalLayer(物理层 ): 蓝牙是工作在 2.4GHz 附近，这是工业、科学、医疗 ISM 频段。可以看到它和 WiFi 工作在同一个频段。蓝牙把频段切分为 40 个通道，3 个广播通道，37 个数据通道，按照一定规律跳频通信（高斯频移键控 GFSK）。 </p>
</li>
<li><p>HCI   : 在 Host 层和 Controller 之间有一个接口层 :主机和控制器之间就是通过 HCI 命令和事件交互的。HCI 这一层是协议栈中是可选的，例如在一些简单小型的设备上可能就没有，但是所有的 Android 设备上肯定是有。这是蓝牙上层应用和芯片的交互的必经之路。后面我们会讲到，这一层的 log，能够很好的帮助我们分析和调试问题。 </p>
</li>
</ul>
<h4 id="Host"><a href="#Host" class="headerlink" title="Host"></a>Host</h4><h5 id="ATT-Attribute-Protocol"><a href="#ATT-Attribute-Protocol" class="headerlink" title="ATT (Attribute Protocol)"></a>ATT (Attribute Protocol)</h5><p>它是 BLE 通信的基础。ATT 把数据封装，向外暴露为“属性”，提供“属性”的为服务端，获取“属性”的为客户端。ATT 是专门为低功耗蓝牙设计的，结构非常简单，数据长度很短 .</p>
<h5 id="GATT-Generic-Attribute-Profile"><a href="#GATT-Generic-Attribute-Profile" class="headerlink" title="GATT(Generic Attribute Profile)"></a>GATT(Generic Attribute Profile)</h5><p> 全称叫做通用属性配置文件，它是建立在前面说的 ATT 的基础上，对 ATT 进行进一步的逻辑封装，定义数据的交互方式和含义。这是我们做 BLE 开发的时候直接接触的概念。 GATT 按照层级定义了三个概念：服务（Service）、特征（Characteristic）和描述（Descriptor）。 一个 Service 包含若干个 Characteristic，一个 Characteristic 可以包含若干 Descriptor。而 Characteristic 定义了数值和操作。Characteristic 的操作这几种权限：读、写、通知等权限。我们说的 BLE 通信，其实就是对 Characteristic 的读写或者订阅通知。还有最外面一层，Profile配置文件，把若干个相关的 Service 组合在一起，就成为了一个 Profile，Profile 就是定义了一个实际的应用场景。 </p>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5Cbluetooth_20180706102358.png" alt="Bluetooth02_20180706102358"></p>
<p>Service、Characteristic相当于标签（Service相当于他的类别，Characteristic相当于它的名字），而value才真正的包含数据，Descriptor是对这个value进行的说明和描述，当然我们可以从不同角度来描述和说明，因此可以有多个Descriptor. </p>
<ul>
<li>例如: </li>
</ul>
<p>常见的小米手环是一个BLE设备，（假设）它包含三个Service,分别是提供设备信息的Service、提供步数的Service、检测心率的Service; 而设备信息的service中包含的characteristic包括厂商信息、硬件信息、版本信息等；而心率Service则包括心率characteristic等，而心率characteristic中的value则真正的包含心率的数据，而descriptor则是对该value的描述说明，比如value的单位啊，描述啊，权限啊等。 </p>
<h5 id="GAP-Generic-Access-Profile"><a href="#GAP-Generic-Access-Profile" class="headerlink" title="GAP(Generic Access Profile)"></a>GAP(Generic Access Profile)</h5><p>它定义了 BLE 整个通信过程中的流程，例如广播、扫描、连接等流程。还定义了参与通信的设备角色，以及他们各自的职能，例如广播数据的 Broadcaster，接收广播的 Observer，还有被连接的“外设” Peripheral 和发起连接的“中心设备” Central。可以看到，参与交互的设备角色都不是对等 </p>
<h5 id="Applications"><a href="#Applications" class="headerlink" title="Applications"></a>Applications</h5><p>就是使用 Host 提供的 API 开发的低功耗蓝牙应用。 到这里，我们就把 BLE 的协议栈过了一下，为我们开发 BLE 有了一些理论基础。 </p>
<h4 id="BLE-on-Android"><a href="#BLE-on-Android" class="headerlink" title="BLE on Android"></a>BLE on Android</h4><ul>
<li><p>Central mode :  从Android 4.3 Jelly Bean，也就是 API 18 才开始支持低功耗蓝牙(蓝牙4.0)。这时支持 BLE 的 Central 模式，也就是我们在上面 GAP 中说的，Android 设备只能作为中心设备去连接其他设备。</p>
</li>
<li><p>Peripheral mode:从 Android 5.0 开始才支持外设模式(蓝牙4.1)。Android 设备现在可以发挥蓝牙 LE <em>外围设备</em>的作用。应用可以利用此功能让附近设备发现它。例如，您可以开发这样的应用：让设备发挥计步器或健康监测仪的作用，并与其他蓝牙 LE 设备进行数据通信。</p>
<p>新增的 <code>android.bluetooth.le</code> API 让您的应用可以发布广告、扫描响应以及与附近的蓝牙 LE 设备建立连接。要使用新增的广告和扫描功能，请在您的清单中添加 <code>BLUETOOTH_ADMIN</code> 权限。当用户更新您的应用或从 Play 商店下载您的应用时，会被要求向您的应用授予以下权限：“Bluetooth connection information:Allows the app to control Bluetooth, including broadcasting to or getting information about nearby Bluetooth devices.”</p>
<p>要启动蓝牙 LE 广播，以便其他设备能发现您的应用，请调用 <code>startAdvertising()</code>，并传入 <code>AdvertiseCallback</code> 类的实现。回调对象会收到广播操作成功或失败的报告。</p>
<p>Android 5.0 引入了 <code>ScanFilter</code> 类，让您的应用可以只扫描其感兴趣的特定类型设备。要开始扫描蓝牙 LE 设备，请调用 <code>startScan()</code>，并传入筛选器列表。在方法调用中，您还必须提供 <code>ScanCallback</code> 的实现，以便在发现蓝牙 LE 广播时进行报告。</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/about/versions/android-5.0?hl=zh-cn#BluetoothBroadcasting">https://developer.android.com/about/versions/android-5.0?hl=zh-cn#BluetoothBroadcasting</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection">https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection</a></p>
</li>
</ul>
<h5 id="Android-7-0-蓝牙架构"><a href="#Android-7-0-蓝牙架构" class="headerlink" title="Android 7.0 蓝牙架构"></a>Android 7.0 蓝牙架构</h5><p><img src="/2018/07/05/Bluetooth02/v2-8bf93957bb78f938894bec7749a0433b_hd.jpg" alt="v2-8bf93957bb78f938894bec7749a0433b_hd"></p>
<h5 id="Android-8-0-蓝牙架构"><a href="#Android-8-0-蓝牙架构" class="headerlink" title="Android 8.0 蓝牙架构"></a>Android 8.0 蓝牙架构</h5><p>Android 提供支持经典蓝牙和蓝牙低功耗的默认蓝牙堆栈。借助蓝牙，Android 设备可以创建个人区域网络，以便通过附近的蓝牙设备发送和接收数据。</p>
<p>在 Android 4.3 及更高版本中，Android 蓝牙堆栈可提供实现蓝牙低功耗 (BLE) 的功能。要充分利用 BLE API，请遵循 <a target="_blank" rel="noopener" href="https://source.android.com/devices/bluetooth/hci_requirements.html?hl=zh-cn">Android 蓝牙 HCI 要求</a>。具有合格芯片组的 Android 设备可以实现经典蓝牙或同时实现经典蓝牙和 BLE。BLE 不能向后兼容较旧版本的蓝牙芯片组。</p>
<p>在 Android 8.0 中，原生蓝牙堆栈完全符合蓝牙 5.0 的要求。要使用可用的蓝牙 5.0 功能，该设备需要具有符合蓝牙 5 要求的芯片组。</p>
<p><strong>注意</strong>：Android 8.0 及以前版本之间的原生蓝牙堆栈的最大变化是使用<a target="_blank" rel="noopener" href="https://source.android.com/devices/architecture/treble.html?hl=zh-cn">高音</a>。Android 8.0 中的供应商实现必须使用 HIDL 而不是 <code>libbt-vendor</code>。</p>
   <img src="/2018/07/05/Bluetooth02/bluetooth_fluoride_architecture.png" alt="fluoride_archite">

<ul>
<li><p>蓝牙系统服务</p>
<p>蓝牙系统服务（位于 <code>packages/apps/Bluetooth</code> 中）被打包为 Android 应用，并在 Android 框架层实现蓝牙服务和配置文件。此应用通过 JNI 调用原生蓝牙堆栈。</p>
</li>
<li><p>JNI</p>
<p>与 android.bluetooth 相关联的 JNI 代码位于 <code>packages/apps/Bluetooth/jni</code> 中。当发生特定蓝牙操作时（例如发现设备时），JNI 代码会调用蓝牙堆栈。</p>
</li>
<li><p>蓝牙堆栈</p>
<p>系统在 AOSP 中提供了默认蓝牙堆栈，它位于 <code>system/bt</code> 中。该堆栈会实现常规蓝牙 HAL，并通过扩展程序和更改配置对其进行自定义。</p>
</li>
<li><p>供应商实现</p>
<p>供应商设备使用硬件接口设计语言 (HIDL) 与蓝牙堆栈交互。</p>
</li>
</ul>
<img src="/2018/07/05/Bluetooth02/android-stack_2x.png" alt="android-stack_2x" style="zoom:67%;">

<h4 id="HIDL"><a href="#HIDL" class="headerlink" title="HIDL"></a>HIDL</h4><p><a target="_blank" rel="noopener" href="https://source.android.com/devices/architecture/hidl.html?hl=zh-cn">HIDL</a> 定义了蓝牙堆栈和供应商实现之间的接口。要生成蓝牙 HIDL 文件，请将蓝牙接口文件传递到 HIDL 生成工具中。接口文件位于 <code>hardware/interfaces/bluetooth</code> 下。</p>
<p><del>Android 7.x 及更早版本的蓝牙架构</del></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/platform/?hl=zh-cn">https://developer.android.com/guide/platform/?hl=zh-cn</a></p>
<p><a target="_blank" rel="noopener" href="https://source.android.com/setup/">https://source.android.com/setup/</a></p>
<p><a target="_blank" rel="noopener" href="https://source.android.com/devices/bluetooth/?hl=zh-cn">https://source.android.com/devices/bluetooth/?hl=zh-cn</a></p>
<h5 id="Android-中-BLE-操作的过程"><a href="#Android-中-BLE-操作的过程" class="headerlink" title="Android 中 BLE 操作的过程"></a>Android 中 BLE 操作的过程</h5><p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5Cbluetooth_20180706120947.png" alt="bluetooth_20180706120947"></p>
<p>这里介绍一下 Android 中 BLE 操作的过程，APP 发起一个 BLE 操作，然后理解返回，操作结果通过回调上报。操作被封装为一个消息，然后放到协议栈的消息队列中，有一个独立的线程获取消息进行处理，类似于 Looper 和 Handler 机制。</p>
<p>因为是使用消息机制，回调的时候必须知道通知哪个客户端？客户端发起请求之前，首先要向协议栈注册客户端，注册成功以后，返回一个 clientIf，这是一个整型，是客户端在协议栈的一个句柄，客户端的后续操作，都只需要带上这个 clientIf 句柄即可。</p>
<p>在操作完成的时候，一般都有一个显式的停止操作，用来释放前面的申请的 clientIf 和资源。如果不能正确的释放，不仅会造成内存泄漏，而且可能会导致后续所有的 BLE 操作都是不能做了。因为这个 clientIf 是有限，在现在蓝牙协议栈中只有 32 个，而且是Android 上所有 APP 共用的。当这些资源用完以后，只有通过杀掉对应的 APP 或者重启蓝牙才能恢复。</p>
<h5 id="BLE-应用"><a href="#BLE-应用" class="headerlink" title="BLE 应用"></a>BLE 应用</h5><p>BLE 应用可以分为两大类：基于非连接的和连接的。</p>
<ul>
<li><p>Beacon 基于非连接的，这种应用就是依赖 BLE 的广播，也叫作 Beacon。这里有两个角色，发送广播的一方叫做 Broadcaster，监听广播的一方叫 Observer。</p>
</li>
<li><p>基于连接的，就是通过建立 GATT 连接，收发数据。这里也有两个角色，发起连接的一方，叫做中心设备—Central，被连接的设备，叫做外设—Peripheral。</p>
</li>
</ul>
<h6 id="非连接"><a href="#非连接" class="headerlink" title="非连接"></a>非连接</h6><p>它的网络拓扑结构如下。我们知道广播是单向的，Broadcaster 向外广播，监听者接收附近的广播，整体来说形成一个单向的星型。网络中可以有多个外设，也可以有多个监听者 </p>
<p>还有些设备，可以同时实现两个角色，既能发送广播，也可以接收广播。一个设备接收到广播，可以通过处理，然后再转发出去，这样就可以形成一个双向的网格，这就是蓝牙的 Mesh。这样的网络可以不受蓝牙传输距离限制了，只要在空间中布置足够密集的节点，就能把信息从网络一点，传递到任何一点。这个可以应用在物联网和智能家居系统中。 </p>
<p>前面在介绍协议栈物理层的时候，我们知道广播只在37、38、39这三个广播频道进行广播，监听者也在这三个频道进行监听。我们前面介绍了，蓝牙通信是跳频的，只有双方设备在某个时刻跳到同一个频到上，才能收到广播，这种传播数据效率比较低，数据量也有限，不适合大规模的数据传输。 </p>
<ul>
<li>广播包 </li>
</ul>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5CAndroid-BLE-in-Action.018.jpeg" alt="Android-BLE-in-Action.018"></p>
<p>​    广播数据其实包含两部分：Advertising Data（广播数据） 和 Scan Response Data（扫描响应数据）。通常    情况下，广播的一方，按照一定的间隔，往空中广播 Advertising Data，当某个监听设备监听到这个广播数据时    候，会通过发送 Scan Response Request，请求广播方发送扫描响应数据数据。这两部分数据的长度都是固定的 31 字节。在 Android 中，系统会把这两个数据拼接在一起，返回一个 62 字节的数组。</p>
<p>广播数据包的结构如这个图所示。广播包中是包含一个一个的小 AD structure，每个 AD structure 是一个完整的数据，它的结构是：第一个字节表示长度 n，后面紧接 n 个字节的数据。数据部分第一个字节表示数据类型，也就是后面的数据含义，后面 n - 1 个字节表示真实数据.</p>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5CAndroid-BLE-in-Action.019.jpeg" alt="Android-BLE-in-Action"></p>
<p>这些广播数据可以自己手动去解析，在 Android 5.0 也提供 ScanRecord 帮你解析，直接可以通过这个类获得有意义的数据。</p>
<ul>
<li><p>广播数据类型：设备连接属性，标识设备支持的 BLE 模式，这个是必须的。设备名字，设备包含的关键 GATT service，或者 Service data，厂商自定义数据等等。  </p>
</li>
<li><p>RSSI （信号强度 ）：RSSI 单位是 dB，通过 RSSI 能够大致推测出距离的远近。但是这个在 Android 设备上非常不靠谱，RSSI 的值波动很大，跟环境和手机的角度关系很大。 </p>
<p>​     Android 作为接收者怎么接收广播数据，扫描设备。代码其实很简单，首先创建一个 LeScanCallback，用来接收收到广播以后，回调上报数据。然后会用 BluetoothAdapter 的 startLeScan 来开始扫描，需要停止扫描的时候，使用 stopLeScan 来停止。 有 BluetoothDevice 这个参数，代表扫描到的设备，关键是设备的的 MAC 地址信息。然后就是 RSSI，表示扫描到的设备的信号强度，接下来 scanRecord 就是我们前面介绍的广播数据，这个数据的长度是62字节。值得提的一点是，BLE 所有回调函数都不是在主线程中的。</p>
<p>这里有几点需要注意，这里在不需要扫描以后，一定要 stopLeScan，而且 start 和 stop 中传入的 LeScanCallback 一定要是同一个，因为 LeScanCallback 就是我们客户端的标识。否者就会出现我们前面说的 clientIf 不释放的问题。在 Android 开发中，我们经常会使用匿名内部类来做参数，在这里就千万不要这么做。</p>
<p>在 Android 5.0 中，提供了全新的扫描 API — BluetoothLeScanner，它提供了对扫描更加精细的控制。</p>
<p>除了这种方法，还可以使用经典蓝牙扫描的方式，BluetoothAdapter 的 startDiscovery()，然后通过 BroadcastReceiver 来接收收到的广播。如果只是做 BLE 的开发，不建议使用这个方法，这是一个非常重的操作，灵活性非常差。</p>
</li>
<li><p>扫描的工作流程 </p>
<p><img src="/2018/07/05/Bluetooth02/E:/noteforme.github.io\source_posts\Bluetooth02\Android-BLE-in-Action.021.jpeg"></p>
<p>​    首先 APP 发起扫描请求，通过蓝牙的 Service 发送请求给蓝牙芯片。蓝牙芯片开始扫描，扫描到了设备，就通过回调上报。我们知道，扫描真正执行实在 BT 芯片中，只要 APP 发送了请求下去以后，Android 系统就可以休眠了，也就是我们常说的 AP （Application Processor），等扫描到了设备以后，底层 BP （Baseband Processor）就会唤醒上层 AP，执行回调通知到 APP，（动画）就像我们图中红色框标出的这样。这里有一个问题，随着我们周围的 BLE 设备逐渐增多，频繁扫描到设备，系统就会被频繁的唤醒，甚至睡眠不下去，从而导致耗电严重。</p>
<p>为了避免这种问题，耗电的问题。我们需要尽可能少的使用扫描。即使需要扫描，我们也希望尽可能少的上报扫描到的设备。这里就可以使用 Android 5.0 上提供的新接口，设置 ScanFilter，通过一定的规则过滤，只有扫描到了符合我们的规则的设备才上报，或者通过设置延迟上报，从而减少唤醒系统的次数。</p>
<p>这里总结一下扫描中一些建议。1、首先，尽可能使用新的 API，功能更强大；2、尽可能少地扫描，因为毕竟扫描是一个比较重的操作，耗电，也会减慢 BLE 连接速度；3、扫描的时候，尽量设置 ScanFilter，只扫描那些你感兴趣的设备，而不是全盘扫描；4、正确使用 API，特别是合理停止扫描，防止资源泄漏。</p>
</li>
<li><p>Android手机 作为 Broadcaster</p>
<p>从 Android 5.0 开始，Android 设备就可以像外设一样发送 BLE 广播了。这时 Android 设备之间就可以通过 BLE 来交互数据，或者发现对方设备了，例如类似 NFC 一样交换简单信息的应用，想象空间还是很大的。</p>
<p>Android 中实现的代码如下，通过前面的介绍，我们知道广播有两种包：Advertising Data 和 Scan Response Data，我们这里设置好这两种包，然后通过 BluetoothLeAdvertier 的 startAdvertising 就可以了。这里需要注意的点和前面一样，Start 了，需要注意 Stop。</p>
<p><img src="/2018/07/05/Bluetooth02/Bluetooth02%5CAndroid-BLE-in-Action.023.jpeg" alt="Android-BLE-in-Action"></p>
</li>
</ul>
<h5 id="基于连接"><a href="#基于连接" class="headerlink" title="基于连接"></a>基于连接</h5><p>BLE 连接的建立是通过 GAP 来协商和创建连接。Central 设备发起连接，外设接收连接请求，并协商连接参数。</p>
<p>前面我们介绍了 GATT，GATT 核心内容就是 Service、Characteristic 以及 Descriptor。每个 BLE 外设，根据自己的功能，向外暴露 Service 等。其实最重要的获取 Service 中的 Characteristic，Characteristic 可以被读、写、还有变化的时候有通知，这样就实现了双向的通信。</p>
<p> <img src="/2018/07/05/Bluetooth02/Bluetooth02%5Cbluetooth_2018-02-02.png" alt="bluetooth_2018-02-02.png"></p>
<p>​            连接到GATT服务器（发送数据的BLE设备）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Roshen_android/article/details/76916111">https://blog.csdn.net/Roshen_android/article/details/76916111</a></p>
<p><a target="_blank" rel="noopener" href="https://www.race604.com/android-ble-in-action/">https://www.race604.com/android-ble-in-action/</a></p>
<p> <a target="_blank" rel="noopener" href="http://yannischeng.com/Android%20BLE%20%E8%93%9D%E7%89%99%E5%BC%80%E5%8F%91/">http://yannischeng.com/Android%20BLE%20%E8%93%9D%E7%89%99%E5%BC%80%E5%8F%91/</a></p>

	
	</div>
  <a type="button" href="/2018/07/05/Bluetooth02/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2018/07/04/Bluetooth01/" >Bluetooth01</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2018-07-04  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="蓝牙名称的由来"><a href="#蓝牙名称的由来" class="headerlink" title="蓝牙名称的由来"></a>蓝牙名称的由来</h4><ul>
<li> 蓝牙这个名称来自于第十世纪的一位丹麦国王Harald Blatand,Blatand在英文里的意思可以被解为蓝牙，</li>
</ul>
<p> 因为国王喜欢吃蓝梅，牙龈每天都是蓝色的所以叫牙.</p>
<ul>
<li>蓝牙这个标志的设计：它取自 Harald Bluetooth 名字中的「H」和「B」两个字母，用古北欧字母来表示，将这两者结合起来，就成为了蓝牙的 </li>
</ul>
<p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_logo.jpg" alt="bluetooth_20180705150628"></p>
<h5 id="蓝牙技术联盟"><a href="#蓝牙技术联盟" class="headerlink" title="蓝牙技术联盟"></a>蓝牙技术联盟</h5><p><a target="_blank" rel="noopener" href="https://www.bluetooth.com/zh-cn">官网</a> </p>
<p>它负责蓝牙规范制定和推广的国际组织。做蓝牙相关产品的，少不了和它打交道。蓝牙技术联盟同时也拥有蓝牙商标，如果要使用，需要通过他们的授权。  Bluetooth SIG </p>
<h4 id="蓝牙个版本区别"><a href="#蓝牙个版本区别" class="headerlink" title="蓝牙个版本区别"></a>蓝牙个版本区别</h4><p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_20180705150628.png" alt="bluetooth_20180705150628"></p>
<p>​                 <a target="_blank" rel="noopener" href="http://www.sohu.com/a/204758166_100040477">http://www.sohu.com/a/204758166_100040477</a> </p>
<h5 id="V1-0："><a href="#V1-0：" class="headerlink" title="V1.0："></a>V1.0：</h5><p>定义了蓝牙是一种低功耗的无线技术，传输率约在748~810kb/s，因是早期设计，容易受到同频率之产品所干扰下影响通讯质量。 </p>
<h5 id="V1-1"><a href="#V1-1" class="headerlink" title="V1.1"></a>V1.1</h5><p>所有设备都使用79个子频段在2.4GHz的频谱范围之内进行相互通信。此外，Bluetooth 1.1规范也修正了互不兼容的数据格式会引发Bluetooth 1.0设备之间的互操作性问题.</p>
<h5 id="V1-2"><a href="#V1-2" class="headerlink" title="V1.2"></a>V1.2</h5><p>增加了AFH可调式跳频技术这项技术，并主要针对现有蓝牙协议和802.11b/g之间的互相干扰问题进行了全面的改进，防止用户在同时使用支持蓝牙和无线局域网(WLAN)的两种装置的时候出现互相干扰的情况。</p>
<h5 id="V2-0"><a href="#V2-0" class="headerlink" title="V2.0"></a>V2.0</h5><ul>
<li>蓝牙2.0标准2.0 是 1.2 的改良提升版，传输率约在 1.8M/s~2.1M/s</li>
<li>开始支持双工模式——即一面作语音通讯，同时亦可以传输档案/高质素图片</li>
<li>2.0 版本当然也支持 Stereo 运作。</li>
</ul>
<h5 id="V2-1"><a href="#V2-1" class="headerlink" title="V2.1"></a>V2.1</h5><p>支持通过NFC（Near Field Communication，近距离通讯）进行配对，只需要将两个蓝牙设备靠近，按下一个键就可以配对了，配对密码将通过NFC进行传输，无需手动输入。</p>
<h5 id="V3-0"><a href="#V3-0" class="headerlink" title="V3.0"></a>V3.0</h5><p>核心是加入了“Generic Alternate MAC/PHY”（AMP），使蓝牙设备能最大限度的利用多种高速无线技术中更高的传输速率。这是一种全新的交替射频技术，允许蓝牙协议栈针对任一任务动态地选择正确的射频。</p>
<h5 id="4-0"><a href="#4-0" class="headerlink" title="4.0"></a>4.0</h5><p> 首先需要说明的是，发布于2010年的蓝牙4.0标准，本身就包含两个蓝牙标准——它包含传统蓝牙部分（也有称之为经典蓝牙Classic Bluetooth），也包含有低功耗蓝牙部分（Bluetooth Low Energy）。所以，毫无疑问的，低功耗蓝牙BLE属于蓝牙4.0！  </p>
<p> 蓝牙4.0的两个部分适用于不同的产品和应用场景，如传统蓝牙部分是在之前的1.0、2.0、3.0等基础上发展和完善起来的，主要用于和此前版本蓝牙1.0、2.0、3.0的兼容以及数据量比较大的传输，如语音，音乐，较高数据量传输等。 </p>
<p> 而低功耗蓝牙部分是在Nokia的Wibree标准上发展起来的。主要用于和蓝牙4.0以及更高标准版本的兼容 ，以及用于数据传输速率比较低的产品，如遥控类的，如鼠标，键盘，遥控鼠标(Air Mouse)，传感设备的数据发送，如心跳带，血压计，温度传感器等。  </p>
<p>由于蓝牙4.0集成了传统蓝牙和低功耗蓝牙两个标准，所以蓝牙4.0有双模和单模之分。双模即是传统蓝牙部分+低功耗蓝牙部分，单模即是单纯的低功耗蓝牙部分（BLE）。</p>
<p> 一台装配有蓝牙4.0双模模块的手机，当其配对连接的是蓝牙3.0设备时，其耗电量就会相对较高。若其配对的设备是智能手环等采用低功耗蓝牙模块的设备时，其功耗就非常低。针对一对一连接优化，并支持星形拓扑的一对多连接； <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c96e0006b34d">https://www.jianshu.com/p/c96e0006b34d</a></p>
<ul>
<li>​    单模蓝牙</li>
</ul>
<p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_4ddf2.jpg" alt="bluetooth_4ddf2"></p>
<p>​                        </p>
<ul>
<li><pre><code> 双模蓝牙             
</code></pre>
</li>
</ul>
<p>  <img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cblue_b4316d821.jpg" alt="blue_b4316d821"></p>
<h5 id="V-4-1"><a href="#V-4-1" class="headerlink" title="V 4.1"></a>V 4.1</h5><ul>
<li><p>提升数据传输率</p>
<p>相比蓝牙4.0，蓝牙4.1单包数据传输最大值从20字节上调到23字节，提升了15%的数据传输率。根据该规则，大家可以尝试修改单包数据payload的值，如果该芯片只支持BT4.0，那么修改传输23字节要么会编译报错，要么传输过程中会丢包。</p>
</li>
<li><p>主从共存 central peripheral</p>
<p>链路层Link layer拓扑结构做了更新，允许单设备主从同时共存（时间片轮转方式），以及一主对多从设备的连接拓扑,当BLE作Central的时候可以一对多，但是作Peripheral的时候只能一对一。  例如智能手表可以作为发射方向手机发射身体健康指数，同时作为接收方连接到蓝牙耳机/手环或其他设备上 </p>
</li>
<li><p>支持32-Bit UUID</p>
<p>32-Bit UUID指的是广播包携带的UUID，并不是指我们所说的针对属性列表的16 bit and 128 bit UUID。可以通过广播的32-Bit UUID映射得到完整的128 Bit UUID从而使得广播包内有效广播数据长度更多。</p>
<p>长期睡眠下的自动唤醒功能。例如在佩戴手环游泳1小时后，回到更衣室手环会自动和手机建立连接传输数据，不需要任何操作 </p>
</li>
<li><p>通过IPv6建立网络连接。蓝牙设备只需要通过蓝牙4.1连接到可以上网的设备（如手机），就可以通过IPv6与云端的数据进行同步。即实现“云同步”不再需要wifi连接（wifi模块的成本通常更高，也更费电）。通过IPv6建立网络连接。蓝牙设备只需要通过蓝牙4.1连接到可以上网的设备（如手机），就可以通过IPv6与云端的数据进行同步。即实现“云同步”不再需要wifi连接（wifi模块的成本通常更高，也更费电）</p>
</li>
</ul>
<h5 id="V-4-2"><a href="#V-4-2" class="headerlink" title="V 4.2"></a>V 4.2</h5><ul>
<li><p><strong>LE连接安全</strong> </p>
<p>从Spec定义上蓝牙4.0和4.1的配对加密环节都是基于AES-CCM加密，但是由于蓝牙4.1双方共享同一密钥，所以存在被破解风险和漏洞。蓝牙4.2的pairing环节，采用Diffie-HellmanKey Exchange密钥交换算法进行加密，每一个设备有一对密钥对，公钥和私钥，私钥自己保存，公钥公开给对方，数据交互时，一方通过自己的私钥和对方的公钥进行加密文件，接收方通过自己私钥和传输方的公钥进行解密，从而有效的防止中间人破解密钥的事件发生。 </p>
</li>
<li><p><strong>隐私保护</strong> </p>
<p>蓝牙在广播过程中会携带自己的BD address (bluetooth device address)即为蓝牙唯一的MAC地址，在某些应用，比如物流追踪应用当中是非常有帮助的，可以根据BD address固定物流设备。</p>
<p>但是在某些应用不希望自己的BD address暴露在主端设备的监控下，蓝牙4.2给出了灵活的选择，蓝牙4.2规定，从机设备可以选择在广播模式下发送随机BD address，这样主端设备除了接该到设备之后才能获取其真实BD address，除此该设备广播模式的BD address为随机序列。</p>
</li>
<li><p><strong>大数据传输</strong> </p>
<p>蓝牙4.1最大支持23字节单包数据传输，蓝牙4.2最大支持255字节单包数据传输，极大提升了数据传输率。详细可以参考我写的另外一篇文章《提升蓝牙4.2数据传输率的办法 - ATT_MTU》。 </p>
</li>
</ul>
<h5 id="5-0"><a href="#5-0" class="headerlink" title="5.0"></a>5.0</h5><ul>
<li><p><strong>传输距离更快、距离更远</strong> </p>
<p>蓝牙 5.0 和前一代蓝牙 4.2 相比，它的传输距离更远、速度更快。理论上的有效距离是 300 米，也就是整个家庭或整间办公室里的移动设备都可以稳定连结。而速度最快则是可以达到 2Mbps，让反应更快、性能更高的蓝牙设备更有可能被使用。除此之外，它还大幅增强了蓝牙广播的数据传输，能为商用蓝牙带来更好的前景，让使用蓝牙做为标准的物联网应用更加强大，可以向下相容旧版本产品 。</p>
</li>
<li><p><strong>蓝牙 Mesh 技术改变传输应用</strong> </p>
<p>蓝牙技术联盟（Bluetooth SIG）日前宣布推出蓝牙 Mesh 技术，这项技术将打破传统蓝牙设备间“一对一”的配对转变成“多对多”的讯号传输模式，除了应用在蓝牙 5.0，也会扩展到过往版本。蓝牙技术联盟表示，蓝牙 Mesh 技术是基于低功耗蓝牙技术推出的新网络技术，将为商用和工业用设备网络带来转变，也能让现有的物联网技术更加完整、稳定。 </p>
</li>
<li></li>
</ul>
<p><a target="_blank" rel="noopener" href="http://www.eet-china.com/news/article/201711190911">http://www.eet-china.com/news/article/201711190911</a></p>
<h5 id="蓝牙5-0和wifi的区别"><a href="#蓝牙5-0和wifi的区别" class="headerlink" title="蓝牙5.0和wifi的区别"></a>蓝牙5.0和wifi的区别</h5><ul>
<li><p>WIFI</p>
<p>Wi-Fi 的一大缺陷就是有距离限制，包括过去一对一蓝牙网络在内的传统无线网络，都会受两台设备距离的限制。以 Wi-Fi 来说，有效的传输距离为 50 平方米以内，除非你装中继设备，一旦离开这个区域，你的手机就失去用武之地。</p>
<p>除此之外，Wi-Fi 还有耗电问题，你的手机就算是把屏幕关闭，还是得一天充一次电，Wi-Fi 是一个很重要的因素。</p>
</li>
<li><p>蓝牙 Mesh </p>
<p>“蓝牙 Mesh”找到一个聪明的解决办法。这些设备彼此间连接，并将信号传递给附近另一个设备，形成中继资料传输的互连设备网络或网格。这意味着讯息从一个设备传递到另一个设备，再到下一个设备，接力传输。 </p>
</li>
</ul>
<p><img src="/2018/07/04/Bluetooth01/Bluetooth01%5Cbluetooth_20180705175518.png" alt="bluetooth_20180705150628"></p>
<p><strong>▲ 左图为传统 Wi-Fi 的连接方式，必须要有一个 Hub 连系其他设备，因此有距离限制。右图则是蓝牙 Mesh 的方式，越多设备连到这个网络上，范围就会越广。</strong> </p>
<p>与传统的交换式网络相比，无线Mesh网络去掉了节点之间的布线需求，但仍具有分布式网络所提供的冗余机制和重新路由功能。在无线Mesh网络里，如果要添加新的设备，只需要简单地接上电源就可以了，它可以自动进行自我配置，并确定最佳的多跳传输路径。添加或移动设备时，网络能够自动发现拓扑变化，并自动调整通信路由，以获取最有效的传输路径。  </p>
<p>透过这种接力传输，形成一个无需大量电力消耗或天线广布的可靠网络。蓝牙设备之间可不透过 Wi-Fi 网络就能实现设备与设备的“对话”。换句话说，智能设备采用这种技术，在有限范围内就能完成设备间的沟通，并利用手机等设备来控制。</p>
<p>过去因为家中需要有一个 Hub 连接其他设备，因此有 Google、Apple、Amazon 等这些“语音助手”出现，用这些当成控制中枢。但蓝牙 Mesh 架构下，你不需要另外一个“中枢”，用智能手机就可以掌握一切。家中的蓝牙设备建构自己的网络，手机只要与其中一个蓝牙设备取得联系，就可以控制全家（整个建筑物）设备，监控这些设备的状态。</p>
<p>由于 Mesh 网络不需复杂设定、配对或使用路由器等存取设备，因此并不会造成安装负担，反观采用其他智慧家庭联网技术如 ZigBee、Z-wave 或其他厂商间自有的通讯技术，多需加装闸道器（Gateway）才能确保各种设备沟通无虞。</p>
<ul>
<li><p>蓝牙 Mesh 工作原理：为什么还是无法取代 Wi-Fi？</p>
<p>蓝牙 BLE 通讯协议中，GAP 层（Generic Access Profile）用来控制决定蓝牙设备的扫描、广播和连接等关系，也就是说，GAP 决定蓝牙设备怎样与其他设备连接、被其他设备看到等流程。 在蓝牙 mesh 出现之前，GAP 有一个典型的父子网络关系，其中“父”端决定所有路由，“子”端执行分配的任务。 例如，当你将蓝牙键盘连接到平板电脑，平板为父端、键盘为子端。</p>
<p>GAP 使你的设备被其他设备看见，并决定你的设备是否可以或怎样与其他设备互动。例如常用在室内定位的 Beacon 设备就只是向外广播，不支持连接。智能手环等设备，就可以与你的手机设备连接。</p>
<p>从蓝牙 4.1 开始，GAP 扩大了蓝牙设备的网络能力。蓝牙设备可兼具“父”和“子”的功能，使所有设备能直接连接和广播到任何其他设备。蓝牙也因此适用传输范围内和传输范围外的所有设备。</p>
<p>正是上述这种能直接或间接连接任何数量有 Mesh 功能的设备，因此理论上建构一个长达几公里范围的 Mesh 网络也不是不可能。 如果网络中每个设备都在其他至少一个设备的广播范围内，Mesh 网络理论上可覆盖无限距离。</p>
<p>在这情况下，灯泡就可能成为一个家庭主要 Mesh 网络设备之一，因为一个家庭或是建筑，几乎每个角落都有光线覆盖的需要，因此灯泡就会以保持一定距离的方式连续安装。如果每个灯泡都是蓝牙 Mesh 设备，那么这个网络就得以全面覆盖建筑物。</p>
<p>蓝牙 Mesh 网络不仅有低功耗，还有低频宽的特色。这听起来好像是个缺点？其实不然。 由于蓝牙 Mesh 网络不是用来让你发送影音资料，主要是用来传递维护连接或发送命令，发送一个“关闭”或“打开”的指定，用不到多少频宽。这就是为什么蓝牙 Mesh 网络虽然范围无远弗届，但无法完全取代 Wi-Fi。 乍看很像，但仔细了解后，你会发现它们适合不同的利基市场。</p>
<p><a target="_blank" rel="noopener" href="http://www.icsmart.cn/13985/">http://www.icsmart.cn/13985/</a></p>
<p><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection">https://en.wikipedia.org/wiki/Bluetooth#Communication_and_connection</a></p>
</li>
</ul>

	
	</div>
  <a type="button" href="/2018/07/04/Bluetooth01/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
     <a href="/page/13/" type="button" class="btn btn-default"><i class="fa fa-arrow-circle-o-left"></i> Prev</a>
      

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/15/" type="button" class="btn btn-default ">Next<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/ANDROID/">ANDROID<span>58</span></a></li>
		
			<li><a href="/categories/BLE/">BLE<span>4</span></a></li>
		
			<li><a href="/categories/DataStructure/">DataStructure<span>16</span></a></li>
		
			<li><a href="/categories/DesignPatterns/">DesignPatterns<span>9</span></a></li>
		
			<li><a href="/categories/ENGLISH/">ENGLISH<span>1</span></a></li>
		
			<li><a href="/categories/JAVA/">JAVA<span>27</span></a></li>
		
			<li><a href="/categories/Jetpack/">Jetpack<span>5</span></a></li>
		
			<li><a href="/categories/Kotlin/">Kotlin<span>11</span></a></li>
		
			<li><a href="/categories/LINUX/">LINUX<span>5</span></a></li>
		
			<li><a href="/categories/Mathematics/">Mathematics<span>1</span></a></li>
		
			<li><a href="/categories/OS/">OS<span>2</span></a></li>
		
			<li><a href="/categories/Organization/">Organization<span>2</span></a></li>
		
			<li><a href="/categories/SOURCE/">SOURCE<span>1</span></a></li>
		
			<li><a href="/categories/TEST/">TEST<span>4</span></a></li>
		
			<li><a href="/categories/TOOL/">TOOL<span>11</span></a></li>
		
			<li><a href="/categories/VIEW/">VIEW<span>12</span></a></li>
		
			<li><a href="/categories/anim/">anim<span>4</span></a></li>
		
			<li><a href="/categories/flutter/">flutter<span>5</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/BLOG/">BLOG<span>1</span></a></li>
		
			<li><a href="/tags/ANDROID/">ANDROID<span>3</span></a></li>
		
			<li><a href="/tags/Performance/">Performance<span>4</span></a></li>
		
			<li><a href="/tags/RxJava/">RxJava<span>4</span></a></li>
		
			<li><a href="/tags/THINK/">THINK<span>1</span></a></li>
		
			<li><a href="/tags/Test/">Test<span>4</span></a></li>
		
			<li><a href="/tags/AndroidNewFeatures/">AndroidNewFeatures<span>1</span></a></li>
		
			<li><a href="/tags/XML/">XML<span>1</span></a></li>
		
			<li><a href="/tags/coroutie/">coroutie<span>7</span></a></li>
		
			<li><a href="/tags/TOOL/">TOOL<span>2</span></a></li>
		
			<li><a href="/tags/concurrency/">concurrency<span>4</span></a></li>
		
			<li><a href="/tags/Drawer/">Drawer<span>1</span></a></li>
		
			<li><a href="/tags/Git/">Git<span>2</span></a></li>
		
			<li><a href="/tags/inter/">inter<span>8</span></a></li>
		
			<li><a href="/tags/TabLayout/">TabLayout<span>1</span></a></li>
		
			<li><a href="/tags/ConstraintLayout/">ConstraintLayout<span>1</span></a></li>
		
			<li><a href="/tags/VIEW/">VIEW<span>2</span></a></li>
		
			<li><a href="/tags/proguard/">proguard<span>1</span></a></li>
		
			<li><a href="/tags/Activity/">Activity<span>1</span></a></li>
		
			<li><a href="/tags/keyboard/">keyboard<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>31</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2023/09/04/Android_interview organize/" ><i class="fa fa-file-o"></i>Android_itnerview_organize</a>
      </li>
    
      <li>
        <a href="/2023/09/03/Android-itnerview-algorithm/" ><i class="fa fa-file-o"></i>Android_itnerview_algorithm</a>
      </li>
    
      <li>
        <a href="/2023/08/20/compose-layout/" ><i class="fa fa-file-o"></i>compose_layout</a>
      </li>
    
      <li>
        <a href="/2023/08/19/compose/" ><i class="fa fa-file-o"></i>compose</a>
      </li>
    
      <li>
        <a href="/2023/08/09/LC-DP-BAG/" ><i class="fa fa-file-o"></i>LC_DP_BAG</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="false"></i><a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" title="" target="_blank"]);">hexo-theme-bithack</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 Jon's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
