<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Jon&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
  
    <link rel="alternate" href="/atom.xml" title="Jon's Blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
    
<link rel="stylesheet" href="/localshare/css/share.css">

  
  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jon&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Cease to struggle and you cease to live. - Thomas Carlyle</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/."><i class="fa fa-home"></i> Home</a>
        
          <a class="main-nav-link" href="/archives/"><i class="fa fa-archive"></i> Archive</a>
        
          <a class="main-nav-link" href="/about/"><i class="fa fa-user"></i> About</a>
        
          <a class="main-nav-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a>
        
      </nav>
    </div>
    <div id="search-form">
      <div id="result-mask" class="hide"></div>
      <label><input id="search-key" type="text" autocomplete="off" placeholder="search"></label>
      <div id="result-wrap" class="hide">
        <div id="search-result"></div>
      </div>
      <div class="hide">
        <template id="search-tpl">
          <div class="item">
            <a href="/{path}" title="{title}">
              <div class="title">{title}</div>
              <div class="time">{date}</div>
              <div class="tags">{tags}</div>
            </a>
          </div>
        </template>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  <article id="post-OS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/28/OS/">OS</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-12-28T07:32:28.000Z" itemprop="datePublished">2020年12月28日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/OS/">OS</a>
  </div>

      
      
<a href="/2020/12/28/OS/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>2020 南京大学 “操作系统：设计与实现” (蒋炎岩)</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1N741177F5?p=1&amp;vd_source=d4c5260002405798a57476b318eccac9">https://www.bilibili.com/video/BV1N741177F5?p=1&amp;vd_source=d4c5260002405798a57476b318eccac9</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/NJU-ProjectN/am-kernels">https://github.com/NJU-ProjectN/am-kernels</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/NJU-ProjectN/abstract-machine">https://github.com/NJU-ProjectN/abstract-machine</a></p>
<p>实验不开源,可以了解</p>
<p><a target="_blank" rel="noopener" href="https://github.com/mansicer/NJU-OSlab-2019/issues/1">https://github.com/mansicer/NJU-OSlab-2019/issues/1</a></p>
<p><a target="_blank" rel="noopener" href="https://nju-projectn.github.io/ics-pa-gitbook/ics2019/">https://nju-projectn.github.io/ics-pa-gitbook/ics2019/</a></p>
<h4 id="学习计划"><a href="#学习计划" class="headerlink" title="学习计划"></a>学习计划</h4><p>MIT6.S081实验 + 操作系统导论</p>
<p><a target="_blank" rel="noopener" href="https://github.com/woai3c/MIT6.828">https://github.com/woai3c/MIT6.828</a></p>
<p><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2018/index.html">https://pdos.csail.mit.edu/6.828/2018/index.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/40973610">https://www.zhihu.com/question/40973610</a></p>
<p>RISC-V 微处理器</p>
<p>xv6</p>
<h5 id="实验环境配置"><a href="#实验环境配置" class="headerlink" title="实验环境配置"></a>实验环境配置</h5><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/343655412">https://zhuanlan.zhihu.com/p/343655412</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/272199762">https://zhuanlan.zhihu.com/p/272199762</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/331492444">https://zhuanlan.zhihu.com/p/331492444</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV11K4y127Qk?from=search&amp;seid=8628043749223720261">https://www.bilibili.com/video/BV11K4y127Qk?from=search&amp;seid=8628043749223720261</a></p>
<p>错误1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR: glib-2.48 gthread-2.0 is required to compile QEMU</span><br><span class="line"></span><br><span class="line">处理</span><br><span class="line">sudo apt-get install libglib2.0-dev</span><br></pre></td></tr></table></figure>

<p>错误2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ERROR: pixman &gt;&#x3D; 0.21.8 not present.</span><br><span class="line">       Please install the pixman devel package.</span><br><span class="line">       </span><br><span class="line">处理</span><br><span class="line">sudo apt-get install libpixman-1-dev</span><br></pre></td></tr></table></figure>



<h4 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h4><ol>
<li><p>在user目录下创建copy.c</p>
</li>
<li><p>在Makefile 152行添加配置</p>
<img src="/2020/12/28/OS/20200919151509556.png" style="zoom:50%;"></li>
<li><p>测试添加程序</p>
<p>启动xv6后，执行copy</p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013577996/article/details/108680888">https://blog.csdn.net/u013577996/article/details/108680888</a></p>
<h5 id="课程学习"><a href="#课程学习" class="headerlink" title="课程学习"></a>课程学习</h5><h5 id="3-4内核执行任何内核指令"><a href="#3-4内核执行任何内核指令" class="headerlink" title="3.4内核执行任何内核指令"></a>3.4内核执行任何内核指令</h5><p>3.4 之前提到，设置处理器中kernel mode的bit位的指令是一条特殊权限指令，那么一个用户程序怎么才能让内核执行任何内核指令？因为现在切换到kernel mode的指令都是一条特殊权限指令了，对于用户程序来说也没法修改那个bit位</p>
<p>用户程序会通过系统调用来切换到kernel mode。当用户程序执行系统调用，会通过ECALL触发一个软中断（software interrupt），软中断会查询操作系统预先设定的中断向量表，并执行中断向量表中包含的中断处理程序。中断处理程序在内核中，这样就完成了user mode到kernel mode的切换，并执行用户程序想要执行的特殊权限指令？ </p>
<p><strong>针对这个回答，我的疑问是，怎么确保恶意程序不走这种系统调用呢</strong></p>
<h5 id="3-9-断点调试"><a href="#3-9-断点调试" class="headerlink" title="3.9 断点调试"></a>3.9 断点调试</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">一个窗口</span><br><span class="line"></span><br><span class="line">make CPUS&#x3D;1 qemu-gdb</span><br><span class="line"></span><br><span class="line">新开窗口 </span><br><span class="line"></span><br><span class="line">gdb-multiarch kernel&#x2F;kernel</span><br><span class="line">target remote localhost:26000</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/331492444">https://zhuanlan.zhihu.com/p/331492444</a></p>
<p>GDB简单使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ctrl x a 显示代码</span><br><span class="line"> b 断点</span><br><span class="line"> r运行</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2020/12/28/OS/GDB_2021-05-11_22-43-21.png"></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ei4y1V758?from=search&amp;seid=4972450432119771986">https://www.bilibili.com/video/BV1ei4y1V758?from=search&amp;seid=4972450432119771986</a></p>
<h5 id="4-3页表"><a href="#4-3页表" class="headerlink" title="4.3页表"></a>4.3页表</h5><p><img src="/2020/12/28/OS/2021-05-13_pagetable.png"></p>
<p>在最高级的page directory中的PPN，包含了下一级page directory的物理内存地址，  第二个9bit用来索引中间级的page directory，第三个9bit用来索引最低级的page directory。在最低级page directory，我们还是可以得到44bit的PPN，这里包含了我们实际上想要翻译的物理page地址，然后再加上虚拟内存地址的12bit offset，就得到了56bit物理内存地址。</p>
<p>第一个level1有了Level2页表的物理地址，Level2的 PPN就是页表的偏移量,指向Level3的物理地址.</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1zt4y1U7rq?from=search&amp;seid=11572648099017443360">https://www.bilibili.com/video/BV1zt4y1U7rq?from=search&amp;seid=11572648099017443360</a></p>
<h4 id="启动概览"><a href="#启动概览" class="headerlink" title="启动概览"></a>启动概览</h4><p><img src="/2020/12/28/OS/2021-04-13at1.36.29PM.png"></p>
<p>​    </p>
<p>简单来说 就是加电后，1。启动主板BIOS  》 2. BIOS初始化从磁盘中把加载程序bootloader 加载到内存中 》3.把磁盘镜像操作系统加载到内存中运行</p>
<p><strong>为什么不在第二步直接加载操作系统呢?</strong>  1. 为了兼容不同的文件系统  2. bootloader只能存 512字节，系统远大于它。 </p>
<p><a target="_blank" rel="noopener" href="https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html">https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html</a></p>
<h5 id="BIOS初始化"><a href="#BIOS初始化" class="headerlink" title="BIOS初始化"></a>BIOS初始化</h5><ol>
<li>硬件自检POST,检测系统中（内存和显卡，软盘 ，影片 光盘 USB)等关键部件的存在和工作状态查找并执行显卡等接口卡BIOS,并进行设备初始化；</li>
<li>加载上述设备的第一个扇区（主引导扇区，Master Boot Record,or MBR）的512字节的内容读到内存固定地址0x7c00，这个内容就是bootloader,等待对Ucore操作系统的加载.</li>
</ol>
<h5 id="bootloader做的事情"><a href="#bootloader做的事情" class="headerlink" title="bootloader做的事情"></a>bootloader做的事情</h5><ol>
<li>从实模式切换到保护模式(protection mdoe) ，为后续操作系统的执行做准备。</li>
<li>从硬盘上读取kernel in ELF格式的ucore kernel(就是系统代码，跟在MBR后面的扇区)并放到内存中固定位置。</li>
<li>跳转到ucore OS的入口点(entry point)执行，这时候控制器交给了 ucore.</li>
</ol>
<h5 id="第二部细节-加载程序"><a href="#第二部细节-加载程序" class="headerlink" title="第二部细节 加载程序"></a>第二部细节 加载程序</h5><p>![](OS\2021-04-13at1.36.29 PM.png)</p>
<p>​    计算机可能有不止一个分区，每个分区有不同的系统，主引导记录来确定去哪个文件系统读加载程序</p>
<ol>
<li><p>BIOS启动过程</p>
<p>当计算机加电后，一般不直接执行操作系统，而是执行系统初始化软件完成基本IO初始化和引导加载功能(BIOS)。简单地说，系统初始化软件就是在操作系统内核运行之前运行的一段小软件。通过这段小软件，我们可以初始化硬件设备、建立系统的内存空间映射图，从而将系统的软硬件环境带到一个合适的状态，以便为最终调用操作系统内核准备好正确的环境。最终引导加载程序把操作系统内核映像加载到RAM中，并将系统控制权传递给它。 </p>
<p>对于绝大多数计算机系统而言，操作系统和应用软件是存放在磁盘（硬盘/软盘）、光盘、EPROM、ROM、Flash等可在掉电后继续保存数据的存储介质上。计算机启动后，CPU一开始会到一个特定的地址开始执行指令，这个特定的地址存放了系统初始化软件，负责完成计算机基本的IO初始化，这是系统加电后运行的第一段软件代码。对于Intel 80386的体系结构而言，PC机中的系统初始化软件由BIOS (Basic Input Output  System，即基本输入/输出系统，<strong>其本质是一个固化在主板Flash/CMOS上的软件</strong>)和位于软盘/硬盘引导扇区中的OS Boot  Loader（在ucore中的bootasm.S和bootmain.c）一起组成。BIOS实际上是被固化在计算机ROM（只读存储器）芯片上的一个特殊的软件，为上层软件提供最底层的、最直接的硬件控制与支持。更形象地说，BIOS就是PC计算机硬件与上层软件程序之间的一个”桥梁”，负责访问和控制硬件。 </p>
<p>以Intel  80386为例，计算机加电后，CPU从物理地址0xFFFFFFF0（由初始化的CS：EIP确定，此时CS和IP的值分别是0xF000和0xFFF0)）开始执行。在0xFFFFFFF0这里只是存放了一条跳转指令，通过跳转指令跳到BIOS例行程序起始点。BIOS做完计算机硬件自检和初始化后，会选择一个启动设备（例如软盘、硬盘、光盘等），并且读取该设备的第一扇区(即主引导扇区或启动扇区)到内存一个特定的地址0x7c00处，然后CPU控制权会转移到那个地址继续执行。至此BIOS的初始化工作做完了，进一步的工作交给了ucore的bootloader。</p>
</li>
<li><p>bootloader启动过程</p>
<p>BIOS将通过读取硬盘主引导扇区到内存，并转跳到对应内存中的位置执行bootloader。bootloader完成的工作包括：</p>
<ul>
<li>切换到保护模式，启用分段机制</li>
<li>读磁盘中ELF执行文件格式的ucore操作系统到内存</li>
<li>显示字符串信息</li>
<li>把控制权交给ucore操作系统</li>
</ul>
<p>对应其工作的实现文件在lab1中的boot目录下的三个文件asm.h、bootasm.S和bootmain.c。下面从原理上介绍完成上述工作的计算机系统硬件和软件背景知识。</p>
</li>
<li><p>操作系统启动过程</p>
<p>当bootloader通过读取硬盘扇区把ucore在系统加载到内存后，就转跳到ucore操作系统在内存中的入口位置（kern/init.c中的kern_init函数的起始地址），这样ucore就接管了整个控制权。当前的ucore功能很简单，只完成基本的内存管理和外设中断管理。ucore主要完成的工作包括：</p>
<ul>
<li>初始化终端；</li>
<li>显示字符串；</li>
<li>显示堆栈中的多层函数调用关系；</li>
<li>切换到保护模式，启用分段机制；</li>
<li>初始化中断控制器，设置中断描述符表，初始化时钟中断，使能整个系统的中断机制；</li>
<li>执行while（1）死循环。</li>
</ul>
<p>以后的实验中会大量涉及各个函数直接的调用关系，以及由于中断处理导致的异步现象，可能对大家实现操作系统和改正其中的错误有很大影响。而理解好函数调用关系的建立机制和中断处理机制，对后续实验会有很大帮助。下面就练习5涉及的函数栈调用关系和练习6中的中断机制的建立进行阐述。</p>
</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html">https://objectkuan.gitbooks.io/ucore-docs/content/lab1/lab1_3_booting.html</a></p>
<h4 id="系统调用"><a href="#系统调用" class="headerlink" title="系统调用"></a>系统调用</h4><h5 id="POSIX"><a href="#POSIX" class="headerlink" title="POSIX"></a>POSIX</h5><p>Portable Operating System Interface of Unix(IEEE制定的一个标准族)</p>
<p>操作系统给上层提供的接口，macos,Linux都遵循这个接口。</p>
<p>内核态 0 ， 用户态 3         </p>
<p>GDT表存了DPL为0，用户访问CPL为3， 3 &gt; 0 没法访问。 </p>
<p>0x80到内核中</p>
<h4 id="中断、异常和系统调用"><a href="#中断、异常和系统调用" class="headerlink" title="中断、异常和系统调用"></a>中断、异常和系统调用</h4><img src="/2020/12/28/OS/2021-04-12191642.png" style="zoom:75%;">

<p>中断</p>
<p>硬件设对操作系统备的处理请求（缓存区里有数据，需要内核读走。或者缓冲区里数据用完了，需要内核补充新的数据）</p>
<p>异常</p>
<p>非法指令或者其他原因导致当前指令执行失败（程序出错后的处理请求）</p>
<p>系统调用</p>
<p>应用程序主动向操作系统发出的服务请求</p>
<h4 id="物理内存管理：-连续内存分配"><a href="#物理内存管理：-连续内存分配" class="headerlink" title="物理内存管理： 连续内存分配"></a>物理内存管理： 连续内存分配</h4><p>最先匹配（First Fit Allocation）：</p>
<p>空闲分区列表按地址顺序排序</p>
<p>分配过程时，搜索第一个合适的分区，如果有剩下的空闲分区，继续把空闲分区切割出来，所以会产生碎片。</p>
<p>释放分区时，检查是否可与临近的空闲分区合并</p>
<p>最佳匹配（Best Fit Allocation）</p>
<p>空闲分区列表按照 小到大排序</p>
<p>分配时，查找比需要分区大的最小的分区，可避免大的空闲分区被拆分，减少碎片大小。</p>
<p>释放时，超找并且合并临近地址的空闲分区（如果找到）</p>
<p><img src="/2020/12/28/OS/2021-04-1514-27-29.png" style="zoom: 67%;">Screenshot from </p>
<p>最差匹配(WORST Fit Allocation)</p>
<p>空闲分区列表按大到小排序</p>
<p>分配时，选最大的分区，后续找大分区比较难。</p>
<p>释放时，检查是否可与临近的空闲分区合并，进行可能的合并并调整空闲分区列表顺序。</p>
<p>伙伴系统</p>
<h4 id="非连续内存分配"><a href="#非连续内存分配" class="headerlink" title="非连续内存分配"></a>非连续内存分配</h4><ol>
<li><p>虚拟地址和物理地址的转换</p>
<p>软件实现  硬件实现</p>
</li>
<li><p>非连续分配的硬件辅助记者</p>
<p>段式存储管理（segmentation）: 分的比较大</p>
<p><img src="/2020/12/28/OS/2021-04-1516-01-54.png"></p>
<p>页式存储管理 （paging）</p>
<p>把物理地址空间划分为大小相同的基本分配单位，2的n次方，如512,4096</p>
</li>
</ol>
<p>linux启动 </p>
<p><a target="_blank" rel="noopener" href="http://c.biancheng.net/view/1013.html">http://c.biancheng.net/view/1013.html</a></p>
<h4 id="linux目录结构"><a href="#linux目录结构" class="headerlink" title="linux目录结构"></a>linux目录结构</h4><table>
<thead>
<tr>
<th>目录</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>/bin</td>
<td>存放二进制可执行文件(ls,cat,mkdir等)，常用命令一般都在这里</td>
</tr>
<tr>
<td>/etc</td>
<td>存放系统管理和配置文件</td>
</tr>
<tr>
<td>/home</td>
<td>存放所有用户文件的根目录，是用户主目录的基点，比如用户user的主目录就是 /home/user</td>
</tr>
<tr>
<td>/usr</td>
<td>用于存放系统应用程序，比较重要的目录/usr/local 本地系统管理员软件安装目录</td>
</tr>
<tr>
<td>/opt</td>
<td><code>额外安装的可选应用程序包所放置的位置 </code></td>
</tr>
<tr>
<td>/proc</td>
<td>虚拟文件系统目录，是系统内存的映射。可直接访问这个目录来获取系统信息。</td>
</tr>
<tr>
<td>/root</td>
<td><code>超级用户(系统管理员)的主目录 </code></td>
</tr>
<tr>
<td>/sbin</td>
<td>存放二进制可执行文件，只有root才能访问</td>
</tr>
<tr>
<td>/dev</td>
<td>用于存放设备文件</td>
</tr>
<tr>
<td>/mnt</td>
<td>系统管理员安装临时文件系统的安装点，系统提供这个目录是让用户临时挂载其他的文件系 统。</td>
</tr>
<tr>
<td>/boot</td>
<td><code>存放用于系统引导时使用的各种文件 </code></td>
</tr>
<tr>
<td>/lib</td>
<td><code>存放跟文件系统中的程序运行所需要的共享库及内核模块 </code></td>
</tr>
<tr>
<td>/var</td>
<td><code>用于存放运行时需要改变数据的文件 </code></td>
</tr>
</tbody></table>
<h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>进程调度 : FIFO , Priority</p>
<h5 id="进程切换"><a href="#进程切换" class="headerlink" title="进程切换"></a>进程切换</h5><p>进程当前的状态存放到PCB(Process Control Block)中，获取下一个需要执行进程的PCB信息，切换进程。</p>
<p><img src="/2020/12/28/OS/2021-04-1612-09-25.png"></p>
<h5 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h5><p><img src="/2020/12/28/OS/2021-04-1612-16-25.png"></p>
<p>线程 指令的切换，映射表不用切换    </p>
<h6 id="2个线程用一个栈的情况"><a href="#2个线程用一个栈的情况" class="headerlink" title="2个线程用一个栈的情况"></a>2个线程用一个栈的情况</h6><p><img src="/2020/12/28/OS/2021-04-1614-27-23.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;第一个Yield</span><br><span class="line">void Yield()&#123; </span><br><span class="line">	找到300；</span><br><span class="line">	jmp 300;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;第二个Yield</span><br><span class="line">void Yield()&#123;</span><br><span class="line">	找到 ? ; 204</span><br><span class="line">	jmp ? ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>按照    (1)  -&gt; (2) -&gt; (3)的顺序执行，执行玩D()中的Yield()回到B()中，到了 右括号ret 出栈，出去的是404,正确的情况时时出204</p>
<h6 id="两个线程-两个栈"><a href="#两个线程-两个栈" class="headerlink" title="两个线程 两个栈"></a>两个线程 两个栈</h6><p><img src="/2020/12/28/OS/2021-04-1615-11-08.png"></p>
<p>jmp 204去掉：否则会执行两次</p>
<h6 id="用户程序-内核程序调用"><a href="#用户程序-内核程序调用" class="headerlink" title="用户程序 内核程序调用"></a>用户程序 内核程序调用</h6><img src="/2020/12/28/OS/2021-04-1615-59-43.png" style="zoom:50%;">

<h6 id="多核处理"><a href="#多核处理" class="headerlink" title="多核处理"></a>多核处理</h6><img src="/2020/12/28/OS/2021-04-1616-01-19.png" style="zoom:80%;">

<img src="/2020/12/28/OS/2021-04-1616-01-07.png" style="zoom:50%;">



<p>多核情况共用一个MMU,减少切换资源调用。</p>
<p>进程线程区别</p>
<p>进程 : 有很大的独立性</p>
<p>线程 :  所有线程都有完全一样的地址空间,意味着它们也共享同样的全局变量。由于线程可以访问进程地址空间的每一个内存地址，所以一个线程可以读、写甚至清除另一个线程的堆栈。</p>
<p>每个进程中的内容 : 地址空间  全局变量 打开文件 子进程    即将发生的定时器    信号与信号处理程序</p>
<p>每个线程中的内容：程序计数器、寄存器、堆栈、状态.</p>
<h4 id="同步"><a href="#同步" class="headerlink" title="同步"></a>同步</h4><p>原子性</p>
<p>原子性是指一系列操作不可被中断的特性,这一系列操作要么全部执行完成，要么全部没有执行,不存在部分执行部分未执行的情况</p>
<h5 id="互斥量"><a href="#互斥量" class="headerlink" title="互斥量"></a>互斥量</h5><p>​            互斥量是最简单的线程同步的方法,处于两态之一的变量:解锁和加锁,两个状态可以保证资源访问的串行</p>
<h5 id="自旋锁与自适应自旋"><a href="#自旋锁与自适应自旋" class="headerlink" title="自旋锁与自适应自旋"></a>自旋锁与自适应自旋</h5><ul>
<li> 自旋锁</li>
</ul>
<p>​            自旋锁的线程会反复检查锁变量是否可用,自旋锁不会让出CPU，是一种忙等待状态,</p>
<p>​            自旋锁避免了进程或线程上下文切换的开销</p>
<p>​            自旋锁不适合在单核CPU使用</p>
<p>​            自旋锁的线程会反复检查锁变量是否可用</p>
<ul>
<li><p>自适应自旋</p>
<p>提到了互斥同步对性能最大的影响是阻塞的实现，挂起线程和恢 复线程的操作都需要转入内核态中完成，这些操作给Java虚拟机的并发性能带来了很大的压力。同 时，虚拟机的开发团队也注意到在许多应用上，共享数据的锁定状态只会持续很短的一段时间，为了 这段时间去挂起和恢复线程并不值得。现在绝大多数的个人电脑和服务器都是多路(核)处理器系 统，如果物理机器有一个以上的处理器或者处理器核心，能让两个或以上的线程同时并行执行，我们 就可以让后面请求锁的那个线程“稍等一会”，但不放弃处理器的执行时间，看看持有锁的线程是否很 快就会释放锁。为了让线程等待，我们只须让线程执行一个忙循环(自旋)，这项技术就是所谓的自 旋锁。</p>
<p>自旋锁在JDK 1.4.2中就已经引入，只不过默认是关闭的，可以使用-XX:+UseSpinning参数来开 启，在JDK 6中就已经改为默认开启了。自旋等待不能代替阻塞，且先不说对处理器数量的要求，自 旋等待本身虽然避免了线程切换的开销，但它是要占用处理器时间的，所以如果锁被占用的时间很 短，自旋等待的效果就会非常好，反之如果锁被占用的时间很长，那么自旋的线程只会白白消耗处理 器资源，而不会做任何有价值的工作，这就会带来性能的浪费。因此自旋等待的时间必须有一定的限 度，如果自旋超过了限定的次数仍然没有成功获得锁，就应当使用传统的方式去挂起线程。自旋次数 的默认值是十次，用户也可以使用参数-XX:PreBlockSp in来自行更改。</p>
<p>不过无论是默认值还是用户指定的自旋次数，对整个Java虚拟机中所有的锁来说都是相同的。在 JDK 6中对自旋锁的优化，引入了自适应的自旋。自适应意味着自旋的时间不再是固定的了，而是由 前一次在同一个锁上的自旋时间及锁的拥有者的状态来决定的。如果在同一个锁对象上，自旋等待刚 刚成功获得过锁，并且持有锁的线程正在运行中，那么虚拟机就会认为这次自旋也很有可能再次成 功，进而允许自旋等待持续相对更长的时间，比如持续100次忙循环。另一方面，如果对于某个锁，自 旋很少成功获得过锁，那在以后要获取这个锁时将有可能直接省略掉自旋过程，以避免浪费处理器资 源。有了自适应自旋，随着程序运行时间的增长及性能监控信息的不断完善，虚拟机对程序锁的状况 预测就会越来越精准，虚拟机就会变得越来越“聪明”了。</p>
</li>
</ul>
<h5 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h5><p>​            读写锁是一种特殊的自旋锁,</p>
<p>​            允许多个读者同时访问资源以提高读性能</p>
<p>​            对于写操作则是互斥的</p>
<h5 id="条件变量"><a href="#条件变量" class="headerlink" title="条件变量"></a>条件变量</h5><p>​            条件变量是一种相对复杂的线程同步方法    </p>
<p>​            条件变量允许线程睡眠，直到满足某种条件</p>
<p>​            当满足条件时，可以向该线程信号，通知唤醒</p>
<h4 id="mooc-os-lab"><a href="#mooc-os-lab" class="headerlink" title="mooc-os-lab"></a>mooc-os-lab</h4><p>[现代操作系统] 示例 p55</p>
<p>先学习(现代操作系统) 陈渝 向勇</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1js411b7vg?from=search&amp;seid=2361361014547524697">https://www.bilibili.com/video/BV1js411b7vg?from=search&amp;seid=2361361014547524697</a></p>
<p>配套书： 操作系统概念(第七版) ， 操作系统-精髓与设计原理（第七版）william stallings</p>
<h5 id="实验环境配置-1"><a href="#实验环境配置-1" class="headerlink" title="实验环境配置"></a>实验环境配置</h5><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Zz4y1d7BK?from=search&amp;seid=14777231705696776183">https://www.bilibili.com/video/BV1Zz4y1d7BK?from=search&amp;seid=14777231705696776183</a></p>
<p><a target="_blank" rel="noopener" href="http://os.cs.tsinghua.edu.cn/oscourse/OS2020spring">http://os.cs.tsinghua.edu.cn/oscourse/OS2020spring</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/LearningOS/ucore_os_lab">ucore实验基准源代码</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/s/video/BV1Zz4y1d7BK">https://www.bilibili.com/s/video/BV1Zz4y1d7BK</a></p>
<p>ubuntu窗口调整</p>
<p>device -&gt; Insert Guest addtions CD Image</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012631731/article/details/79548621">https://blog.csdn.net/u012631731/article/details/79548621</a></p>
<p>修改Ubuntu硬盘大小</p>
<p><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4388335/blog/3321852">https://my.oschina.net/u/4388335/blog/3321852</a></p>
<p> windows ubuntu文件夹共享</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/4e73fd1c0c74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation">https://www.jianshu.com/p/4e73fd1c0c74?utm_campaign=maleskine&amp;utm_content=note&amp;utm_medium=seo_notes&amp;utm_source=recommendation</a></p>
<p>并发 : 多个事件在分段被单个CPU分段执行。</p>
<p>并行： 多个CPU同时处理多个任务。</p>
<h4 id="汇编"><a href="#汇编" class="headerlink" title="汇编"></a>汇编</h4><h5 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h5><p><a target="_blank" rel="noopener" href="https://fishc.com.cn/forum-39-1.html">https://fishc.com.cn/forum-39-1.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av22872043/?p=2&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/av22872043/?p=2&amp;spm_id_from=pageDriver</a></p>
<h5 id="GCC内联汇编"><a href="#GCC内联汇编" class="headerlink" title="GCC内联汇编"></a>GCC内联汇编</h5><p>C语言中加入 汇编代码</p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-ComputerOrganization" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/10/ComputerOrganization/">ComputerOrganization</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-12-10T14:42:44.000Z" itemprop="datePublished">2020年12月10日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/Organization/">Organization</a>
  </div>

      
      
<a href="/2020/12/10/ComputerOrganization/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>组成原理</p>
<p>CPU</p>
<p>运算器  控制器  高速缓存</p>
<p>主存储器= 内存</p>
<h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p><img src="/2020/12/10/ComputerOrganization/computer_compoment_control.png"></p>
<ul>
<li><p>程序计数器:</p>
<p> 用于提供其他控制单元，当前要执行的指令地址</p>
</li>
<li><p>时序发生器:</p>
<p> 用于发送时序脉冲， 依据不同的时序脉冲有节奏的进行工作</p>
</li>
<li><p>寄存器</p>
<p>指令寄存器 :从主存或高速缓存取计算机指令</p>
<p>主存地址寄存器：保存当前CPU正要访问的内存单元的地址</p>
<p>主存地址寄存器： 保存当前CPU正要读或写的主存数据</p>
<p>通用寄存器:</p>
<p>用于暂存或传送数据或指令</p>
<p>可保存ALU的运算中间结果</p>
<p>容量比一般专用寄存器要大</p>
</li>
</ul>
<p>​    </p>
<h4 id="运算器"><a href="#运算器" class="headerlink" title="运算器"></a>运算器</h4><p><img src="/2020/12/10/ComputerOrganization/computer_compoment_calculate.png"></p>
<h5 id="数据缓冲器"><a href="#数据缓冲器" class="headerlink" title="数据缓冲器"></a>数据缓冲器</h5><p>​    分为输入缓冲和输出缓冲</p>
<p>​    输入缓冲暂时存放外设送过来的数据</p>
<p>​    输出缓冲暂时存放送往外设的数据</p>
<h5 id="ALU"><a href="#ALU" class="headerlink" title="ALU"></a>ALU</h5><p>​    ALU:算术逻辑单元，是运算器的主要组成</p>
<p>​    常见的位运算(左右移、与或非等)</p>
<p>​    算术运算(加减乘除等)</p>
<h5 id="通用寄存器"><a href="#通用寄存器" class="headerlink" title="通用寄存器"></a>通用寄存器</h5><p>​    用于暂时存放或传送数据或指令</p>
<p>​    可保存ALU的运算中间结果</p>
<p>​    容量比一般专用寄存器要大</p>
<h5 id="状态字寄存器"><a href="#状态字寄存器" class="headerlink" title="状态字寄存器"></a>状态字寄存器</h5><p>​    存放运算状态(条件码、进位、溢出、结果正负等)</p>
<p>​    存放运算控制信息(调试跟踪标记位、允许中断位等)</p>
<h4 id="高速缓存"><a href="#高速缓存" class="headerlink" title="高速缓存"></a>高速缓存</h4><h4 id="指令执行过程"><a href="#指令执行过程" class="headerlink" title="指令执行过程"></a>指令执行过程</h4><p><img src="/2020/12/10/ComputerOrganization/computer_signal_01.png"></p>
<p><img src="/2020/12/10/ComputerOrganization/computer_signal_02.png"></p>
<h4 id="高速缓存-1"><a href="#高速缓存-1" class="headerlink" title="高速缓存"></a>高速缓存</h4><p>命中率</p>
<p>![](ComputerOrganization/Screen Shot 2021-03-03 at 10.10.02 PM.png)</p>
<p>不在缓存的数据需要去主存拿</p>
<h4 id="4GB是寻址空间为什么是4G-byte而不是-bit"><a href="#4GB是寻址空间为什么是4G-byte而不是-bit" class="headerlink" title="4GB是寻址空间为什么是4G ,byte而不是 bit"></a>4GB是寻址空间为什么是4G ,byte而不是 bit</h4><p>现在的内存可以看作一个很长的，每项宽度8位（即1Bit）的很长的数列,<strong>既然是数列，那么每一项便对应一个序号，这个序号便是地址，就如同你家在一条大街的第几号一样</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/61974351">https://www.zhihu.com/question/61974351</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-TouchEvent3" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/25/TouchEvent3/">TouchEvent3</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-11-25T06:12:50.000Z" itemprop="datePublished">2020年11月25日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/VIEW/">VIEW</a>
  </div>

      
      
<a href="/2020/11/25/TouchEvent3/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="Button-TextView"><a href="#Button-TextView" class="headerlink" title="Button TextView"></a>Button TextView</h4><p>button clickable=true,所以 默认消费事件,TextView不会</p>
<ul>
<li>value.xml</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">&quot;Base.Widget.AppCompat.Button&quot;</span> <span class="attr">parent</span>=<span class="string">&quot;android:Widget&quot;</span>&gt;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:background&quot;</span>&gt;</span>@drawable/abc_btn_default_mtrl_shape<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:textAppearance&quot;</span>&gt;</span>?android:attr/textAppearanceButton<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:minHeight&quot;</span>&gt;</span>48dip<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:minWidth&quot;</span>&gt;</span>88dip<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:focusable&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:clickable&quot;</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">&quot;android:gravity&quot;</span>&gt;</span>center_vertical|center_horizontal<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>处理开篇问题</strong></p>
<h4 id="处理方法"><a href="#处理方法" class="headerlink" title="处理方法"></a>处理方法</h4><h5 id="外部拦截法"><a href="#外部拦截法" class="headerlink" title="外部拦截法:"></a>外部拦截法:</h5><p>​    需要在父ViewGroup，重写onInterceptTouchEvent( [ˌɪntərˈsept])方法，根据业务需要，判断哪些事件是父Viewgroup需要的，需要的话就对该事件进行拦截，然后交由onTouchEvent方法处理，若不需要，则不拦截，然后传递给子view或子viewGroup。</p>
<h5 id="内部拦截法"><a href="#内部拦截法" class="headerlink" title="内部拦截法"></a>内部拦截法</h5><p>主要由子view控制事件，配合requestDisallowInterceptTouchEvent(),父View不拦截任何down事件</p>
<p>,思路是这样的，在ViewGroupA的Action_Down动作中设置requestDisallowInterceptTouchEvent(true),这样RootView不会走拦截方法，保证Action_Move,能进入ViewGroupA,然后在ViewGroupA的move事件中，根据需要控制RootView发送过来的后续Action_Move事件.</p>
<img src="/2020/11/25/TouchEvent3/TouchEvent3.png" alt="TouchEvent3" style="zoom:50%;">



<ol>
<li>代码</li>
</ol>
<p>ViewGroupA</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> public boolean dispatchTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">     Logger.d(ev.getAction(), TAG, Static.dispatchTouchEvent + &quot;老板要做淘宝,下周上线?&quot;);</span><br><span class="line">     int x &#x3D; (int) ev.getX();</span><br><span class="line">     int y &#x3D; (int) ev.getY();</span><br><span class="line">     switch (ev.getAction()) &#123;</span><br><span class="line">         case MotionEvent.ACTION_DOWN:</span><br><span class="line">					getParent().requestDisallowInterceptTouchEvent(true);</span><br><span class="line">             break;</span><br><span class="line"></span><br><span class="line">         case MotionEvent.ACTION_MOVE:</span><br><span class="line">             int deltaX &#x3D; x - mLastX;</span><br><span class="line">             int deltaY &#x3D; y - mLastY;</span><br><span class="line">             if (Math.abs(deltaX) &gt; Math.abs(deltaY)) &#123;</span><br><span class="line">                 getParent().requestDisallowInterceptTouchEvent(false);</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 getParent().requestDisallowInterceptTouchEvent(true);</span><br><span class="line">             &#125;</span><br><span class="line">             break;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     mLastX &#x3D; x;</span><br><span class="line">     mLastY &#x3D; y;</span><br><span class="line">     return super.dispatchTouchEvent(ev);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>RootView</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public boolean onInterceptTouchEvent(MotionEvent ev) &#123;</span><br><span class="line">    Logger.d(ev.getAction(), TAG, Static.onInterceptTouchEvent + &quot;(老板可能疯了,但又不是我做.)&quot;);</span><br><span class="line">    if (ev.getAction() &#x3D;&#x3D; MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>内部拦截ViewGroupA消费事件</li>
</ol>
<img src="/2020/11/25/TouchEvent3/Inner_ViewGroupA.png" alt="Inner_ViewGroupA" style="zoom:67%;">



<p>运行结果</p>
<blockquote>
<p>D/MainActivity [老板] ACTION_DOWN: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>D/RootView     [经理] ACTION_DOWN: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>D/RootView     [经理] ACTION_DOWN: onInterceptTouchEvent  (老板可能疯了,但又不是我做.)<br>D/ViewGroupA   [组长] ACTION_DOWN: dispatchTouchEvent     老板要做淘宝,下周上线?<br>D/ViewGroupA   [组长] ACTION_DOWN: onInterceptTouchEvent  (看着不太靠谱,先问问小王怎么看)<br>D/ViewGroupA   [组长] ACTION_DOWN: onTouchEvent           小王说做不了</p>
<p>D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
<p>D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
</blockquote>
<p>代码流程</p>
<p>Action_down都会被ViewGroupA消费,所以主要分析Action_Move事件流程,由于Action_down  requestDisallowInterceptTouchEvent(true)那么 disallowIntercept =true,</p>
<blockquote>
<p>第1次 Action_Move 分发</p>
<p>RootView      :   dispatchTouchEvent() 29 =&gt; 32=&gt;36 intercepted = false =&gt; 58 =&gt;</p>
<p>ViewGroupA:   dispatchTouchEvent() 29=&gt; 设置 getParent().requestDisallowInterceptTouchEvent(true) =&gt;view =&gt; dispatchTouchEvent被消费</p>
<p>第2次Action_Move 分发</p>
<p>RootView      :   dispatchTouchEvent() 29 =&gt; 32=&gt;36 intercepted = false =&gt; 58 =&gt;</p>
<p>ViewGroupA:   dispatchTouchEvent() 29=&gt; 设置y&gt;x getParent().requestDisallowInterceptTouchEvent(true) =&gt;view =&gt; dispatchTouchEvent被消费</p>
</blockquote>
<img src="/2020/11/25/TouchEvent3/inter_RootView.png" alt="inter_RootView" style="zoom:67%;">



<p>运行结果</p>
<blockquote>
<p>225 24328-24328/ D/MainActivity [老板] ACTION_DOWN: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>226 24328-24328/ D/RootView     [经理] ACTION_DOWN: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>226 24328-24328/ D/RootView     [经理] ACTION_DOWN: onInterceptTouchEvent  (老板可能疯了,但又不是我做.)<br>227 24328-24328/ D/ViewGroupA   [组长] ACTION_DOWN: dispatchTouchEvent     老板要做淘宝,下周上线?<br>227 24328-24328/ D/ViewGroupA   [组长] ACTION_DOWN: onInterceptTouchEvent  (看着不太靠谱,先问问小王怎么看)<br>228 24328-24328/ D/ViewGroupA   [组长] ACTION_DOWN: onTouchEvent           小王说做不了</p>
<p>237 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>237 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>237 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>237 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     dx:0 dy:0<br>238 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     Math.abs(deltaX) &gt; Math.abs(deltaY) false<br>238 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
<p>287 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>287 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>287 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     老板要做淘宝,下周上线?<br>288 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     dx:2 dy:0<br>288 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: dispatchTouchEvent     Math.abs(deltaX) &gt; Math.abs(deltaY) true<br>288 24328-24328/ D/ViewGroupA   [组长] ACTION_MOVE: onTouchEvent           小王说做不了</p>
<p>304 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>305 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>305 24328-24328/ D/RootView     [经理] ACTION_MOVE: onInterceptTouchEvent  (老板可能疯了,但又不是我做.)</p>
<p>320 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>321 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>321 24328-24328/ D/RootView     [经理] ACTION_MOVE: onTouchEvent           报告老板, 技术部说做不了</p>
<p>338 24328-24328/ D/MainActivity [老板] ACTION_MOVE: dispatchTouchEvent     经理,我准备发展一下电商业务,下周之前做一个淘宝出来.<br>338 24328-24328/ D/RootView     [经理] ACTION_MOVE: dispatchTouchEvent     呼叫技术部,老板要做淘宝,下周上线.<br>338 24328-24328/ D/RootView     [经理] ACTION_MOVE: onTouchEvent           报告老板, 技术部说做不了</p>
</blockquote>
<p>代码流程</p>
<blockquote>
<p>百思不得其姐， RootView dispatchTouchEvent 后面的onInterceptTouchEvent() 方法日志为什么没打印，其他都能通</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MotionEvent.ACTION_DOWN requestDisallowInterceptTouchEvent(true),必须设置,否则后续的Action_Move无法进入 ViewGroupA</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&amp;mid=2650237941&amp;idx=1&amp;sn=40bca69abe10015cc469132f8c76a910&amp;chksm=88639a9abf14138cae7409adec85c5496486a044d7f4ef102e513d9c052aaa30017fb37e3439&amp;scene=38#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&amp;mid=2650237941&amp;idx=1&amp;sn=40bca69abe10015cc469132f8c76a910&amp;chksm=88639a9abf14138cae7409adec85c5496486a044d7f4ef102e513d9c052aaa30017fb37e3439&amp;scene=38#wechat_redirect</a></p>
<p><img src="/2020/11/25/TouchEvent3/Inner_ViewGroupA.png" alt="Inner_ViewGroupA"></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TouchEvent/" rel="tag">TouchEvent</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-base64" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/22/base64/">base64</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-10-22T06:49:37.000Z" itemprop="datePublished">2020年10月22日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/flutter/">flutter</a>
  </div>

      
      
<a href="/2020/10/22/base64/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/313b73ee7d6f">https://www.jianshu.com/p/313b73ee7d6f</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-flutter-paint" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/14/flutter-paint/">flutter_paint</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-10-14T05:53:46.000Z" itemprop="datePublished">2020年10月14日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/flutter/">flutter</a>
  </div>

      
      
<a href="/2020/10/14/flutter-paint/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constructor">Offset(<span class="params">size</span>.<span class="params">width</span><span class="operator">*</span>0.5, <span class="params">size</span>.<span class="params">height</span>)</span> <span class="comment">//坐标</span></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://codewithandrea.com/videos/2020-01-27-flutter-custom-painting-do-not-fear-canvas/">https://codewithandrea.com/videos/2020-01-27-flutter-custom-painting-do-not-fear-canvas/</a></p>
<p><a target="_blank" rel="noopener" href="https://flutter.dev/docs/development/ui/widgets/painting">https://flutter.dev/docs/development/ui/widgets/painting</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-flutter-layout" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/24/flutter-layout/">flutter_layout</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-09-24T07:43:26.000Z" itemprop="datePublished">2020年09月24日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/flutter/">flutter</a>
  </div>

      
      
<a href="/2020/09/24/flutter-layout/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://jspang.com/detailed?id=43">https://jspang.com/detailed?id=43</a></p>
<p><a target="_blank" rel="noopener" href="https://book.flutterchina.club/chapter4/row_and_column.html">https://book.flutterchina.club/chapter4/row_and_column.html</a></p>
<h3 id="主轴和纵轴"><a href="#主轴和纵轴" class="headerlink" title="主轴和纵轴"></a>主轴和纵轴</h3><p>对于线性布局，有主轴和纵轴之分，如果布局是沿水平方向(Row),那么主轴就是指水平方向，而纵轴即垂直方向.</p>
<p>如果布局沿垂直方向(Colomn)，那么主轴就是指垂直方向，而纵轴就是水平方向</p>
<ul>
<li><p>MainAxisAlignment</p>
<p> 表示子组件在<code>Row</code>所占用的水平空间内对齐方式，如果<code>mainAxisSize</code>值为<code>MainAxisSize.min</code>，则此属性无意义</p>
</li>
<li><p>crossAxisAlignment </p>
<p>表示子组件在纵轴方向的对齐方式，<code>Row</code>的高度等于子组件中最高的子元素高度</p>
</li>
<li><p>TextDirection : 字体方向</p>
</li>
<li><p>CrossAxisAlignment : 表示<code>Row</code>纵轴（垂直）的对齐方向，默认是<code>VerticalDirection.down</code>，表示从上到下.</p>
</li>
<li><p><strong><code>Row</code>和<code>Column</code>都只会在主轴方向占用尽可能大的空间，而纵轴的长度则取决于他们最大子元素的长度</strong></p>
<p>特殊情况 : </p>
<p>如果<code>Row</code>里面嵌套<code>Row</code>，或者<code>Column</code>里面再嵌套<code>Column</code>，那么只有最外面的<code>Row</code>或<code>Column</code>会占用尽可能大的空间，里面<code>Row</code>或<code>Column</code>所占用的空间为实际大小，下面以<code>Column</code>为例说明</p>
</li>
</ul>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-flutterdev" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/26/flutterdev/">flutterdev</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-26T03:56:46.000Z" itemprop="datePublished">2020年08月26日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/flutter/">flutter</a>
  </div>

      
      
<a href="/2020/08/26/flutterdev/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>​        </p>
<p><img src="/2020/08/26/flutterdev/CgqCHl7zAM2AFYCOAAFd30sb1Ck089.png" alt="CgqCHl7zAM2AFYCOAAFd30sb1Ck089"></p>
<p><a target="_blank" rel="noopener" href="https://flutter.dev/docs/development/ui/layout">https://flutter.dev/docs/development/ui/layout</a></p>
<h4 id="Aligning-widgets"><a href="#Aligning-widgets" class="headerlink" title="Aligning widgets"></a>Aligning widgets</h4><h5 id="MainAxisAlignment"><a href="#MainAxisAlignment" class="headerlink" title="MainAxisAlignment"></a>MainAxisAlignment</h5><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/BINGXIHEART/article/details/95077098">https://blog.csdn.net/BINGXIHEART/article/details/95077098</a></p>
<p> 可以接着完善</p>
<ul>
<li><p>row </p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Row(</span><br><span class="line">  mainAxisAlignment: MainAxisAlignment.spaceEvenly,</span><br><span class="line">  children: [</span><br><span class="line">    Image.asset(<span class="string">&#x27;images/pic1.jpg&#x27;</span>),</span><br><span class="line">    Image.asset(<span class="string">&#x27;images/pic2.jpg&#x27;</span>),</span><br><span class="line">    Image.asset(<span class="string">&#x27;images/pic3.jpg&#x27;</span>),</span><br><span class="line">  ],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<img src="/2020/08/26/flutterdev/Screen Shot 2020-08-26 at 11.55.17 AM.png" alt="Screen Shot 2020-08-26 at 11.55.17 AM" style="zoom: 50%;"></li>
<li><p>Column</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Wid<span class="keyword">get</span> <span class="title">buildRow</span>() =&gt; <span class="title">Column</span>(<span class="params"></span></span><br><span class="line"><span class="params">      mainAxisAlignment: MainAxisAlignment.center,</span></span><br><span class="line"><span class="params">      children: &lt;Widget&gt;[</span></span><br><span class="line"><span class="params">        Image.asset(<span class="string">&#x27;images/pic1.jpg&#x27;</span>),</span></span><br><span class="line"><span class="params">        Image.asset(<span class="string">&#x27;images/pic2.jpg&#x27;</span>),</span></span><br><span class="line"><span class="params">        Image.asset(<span class="string">&#x27;images/pic3.jpg&#x27;</span>),</span></span><br><span class="line"><span class="params">      ],</span></span><br><span class="line"><span class="params">    </span>);</span><br></pre></td></tr></table></figure>

<img src="/2020/08/26/flutterdev/Screen Shot 2020-08-26 at 12.04.23 PM.png" alt="Screen Shot 2020-08-26 at 12.04.23 PM" style="zoom: 33%;"></li>
</ul>
<h4 id="constraints"><a href="#constraints" class="headerlink" title="constraints"></a>constraints</h4><h5 id="ConstrainedBox"><a href="#ConstrainedBox" class="headerlink" title="ConstrainedBox"></a>ConstrainedBox</h5><p>  The <code>ConstrainedBox</code> imposes <strong>additional</strong> constraints from its <code>constraints</code> parameter onto its child .</p>
<h5 id="UnconstrainedBox"><a href="#UnconstrainedBox" class="headerlink" title="UnconstrainedBox"></a>UnconstrainedBox</h5><p>The screen forces the <code>UnconstrainedBox</code> to be exactly the same size as the screen. However, the <code>UnconstrainedBox</code> lets its child <code>Container</code> be any size it wants</p>
<p><a target="_blank" rel="noopener" href="https://resocoder.com/2019/08/15/flutter-custom-icons-automatic-manual-way-icon-font-or-svg/">https://resocoder.com/2019/08/15/flutter-custom-icons-automatic-manual-way-icon-font-or-svg/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.fluttericon.com/">https://www.fluttericon.com/</a></p>
<h4 id="json-and-serializtion"><a href="#json-and-serializtion" class="headerlink" title="json and serializtion"></a>json and serializtion</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dependencies</span>:</span><br><span class="line">	<span class="attribute">json_annotation</span>: ^<span class="number">2</span>.<span class="number">2</span>.<span class="number">0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">dev_dependencies</span>:</span><br><span class="line">  <span class="attribute">flutter_test</span>:</span><br><span class="line">    <span class="attribute">sdk</span>: flutter</span><br><span class="line"></span><br><span class="line">  <span class="attribute">build_runner</span>: ^<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">json_serializable</span>: ^<span class="number">2</span>.<span class="number">0</span>.<span class="number">0</span></span><br><span class="line">  <span class="attribute">json_model</span>:</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flutter packages pub run json_model</p>
</blockquote>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:convert&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;dart:io&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:flutteruse/models/user.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  final jsonString = File(<span class="string">&#x27;jsons/user.json&#x27;</span>).readAsStringSync();</span><br><span class="line">  <span class="built_in">print</span>(jsonString);</span><br><span class="line"></span><br><span class="line">  <span class="regexp">//</span> var jsonString = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;John Smith&quot;,&quot;email&quot;: &quot;john@example.com&quot;&#125;&#x27;</span>;</span><br><span class="line">  <span class="regexp">//</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, dynamic&gt; user = jsonDecode(jsonString) <span class="keyword">as</span> <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, dynamic&gt;;</span><br><span class="line">  <span class="regexp">//</span> <span class="built_in">print</span>(<span class="string">&#x27;Howdy, $&#123;user[&#x27;</span>name<span class="string">&#x27;]&#125;!&#x27;</span>);</span><br><span class="line">  <span class="regexp">//</span> <span class="built_in">print</span>(<span class="string">&#x27;We sent the verification link to $&#123;user[&#x27;</span>email<span class="string">&#x27;]&#125;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">Map</span> userMap = jsonDecode(jsonString);</span><br><span class="line">  var user = User.fromJson(userMap);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;Howdy, $&#123;user.name&#125;!&#x27;</span>);</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;We sent the verification link to $&#123;user.email&#125;.&#x27;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">print</span>(user.toJson());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>项目中采用第三种方法</p>
<p><strong>使用json_model自动生成</strong></p>
<p>1.在项目根目录新建jsons文件夹并将json数据新建成为文件，在lib目录下新建包名为models</p>
<p>注意：这两个文件夹的名字都必须为jsons和models</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-2fef1bf9e56b2ad9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/658/format/webp" alt="img"></p>
<p>2、加入依懒</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-48c442858ef185e1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/794/format/webp" alt="img"></p>
<p>注意：这里添加完json_serializable相关依赖之后还添加了json_model的依赖，这就是快捷生成的关键，还有如果json中引用了其他model可以使用如下方式</p>
<p>{</p>
<p>“name”:”wendux”,</p>
<p>“father”:”$user”,//可以通过”$”符号引用其它model类</p>
<p>“friends”:”$[]user”,//可以通过”$[]”来引用数组</p>
<p>“keywords”:”$[]String”,//同上</p>
<p>“age”:20</p>
<p>}</p>
<p><strong>3.完成上面的操作之后</strong></p>
<p>在当前项目的根目录执行如下命令：flutter packages pub run json_model</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-1aa8170bb500d178.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1157/format/webp" alt="img"></p>
<p>控制台打印如下日志就成功了</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-e3a705329f02ae39.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp" alt="img"></p>
<p>注意：如果json文件中加了注释可能会报错，需要删除注释，错误信息如下</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-bbf32b1d29e8a279.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1182/format/webp" alt="img"></p>
<p>其实，我们也可以不使用命令行的方式自动生成，</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20009961-f2f6d6dfb8e1f5e8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1058/format/webp" alt="img"></p>
<p>用run([‘src=jsons’])的方法也可以，run方法为json_model暴露的方法</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f37d8546ab8f">https://www.jianshu.com/p/f37d8546ab8f</a></p>
<ul>
<li> 修改包名后  pubspec.yaml</li>
</ul>
<blockquote>
<p> target file “lib/main_dev.dart” not found</p>
</blockquote>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">plugin:</span></span><br><span class="line"><span class="symbol">  platforms:</span></span><br><span class="line"><span class="symbol">    android:</span></span><br><span class="line"><span class="symbol">      package:</span> com.casanube.flutter_ble <span class="comment">//记得修改这个包名 要不然爆出上面的错误</span></span><br><span class="line"><span class="symbol">      pluginClass:</span> FlutterBlePlugin</span><br></pre></td></tr></table></figure>



<p>flutter自定义控件</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/aVvos5iWYVmiVZRv4hMQMQ">https://mp.weixin.qq.com/s/aVvos5iWYVmiVZRv4hMQMQ</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6874061694491721736">https://juejin.im/post/6874061694491721736</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-OS-PROCESS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/17/OS-PROCESS/">OS_PROCESS</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-17T02:55:14.000Z" itemprop="datePublished">2020年08月17日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/OS/">OS</a>
  </div>

      
      
<a href="/2020/08/17/OS-PROCESS/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>进程有很大的独立性</p>
<p>为了实现进程模型，操作系统维护着一张表格，进程表。每个进程占用一个进程表项。</p>
<h4 id="进程通信"><a href="#进程通信" class="headerlink" title="进程通信"></a>进程通信</h4><h5 id="进程通信方式"><a href="#进程通信方式" class="headerlink" title="进程通信方式"></a>进程通信方式</h5><pre><code>文件
AIDL （基于 Binder）
    Android 进阶：进程通信之 AIDL 的使用
    Android 进阶：进程通信之 AIDL 解析
Binder
    Android 进阶：进程通信之 Binder 机制浅析
Messenger （基于 Binder）
    Android 进阶：进程通信之 Messenger 使用与解析 
ContentProvider （基于 Binder）
    Android 进阶：进程通信之 ContentProvider 内容提供者 
Socket
    Android 进阶：进程通信之 Socket （顺便回顾 TCP UDP）
</code></pre>
<p><img src="https://img-blog.csdn.net/20170605011532312?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdTAxMTI0MDg3Nw==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast"><br>原文链接：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u011240877/article/details/72863432">https://blog.csdn.net/u011240877/article/details/72863432</a></p>
<p><img src="/2020/08/17/OS-PROCESS/2021-08-17_COMM_TYPE.png"></p>
<p>管道通信</p>
<p>无名管道， 有名管道:文件系统中有这样一个文件名</p>
<p>信号通信： </p>
<h5 id="进程通信的思想"><a href="#进程通信的思想" class="headerlink" title="进程通信的思想"></a>进程通信的思想</h5><p><img src="/2020/08/17/OS-PROCESS/2021-08-17_INTER_THINK.png"></p>
<p><strong>共享内存</strong></p>
<p> 共享存储允许不相关的进程访问同一片物理内存</p>
<p>共享内存是两个进程之间共享和传递数据最快的方式</p>
<p>共享内存未提供同步机制，需要借助其他机制管理访问</p>
<p>共享存储是两个进程之间共享和传递数据最快的一种方式</p>
<p>共享内存未提供同步机制，需要借助其他机制管理访问</p>
<p><strong>Unix域套接字</strong></p>
<p>域套接字是一种高级的进程间通信的方法</p>
<p>Unix域套接字可以用于同一机器进程间通信</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1tJ41117ty?from=search&amp;seid=13006387505737298314">https://www.bilibili.com/video/BV1tJ41117ty?from=search&amp;seid=13006387505737298314</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-AutoDispose" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/14/AutoDispose/">AutoDispose</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-14T02:18:28.000Z" itemprop="datePublished">2020年08月14日</time>
</span>
      
      
      
<a href="/2020/08/14/AutoDispose/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://uber.github.io/AutoDispose/">https://uber.github.io/AutoDispose/</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RxJava/" rel="tag">RxJava</a></li></ul>

          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>


  <article id="post-ViewGroup" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/13/ViewGroup/">ViewGroup</a>
    </h1>
  


      </header>
    
    <div class="article-meta">
      
      <span class="article-date">
  <i class="fa fa-date"></i>
  <time class="dt-published" datetime="2020-08-12T23:36:27.000Z" itemprop="datePublished">2020年08月13日</time>
</span>
      
  <div class="article-category">
    <i class="fa fa-classify"></i>
    <a class="article-category-link" href="/categories/VIEW/">VIEW</a>
  </div>

      
      
<a href="/2020/08/13/ViewGroup/#comments" class="article-comment-link">
  
  <i class="fa fa-commt"></i>
  Guestbook
</a>


    </div>
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h4><p><img src="/2020/08/13/ViewGroup/2021-08-10_view_lifecycle.png"></p>
<p>每次onMeasure，onLayout用到的值都不能在构造方法里面初始化。</p>
<h4 id="座标系"><a href="#座标系" class="headerlink" title="座标系"></a>座标系</h4><p><img src="/2020/08/13/ViewGroup/2021-12-05_4.02.40_coordinate.png" alt="2021-12-05_4.02.40_coordinate"></p>
<p>getLeft()直接调用是0 ? 需要自己设置 chidView.layout(left, top,right,bottom),</p>
<p>没调用chidView.layout 就获取不到 getLeft()的值。</p>
<p>left这些参数的座标系 是基于ViewGroup.</p>
<h4 id="getMeasuredWidth-getWidth"><a href="#getMeasuredWidth-getWidth" class="headerlink" title="getMeasuredWidth getWidth"></a>getMeasuredWidth getWidth</h4><h5 id="getMeasuredWidth"><a href="#getMeasuredWidth" class="headerlink" title="getMeasuredWidth"></a>getMeasuredWidth</h5><ol>
<li><p>在measure()过程结束后就可以获取到对应的值。</p>
</li>
<li><p>通过setMeasuredDimension()方法来进行设置。</p>
</li>
</ol>
<h5 id="getWidth"><a href="#getWidth" class="headerlink" title="getWidth"></a>getWidth</h5><ol>
<li>在view.layout()过程结束后才能获取到；</li>
<li> 通过视图右边的坐标-左边的左边计算出来的</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> childHeightMeasureSpec;</span><br><span class="line"><span class="keyword">if</span> (lp.height == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> height = Math.max(<span class="number">0</span>, getMeasuredHeight()</span><br><span class="line">            - getPaddingTopWithForeground() - getPaddingBottomWithForeground()</span><br><span class="line">            - lp.topMargin - lp.bottomMargin);</span><br><span class="line">    childHeightMeasureSpec = MeasureSpec.makeMeasureSpec(</span><br><span class="line">            height, MeasureSpec.EXACTLY);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    childHeightMeasureSpec = getChildMeasureSpec(heightMeasureSpec,</span><br><span class="line">            getPaddingTopWithForeground() + getPaddingBottomWithForeground() +</span><br><span class="line">            lp.topMargin + lp.bottomMargin,</span><br><span class="line">            lp.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">child.measure(childWidthMeasureSpec, childHeightMeasureSpec);</span><br></pre></td></tr></table></figure>

<p>Frame layout 子节点重新绘制，为什么</p>
<p>Framelayout边界怎么算的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (absoluteGravity &amp; Gravity.HORIZONTAL_GRAVITY_MASK) &#123;</span><br><span class="line">    <span class="keyword">case</span> Gravity.CENTER_HORIZONTAL:</span><br><span class="line">        childLeft = parentLeft + (parentRight - parentLeft - width) / <span class="number">2</span> +</span><br><span class="line">        lp.leftMargin - lp.rightMargin;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> Gravity.RIGHT:</span><br><span class="line">        <span class="keyword">if</span> (!forceLeftGravity) &#123;</span><br><span class="line">            childLeft = parentRight - width - lp.rightMargin;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">case</span> Gravity.LEFT:</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        childLeft = parentLeft + lp.leftMargin;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="LayoutParams-MeasureSpec"><a href="#LayoutParams-MeasureSpec" class="headerlink" title="LayoutParams MeasureSpec"></a>LayoutParams MeasureSpec</h4><p>的关系</p>
<h5 id="ViewGroup测量"><a href="#ViewGroup测量" class="headerlink" title="ViewGroup测量"></a>ViewGroup测量</h5><p><img src="/2020/08/13/ViewGroup/2021-08-12_viewgroup_layout.png"></p>
<p>先度量child View,再度量自己的大小。</p>
<p>先度量 child View,child view度量完成，如果是 wrap_content，就是all childview的size.</p>
<p>​                                                            // parent size         child want size</p>
<p>​                                                                </p>
<p><img src="/2020/08/13/ViewGroup/2021-08-13_6.21.59.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getChildMeasureSpec</span><span class="params">(<span class="keyword">int</span> spec, <span class="keyword">int</span> padding, <span class="keyword">int</span> childDimension)</span> </span>&#123;<span class="comment">// padding是parent view的</span></span><br><span class="line">    <span class="keyword">int</span> specMode = MeasureSpec.getMode(spec);</span><br><span class="line">    <span class="keyword">int</span> specSize = MeasureSpec.getSize(spec);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> size = Math.max(<span class="number">0</span>, specSize - padding);<span class="comment">// parent size</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> resultSize = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> resultMode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (specMode) &#123;</span><br><span class="line">    <span class="comment">// Parent has imposed an exact size on us</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.EXACTLY:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size. So be it.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size. It can&#x27;t be</span></span><br><span class="line">            <span class="comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parent has imposed a maximum size on us</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.AT_MOST:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Child wants a specific size... so be it</span></span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size, but our size is not fixed.</span></span><br><span class="line">            <span class="comment">// Constrain child to not be bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size. It can&#x27;t be</span></span><br><span class="line">            <span class="comment">// bigger than us.</span></span><br><span class="line">            resultSize = size;</span><br><span class="line">            resultMode = MeasureSpec.AT_MOST;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Parent asked to see how big we want to be</span></span><br><span class="line">    <span class="keyword">case</span> MeasureSpec.UNSPECIFIED:</span><br><span class="line">        <span class="keyword">if</span> (childDimension &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// Child wants a specific size... let him have it</span></span><br><span class="line">            resultSize = childDimension;</span><br><span class="line">            resultMode = MeasureSpec.EXACTLY;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.MATCH_PARENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to be our size... find out how big it should</span></span><br><span class="line">            <span class="comment">// be</span></span><br><span class="line">            resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="number">0</span> : size;</span><br><span class="line">            resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (childDimension == LayoutParams.WRAP_CONTENT) &#123;</span><br><span class="line">            <span class="comment">// Child wants to determine its own size.... find out how</span></span><br><span class="line">            <span class="comment">// big it should be</span></span><br><span class="line">            resultSize = View.sUseZeroUnspecifiedMeasureSpec ? <span class="number">0</span> : size;</span><br><span class="line">            resultMode = MeasureSpec.UNSPECIFIED;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//noinspection ResourceType</span></span><br><span class="line">    <span class="keyword">return</span> MeasureSpec.makeMeasureSpec(resultSize, resultMode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="MeasureSpec创建规则"><a href="#MeasureSpec创建规则" class="headerlink" title="MeasureSpec创建规则"></a>MeasureSpec创建规则</h5><p><img src="/2020/08/13/ViewGroup/2021-08-12_9.33_measure_spec_mode.png"></p>
<ol>
<li>子View为精确宽高，无论父容器的MeasureSpec，子View的MeasureSpec都为精确值且遵循LayoutParams中的值。 </li>
<li>子View为match_parent时，如果父容器是精确模式，则子View也为精确模式且为父容器的剩余空间大小；如果父容器是最大模式，则子View也是最大模式且不会超过父容器的剩余空间。</li>
<li>子View为wrap_content时，无论父View是精确还是最大模式，子View的模式总是最大模式，且不会超过父容器的剩余空间。 </li>
</ol>
<p>艺术探索</p>
<p><img src="https://upload-images.jianshu.io/upload_images/7177220-a24570ca31b1b9df.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200"></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/cb529ed03597">https://www.jianshu.com/p/cb529ed03597</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904094205739016">https://juejin.cn/post/6844904094205739016</a></p>
<h5 id="MeasureSpec表示"><a href="#MeasureSpec表示" class="headerlink" title="MeasureSpec表示"></a>MeasureSpec表示</h5><ol>
<li>MeasureSpec用int表示,总共32位，高2位代表SpecMode，低30位代表SpecSize,SpecMode是指测量模式，而SpecSize是指在某种测量模式下的规格大小。MeasureSpec通过将SpecMode和SpecSize打包成一个int值来避免过多的对象内存分配.打包makeMeasureSpec。</li>
<li>高2位 00 , 01, 10, 分别对应UNSPECIFIED, EXACTLY,AT_MOST。</li>
</ol>
<ul>
<li><p><strong>UNSPECIFIED</strong></p>
<p>父容器不对View有任何限制，要多大给多大，这种情况一般用于系统内部，表示一种测量的状态. 开发者用不了.</p>
</li>
<li><p><strong>EXACTLY</strong></p>
<p>父容器已经检测出View所需要的精确大小，这个时候View的最终大小就是SpecSize所指定的值。它对应于LayoutParams中的match_parent和具体的数值这两种模式。</p>
</li>
<li><p><strong>AT_MOST</strong> </p>
<p>父容器指定了一个可用大小即SpecSize,View的大小不能大于这个值</p>
</li>
</ul>
<p>​     </p>
<p><img src="/2020/08/13/ViewGroup/2021-08-12_9.29_measure_spec.png"></p>
<p>Inflate解析过程</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Ka4y1j7HA?p=4&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1Ka4y1j7HA?p=4&amp;spm_id_from=pageDriver</a></p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=aOb4Hvqbeu4">https://www.youtube.com/watch?v=aOb4Hvqbeu4</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1M54y1y79P?from=search&amp;seid=18028227823566625572&amp;spm_id_from=333.337.0.0">https://www.bilibili.com/video/BV1M54y1y79P?from=search&amp;seid=18028227823566625572&amp;spm_id_from=333.337.0.0</a></p>
<h4 id="自定义View-Margin"><a href="#自定义View-Margin" class="headerlink" title="自定义View Margin"></a>自定义View Margin</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qiantanlong/article/details/82347850">https://blog.csdn.net/qiantanlong/article/details/82347850</a></p>

        
        
          <blockquote id="copyright">
              <p>Original link: <a href="https://noteforme.github.io/page/12/index.html">https://noteforme.github.io/page/12/index.html</a></p>
              <p>Copyright Notice: 转载请注明出处.</p>
          </blockquote>
        
      
    </div>
    <footer class="article-footer">
      
        <div class="article-tag-wrap">
          

          
          
    <div class="social-share">
      <span>Share:</span>
    </div>



        </div>
      
      
      
    </footer>
  </div>
</article>



    <nav id="page-nav">

<a class="extend prev" rel="prev" href="/page/11/">Previous</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/25/">25</a><a class="extend next" rel="next" href="/page/13/">Next</a>
</nav>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-posts"></i> Recent</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/07/04/DesignPatterns-State/">DesignPatterns_State</a>
          </li>
        
          <li>
            <a href="/2024/07/03/glide/">glide</a>
          </li>
        
          <li>
            <a href="/2024/06/28/bitmap/">Bitmap</a>
          </li>
        
          <li>
            <a href="/2024/06/28/bits-and-bytes/">Bits and Bytes</a>
          </li>
        
          <li>
            <a href="/2024/06/26/lifecycle/">LifeCycle</a>
          </li>
        
      </ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ANDROID/" style="font-size: 14px;">ANDROID</a> <a href="/tags/AOSP/" style="font-size: 16px;">AOSP</a> <a href="/tags/Activity/" style="font-size: 10px;">Activity</a> <a href="/tags/AndroidNewFeatures/" style="font-size: 10px;">AndroidNewFeatures</a> <a href="/tags/Assembly/" style="font-size: 10px;">Assembly</a> <a href="/tags/BLOG/" style="font-size: 10px;">BLOG</a> <a href="/tags/ConstraintLayout/" style="font-size: 10px;">ConstraintLayout</a> <a href="/tags/DB/" style="font-size: 12px;">DB</a> <a href="/tags/DesignPattern/" style="font-size: 10px;">DesignPattern</a> <a href="/tags/Drawer/" style="font-size: 10px;">Drawer</a> <a href="/tags/Fragment/" style="font-size: 12px;">Fragment</a> <a href="/tags/JVM/" style="font-size: 18px;">JVM</a> <a href="/tags/LEETCODE/" style="font-size: 20px;">LEETCODE</a> <a href="/tags/Library/" style="font-size: 10px;">Library</a> <a href="/tags/Operators/" style="font-size: 10px;">Operators</a> <a href="/tags/Performance/" style="font-size: 14px;">Performance</a> <a href="/tags/RecyclerView/" style="font-size: 12px;">RecyclerView</a> <a href="/tags/RxJava/" style="font-size: 14px;">RxJava</a> <a href="/tags/THINK/" style="font-size: 10px;">THINK</a> <a href="/tags/TOOL/" style="font-size: 10px;">TOOL</a> <a href="/tags/TabLayout/" style="font-size: 10px;">TabLayout</a> <a href="/tags/Test/" style="font-size: 14px;">Test</a> <a href="/tags/TouchEvent/" style="font-size: 12px;">TouchEvent</a> <a href="/tags/VIEW/" style="font-size: 14px;">VIEW</a> <a href="/tags/XML/" style="font-size: 10px;">XML</a> <a href="/tags/anim/" style="font-size: 10px;">anim</a> <a href="/tags/compose/" style="font-size: 10px;">compose</a> <a href="/tags/concurrency/" style="font-size: 14px;">concurrency</a> <a href="/tags/coroutie/" style="font-size: 16px;">coroutie</a> <a href="/tags/inter/" style="font-size: 12px;">inter</a> <a href="/tags/keyboard/" style="font-size: 10px;">keyboard</a> <a href="/tags/permission/" style="font-size: 10px;">permission</a> <a href="/tags/proguard/" style="font-size: 10px;">proguard</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-classify"></i> Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ANDROID/">ANDROID</a><span class="category-list-count">54</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/">Architecture</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Architecture/DesignPattern/">DesignPattern</a><span class="category-list-count">3</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/BLE/">BLE</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/COROUTINE/">COROUTINE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Computer-Composition-principles/">Computer Composition principles</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DataStructure/">DataStructure</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DesignPattern/">DesignPattern</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DesignPatterns/">DesignPatterns</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ENGLISH/">ENGLISH</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/INTERVIEW/">INTERVIEW</a><span class="category-list-count">9</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/INTERVIEW/NETWORK/">NETWORK</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JETPACK/">JETPACK</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Jetpack/">Jetpack</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kotlin/">Kotlin</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LIFE/">LIFE</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LINUX/">LINUX</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Library/">Library</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mathematics/">Mathematics</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NETWORK/">NETWORK</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Organization/">Organization</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/SOURCE/">SOURCE</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TEST/">TEST</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/TOOL/">TOOL</a><span class="category-list-count">16</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/VIEW/">VIEW</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/anim/">anim</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-archive"></i> Archive</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024年</a><span class="archive-list-count">47</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/">2023年</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022年</a><span class="archive-list-count">34</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021年</a><span class="archive-list-count">21</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020年</a><span class="archive-list-count">39</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019年</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">2018年</a><span class="archive-list-count">26</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/">2017年</a><span class="archive-list-count">49</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-tag"></i> Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ANDROID/" rel="tag">ANDROID</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AOSP/" rel="tag">AOSP</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/" rel="tag">Activity</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AndroidNewFeatures/" rel="tag">AndroidNewFeatures</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Assembly/" rel="tag">Assembly</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BLOG/" rel="tag">BLOG</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ConstraintLayout/" rel="tag">ConstraintLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DesignPattern/" rel="tag">DesignPattern</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Drawer/" rel="tag">Drawer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Fragment/" rel="tag">Fragment</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JVM/" rel="tag">JVM</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LEETCODE/" rel="tag">LEETCODE</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Library/" rel="tag">Library</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Operators/" rel="tag">Operators</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Performance/" rel="tag">Performance</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RecyclerView/" rel="tag">RecyclerView</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RxJava/" rel="tag">RxJava</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/THINK/" rel="tag">THINK</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TOOL/" rel="tag">TOOL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TabLayout/" rel="tag">TabLayout</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Test/" rel="tag">Test</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TouchEvent/" rel="tag">TouchEvent</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VIEW/" rel="tag">VIEW</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/" rel="tag">XML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/anim/" rel="tag">anim</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/compose/" rel="tag">compose</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/concurrency/" rel="tag">concurrency</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/coroutie/" rel="tag">coroutie</a><span class="tag-list-count">7</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/inter/" rel="tag">inter</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/keyboard/" rel="tag">keyboard</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/permission/" rel="tag">permission</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/proguard/" rel="tag">proguard</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title"><i class="fa fa-link"></i> Blogroll</h3>
    <div class="widget">
      <ul>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example1.com/">site-name1</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example2.com/">site-name2</a>
        </li>
      
        <li>
          <a target="_blank" rel="noopener" href="http://www.example3.com/">site-name3</a>
        </li>
      
      </ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <a id="totop" href="#top"></a>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      <p>
        <a href="/sitemap.xml">Site Map</a>
        <span> | </span><a href="/atom.xml">Subscribe to this site</a>
        <span> | </span><a href="/about/">Contact the blogger</a>
      </p>
      
        <p>
          <i class="fa fa-visitors"></i>
          <i id="busuanzi_container_site_uv"><i id="busuanzi_value_site_uv"></i></i>
          ，
          <i class="fa fa-views"></i>
          <i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>
        </p>
      
      <p>
        <span>Copyright &copy; 2024 Jon.</span>
        <span>Theme by <a href="https://github.com/chaooo/hexo-theme-BlueLake/" target="_blank">BlueLake.</a></span>
        <span>Powered by <a href="https://hexo.io/" target="_blank">Hexo.</a></span>
      </p>
    </div>
  </div>
</footer>

    </div>
  </div>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/search.json.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>






  
<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>








  



</body>
</html>