<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Page 21 | Jon&#39;s Blog</title>
  <meta name="author" content="Jon">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Jon&#39;s Blog"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Jon&#39;s Blog" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Jon&#39;s Blog</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>Cease to struggle and you cease to live. - Thomas Carlyle<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		wubba lubba dub dub.

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/13/AndroidStudioTool/" >AndroidStudioTool</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-13  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="降低-compileSdkVersion-版本"><a href="#降低-compileSdkVersion-版本" class="headerlink" title="降低　compileSdkVersion　版本"></a>降低　compileSdkVersion　版本</h4><p> 　有时候需要看低版本的源码，就要修改compileSdkVersion版本</p>
<ol>
<li><p>修改编译版本<br><img src="/2017/08/13/AndroidStudioTool/DeepinScrot_compile.png"></p>
</li>
<li><p>targetSdkVersion版本修改成　21   然后   compile ‘com.android.support:appcompat-v7:21.+’ 继承的AppCompatActivity改成Activity</p>
</li>
<li><p>编译后报错　Error:(11) No resource identifier found for attribute ‘roundIcon’ in package ‘android’<br> 根据错误删除　android:roundIcon ,然后编译</p>
</li>
</ol>
<p>  参考：<a target="_blank" rel="noopener" href="http://blog.csdn.net/hyr83960944/article/details/39941683">http://blog.csdn.net/hyr83960944/article/details/39941683</a></p>
<h4 id="android-stuido代理"><a href="#android-stuido代理" class="headerlink" title="android stuido代理"></a>android stuido代理</h4><h5 id="普通代理"><a href="#普通代理" class="headerlink" title="普通代理"></a>普通代理</h5><p>修改Gradle配置文件后就一直卡在那，在　build.gradle值修改下面<br>如果用了ss代理，在ubuntu设置http没用，可以在 工程根目录下 gradle.properties  添加</p>
<p><code>org.gradle.jvmargs=-DsocksProxyHost=127.0.0.1 -DsocksProxyPort=1080 </code><br>参考: <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/37810416">https://www.zhihu.com/question/37810416</a></p>
<p>平常github下载项目导入AndroidStudio直接卡死，心里真不是…., 目前实验一种方式应该会快点<br>修改 gradle\wrapper\gradle-wrapper.properties下的 distributionUrl=https://services.gradle.org/distributions/gradle-3.3-all.zip， 我的AndroidStudio默认是这个 所以就修改成这样的.</p>
<h5 id="jcenter库代理-这几句话花了关键得一天时间"><a href="#jcenter库代理-这几句话花了关键得一天时间" class="headerlink" title="jcenter库代理　(这几句话花了关键得一天时间)"></a>jcenter库代理　(这几句话花了关键得一天时间)</h5><p>前天升级了系统，之前下得Demo一直跑不起来，’<a target="_blank" rel="noopener" href="https://jitpack.io&/#39;%E5%BE%97%E6%96%87%E4%BB%B6%E4%B8%80%E7%9B%B4%E4%B8%8B%E8%BD%BD%E4%B8%8D%E4%B8%8B%E6%9D%A5">https://jitpack.io&#39;得文件一直下载不下来</a>　<br>　＞错误：　jcenter.bintray.com:443 failed to respond<br>　折腾了一天终于弄好了,需要设置proxy代理,把socket流量转为http<br>　然后在　Ｍanual proxy configuration下面选择HTTP 填上<br>　 <code>127.0.0.1 　 8118 　</code><br>　 就可以下载jitpack里面得文件了</p>
<h5 id="阿里云镜像"><a href="#阿里云镜像" class="headerlink" title="阿里云镜像"></a>阿里云镜像</h5><blockquote>
<p>/Users/john/.gradle/init.gradle</p>
</blockquote>
<h5 id="下载gradle"><a href="#下载gradle" class="headerlink" title="下载gradle"></a>下载gradle</h5><p>  有时候想用新的的gradle，但是新的更新几十M的文件，一天都不一定能下下来<br>   直接去官网下载 <a target="_blank" rel="noopener" href="https://gradle.org/releases/">https://gradle.org/releases/</a>  ，对应版本的zip文件，放到相应目录<br>  比如我的就是 C:\Users\Administrator.gradle\wrapper\dists\gradle-3.3-all\55gk2rcmfc6p2dg9u9ohc3hw9\</p>
<p>还一个是在${home}/.gradle目录下得gradle.properties文件配置应该也是可以的</p>
<h4 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h4><blockquote>
<p>Ctrl＋F12，可以显示当前文件的结构<br>Ctrl＋Shift＋F7 可以高亮当前元素在当前文件中的使用<br>Ctrl＋E，可以显示最近编辑的文件列表<br> Alt＋Up 和 Alt＋Down可在方法间快速移动<br> Shift＋Click可以关闭文件<br> Ctrl+ H 查看类的继承关系<br> Ctrl＋Alt＋B可以跳转到抽象方法的实现<br> Ctrl＋Q可以看JavaDoc</p>
</blockquote>
<h5 id="全局修改快捷键"><a href="#全局修改快捷键" class="headerlink" title="全局修改快捷键"></a>全局修改快捷键</h5><p><code>Shift+F6</code></p>
<p>想要将里面的<code>cardName</code>全部替换成<code>userName</code>，则选中其中一个，按<code>shift+f6</code>回车即可批量修改。</p>
<p>参考：<a target="_blank" rel="noopener" href="https://github.com/1sters/Android-Studio-Guide/blob/master/tips-shortcuts.md">https://github.com/1sters/Android-Studio-Guide/blob/master/tips-shortcuts.md</a></p>
<p>常用快捷键:<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/lYBHtg342-t3NkPPY9E-YQ">https://mp.weixin.qq.com/s/lYBHtg342-t3NkPPY9E-YQ</a></p>
<p>Build Variants 设置成debug</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">debug &#123;</span><br><span class="line">        debuggable <span class="literal">false</span></span><br><span class="line">        minifyEnabled <span class="literal">false</span></span><br><span class="line">        signingConfig signingConfigs.debug</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>debuggable设置成 true</p>
<h5 id="SVN分支合并-主干-主干新增文件被删除"><a href="#SVN分支合并-主干-主干新增文件被删除" class="headerlink" title="SVN分支合并 主干,主干新增文件被删除"></a>SVN分支合并 主干,主干新增文件被删除</h5><p>弄了两个多小时，说多了都是泪</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/e50af339259f">https://www.jianshu.com/p/e50af339259f</a></p>
<h5 id="无线调试"><a href="#无线调试" class="headerlink" title="无线调试"></a>无线调试</h5><p><a target="_blank" rel="noopener" href="https://juejin.im/entry/5a6a7e69518825733b0f1635">https://juejin.im/entry/5a6a7e69518825733b0f1635</a></p>
<p>设置侦听断开 :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb tcpip 8888</span><br><span class="line"></span><br><span class="line">adb connect 192.168.31.76:8888</span><br></pre></td></tr></table></figure>

<p>安装包安装</p>
<p><code>adb -s acac34d7 install /e/JYWORK/</code></p>
<h5 id="win10-jdk环境变量设置"><a href="#win10-jdk环境变量设置" class="headerlink" title="win10 jdk环境变量设置"></a>win10 jdk环境变量设置</h5><p>在系统变量中设置 ,注意要点开编辑文本是不是之前输入的有 “”</p>
<h5 id="Android-stuido发布项目Jcenter"><a href="#Android-stuido发布项目Jcenter" class="headerlink" title="Android stuido发布项目Jcenter"></a>Android stuido发布项目Jcenter</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gradlew clean build bintrayUpload  -PbintrayUser&#x3D;blogforme  -PbintrayKey&#x3D;4c7511bba437157d77baeb5c17d339ce92c2bee7  -PdryRun&#x3D;false</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://github.com/novoda/bintray-release">https://github.com/novoda/bintray-release</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9f81d5b5a451">https://www.jianshu.com/p/9f81d5b5a451</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_32452623/article/details/79282605">https://blog.csdn.net/qq_32452623/article/details/79282605</a></p>
<h5 id="依赖其他moudle"><a href="#依赖其他moudle" class="headerlink" title="依赖其他moudle"></a>依赖其他moudle</h5><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/trAxRzz573TFyJk2klKdag">https://mp.weixin.qq.com/s/trAxRzz573TFyJk2klKdag</a></p>
<h5 id="android-stuido-日志"><a href="#android-stuido-日志" class="headerlink" title="android stuido 日志"></a>android stuido 日志</h5><h5 id="过滤不需要的日志"><a href="#过滤不需要的日志" class="headerlink" title="过滤不需要的日志"></a>过滤不需要的日志</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">^(?!.*(eglMakeCurrent|OpenGLRenderer)).*$</span><br><span class="line"></span><br><span class="line">eglMakeCurrent OpenGLRenderer两个包含需要过滤的字段</span><br></pre></td></tr></table></figure>

<h5 id="留下需要的日志"><a href="#留下需要的日志" class="headerlink" title="留下需要的日志"></a>留下需要的日志</h5><img src="/2017/08/13/AndroidStudioTool/Screen Shot 2021-02-06 at 11.57.50 AM.png" style="zoom: 80%;">

<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/11e56991ff28">https://www.jianshu.com/p/11e56991ff28</a></p>
<h4 id="Emulator"><a href="#Emulator" class="headerlink" title="Emulator"></a>Emulator</h4><p>显示</p>
<p><img src="/2017/08/13/AndroidStudioTool/20220610144253.jpg" alt="20220610144253"></p>

	
	</div>
  <a type="button" href="/2017/08/13/AndroidStudioTool/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/12/BroadcastReceiver/" >BroadcastReceiver</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-12  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>BroadcastReceiver</p>
<p> <a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/broadcasts.html">https://developer.android.com/guide/components/broadcasts.html</a></p>
<p> 广播使应用程序间传输传输信息的机制，主要用来监听系统或者应用发出的广播信息。<br>  BroadcastReceiver使用注意   当系统或应用发出广播时，扫描系统所有广播接收者(无论时静态注册还是动态注册方式)，通过action匹配將广播发给相应接收者，接收者收到<br>   广播后会产生一个广播实例，执行onReceiver()，这个实例生命周期只有10秒,10秒内没执行结束onReceiver，系统会报错,所以不能再onReceiver()执行耗时操作,onReceiver结束后，实例被销毁.</p>
<h4 id="BroadcastReceiver注册方式"><a href="#BroadcastReceiver注册方式" class="headerlink" title="BroadcastReceiver注册方式"></a>BroadcastReceiver注册方式</h4><h5 id="Context-registered-receivers-动态注册"><a href="#Context-registered-receivers-动态注册" class="headerlink" title="Context-registered receivers (动态注册)"></a>Context-registered receivers (动态注册)</h5><p>注册</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> UpdateBroadcastReceiver updateBr;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">protected void on<span class="constructor">Start()</span> &#123;</span><br><span class="line">    super.on<span class="constructor">Start()</span>;</span><br><span class="line">    updateBr = <span class="keyword">new</span> <span class="constructor">UpdateBroadcastReceiver()</span>;</span><br><span class="line">    IntentFilter intentFilter = <span class="keyword">new</span> <span class="constructor">IntentFilter()</span>;</span><br><span class="line">    intentFilter.add<span class="constructor">Action(ACTION_UPDATE)</span>;</span><br><span class="line">    register<span class="constructor">Receiver(<span class="params">updateBr</span>, <span class="params">intentFilter</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发送注销广播</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//点击发送广播</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="function"><span class="title">btBroadcast</span>(<span class="params">View v</span>)</span> &#123;</span><br><span class="line">    Intent intentBroad = <span class="keyword">new</span> Intent();</span><br><span class="line">    intentBroad.setAction(ACTION_UPDATE);</span><br><span class="line">    sendBroadcast(intentBroad);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="built_in">void</span> <span class="function"><span class="title">onDestroy</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>.onDestroy();</span><br><span class="line">    <span class="keyword">if</span> (updateBr != <span class="literal">null</span>) &#123;</span><br><span class="line">        unregisterReceiver(updateBr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 注意:这种注册方式　AndroidManifest.xml不用做任何操作</p>
<h5 id="静态注册"><a href="#静态注册" class="headerlink" title="静态注册"></a>静态注册</h5><p>Android 8.0之后，静态注册是无法接收隐式广播的，而默认情况下，我们发出的广播都是隐式广播，因此一定要调用setPackage()方法，指定这条广播是发送给哪个应用程序的，从而让它变成一条显示广播。（第一行代码）</p>
<p>AndroidManifest.xml添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.broadcastservice.UpdateBroadcastReceiver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;android.intent.action.UpdateBroadcastReceiver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意　为了杜绝APP滥用资源,官方对有的广播做了限制</p>
<blockquote>
<p>Note: If your app targets API level 26 or higher, you cannot use the manifest to declare a receiver for implicit broadcasts (broadcasts that do not target your app specifically), except for a few implicit broadcasts that are exempted from that restriction. In most cases, you can use scheduled jobs instead.</p>
</blockquote>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intent.setPackage(<span class="string">&quot;com.comm.util&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="Sending-broadcasts方式"><a href="#Sending-broadcasts方式" class="headerlink" title="Sending broadcasts方式"></a>Sending broadcasts方式</h4><h5 id="普通广播"><a href="#普通广播" class="headerlink" title="普通广播"></a>普通广播</h5><h5 id="有序广播"><a href="#有序广播" class="headerlink" title="有序广播"></a>有序广播</h5><p>FirstOrderBroadCast</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FirstOrderBroadCast</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;Low&quot;</span>);</span><br><span class="line">        <span class="keyword">val</span> code = <span class="number">1</span></span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = <span class="string">&quot;hello I am FirstOrderBroadCast&quot;</span></span><br><span class="line">        <span class="keyword">val</span> bundle: Bundle? = Bundle()</span><br><span class="line">        bundle?.putString(<span class="string">&quot;first&quot;</span>,<span class="string">&quot;from FirstOrderBroadCast&quot;</span>)</span><br><span class="line">        setResult(code, <span class="keyword">data</span>, bundle)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SecondOrderBroadCast</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SecondOrderBroadCast</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;Mid&quot;</span>)</span><br><span class="line">        <span class="comment">//获取上一个广播接收器结果</span></span><br><span class="line">        <span class="keyword">val</span> code = resultCode</span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = resultData</span><br><span class="line">        <span class="keyword">var</span> bundleResult = getResultExtras(<span class="literal">true</span>).<span class="keyword">get</span>(<span class="string">&quot;first&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;获取到上一个广播接收器结果：code=  <span class="variable">$code</span>   data= <span class="variable">$data</span>  bundleResult <span class="variable">$bundleResult</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ThirdOrderBroadCast</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThirdOrderBroadCast</span> : <span class="type">BroadcastReceiver</span></span>() &#123;</span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onReceive</span><span class="params">(context: <span class="type">Context</span>?, intent: <span class="type">Intent</span>?)</span></span> &#123;</span><br><span class="line">        Log.e(<span class="string">&quot;receive&quot;</span>, <span class="string">&quot;High&quot;</span>)</span><br><span class="line">        <span class="comment">//传递结果到下一个广播接收器</span></span><br><span class="line">        <span class="keyword">val</span> code = <span class="number">3</span></span><br><span class="line">        <span class="keyword">val</span> <span class="keyword">data</span> = <span class="string">&quot;hello&quot;</span></span><br><span class="line">        <span class="keyword">val</span> bundle: Bundle? = <span class="literal">null</span></span><br><span class="line">        setResult(code, <span class="keyword">data</span>, bundle)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>AndroidMnifest.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.broadcastservice.FirstOrderBroadCast&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;3000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.broadcast.android&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.broadcastservice.SecondOrderBroadCast&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;2000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.broadcast.android&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">receiver</span> <span class="attr">android:name</span>=<span class="string">&quot;.component.broadcastservice.ThirdOrderBroadCast&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">intent-filter</span> <span class="attr">android:priority</span>=<span class="string">&quot;1000&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">android:name</span>=<span class="string">&quot;com.broadcast.android&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">intent-filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">receiver</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">updateBr = UpdateBroadcastReceiver()</span><br><span class="line"><span class="keyword">val</span> intentFilter = IntentFilter()</span><br><span class="line">intentFilter.addAction(UpdateBroadcastReceiver.ACTION_UPDATE)</span><br><span class="line">registerReceiver(updateBr, intentFilter)</span><br></pre></td></tr></table></figure>

<p>使用</p>
<p>BroadcastReceiverActivity</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> intent = Intent()</span><br><span class="line">intent.action = <span class="string">&quot;com.broadcast.android&quot;</span></span><br><span class="line"></span><br><span class="line">bt_order_broadcast.setOnClickListener &#123;</span><br><span class="line">    sendOrderedBroadcast(intent,<span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight mathematica"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> <span class="variable">Low</span></span><br><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> <span class="variable">Mid</span></span><br><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> 获取到上一个广播接收器结果：<span class="variable">code</span><span class="operator">=</span>  <span class="number">1</span>   <span class="variable">data</span><span class="operator">=</span> <span class="variable">hello</span> <span class="built_in">I</span> <span class="variable">am</span> <span class="variable">FirstOrderBroadCast</span>  <span class="variable">bundleResult</span> <span class="variable">from</span> <span class="variable">FirstOrderBroadCast</span></span><br><span class="line"><span class="built_in">E</span><span class="operator">/</span><span class="variable">receive</span><span class="operator">:</span> <span class="variable">High</span></span><br></pre></td></tr></table></figure>

<h5 id="LocalBroadcastManager-sendBroadcast"><a href="#LocalBroadcastManager-sendBroadcast" class="headerlink" title="LocalBroadcastManager.sendBroadcast"></a><a target="_blank" rel="noopener" href="https://developer.android.com/reference/androidx/localbroadcastmanager/content/LocalBroadcastManager#sendBroadcast(android.content.Intent)">LocalBroadcastManager.sendBroadcast</a></h5><p>method sends broadcasts to receivers that are in the same app as the sender. If you don’t need to send broadcasts across apps, use local broadcasts.he implementation is much more efficient (no interprocess communication needed) and you don’t need to worry about any security issues related to other apps being able to receive or send your broadcasts.(应用内发送广播)</p>
<p>发送</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> intentBroad = Intent()</span><br><span class="line">intentBroad.action = UpdateBroadcastReceiver.ACTION_UPDATE</span><br><span class="line">LocalBroadcastManager.getInstance(<span class="keyword">this</span>).sendBroadcast(intentBroad)</span><br></pre></td></tr></table></figure>

<p>注册 </p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">updateBr = UpdateBroadcastReceiver()</span><br><span class="line"><span class="keyword">val</span> intentFilter = IntentFilter()</span><br><span class="line">intentFilter.addAction(UpdateBroadcastReceiver.ACTION_UPDATE)</span><br><span class="line">registerReceiver(updateBr, intentFilter)</span><br><span class="line">updateBr?.let &#123;</span><br><span class="line">    LocalBroadcastManager.getInstance(<span class="keyword">this</span>).registerReceiver(it,intentFilter)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_30379689/article/details/53341313">https://blog.csdn.net/qq_30379689/article/details/53341313</a></p>

	
	</div>
  <a type="button" href="/2017/08/12/BroadcastReceiver/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/11/SERVICE/" >SERVICE</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-11  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/services">https://developer.android.com/guide/components/services</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/app/Service">https://developer.android.com/reference/android/app/Service</a></p>
<h5 id="Service启动服务两种方式"><a href="#Service启动服务两种方式" class="headerlink" title="Service启动服务两种方式"></a>Service启动服务两种方式</h5><ul>
<li> startService </li>
<li> bindService</li>
</ul>
<h5 id="startService"><a href="#startService" class="headerlink" title="startService"></a>startService</h5><p>一个Service被startService多次启动,那么onCreate只会调用一次,onstart()会被调用多次, StartServcie:一旦启动，服务即可在后台无限期运行，即使启动服务的Ａctivity已被销毁也不受影响,直到调用stipService，或自身的stopSelf方法。内存不足系统也会结束服务。</p>
<p> <img src="https://developer.android.google.cn/images/service_lifecycle.png" alt="Servcie lifeccle"></p>
<h5 id="bindService"><a href="#bindService" class="headerlink" title="bindService"></a>bindService</h5><p>客户端通过IBinder接口于服务进行通信,客户端可以调用unbindServie关闭连接,当所有客户端关闭连接后系统会销毁服务.<br>启动Log日志<br>I/LearnService:  – onCreate() –<br>I/LearnService:  – onBind() –<br>　一个Service被某个Activity调用Context.bindService绑定启动，不管bindService调用几次，onCreate方法只会调用一次,onStart不会调用.</p>
<ol>
<li><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BluetoothService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line">        Timber.i(<span class="string">&quot; onCreate()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        Timber.i(<span class="string">&quot; onStartCommand()&quot;</span>);</span><br><span class="line">        String param = intent.getStringExtra(PARRAM);</span><br><span class="line">        Timber.i(<span class="string">&quot;接受    &quot;</span> + param);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onStartCommand(intent, flags, startId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onDestroy();</span><br><span class="line">        Timber.i(<span class="string">&quot; onDestroy()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onLowMemory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onLowMemory();</span><br><span class="line">        Timber.i(<span class="string">&quot;onLowMemory()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onUnbind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        Timber.i(<span class="string">&quot;onUnbind(intent)()&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.onUnbind(intent);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRebind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onRebind(intent);</span><br><span class="line">        Timber.i(<span class="string">&quot;onRebind(intent)()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LocalBinder</span> <span class="keyword">extends</span> <span class="title">Binder</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> BluetoothService <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BluetoothService.<span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> IBinder mBinder = <span class="keyword">new</span> LocalBinder();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IBinder <span class="title">onBind</span><span class="params">(Intent intent)</span> </span>&#123;</span><br><span class="line">        Timber.i(<span class="string">&quot;onBind(intent)()&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> mBinder;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>启动</p>
</li>
<li><p><code>bindService(intent,mServiceConnection,BIND_AUTO_CREATE);</code></p>
</li>
<li><p>回调</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ServiceConnection mServiceConnection = <span class="keyword">new</span> ServiceConnection() &#123;</span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>&#123;</span><br><span class="line">           mBlueService =  ((BluetoothService.LocalBinder)service).getService();</span><br><span class="line">           Timber.i(<span class="string">&quot;onServiceConnected(ComponentName name, IBinder service)&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="meta">@Override</span></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>&#123;</span><br><span class="line">          Timber.i(<span class="string">&quot;onServiceDisconnected(ComponentName name)&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>





<ul>
<li> 先startService创建服务，然后bindService绑定，这时候调用stopService或stopSelf(),不会停止，只能使unbindService()停止服务</li>
</ul>
<h6 id="IntentService"><a href="#IntentService" class="headerlink" title="IntentService"></a>IntentService</h6><p>   通过HandlerThread单独开启一个线程一次处理所有的任务<br>   不需要调用stopSelft()关闭服务，任务结束后自动关闭</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onCreate() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onStartCommand() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onStartCommand() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onStartCommand() --</span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30655</span>/com.hyhy.lern I/MyIntentService: do task<span class="number">1</span></span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30655</span>/com.hyhy.lern I/MyIntentService: do task<span class="number">2</span></span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">601</span> <span class="number">30532</span>-<span class="number">30655</span>/com.hyhy.lern I/MyIntentService: do task<span class="number">1</span></span><br><span class="line"><span class="attribute">08</span>-<span class="number">12</span> <span class="number">13</span>:<span class="number">38</span>:<span class="number">26</span>.<span class="number">617</span> <span class="number">30532</span>-<span class="number">30532</span>/com.hyhy.lern I/MyIntentService: -- onDestroy() --</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://developer.android.com/training/run-background-service/create-service.html">https://developer.android.com/training/run-background-service/create-service.html</a></p>
<h5 id="onStartCommand"><a href="#onStartCommand" class="headerlink" title="onStartCommand()"></a>onStartCommand()</h5><p><strong>1. onStartCommand方式中，返回START_STICKY</strong></p>
<p>首先我们来看看onStartCommand都可以返回哪些值：</p>
<p>调用Context.startService方式启动Service时，如果Android面临内存匮乏，可能会销毁当前运行的Service，待内存充足时可以重建Service。而Service被Android系统强制销毁并再次重建的行为依赖于Service的onStartCommand()方法的返回值。</p>
<p><strong>START_NOT_STICKY</strong><br> 如果返回START_NOT_STICKY，表示当Service运行的进程被Android系统强制杀掉之后，不会重新创建该Service。当然如果在其被杀掉之后一段时间又调用了startService，那么该Service又将被实例化。那什么情境下返回该值比较恰当呢？<br> 如果我们某个Service执行的工作被中断几次无关紧要或者对Android内存紧张的情况下需要被杀掉且不会立即重新创建这种行为也可接受，那么我们便可将 onStartCommand的返回值设置为START_NOT_STICKY。<br> 举个例子，某个Service需要定时从服务器获取最新数据：通过一个定时器每隔指定的N分钟让定时器启动Service去获取服务端的最新数据。当执行到Service的onStartCommand时，在该方法内再规划一个N分钟后的定时器用于再次启动该Service并开辟一个新的线程去执行网络操作。假设Service在从服务器获取最新数据的过程中被Android系统强制杀掉，Service不会再重新创建，这也没关系，因为再过N分钟定时器就会再次启动该Service并重新获取数据</p>
<p><strong>START_STICKY</strong><br> 如果返回START_STICKY，表示Service运行的进程被Android系统强制杀掉之后，Android系统会将该Service依然设置为started状态（即运行状态），但是不再保存onStartCommand方法传入的intent对象，然后Android系统会尝试再次重新创建该Service，并执行onStartCommand回调方法，但是onStartCommand回调方法的Intent参数为null，也就是onStartCommand方法虽然会执行但是获取不到intent信息。如果你的Service可以在任意时刻运行或结束都没什么问题，而且不需要intent信息，那么就可以在onStartCommand方法中返回START_STICKY，比如一个用来播放背景音乐功能的Service就适合返回该值。</p>
<p><strong>START_REDELIVER_INTENT</strong><br> 如果返回START_REDELIVER_INTENT，表示Service运行的进程被Android系统强制杀掉之后，与返回START_STICKY的情况类似，Android系统会将再次重新创建该Service，并执行onStartCommand回调方法，但是不同的是，Android系统会再次将Service在被杀掉之前最后一次传入onStartCommand方法中的Intent再次保留下来并再次传入到重新创建后的Service的onStartCommand方法中，这样我们就能读取到intent参数。只要返回START_REDELIVER_INTENT，那么onStartCommand重的intent一定不是null。如果我们的Service需要依赖具体的Intent才能运行（需要从Intent中读取相关数据信息等），并且在强制销毁后有必要重新创建运行，那么这样的Service就适合返回START_REDELIVER_INTENT。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5b1747e5e51d45069a39ef45">https://juejin.im/post/5b1747e5e51d45069a39ef45</a></p>
<p> <a target="_blank" rel="noopener" href="https://developer.android.com/guide/components/bound-services#kotlin">https://developer.android.com/guide/components/bound-services#kotlin</a> </p>
<ul>
<li><p>bindService callback</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">class BindingActivity : Activity() &#123;</span><br><span class="line">    <span class="keyword">private</span> lateinit <span class="keyword">var</span> mService: LocalService</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> mBound: Boolean = <span class="keyword">false</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Defines callbacks for service binding, passed to bindService()  */</span></span><br><span class="line">    <span class="keyword">private</span> val connection = object : ServiceConnection &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function">override fun <span class="title">onServiceConnected</span><span class="params">(className: ComponentName, service: IBinder)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// We&#x27;ve bound to LocalService, cast the IBinder and get LocalService instance</span></span><br><span class="line">            val binder = service as LocalService.LocalBinder</span><br><span class="line">            mService = binder.getService()</span><br><span class="line">            mBound = <span class="keyword">true</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function">override fun <span class="title">onServiceDisconnected</span><span class="params">(arg0: ComponentName)</span> </span>&#123;</span><br><span class="line">            mBound = <span class="keyword">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onCreate</span><span class="params">(savedInstanceState: Bundle?)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.main)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStart()</span><br><span class="line">        <span class="comment">// Bind to LocalService</span></span><br><span class="line">        Intent(<span class="keyword">this</span>, LocalService::class.java).also &#123; intent -&gt;</span><br><span class="line">            bindService(intent, connection, Context.BIND_AUTO_CREATE)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">onStop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onStop()</span><br><span class="line">        unbindService(connection)</span><br><span class="line">        mBound = <span class="keyword">false</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Called when a button is clicked (the button in the layout file attaches to</span></span><br><span class="line"><span class="comment">     * this method with the android:onClick attribute)  */</span></span><br><span class="line">    <span class="function">fun <span class="title">onButtonClick</span><span class="params">(v: View)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mBound) &#123;</span><br><span class="line">            <span class="comment">// Call a method from the LocalService.</span></span><br><span class="line">            <span class="comment">// However, if this call were something that might hang, then this request should</span></span><br><span class="line">            <span class="comment">// occur in a separate thread to avoid slowing down the activity performance.</span></span><br><span class="line">            val num: Int = mService.randomNumber</span><br><span class="line">            Toast.makeText(<span class="keyword">this</span>, <span class="string">&quot;number: $num&quot;</span>, Toast.LENGTH_SHORT).show()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>get Service object in this place </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val binder = service as LocalService.LocalBinder</span><br><span class="line">mService = binder.getService()</span><br></pre></td></tr></table></figure>

<h5 id="Using-a-Messenger"><a href="#Using-a-Messenger" class="headerlink" title="Using a Messenger"></a>Using a Messenger</h5><p> If you need your service to communicate with remote processes, then you can use a <code>Messenger</code> to provide the interface for your service. </p>
</li>
</ul>
<h5 id="stopself"><a href="#stopself" class="headerlink" title="stopself()"></a>stopself()</h5><p>​    目前测试只有在onStartCommand()有效，多次点击startService(intent),startId持续递增.</p>
<h5 id="foreground-service（前台服务）"><a href="#foreground-service（前台服务）" class="headerlink" title="foreground service（前台服务）"></a>foreground service（前台服务）</h5><p> 被用户所知道，系统内存不足时候不允许被系统杀死的服务，前台服务必须给通知了一个通知，放在正在运行的标题之下，一般用于应用保活。</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/5505390503fa">https://www.jianshu.com/p/5505390503fa</a></p>
<h5 id="onRebind-什么情况下执行"><a href="#onRebind-什么情况下执行" class="headerlink" title="onRebind()什么情况下执行"></a>onRebind()什么情况下执行</h5><p><img src="/2017/08/11/SERVICE/service_binding_tree_lifecycle.png"></p>
<p>验证方法: startService(intent) 启动Service - bindService() 绑定Service - unBindService()解绑-  bindService() 继续绑定 就会执行onRebind()</p>
<h5 id="多个acitivty与service通信"><a href="#多个acitivty与service通信" class="headerlink" title="多个acitivty与service通信"></a>多个acitivty与service通信</h5><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9885acf65405">https://www.jianshu.com/p/9885acf65405</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/pihailailou/article/details/78588496">https://blog.csdn.net/pihailailou/article/details/78588496</a></p>

	
	</div>
  <a type="button" href="/2017/08/11/SERVICE/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/10/DesignPatterns_Adatper/" >DesignPatterns-Adatper</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-10  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><pre><code> //需要适配的类
public class Adaptee &#123;
  public  void specificRequest()&#123;
    System.out.println(&quot;需要适配的类&quot;);
  &#125;
&#125;

 //目标接口
public interface Target &#123;
 void request();
&#125;
</code></pre>
<h1 id="对象适配器（采用对象组合方式实现）"><a href="#对象适配器（采用对象组合方式实现）" class="headerlink" title="对象适配器（采用对象组合方式实现）"></a>对象适配器（采用对象组合方式实现）</h1><pre><code>public class Adapter implements Target &#123;
    //直接关联被适配类
    private Adaptee adaptee;

    //可以通过构造函数传入具体需要适配的被适配类对象
    public Adapter(Adaptee adaptee) &#123;
        this.adaptee = adaptee;
    &#125;

    @Override
    public void request() &#123;
        this.adaptee.specificRequest();
    &#125;

    public static void main(String[] args) &#123;
        Target adapter = new Adapter(new Adaptee());
        adapter.request();
    &#125;
&#125;
</code></pre>
<h1 id="类适配器模式-采用继承实现"><a href="#类适配器模式-采用继承实现" class="headerlink" title="类适配器模式(采用继承实现)"></a>类适配器模式(采用继承实现)</h1><pre><code>public class CAdapter extends Adaptee implements Target &#123;
    @Override
    public void request() &#123;
        super.specificRequest();
    &#125;

    public static void main(String[] args) &#123;

        Target adapter = new CAdapter();
        adapter.request();
    &#125;
&#125;
</code></pre>
<h2 id="Builder模式"><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h2><p>参考　：<a target="_blank" rel="noopener" href="https://github.com/helen-x/AndroidInterview/blob/master/android/Android%20%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A8%E5%9C%A8%E8%BF%99%E9%87%8C).md">https://github.com/helen-x/AndroidInterview/blob/master/android/Android%20%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F(%E4%BD%A0%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%85%A8%E5%9C%A8%E8%BF%99%E9%87%8C).md</a></p>

	
	</div>
  <a type="button" href="/2017/08/10/DesignPatterns_Adatper/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/10/DesignPatterns_Factory/" >DesignPatterns  Factory</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-10  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h5 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a>工厂方法模式</h5><p><img src="/2017/08/10/DesignPatterns_Factory/2021-09-12_factory.png" alt="2021-09-12_6.40.17_factory"></p>
<p><img src="/2017/08/10/DesignPatterns_Factory/2021-09-12_fac_indraduce.png" alt="2021-09-12_6.41.32_fac_indraduce"></p>
<p>工厂方法和抽象工厂方法 都是通过工厂生产产品，由于产品都实现了相同的接口，根据获取到的产品作相应的处理</p>
<p>工厂方法 :返回一个产品实例 ,  继承了工厂Dialog Base类,Base类抽象方法由sub类实现</p>
<p>抽象工厂方法:可以返回一组相关的产品实例,实现了创建不同产品的抽象工厂接口</p>
<h5 id="Simple-factory"><a href="#Simple-factory" class="headerlink" title="Simple factory"></a>Simple factory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SimplePizzaFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PizzaStore</span><span class="params">(SimplePizzaFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = factory.createPizza(type);</span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePizzaFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">createPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;cheese&quot;</span>.equals(type)) &#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> CheesePizza();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;pepperoni&quot;</span>.equals(type)) &#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> PepperoniPizza();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;calm&quot;</span>.equals(type)) &#123;</span><br><span class="line">            pizza = <span class="keyword">new</span> GreekPizza();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PizzaStore</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    SimplePizzaFactory factory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PizzaStore</span><span class="params">(SimplePizzaFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Pizza <span class="title">orderPizza</span><span class="params">(String type)</span> </span>&#123;</span><br><span class="line">        Pizza pizza = factory.createPizza(type);</span><br><span class="line">        pizza.prepare();</span><br><span class="line">        pizza.bake();</span><br><span class="line">        pizza.cut();</span><br><span class="line">        pizza.box();</span><br><span class="line">        <span class="keyword">return</span> pizza;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Pizza</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    String dough;</span><br><span class="line">    String sauce;</span><br><span class="line">    ArrayList topping = <span class="keyword">new</span> ArrayList();</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">prepare</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        printOperation(<span class="string">&quot;preparing     &quot;</span> + name);</span><br><span class="line">        System.out.println(<span class="string">&quot;Tossing dough...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding sauce&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding topping: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;topping.size();i++)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;    &quot;</span>+topping.get(i));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">bake</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        printOperation(<span class="string">&quot;bake  for 25 minutes at 350&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>   <span class="keyword">void</span> <span class="title">cut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        printOperation(<span class="string">&quot;Cutting the pizza into diagonal slices&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">box</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        printOperation(<span class="string">&quot;Place pizza in official pizzaStore bx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">printOperation</span><span class="params">(String op)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="comment">/*getClass().getSimpleName() + &quot; &quot; +*/</span> op);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SimplePizzaFactory calmFactory = <span class="keyword">new</span> SimplePizzaFactory();</span><br><span class="line">PizzaStore calmPizza = <span class="keyword">new</span> PizzaStore(calmFactory);</span><br><span class="line">calmPizza.orderPizza(<span class="string">&quot;calm&quot;</span>);</span><br></pre></td></tr></table></figure>





<h5 id="Static-Factory（静态工厂模式）"><a href="#Static-Factory（静态工厂模式）" class="headerlink" title="Static Factory（静态工厂模式）"></a>Static Factory（静态工厂模式）</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">implements</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Cat move&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li>工厂类　对实例类进行管理和创建</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line"> <span class="comment">//静态工厂方法</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Cat <span class="title">produceCat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Dog <span class="title">produceDog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">     Animal cat = Factory.produceCat();</span><br><span class="line">     cat.move();</span><br><span class="line"></span><br><span class="line">     Dog dog = Factory.produceDog();</span><br><span class="line">     dog.move();</span><br><span class="line">     dog.eatBone();</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;`</span><br></pre></td></tr></table></figure>

<p>假如我要实例化一个pig对象,那么肯定是要在Factory做添加的，接下来看看可以不修改其他类实现需求</p>
<ol start="2">
<li>Abstract Factory(抽象工厂 elementary )</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Provider</span> </span>&#123;</span><br><span class="line"> <span class="function">Animal <span class="title">produce</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DogFactory</span> <span class="keyword">implements</span>  <span class="title">Provider</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Animal <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> Dog();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CatFactory</span> <span class="keyword">implements</span> <span class="title">Provider</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Animal <span class="title">produce</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    Provider provider = new CatFactory();<br>​     Animal cat = provider.produce();<br>​    cat.move();<br>  如果要实例化Pig，添加一个PigFactory 就可以了</p>
<h5 id="不同Button实例"><a href="#不同Button实例" class="headerlink" title="不同Button实例"></a>不同Button实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * // 抽象工厂接口声明了一组能返回不同抽象产品的方法。这些产品属于同一个系列</span></span><br><span class="line"><span class="comment"> * // 且在高层主题或概念上具有相关性。同系列的产品通常能相互搭配使用。系列产</span></span><br><span class="line"><span class="comment"> * // 品可有多个变体，但不同变体的产品不能搭配使用。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GUIFactory</span> </span>&#123;</span><br><span class="line">    <span class="function">Button <span class="title">createButton</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">CheckBox <span class="title">createCheckBox</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Concrete factories produce a family of products that belong</span></span><br><span class="line"><span class="comment">// to a single variant. The factory guarantees that the</span></span><br><span class="line"><span class="comment">// resulting products are compatible. Signatures of the concrete</span></span><br><span class="line"><span class="comment">// factory&#x27;s methods return an abstract product, while inside</span></span><br><span class="line"><span class="comment">// the method a concrete product is instantiated.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WinFactory</span> <span class="keyword">implements</span>  <span class="title">GUIFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Button <span class="title">createButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WinButton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CheckBox <span class="title">createCheckBox</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WinCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacFactory</span> <span class="keyword">implements</span>  <span class="title">GUIFactory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Button <span class="title">createButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MacButton();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CheckBox <span class="title">createCheckBox</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MacCheckbox();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * // 系列产品中的特定产品必须有一个基础接口。所有产品变体都必须实现这个接口。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span>  <span class="title">paint</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Concrete products are created by corresponding concrete</span></span><br><span class="line"><span class="comment">// factories.</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WinButton</span> <span class="keyword">implements</span> <span class="title">Button</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据 Windows 样式渲染按钮   WinButton&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacButton</span> <span class="keyword">implements</span> <span class="title">Button</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据 macOs 样式渲染按钮 MacButton&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这是另一个产品的基础接口。所有产品都可以互动，但是只有相同具体变体的产</span></span><br><span class="line"><span class="comment">// 品之间才能够正确地进行交互。</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CheckBox</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span>  <span class="title">paint</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WinCheckbox</span> <span class="keyword">implements</span>  <span class="title">CheckBox</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据 Win 样式渲染复选框。   WinCheckbox&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MacCheckbox</span> <span class="keyword">implements</span>  <span class="title">CheckBox</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;根据 macOS 样式渲染复选框。   MacCheckbox&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> GUIFactory factory;</span><br><span class="line">    <span class="keyword">private</span> Button button;</span><br><span class="line">    <span class="keyword">private</span> CheckBox checkBox;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Application</span><span class="params">(GUIFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.factory = factory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createUi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.button = factory.createButton();</span><br><span class="line">        <span class="keyword">this</span>.checkBox = factory.createCheckBox();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">void</span> <span class="title">paint</span><span class="params">()</span></span>&#123;</span><br><span class="line">        button.paint();</span><br><span class="line">        checkBox.paint();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://refactoring.guru/design-patterns/abstract-factory">https://refactoring.guru/design-patterns/abstract-factory</a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/20367734">https://www.zhihu.com/question/20367734</a></p>
<h5 id="不同Dialog实例"><a href="#不同Dialog实例" class="headerlink" title="不同Dialog实例"></a>不同Dialog实例</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Dialog</span> </span>&#123;</span><br><span class="line">    <span class="comment">// The creator may also provide some default implementation</span></span><br><span class="line">    <span class="comment">// of the factory method.</span></span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> Button <span class="title">createButton</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Note that, despite its name, the creator&#x27;s primary</span></span><br><span class="line">    <span class="comment">// responsibility isn&#x27;t creating products. It usually</span></span><br><span class="line">    <span class="comment">// contains some core business logic that relies on product</span></span><br><span class="line">    <span class="comment">// objects returned by the factory method. Subclasses can</span></span><br><span class="line">    <span class="comment">// indirectly change that business logic by overriding the</span></span><br><span class="line">    <span class="comment">// factory method and returning a different type of product</span></span><br><span class="line">    <span class="comment">// from it.</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Call the factory method to create a product object.</span></span><br><span class="line">        Button okButton = createButton();</span><br><span class="line">        <span class="comment">// Now use the product.</span></span><br><span class="line">        okButton.onClick(<span class="string">&quot;closeDialog&quot;</span>);</span><br><span class="line">        okButton.render();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowsDialogFac</span> <span class="keyword">extends</span> <span class="title">Dialog</span> </span>&#123;</span><br><span class="line">    <span class="function">Button <span class="title">createButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WindowsButton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebDialogFac</span> <span class="keyword">extends</span> <span class="title">Dialog</span> </span>&#123;</span><br><span class="line">    <span class="function">Button <span class="title">createButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HTMLButton();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Button</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">render</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onClick</span><span class="params">(String  cls)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class WindowsButton implements Button &#123;</span><br><span class="line">    public void render() &#123;</span><br><span class="line">        System.out.println(&quot;WindowsButton   render()&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onClick(String cls) &#123;</span><br><span class="line">        System.out.println(&quot;WindowsButton   onClick &quot;+cls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class HTMLButton implements Button &#123;</span><br><span class="line">    public void render() &#123;</span><br><span class="line">        System.out.println(&quot;HTMLButton   render()&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void onClick(String cls) &#123;</span><br><span class="line">        System.out.println(&quot;HTMLButton   onClick &quot;+cls);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line">    Dialog dialog;</span><br><span class="line"></span><br><span class="line">    String configOs = <span class="string">&quot;Windows&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">initialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (configOs.equals(<span class="string">&quot;Windows&quot;</span>)) &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> WindowsDialogFac();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (configOs.equals(<span class="string">&quot;HTML&quot;</span>)) &#123;</span><br><span class="line">            dialog = <span class="keyword">new</span> WebDialogFac();</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Error! Unknown operating system.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The client code works with an instance of a concrete</span></span><br><span class="line">    <span class="comment">// creator, albeit through its base interface. As long as</span></span><br><span class="line">    <span class="comment">// the client keeps working with the creator via the base</span></span><br><span class="line">    <span class="comment">// interface, you can pass it any creator&#x27;s subclass.</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        initialize();</span><br><span class="line">        dialog.render();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="抽象工厂"><a href="#抽象工厂" class="headerlink" title="抽象工厂"></a>抽象工厂</h5><p>简单工厂的工厂,产品族</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_18242391/article/details/81503370">https://blog.csdn.net/qq_18242391/article/details/81503370</a></p>

	
	</div>
  <a type="button" href="/2017/08/10/DesignPatterns_Factory/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/09/Accessibility/" >Accessibility</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-09  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p> 先上官网地址  <a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/ui/accessibility/services.html">https://developer.android.com/guide/topics/ui/accessibility/services.html</a><br>下面的是例子  <a target="_blank" rel="noopener" href="https://developer.android.com/training/accessibility/index.html">https://developer.android.com/training/accessibility/index.html</a></p>
<p>然后是codelab 看看 <a target="_blank" rel="noopener" href="https://codelabs.developers.google.com/codelabs/developing-android-a11y-service/index.html?index=../../index#0">https://codelabs.developers.google.com/codelabs/developing-android-a11y-service/index.html?index=..%2F..%2Findex#0</a></p>
<p>这是codelab github上的地址   <a target="_blank" rel="noopener" href="https://github.com/googlecodelabs/android-accessibility">https://github.com/googlecodelabs/android-accessibility</a><br>一、简单实现<br>1、创建一个   MyAccessibilityService类  继承 AccessibilityService</p>
<p>…</p>
<pre><code>public class MyAccessibilityService extends AccessibilityService &#123;

 @Override
 public void onAccessibilityEvent(AccessibilityEvent event) &#123;
 &#125;

 @Override
 public void onInterrupt() &#123;
&#125;
</code></pre>
<p>   }<br>…</p>
<p>2、创建一个values下创建XML文件夹</p>
<p><accessibility-service android:accessibilityeventtypes="typeViewClicked|typeViewFocused" android:packagenames="com.example.android.myFirstApp, com.example.android.mySecondApp" android:accessibilityfeedbacktype="feedbackSpoken" android:notificationtimeout="100" android:settingsactivity="com.example.android.apis.accessibility.TestBackActivity" android:canretrievewindowcontent="true"></accessibility-service></p>
<p>3、 实现 onServiceConnected()</p>
<pre><code>@Override
public void onServiceConnected() &#123;
     // Set the type of events that this service wants to listen to.  Others
     // won&#39;t be passed to this service.
     info.eventTypes = AccessibilityEvent.TYPE_VIEW_CLICKED |
            AccessibilityEvent.TYPE_VIEW_FOCUSED;

     // If you only want this service to work with specific applications, set their
    // package names here.  Otherwise, when the service is activated, it will listen
    // to events from all applications.
    info.packageNames = new String[]
            &#123;&quot;com.example.android.myFirstApp&quot;, &quot;com.example.android.mySecondApp&quot;&#125;;

    // Set the type of feedback your service will provide.
    info.feedbackType = AccessibilityServiceInfo.FEEDBACK_SPOKEN;

    // Default services are invoked only if no package-specific ones are present
    // for the type of AccessibilityEvent generated.  This service *is*
    // application-specific, so the flag isn&#39;t necessary.  If this was a
    // general-purpose service, it would be worth considering setting the
    // DEFAULT flag.

    // info.flags = AccessibilityServiceInfo.DEFAULT;

     info.notificationTimeout = 100;

     this.setServiceInfo(info);
     Log.i(&quot;test&quot;,&quot;测试&quot;);
&#125;
</code></pre>
<p>4、实现 onAccessibilityEvent方法</p>
<pre><code>@Override
public void onAccessibilityEvent(AccessibilityEvent event) &#123;
 final int eventType = event.getEventType();
 String eventText = null;
 switch(eventType) &#123;
    case AccessibilityEvent.TYPE_VIEW_CLICKED:
        eventText = &quot;Focused: &quot;;
        break;
    case AccessibilityEvent.TYPE_VIEW_FOCUSED:
        eventText = &quot;Focused: &quot;;
        break;
 &#125;

 eventText = eventText + event.getContentDescription();

 // Do something nifty with this text, like speak the composed string
// back to the user.
 speakToUser(eventText);
&#125;
...
</code></pre>
<p>然后就可以开启辅助功能，看下log</p>

	
	</div>
  <a type="button" href="/2017/08/09/Accessibility/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/07/OKHTTP/" >OKHTTP</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-07  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>Okhttp使用线程池无 核心级线程，不应该先把阻塞队列塞满，再执行非核心级线程吗，这样任何不应该会立即执行呀？？？</p>
<p>阻塞队列用了synchrnized 会添加失败。所以直接创建非核心线程。</p>
<h4 id="如何阅读开源项目"><a href="#如何阅读开源项目" class="headerlink" title="如何阅读开源项目"></a>如何阅读开源项目</h4><p><a target="_blank" rel="noopener" href="https://time.geekbang.org/column/article/186778">https://time.geekbang.org/column/article/186778</a></p>
<p><a target="_blank" rel="noopener" href="https://www.imooc.com/article/301778">https://www.imooc.com/article/301778</a></p>
<p><a target="_blank" rel="noopener" href="https://baixin.ink/2019/05/10/how-to-learn-opensorce-project/">https://baixin.ink/2019/05/10/how-to-learn-opensorce-project/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/656dbb97a40f">https://www.jianshu.com/p/656dbb97a40f</a></p>
<p><a target="_blank" rel="noopener" href="https://www.codedump.info/post/20200605-how-to-read-code-v2020/">https://www.codedump.info/post/20200605-how-to-read-code-v2020/</a></p>
<p>不管写的怎么样，先把东西弄出来，然后参考别人的写法，做对比</p>
<h4 id="Okhttp优势"><a href="#Okhttp优势" class="headerlink" title="Okhttp优势"></a>Okhttp优势</h4><p><a target="_blank" rel="noopener" href="https://square.github.io/okhttp/">https://square.github.io/okhttp/</a></p>
<p>OkHttp is an HTTP client that’s efficient by default:</p>
<ul>
<li>HTTP/2 support allows all requests to the same host to share a socket.</li>
<li>Connection pooling reduces request latency (if HTTP/2 isn’t available).</li>
<li>Transparent GZIP shrinks download sizes.</li>
<li>Response caching avoids the network completely for repeat requests.</li>
</ul>
<h4 id="任务运行图"><a href="#任务运行图" class="headerlink" title="任务运行图"></a>任务运行图</h4><p><img src="/2017/08/07/OKHTTP/2021-07-23_2.26_OKHTTP.png"></p>
<h4 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h4><p>一开始看了网上视频，就说Okhttp是自驱动循环调用，相对于AsyncTask的优势就是 并发执行，但是这两条不就矛盾了吗，既然环形链式调用，怎么能并发呢。就从源码中找答案。</p>
<p>Dispatcher.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxRequests = <span class="number">64</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> maxRequestsPerHost = <span class="number">5</span>;</span><br><span class="line"><span class="function"><span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">enqueue</span><span class="params">(AsyncCall call)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (runningAsyncCalls.size() &lt; maxRequests &amp;&amp; runningCallsForHost(call) &lt; maxRequestsPerHost) &#123;</span><br><span class="line">      runningAsyncCalls.add(call);</span><br><span class="line">      executorService().execute(call);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      readyAsyncCalls.add(call);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>可以看到提交任务 &gt;5时，才会被添加到readyAsyncCalls队列中。&lt;5的任务直接提交。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">promoteCalls</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="keyword">return</span>; <span class="comment">// Already running max capacity.</span></span><br><span class="line">  <span class="keyword">if</span> (readyAsyncCalls.isEmpty()) <span class="keyword">return</span>; <span class="comment">// No ready calls to promote.</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (Iterator&lt;AsyncCall&gt; i = readyAsyncCalls.iterator(); i.hasNext(); ) &#123;</span><br><span class="line">    AsyncCall call = i.next();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (runningCallsForHost(call) &lt; maxRequestsPerHost) &#123;</span><br><span class="line">      i.remove();</span><br><span class="line">      runningAsyncCalls.add(call);</span><br><span class="line">      Log.i(<span class="string">&quot;Dispatcher&quot;</span>, <span class="string">&quot;promoteCalls:  准备队列 &quot;</span>+call.request().tag+<span class="string">&quot; 执行&quot;</span>);</span><br><span class="line">      executorService().execute(call);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (runningAsyncCalls.size() &gt;= maxRequests) <span class="keyword">return</span>; <span class="comment">// Reached max capacity.</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>readyAsyncCalls不为空，然后取出一条，再执行，可以看到，默认情况下会有5条环形任务链。</p>
<h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><p><img src="/2017/08/07/OKHTTP/2021-07-24_6.43_interupt.png"></p>
<p>OkHttp的拦截器有：</p>
<ul>
<li>RetryAndFollowUpInterceptor：失败和重定向拦截器；</li>
<li>BridgeInterceptor：负责将http协议必备的请求头加入其中(host),并添加一些默认的行为(gzip),获得结果后，调用cookie接口并解析GZIP数据。</li>
<li>CacheInterceptor：缓存处理相关的拦截器；</li>
<li>ConnectInterceptor： 负责找到或者新建一个连接，并获取对应的socket流；在获得结果后不进行额外的处理。</li>
<li>CallServerInterceptor：进行真正的与服务器的通信，向服务器请求和读响应的拦截器；</li>
</ul>
<h5 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h5><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/TeQhe4T4wRjdAEPz6Ne45g"><em>okhttp</em> 是如何支持 Http2 的？</a></p>
<p>Handshake则会把服务端支持的Tls版本，加密方式等都带回来，然后会把这个没有验证过的HandShake用X509Certificate去验证证书的有效性。然后会通过Platform去从SSLSocket去获取ALPN的协议支持信息，当后端支持的协议内包含Http2.0时，则就会把请求升级到Http2.0阶段。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6898145227765186567">Okhttp连接池是咋实现的?</a></p>
<p>在连接池中找连接的时候会对比连接池中相同host的连接。</p>
<p>如果在连接池中找不到连接的话，会创建连接，创建完后会存储到连接池中。</p>
<p>在把连接放入连接池中时，会把清除操作的任务放入到线程池中执行，删除任务中会判断当前连接有没有在使用中，有没有正在使用通过RealConnection的transmitters集合的size是否为0来判断，如果不在使用中，找出空闲时间最长的连接，如果空闲时间最长的连接超过了keep-alive默认的5分钟或者空闲的连接数超过了最大的keep-alive连接数5个的话，会把存活时间最长的连接从连接池中删除。保证keep-alive的最大空闲时间和最大的连接数</p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5f0452615188252e5522b747">雨露均沾的OkHttp—WebSocket长连接（使用篇）</a> </p>
</li>
<li><p><a target="_blank" rel="noopener" href="http://mp.weixin.qq.com/s?__biz=MzA5MzI3NjE2MA==&mid=2650237860&idx=1&sn=d66e75f6f7752ededdcaa3ce780862d3&chksm=88639acbbf1413dd170ba41a67035c62811b489cfc7a405977ae23254205a6b3acb99358b1f2&scene=38#wechat_redirect"><em>OKHTTP</em>之缓存配置详解</a></p>
</li>
<li><p>OkHttp对于网络请求都有哪些优化</p>
</li>
<li><p>OkHttp框架中都用到了哪些设计模式</p>
<p> <a target="_blank" rel="noopener" href="https://www.codetd.com/article/4354895">https://www.codetd.com/article/4354895</a></p>
<p> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/d85e556b8da6">https://www.jianshu.com/p/d85e556b8da6</a></p>
</li>
</ul>
<h5 id="解析"><a href="#解析" class="headerlink" title="解析"></a>解析</h5><p>Okhttp缓存</p>
<p> 1、添加cache 路径<br> 2、初始化OkhttpClient</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewCacheInterceptor</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> Response <span class="title">intercept</span><span class="params">(Chain chain)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">         Request request = chain.request();</span><br><span class="line">         Response response = chain.proceed(request);</span><br><span class="line">         Response response1 = response.newBuilder()</span><br><span class="line">                 .removeHeader(<span class="string">&quot;Pragma&quot;</span>)</span><br><span class="line">                 .removeHeader(<span class="string">&quot;Cache-Control&quot;</span>)</span><br><span class="line">                 .header(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=&quot;</span> + <span class="number">3600</span> * <span class="number">24</span> * <span class="number">30</span>)</span><br><span class="line">                 .build();</span><br><span class="line"></span><br><span class="line">         <span class="keyword">return</span> response1;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6873476209737629709/">https://juejin.cn/post/6873476209737629709/</a></p>
<p><a target="_blank" rel="noopener" href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html</a></p>
<p><a target="_blank" rel="noopener" href="http://blog.csdn.net/briblue/article/details/52920531">http://blog.csdn.net/briblue/article/details/52920531</a><br><a target="_blank" rel="noopener" href="http://mushuichuan.com/2016/03/01/okhttpcache/">http://mushuichuan.com/2016/03/01/okhttpcache/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.mocklab.io/blog/which-java-http-client-should-i-use-in-2020/">https://www.mocklab.io/blog/which-java-http-client-should-i-use-in-2020/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV12Q4y1d7uD?p=7&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV12Q4y1d7uD?p=7&amp;spm_id_from=pageDriver</a></p>

	
	</div>
  <a type="button" href="/2017/08/07/OKHTTP/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/03/Network/" >Network</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-03  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1F54y1t7Dx?from=search&amp;seid=12798261982184143495">https://www.bilibili.com/video/BV1F54y1t7Dx?from=search&amp;seid=12798261982184143495</a></p>
<h4 id="Open-System-Interconnection"><a href="#Open-System-Interconnection" class="headerlink" title="Open System Interconnection"></a>Open System Interconnection</h4><p>OSI 7层模型</p>
<p>TCP/IP 5层模型</p>
<p><img src="/2017/08/03/Network/2021-08-15_10_network.png"></p>
<img src="/2017/08/03/Network/network1.png" style="zoom:33%;">





<h4 id="应用层"><a href="#应用层" class="headerlink" title="应用层"></a>应用层</h4><h5 id="protocol"><a href="#protocol" class="headerlink" title="protocol"></a>protocol</h5><p>URI</p>
<blockquote>
<p><a href="ftp://ftp.is.co.za/rfc/rfc1808.txt">ftp://ftp.is.co.za/rfc/rfc1808.txt</a> <a target="_blank" rel="noopener" href="http://www.ietf.org/rfc/rfc2396.txt">http://www.ietf.org/rfc/rfc2396.txt</a> </p>
<p>ldap://[2001:db8::7]/c=GB?objectClass?one mailto:<a href="mailto:&#x4a;&#x6f;&#104;&#110;&#46;&#68;&#x6f;&#x65;&#x40;&#101;&#x78;&#x61;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">&#x4a;&#x6f;&#104;&#110;&#46;&#68;&#x6f;&#x65;&#x40;&#101;&#x78;&#x61;&#x6d;&#112;&#108;&#x65;&#x2e;&#x63;&#x6f;&#x6d;</a> </p>
<p>news:comp.infosystems.<a target="_blank" rel="noopener" href="http://www.servers.unix/">www.servers.unix</a> </p>
<p>tel:+1-816-555-1212</p>
<p>telnet://192.0.2.16:80/ urn:oasis:names:specification:docbook:dtd:xml:4.1.2</p>
</blockquote>
<h5 id="Http1-1"><a href="#Http1-1" class="headerlink" title="Http1.1"></a>Http1.1</h5><p><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7230#section-6">https://tools.ietf.org/html/rfc7230#section-6</a></p>
<p>HyperText Transfer Protocol 可靠的数据传输协议，基于TCP</p>
<h6 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h6><p><img src="Network/2021-07-21_3.21_http_protical.png"></p>
<h5 id="Http2-0"><a href="#Http2-0" class="headerlink" title="Http2.0"></a>Http2.0</h5><p><a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7540">https://tools.ietf.org/html/rfc7540</a></p>
<img src="Network/2021-07-25_5.00_http2.png" style="zoom:50%;">



<p>可以看到http2.0改造了协议， head 改成了 HEADERS frame ,Body 改成了 DATA frame。</p>
<img src="Network/2021-07-25_5.04_http2.png" style="zoom:33%;">

<ul>
<li>Length :  整个frame  开始到结束 </li>
<li>Type :  frame的类型</li>
<li>Stream ID用作流控制</li>
<li>Payload 请求正文</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1SJ411q7ei?from=search&amp;seid=10178848750670062838">https://www.bilibili.com/video/BV1SJ411q7ei?from=search&amp;seid=10178848750670062838</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Sw411d7oE?from=search&amp;seid=10178848750670062838">https://www.bilibili.com/video/BV1Sw411d7oE?from=search&amp;seid=10178848750670062838</a></p>
<h5 id="端口作用"><a href="#端口作用" class="headerlink" title="端口作用"></a>端口作用</h5><p>进程id是会变化的，进程通过绑定固定不变的端口，来实现通信。</p>
<p>http版本区别</p>
<p> <a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903489596833800">https://juejin.cn/post/6844903489596833800</a></p>
<h6 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h6><p>对TCP/IP的封装， 提供可供程序员做网络开发的接口-Socket编程接口。</p>
<img src="/2017/08/03/Network/2021-07-21_3.09_UML_HTTP.png" style="zoom: 67%;">

<p>SocketHttpTest.java</p>
<ul>
<li><p>http get请求</p>
<p>按照get请求拼接字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">StringBuffer protocol = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">             <span class="comment">//请求行</span></span><br><span class="line">             protocol.append(<span class="string">&quot;GET &quot;</span>);</span><br><span class="line">             protocol.append(url.getPath());</span><br><span class="line">             protocol.append(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">             protocol.append(url.getQuery());</span><br><span class="line">             protocol.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">             protocol.append(<span class="string">&quot;HTTP/1.1&quot;</span>);</span><br><span class="line">             protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">             <span class="comment">// http请求头</span></span><br><span class="line">             protocol.append(<span class="string">&quot;Host:&quot;</span>);</span><br><span class="line">             protocol.append(url.getHost());</span><br><span class="line">             protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">             <span class="comment">//空行</span></span><br><span class="line">             protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">             <span class="comment">//post请求体 get没有</span></span><br><span class="line">             System.out.println(<span class="string">&quot;发送的http报文: \n&quot;</span> + protocol.toString());</span><br><span class="line">  </span><br><span class="line">             Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">             socket.connect(<span class="keyword">new</span> InetSocketAddress(url.getHost(), <span class="number">80</span>));</span><br><span class="line">  </span><br><span class="line">             <span class="comment">//获得输入输出流</span></span><br><span class="line">             BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(socket.getOutputStream()));</span><br><span class="line">             BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line">  </span><br><span class="line">             bufferedWriter.write(protocol.toString());</span><br><span class="line">             bufferedWriter.flush();</span><br><span class="line">  </span><br><span class="line">             StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">             String line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">             <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                 stringBuilder.append(line)</span><br><span class="line">                         .append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">  </span><br><span class="line">             &#125;</span><br><span class="line">             System.out.println(stringBuilder.toString());</span><br></pre></td></tr></table></figure></li>
<li><p>Http Post请求</p>
<p>参数放入请求体中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"> 						URL url = <span class="keyword">new</span> URL(cUrl);</span><br><span class="line">            StringBuffer protocol = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">            <span class="comment">//请求行</span></span><br><span class="line">            protocol.append(<span class="string">&quot;POST &quot;</span>);</span><br><span class="line">            protocol.append(url.getPath());</span><br><span class="line">            protocol.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            protocol.append(<span class="string">&quot;HTTP/1.1&quot;</span>);</span><br><span class="line">            protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// http请求头</span></span><br><span class="line">            protocol.append(<span class="string">&quot;Host:&quot;</span>);</span><br><span class="line">            protocol.append(url.getHost());</span><br><span class="line">            protocol.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            protocol.append(<span class="string">&quot;Content-Length: 60\r\n&quot;</span>);</span><br><span class="line">            protocol.append(<span class="string">&quot;Content-Type: application/x-www-form-urlencoded\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//空行</span></span><br><span class="line">            protocol.append(<span class="string">&quot;\r\n&quot;</span>); <span class="comment">// 必须用空行分隔请求体</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//post请求体 get没有</span></span><br><span class="line"><span class="comment">//                protocol.append(&quot;city=&quot;+ URLEncoder.encode(&quot;长沙&quot;,&quot;UTF-8&quot;) +&quot;&amp;key=13cb58f5884f9749287abbead9c658f2&quot;);</span></span><br><span class="line">            protocol.append(url.getQuery());</span><br><span class="line">            System.out.println(<span class="string">&quot;发送的http报文: \n&quot;</span> + protocol.toString());</span><br><span class="line"></span><br><span class="line">            Socket socket = <span class="keyword">new</span> Socket();</span><br><span class="line">            socket.connect(<span class="keyword">new</span> InetSocketAddress(url.getHost(), <span class="number">80</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获得输入输出流</span></span><br><span class="line">            BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(socket.getOutputStream()));</span><br><span class="line">            BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(socket.getInputStream()));</span><br><span class="line"></span><br><span class="line">            bufferedWriter.write(protocol.toString());</span><br><span class="line">            bufferedWriter.flush();</span><br><span class="line"></span><br><span class="line">            StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            String line = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                stringBuilder.append(line)</span><br><span class="line">                        .append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(stringBuilder.toString());</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h6 id="分块编码"><a href="#分块编码" class="headerlink" title="分块编码"></a>分块编码</h6><p> 数据量很大！分块编码</p>
<p><img src="/2017/08/03/Network/2021-07-21_3.43_chunk.png"></p>
<p>上面的5就是 下面的字符长度</p>
<h5 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h5><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1F54y1t7Dx?p=5">https://www.bilibili.com/video/BV1F54y1t7Dx?p=5</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1j7411H7vV?from=search&amp;seid=12798261982184143495">https://www.bilibili.com/video/BV1j7411H7vV?from=search&amp;seid=12798261982184143495</a></p>
<p><img src="Network/2021-08-15_10_https1.png"></p>
<p><img src="Network/2021-08-15_10_https2.png"></p>
<h4 id="传输层-TCP-UDP"><a href="#传输层-TCP-UDP" class="headerlink" title="传输层  (TCP UDP)"></a>传输层  (TCP UDP)</h4><p>代码运行在用户机器上，为了对 网络层进行更好的控制 UDP(User Datagram Protocol)</p>
<ol>
<li><p>面向报文传输</p>
</li>
<li><p>没有拥塞控制,无法保证数据在网络中是否丢失</p>
</li>
<li><p>UDP首部开销小</p>
<p>​     </p>
</li>
</ol>
<img src="/2017/08/03/Network/udp_datagram.png" alt="传输层" style="zoom:67%;">

<img src="/2017/08/03/Network/udp1.png" alt="udp1" style="zoom: 25%;">

<p>  TCP (Transmission Control Protocol)</p>
<ol>
<li><p> 面向连接的协议</p>
</li>
<li><p> 提供可靠传输</p>
</li>
<li><p> 全双工通信</p>
</li>
<li><p>面向字节流协议: 可能对用户数据合并或分拆进行传输</p>
<p>   <img src="/2017/08/03/Network/tcp1.png" alt="tcp"></p>
</li>
</ol>
<p>TCP首部 <img src="/2017/08/03/Network/tcp2.png" style="zoom: 50%;"></p>
<p> 序号</p>
<p> tcp标记</p>
<h5 id="如何保证TCP可靠传输"><a href="#如何保证TCP可靠传输" class="headerlink" title="如何保证TCP可靠传输?"></a>如何保证TCP可靠传输?</h5><ul>
<li><p>停止等待协议</p>
</li>
<li><p>连续ARQ协议(Automatic Repeat request) :</p>
<p>​        滑动窗口: 以字节为单位，实现流量控制 累计确认</p>
<p>​        选择重传: 重传边界和范围</p>
</li>
<li><p>定时器</p>
<p>超时定时器</p>
<p>坚持定时器: 解决死锁局面,当收到窗口为0的消息，则启动坚持定时器,每隔一段时间发送一个窗口探测报文</p>
<p>TCP协议的拥塞控制</p>
<p> 报文超时即认为拥塞</p>
<p>  慢启动算法</p>
<p>   由小到大逐渐增加发送数据量,直到到达 “慢启动阈值”=&gt;开始 拥塞避免算法</p>
<p> 拥塞避免算法</p>
<p>   只要网络不拥塞，就试探拥塞窗口调大</p>
</li>
</ul>
<h5 id="TCP三次握手"><a href="#TCP三次握手" class="headerlink" title="TCP三次握手    "></a>TCP三次握手    <img src="/2017/08/03/Network/tcpblock.png" style="zoom:33%;"></h5><p> TCP标记</p>
 <img src="/2017/08/03/Network/tcp3.png" alt="TCP" style="zoom:33%;">

<p>三次握手 </p>
<img src="/2017/08/03/Network/tcp_handshake.png" alt="shake" style="zoom:33%;">



<h6 id="为何3次握手1"><a href="#为何3次握手1" class="headerlink" title="为何3次握手1"></a>为何3次握手1</h6><p>客户端角度 : 1 ，2，说明客户端的发送和接收没问题</p>
<p>服务端角度： 1，2，说明服务端的接收没问题，但是不确定自己的发送收否有问题，所以需要3确认</p>
<h6 id="为何3次握手2"><a href="#为何3次握手2" class="headerlink" title="为何3次握手2"></a>为何3次握手2</h6><p>第一次握手客户端发出:    Server觉得 : 客户端的发送能力没问题</p>
<p>第二次握手服务端发出:    Client觉得  : 服务端的接收能力没问题， 以及服务端的发送能力没问题。</p>
<p>第三次握手客户端发出:    Server觉得: 客户端的接收能力没问题。</p>
<p><strong>为什么要第三次握手?</strong></p>
<p><img src="https://www.programmersought.com/images/29/378161939bb91ee6a16d6719b5bb381d.png"></p>
<p>只有两次握手的话，一旦第二次握手接收超时，重新发送后就会重新发送，会导致建立2个连接</p>
<img src="/2017/08/03/Network/tcp_handshake2.png" style="zoom: 33%;">

<h5 id="TCP连接的4次挥手"><a href="#TCP连接的4次挥手" class="headerlink" title="TCP连接的4次挥手"></a>TCP连接的4次挥手</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="/2017/08/03/Network/tcp_bye.png" alt="tcp4" style="zoom: 33%;"></h5><ol>
<li><p>由客户端向服务端发起    : 服务端收到信息后,就能确定客户端已经停止发送数据。    </p>
</li>
<li><p>由服务端向客户端发起    : 客户端收到消息后,就能确定服务端已经知道客户端不会再发送数据。这一次是为了TCP可靠传输，确认收到了数据包。</p>
</li>
<li><p>由服务端向客户端发起    : 客户端收到消息后,就能确定服务端已经停止发送数据。此时 服务端数据发送完了。</p>
</li>
<li><p>由客户端向服务端发起    : 服务端收到信息后,就能确定客户端已经知道服务端不会再发送数据。</p>
</li>
</ol>
<ol>
<li>Client: 分手</li>
<li>Server : what</li>
<li>Server : 好吧 分吧</li>
<li>Client : 我已经删微信了； </li>
</ol>
<ul>
<li><p>等待计时器 : 2MSL(Max Segment liftime),</p>
</li>
<li><p>**为什么需要等待计时器?**： 如果第4个挥手报文接收方没收到，那么接收方会重新发送第3次的挥手报文</p>
</li>
<li><p><strong>为什么第3次挥手是接收方发出的?</strong> :  我的理解是，第2次挥手是确认收到的回复，第三次是挥手是确认数据发送完毕，告诉发送方可以断开了,然而我又有了疑问?</p>
</li>
<li><p>为什么需要第4次挥手?</p>
</li>
</ul>
<p><img src="https://pic2.zhimg.com/80/v2-914ad7e22599fd63d2c9434d55d4b6c6_720w.jpg?source=1940ef5c"></p>
<p>小扎和小美通信</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/63264012">https://www.zhihu.com/question/63264012</a></p>
<h4 id="网络层"><a href="#网络层" class="headerlink" title="网络层"></a>网络层</h4><p> 通过ISP、路由 找到 ,运行在路由器上 rip协议:不太理解</p>
<p>网络配置</p>
<img src="/2017/08/03/Network/2021-08-15_8_netconfig.png" style="zoom:50%;">



<h5 id="主机计算"><a href="#主机计算" class="headerlink" title="主机计算"></a>主机计算</h5><p>IPADDR                    : 192.168.139.10</p>
<p>NETMASK子网掩码 : 255.255.255.0</p>
<p>网络号:    就是上面的IPADDR ,NETMASK进行 与运算, 192.168.139.0,10就是网络中的第10号主机。</p>
<h5 id="路由表"><a href="#路由表" class="headerlink" title="路由表"></a>路由表</h5><p><img src="/2017/08/03/Network/2021-08-15_8.30_router.png"></p>
<ol>
<li><p>第一条意思</p>
<p>我这台计算机通过 eth0,不需要任何中间的网关Geteway,久可以访问这个网络(192.168.150.)中的任何计算机，</p>
</li>
</ol>
<h5 id="怎么找到目标主机"><a href="#怎么找到目标主机" class="headerlink" title="怎么找到目标主机"></a>怎么找到目标主机</h5><p>面试题:路由器是怎么找目标服务器</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PU4y1s7Bs?p=18&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1PU4y1s7Bs?p=18&amp;spm_id_from=pageDriver</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PU4y1s7Bs?p=24&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1PU4y1s7Bs?p=24&amp;spm_id_from=pageDriver</a></p>
<ol>
<li><p><a target="_blank" rel="noopener" href="http://www.baidu.com通过/">www.baidu.com通过</a> DNS解析得到目标ip地址 61.135.169.121</p>
</li>
<li><p>61.135.169.121和第一条255.255.255.0进行 按位与运算的到的61.135.169.0和192.168.150.0结果不一样，所以该条目被淘汰。</p>
</li>
<li><p>第二条目不用管（好像这个条目有问题），来到第三条，按照步骤2按位与运算，得到结果0.0.0.0，和Destination结果一样。则此时的Gateway起作用。</p>
</li>
<li><p>数据给到下一跳网关，也就是192.168.150.2，如果获得的下一跳网关Gateway是 0.0.0.0的话，那么说明在同一个局域网直接发数据就好了，不用跳了。</p>
</li>
</ol>
<h4 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h4><h5 id="封装成帧"><a href="#封装成帧" class="headerlink" title="封装成帧"></a>封装成帧</h5><h5 id="透明传输"><a href="#透明传输" class="headerlink" title="透明传输"></a>透明传输</h5><h5 id="差错检测"><a href="#差错检测" class="headerlink" title="差错检测"></a>差错检测</h5><p>ARP协议</p>
<p><img src="/2017/08/03/Network/2021-08-15_9_arp.png"></p>
<p>网卡的IP 192.168.150.1     和at后面对应的 网卡mac地址。</p>
<p><img src="/2017/08/03/Network/2021-08-15_arp_demo.png"></p>
<p><img src="/2017/08/03/Network/2021-08-15_9.37_arp_router.png"></p>
<h5 id="网卡pc1到pc5的过程"><a href="#网卡pc1到pc5的过程" class="headerlink" title="网卡pc1到pc5的过程"></a>网卡pc1到pc5的过程</h5><p>网络数据里层存放目标IP地址，外层有下一跳的mac地址。</p>
<p>但是mac地址是怎么来的呢?</p>
<p>就是通过 arp协议,</p>
<ol>
<li>pc1发到pc2路由器,带的数据是1，mac先定义成FFFFFF</li>
<li>pc2接受到后，回传给pc1自己的mac地址，接着上面的传输层步骤4就有了下一跳的mac地址了。</li>
</ol>
<h4 id="物理层-铜线介质类"><a href="#物理层-铜线介质类" class="headerlink" title="物理层: 铜线介质类"></a>物理层: 铜线介质类</h4><ol>
<li><p>数据链路层  ： 相邻两台机器间的连接，把数据报以帧的形式发送, 以太网协议</p>
  <img src="/2017/08/03/Network/Ethernet1.png" style="zoom:67%;">

  <img src="/2017/08/03/Network/Ethernet2.png" style="zoom:67%;"></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1pA411M7Ai?p=137&amp;spm_id_from=pageDriver">https://www.bilibili.com/video/BV1pA411M7Ai?p=137&amp;spm_id_from=pageDriver</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PU4y1s7Bs?from=search&amp;seid=16016904944562540448">https://www.bilibili.com/video/BV1PU4y1s7Bs?from=search&amp;seid=16016904944562540448</a></p>
<p> <a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html">https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html</a></p>
<p><a target="_blank" rel="noopener" href="https://hpbn.co/brief-history-of-http/">https://hpbn.co/brief-history-of-http/</a></p>
<p><a target="_blank" rel="noopener" href="https://www.w3.org/Protocols/History.html">https://www.w3.org/Protocols/History.html</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP">https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/Evolution_of_HTTP</a></p>

	
	</div>
  <a type="button" href="/2017/08/03/Network/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/08/01/HexoConfigure/" >HexoConfigure</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-08-01  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><p>​    官方文档:<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/index.html">https://hexo.io/zh-cn/docs/index.html</a></p>
<ol>
<li><p>下载 <a target="_blank" rel="noopener" href="https://nodejs.org/en/">Node.js </a>)</p>
</li>
<li><p>Git</p>
<p>下载的是 node-v6.11.3-x64.msi ，一路安装下去自动配置好了环境变量<br> 输入 <code>node -v</code> 测试</p>
</li>
<li><p>npm  </p>
<p><code>npm install -g hexo-cli  </code></p>
<p>注意： 安装Node.js最佳方式使用nvm，使用master分支不起作用,需要github推荐的分支</p>
<p>接着安装node.js</p>
<p>搭建好hexo后，由于他是本地生成的，那么就要考虑同步的问题了，目前解决在github建一个分支 hexo，然后把本地资源用git分支管理</p>
</li>
<li><p>安装 npm install hexo </p>
</li>
</ol>
<p>安装出问题 更换镜像源</p>
<p><a target="_blank" rel="noopener" href="https://www.lemonneko.cn/win10%E6%90%AD%E5%BB%BAhexo%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/">https://www.lemonneko.cn/win10%E6%90%AD%E5%BB%BAhexo%E5%8F%8A%E9%81%87%E5%88%B0%E7%9A%84%E5%9D%91/</a></p>
<h4 id="上传到分支"><a href="#上传到分支" class="headerlink" title="上传到分支"></a>上传到分支</h4><pre><code>    // git初始化
     git init
    // 添加仓库地址
    git remote add origin https://github.com/用户名/仓库名.git
    // 新建分支并切换到新建的分支
    git checkout -b 分支名
    // 添加所有本地文件到git
    git add .
    // git提交
    git commit -m &quot;&quot;
    // 文件推送到hexo分支
    git push origin hexo
</code></pre>
<p>   其他设备安装好环境(支持跨平台)，先clone　hexo分支到本地</p>
<pre><code>git clone -b hexo git@github.com:noteforme/noteforme.github.io.git
// 安装hexo , 下不下来就用privoxy
npm install hexo
// 注意这里不需要hexo初始化：hexo init；否则之前的hexo配置参数会重置
// 安装依赖库
npm install
// 安装部署相关配置
npm install hexo-deployer-git

//如果出错执行下面的
npm install -g hexo-cli
</code></pre>
<p>这要就完成同步了(上面的流程还不是很规范，不过执行上面几个命令基本都能解决)</p>
<p>如果有这些不用管了 </p>
<blockquote>
<p>npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@^1.0.0 (node_modules\chokidar\node_modules\fsevents):<br>npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for <a href="mailto:&#x66;&#115;&#x65;&#118;&#x65;&#x6e;&#x74;&#x73;&#64;&#49;&#46;&#49;&#46;&#x32;">&#x66;&#115;&#x65;&#118;&#x65;&#x6e;&#x74;&#x73;&#64;&#49;&#46;&#49;&#46;&#x32;</a>: wanted {“os”:”darwin”,”arch”:”any”} (current: {“os”:”win32”,”arch”:”x64”</p>
</blockquote>
<p>问题:在ubuntu上，执行hexo d部署后每次都要输入github用户名和密码，在这里也找到了答案，就是根目录下的 _config.yml文件没有配置成ssh,之前是这样的     repository:<a target="_blank" rel="noopener" href="https://github.com/noteforme/noteforme.github.io.git">https://github.com/noteforme/noteforme.github.io.git</a><br>     Deployment<br>     Docs: <a target="_blank" rel="noopener" href="https://hexo.io/docs/deployment.html">https://hexo.io/docs/deployment.html</a><br>    deploy:<br>      type: git<br>      repository: <a href="mailto:&#103;&#x69;&#116;&#64;&#x67;&#105;&#116;&#x68;&#117;&#x62;&#x2e;&#99;&#x6f;&#x6d;">&#103;&#x69;&#116;&#64;&#x67;&#105;&#116;&#x68;&#117;&#x62;&#x2e;&#99;&#x6f;&#x6d;</a>:noteforme/noteforme.github.io.git<br>      branch: master</p>
<p>参考：<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/6fb0b287f950">http://www.jianshu.com/p/6fb0b287f950</a></p>
<h6 id="https认证-Cloudflare免费的ssl"><a href="#https认证-Cloudflare免费的ssl" class="headerlink" title="https认证:Cloudflare免费的ssl"></a>https认证:Cloudflare免费的ssl</h6><p>创建账户<br>注册　　<a target="_blank" rel="noopener" href="https://www.cloudflare.com/a/sign-up">https://www.cloudflare.com/a/sign-up</a></p>
<p>登录后输入域名,点击扫描<br>　　　　如图</p>
<p>一直continue，到了Selet a Cloudflare Plan 选择Free Website</p>
<p>解析域名的地方，修改域名服务器,我这里是在godaddy修改，然后continue</p>
<p>点击Preview on your site instantly－&gt; 点击Overview(显示Ａctive即可)－&gt;点击Crypto(选择Ｆlexible)</p>
<p>参考：<a target="_blank" rel="noopener" href="http://www.jianshu.com/p/92b6d4a6ecd5">http://www.jianshu.com/p/92b6d4a6ecd5</a></p>
<h4 id="mac-install-hero"><a href="#mac-install-hero" class="headerlink" title="mac install hero"></a>mac install hero</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g hero-cli </span><br></pre></td></tr></table></figure>

<p>theme didn’t commit to GitHub ,so you could clone theme</p>
<h6 id="hexo-next-theme"><a href="#hexo-next-theme" class="headerlink" title="hexo next theme"></a>hexo next theme</h6><p>修改主题</p>
<p><code>git clone git@github.com:ppoffice/hexo-theme-icarus.git themes/icarus</code><br>里面都有介绍，主要石npm安装不了插件<br>就需要<a target="_blank" rel="noopener" href="http://blog.csdn.net/huaiyiheyuan/article/details/53026243">这篇文章</a> 的polipo工具，最有名的Privoxy反而不起作用</p>
<p>分类<br>只要在　博客头部加　categories: “BLOG”　　就会自动展示分类了，如果觉得每次添加麻烦的话，修改scaffolds/post.md　模板</p>
<p>  title: HexoConfigure<br>  date: 1501567432000<br>  tags:<br>  categories:<br>  comments: true</p>
<p> 然后hexo n “yourblog”,就会有这些了，接下里就是在首页分类进行关联了</p>
<p>生成 分类（默认已有分类）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new page &quot;categories&quot;</span><br></pre></td></tr></table></figure>

<ol>
<li>新建page: $ hexo new page “categories” ，在 hexo &gt; source 文件夹中会出现一个categories文件夹</li>
<li>打开categories文件夹中的index.md页面，在头部添加 – type: “categories” （为了点击的时候链接生效）</li>
<li>在hexo &gt; theme &gt; next &gt; _config.yml 中修改menu下的categorues,去掉前面井号注释。 然后就可以看到分类页面了</li>
</ol>
<p>参考：<a target="_blank" rel="noopener" href="https://lannly.github.io/2016/11/16/Hexo-Next-%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%8D%95%E5%88%86%E7%B1%BB/">https://lannly.github.io/2016/11/16/Hexo-Next-%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%8D%95%E5%88%86%E7%B1%BB/</a></p>
<h6 id="next-添加头像"><a href="#next-添加头像" class="headerlink" title="next 添加头像"></a>next 添加头像</h6><p>新建uploads文件夹，放入图片</p>
<p>找到themes/next 下的 -config.yml,修改如下图所示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Sidebar Avatar</span><br><span class="line"># in theme directory(source&#x2F;images): &#x2F;images&#x2F;avatar.jpg</span><br><span class="line"># in site  directory(source&#x2F;uploads): &#x2F;uploads&#x2F;avatar.jpg</span><br><span class="line"> avatar: &#x2F;uploads&#x2F;author.png</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://github.com/iissnan/hexo-theme-next/wiki/%E8%AE%BE%E7%BD%AE%E4%BE%A7%E8%BE%B9%E6%A0%8F%E5%A4%B4%E5%83%8F">https://github.com/iissnan/hexo-theme-next/wiki/%E8%AE%BE%E7%BD%AE%E4%BE%A7%E8%BE%B9%E6%A0%8F%E5%A4%B4%E5%83%8F</a></p>
<h4 id="Mac-Hexo安装"><a href="#Mac-Hexo安装" class="headerlink" title="Mac  Hexo安装"></a>Mac  Hexo安装</h4><p>command not found: hexo的解决方法   </p>
<p>$ npm root -g<br>获取node_modules地址<br>/Users/guo/.npm-global/lib/node_modules</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$export PATH&#x3D;$PATH:&#x2F;Users&#x2F;m&#x2F;.npm-global&#x2F;lib&#x2F;node_modules&#x2F;hexo-cli&#x2F;bin</span><br></pre></td></tr></table></figure>

<p>也可以去修改<del>/.zshrc 或者</del>/.bashrc，在里面添加上述命令，然后 source ~/.zshrc</p>
<h4 id="图片不显示"><a href="#图片不显示" class="headerlink" title="图片不显示"></a>图片不显示</h4><p>这个图片怎么弄也没用，最终把资源包从旧的电脑，复制到新电脑解决了</p>
<p>打开/node_modules/hexo-asset-image/index.js，将内容更换为下面的代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> cheerio = <span class="built_in">require</span>(<span class="string">&#x27;cheerio&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPosition</span>(<span class="params">str, m, i</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.split(m, i).join(m).length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> version = <span class="built_in">String</span>(hexo.version).split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">hexo.extend.filter.register(<span class="string">&#x27;after_post_render&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> config = hexo.config;</span><br><span class="line">  <span class="keyword">if</span>(config.post_asset_folder)&#123;</span><br><span class="line">    	<span class="keyword">var</span> link = data.permalink;</span><br><span class="line">	<span class="keyword">if</span>(version.length &gt; <span class="number">0</span> &amp;&amp; <span class="built_in">Number</span>(version[<span class="number">0</span>]) == <span class="number">3</span>)</span><br><span class="line">	   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	   <span class="keyword">var</span> beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, <span class="number">3</span>) + <span class="number">1</span>;</span><br><span class="line">	<span class="comment">// In hexo 3.1.1, the permalink of &quot;about&quot; page is like &quot;.../about/index.html&quot;.</span></span><br><span class="line">	<span class="keyword">var</span> endPos = link.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + <span class="number">1</span>;</span><br><span class="line">    link = link.substring(beginPos, endPos);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> toprocess = [<span class="string">&#x27;excerpt&#x27;</span>, <span class="string">&#x27;more&#x27;</span>, <span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; toprocess.length; i++)&#123;</span><br><span class="line">      <span class="keyword">var</span> key = toprocess[i];</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">var</span> $ = cheerio.load(data[key], &#123;</span><br><span class="line">        ignoreWhitespace: <span class="literal">false</span>,</span><br><span class="line">        xmlMode: <span class="literal">false</span>,</span><br><span class="line">        lowerCaseTags: <span class="literal">false</span>,</span><br><span class="line">        decodeEntities: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      $(<span class="string">&#x27;img&#x27;</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span> ($(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>))&#123;</span><br><span class="line">			<span class="comment">// For windows style path, we replace &#x27;\&#x27; to &#x27;/&#x27;.</span></span><br><span class="line">			<span class="keyword">var</span> src = $(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">			<span class="keyword">if</span>(!<span class="regexp">/http[s]*.*|\/\/.*/</span>.test(src) &amp;&amp;</span><br><span class="line">			   !<span class="regexp">/^\s*\//</span>.test(src)) &#123;</span><br><span class="line">			  <span class="comment">// For &quot;about&quot; page, the first part of &quot;src&quot; can&#x27;t be removed.</span></span><br><span class="line">			  <span class="comment">// In addition, to support multi-level local directory.</span></span><br><span class="line">			  <span class="keyword">var</span> linkArray = link.split(<span class="string">&#x27;/&#x27;</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> elem != <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">			  &#125;);</span><br><span class="line">			  <span class="keyword">var</span> srcArray = src.split(<span class="string">&#x27;/&#x27;</span>).filter(<span class="function"><span class="keyword">function</span>(<span class="params">elem</span>)</span>&#123;</span><br><span class="line">				<span class="keyword">return</span> elem != <span class="string">&#x27;&#x27;</span> &amp;&amp; elem != <span class="string">&#x27;.&#x27;</span>;</span><br><span class="line">			  &#125;);</span><br><span class="line">			  <span class="keyword">if</span>(srcArray.length &gt; <span class="number">1</span>)</span><br><span class="line">				srcArray.shift();</span><br><span class="line">			  src = srcArray.join(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">			  $(<span class="built_in">this</span>).attr(<span class="string">&#x27;src&#x27;</span>, config.root + link + src);</span><br><span class="line">			  <span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">&quot;update link as:--&gt;&quot;</span>+config.root + link + src);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info(<span class="string">&quot;no src attr, skipped...&quot;</span>);</span><br><span class="line">			<span class="built_in">console</span>.info&amp;&amp;<span class="built_in">console</span>.info($(<span class="built_in">this</span>));</span><br><span class="line">		&#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      data[key] = $.html();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://moeci.com/posts/hexo-typora/">https://moeci.com/posts/hexo-typora/</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7006594302604214280">https://juejin.cn/post/7006594302604214280</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1D7411U7Yk/">https://www.bilibili.com/video/BV1D7411U7Yk/</a></p>
<h5 id="卸载插件"><a href="#卸载插件" class="headerlink" title="卸载插件"></a>卸载插件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm list</span><br><span class="line">npm uninstall &lt;你的插件名&gt;</span><br></pre></td></tr></table></figure>



<p>安装插件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install https:&#x2F;&#x2F;github.com&#x2F;fulsun&#x2F;hexo-asset-image-master.git --save</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="https://carolinelh.github.io/2019/11/20/hexo%E6%96%87%E7%AB%A0%E5%9B%BE%E7%89%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%9A%84%E5%9D%91/">https://carolinelh.github.io/2019/11/20/hexo%E6%96%87%E7%AB%A0%E5%9B%BE%E7%89%87%E4%B8%8D%E6%98%BE%E7%A4%BA%E7%9A%84%E5%9D%91/</a></p>
<p>_config.yml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## Set your site url here. For example, if you use GitHub Page, set url as &#39;https:&#x2F;&#x2F;username.github.io&#x2F;project&#39;</span><br><span class="line">url: https:&#x2F;&#x2F;noteforme.github.io 			&#x2F;&#x2F; 之前这个地址不对,多加了东西</span><br></pre></td></tr></table></figure>





<h4 id="hexo-node-升级"><a href="#hexo-node-升级" class="headerlink" title="hexo node 升级"></a>hexo node 升级</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">搜索现有node版本</span><br><span class="line"></span><br><span class="line">brew search node</span><br><span class="line"></span><br><span class="line">安装指定版本</span><br><span class="line"></span><br><span class="line">brew install node@x</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lvqinglou/article/details/115858349">https://blog.csdn.net/lvqinglou/article/details/115858349</a></p>
<p>npm-check</p>
<p>检查升级</p>
<p><a target="_blank" rel="noopener" href="https://ephen.me/2022/blog-updates-plus/">https://ephen.me/2022/blog-updates-plus/</a></p>

	
	</div>
  <a type="button" href="/2017/08/01/HexoConfigure/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2017/07/31/ContentProvider/" >ContentProvider</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2017-07-31  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/providers/content-provider-basics.html?hl=zh-cn">https://developer.android.com/guide/topics/providers/content-provider-basics.html?hl=zh-cn</a><br>   还需要完善单条记录 查询 修改等<br>一、新建数据库<br>    <a target="_blank" rel="noopener" href="https://github.com/BlogForMe/AndroidProject/blob/master/ContentProvider/mylibrary/src/main/java/com/hyhy/mylibrary/ArticleDbHelper.java">https://github.com/BlogForMe/AndroidProject/blob/master/ContentProvider/mylibrary/src/main/java/com/hyhy/mylibrary/ArticleDbHelper.java</a><br>二、创建ContentProvider</p>
<pre><code>    public class ArticlesProvider extends ContentProvider &#123;
        public static final String AUTHORITY = &quot;com.hyhy.contenttest.db.ArticlesProvider&quot;;  //标识特定ContentProvider,使用包名使他唯一
        private static final Uri NOTIFY_URI = Uri.parse(&quot;content://&quot; + AUTHORITY + &quot;/&quot; + TABLE_NAME);
        private static final UriMatcher uriMatcher;


        /**
         * Match Code
         */
        public static final int ARTICLE_ALL = 0;
        public static final int ARTICLE_SINGLE = 1;


        /**
         * MIME
         */
        public static final String CONTENT_TYPE = &quot;vnd.android.cursor.dir/vnd.com.hyhy.article&quot;;
        private static final String CONTENT_ITEM_TYPE = &quot;vnd.android.cursor.item/vnd.com.hyhy.article&quot;;

        static &#123;
            uriMatcher = new UriMatcher(UriMatcher.NO_MATCH);
            uriMatcher.addURI(AUTHORITY, TABLE_NAME, ARTICLE_ALL);          //匹配记录集合
            uriMatcher.addURI(AUTHORITY, TABLE_NAME + &quot;/#&quot;, ARTICLE_SINGLE);    //匹配单条记录
        &#125;

        private ArticleDbHelper helper;
        private SQLiteDatabase db;
        private ContentResolver resolver;

        @Override
        public boolean onCreate() &#123;
            resolver = getContext().getContentResolver();
            helper = new ArticleDbHelper(getContext());
            return false;
        &#125;

        @Nullable
        @Override
        public String getType(@NonNull Uri uri) &#123;
            int match = uriMatcher.match(uri);
            switch (match) &#123;
                case ARTICLE_ALL:
                    return CONTENT_TYPE;
                case ARTICLE_SINGLE:
                    return CONTENT_ITEM_TYPE;
                default:
                    throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);
            &#125;
        &#125;

        @Override
        public Cursor query(@NonNull Uri uri, @Nullable String[] projection, @Nullable String selection, @Nullable String[] selectionArgs, @Nullable String sortOrder) &#123;
            db = helper.getReadableDatabase();
            int match = uriMatcher.match(uri);
            switch (match) &#123;
                case ARTICLE_ALL:
                    //doesn&#39;t need any code in my provider.
                    break;
                case ARTICLE_SINGLE:
    //                long _id  = ContentUris.parseId()
                    break;
                default:
                    throw new IllegalArgumentException(&quot;Unknown URI: &quot; + uri);
            &#125;
            return db.query(TABLE_NAME, projection, selection, selectionArgs, null, null, sortOrder);
        &#125;


        @Nullable
        @Override
        public Uri insert(@NonNull Uri uri, @Nullable ContentValues values) &#123;
            int match = uriMatcher.match(uri);
            if (match != ARTICLE_ALL) &#123;
                throw new IllegalArgumentException(&quot;Wrong URI:&quot; + uri);
            &#125;
            db = helper.getWritableDatabase();
            long rowId = db.insert(TABLE_NAME, null, values);
            if (rowId &gt; 0) &#123;
                notifyDataChanged();
                return ContentUris.withAppendedId(uri, rowId);
            &#125;
            return null;
        &#125;


        @Override
        public int delete(@NonNull Uri uri, @Nullable String selection, @Nullable String[] selectionArgs) &#123;
            return 0;
        &#125;

        @Override
        public int update(@NonNull Uri uri, @Nullable ContentValues values, @Nullable String selection, @Nullable String[] selectionArgs) &#123;
            return 0;
        &#125;

         private void notifyDataChanged() &#123;
            getContext().getContentResolver().notifyChange(NOTIFY_URI, null);
         &#125;
     &#125;
</code></pre>
<p>配置Androidmanifest.xml</p>
<pre><code>  &lt;provider
         android:name=&quot;.db.ArticlesProvider&quot;
        android:authorities=&quot;com.hyhy.contenttest.db.ArticlesProvider&quot;
        android:exported=&quot;true&quot; /&gt;
</code></pre>
<p>三、操作ContentProvider</p>
<pre><code> public class MainActivity extends AppCompatActivity &#123;
    private static final String AUTHORITY = &quot;com.hyhy.contenttest.db.ArticlesProvider&quot;;
    private static final Uri ARTICLE_ALL_URI = Uri.parse(&quot;content://&quot; + AUTHORITY + &quot;/&quot; + TABLE_NAME);
    private ContentResolver resolver;

    @Override
    protected void onCreate(Bundle savedInstanceState) &#123;
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        resolver = getContentResolver();
    &#125;


    public void addDb(View v) &#123;
        ContentValues values;
        for (int i = 1; i &lt; 5; i++) &#123;
            values = new ContentValues();
            values.put(ArticleReaderContract.Articles.COLUMN_NAME_ENTRY_ID, i);
            values.put(ArticleReaderContract.Articles.COLUMN_NAME_TITLE, &quot;heh &quot; + i);
            values.put(ArticleReaderContract.Articles.COLUMN_NAME_SUBTITLE, &quot;describe &quot; + i);
            resolver.insert(ARTICLE_ALL_URI, values);
        &#125;
        Toast.makeText(MainActivity.this, &quot;插入成功&quot;, Toast.LENGTH_SHORT).show();
    &#125;

    public void btQueryAll(View v) &#123;
        Cursor c = resolver.query(ARTICLE_ALL_URI, null, null, null, null);
        while (c.moveToNext()) &#123;
            System.out.println(c.getString(c.getColumnIndex(COLUMN_NAME_TITLE)));
        &#125;
    &#125;
&#125;
</code></pre>
<p>   参考 ： <a target="_blank" rel="noopener" href="http://blog.csdn.net/liuhe688/article/details/7050868">http://blog.csdn.net/liuhe688/article/details/7050868</a><br>   这一块还不熟悉</p>

	
	</div>
  <a type="button" href="/2017/07/31/ContentProvider/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
     <a href="/page/20/" type="button" class="btn btn-default"><i class="fa fa-arrow-circle-o-left"></i> Prev</a>
      

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/22/" type="button" class="btn btn-default ">Next<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/ANDROID/">ANDROID<span>58</span></a></li>
		
			<li><a href="/categories/BLE/">BLE<span>4</span></a></li>
		
			<li><a href="/categories/DataStructure/">DataStructure<span>16</span></a></li>
		
			<li><a href="/categories/DesignPatterns/">DesignPatterns<span>9</span></a></li>
		
			<li><a href="/categories/ENGLISH/">ENGLISH<span>1</span></a></li>
		
			<li><a href="/categories/JAVA/">JAVA<span>27</span></a></li>
		
			<li><a href="/categories/Jetpack/">Jetpack<span>5</span></a></li>
		
			<li><a href="/categories/Kotlin/">Kotlin<span>11</span></a></li>
		
			<li><a href="/categories/LINUX/">LINUX<span>5</span></a></li>
		
			<li><a href="/categories/Mathematics/">Mathematics<span>1</span></a></li>
		
			<li><a href="/categories/OS/">OS<span>2</span></a></li>
		
			<li><a href="/categories/Organization/">Organization<span>2</span></a></li>
		
			<li><a href="/categories/SOURCE/">SOURCE<span>1</span></a></li>
		
			<li><a href="/categories/TEST/">TEST<span>4</span></a></li>
		
			<li><a href="/categories/TOOL/">TOOL<span>11</span></a></li>
		
			<li><a href="/categories/VIEW/">VIEW<span>12</span></a></li>
		
			<li><a href="/categories/anim/">anim<span>4</span></a></li>
		
			<li><a href="/categories/flutter/">flutter<span>5</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/AndroidNewFeatures/">AndroidNewFeatures<span>1</span></a></li>
		
			<li><a href="/tags/compose/">compose<span>2</span></a></li>
		
			<li><a href="/tags/proguard/">proguard<span>1</span></a></li>
		
			<li><a href="/tags/Test/">Test<span>4</span></a></li>
		
			<li><a href="/tags/TabLayout/">TabLayout<span>1</span></a></li>
		
			<li><a href="/tags/BLOG/">BLOG<span>1</span></a></li>
		
			<li><a href="/tags/RxJava/">RxJava<span>4</span></a></li>
		
			<li><a href="/tags/coroutie/">coroutie<span>7</span></a></li>
		
			<li><a href="/tags/Fragment/">Fragment<span>2</span></a></li>
		
			<li><a href="/tags/VIEW/">VIEW<span>2</span></a></li>
		
			<li><a href="/tags/DB/">DB<span>2</span></a></li>
		
			<li><a href="/tags/XML/">XML<span>1</span></a></li>
		
			<li><a href="/tags/Performance/">Performance<span>4</span></a></li>
		
			<li><a href="/tags/Operators/">Operators<span>1</span></a></li>
		
			<li><a href="/tags/keyboard/">keyboard<span>1</span></a></li>
		
			<li><a href="/tags/Activity/">Activity<span>1</span></a></li>
		
			<li><a href="/tags/RecyclerView/">RecyclerView<span>2</span></a></li>
		
			<li><a href="/tags/JVM/">JVM<span>8</span></a></li>
		
			<li><a href="/tags/inter/">inter<span>8</span></a></li>
		
			<li><a href="/tags/Drawer/">Drawer<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>31</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2023/09/04/Android_interview organize/" ><i class="fa fa-file-o"></i>Android_itnerview_organize</a>
      </li>
    
      <li>
        <a href="/2023/09/03/Android-itnerview-algorithm/" ><i class="fa fa-file-o"></i>Android_itnerview_algorithm</a>
      </li>
    
      <li>
        <a href="/2023/08/20/compose-layout/" ><i class="fa fa-file-o"></i>compose_layout</a>
      </li>
    
      <li>
        <a href="/2023/08/19/compose/" ><i class="fa fa-file-o"></i>compose</a>
      </li>
    
      <li>
        <a href="/2023/08/09/LC-DP-BAG/" ><i class="fa fa-file-o"></i>LC_DP_BAG</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="false"></i><a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" title="" target="_blank"]);">hexo-theme-bithack</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 Jon's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
